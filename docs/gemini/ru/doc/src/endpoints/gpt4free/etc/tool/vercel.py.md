# Модуль для получения и преобразования информации о моделях Vercel AI SDK

## Обзор

Модуль предназначен для извлечения информации о моделях, поддерживаемых Vercel AI SDK, преобразования этой информации в удобный формат и генерации кода для использования этих моделей в проекте `hypotez`. Модуль использует библиотеки `quickjs` и `curl_cffi` для получения и обработки данных.

## Подробнее

Модуль выполняет следующие основные задачи:

1.  **Получение информации о моделях**: Запрашивает данные с сайта Vercel AI SDK, извлекает JavaScript-файлы, содержащие информацию о моделях, и использует `quickjs` для выполнения JavaScript-кода и получения JSON-структуры с информацией о моделях.
2.  **Преобразование информации о моделях**: Преобразует полученную информацию в формат, удобный для использования в проекте `hypotez`, выделяя идентификаторы моделей и параметры по умолчанию.
3.  **Генерация кода**: Генерирует Python-код, который определяет модели и связывает их с провайдером Vercel, а также генерирует словарь для быстрого доступа к моделям по их ключам.

## Функции

### `get_model_info`

```python
def get_model_info() -> dict[str, Any]:
    """
    Извлекает информацию о моделях с сайта Vercel AI SDK.

    Returns:
        dict[str, Any]: Словарь, содержащий информацию о моделях.
                         Ключи словаря - имена моделей, значения - параметры моделей.
                         Возвращает пустой словарь в случае ошибки или отсутствия информации о моделях.

    Raises:
        Exception: Если возникает ошибка при выполнении HTTP-запроса или обработке данных.

    Как работает функция:
    1.  Выполняет HTTP-запрос к сайту Vercel AI SDK для получения HTML-страницы.
    2.  Извлекает пути к JavaScript-файлам, содержащим информацию о моделях, используя регулярные выражения.
    3.  Выполняет HTTP-запросы к каждому JavaScript-файлу для получения их содержимого.
    4.  Извлекает строку, содержащую определение моделей, используя регулярные выражения.
    5.  Использует библиотеку `quickjs` для выполнения JavaScript-кода и преобразования его в JSON-структуру.
    6.  Возвращает полученную JSON-структуру в виде словаря Python.

    Внутри функции происходят следующие действия и преобразования:
     A.  Выполнение HTTP-запроса к сайту Vercel AI SDK.
     |
     -- B. Извлечение путей к JavaScript-файлам.
     |
     C.  Выполнение HTTP-запросов к каждому JavaScript-файлу.
     |
     D.  Извлечение строки, содержащей определение моделей.
     |
     E.  Преобразование JavaScript-кода в JSON-структуру с использованием `quickjs`.
     |
     F.  Возврат JSON-структуры в виде словаря Python.

    Примеры:
        >>> get_model_info()
        {'model1': {'id': 'id1', 'parameters': {'param1': {'value': 'value1'}}}, 'model2': {'id': 'id2', 'parameters': {'param2': {'value': 'value2'}}}}
    """
```

### `convert_model_info`

```python
def convert_model_info(models: dict[str, Any]) -> dict[str, Any]:
    """
    Преобразует информацию о моделях в формат, удобный для использования в проекте `hypotez`.

    Args:
        models (dict[str, Any]): Словарь, содержащий информацию о моделях.
                                  Ключи словаря - имена моделей, значения - параметры моделей.

    Returns:
        dict[str, Any]: Словарь, содержащий преобразованную информацию о моделях.
                         Ключи словаря - имена моделей, значения - словари, содержащие id модели и параметры по умолчанию.

    Как работает функция:
    1.  Проходит по каждой модели в словаре `models`.
    2.  Извлекает параметры по умолчанию для каждой модели с помощью функции `params_to_default_params`.
    3.  Создает новый словарь, содержащий id модели и параметры по умолчанию.
    4.  Возвращает словарь, содержащий преобразованную информацию о моделях.

    Внутри функции происходят следующие действия и преобразования:
     A.  Итерация по моделям в словаре `models`.
     |
     -- B. Извлечение параметров по умолчанию с помощью `params_to_default_params`.
     |
     C.  Создание нового словаря с id модели и параметрами по умолчанию.
     |
     D.  Возврат преобразованного словаря.

    Примеры:
        >>> models = {'model1': {'id': 'id1', 'parameters': {'param1': {'value': 'value1'}}}, 'model2': {'id': 'id2', 'parameters': {'param2': {'value': 'value2'}}}}
        >>> convert_model_info(models)
        {'model1': {'id': 'id1', 'default_params': {'param1': 'value1'}}, 'model2': {'id': 'id2', 'default_params': {'param2': 'value2'}}}
    """
```

### `params_to_default_params`

```python
def params_to_default_params(parameters: dict[str, Any]):
    """
    Извлекает параметры по умолчанию из словаря параметров модели.

    Args:
        parameters (dict[str, Any]): Словарь, содержащий параметры модели.

    Returns:
        dict[str, Any]: Словарь, содержащий параметры по умолчанию.
                         Ключи словаря - имена параметров, значения - значения параметров по умолчанию.

    Как работает функция:
    1.  Создает пустой словарь `defaults` для хранения параметров по умолчанию.
    2.  Проходит по каждому параметру в словаре `parameters`.
    3.  Если имя параметра равно "maximumLength", переименовывает его в "maxTokens".
    4.  Добавляет значение параметра по умолчанию в словарь `defaults`.
    5.  Возвращает словарь `defaults`.

    Внутри функции происходят следующие действия и преобразования:
     A.  Создание пустого словаря `defaults`.
     |
     -- B. Итерация по параметрам в словаре `parameters`.
     |
     C.  Переименование параметра "maximumLength" в "maxTokens".
     |
     D.  Добавление значения параметра по умолчанию в словарь `defaults`.
     |
     E.  Возврат словаря `defaults`.

    Примеры:
        >>> parameters = {'param1': {'value': 'value1'}, 'maximumLength': {'value': 100}}
        >>> params_to_default_params(parameters)
        {'param1': 'value1', 'maxTokens': 100}
    """
```

### `get_model_names`

```python
def get_model_names(model_info: dict[str, Any]):
    """
    Извлекает список имен моделей из словаря с информацией о моделях.

    Args:
        model_info (dict[str, Any]): Словарь, содержащий информацию о моделях.
                                      Ключи словаря - имена моделей, значения - словари, содержащие id модели и параметры по умолчанию.

    Returns:
        list[str]: Список имен моделей, отсортированный в алфавитном порядке.
                   Исключает модели "openai:gpt-4" и "openai:gpt-3.5-turbo".

    Как работает функция:
    1.  Извлекает имена моделей из ключей словаря `model_info`.
    2.  Исключает модели "openai:gpt-4" и "openai:gpt-3.5-turbo" из списка.
    3.  Сортирует список имен моделей в алфавитном порядке.
    4.  Возвращает отсортированный список имен моделей.

    Внутри функции происходят следующие действия и преобразования:
     A.  Извлечение имен моделей из ключей словаря `model_info`.
     |
     -- B. Исключение моделей "openai:gpt-4" и "openai:gpt-3.5-turbo".
     |
     C.  Сортировка списка имен моделей.
     |
     D.  Возврат отсортированного списка.

    Примеры:
        >>> model_info = {'model1': {'id': 'id1', 'default_params': {'param1': 'value1'}}, 'openai:gpt-4': {'id': 'id2', 'default_params': {'param2': 'value2'}}, 'model2': {'id': 'id3', 'default_params': {'param3': 'value3'}}}
        >>> get_model_names(model_info)
        ['model1', 'model2']
    """
```

### `print_providers`

```python
def print_providers(model_names: list[str]):
    """
    Генерирует Python-код для определения моделей и связывания их с провайдером Vercel.

    Args:
        model_names (list[str]): Список имен моделей.

    Как работает функция:
    1.  Проходит по каждому имени модели в списке `model_names`.
    2.  Разделяет имя модели на части, используя символы ":" и "/".
    3.  Извлекает базового провайдера из первой части имени.
    4.  Преобразует имя модели в имя переменной, заменяя символы "-" и "." на "_".
    5.  Генерирует строку Python-кода, которая определяет модель и связывает ее с провайдером Vercel.
    6.  Выводит сгенерированную строку кода в консоль.

    Внутри функции происходят следующие действия и преобразования:
     A.  Итерация по именам моделей в списке `model_names`.
     |
     -- B. Разделение имени модели на части.
     |
     C.  Извлечение базового провайдера.
     |
     D.  Преобразование имени модели в имя переменной.
     |
     E.  Генерация строки Python-кода.
     |
     F.  Вывод строки кода в консоль.

    Примеры:
        >>> model_names = ['model1', 'provider:model2']
        >>> print_providers(model_names)
        model1 = Model(name="model1", base_provider="model1", best_provider=Vercel,)
        model2 = Model(name="provider:model2", base_provider="provider", best_provider=Vercel,)
    """
```

### `print_convert`

```python
def print_convert(model_names: list[str]):
    """
    Генерирует Python-код для создания словаря, связывающего ключи моделей с переменными, представляющими модели.

    Args:
        model_names (list[str]): Список имен моделей.

    Как работает функция:
    1.  Проходит по каждому имени модели в списке `model_names`.
    2.  Разделяет имя модели на части, используя символы ":" и "/".
    3.  Извлекает ключ модели из последней части имени.
    4.  Преобразует имя модели в имя переменной, заменяя символы "-" и "." на "_".
    5.  Генерирует строку Python-кода, которая создает элемент словаря, связывающий ключ модели с переменной.
    6.  Выводит сгенерированную строку кода в консоль.

    Внутри функции происходят следующие действия и преобразования:
     A.  Итерация по именам моделей в списке `model_names`.
     |
     -- B. Разделение имени модели на части.
     |
     C.  Извлечение ключа модели.
     |
     D.  Преобразование имени модели в имя переменной.
     |
     E.  Генерация строки Python-кода.
     |
     F.  Вывод строки кода в консоль.

    Примеры:
        >>> model_names = ['model1', 'provider:model2']
        >>> print_convert(model_names)
                "model1": model1,
                "model2": model2,
    """
```

### `main`

```python
def main():
    """
    Основная функция модуля.

    Как работает функция:
    1.  Получает информацию о моделях с помощью функции `get_model_info`.
    2.  Преобразует информацию о моделях с помощью функции `convert_model_info`.
    3.  Выводит преобразованную информацию о моделях в формате JSON.
    4.  Получает список имен моделей с помощью функции `get_model_names`.
    5.  Генерирует и выводит Python-код для определения моделей с помощью функции `print_providers`.
    6.  Генерирует и выводит Python-код для создания словаря моделей с помощью функции `print_convert`.

    Внутри функции происходят следующие действия и преобразования:
     A.  Получение информации о моделях.
     |
     -- B. Преобразование информации о моделях.
     |
     C.  Вывод информации о моделях в формате JSON.
     |
     D.  Получение списка имен моделей.
     |
     E.  Генерация и вывод Python-кода для определения моделей.
     |
     F.  Генерация и вывод Python-кода для создания словаря моделей.
    """
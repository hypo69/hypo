# Миграция: Добавление колонки `payment_id`

## Обзор

Данный файл миграции Alembic добавляет колонку `payment_id` в таблицу `purchases`. Миграция также включает создание уникального ограничения на эту колонку. Если колонка уже существует, миграция пропускает ее добавление. При откате миграция удаляет колонку и уникальное ограничение, если они существуют.

## Содержание

- [Обзор](#обзор)
- [Функции](#функции)
  - [`upgrade`](#upgrade)
  - [`downgrade`](#downgrade)

## Функции

### `upgrade`

**Описание**: Добавляет колонку `payment_id` в таблицу `purchases` и устанавливает уникальное ограничение.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- Нет

**Детали реализации**:
- Функция получает соединение с базой данных с помощью `op.get_bind()`.
- Использует `PRAGMA table_info` для проверки существования колонки `payment_id` в таблице `purchases`.
- Если колонки не существует, добавляет ее с типом `String` и устанавливает ограничение уникальности.
- Если колонка уже существует, выводит сообщение в консоль и пропускает добавление.

### `downgrade`

**Описание**: Удаляет колонку `payment_id` из таблицы `purchases` и отменяет уникальное ограничение.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- Нет

**Детали реализации**:
- Функция получает соединение с базой данных с помощью `op.get_bind()`.
- Использует `PRAGMA table_info` для проверки существования колонки `payment_id` в таблице `purchases`.
- Если колонка существует, удаляет ее и связанное с ней ограничение уникальности.
- Если колонка не существует, выводит сообщение в консоль и пропускает удаление.
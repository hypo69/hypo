# Модуль для автоматического обновления и выбора прокси-серверов
## Обзор

Модуль предназначен для автоматического получения, тестирования и обновления списка рабочих прокси-серверов. Это позволяет использовать их для обхода ограничений и обеспечения анонимности при работе с различными сервисами, такими как GPT.

## Подробней
Этот модуль решает задачу автоматического поиска и поддержания актуального списка рабочих прокси-серверов, что критически важно для приложений, требующих обхода географических или иных ограничений.
Он периодически получает список прокси-серверов, проверяет их работоспособность и сохраняет рабочие прокси для дальнейшего использования. Это обеспечивает непрерывный доступ к прокси-серверам и повышает надежность работы приложений, зависящих от них.

## Функции

### `fetch_proxies`

```python
def fetch_proxies() -> list:
    """
    Получает список прокси-серверов с сайта proxyscrape.com.

    Returns:
        list: Список прокси-серверов в формате "IP:Port".
    """
```

**Назначение**: Получает список прокси-серверов с сайта proxyscrape.com.

**Параметры**:
- Нет

**Возвращает**:
- `list`: Список прокси-серверов в формате "IP:Port".

**Как работает функция**:
1. Функция отправляет GET-запрос к API proxyscrape.com для получения списка прокси-серверов.
2. Если запрос успешен (код состояния 200), функция разделяет полученный текст на строки, удаляет последний элемент (который обычно является пустой строкой) и возвращает список прокси-серверов.
3. Если запрос не успешен, функция выводит сообщение об ошибке и возвращает пустой список.

**Примеры**:
```python
proxies = fetch_proxies()
if proxies:
    print(f"Получено {len(proxies)} прокси-серверов.")
else:
    print("Не удалось получить прокси-серверы.")
```

### `test_proxy`

```python
def test_proxy(proxy: str, prompt: str, timeout: int):
    """
    Проверяет работоспособность прокси-сервера с использованием заданного запроса и таймаута.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
        prompt (str): Тестовый запрос для проверки.
        timeout (int): Максимальное время в секундах, отведённое на проверку.
    """
```

**Назначение**: Проверяет работоспособность заданного прокси-сервера, отправляя тестовый запрос и измеряя время ответа.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".
- `prompt` (str): Тестовый запрос для проверки.
- `timeout` (int): Максимальное время в секундах, отведённое на проверку.

**Как работает функция**:
1. Функция измеряет время начала выполнения.
2.  <инструкция для модели gemini:Временно закомментирована строка `res = gpt3.Completion.create(prompt=prompt, proxy=proxy)`. Необходимо её раскомментировать и проверить работоспособность кода. Если прокси работает - переходим к следующему шагу, если нет - вызываем исключение>
3. Функция измеряет время окончания выполнения.
4. Вычисляет время ответа.
5. Если время ответа меньше заданного таймаута, функция выводит сообщение об успешной проверке и добавляет прокси-сервер в список рабочих прокси-серверов с помощью функции `add_working_proxy`.
6. В случае возникновения исключения, функция ничего не делает (`pass`).

**Примеры**:
```python
test_proxy("123.45.67.89:8080", "What is the capital of France?", 5)
```

### `add_working_proxy`

```python
def add_working_proxy(proxy: str):
    """
    Добавляет рабочий прокси-сервер в глобальный список working_proxies.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Добавляет рабочий прокси-сервер в глобальный список `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:
1. Функция добавляет переданный прокси-сервер в глобальный список `working_proxies`.

**Примеры**:
```python
add_working_proxy("123.45.67.89:8080")
```

### `remove_proxy`

```python
def remove_proxy(proxy: str):
    """
    Удаляет прокси-сервер из глобального списка working_proxies.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Удаляет прокси-сервер из глобального списка `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:
1. Функция проверяет, присутствует ли переданный прокси-сервер в глобальном списке `working_proxies`.
2. Если прокси-сервер присутствует, функция удаляет его из списка.

**Примеры**:
```python
remove_proxy("123.45.67.89:8080")
```

### `get_working_proxies`

```python
def get_working_proxies(prompt: str, timeout: int = 5):
    """
    Получает и тестирует прокси-серверы, добавляя рабочие прокси в глобальный список working_proxies.

    Args:
        prompt (str): Тестовый запрос для проверки.
        timeout (int, optional): Максимальное время в секундах, отведённое на проверку. По умолчанию 5.
    """
```

**Назначение**: Получает список прокси-серверов, тестирует их работоспособность и добавляет рабочие прокси в глобальный список `working_proxies`.

**Параметры**:
- `prompt` (str): Тестовый запрос для проверки.
- `timeout` (int, optional): Максимальное время в секундах, отведённое на проверку. По умолчанию 5.

**Как работает функция**:
1. Функция получает список прокси-серверов с помощью функции `fetch_proxies`.
2. Для каждого прокси-сервера функция создает новый поток, который выполняет функцию `test_proxy` для проверки работоспособности прокси-сервера.
3. Функция запускает все потоки.
4. Функция ожидает завершения каждого потока в течение заданного таймаута.

**Примеры**:
```python
get_working_proxies("What is the capital of France?", 5)
```

### `update_working_proxies`

```python
def update_working_proxies():
    """
    Непрерывно обновляет глобальный список working_proxies рабочими прокси-серверами.
    """
```

**Назначение**: Непрерывно обновляет глобальный список `working_proxies` рабочими прокси-серверами.

**Как работает функция**:
1. Функция устанавливает тестовый запрос для проверки прокси-серверов.
2. В бесконечном цикле:
    - Функция очищает глобальный список `working_proxies`.
    - Функция получает и тестирует прокси-серверы с помощью функции `get_working_proxies`.
    - Функция выводит сообщение об обновлении прокси-серверов.
    - Функция ждет 1800 секунд (30 минут).

**Примеры**:
```python
# Запуск в отдельном потоке
import threading
thread = threading.Thread(target=update_working_proxies)
thread.start()
```

### `get_random_proxy`

```python
def get_random_proxy() -> str:
    """
    Получает случайный рабочий прокси-сервер из глобального списка working_proxies.

    Returns:
        str: Случайный рабочий прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Получает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

**Возвращает**:
- `str`: Случайный рабочий прокси-сервер в формате "IP:Port".

**Как работает функция**:
1. Функция возвращает случайный элемент из глобального списка `working_proxies` с помощью функции `random.choice`.

**Примеры**:
```python
proxy = get_random_proxy()
if proxy:
    print(f"Случайный прокси-сервер: {proxy}")
else:
    print("Нет доступных прокси-серверов.")
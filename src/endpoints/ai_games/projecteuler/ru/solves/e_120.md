## Ответ на Задачу No 120: Остаток от деления (Square Remainders)

### 1. Анализ задачи и решение
**Понимание задачи:**
* Нам нужно найти остаток от деления `(a-1)^n + (a+1)^n` на `a^2` для различных значений `n`.
* Для каждого `a` от 3 до 1000 нужно найти максимальный остаток (`r_max`) при изменении `n`.
* Необходимо просуммировать все `r_max` для каждого `a` в заданном диапазоне.

**Решение:**
1. **Анализ остатка:**
   - Разложим `(a-1)^n` и `(a+1)^n` по биному Ньютона.
   - `(a-1)^n = a^n - n*a^(n-1) + (n*(n-1)/2)*a^(n-2) - ... + (-1)^n`
   - `(a+1)^n = a^n + n*a^(n-1) + (n*(n-1)/2)*a^(n-2) + ... + 1`
   - При сложении `(a-1)^n + (a+1)^n`, все члены с нечетными степенями `a` сократятся.
   - Останется `2 * (a^n + (n*(n-1)/2)*a^(n-2) + ... + 1)` или `2 * (1 + C(n,2)a^2 + C(n,4)a^4 ...)`
   - Если рассматривать только два первых слагаемых, то  `(a-1)^n + (a+1)^n = 2*Sum(C(n, 2k)*a^(2k))` 
   - Остаток от деления на `a^2` будет зависеть от  `2 * (1 + C(n, 2)*a^2 + ...) mod a^2`
   - При n = 1 , остаток  `(a-1)^1 + (a+1)^1 = 2a`, остаток `2a % a^2 = 2a`
   - При n = 2, остаток `(a-1)^2 + (a+1)^2 = a^2 -2a+1 + a^2+2a+1 = 2a^2 + 2`, остаток `2 % a^2 = 2`
   - При n = 3, остаток `(a-1)^3 + (a+1)^3 = a^3 - 3a^2 + 3a -1 + a^3 + 3a^2 + 3a +1 = 2a^3 + 6a = 2a(a^2 + 3)` остаток `6a % a^2 = 6a`
   - При n = 4, остаток `(a-1)^4 + (a+1)^4 = a^4 - 4a^3 + 6a^2 - 4a + 1 + a^4 + 4a^3 + 6a^2 + 4a + 1 = 2a^4 + 12a^2 + 2`, остаток 2.
   - При n = 5, остаток `(a-1)^5 + (a+1)^5 = a^5 - 5a^4 + 10a^3 - 10a^2 + 5a -1 + a^5 + 5a^4 + 10a^3 + 10a^2 + 5a +1 = 2a^5 + 20a^3 + 10a` остаток  `10a`.
   - Можно предположить, что максимальный остаток будет при  n = 1, где остаток равен `2a`, или при n=3, где остаток `6a`. При дальнейших значения n остатки уменьшаются или остаются 2. 
   - Максимальный остаток, получается при n = 1 или n = 3. r = max(2a, 2*n*a)
2. **Нахождение r_max:**
   - Вычисляем остаток `r` для `n = 1` и `n = 3`.
   - Находим максимальный `r` для каждого `a`.
3. **Суммирование:**
   - Суммируем все `r_max` для всех `a` в диапазоне [3, 1000].

### 2. Алгоритм решения
1. Начать
2. Инициализировать `total_sum` = 0
3. Для каждого `a` от 3 до 1000
   *  Вычислить `r1 = 2 * a % (a*a)`
   *  Вычислить `r2 = (a-1)^3 + (a+1)^3` = `2 * (a^3 + 3*a)`
   *  Вычислить `r2 = (2 * (a*a*a + 3*a) ) % (a*a)`
   *  Вычислить `r2 = 6 * a % (a*a)`
   *  Вычислить `r_max = max(r1, r2)`
   *  `total_sum` = `total_sum` + `r_max`
4. Вывести `total_sum`
5. Конец

### 3. Реализация на Python 3.12
```python
def calculate_max_remainder_sum(limit):
    """
    Calculates the sum of maximum remainders for the given range of a.

    Args:
        limit: The upper bound for a (exclusive).

    Returns:
        The sum of maximum remainders.
    """

    total_sum = 0
    for a in range(3, limit + 1):
      r1 = 2 * a % (a*a)
      r2 = 6 * a % (a*a)
      r_max = max(r1,r2)
      total_sum += r_max
    return total_sum

# Example Usage
result = calculate_max_remainder_sum(1000)
print(result)
```

### 4. Блок-схема в формате mermaid
```mermaid
flowchart TD
    Start((Начало)) --> InitializeTotalSum((Инициализировать total_sum = 0))
    InitializeTotalSum --> LoopStart((Начать цикл: a от 3 до 1000))
    LoopStart --> CalculateR1((Вычислить r1 = (2 * a) mod (a*a)))
    CalculateR1 --> CalculateR2((Вычислить r2 = (6 * a) mod (a*a)))
    CalculateR2 --> CalculateRMax((Вычислить r_max = max(r1, r2)))
    CalculateRMax --> AddRMaxToSum((total_sum = total_sum + r_max))
    AddRMaxToSum --> LoopStart
    LoopStart --> OutputTotalSum((Вывести total_sum))
    OutputTotalSum --> End((Конец))
```

**Легенда:**
*   **Начало, Конец:** Начало и конец алгоритма.
*   **Инициализировать total\_sum:** Создаем переменную для хранения результата и присваиваем ей значение 0.
*   **Начать цикл:** Начало цикла перебора чисел от 3 до 1000.
*   **Вычислить r1:** Вычисляем остаток `r1` при `n=1`.
*   **Вычислить r2:** Вычисляем остаток `r2` при `n=3`.
*   **Вычислить r_max:** Находим максимальный остаток из `r1` и `r2`.
*   **total\_sum = total\_sum + r\_max:** Добавляем максимальный остаток к общей сумме.
*   **Вывести total\_sum:** Выводим результат.

# Модуль `tinytroupe.utils`

## Обзор

Этот модуль предоставляет общие утилиты и вспомогательные функции для работы с TinyTroupe.  Включает в себя функции для работы с входными данными моделей, обработкой выходных данных, управлением моделями, валидацией, генерацией запросов, рендерингом и другими вспомогательными задачами.

## Функции

### `compose_initial_LLM_messages_with_templates`

**Описание**: Создаёт начальные сообщения для вызова модели LLM, предполагая, что они всегда включают систему (общее описание задачи) и необязательное пользовательское сообщение (конкретное описание задачи). Эти сообщения создаются с использованием указанных шаблонов и параметров рендеринга.

**Параметры**:
- `system_template_name` (str): Имя шаблона для системного сообщения.
- `user_template_name` (Optional[str], optional): Имя шаблона для пользовательского сообщения. По умолчанию `None`.
- `rendering_configs` (dict, optional): Словарь с параметрами для рендеринга шаблонов. По умолчанию `{}`.

**Возвращает**:
- `list`: Список словарей, представляющих сообщения для LLM. Каждый словарь имеет ключи `"role"` (значение `"system"` или `"user"`) и `"content"` (содержимое сообщения).

### `extract_json`

**Описание**: Извлекает JSON-объект из строки, игнорируя текст до первой открывающей фигурной скобки и теги Markdown (```json``` и ```).

**Параметры**:
- `text` (str): Строка, содержащая JSON-объект.

**Возвращает**:
- `dict`: Извлечённый JSON-объект в формате словаря. Возвращает пустой словарь (`{}`), если JSON не найден или произошла ошибка.


### `extract_code_block`

**Описание**: Извлекает блок кода из строки, игнорируя текст до первого и после последнего тройных обратных кавычек (```).

**Параметры**:
- `text` (str): Строка, содержащая блок кода.

**Возвращает**:
- `str`: Извлеченный блок кода. Возвращает пустую строку (`""`), если блок кода не найден или произошла ошибка.


### `repeat_on_error`

**Описание**: Декоратор, который повторяет вызов указанной функции, если возникает одно из указанных исключений, до заданного количества попыток. Если попыток превышено, исключение передается вверх.

**Параметры**:
- `retries` (int): Максимальное количество попыток повтора.
- `exceptions` (list): Список типов исключений, при возникновении которых происходит повторная попытка.

**Возвращает**:
- Декорированная функция.

**Вызывает исключения**:
- Любые исключения из списка `exceptions`, если попытки повтора исчерпаны.


### `check_valid_fields`

**Описание**: Проверяет, являются ли поля в указанном словаре допустимыми, согласно списку допустимых полей. Если нет, генерирует исключение `ValueError`.

**Параметры**:
- `obj` (dict): Словарь, в котором проверяются поля.
- `valid_fields` (list): Список допустимых полей.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `ValueError`: Если в словаре найдено недопустимое поле.


### `sanitize_raw_string`

**Описание**: Санітизує задану строку, видаляючи будь-які недопустимі символи та перевіряючи, щоб вона не перевищувала максимальної довжини рядка Python.

**Параметры**:
- `value` (str): Строка, яку потрібно санітизувати.

**Возвращает**:
- `str`: Санітизована строка.


### `sanitize_dict`

**Описание**: Санітизує заданий словник, видаляючи будь-які недопустимі символи та перевіряючи, щоб гніздування словника не було занадто глибоким.

**Параметры**:
- `value` (dict): Словник, який потрібно санітизувати.

**Возвращает**:
- `dict`: Санітизований словник.


### `add_rai_template_variables_if_enabled`

**Описание**: Додає змінні шаблону RAI до вказаного словника, якщо прапори RAI включені. Ці змінні завантажують повідомлення RAI з відповідних файлів у каталозі "шаблонів".

**Параметры**:
- `template_variables` (dict): Словник, до якого додаються змінні RAI.

**Возвращает**:
- `dict`: Оновлений словник змінних шаблонів.


### `inject_html_css_style_prefix`

**Описание**: Вставляє префікс стилю до всіх атрибутів стилю в даній HTML-рядку.

**Параметры**:
- `html` (str): HTML-рядок, до якого вставляється префікс стилю.
- `style_prefix_attributes` (str): Префікс стилю.


**Возвращает**:
- `str`: HTML-рядок зі вставленим префіксом стилю.

### `break_text_at_length`

**Описание**: Розбиває текст (або JSON) на вказану довжину, вставляючи рядок "(...)" у точці розриву. Якщо максимальна довжина дорівнює `None`, вміст повертається як є.


**Параметры**:
- `text` (Union[str, dict]): Текст або JSON, який потрібно розбити.
- `max_length` (int, optional): Максимальна довжина. По умолчанию `None`.

**Возвращает**:
- `str`: Розбитий текст.


### `pretty_datetime`

**Описание**: Повертає красиве представлення заданого об'єкта `datetime`.

**Параметры**:
- `dt` (datetime): Об'єкт `datetime`.

**Возвращает**:
- `str`: Строкове представлення об'єкта `datetime`.


### `dedent`

**Описание**: Видаляє відступи з заданого тексту.

**Параметры**:
- `text` (str): Текст, з якого потрібно видалити відступи.

**Возвращает**:
- `str`: Текст без відступів.


### `read_config_file`

**Описание**: Читає конфігураційний файл `config.ini` з поточного каталогу та каталогу модуля, переважно з кешу.

**Параметры**:
- `use_cache` (bool): Чи використовувати кеш конфігурації.
- `verbose` (bool): Виводити додаткову інформацію.

**Возвращает**:
- `configparser.ConfigParser`: Об'єкт конфігурації.


### `pretty_print_config`

**Описание**: Виводить конфігурацію у читабельному форматі.


**Параметры**:
- `config` (configparser.ConfigParser): Об'єкт конфігурації.

**Возвращает**:
- `None`


### `start_logger`

**Описание**: Ініціалізує логер TinyTroupe, використовуючи налаштування з конфігураційного файлу.

**Параметры**:
- `config` (configparser.ConfigParser): Об'єкт конфігурації.


**Возвращает**:
- `None`


### `JsonSerializableRegistry`

**Описание**: Клас з методами для серіалізації/десеріалізації об'єкта в JSON. Підтримує реєстрацію підкласів.

**Методы**:
- `to_json`: Повертає JSON представлення об'єкта.
- `from_json`: Завантажує JSON представлення об'єкта та створює екземпляр класу.
- `__init_subclass__`: Реєструє підклас у `class_mapping`. Автоматично розширює атрибути серіалізації та налаштування ініціалізації з батьківських класів.
- `_post_deserialization_init`: Метод для виконання пост-ініціалізації після десеріалізації.


### `post_init`

**Описание**: Декоратор, що вимагає виклику методу `_post_init` після ініціалізації класу.


### `name_or_empty`

**Описание**: Повертає ім'я агента або навколишнього середовища, або порожню строку, якщо агент дорівнює `None`.

**Параметры**:
- `named_entity` (AgentOrWorld): Агент або навколишнє середовище.

**Возвращает**:
- `str`: Ім'я агента або порожня строка.


### `custom_hash`

**Описание**: Повертає хеш вказаного об'єкта, використовуючи SHA256 хеш. Об'єкт спочатку перетвориться на рядок, щоб зробити його хешувальним.


**Параметры**:
- `obj`: Об'єкт для хешування.

**Возвращает**:
- `str`: Хеш об'єкта.


### `fresh_id`

**Описание**: Повертає нове унікальне ціле число.

**Возвращает**:
- `int`: Нове унікальне ціле число.
# Модуль `product.py`

## Обзор

Модуль `product.py` предоставляет графический интерфейс для редактирования информации о продуктах, получаемых с AliExpress. Он включает в себя функциональность открытия JSON-файлов с данными о продуктах, отображения этих данных в удобном для пользователя виде, а также подготовки продуктов к дальнейшей обработке, например, для загрузки в систему управления кампаниями.

## Подробней

Этот модуль является частью GUI приложения `hypotez` и предназначен для работы с данными о товарах с AliExpress. Он позволяет открывать JSON файлы, отображать основные данные о товаре (например, заголовок и детали), а также запускать процесс подготовки товара с использованием класса `AliCampaignEditor`.

## Классы

### `ProductEditor`

**Описание**:
Класс `ProductEditor` представляет собой виджет (QWidget) для редактирования информации о продуктах. Он включает в себя кнопки для открытия файлов, отображения имени выбранного файла, подготовки продукта и виджеты для отображения деталей продукта.

**Как работает класс**:
1.  При инициализации класса создается пользовательский интерфейс с кнопками и метками.
2.  Метод `open_file` открывает диалоговое окно выбора файла, позволяя пользователю выбрать JSON файл с данными о продукте.
3.  Метод `load_file` загружает выбранный JSON файл, отображает имя файла в метке и создает виджеты для отображения данных продукта.
4.  Метод `create_widgets` создает и добавляет виджеты для отображения заголовка и деталей продукта.
5.  Метод `prepare_product_async` асинхронно подготавливает продукт с использованием класса `AliCampaignEditor`.

**Атрибуты**:

*   `data` (SimpleNamespace): Пространство имен для хранения данных о продукте.
*   `language` (str): Язык интерфейса (по умолчанию 'EN').
*   `currency` (str): Валюта (по умолчанию 'USD').
*   `file_path` (str): Путь к загруженному файлу.
*   `editor` (AliCampaignEditor): Экземпляр класса `AliCampaignEditor` для подготовки продукта.
*   `main_app`: Ссылка на главный экземпляр приложения.
*   `open_button` (QtWidgets.QPushButton): Кнопка для открытия файла.
*   `file_name_label` (QtWidgets.QLabel): Метка для отображения имени файла.
*   `prepare_button` (QtWidgets.QPushButton): Кнопка для подготовки продукта.

**Методы**:

*   `__init__(self, parent=None, main_app=None)`: Инициализирует виджет `ProductEditor`.
*   `setup_ui(self)`: Создает пользовательский интерфейс.
*   `setup_connections(self)`: Устанавливает связи между сигналами и слотами (в данном случае не используется).
*   `open_file(self)`: Открывает диалоговое окно для выбора JSON файла.
*   `load_file(self, file_path)`: Загружает JSON файл и отображает данные.
*   `create_widgets(self, data)`: Создает виджеты для отображения данных продукта.
*   `prepare_product_async(self)`: Асинхронно подготавливает продукт.

## Функции

### `__init__`

```python
def __init__(self, parent=None, main_app=None):
    """ Initialize the ProductEditor widget """
```

**Описание**:
Инициализирует виджет `ProductEditor`, устанавливает ссылку на главный экземпляр приложения, настраивает пользовательский интерфейс и устанавливает соединения между сигналами и слотами.

**Как работает функция**:
1.  Вызывает конструктор родительского класса `QtWidgets.QWidget`.
2.  Сохраняет ссылку на главный экземпляр приложения в атрибуте `self.main_app`.
3.  Вызывает метод `setup_ui` для настройки пользовательского интерфейса.
4.  Вызывает метод `setup_connections` для установки соединений между сигналами и слотами.

**Параметры**:

*   `parent` (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию `None`.
*   `main_app`: Ссылка на главный экземпляр приложения.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

**Примеры**:

```python
product_editor = ProductEditor(main_app=main_app_instance)
```

### `setup_ui`

```python
def setup_ui(self):
    """ Setup the user interface """
```

**Описание**:
Настраивает пользовательский интерфейс виджета `ProductEditor`, включая создание кнопок, меток и размещение их на форме.

**Как работает функция**:
1.  Устанавливает заголовок окна как "Product Editor".
2.  Устанавливает размеры окна как 1800x800 пикселей.
3.  Создает кнопку "Open JSON File" и устанавливает соединение с методом `open_file`.
4.  Создает метку "No file selected" для отображения имени выбранного файла.
5.  Создает кнопку "Prepare Product" и устанавливает соединение с методом `prepare_product_async`.
6.  Создает вертикальный макет (QVBoxLayout) и добавляет в него созданные кнопки и метку.
7.  Устанавливает созданный макет в качестве макета для виджета.

**Параметры**:

*   `None`

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

**Примеры**:

```python
product_editor.setup_ui()
```

### `setup_connections`

```python
def setup_connections(self):
    """ Setup signal-slot connections """
```

**Описание**:
Устанавливает связи между сигналами и слотами.

**Как работает функция**:
Функция в текущей реализации пуста и не выполняет никаких действий.

**Параметры**:

*   `None`

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

**Примеры**:

```python
product_editor.setup_connections()
```

### `open_file`

```python
def open_file(self):
    """ Open a file dialog to select and load a JSON file """
```

**Описание**:
Открывает диалоговое окно выбора файла, позволяя пользователю выбрать JSON файл с данными о продукте.

**Как работает функция**:
1.  Вызывает метод `QtWidgets.QFileDialog.getOpenFileName` для открытия диалогового окна выбора файла.
2.  Если файл не выбран, функция завершается.
3.  Вызывает метод `load_file` для загрузки выбранного файла.

**Параметры**:

*   `None`

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

**Примеры**:

```python
product_editor.open_file()
```

### `load_file`

```python
def load_file(self, file_path):
    """ Load a JSON file """
```

**Описание**:
Загружает JSON файл, отображает имя файла в метке и создает виджеты для отображения данных продукта.

**Как работает функция**:
1.  Использует функцию `j_loads_ns` для загрузки JSON файла в пространство имен `self.data`.
2.  Сохраняет путь к файлу в атрибуте `self.file_path`.
3.  Отображает имя файла в метке `self.file_name_label`.
4.  Создает экземпляр класса `AliCampaignEditor`, передавая путь к файлу.
5.  Вызывает метод `create_widgets` для создания виджетов на основе загруженных данных.
6.  Обрабатывает исключения, отображая сообщение об ошибке в диалоговом окне.

**Параметры**:

*   `file_path` (str): Путь к JSON файлу.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `Exception as ex`: Если возникает ошибка при загрузке JSON файла.

**Примеры**:

```python
product_editor.load_file("path/to/product.json")
```

### `create_widgets`

```python
def create_widgets(self, data):
    """ Create widgets based on the data loaded from the JSON file """
```

**Описание**:
Создает и добавляет виджеты для отображения данных продукта, таких как заголовок и детали.

**Как работает функция**:
1.  Получает макет (layout) виджета.
2.  Удаляет все предыдущие виджеты из макета, кроме кнопок открытия и подготовки файла, а также метки имени файла.
3.  Создает метку для отображения заголовка продукта.
4.  Добавляет метку заголовка в макет.
5.  Создает метку для отображения деталей продукта.
6.  Добавляет метку деталей продукта в макет.

**Параметры**:

*   `data` (SimpleNamespace): Пространство имен с данными о продукте.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

**Примеры**:

```python
product_editor.create_widgets(self.data)
```

### `prepare_product_async`

```python
@asyncSlot()
async def prepare_product_async(self):
    """ Asynchronously prepare the product """
```

**Описание**:
Асинхронно подготавливает продукт, используя экземпляр класса `AliCampaignEditor`.

**Как работает функция**:
1.  Проверяет, существует ли экземпляр `self.editor` класса `AliCampaignEditor`.
2.  Вызывает асинхронный метод `prepare_product` экземпляра `AliCampaignEditor`.
3.  Отображает сообщение об успешной подготовке продукта в диалоговом окне.
4.  Обрабатывает исключения, отображая сообщение об ошибке в диалоговом окне.

**Параметры**:

*   `None`

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `Exception as ex`: Если возникает ошибка при подготовке продукта.

**Примеры**:

```python
await product_editor.prepare_product_async()
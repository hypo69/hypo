# Модуль `src.ai.gemini.generative_ai`

## Обзор

Модуль `src.ai.gemini.generative_ai` предназначен для интеграции с Google Generative AI. Он обеспечивает взаимодействие с моделями Google AI, включая отправку запросов, получение ответов, а также сохранение истории диалогов в текстовые и JSON файлы.

## Оглавление

1. [Класс `GoogleGenerativeAI`](#класс-googlegenerativeai)
    - [Метод `__init__`](#метод-__init__)
    - [Свойство `config`](#свойство-config)
    - [Метод `_start_chat`](#метод-_start_chat)
    - [Метод `_save_dialogue`](#метод-_save_dialogue)
    - [Метод `ask`](#метод-ask)
    - [Метод `chat`](#метод-chat)
    - [Метод `describe_image`](#метод-describe_image)
    - [Метод `upload_file`](#метод-upload_file)

## Классы

### `GoogleGenerativeAI`

**Описание**: Класс для взаимодействия с моделями Google Generative AI.

**Атрибуты**:
- `MODELS` (List[str]): Список доступных моделей AI.
- `api_key` (str): Ключ API для доступа к генеративной модели.
- `model_name` (str): Название модели для использования.
- `generation_config` (Dict): Конфигурация для генерации.
- `mode` (str): Режим работы модели (например, 'debug' или 'production').
- `dialogue_log_path` (Optional[Path]): Путь для логирования диалогов.
- `dialogue_txt_path` (Optional[Path]): Путь для сохранения текстовых файлов диалогов.
- `history_dir` (Path): Директория для хранения истории.
- `history_txt_file` (Optional[Path]): Путь к файлу для хранения истории в формате текста.
- `history_json_file` (Optional[Path]): Путь к файлу для хранения истории в формате JSON.
- `model` (Optional[genai.GenerativeModel]): Объект модели Google Generative AI.
- `system_instruction` (Optional[str]): Инструкция для системы, которая задает параметры поведения модели.

#### Метод `__init__`

**Описание**: Инициализация модели `GoogleGenerativeAI` с дополнительными настройками.

**Параметры**:
- `api_key` (str): Ключ API для доступа к генеративной модели.
- `model_name` (Optional[str], optional): Название модели для использования. По умолчанию `"gemini-1.5-flash-8b"`.
- `generation_config` (Optional[Dict], optional): Конфигурация для генерации. По умолчанию `{"response_mime_type": "text/plain"}`.
- `system_instruction` (Optional[str], optional): Инструкция для системы. По умолчанию `None`.

#### Свойство `config`

**Описание**: Получает конфигурацию из файла настроек.

**Возвращает**:
- `SimpleNamespace`: Конфигурация модели.

#### Метод `_start_chat`

**Описание**: Запускает чат с моделью.

**Возвращает**:
- `genai.ChatSession`: Объект чат-сессии.

#### Метод `_save_dialogue`

**Описание**: Сохраняет диалог в текстовый и JSON файл с управлением размером файлов.

**Параметры**:
- `dialogue` (list): Список сообщений, представляющих диалог, который нужно сохранить.

#### Метод `ask`

**Описание**: Отправляет текстовый запрос модели и возвращает ответ.

**Параметры**:
- `q` (str): Вопрос, который будет отправлен модели.
- `attempts` (int, optional): Количество попыток для получения ответа. По умолчанию `15`.

**Возвращает**:
- `Optional[str]`: Ответ от модели или `None`, если ответ не был получен.

**Вызывает исключения**:
- `requests.exceptions.RequestException`: При возникновении сетевой ошибки.
- `GatewayTimeout`, `ServiceUnavailable`: При недоступности сервиса.
- `ResourceExhausted`: При превышении квоты.
- `DefaultCredentialsError`, `RefreshError`: При ошибке аутентификации.
- `ValueError`, `TypeError`: При некорректных входных данных.
- `InvalidArgument`, `RpcError`: При ошибке API.
- `Exception`: При возникновении неожиданной ошибки.

#### Метод `chat`

**Описание**: Отправляет сообщение в чат и возвращает ответ.

**Параметры**:
- `q` (str): Сообщение для отправки в чат.

**Возвращает**:
- `str`: Ответ от чат-модели.

**Вызывает исключения**:
- `Exception`: При возникновении ошибки в процессе чата.

#### Метод `describe_image`

**Описание**: Генерирует описание изображения.

**Параметры**:
- `image_path` (Path): Путь к изображению, которое нужно описать.

**Возвращает**:
- `Optional[str]`: Описание изображения или `None`, если произошла ошибка.

**Вызывает исключения**:
- `Exception`: При возникновении ошибки при описании изображения.

#### Метод `upload_file`

**Описание**: Загружает файл в модель.

**Параметры**:
- `file` (str | Path | IOBase): Путь к файлу или объект файла.
- `file_name` (Optional[str], optional): Имя файла. По умолчанию `None`.

**Возвращает**:
- `bool`: Результат загрузки файла.

**Вызывает исключения**:
- `Exception`: При возникновении ошибки в процессе загрузки файла.
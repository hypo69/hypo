Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот JavaScript-код реализует функциональность всплывающего окна расширения браузера, связанного с использованием XPath для поиска элементов на веб-странице. Он позволяет пользователю вводить XPath-выражения, задавать контекст поиска, выбирать целевой iframe и отправлять запросы на активную вкладку, чтобы получить результаты поиска. Код обрабатывает ответы, отображает результаты в таблицах и предоставляет средства навигации по страницам результатов.  Также реализованы функции для управления отображением различных секций в интерфейсе, а также отправка запросов на выполнение XPath.

Шаги выполнения
-------------------------
1. **Инициализация:** Код получает доступ к элементам DOM всплывающего окна, таким как поля ввода, чекбоксы, кнопки и таблицы.
2. **Обработка событий:** Различные элементы интерфейса (кнопки, поля ввода, чекбоксы) слушают события клика и изменения состояния (например, нажатие клавиши Enter).
3. **Формирование сообщения для активной вкладки:** При нажатии на кнопку "Выполнить" или при нажатии Enter в поле ввода XPath, код собирает информацию из полей интерфейса (XPath, параметры контекста, frameId).  Эта информация формируется в структурированном формате (в переменной `msg`) для отправки в активную вкладку.
4. **Отправка сообщения в активную вкладку:** Метод `sendToActiveTab` отправляет собранные данные в активную вкладку. Метод `sendToSpecifiedFrame` отправляет данные в указанный `frameId`.
5. **Обработка ответов от активной вкладки:**  Всплывающее окно подписывается на получение сообщений от активной вкладки, содержащие результаты поиска. Эти сообщения содержат результаты выполнения XPath (`resultedDetails`).
6. **Отображение результатов в таблицах:** Функция `showResultsInPopup` обрабатывает сообщения от активной вкладки и заполняет таблицы результатов поиска. Она использует функцию `fu.updateDetailsTable` для обновления содержимого таблиц.
7. **Обработка ошибок:** Если при отправке или получении сообщений возникает ошибка, код обрабатывает ее, отображая соответствующее сообщение об ошибке пользователю.
8. **Сохранение состояния:**  При закрытии всплывающего окна функция `collectPopupState` собирает текущее состояние интерфейса и сохраняет его при помощи `browser.runtime.sendMessage`.
9. **Восстановление состояния:** При открытии всплывающего окна функция `restorePopupState` восстанавливает сохраненное состояние интерфейса.

Пример использования
-------------------------
.. code-block:: javascript
    
    // Пример предполагает, что поля ввода и кнопки уже инициализированы
    document.getElementById('main-expression').value = '//a'; //Устанавливаем XPath
    document.getElementById('execute').click(); //Клик по кнопке 'Выполнить'

Этот код установит значение XPath в поле 'main-expression' и выполнит поиск, используя XPath '//a' в открытой вкладке браузера. Результаты будут отображены в таблице 'results-details'.
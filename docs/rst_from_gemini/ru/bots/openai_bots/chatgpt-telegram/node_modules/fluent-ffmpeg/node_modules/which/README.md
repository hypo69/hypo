```markdown
# which

This module is a wrapper around the `which` utility for finding executables in the PATH.  It emulates the behavior of the Unix `which` command.

## Purpose

The module searches for a specified executable within the user's PATH environment variable.  Critically, it does *not* cache the results; thus, it's suitable for situations where the PATH might change dynamically, eliminating the need for a `hash -r` equivalent.

## Usage

### Asynchronous (Recommended):

```javascript
const which = require('which');

which('node', (err, resolvedPath) => {
  if (err) {
    console.error('Error finding "node":', err);
    return; // Important: handle errors!
  }
  console.log('Node executable found at:', resolvedPath);
});
```

### Synchronous:

```javascript
const which = require('which');

try {
  const resolvedPath = which.sync('node');
  console.log('Node executable found at:', resolvedPath);
} catch (err) {
  console.error('Error finding "node":', err.message);
}
```

### Synchronous with `nothrow` option:

```javascript
const which = require('which');

const resolvedPath = which.sync('node', { nothrow: true });

if (resolvedPath) {
  console.log('Node executable found at:', resolvedPath);
} else {
  console.error('Node executable not found.');
}
```

### Customizing PATH and PATHEXT:

```javascript
const which = require('which');

which('node', { path: '/usr/local/bin', pathExt: '.exe' }, (err, resolvedPath) => {
  if (err) {
    console.error(err);
    return;
  }
  console.log('Found node at:', resolvedPath);
});
```

This allows you to search within a specific directory and potentially filter for different file extensions (like `.exe`).

## Command-Line Interface (CLI)

The module can be used from the command line in a way similar to the BSD `which(1)` command.  Exact usage may vary depending on the specific program's CLI configuration.

## Options

The `which` function accepts an optional second argument, an options object.

-   `path`:  A custom `PATH` string to use instead of the environment variable.
-   `pathExt`: A custom `PATHEXT` string to use instead of the environment variable.
-   `all`: If `true`, returns all executables matching the specified name; otherwise, only the first one found.  This results in an array of paths instead of a single string.

```javascript
// Example with all option:
const matches = which.sync('someprogram', { all: true });
if (matches.length > 0) {
  matches.forEach(match => console.log('Found at:', match));
} else {
  console.log('Not found.');
}
```

**Important Considerations:**

-   Error handling is crucial in asynchronous operations. Always check for errors using the `err` parameter returned by the callback.
-   Consider using the synchronous `nothrow` option with caution, since it may mask errors.  Prefer the asynchronous approach for more robust error handling.

This enhanced README provides a more complete and user-friendly explanation of the `which` module, including crucial error handling and examples for various use cases.
```
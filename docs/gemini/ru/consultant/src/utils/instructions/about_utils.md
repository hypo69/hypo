# Анализ кода модуля `about_utils.md`

**Качество кода**
8
- Плюсы
    - Документ содержит инструкции по работе с кодом, включая форматирование, обработку данных и рефакторинг.
    - Инструкция достаточно подробная и охватывает ключевые аспекты разработки.
- Минусы
    - Инструкция в формате markdown и не является исполняемым кодом Python.
    - Не хватает примеров кода для всех типов инструкций.
    - Нет явного указания на использование `Path` из `pathlib` для работы с путями файлов.
    - Отсутствует описание структуры модуля и назначения.

**Рекомендации по улучшению**

1.  **Преобразование в исполняемый код Python:** Инструкции необходимо перенести в исполняемый файл Python и оформить как docstring для модуля.
2.  **Добавление примеров кода:** Добавить примеры для всех типов инструкций, включая примеры импортов, функций и классов.
3.  **Использование `Path` из `pathlib`:** Рекомендовать использование `Path` из `pathlib` для работы с путями файлов.
4.  **Описание модуля:** Добавить подробное описание модуля и его назначения в docstring.
5.  **Уточнение обработки ошибок:** Более четко описать, как обрабатывать ошибки и использовать `logger.error`.
6.  **Примеры RST:** Добавить примеры документации RST для всех типов элементов (модуля, функций, классов, методов, переменных).
7.  **Документирование переменных:** Пояснить, как документировать переменные в формате RST.
8.  **Примеры `TODO`:** Включить примеры использования `TODO` для обозначения необходимых улучшений.
9.  **Соблюдение PEP 8:** Уточнить, что код должен соответствовать стандарту PEP 8.
10. **Явное описание `j_loads`, `j_loads_ns`, `j_dumps`:** Более четко описать, когда использовать или не использовать `j_loads`, `j_loads_ns` и `j_dumps`.

**Оптимизированный код**

```python
"""
Модуль: src.utils
=========================================================================================

Этот модуль предназначен для хранения инструкций по работе с кодом в проекте.

Инструкции включают в себя требования к форматированию кода, обработке данных, рефакторингу и улучшениям.

Пример использования
--------------------

Этот модуль не предназначен для прямого выполнения, а используется как руководство для разработчиков.
"""

import json
from pathlib import Path
from typing import Any, Dict, List

from src.logger.logger import logger


class CodeInstructions:
    """
    Класс для хранения и предоставления инструкций по работе с кодом.

    Этот класс содержит статические методы, которые предоставляют
    инструкции по различным аспектам кодирования.
    """

    @staticmethod
    def get_instructions() -> dict:
        """
        Возвращает словарь с инструкциями по кодированию.

        Returns:
            dict: Словарь с инструкциями.

        Example:
            >>> instructions = CodeInstructions.get_instructions()
            >>> print(instructions)
            {
                "output_language": "ru",
                "format_documentation": "Всегда используйте одинарные кавычки (`'`) в Python коде. ...",
                ...
            }
        """
        instructions = {
            "output_language": "ru",
            "format_documentation": "Всегда используйте одинарные кавычки (`'`) в Python коде. Например: `a = 'A1'`; `['a','b',..]`; `{'a':q,'b':'c'}`.\n"
            "Двойные только в операциях вывода. Например `print(\"Hello, world!\")`; `input(\"Name\")`; `logger.error(\"Error\")`",
            "save_comments": "Все существующие комментарии после `#` должны быть сохранены без изменений.\n"
            "Блоки кода, которые необходимо изменить, должны быть прокомментированы построчно с использованием символа `#`.",
            "data_processing": "Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load` для чтения файлов.\n"
            "Оставляйте любые `...` в коде без изменений как точки остановки.\n"
            "`logger` всегда импортируется из `sr.logger`. Example `from src.logger import logger`",
            "analyze_structure": "Проверьте и добавьте отсутствующие импорты в код.\n"
            "Приведите в соответствие имена функций, переменных и импортов с ранее обработанными файлами.",
            "refactoring_improvements": "Добавьте комментарии в формате RST ко всем функциям, методам и классам.\n"
            "Используйте `from src.logger.logger import logger` для логирования ошибок.\n"
            "Избегайте избыточного использования стандартных блоков `try-except`, предпочитая обработку ошибок с помощью `logger.error`.\n"
            "В комментариях избегайте слов 'получаем', 'делаем' и подобных. Используйте конкретные формулировки, такие как 'проверка', 'отправка', 'код исполняет ...'.",
            "final_code": "В конце ответа должен быть представлен полный код (исходный с улучшениями) в одном блоке, который можно скопировать и вставить для замены исходного кода.\n"
            "Все изменённые части кода должны быть прокомментированы построчно с использованием символа `#` в этом блоке.",
            "code_examples": "Включайте примеры документации RST и возможные улучшения в формате `TODO`.",
            "additional_instruction": "Описание модуля в начале файла.\n"
            "Документацию для каждой функции, метода и переменной.\n"
            "Соблюдение стандартов оформления docstring в Python (для Sphinx).\n"
            "В комментариях после `#` строки должны содержать подробное объяснение следующего за ними блока кода.",
            "module_description_example": """
                Пример формата документации для модуля:
                ```python
                 \"\"\"
                 Модуль для работы ассистента программиста
                 =========================================================================================

                 Этот модуль содержит класс :class:`CodeAssistant`, который используется для работы с различными моделями ИИ,
                 такими как Google Gemini и OpenAI, для выполнения задач по обработке кода.

                 Пример использования
                 --------------------

                 Пример использования класса `CodeAssistant`:

                 .. code-block:: python

                     assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
                     assistant.process_files()
                 \"\"\"
                ```
            """,
            "function_description_example_1": """
                Пример формата документации для функций:
                   Пример 1.
                ```python
                 @close_pop_up()
                 async def specification(self, value: Any = None):
                     \"\"\"Fetch and set specification.

                     Args:
                         value (Any): это значение можно передать в словаре kwargs через ключ {specification = `value`} при определении класса.
                         Если `value` был передан, его значение подставляется в поле `ProductFields.specification`.
                     \"\"\"
                     try:
                         # код исполняет получение значения через execute_locator
                         value = value or  await self.driver.execute_locator(self.locator.specification) or ''
                     except Exception as ex:
                         logger.error('Ошибка получения значения в поле `specification`', ex)
                         ...
                         return

                     # Проверка валидности результата
                     if not value:
                         logger.debug(f'Невалидный результат {value=}\\nлокатор {self.locator.specification}')
                         ...
                         return

                     # Если значение - список, код преобразовывает его в строку с разделителем `\\n`
                     if isinstance(value, list):
                         value = '\\n'.join(map(str, value))

                     # Код записывает результат в поле `specification` объекта `ProductFields`
                     self.fields.specification = value
                     return True

                 ```
            """,
            "function_description_example_2": """
               Пример 2.
                ```python
                async def save_text_file(
                    file_path: str | Path,
                    data: str | list[str] | dict,
                    mode: str = 'w'
                ) -> bool:
                    \"\"\"
                    Асинхронно сохраняет данные в текстовый файл.

                    Args:
                        file_path (str | Path): Путь к файлу для сохранения.
                        data (str | list[str] | dict): Данные для записи.
                        mode (str, optional): Режим записи файла ('w' для записи, 'a' для добавления).
                    Returns:
                        bool: True, если файл успешно сохранен, False в противном случае.
                    Raises:
                        Exception: При возникновении ошибки при записи в файл.

                    Example:
                        >>> from pathlib import Path
                        >>> file_path = Path('example.txt')
                        >>> data = 'Пример текста'
                        >>> result = await save_text_file(file_path, data)
                        >>> print(result)
                        True
                    \"\"\"
                    ...
                    rest of code
                 ```
            """,
            "order_of_blocks": "Структура ответа должна быть такой:\n**Заголовок**\n    Анализ кода модуля <имя модуля>\n\n**Качество кода\n<Соответветвие требованиям по оформлению кода от 1 до 10>\n -  Плюсы\n        <положительные качества кода>\n -  Минусы\n    <отрицательные моменты> \n**Рекомендации по улучшению**\n**Оптимизиробанный код**\n   - Код должен быть обрамлён в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).",
            "avoid_start_with_code_blocks": "Ответ не должен начинаться с ` ``` `. Используйте их только для оборачивания блоков кода.",
            "response_language": "Ты даешь ответы на русском языке",
            "response_format": "Формат ответа `.md` (markdown)",
            "end_of_instruction": "КОНЕЦ ИНСТРУКЦИИ",
            "module_instruction": """
                **Instruction**
                1. Модули `src.utils` и `src.utils.converters` — служебные утилиты проекта. Они спроектированы так, чтобы по минимуму использовать внутренние утилиты.
                2. В этих модулях **НЕ используется** `j_loads`, `j_loads_ns` и `j_dumps`.
                3. Используйте стандартную библиотеку `import json`.
                **End of instruction**
            """
        }
        return instructions
```
# Модуль для работы с провайдером Raycast
==========================================

Модуль содержит класс `Raycast`, который используется для взаимодействия с Raycast API для получения ответов от AI моделей.

Пример использования:
```python
# Пример будет добавлен после реализации
```

## Обзор

Модуль `Raycast.py` предоставляет реализацию для взаимодействия с API Raycast, позволяя использовать модели, такие как `gpt-3.5-turbo` и `gpt-4`. Этот модуль требует аутентификации через токен `auth`. Модуль поддерживает потоковую передачу ответов и использует библиотеку `requests` для выполнения HTTP-запросов.

## Подробней

Этот модуль является частью проекта `hypotez` и предназначен для интеграции с различными AI-моделями через API Raycast. Он обеспечивает возможность отправки запросов к моделям и получения потоковых ответов. Модуль требует наличия токена аутентификации для работы.

## Классы

### `Raycast`

**Описание**: Класс `Raycast` предоставляет интерфейс для взаимодействия с API Raycast.

**Наследует**:
- `AbstractProvider`: Класс наследует `AbstractProvider`, который, вероятно, определяет общие методы и атрибуты для всех провайдеров в проекте `hypotez`.

**Атрибуты**:
- `url` (str): URL API Raycast (`https://raycast.com`).
- `supports_stream` (bool): Указывает, что провайдер поддерживает потоковую передачу (`True`).
- `needs_auth` (bool): Указывает, что для работы требуется аутентификация (`True`).
- `working` (bool): Указывает, что провайдер в данный момент не работает (`False`).
- `models` (List[str]): Список поддерживаемых моделей (`gpt-3.5-turbo`, `gpt-4`).

**Методы**:
- `create_completion()`: Метод для создания запроса к API Raycast и получения ответа.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: Messages,
    stream: bool,
    proxy: str = None,
    **kwargs,
) -> CreateResult:
    """
    Создает запрос к API Raycast и возвращает результат.

    Args:
        model (str): Имя используемой модели.
        messages (Messages): Список сообщений для отправки в API.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные аргументы, такие как токен аутентификации (`auth`).

    Returns:
        CreateResult: Результат запроса.

    Raises:
        ValueError: Если не предоставлен токен аутентификации (`auth`).
    """
```

**Назначение**: Функция `create_completion` отправляет запрос к API Raycast с использованием указанной модели и сообщений, а затем возвращает результат в потоковом режиме, если это указано.

**Параметры**:
- `model` (str): Имя используемой модели (например, `"gpt-3.5-turbo"` или `"gpt-4"`).
- `messages` (Messages): Список сообщений для отправки в API. Сообщения должны содержать роль и содержимое.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу. Если `True`, функция возвращает генератор токенов.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы. Обязательно должен присутствовать токен аутентификации (`auth`).

**Возвращает**:
- `CreateResult`: Результат запроса. В случае потоковой передачи возвращается генератор токенов.

**Вызывает исключения**:
- `ValueError`: Если не предоставлен токен аутентификации (`auth`).

**Внутренние функции**: Нет.

**Как работает функция**:

1. **Проверка аутентификации**:
   - Функция проверяет наличие токена аутентификации (`auth`) в аргументах `kwargs`. Если токен отсутствует, вызывается исключение `ValueError`.
2. **Подготовка заголовков**:
   - Формируются заголовки HTTP-запроса, включающие токен аутентификации, тип контента и User-Agent.
3. **Преобразование сообщений**:
   - Список сообщений преобразуется в формат, ожидаемый API Raycast. Каждое сообщение должно содержать поля `author` (роль) и `content` (текст сообщения).
4. **Формирование данных запроса**:
   - Формируются данные запроса в формате JSON, включающие сообщения, модель, провайдера и другие параметры.
5. **Отправка запроса**:
   - Отправляется POST-запрос к API Raycast с использованием библиотеки `requests`. Указывается URL, заголовки, данные и флаг потоковой передачи.
6. **Обработка потока**:
   - Если потоковая передача включена, функция итерируется по строкам ответа. Каждая строка проверяется на наличие префикса `b'data: '`.
   - Если префикс найден, строка декодируется, удаляется префикс, и полученный JSON-объект преобразуется в словарь.
   - Из словаря извлекается токен (`completion_chunk['text']`), который возвращается через `yield`.

```
A: Проверка наличия токена аутентификации
|
-- B: Подготовка заголовков запроса
|
C: Преобразование сообщений в нужный формат
|
D: Формирование данных запроса (JSON)
|
E: Отправка POST-запроса к API Raycast
|
F: Обработка потока данных и извлечение токенов
```

**Примеры**:
```python
# Пример будет добавлен после реализации
```
```python
# Пример будет добавлен после реализации
```
```python
# Пример будет добавлен после реализации
# Анализ кода модуля e_370.md

**Качество кода: 7/10**

- **Плюсы:**
    - Код предоставляет понятное описание задачи и алгоритма решения.
    - Используется простой и понятный цикл для подсчета треугольников.
    - Присутствует блок-схема в формате mermaid, что делает алгоритм более наглядным.
    - Код хорошо документирован в комментариях, описывающих каждый шаг решения.

- **Минусы:**
    - Не хватает reStructuredText (RST) оформления комментариев и docstring.
    - Отсутствуют проверки входных данных.
    - Используется стандартный `print` для вывода результата, вместо использования `logger`.
    - Нет обработки возможных исключений.
    - Нет импортов.

**Рекомендации по улучшению:**

1.  **Переписать комментарии в формате reStructuredText (RST)**: Все комментарии, включая docstring, должны быть переписаны в формате RST для соответствия требованиям.
2.  **Добавить проверки входных данных**: Необходимо добавить проверку типа данных и диапазона для входного параметра `max_perimeter`.
3.  **Использовать `logger` для вывода**: Заменить `print` на `logger.info` для вывода результата.
4.  **Обработка исключений**: Добавить обработку возможных исключений, используя `try-except` блоки и `logger.error` для логирования ошибок.
5.  **Добавить импорты**: Добавить необходимые импорты, такие как `from src.logger.logger import logger`.
6.  **Использовать одинарные кавычки**: Привести все строки в коде к использованию одинарных кавычек.
7. **Удалить избыточные блоки** : В блоке markdown удалены избыточные комментарии и сохранена только необходимая информация

**Оптимизированный код:**

```python
"""
Модуль для решения задачи 370 проекта Эйлера: Совершенные треугольники.
====================================================================

Этот модуль содержит функцию :func:`count_perfect_triangles`, которая
вычисляет количество совершенных треугольников с периметром,
не превышающим заданное значение.

Совершенный треугольник - это треугольник с целыми сторонами, у которого
площадь численно равна периметру.

Пример использования
--------------------

.. code-block:: python

    max_perimeter = 10**16
    result = count_perfect_triangles(max_perimeter)
    print(result)
"""
from src.logger.logger import logger # Импорт логгера

def count_perfect_triangles(max_perimeter: int) -> int:
    """
    Подсчитывает количество совершенных треугольников с периметром,
    не превышающим max_perimeter.

    :param max_perimeter: Максимальный периметр треугольников.
    :type max_perimeter: int
    :raises TypeError: Если max_perimeter не является целым числом.
    :raises ValueError: Если max_perimeter меньше или равен нулю.
    :return: Количество совершенных треугольников.
    :rtype: int
    """
    # Проверка, что max_perimeter является целым числом
    if not isinstance(max_perimeter, int):
        logger.error(f'Некорректный тип данных для max_perimeter: {type(max_perimeter)}')
        raise TypeError('max_perimeter должен быть целым числом')
    # Проверка, что max_perimeter больше нуля
    if max_perimeter <= 0:
        logger.error(f'Некорректное значение max_perimeter: {max_perimeter}')
        raise ValueError('max_perimeter должен быть больше нуля')
    
    count = 0
    base_triangles = [(5, 12, 13), (6, 8, 10), (6, 25, 29), (7, 15, 20), (9, 10, 17)]

    for triangle in base_triangles:
        base_perimeter = sum(triangle)
        k = 1
        # Код исполняет цикл, пока периметр масштабированного треугольника не превышает max_perimeter
        while base_perimeter * k <= max_perimeter:
            count += 1 # Увеличивает счетчик совершенных треугольников
            k += 1 # Увеличивает масштабирующий коэффициент
    return count


# Пример использования:
if __name__ == '__main__':
    max_perimeter = 10**16
    try:
         # Код исполняет вызов функции подсчета совершенных треугольников
        result = count_perfect_triangles(max_perimeter)
        # Логирует результат
        logger.info(f'Количество совершенных треугольников с периметром не более {max_perimeter}: {result}')
    except (TypeError, ValueError) as e:
        logger.error(f'Произошла ошибка: {e}')
```
```markdown
## Ответ на Задачу No 370: Совершенные треугольники

### 1. Анализ задачи и решение
**Понимание задачи:**
* Совершенный треугольник - это треугольник с целыми сторонами, у которого площадь численно равна периметру.
* Нам нужно найти количество совершенных треугольников с периметром, не превышающим 10<sup>16</sup>.

**Решение:**
1. **Формула Герона:** Площадь треугольника можно выразить через его полупериметр (s) и длины сторон (a, b, c):
   `Площадь = sqrt(s * (s - a) * (s - b) * (s - c))`, где `s = (a + b + c) / 2`.
2. **Условие совершенного треугольника:** Площадь численно равна периметру, то есть `sqrt(s * (s - a) * (s - b) * (s - c)) = a + b + c = 2s`.
3. **Упрощение:** Возведем обе части равенства в квадрат: `s * (s - a) * (s - b) * (s - c) = 4s^2`. Сократим на `s`: `(s - a) * (s - b) * (s - c) = 4s`.
4. **Поиск решений:** Преобразованное уравнение значительно упрощает перебор. Заметим, что `s = (a + b + c)/2`. Нам необходимо перебирать тройки целых чисел (a, b, c), которые удовлетворяют:
   * Условию треугольника: a + b > c, a + c > b, b + c > a
   * Преобразованному условию совершенства: `(s - a) * (s - b) * (s - c) = 4s`
   * Условию ограничения периметра: `a + b + c <= 10^16`
5. **Алгоритм оптимизации:** Известно, что все совершенные треугольники имеют одну из сторон, равную 6. Сторона равная 6, появляется в 5 треугольниках: (5, 12, 13), (6, 8, 10), (6, 25, 29), (7, 15, 20) и (9, 10, 17).

   Все совершенные треугольники, стороны которых не превышают 10^16, получаются путем масштабирования этих базовых треугольников на натуральное число. Таким образом, перебор достаточно производить по базовым треугольникам и масштабирующему коэффициенту.

### 2. Алгоритм решения

1. Начать
2. Инициализировать переменную `count` со значением 0 для подсчета количества совершенных треугольников.
3. Определить список базовых совершенных треугольников:
   * `base_triangles = [(5, 12, 13), (6, 8, 10), (6, 25, 29), (7, 15, 20), (9, 10, 17)]`
4. Для каждого `base_triangle` в `base_triangles`:
   * Вычислить периметр базового треугольника: `base_perimeter = sum(base_triangle)`
   * Инициализировать переменную масштабирующего коэффициента `k` = 1
   * Пока `base_perimeter * k <= 10^16`:
      * Увеличить `count` на 1
      * Увеличить `k` на 1
5. Вывести значение `count`
6. Конец

### 3. Реализация на Python 3.12
```python
def count_perfect_triangles(max_perimeter):
    """
    Counts the number of perfect triangles with perimeter not exceeding max_perimeter.

    Args:
        max_perimeter: The maximum perimeter of the triangles.

    Returns:
        The count of perfect triangles.
    """

    count = 0
    base_triangles = [(5, 12, 13), (6, 8, 10), (6, 25, 29), (7, 15, 20), (9, 10, 17)]

    for triangle in base_triangles:
        base_perimeter = sum(triangle)
        k = 1
        while base_perimeter * k <= max_perimeter:
            count += 1
            k += 1
    return count


# Пример использования:
max_perimeter = 10**16
result = count_perfect_triangles(max_perimeter)
print(result)
```

### 4. Блок-схема в формате mermaid
```mermaid
flowchart TD
    Start((Начало)) --> InitializeCount((Инициализировать count = 0))
    InitializeCount --> DefineBaseTriangles((Определить base_triangles))
    DefineBaseTriangles --> LoopTrianglesStart((Начать цикл: Для каждого triangle в base_triangles))
     LoopTrianglesStart --> CalculateBasePerimeter((Вычислить base_perimeter = sum(triangle)))
    CalculateBasePerimeter --> InitializeK((Инициализировать k = 1))
     InitializeK --> LoopKStart((Начать цикл: Пока base_perimeter * k <= max_perimeter))
    LoopKStart --> IncrementCount((Увеличить count на 1))
    IncrementCount --> IncrementK((Увеличить k на 1))
      IncrementK --> LoopKStart
    LoopKStart -- Нет --> LoopTrianglesStart
     LoopTrianglesStart -- Конец --> OutputCount((Вывести count))
    OutputCount --> End((Конец))
```
```
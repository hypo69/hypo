# Документация для модуля `src.endpoints.bots.telegram`

## Обзор

Этот модуль отвечает за создание и управление Telegram-ботом. Бот выполняет несколько функций, связанных с обработкой команд, голосовых сообщений и взаимодействием с пользователями в Telegram.

## Подробней

Модуль предоставляет класс `TelegramBot`, который использует библиотеку `python-telegram-bot` для взаимодействия с Telegram API. Бот обрабатывает команды, такие как `/start` и `/help`, а также обрабатывает входящие текстовые, голосовые сообщения и документы.

В данном модуле реализованы следующие основные функции:

1.  **Инициализация бота:**
    *   Бот инициализируется с токеном, который используется для аутентификации бота в Telegram API.

2.  **Обработка команд:**
    *   `/start`: Отправляет приветственное сообщение пользователю.
    *   `/help`: Предоставляет список доступных команд.
    *   `/sendpdf`: Отправляет PDF-файл пользователю.

3.  **Обработка сообщений:**
    *   Бот обрабатывает входящие текстовые сообщения, голосовые сообщения и файлы документов.
    *   Для голосовых сообщений бот транскрибирует аудио (в текущей версии это функция-заполнитель).
    *   Для файлов документов бот считывает содержимое текстового документа.

4.  **Обработка голосовых сообщений:**
    *   Бот загружает файл голосового сообщения, сохраняет его локально и пытается транскрибировать его, используя службу распознавания речи (в текущей версии это функция-заполнитель).

5.  **Обработка документов:**
    *   Бот загружает файл документа, сохраняет его локально и считывает содержимое текстового документа.

6.  **Обработка текстовых сообщений:**
    *   Бот просто возвращает текст, полученный от пользователя.

## Классы

### `TelegramBot`

**Описание**: Класс `TelegramBot` представляет собой Telegram-бота, способного обрабатывать команды и сообщения от пользователей.

**Как работает класс**:

1.  **Инициализация**: При инициализации класса создается экземпляр бота на основе токена, полученного из Telegram API.
2.  **Регистрация обработчиков**: После инициализации регистрируются обработчики команд и сообщений, чтобы бот мог реагировать на различные типы входящих данных.
3.  **Обработка команд**: Класс содержит методы для обработки конкретных команд, таких как `/start`, `/help` и `/sendpdf`.
4.  **Обработка сообщений**: Класс также содержит методы для обработки различных типов сообщений, включая текстовые, голосовые сообщения и документы.

**Методы**:

*   `__init__(self, token: str)`: Инициализирует бота с токеном и регистрирует обработчики.

    **Параметры**:
    *   `token` (str): Токен для аутентификации бота в Telegram API.

    **Как работает метод**:

    1.  Принимает токен бота в качестве аргумента.
    2.  Инициализирует бота с использованием предоставленного токена.
    3.  Вызывает метод `register_handlers` для регистрации обработчиков команд и сообщений.

*   `register_handlers(self)`: Регистрирует обработчики команд и сообщений.

    **Как работает метод**:

    1.  Регистрирует обработчики для различных типов команд, таких как `/start` и `/help`.
    2.  Регистрирует обработчики для различных типов сообщений, таких как текстовые, голосовые сообщения и документы.

*   `start(self, update: Update, context: CallbackContext)`: Обрабатывает команду `/start`.

    **Параметры**:
    *   `update` (Update): Объект, представляющий входящее обновление от Telegram.
    *   `context` (CallbackContext): Объект, содержащий информацию о контексте команды.

    **Как работает метод**:

    1.  Отправляет приветственное сообщение пользователю в ответ на команду `/start`.
    2.  Использует `update.message.reply_text` для отправки сообщения.

*   `help_command(self, update: Update, context: CallbackContext)`: Обрабатывает команду `/help`.

    **Параметры**:
    *   `update` (Update): Объект, представляющий входящее обновление от Telegram.
    *   `context` (CallbackContext): Объект, содержащий информацию о контексте команды.

    **Как работает метод**:

    1.  Отправляет список доступных команд пользователю в ответ на команду `/help`.
    2.  Использует `update.message.reply_text` для отправки сообщения.

*   `send_pdf(self, pdf_file: str | Path)`: Обрабатывает команду `/sendpdf` для отправки PDF-файла.

    **Параметры**:
    *   `pdf_file` (str | Path): Путь к PDF-файлу, который необходимо отправить.

    **Как работает метод**:

    1.  Отправляет PDF-файл пользователю.
    2.  Использует `update.message.reply_document` для отправки файла.

*   `handle_voice(self, update: Update, context: CallbackContext)`: Обрабатывает голосовые сообщения и транскрибирует аудио.

    **Параметры**:
    *   `update` (Update): Объект, представляющий входящее обновление от Telegram.
    *   `context` (CallbackContext): Объект, содержащий информацию о контексте команды.

    **Как работает метод**:

    1.  Получает файл голосового сообщения от пользователя.
    2.  Сохраняет файл локально.
    3.  Вызывает метод `transcribe_voice` для транскрибирования аудио (в текущей версии это функция-заполнитель).
    4.  Отправляет транскрибированный текст пользователю.

*   `transcribe_voice(self, file_path: Path) -> str`: Транскрибирует голосовые сообщения (функция-заполнитель).

    **Параметры**:
    *   `file_path` (Path): Путь к файлу голосового сообщения.

    **Возвращает**:
    *   `str`: Транскрибированный текст (в текущей версии возвращает пустую строку).

    **Как работает метод**:

    1.  Принимает путь к файлу голосового сообщения.
    2.  Выполняет транскрибирование аудио (в текущей версии возвращает пустую строку).

*   `handle_document(self, update: Update, context: CallbackContext) -> str`: Обрабатывает файлы документов и считывает их содержимое.

    **Параметры**:
    *   `update` (Update): Объект, представляющий входящее обновление от Telegram.
    *   `context` (CallbackContext): Объект, содержащий информацию о контексте команды.

    **Возвращает**:
    *   `str`: Содержимое текстового документа.

    **Как работает метод**:

    1.  Получает файл документа от пользователя.
    2.  Сохраняет файл локально.
    3.  Считывает содержимое текстового документа.
    4.  Отправляет содержимое документа пользователю.

*   `handle_message(self, update: Update, context: CallbackContext) -> str`: Обрабатывает текстовые сообщения и возвращает полученный текст.

    **Параметры**:
    *   `update` (Update): Объект, представляющий входящее обновление от Telegram.
    *   `context` (CallbackContext): Объект, содержащий информацию о контексте команды.

    **Возвращает**:
    *   `str`: Текст, полученный от пользователя.

    **Как работает метод**:

    1.  Получает текст сообщения от пользователя.
    2.  Возвращает полученный текст.

**Примеры**:

```python
from telegram import Update
from telegram.ext import CallbackContext

# Пример использования обработчика команды /start
def start(update: Update, context: CallbackContext):
    update.message.reply_text('Добро пожаловать в мой Telegram-бот!')

# Пример использования обработчика текстовых сообщений
def handle_message(update: Update, context: CallbackContext):
    text = update.message.text
    update.message.reply_text(f'Вы сказали: {text}')
```

## Функции

### `main()`

**Описание**: Инициализирует бота, регистрирует обработчики команд и сообщений, и запускает бота.

**Как работает функция**:

1.  **Получение токена**: Функция пытается получить токен бота из переменной окружения `TELEGRAM_TOKEN`. Если токен не найден, выводится сообщение об ошибке.
2.  **Инициализация бота**: Создается экземпляр класса `TelegramBot` с использованием полученного токена.
3.  **Запуск бота**: Бот запускается в режиме опроса (`run_polling()`), что позволяет ему постоянно прослушивать входящие сообщения и команды.

**Примеры**:

```python
import os
from src.endpoints.bots.telegram import TelegramBot

def main():
    token = os.environ.get('TELEGRAM_TOKEN')
    if not token:
        print('Токен Telegram-бота не найден в переменных окружения.')
        return

    bot = TelegramBot(token)
    bot.updater.start_polling()
    bot.updater.idle()

if __name__ == '__main__':
    main()
```
# Модуль для работы с FTP серверами

## Обзор

Модуль `src.utils.ftp` предоставляет интерфейс для взаимодействия с FTP-серверами. Он включает функции для отправки, получения и удаления файлов с FTP-сервера.

## Подробней

Модуль позволяет отправлять медиафайлы (изображения, видео), электронные таблицы и другие файлы на FTP-сервер и с него.

## Содержание

- [Классы](#классы)
- [Функции](#функции)
    - [write](#write)
    - [read](#read)
    - [delete](#delete)

## Классы

В данном модуле классы не определены.

## Функции

### `write`

```python
def write(source_file_path: str, dest_dir: str, dest_file_name: str) -> bool:
    """
    Отправляет файл на FTP-сервер.

    Args:
        source_file_path (str): Путь к отправляемому файлу.
        dest_dir (str): Каталог назначения на FTP-сервере.
        dest_file_name (str): Имя файла на FTP-сервере.

    Returns:
        bool: True, если файл успешно отправлен, False в противном случае.

    Example:
        >>> success = write('local_path/to/file.txt', '/remote/directory', 'file.txt')
        >>> print(success)
        True
    """
```

**Назначение**: Функция `write` отправляет файл с локального компьютера на FTP-сервер.

**Параметры**:
- `source_file_path` (str): Локальный путь к файлу, который необходимо отправить.
- `dest_dir` (str): Директория на FTP-сервере, в которую нужно поместить файл.
- `dest_file_name` (str): Имя, которое файл будет иметь на FTP-сервере.

**Возвращает**:
- `bool`: `True`, если файл был успешно отправлен на FTP-сервер, и `False` в противном случае.

**Вызывает исключения**:
- `ftplib.all_errors`: Возникает при ошибках, связанных с FTP-соединением или операциями.
- `OSError`: Возникает при ошибках, связанных с файловой системой (например, если файл не найден).

**Как работает функция**:

1.  **Устанавливает соединение с FTP-сервером**: Использует параметры из словаря `_connection` (предположительно определенного в другом месте) для подключения к FTP-серверу.
2.  **Переходит в целевую директорию**: После успешного подключения переходит в директорию `dest_dir` на FTP-сервере.
3.  **Открывает и отправляет файл**: Открывает файл, указанный в `source_file_path`, в бинарном режиме для чтения, и отправляет его на FTP-сервер с именем `dest_file_name`, используя команду `STOR`.
4.  **Обрабатывает ошибки**: Если в процессе подключения или отправки файла возникают исключения, они логируются с помощью `logger.error`, и функция возвращает `False`.
5.  **Закрывает соединение**: В блоке `finally` пытается закрыть FTP-соединение, чтобы освободить ресурсы. Если при закрытии соединения также возникают ошибки, они также логируются.

```
Соединение с сервером --> Переход в каталог назначения --> Открытие локального файла --> Отправка файла на сервер --> Закрытие соединения
```

**Примеры**:

Пример успешной отправки файла:

```python
success = write('local_path/to/file.txt', '/remote/directory', 'file.txt')
print(success)  # Вывод: True
```

Пример неудачной отправки файла (неверный путь к локальному файлу):

```python
success = write('non_existent_file.txt', '/remote/directory', 'file.txt')
print(success)  # Вывод: False (и сообщение об ошибке в логе)
```

### `read`

```python
def read(source_file_path: str, dest_dir: str, dest_file_name: str) -> Union[str, bytes, None]:
    """
    Извлекает файл с FTP-сервера.

    Args:
        source_file_path (str): Путь, по которому файл будет сохранен локально.
        dest_dir (str): Каталог на FTP-сервере, где находится файл.
        dest_file_name (str): Имя файла на FTP-сервере.

    Returns:
        Union[str, bytes, None]: Содержимое файла, если он успешно получен, None в противном случае.

    Example:
        >>> content = read('local_path/to/file.txt', '/remote/directory', 'file.txt')
        >>> print(content)
        b'Some file content'
    """
```

**Назначение**: Функция `read` извлекает файл с FTP-сервера и сохраняет его локально.

**Параметры**:
- `source_file_path` (str): Локальный путь, по которому будет сохранен скачанный файл.
- `dest_dir` (str): Директория на FTP-сервере, где находится файл.
- `dest_file_name` (str): Имя файла, который нужно скачать с FTP-сервера.

**Возвращает**:
- `Union[str, bytes, None]`: Содержимое файла в виде байтов, если файл был успешно скачан, и `None` в случае ошибки.

**Вызывает исключения**:
- `ftplib.all_errors`: Возникает при ошибках, связанных с FTP-соединением или операциями.
- `OSError`: Возникает при ошибках, связанных с файловой системой (например, если нет прав на запись файла).

**Как работает функция**:

1.  **Устанавливает соединение с FTP-сервером**: Использует параметры из словаря `_connection` для подключения к FTP-серверу.
2.  **Переходит в целевую директорию**: Переходит в директорию `dest_dir` на FTP-сервере.
3.  **Открывает локальный файл для записи**: Открывает файл, указанный в `source_file_path`, в бинарном режиме для записи.
4.  **Скачивает файл**: Использует команду `RETR` для скачивания файла с FTP-сервера и записывает его содержимое в локальный файл.
5.  **Возвращает содержимое файла**: После успешного скачивания файла, открывает его в бинарном режиме для чтения и возвращает его содержимое.
6.  **Обрабатывает ошибки**: Если в процессе подключения или скачивания файла возникают исключения, они логируются с помощью `logger.error`, и функция возвращает `None`.
7.  **Закрывает соединение**: В блоке `finally` пытается закрыть FTP-соединение.

```
Соединение с сервером --> Переход в каталог назначения --> Открытие локального файла для записи --> Скачивание файла с сервера --> Закрытие соединения
```

**Примеры**:

Пример успешного скачивания файла:

```python
content = read('local_path/to/file.txt', '/remote/directory', 'file.txt')
print(content)  # Вывод: b'Some file content' (или содержимое файла)
```

Пример неудачного скачивания файла (неверный путь к удаленному файлу):

```python
content = read('local_path/to/file.txt', '/remote/directory', 'non_existent_file.txt')
print(content)  # Вывод: None (и сообщение об ошибке в логе)
```

### `delete`

```python
def delete(source_file_path: str, dest_dir: str, dest_file_name: str) -> bool:
    """
    Удаляет файл с FTP-сервера.

    Args:
        source_file_path (str): Путь, где файл расположен локально (не используется).
        dest_dir (str): Каталог на FTP-сервере, где находится файл.
        dest_file_name (str): Имя файла на FTP-сервере.

    Returns:
        bool: True, если файл успешно удален, False в противном случае.

    Example:
        >>> success = delete('local_path/to/file.txt', '/remote/directory', 'file.txt')
        >>> print(success)
        True
    """
```

**Назначение**: Функция `delete` удаляет файл с FTP-сервера.

**Параметры**:
- `source_file_path` (str): Локальный путь к файлу (не используется в функции, но должен быть указан).
- `dest_dir` (str): Директория на FTP-сервере, где находится файл.
- `dest_file_name` (str): Имя файла, который нужно удалить с FTP-сервера.

**Возвращает**:
- `bool`: `True`, если файл был успешно удален с FTP-сервера, и `False` в противном случае.

**Вызывает исключения**:
- `ftplib.all_errors`: Возникает при ошибках, связанных с FTP-соединением или операциями.

**Как работает функция**:

1.  **Устанавливает соединение с FTP-сервером**: Использует параметры из словаря `_connection` для подключения к FTP-серверу.
2.  **Переходит в целевую директорию**: Переходит в директорию `dest_dir` на FTP-сервере.
3.  **Удаляет файл**: Использует команду `DELE` для удаления файла с именем `dest_file_name` с FTP-сервера.
4.  **Обрабатывает ошибки**: Если в процессе подключения или удаления файла возникают исключения, они логируются с помощью `logger.error`, и функция возвращает `False`.
5.  **Закрывает соединение**: В блоке `finally` пытается закрыть FTP-соединение.

```
Соединение с сервером --> Переход в каталог назначения --> Удаление файла --> Закрытие соединения
```

**Примеры**:

Пример успешного удаления файла:

```python
success = delete('local_path/to/file.txt', '/remote/directory', 'file.txt')
print(success)  # Вывод: True
```

Пример неудачного удаления файла (неверный путь к удаленному файлу):

```python
success = delete('local_path/to/file.txt', '/remote/directory', 'non_existent_file.txt')
print(success)  # Вывод: False (и сообщение об ошибке в логе)
# Модуль для взаимодействия с API XAI Grok
==========================================

Модуль содержит класс `XAI`, который предоставляет интерфейс для взаимодействия с API x.ai, включая запросы на завершение чата в потоковом и непотоковом режимах.

## Обзор

Этот модуль предоставляет класс `XAI` для взаимодействия с API x.ai Grok. Он включает в себя методы для отправки запросов на завершение чата, как в обычном режиме, так и в режиме потоковой передачи. Модуль упрощает процесс аутентификации и отправки запросов к API, предоставляя удобный интерфейс для работы с моделью Grok.

## Подробнее

Модуль предназначен для упрощения интеграции с API x.ai Grok. Класс `XAI` берет на себя управление аутентификацией и отправкой запросов, позволяя разработчикам сосредоточиться на логике взаимодействия с моделью. Он поддерживает как обычные запросы на завершение чата, так и потоковую передачу ответов, что может быть полезно для приложений, требующих немедленной обратной связи.

## Классы

### `XAI`

**Описание**: Класс для взаимодействия с API x.ai.

**Принцип работы**:
1.  При инициализации класса `XAI` требуется API-ключ, который используется для аутентификации при каждом запросе.
2.  Метод `_send_request` отправляет HTTP-запросы к API x.ai, обрабатывая аутентификацию и форматирование данных.
3.  Метод `chat_completion` отправляет запрос на завершение чата и возвращает полный ответ от API.
4.  Метод `stream_chat_completion` отправляет запрос на завершение чата в режиме потоковой передачи и возвращает итератор по строкам ответа.

**Атрибуты**:

*   `api_key` (str): Ключ API для аутентификации.
*   `base_url` (str): Базовый URL API x.ai.
*   `headers` (dict): Заголовки HTTP-запроса, включая API-ключ и тип контента.

**Методы**:

*   `__init__(self, api_key)`: Инициализирует экземпляр класса `XAI` с заданным API-ключом.
*   `_send_request(self, method, endpoint, data=None)`: Отправляет HTTP-запрос к API x.ai.
*   `chat_completion(self, messages, model="grok-beta", stream=False, temperature=0)`: Отправляет запрос на завершение чата.
*   `stream_chat_completion(self, messages, model="grok-beta", temperature=0)`: Отправляет запрос на завершение чата с потоковой передачей.

## Функции

### `_send_request`

```python
    def _send_request(self, method, endpoint, data=None):
        """
        Отправка запроса к API x.ai.

        :param method: Метод HTTP (GET, POST, PUT, DELETE).
        :param endpoint: Конечная точка API.
        :param data: Данные для отправки в теле запроса (для POST и PUT).
        :return: Ответ от API.
        """
```

**Назначение**: Отправляет HTTP-запрос к API x.ai.

**Параметры**:

*   `method` (str): Метод HTTP (GET, POST, PUT, DELETE).
*   `endpoint` (str): Конечная точка API.
*   `data` (Optional[dict], optional): Данные для отправки в теле запроса (для POST и PUT). По умолчанию `None`.

**Возвращает**:

*   `dict`: Ответ от API в формате JSON.

**Вызывает исключения**:

*   `requests.exceptions.HTTPError`: Если статус ответа не 2xx.

**Как работает функция**:

1.  Формирует URL-адрес на основе базового URL и переданной конечной точки API.
2.  Отправляет HTTP-запрос с использованием библиотеки `requests`, передавая метод, URL, заголовки и данные (если есть).
3.  Проверяет статус ответа и вызывает исключение `HTTPError`, если статус не 2xx.
4.  Преобразует ответ в формат JSON и возвращает его.

**Внутренние функции**: Отсутствуют.

**Примеры**:

```python
xai = XAI("your_api_key_here")
response = xai._send_request("GET", "models")
print(response)
```

### `chat_completion`

```python
    def chat_completion(self, messages, model="grok-beta", stream=False, temperature=0):
        """
        Запрос на завершение чата.

        :param messages: Список сообщений для чата.
        :param model: Модель для использования.
        :param stream: Флаг для включения потоковой передачи.
        :param temperature: Температура для генерации ответа.
        :return: Ответ от API.
        """
```

**Назначение**: Отправляет запрос на завершение чата в API x.ai.

**Параметры**:

*   `messages` (list): Список сообщений для чата.
*   `model` (str, optional): Модель для использования. По умолчанию `"grok-beta"`.
*   `stream` (bool, optional): Флаг для включения потоковой передачи. По умолчанию `False`.
*   `temperature` (int, optional): Температура для генерации ответа. По умолчанию `0`.

**Возвращает**:

*   `dict`: Ответ от API в формате JSON.

**Вызывает исключения**:

*   `requests.exceptions.HTTPError`: Если статус ответа не 2xx.

**Как работает функция**:

1.  Формирует конечную точку API для завершения чата (`"chat/completions"`).
2.  Создает словарь `data` с параметрами запроса, включая сообщения, модель, флаг потоковой передачи и температуру.
3.  Вызывает метод `_send_request` для отправки POST-запроса к API с сформированными данными.
4.  Возвращает ответ от API в формате JSON.

**Внутренние функции**: Отсутствуют.

**Примеры**:

```python
xai = XAI("your_api_key_here")
messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "What is the capital of France?"}
]
response = xai.chat_completion(messages)
print(response)
```

### `stream_chat_completion`

```python
    def stream_chat_completion(self, messages, model="grok-beta", temperature=0):
        """
        Запрос на завершение чата с потоковой передачей.

        :param messages: Список сообщений для чата.
        :param model: Модель для использования.
        :param temperature: Температура для генерации ответа.
        :return: Поток ответов от API.
        """
```

**Назначение**: Отправляет запрос на завершение чата с потоковой передачей в API x.ai.

**Параметры**:

*   `messages` (list): Список сообщений для чата.
*   `model` (str, optional): Модель для использования. По умолчанию `"grok-beta"`.
*   `temperature` (int, optional): Температура для генерации ответа. По умолчанию `0`.

**Возвращает**:

*   `Generator[str, None, None]`: Поток ответов от API.

**Вызывает исключения**:

*   `requests.exceptions.HTTPError`: Если статус ответа не 2xx.

**Как работает функция**:

1.  Формирует конечную точку API для завершения чата (`"chat/completions"`).
2.  Создает словарь `data` с параметрами запроса, включая сообщения, модель, флаг потоковой передачи (установлен в `True`) и температуру.
3.  Формирует URL-адрес на основе базового URL и конечной точки API.
4.  Отправляет POST-запрос с использованием библиотеки `requests` с указанием `stream=True`.
5.  Проверяет статус ответа и вызывает исключение, если статус не 2xx.
6.  Возвращает итератор по строкам ответа, декодированным в Unicode.

**Внутренние функции**: Отсутствуют.

**Примеры**:

```python
xai = XAI("your_api_key_here")
messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "Tell me a story."}
]
stream_response = xai.stream_chat_completion(messages)
for line in stream_response:
    if line.strip():
        print(json.loads(line))
```
# Анализ кода модуля `26_change.ru.md`

**Качество кода**

*   **Соблюдение требований к формату кода (1-10):**
    *   **Преимущества:**
        *   Структура документа соответствует формату Markdown и содержит чёткое описание игры, пошаговую инструкцию, пример работы и ограничения.
        *   Документ хорошо структурирован с использованием заголовков и подзаголовков.
        *   Примеры кода представлены в виде блоков кода.
    *   **Недостатки:**
        *   Документ не является кодом Python, а представляет собой текстовое описание игры в формате Markdown.
        *   Не используется reStructuredText (RST).
        *   Отсутствуют docstring и комментарии, которые бы соответствовали требованиям.
        *   Нет обработки данных через `j_loads` или `j_loads_ns`.
        *   Нет импортов, функций, классов или методов.
        *   Отсутствует логгирование.

**Рекомендации по улучшению**

1.  **Преобразование в Python:** Документ должен быть преобразован в исполняемый Python код.
2.  **Формат документации:**
    *   Использовать reStructuredText (RST) для docstring и комментариев.
    *   Включить docstring для модуля, функций и методов.
    *   Следовать стандартам написания docstring в Python.
3.  **Обработка данных:** Использовать `j_loads` или `j_loads_ns` для чтения данных (если это необходимо).
4.  **Импорты:** Добавить необходимые импорты.
5.  **Логирование:** Использовать `from src.logger.logger import logger` для логирования ошибок и отладки.
6.  **Обработка ошибок:** Избегать чрезмерного использования `try-except` и использовать `logger.error` для логирования ошибок.
7.  **Комментарии:**
    *   Использовать комментарии `#` для объяснения отдельных частей кода.
    *   Писать комментарии на русском языке.
8.  **Примеры кода:** Добавить примеры docstring в формате RST и примеры улучшений.

**Улучшенный код**

```python
"""
Модуль для реализации игры "CHANGE" (Кассовая программа).
=========================================================================================

Этот модуль реализует игру, в которой компьютер выполняет роль кассира.
Игрок вводит стоимость товара и сумму оплаты, а программа вычисляет и выводит сдачу,
используя банкноты и монеты.

Пример использования
--------------------

.. code-block:: python

    from src.logger.logger import logger
    from src.utils.jjson import j_loads_ns
    from src.endpoints.ai_games.101_basic_computer_games.ru.rules.26_change import ChangeGame
    
    game = ChangeGame()
    game.start_game()
"""

from src.logger.logger import logger  # Добавлен импорт для логирования
from src.utils.jjson import j_loads_ns # Добавлен импорт для чтения файлов JSON (если понадобится)


class ChangeGame:
    """
    Класс для управления игрой "CHANGE".
    
    :ivar banknotes: Словарь с доступными банкнотами.
    :ivar coins: Словарь с доступными монетами.
    """

    def __init__(self):
        """
        Инициализирует игру, устанавливая доступные номиналы банкнот и монет.
        """
        self.banknotes = {  # Словарь с номиналами банкнот
            5: "пятидолларовая купюра",
            10: "десятидолларовая купюра",
        }
        self.coins = {  # Словарь с номиналами монет
            0.25: "четверть",
            0.10: "дайм",
            0.05: "никель",
            0.01: "пенни",
        }
    
    def calculate_change(self, price: float, payment: float) -> dict:
        """
        Вычисляет сдачу на основе стоимости товара и суммы оплаты.

        :param price: Стоимость товара.
        :param payment: Сумма оплаты.
        :return: Словарь с количеством купюр и монет для сдачи.
        """
        try:  #  Блок try-except для отлова ошибок
            change = round(payment - price, 2) # Вычисление сдачи
            if change < 0: # Проверка на отрицательную сдачу
                logger.error(f"Недостаточно средств для оплаты. Требуется доплатить {abs(change)}.")
                return None # Возвращаем None если средств не достаточно
            
            change_dict = {} # Инициализация словаря для хранения сдачи
            for value, name in sorted(self.banknotes.items(), reverse=True): # Цикл по банкнотам
                while change >= value: # Цикл пока сдача больше номинала банкноты
                    change_dict[name] = change_dict.get(name, 0) + 1 # Добавление купюры к словарю
                    change = round(change - value, 2) # Вычитание номинала банкноты из сдачи
            
            for value, name in sorted(self.coins.items(), reverse=True): # Цикл по монетам
                while change >= value: # Цикл пока сдача больше номинала монеты
                     change_dict[name] = change_dict.get(name, 0) + 1 # Добавление монеты к словарю
                     change = round(change - value, 2) # Вычитание номинала монеты из сдачи
            
            return change_dict  # Возвращение словаря со сдачей
        except Exception as ex:  # Перехват ошибок
           logger.error(f"Ошибка при расчете сдачи: {ex}") # Логгирование ошибки
           return None # Возвращаем None в случае ошибки

    def display_change(self, change_dict: dict, total_change:float) -> None:
        """
        Выводит рассчитанную сдачу на экран.

        :param change_dict: Словарь с количеством купюр и монет для сдачи.
        :param total_change: Общая сумма сдачи.
        """
        print(f"Сдача: ${total_change}") # Вывод общей суммы сдачи
        if change_dict: # Проверка наличия сдачи
            for name, count in change_dict.items(): # Цикл по элементам словаря сдачи
                 print(f"{count} {name}") # Вывод количества и названия элементов сдачи

    def start_game(self):
        """
        Запускает игру. Запрашивает ввод данных и выводит сдачу.
        """
        print("Добро пожаловать в игру CHANGE!") # Вывод приветствия
        while True: # Бесконечный цикл игры
            try:  #  Блок try-except для отлова ошибок
                price = float(input("Введите стоимость товара: ")) # Запрос стоимости товара
                payment = float(input("Введите сумму оплаты: ")) # Запрос суммы оплаты
            except ValueError: # Перехват ошибки неверного ввода
                logger.error("Некорректный ввод. Введите число.") # Логгирование ошибки
                continue # Переход к следующей итерации цикла
            
            change_dict = self.calculate_change(price, payment) # Вычисление сдачи
            if change_dict:  # Проверка на корректный расчет сдачи
                total_change = round(payment-price,2)  # Вычисление общей суммы сдачи
                self.display_change(change_dict, total_change) # Вывод сдачи на экран
                
            play_again = input("Хотите сыграть снова? (да/нет): ").lower()  # Запрос на продолжение игры
            if play_again != "да": # Выход из игры
                print("Спасибо за игру!")
                break
            

if __name__ == "__main__":  # Проверка на запуск как главный модуль
    game = ChangeGame() # Создание экземпляра игры
    game.start_game() # Запуск игры
```
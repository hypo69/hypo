# Документация для `improve_code.py`

## Обзор

Этот модуль предназначен для улучшения существующего кода Python с использованием модели GPT-4free. Он читает код из указанного файла, отправляет его в модель для улучшения (например, добавления type hints) и записывает улучшенный код обратно в тот же файл.

## Подробнее

Модуль использует библиотеку `g4f` для взаимодействия с API GPT-4free. Он предназначен для автоматической доработки кода, такой как добавление аннотаций типов. Важно отметить, что модуль изменяет исходный файл, поэтому перед использованием рекомендуется создать резервную копию.

## Функции

### `read_code`

```python
def read_code(text: str) -> str | None:
    """Извлекает блок кода Python из текста, заключенного в тройные обратные кавычки.

    Args:
        text (str): Текст, содержащий блок кода.

    Returns:
        str | None: Извлеченный код или None, если код не найден.

    Как работает функция:
    1. Функция использует регулярное выражение для поиска текста, заключенного в ```python ... ``` или ```py ... ```.
    2. Если такой блок найден, функция возвращает его содержимое.

    Внутри функции происходят следующие действия и преобразования:
     A. Поиск кода с помощью регулярного выражения.
     |
     B. Извлечение кода, если он найден.

     Примеры:
        >>> text = "Some text ```python\\ndef foo():\\n    return 1\\n```"
        >>> read_code(text)
        'def foo():\\n    return 1'

        >>> text = "No code here"
        >>> read_code(text)  # Возвращает None
    """
    ...
```
## Переменные
В модуле используются следующие переменные:
- **path**: путь к файлу, код которого нужно улучшить. Получается через `input("Path: ")`
- **code**: содержимое файла, полученное с помощью `file.read()`
- **prompt**: строка, содержащая запрос к модели GPT-4free с инструкцией улучшить код.
- **response**: список чанков, полученных от модели GPT-4free.
## Основной блок кода

Основной блок кода выполняет следующие действия:

1.  **Получение пути к файлу**:
    Запрашивает у пользователя путь к файлу, который нужно улучшить.

2.  **Чтение кода из файла**:
    Читает содержимое указанного файла.

3.  **Формирование запроса (prompt) для GPT-4free**:
    Создает строку запроса, которая включает в себя код файла и инструкции по улучшению (добавить type hints, не удалять существующий код и комментарии лицензии).

4.  **Взаимодействие с GPT-4free для улучшения кода**:
    Отправляет запрос в модель GPT-4free и получает улучшенный код в виде потока чанков. Собирает все чанки в одну строку.

5.  **Извлечение улучшенного кода из ответа GPT-4free**:
    Использует функцию `read_code` для извлечения блока кода Python из ответа модели.

6.  **Запись улучшенного кода обратно в файл**:
    Записывает улучшенный код обратно в исходный файл.

## Как работает скрипт:

1.  Скрипт запрашивает путь к файлу у пользователя.
2.  Читает содержимое файла.
3.  Формирует запрос к модели GPT-4free, включая код и инструкции по улучшению.
4.  Получает ответ от модели в виде потока чанков и объединяет их в одну строку.
5.  Извлекает улучшенный код из ответа модели.
6.  Записывает улучшенный код обратно в файл.

## Зависимости

*   `sys`
*   `re`
*   `pathlib.Path`
*   `os.path`
*   `g4f`

## Использование

1.  Установите необходимые зависимости (`g4f`).
2.  Запустите скрипт.
3.  Введите путь к файлу, который нужно улучшить, когда будет предложено.
4.  После завершения работы скрипта, в указанном файле будет содержаться улучшенная версия кода.

## Пример использования

```bash
python improve_code.py
Path: /path/to/your/file.py
# Модуль `base.py`

## Обзор

Модуль `base.py` предоставляет базовый класс `BaseDAO` для выполнения основных операций с базой данных, таких как добавление, удаление, обновление, поиск и пагинация записей. Он использует SQLAlchemy и Pydantic для работы с данными.

## Содержание

1.  [Классы](#классы)
    *   [`BaseDAO`](#base-dao)
2.  [Функции](#функции)
    *   [`find_one_or_none_by_id`](#find_one_or_none_by_id)
    *   [`find_one_or_none`](#find_one_or_none)
    *   [`find_all`](#find_all)
    *   [`add`](#add)
    *   [`add_many`](#add_many)
    *   [`update`](#update)
    *   [`delete`](#delete)
    *   [`count`](#count)
    *   [`paginate`](#paginate)
    *   [`find_by_ids`](#find_by_ids)
    *   [`upsert`](#upsert)
     *  [`bulk_update`](#bulk_update)

## Классы

### `BaseDAO`

**Описание**:
Базовый класс для доступа к данным. Предоставляет методы для выполнения CRUD-операций и пагинации. Класс является дженериком и принимает тип `T`, который должен быть наследником `bot.dao.database.Base`.

**Параметры**:
- `model` (type[T]):  Тип модели, с которой работает DAO.

**Методы**:
- `find_one_or_none_by_id`: Найти запись по ID.
- `find_one_or_none`: Найти одну запись по фильтрам.
- `find_all`: Найти все записи по фильтрам.
- `add`: Добавить одну запись.
- `add_many`: Добавить несколько записей.
- `update`: Обновить записи по фильтрам.
- `delete`: Удалить записи по фильтру.
- `count`: Подсчитать количество записей.
- `paginate`: Пагинация записей.
- `find_by_ids`: Найти несколько записей по списку ID.
- `upsert`: Создать или обновить запись.
- `bulk_update`: Массовое обновление записей.

## Функции

### `find_one_or_none_by_id`

**Описание**:
Находит запись в базе данных по ее идентификатору.

**Параметры**:
- `data_id` (int): Идентификатор записи.
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.

**Возвращает**:
- `T | None`: Найденная запись или `None`, если запись не найдена.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `find_one_or_none`

**Описание**:
Находит одну запись в базе данных по заданным фильтрам.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `filters` (BaseModel): Объект Pydantic, содержащий фильтры.

**Возвращает**:
- `T | None`: Найденная запись или `None`, если запись не найдена.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `find_all`

**Описание**:
Находит все записи в базе данных, соответствующие заданным фильтрам.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `filters` (BaseModel | None, optional): Объект Pydantic, содержащий фильтры. По умолчанию `None`.

**Возвращает**:
- `List[T]`: Список найденных записей.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `add`

**Описание**:
Добавляет новую запись в базу данных.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `values` (BaseModel): Объект Pydantic, содержащий данные для новой записи.

**Возвращает**:
- `T`: Добавленная запись.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `add_many`

**Описание**:
Добавляет несколько записей в базу данных.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `instances` (List[BaseModel]): Список объектов Pydantic, содержащих данные для новых записей.

**Возвращает**:
- `List[T]`: Список добавленных записей.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `update`

**Описание**:
Обновляет записи в базе данных, соответствующие заданным фильтрам.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `filters` (BaseModel): Объект Pydantic, содержащий фильтры.
- `values` (BaseModel): Объект Pydantic, содержащий данные для обновления.

**Возвращает**:
- `int`: Количество обновленных записей.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `delete`

**Описание**:
Удаляет записи из базы данных, соответствующие заданным фильтрам.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `filters` (BaseModel): Объект Pydantic, содержащий фильтры.

**Возвращает**:
- `int`: Количество удаленных записей.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.
- `ValueError`: Если не предоставлен ни один фильтр для удаления.

### `count`

**Описание**:
Подсчитывает количество записей в базе данных, соответствующих заданным фильтрам.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `filters` (BaseModel | None, optional): Объект Pydantic, содержащий фильтры. По умолчанию `None`.

**Возвращает**:
- `int`: Количество записей.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `paginate`

**Описание**:
Возвращает записи из базы данных с пагинацией.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `page` (int, optional): Номер страницы. По умолчанию `1`.
- `page_size` (int, optional): Размер страницы. По умолчанию `10`.
- `filters` (BaseModel, optional): Объект Pydantic, содержащий фильтры. По умолчанию `None`.

**Возвращает**:
- `List[T]`: Список записей на текущей странице.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `find_by_ids`

**Описание**:
Находит несколько записей в базе данных по списку идентификаторов.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `ids` (List[int]): Список идентификаторов записей.

**Возвращает**:
- `List[Any]`: Список найденных записей.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `upsert`

**Описание**:
Создает новую запись в базе данных или обновляет существующую, если она уже существует.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
- `unique_fields` (List[str]): Список полей, которые используются для поиска существующей записи.
- `values` (BaseModel): Объект Pydantic, содержащий данные для записи.

**Возвращает**:
- `T`: Созданная или обновленная запись.

**Вызывает исключения**:
- `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.

### `bulk_update`

**Описание**:
Массово обновляет записи в базе данных.

**Параметры**:
-   `session` (AsyncSession): Асинхронная сессия SQLAlchemy.
-   `records` (List[BaseModel]): Список объектов Pydantic, содержащих данные для обновления. Каждый объект должен иметь поле 'id'.

**Возвращает**:
-   `int`: Общее количество обновленных записей.

**Вызывает исключения**:
-   `SQLAlchemyError`: Если произошла ошибка при выполнении запроса.
# Модуль для проверки валидности ответов от модели

## Обзор

Модуль предназначен для взаимодействия с AI-моделью (в данном случае, Google Gemini) с целью получения и обработки данных о продуктах. Он включает в себя загрузку инструкций, отправку запросов к модели на разных языках и сохранение полученных ответов.

## Подробней

Этот модуль играет важную роль в проекте `hypotez`, обеспечивая механизм для автоматической обработки и валидации данных, возвращаемых AI-моделью. Он использует инструкции на разных языках для формирования запросов и сохраняет ответы для дальнейшего анализа или использования.

## Функции

### `model_ask`

```python
def model_ask(lang: str, attempts: int = 3) -> dict:
    """
    Запрашивает у модели ответ на основе заданного языка и количества попыток.

    Args:
        lang (str): Язык запроса ('ru' или 'he').
        attempts (int, optional): Количество попыток запроса к модели. По умолчанию 3.

    Returns:
        dict: Ответ от модели в виде словаря. Возвращает пустой словарь в случае неудачи.

    Raises:
        Exception: Если возникает ошибка при запросе или парсинге ответа от модели.

    Example:
        >>> model_ask('ru', attempts=2)
        {'ключ': 'значение'}

        >>> model_ask('he')
        {'key': 'value'}
    """
```

**Как работает функция**:

1.  **Определение глобальных переменных**: Функция использует глобальные переменные `model`, `q_ru` и `q_he`, определенные вне функции.
2.  **Выбор запроса в зависимости от языка**: В зависимости от значения параметра `lang` (ru или he), функция выбирает соответствующий запрос (`q_ru` или `q_he`) для отправки модели.
3.  **Отправка запроса к модели**: Функция вызывает метод `ask` объекта `model` (экземпляр класса `GoogleGenerativeAI`) для отправки запроса.
4.  **Обработка ответа**:
    *   Если ответ от модели пустой, функция логирует ошибку и возвращает пустой словарь.
    *   Если ответ получен, функция пытается распарсить его как JSON с помощью `j_loads`.
    *   Если парсинг не удался, функция логирует ошибку и, если количество попыток больше 1, рекурсивно вызывает саму себя с уменьшенным количеством попыток. В противном случае возвращает пустой словарь.
5.  **Возврат результата**: Если ответ успешно получен и распарсен, функция возвращает полученный словарь.

```
    Начало
    │
    ├─► Выбор запроса (q_ru или q_he) в зависимости от языка
    │
    ├─► Отправка запроса к модели (model.ask)
    │
    ├─► Получен ли ответ?
    │   ├──► Нет: Логирование ошибки, возврат {}
    │   └──► Да: Попытка парсинга JSON (j_loads)
    │
    ├─► Успешен ли парсинг?
    │   ├──► Нет: Логирование ошибки
    │   │   ├──► Остались попытки?
    │   │   │   ├──► Да: Рекурсивный вызов model_ask
    │   │   │   └──► Нет: Возврат {}
    │   └──► Да: Возврат распарсенного словаря
    │
    Конец
```

**Примеры**:

```python
# Пример вызова функции с языком 'ru'
response_ru = model_ask(lang='ru')
print(response_ru)

# Пример вызова функции с языком 'he' и 2 попытками
response_he = model_ask(lang='he', attempts=2)
print(response_he)
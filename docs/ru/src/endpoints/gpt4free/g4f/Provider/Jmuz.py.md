# Модуль Jmuz

## Обзор

Модуль `Jmuz` предоставляет класс для взаимодействия с моделью GPT-4o через API jmuz.me. Он наследует класс `OpenaiTemplate` и адаптирует его для работы с особенностями API jmuz. Модуль поддерживает стриминг ответов и предоставляет методы для получения списка доступных моделей.
В данном модуле реализована поддержка различных моделей Gemini и Deepseek.

## Подробней

Модуль `Jmuz` является частью проекта `hypotez` и предназначен для обеспечения доступа к модели GPT-4o через API jmuz.me. Он использует класс `OpenaiTemplate` в качестве основы и адаптирует его для работы с особенностями API jmuz, включая поддержку стриминга ответов и предоставление методов для получения списка доступных моделей. Модуль также предоставляет псевдонимы для различных моделей, таких как Gemini и Deepseek, для упрощения их использования.

## Классы

### `Jmuz`

**Описание**: Класс `Jmuz` предназначен для взаимодействия с API jmuz.me для получения ответов от модели GPT-4o. Он наследует класс `OpenaiTemplate` и адаптирует его для работы с особенностями API jmuz.
**Наследует**:
    `OpenaiTemplate`: Класс, предоставляющий базовую функциональность для взаимодействия с API OpenAI.
**Аттрибуты**:
    - `url` (str): URL для присоединения к Discord-серверу Jmuz.
    - `api_base` (str): Базовый URL API jmuz.
    - `api_key` (str): Ключ API для доступа к API jmuz.
    - `working` (bool): Флаг, указывающий, работает ли провайдер.
    - `supports_system_message` (bool): Флаг, указывающий, поддерживает ли провайдер системные сообщения.
    - `default_model` (str): Модель, используемая по умолчанию.
    - `model_aliases` (dict): Словарь псевдонимов моделей.

**Методы**:
    - `get_models()`: Возвращает список доступных моделей.
    - `create_async_generator()`: Создает асинхронный генератор для получения ответов от модели.

## Функции

### `get_models`

```python
    @classmethod
    def get_models(cls, **kwargs):
        """Возвращает список доступных моделей.

        Args:
            **kwargs: Дополнительные аргументы для передачи в базовый метод `get_models`.

        Returns:
            list: Список доступных моделей.
        """
```

**Назначение**: Метод `get_models` используется для получения списка доступных моделей от API jmuz. Если список моделей еще не был получен, он запрашивается с использованием базового метода `get_models` класса `OpenaiTemplate`.

**Параметры**:
    - `cls` (class): Ссылка на класс `Jmuz`.
    - `**kwargs`: Дополнительные аргументы, которые могут быть переданы в базовый метод `get_models`.

**Возвращает**:
    - `list`: Список доступных моделей.

**Как работает функция**:

1. Проверяется, был ли уже получен список моделей (`cls.models`).
2. Если список моделей не был получен, он запрашивается с использованием метода `super().get_models(api_key=cls.api_key, api_base=cls.api_base)`.
3. Возвращается список моделей.

```mermaid
graph LR
    A[Проверка наличия cls.models] --> B{cls.models is None?};
    B -- True --> C[Получение списка моделей через super().get_models()];
    B -- False --> D[Возврат cls.models];
    C --> D;
```

**Примеры**:

```python
models = Jmuz.get_models()
print(models)
```

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
            cls,
            model: str,
            messages: Messages,
            stream: bool = True,
            api_key: str = None, # Remove api_key from kwargs
            **kwargs
    ) -> AsyncResult:
        """Создает асинхронный генератор для получения ответов от модели.

        Args:
            model (str): Название модели для использования.
            messages (Messages): Список сообщений для отправки в модель.
            stream (bool): Флаг, указывающий, нужно ли использовать стриминг ответов.
            api_key (str, optional): Ключ API. По умолчанию `None`.
            **kwargs: Дополнительные аргументы для передачи в базовый метод `create_async_generator`.

        Returns:
            AsyncResult: Асинхронный генератор для получения ответов от модели.
        """
```

**Назначение**: Метод `create_async_generator` создает асинхронный генератор для получения ответов от модели GPT-4o через API jmuz. Он адаптирует базовый метод `create_async_generator` класса `OpenaiTemplate` для работы с особенностями API jmuz, такими как добавление заголовков авторизации и обработка стриминга ответов.

**Параметры**:
    - `cls` (class): Ссылка на класс `Jmuz`.
    - `model` (str): Название модели для использования.
    - `messages` (Messages): Список сообщений для отправки в модель.
    - `stream` (bool): Флаг, указывающий, нужно ли использовать стриминг ответов.
    - `api_key` (str, optional): Ключ API. По умолчанию `None`.
    - `**kwargs`: Дополнительные аргументы для передачи в базовый метод `create_async_generator`.

**Возвращает**:
    - `AsyncResult`: Асинхронный генератор для получения ответов от модели.

**Как работает функция**:

1. Получается название модели с использованием метода `cls.get_model(model)`.
2. Формируются заголовки запроса, включая авторизационный заголовок с ключом API.
3. Создается асинхронный генератор с использованием метода `super().create_async_generator()`, передавая необходимые параметры, такие как модель, сообщения, базовый URL API, ключ API, флаг стриминга и заголовки.
4. Обрабатываются чанки, полученные от генератора, фильтруя нежелательные префиксы, такие как "Join for free" и "https://discord.gg/".
5. Возвращаются отфильтрованные чанки.

```mermaid
graph LR
    A[Получение названия модели] --> B[Формирование заголовков запроса];
    B --> C[Создание асинхронного генератора через super().create_async_generator()];
    C --> D[Обработка чанков];
    D --> E[Фильтрация нежелательных префиксов];
    E --> F[Возврат отфильтрованных чанков];
```

**Примеры**:

```python
async def main():
    messages = [{"role": "user", "content": "Hello, world!"}]
    async for chunk in Jmuz.create_async_generator(model="gpt-4o", messages=messages):
        print(chunk, end="")

import asyncio
asyncio.run(main())
# Модуль GeekGpt

## Обзор

Модуль `GeekGpt` предоставляет класс `GeekGpt`, который является провайдером для взаимодействия с моделью GeekGpt через API. Он поддерживает потоковую передачу данных, историю сообщений, а также модели `gpt-3.5-turbo` и `gpt-4`.

## Подробней

Этот модуль позволяет использовать GeekGpt в качестве одного из провайдеров для получения ответов от языковой модели. Он отправляет запросы к API `ai.fakeopen.com` и обрабатывает потоковые ответы, предоставляя контент пользователю. Модуль предназначен для интеграции в систему, где требуется гибкое взаимодействие с различными языковыми моделями.

## Классы

### `GeekGpt(AbstractProvider)`

**Описание**: Класс `GeekGpt` является провайдером для работы с моделью GeekGpt.

**Наследует**:

- `AbstractProvider`: Абстрактный базовый класс для всех провайдеров.

**Атрибуты**:

- `url` (str): URL для взаимодействия с GeekGpt (`https://chat.geekgpt.org`).
- `working` (bool): Указывает, работает ли провайдер (по умолчанию `False`).
- `supports_message_history` (bool): Поддержка истории сообщений (установлено в `True`).
- `supports_stream` (bool): Поддержка потоковой передачи данных (установлено в `True`).
- `supports_gpt_35_turbo` (bool): Поддержка модели `gpt-3.5-turbo` (установлено в `True`).
- `supports_gpt_4` (bool): Поддержка модели `gpt-4` (установлено в `True`).

**Методы**:

- `create_completion`: Метод для создания запроса к GeekGpt и получения ответа.

## Функции

### `create_completion`

```python
    @classmethod
    def create_completion(
        cls,
        model: str,
        messages: Messages,
        stream: bool,
        **kwargs
    ) -> CreateResult:
        """
        Создает запрос к GeekGpt и возвращает ответ.

        Args:
            model (str): Название модели для использования.
            messages (Messages): Список сообщений для отправки.
            stream (bool): Флаг, указывающий, использовать ли потоковую передачу.
            **kwargs: Дополнительные аргументы для запроса.

        Returns:
            CreateResult: Результат запроса.

        Raises:
            RuntimeError: Если происходит ошибка при обработке ответа от API.

        """
```

**Назначение**: Метод `create_completion` отправляет запрос к API GeekGpt с заданными параметрами и обрабатывает потоковый ответ, возвращая контент пользователю.

**Параметры**:

- `model` (str): Название модели для использования (например, `"gpt-3.5-turbo"`).
- `messages` (Messages): Список сообщений для отправки в запросе.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
- `**kwargs`: Дополнительные параметры запроса, такие как `temperature`, `presence_penalty`, `top_p` и `frequency_penalty`.

**Возвращает**:

- `CreateResult`: Генератор, выдающий части контента из потокового ответа.

**Вызывает исключения**:

- `RuntimeError`: Если происходит ошибка при обработке JSON-ответа или при извлечении контента.

**Как работает функция**:

1.  **Подготовка данных**: Функция начинает с подготовки данных для запроса, включая сообщения, модель и параметры.
2.  **Формирование JSON**: Данные преобразуются в JSON-формат с использованием `dumps` для минимизации размера запроса.
3.  **Формирование заголовков**: Определяются необходимые заголовки для HTTP-запроса, включая авторизацию и тип контента.
4.  **Отправка запроса**: Отправляется POST-запрос к API `ai.fakeopen.com` с использованием библиотеки `requests`. Устанавливается потоковый режим (`stream=True`).
5.  **Обработка потока**: Функция итерируется по частям ответа, декодирует каждый чанк и извлекает контент.
6.  **Извлечение контента**: Извлекается JSON из каждого чанка и возвращает поле `content`, используя конструкцию `yield`.
7.  **Обработка ошибок**: В случае ошибки при обработке JSON или извлечении контента, вызывается исключение `RuntimeError`.

```
A: Подготовка данных (модель, сообщения, параметры)
|
B: Формирование JSON (dumps)
|
C: Формирование заголовков (headers)
|
D: Отправка POST-запроса к API (requests.post)
|
E: Итерация по чанкам ответа (response.iter_lines)
|
F: Декодирование и извлечение JSON из чанка
|
G: Извлечение контента (content)
|
H: Выдача контента (yield content)
|
I: Обработка ошибок (try...except)
```

**Примеры**:

```python
# Пример вызова функции create_completion
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, world!"}]
stream = True
kwargs = {"temperature": 0.7, "top_p": 0.9}

result = GeekGpt.create_completion(model=model, messages=messages, stream=stream, **kwargs)

for chunk in result:
    print(chunk, end="")
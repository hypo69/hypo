# Модуль `try_xpath_background.js`

## Обзор

Этот JavaScript-модуль отвечает за обработку сообщений, полученных от вкладок расширения `try_xpath`.  Он управляет состоянием всплывающего окна, загрузкой стилей, хранением результатов поиска и отправкой информации во всплывающее окно.  Модуль использует API браузера для взаимодействия с вставками CSS, созданием новых вкладок и работы с хранилищем.


## Переменные

### `tx`

Alias для `tryxpath`.


### `fu`

Alias для `tryxpath.functions`.


### `popupState`

Сохраняет текущее состояние всплывающего окна.


### `popupCss`

Строка CSS стилей для всплывающего окна.


### `results`

Объект, хранящий результаты поиска.


### `css`

Строка CSS стилей для вкладок.


### `attributes`

Объект, содержащий атрибуты для поиска.


## Функции

### `loadDefaultCss`

**Описание**: Загружает стили по умолчанию из файла `/css/try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Текст загруженного CSS.

**Обрабатывает исключения**:
- `Error`: Возникает при ошибке выполнения запроса.


### `genericListener`

**Описание**: Общая функция-обработчик сообщений, определяющая и вызывающая соответствующие обработчики сообщений.

**Параметры**:
- `message` (Object): Сообщение от вкладки.
- `sender` (Object): Объект отправителя сообщения.
- `sendResponse` (Function): Функция для отправки ответа.

**Возвращает**:
- Возвращаемое значение обработчика, если он определен.


### `genericListener.listeners.storePopupState`

**Описание**: Сохраняет состояние всплывающего окна.

**Параметры**:
- `message` (Object): Сообщение с состоянием.


### `genericListener.listeners.requestRestorePopupState`

**Описание**: Отправляет сообщение о восстановлении состояния всплывающего окна в соответствующую вставку.

**Параметры**:
- `message` (Object): Сообщение с запросом.


### `genericListener.listeners.requestInsertStyleToPopup`

**Описание**: Отправляет сообщение с CSS-стилями для вставки во всплывающее окно.

**Параметры**:
- `message` (Object): Сообщение с запросом.


### `genericListener.listeners.showAllResults`

**Описание**: Показывает все результаты поиска в новой вкладке.

**Параметры**:
- `message` (Object): Сообщение с результатами.
- `sender` (Object): Объект отправителя сообщения.


### `genericListener.listeners.loadResults`

**Описание**: Отправляет результаты поиска обратно в вкладку, отправившую запрос.

**Параметры**:
- `message` (Object): Сообщение с запросом.
- `sender` (Object): Объект отправителя сообщения.
- `sendResponse` (Function): Функция для отправки ответа.

**Возвращает**:
- `true`:  Указывает, что обработка завершена успешно.


### `genericListener.listeners.updateCss`

**Описание**: Обновляет CSS-стили в выбранной вкладке.

**Параметры**:
- `message` (Object): Сообщение с обновляемыми CSS-стилями.
- `sender` (Object): Объект отправителя сообщения.

**Обрабатывает исключения**:
- `Error`: Возникает при ошибке в процессе обновления CSS.


### `genericListener.listeners.loadOptions`

**Описание**: Возвращает атрибуты, CSS и CSS всплывающего окна.

**Параметры**:
- `message` (Object): Сообщение с запросом.
- `sender` (Object): Объект отправителя сообщения.
- `sendResponse` (Function): Функция для отправки ответа.

**Возвращает**:
- `true`: Указывает, что обработка завершена успешно.


### `genericListener.listeners.requestSetContentInfo`

**Описание**: Отправляет сообщение для установки информации о содержимом в вкладке.

**Параметры**:
- `message` (Object): Сообщение с запросом.
- `sender` (Object): Объект отправителя сообщения.


## Обработчики событий

### `browser.storage.onChanged`

Обрабатывает изменения в хранилище, обновляя соответствующие переменные.


## Инициализация

Загружает значения из хранилища `browser.storage.sync` и, если необходимо, загружает стили по умолчанию.  Настройка `genericListener` для обработки сообщений.


```
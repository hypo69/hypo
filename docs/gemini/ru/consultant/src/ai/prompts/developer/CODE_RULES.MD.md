# Анализ кода модуля `CODE_RULES.MD`

## Качество кода:
- **Соответствие стандартам**: 7
- **Плюсы**:
    - Подробно описаны требования к форматированию кода, документации и обработке данных.
    - Чётко определены правила использования кавычек, отступов и именования.
    - Представлены примеры документации в формате RST.
- **Минусы**:
    -  Документ содержит инструкции, но не является исполняемым кодом, что затрудняет автоматическую оценку.
    -  Некоторые формулировки в требованиях можно сделать более конкретными.
    -  Отсутствует явная структура Markdown для представления ответа, хотя это и прописано в инструкции.
    -  Инструкции могут быть расширены для более полного охвата различных аспектов кодирования.

## Рекомендации по улучшению:
1.  **Уточнение формулировок**:
    -   Перефразировать "Сохранение комментариев" в "Сохранение и актуализация комментариев" для акцента на поддержание актуальности.
    -   Уточнить, что подразумевается под "выравнивайте названия функций, переменных и импортов" - использовать PEP8.
    -   Детализировать, в каких случаях использовать `j_loads` и `j_loads_ns`, а также как они обрабатывают ошибки.
2.  **Расширение инструкций**:
    -   Добавить требования по обработке исключений и проверки типов (например, использование `isinstance`).
    -   Включить правила по именованию файлов и каталогов.
    -   Указать, как обрабатывать ошибки, связанные с отсутствием файла, и как использовать `try-except` блоки в этом случае.
    -   Добавить требования по использованию `async` и `await` в асинхронном коде.
    -   Расширить примеры документации, включив больше сложных случаев (например, работу с декораторами и контекстными менеджерами).
3. **Структура ответа**:
    -    Усилить требования к структуре ответа, используя конкретные примеры.
    -    Добавить в структуру ответа примеры как должен выглядеть блок *Original code*, *Improved code*, *Changes*.
    -    В разделе **Changes**  выделить не только изменения, но и причины их внесения, включая цитаты из текущей инструкции.
4. **Примеры**:
    - Добавить примеры использования `j_loads`, `j_loads_ns`.
    - Уточнить примеры RST документации, указав разницу между функциями, методами и классами.
5. **Прочее**:
    - Рассмотреть возможность использования `black` и `pylint` для автоматической проверки кода.
    - Уточнить, когда использовать `Optional` и как это связано с типами.

## Оптимизированный код:
```markdown
### **Инструкция: Обработка кода и документации**

---

#### **Основные требования**:

1. **Формат документации**:
   - Всегда используйте одинарные кавычки (`'`) в Python-коде. Например:
     ```python
     a = 'A1' # Используем одинарные кавычки для строковых литералов
     b = ['a', 'b'] # Используем одинарные кавычки для элементов списка
     c = {'key': 'value'} # Используем одинарные кавычки для ключей и значений словаря
     ```
   - Двойные кавычки (`"`) используйте только для операций вывода:
     ```python
     print("Hello, world!") # Двойные кавычки для вывода
     input("Введите имя: ")  # Двойные кавычки для ввода
     from src.logger import logger
     logger.error("Ошибка") # Двойные кавычки для логирования ошибок
     ```

2. **Сохранение и актуализация комментариев**:
   - Все существующие комментарии после `#` должны оставаться неизменными.
   - В случае изменений кода, добавляйте построчные комментарии с использованием символа `#`, объясняющие изменения.

3. **Обработка данных**:
    - Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load`.  
      - `j_loads` для загрузки данных из файла.
      - `j_loads_ns` для загрузки данных из строки.
   - Сохраняйте любые `...` в коде как маркеры без изменений.
   - Импортируйте `logger` только из `src.logger`:
     ```python
     from src.logger import logger # Правильный импорт логгера
     ```

4. **Анализ структуры**:
   - Проверьте наличие всех необходимых импортов.
   - Выравнивайте названия функций, переменных и импортов в соответствии со стандартом **PEP8**.

5. **Рефакторинг и улучшения**:
    - Добавляйте комментарии в формате **RST** для всех функций, методов и классов.
    - Используйте `from src.logger.logger import logger` для логирования ошибок.
    - Избегайте чрезмерного использования стандартных блоков `try-except`, отдавая предпочтение обработке ошибок через `logger.error`, за исключением случаев, когда необходимо отлавливать специфические исключения.
     -   При работе с файлами, используйте `try-except` для отлова `FileNotFoundError`, а также для логирования других ошибок.
6. **Примеры RST-документации**:
    **Пример модуля**:
   ```python
   """
   Модуль для работы с ассистентом программиста
   =================================================

   Модуль содержит класс :class:`CodeAssistant`, который используется для взаимодействия с различными AI-моделями
   (например, Google Gemini и OpenAI) и выполнения задач обработки кода.

   Пример использования
   ----------------------
   .. code-block:: python

       assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
       assistant.process_files()
   """
   ```

   **Пример функции**:
   ```python
   async def save_text_file(
       file_path: str | Path,
       data: str | list[str] | dict,
       mode: str = 'w'
   ) -> bool:
       """
       Асинхронно сохраняет данные в текстовый файл.

       :param file_path: Путь к файлу для сохранения.
       :type file_path: str | Path
       :param data: Данные для записи.
       :type data: str | list[str] | dict
       :param mode: Режим записи ('w' для записи, 'a' для добавления).
       :type mode: str, optional
       :return: True, если файл успешно сохранён, иначе False.
       :rtype: bool
       :raises Exception: В случае ошибки при записи в файл.
       :raises FileNotFoundError: В случае, если файл не найден.

       Пример:
           >>> from pathlib import Path
           >>> file_path = Path('example.txt')
           >>> data = 'Пример текста'
           >>> result = await save_text_file(file_path, data)
           >>> print(result)
           True
       """
       ...
   ```

7. **Финальный код**:
   - Полный (оригинальный и улучшенный) код должен быть представлен в одном блоке.
   - Все изменённые участки кода должны быть снабжены построчными комментариями.

8. **Рекомендации по улучшению**:
    - Следовать стандартам **PEP8** для форматирования.
    - Избегать неясных формулировок в комментариях, таких как "получаем" или "делаем". Вместо этого использовать более точные описания: "проверяем", "отправляем", "выполняем".
    - Использовать `isinstance` для проверки типов переменных.
    - Обрабатывать исключения `FileNotFoundError` при работе с файлами.
    -  Использовать `black` и `pylint` для автоматической проверки кода.

---

#### **Структура ответа**:

1.  **Заголовок**:
    - Анализ кода модуля `<module_name>`

2.  **Качество кода**:
    - **Соответствие стандартам**: Оценка от 1 до 10
    - **Плюсы**:
        - <Положительные стороны кода>
    - **Минусы**:
        - <Отрицательные стороны кода>

3.  **Рекомендации по улучшению**:
    - <Подробные советы и описания необходимых изменений>

4. **Оптимизированный код**:
     -  **Original code**:
     ```
      <Блок оригинального кода без изменений>
     ```
    -   **Improved code**:
        ```
        <Полностью переработанный код, снабжённый комментариями в формате RST.>
        ```
    - **Changes**:
    ```
        <A detailed list of all modifications, including explanations and justifications.>
    ```
```
**Changes**:

-   **Уточнено**: Раздел "Сохранение комментариев" перефразирован в "Сохранение и актуализация комментариев" для акцента на поддержание актуальности.
-   **Уточнено**: Добавлено уточнение про **PEP8** для выравнивания названия функций, переменных и импортов.
-   **Уточнено**: Детализировано использование `j_loads` и `j_loads_ns`, а также обработка ошибок.
-   **Добавлено**: Требования по обработке исключений и проверки типов (`isinstance`).
-   **Добавлено**: Указания по использованию `try-except` для отлова `FileNotFoundError`.
-   **Добавлено**: Рекомендации по использованию `black` и `pylint`.
-   **Добавлено**: В раздел "Структура ответа" добавлены блоки **Original code**, **Improved code**, **Changes**, с примерами.
-   **Добавлено**: Уточнено, когда использовать `Optional` и как это связано с типами.
-   **Добавлено**: Более точное описание того, как использовать `try-except` и логгирования ошибок через `logger.error`.
-   **Изменено**: Уточнены примеры RST-документации, добавлено описание возможных исключений.
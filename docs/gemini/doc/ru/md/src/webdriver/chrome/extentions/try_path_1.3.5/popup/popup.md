# Модуль `popup.js`

## Обзор

Этот JavaScript-файл реализует функциональность всплывающего окна расширения браузера, предназначенного для управления и отображения результатов поиска XPath. Он обрабатывает пользовательский ввод, отправляет запросы на выполнение XPath в активной вкладке, получает результаты и отображает их в табличной форме.  Файл содержит функции для управления отображением различных секций, обработки ошибок и хранения состояния.

## Функции

### `sendToActiveTab`

**Описание**: Отправляет сообщение в активную вкладку текущего окна.

**Параметры**:

- `msg` (объект): Сообщение для отправки.
- `opts` (объект, необязательно): Дополнительные параметры для сообщения (например, `frameId`). По умолчанию пусто.

**Возвращает**:
- `Promise`: Результат выполнения `browser.tabs.sendMessage`.


### `sendToSpecifiedFrame`

**Описание**: Отправляет сообщение в указанную вкладку и фрейм.

**Параметры**:

- `msg` (объект): Сообщение для отправки.

**Возвращает**:
- `Promise`: Результат выполнения `browser.tabs.executeScript`, `browser.tabs.sendMessage`. Возвращает `Promise.resolve()` в случае успешного выполнения, или вызывается функция обработки исключений.


### `collectPopupState`

**Описание**: Считывает текущее состояние всплывающего окна.

**Возвращает**:
- `объект`: Объект, содержащий текущее состояние всплывающего окна (значения элементов управления).


### `changeContextVisible`

**Описание**: Управляет отображением блока контекста в соответствии с состоянием флажка `contextCheckbox`.

**Параметры**:

- Нет

**Возвращает**:
- Нет


### `changeResolverVisible`, `changeFrameIdVisible`, `changeFrameDesignationVisible`, `changeHelpVisible`

**Описание**:  Аналогичные функции для управления отображением других блоков.


### `makeExecuteMessage`

**Описание**: Создает сообщение для отправки в активную вкладку с запросом на выполнение XPath.

**Возвращает**:
- `объект`: Объект, содержащий данные запроса.


### `getSpecifiedFrameId`

**Описание**: Возвращает идентификатор фрейма, выбранный пользователем в списке или из текстового поля.

**Возвращает**:
- `число`: Идентификатор фрейма.


### `execContentScript`

**Описание**: Выполняет скрипты в активной вкладке.

**Возвращает**:
- `Promise`: Результат выполнения `browser.tabs.executeScript`.


### `sendExecute`

**Описание**: Отправляет запрос на выполнение XPath в указанный фрейм.

**Параметры**:

- Нет

**Возвращает**:
- Нет


### `handleExprEnter`

**Описание**: Обработчик события нажатия Enter в поле ввода выражения XPath.

**Параметры**:

- `event` (объект): Объект события.

**Возвращает**:
- Нет


### `showDetailsPage`

**Описание**: Отображает страницу результатов поиска, начиная с определенного индекса.

**Параметры**:

- `index` (число): Индекс страницы.

**Возвращает**:
- Нет


### `showError`

**Описание**: Отображает сообщение об ошибке в всплывающем окне.

**Параметры**:

- `message` (строка): Сообщение об ошибке.
- `frameId` (строка или число): Идентификатор фрейма, связанный с ошибкой.


**Возвращает**:
- Нет


### `genericListener`

**Описание**: Общий обработчик сообщений, отправленных из контентной страницы.

**Параметры**:

- `message`, `sender`, `sendResponse`

**Возвращает**:
- `Promise` или `undefined`

**Вызывает исключения**:
- Нет

### Остальные функции

Остальные функции (`genericListener.listeners.*`, ... ) реализуют различные обработки сообщений и взаимодействие с вкладками браузера.


## Обработчики событий


### `browser.runtime.onMessage.addListener`


**Описание**: Регистрирует обработчик для сообщений, отправленных из различных источников.

**Параметры**:
- `genericListener` (функция): функция обработки сообщений.

**Возвращает**:
- Нет

##  Структура элементов

Документация содержит описания элементов HTML, используемых для отображения и управления данными.


```
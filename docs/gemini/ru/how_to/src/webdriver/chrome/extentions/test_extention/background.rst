Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код служит обработчиком сообщений для расширения Chrome. Он ожидает сообщения с действием 'collectData', содержащим URL, и отправляет собранные ранее данные на сервер по этому URL.  Функция `sendDataToServer` отвечает за отправку данных.

Шаги выполнения
-------------------------
1. **Обработка события щелчка по значку расширения:** Когда пользователь щелкает по значку расширения, вызывается функция `chrome.browserAction.onClicked.addListener`.
2. **Отправка сообщения содержащего URL:** Функция `chrome.tabs.sendMessage` отправляет сообщение с типом `collectData` и URL текущей вкладки в контентную страницу.
3. **Обработка сообщения `collectData`:** Функция `chrome.runtime.onMessage.addListener` слушает сообщения с действием `collectData`.
4. **Получение данных:** Функция `sendDataToServer` получает URL из сообщения.
5. **Получение сохраненных данных:**  Функция `chrome.storage.local.get` извлекает сохраненные данные из хранилища расширения.
6. **Проверка наличия данных:** Если сохраненные данные существуют, код продолжает выполнение. В противном случае выводится сообщение об ошибке.
7. **Отправка данных на сервер:** Функция `fetch` отправляет POST запрос к серверу, содержащий данные, предварительно сериализованные в JSON.
8. **Обработка ответа сервера:** Обрабатываются ответы с кодами статуса отличными от 2xx. В случае успеха выводится сообщение об успешной отправке данных, в противном случае – об ошибке.


Пример использования
-------------------------
.. code-block:: javascript
    // В файле content.js (или аналогичном)
    chrome.runtime.sendMessage({ action: 'collectData', url: window.location.href });


    // В файле background.js (или другом файле, обработчик сообщений)
    chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
        if (request.action === 'collectData') {
            sendDataToServer(request.url);
        }
    });

    // ... (функция sendDataToServer как описано в коде)
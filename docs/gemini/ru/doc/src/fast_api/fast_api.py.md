# Модуль `fast_api`

## Обзор

Модуль `fast_api` представляет собой FastAPI сервер с XML-RPC интерфейсом для удалённого управления. Он позволяет запускать, останавливать и управлять серверами FastAPI через командную строку или XML-RPC запросы.

## Подробней

Этот модуль предоставляет возможность динамического добавления маршрутов к FastAPI приложению, а также управления серверами через XML-RPC. Он использует библиотеку `uvicorn` для запуска FastAPI серверов асинхронно и предоставляет интерфейс командной строки для управления серверами.

## Классы

### `FastApiServer`

**Описание**: Класс, реализующий FastAPI сервер с паттерном Singleton.

**Методы**:
- `__init__`: Инициализирует экземпляр класса, добавляет маршруты `/hello` и `/post`.
- `add_route`: Добавляет маршрут к FastAPI приложению.
- `_start_server`: Запускает uvicorn сервер асинхронно.
- `start`: Запускает FastAPI сервер на указанном порту.
- `stop`: Останавливает FastAPI сервер на указанном порту.
- `stop_all`: Останавливает все запущенные сервера.
- `get_servers_status`: Возвращает статус всех серверов.
- `get_routes`: Возвращает список всех роутов.
- `get_app`: Возвращает FastAPI приложение.
- `add_new_route`: Добавляет новый маршрут к уже работающему приложению.

**Параметры**:
- `host` (str): Хост для запуска сервера. По умолчанию `"127.0.0.1"`.
- `title` (str): Заголовок FastAPI приложения. По умолчанию `"FastAPI RPC Server"`.

**Примеры**
```python
from src.fast_api.fast_api import FastApiServer

server = FastApiServer()
server.start(port=8000)
# ...
server.stop(port=8000)
```

### `CommandHandler`

**Описание**: Обработчик команд для FastAPI сервера через XML-RPC.

**Методы**:
- `__init__`: Инициализирует XML-RPC сервер.
- `start_server`: Запускает FastAPI сервер.
- `stop_server`: Останавливает FastAPI сервер.
- `stop_all_servers`: Останавливает все запущенные FastAPI сервера.
- `status_servers`: Показывает статус серверов.
- `get_routes`: Показывает все роуты.
- `add_new_route`: Добавляет новый роут к серверу.
- `shutdown`: Останавливает все сервера и завершает работу RPC сервера.

**Параметры**:
- `rpc_port` (int): Порт для запуска XML-RPC сервера. По умолчанию `9000`.

**Примеры**
```python
from src.fast_api.fast_api import CommandHandler

command_handler = CommandHandler()
command_handler.start_server(port=8000, host='127.0.0.1')
# ...
command_handler.stop_server(port=8000)
```

## Функции

### `telegram_webhook`

```python
def telegram_webhook():
    """"""
    return 'Hello, World!'
```

**Описание**: Функция-заглушка для telegram webhook.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `str`: `"Hello, World!"`.

**Как работает функция**:
Функция просто возвращает строку "Hello, World!".

### `test_function`

```python
def test_function():
    return "It is working!!!"
```

**Описание**: Тестовая функция для проверки работы сервера.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `str`: `"It is working!!!"`.

**Как работает функция**:
Функция просто возвращает строку "It is working!!!".

### `test_post`

```python
def test_post(data: Dict[str, str]):
    return {"result": "post ok", "data": data}
```

**Описание**: Тестовая функция для проверки POST запросов.

**Параметры**:
- `data` (Dict[str, str]): Словарь с данными, отправленными в POST запросе.

**Возвращает**:
- `dict`: Словарь с результатом "post ok" и переданными данными.

**Как работает функция**:
Функция принимает словарь с данными и возвращает словарь, содержащий результат "post ok" и переданные данные.

### `start_server`

```python
def start_server(port: int, host: str):
    """Запускает FastAPI сервер на указанном порту."""
```

**Описание**: Запускает FastAPI сервер на указанном порту.

**Параметры**:
- `port` (int): Порт для запуска сервера.
- `host` (str): Хост для запуска сервера.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при запуске FastAPI сервера.

**Как работает функция**:
Функция создает экземпляр класса `FastApiServer`, если он еще не создан, и запускает сервер на указанном порту.

### `stop_server`

```python
def stop_server(port: int):
    """Останавливает FastAPI сервер на указанном порту."""
```

**Описание**: Останавливает FastAPI сервер на указанном порту.

**Параметры**:
- `port` (int): Порт сервера, который нужно остановить.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при остановке FastAPI сервера.

**Как работает функция**:
Функция останавливает FastAPI сервер на указанном порту, если он запущен.

### `stop_all_servers`

```python
def stop_all_servers():
    """Останавливает все запущенные FastAPI сервера."""
```

**Описание**: Останавливает все запущенные FastAPI сервера.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при остановке всех FastAPI серверов.

**Как работает функция**:
Функция останавливает все запущенные FastAPI сервера.

### `status_servers`

```python
def status_servers():
    """Показывает статус серверов."""
```

**Описание**: Выводит статус всех запущенных серверов.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `None`

**Как работает функция**:
Функция получает статус всех запущенных серверов и выводит их в консоль.

### `get_routes`

```python
def get_routes():
    """Показывает все роуты."""
```

**Описание**: Выводит список всех зарегистрированных маршрутов.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `None`

**Как работает функция**:
Функция получает список всех зарегистрированных маршрутов и выводит их в консоль.

### `add_new_route`

```python
def add_new_route(path: str, module_name: str, func_name: str, methods: List[str] = ["GET"]):
    """Добавляет новый роут к серверу."""
```

**Описание**: Добавляет новый маршрут к FastAPI серверу.

**Параметры**:
- `path` (str): Путь для нового маршрута.
- `module_name` (str): Имя модуля, содержащего функцию обработчик.
- `func_name` (str): Имя функции обработчика.
- `methods` (List[str], optional): Список HTTP методов, поддерживаемых маршрутом. По умолчанию `["GET"]`.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при добавлении нового маршрута.

**Как работает функция**:
Функция добавляет новый маршрут к FastAPI серверу, динамически импортируя модуль и получая функцию обработчик.

### `parse_port_range`

```python
def parse_port_range(range_str):
    """Разбирает строку с диапазоном портов."""
```

**Описание**: Разбирает строку с диапазоном портов.

**Параметры**:
- `range_str` (str): Строка с диапазоном портов, например `"8000-8005"` или `"8000"`.

**Возвращает**:
- `List[int]`: Список портов в диапазоне.

**Как работает функция**:
Функция разбирает строку с диапазоном портов и возвращает список портов в этом диапазоне.

### `display_menu`

```python
def display_menu():
    """Выводит меню с доступными командами."""
```

**Описание**: Выводит меню с доступными командами для управления сервером.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `None`

**Как работает функция**:
Функция выводит в консоль список доступных команд и их описание.

### `main`

```python
def main():
    """Основная функция управления сервером."""
```

**Описание**: Основная функция управления сервером.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `None`

**Как работает функция**:
Функция создает экземпляр класса `CommandHandler`, выводит меню с доступными командами и обрабатывает ввод пользователя.
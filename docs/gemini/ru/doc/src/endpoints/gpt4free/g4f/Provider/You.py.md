# Модуль `You.py` для работы с You.com

## Обзор

Модуль предоставляет асинхронный интерфейс для взаимодействия с You.com, включая поддержку текстовых и графических запросов. Он позволяет использовать различные модели, такие как GPT-4o, Grok-2, Claude-3 и другие. Модуль также обеспечивает загрузку изображений и обработку ответов в реальном времени.

## Подробней

Модуль `You.py` предназначен для интеграции с платформой You.com и предоставляет возможность отправлять запросы к различным моделям ИИ, включая текстовые и графические запросы. Он поддерживает потоковую передачу ответов и обработку ошибок. Модуль использует асинхронные запросы для обеспечения высокой производительности и может работать с прокси-серверами.

## Классы

### `You`

**Описание**: Класс `You` предоставляет функциональность для взаимодействия с You.com.

**Принцип работы**:
Класс `You` наследует от `AsyncGeneratorProvider` и `ProviderModelMixin` и предоставляет методы для создания асинхронного генератора запросов к You.com. Он поддерживает различные модели, загрузку изображений и обработку ответов в реальном времени.

**Наследует**:
- `AsyncGeneratorProvider`: Предоставляет базовую функциональность для асинхронных генераторов.
- `ProviderModelMixin`: Предоставляет методы для работы с моделями.

**Атрибуты**:
- `label` (str): Метка провайдера ("You.com").
- `url` (str): URL You.com ("https://you.com").
- `working` (bool): Указывает, работает ли провайдер (True).
- `default_model` (str): Модель по умолчанию ("gpt-4o-mini").
- `default_vision_model` (str): Модель для работы с изображениями по умолчанию ("agent").
- `image_models` (List[str]): Список моделей для работы с изображениями (["dall-e"]).
- `models` (List[str]): Список поддерживаемых моделей.
- `_cookies` (Optional[Cookies]): Куки для запросов.
- `_cookies_used` (int): Счетчик использованных куки.
- `_telemetry_ids` (List[str]): Список идентификаторов телеметрии.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для отправки запросов.
- `upload_file`: Загружает файл на сервер You.com.

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    stream: bool = True,
    image: ImageType = None,
    image_name: str = None,
    proxy: str = None,
    timeout: int = 240,
    chat_mode: str = "default",
    cookies: Cookies = None,
    **kwargs,
) -> AsyncResult:
    """Создает асинхронный генератор для отправки запросов к You.com.

    Args:
        cls (Type[You]): Класс `You`.
        model (str): Модель для использования.
        messages (Messages): Список сообщений для отправки.
        stream (bool, optional): Включить потоковую передачу ответов. По умолчанию `True`.
        image (ImageType, optional): Изображение для отправки. По умолчанию `None`.
        image_name (str, optional): Имя изображения. По умолчанию `None`.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания запроса в секундах. По умолчанию 240.
        chat_mode (str, optional): Режим чата. По умолчанию "default".
        cookies (Cookies, optional): Куки для запросов. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор для получения ответов.

    Как работает функция:
    1. **Определение режима чата**: Функция определяет режим чата в зависимости от наличия изображения или выбранной модели.
    2. **Получение куки**: Если куки не предоставлены, функция пытается получить их из файла или из браузера с помощью `get_nodriver`.
    3. **Создание сессии**: Функция создает асинхронную сессию с использованием `StreamSession` для выполнения запросов.
    4. **Загрузка файла**: Если предоставлено изображение, функция загружает его на сервер You.com с помощью метода `upload_file`.
    5. **Формирование данных**: Функция формирует данные запроса, включая сообщения, режим чата и выбранную модель.
    6. **Отправка запроса**: Функция отправляет GET-запрос к API `streamingSearch` с сформированными данными и заголовками.
    7. **Обработка ответов**: Функция итерирует по строкам ответа и обрабатывает события, такие как ошибки, обновления чата и токены.
    8. **Генерация результатов**: Функция генерирует результаты в зависимости от типа события и режима чата.

    ASCII flowchart:

    Определение режима чата
    │
    └─── Получение куки (если необходимо)
    │
    └─── Создание сессии
    │
    └─── Загрузка файла (если есть изображение)
    │
    └─── Формирование данных запроса
    │
    └─── Отправка GET-запроса к API
    │
    └─── Обработка ответов
    │
    └─── Генерация результатов

    Примеры:
        >>> messages = [{"role": "user", "content": "Hello, world!"}]
        >>> async for message in You.create_async_generator(model="gpt-4o-mini", messages=messages):
        ...     print(message)

        >>> messages = [{"role": "user", "content": "Draw a cat."}]
        >>> async for message in You.create_async_generator(model="dall-e", messages=messages, image="cat.jpg"):
        ...     print(message)
    """
    ...
```

### `upload_file`

```python
@classmethod
async def upload_file(cls, client: StreamSession, cookies: Cookies, file: bytes, filename: str = None) -> dict:
    """Загружает файл на сервер You.com.

    Args:
        cls (Type[You]): Класс `You`.
        client (StreamSession): Асинхронная сессия для выполнения запросов.
        cookies (Cookies): Куки для запросов.
        file (bytes): Файл для загрузки в виде байтов.
        filename (str, optional): Имя файла. По умолчанию `None`.

    Returns:
        dict: Результат загрузки файла.

    Как работает функция:
    1. **Получение nonce**: Функция получает nonce (одноразовый токен) с сервера You.com для защиты от CSRF-атак.
    2. **Формирование данных**: Функция формирует данные запроса, включая файл, тип содержимого и имя файла.
    3. **Отправка запроса**: Функция отправляет POST-запрос к API `upload` с сформированными данными и заголовками.
    4. **Обработка ответа**: Функция обрабатывает ответ сервера и возвращает результат в виде словаря.

    ASCII flowchart:

    Получение nonce
    │
    └─── Формирование данных запроса
    │
    └─── Отправка POST-запроса к API
    │
    └─── Обработка ответа

    Примеры:
        >>> import asyncio
        >>> from aiohttp import ClientSession
        >>> from src.cookies import Cookies

        >>> async def main():
        ...     async with ClientSession() as session:
        ...         cookies = Cookies({})
        ...         file = b"example data"
        ...         result = await You.upload_file(session, cookies, file, "example.txt")
        ...         print(result)
        >>> asyncio.run(main())
    """
    ...
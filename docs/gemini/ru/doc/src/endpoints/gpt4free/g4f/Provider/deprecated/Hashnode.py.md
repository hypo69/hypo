# Модуль для работы с Hashnode API
=================================

Модуль содержит класс `Hashnode`, который предоставляет интерфейс для взаимодействия с API Hashnode с целью генерации текста на основе предоставленных сообщений и поисковых данных.

## Обзор

Модуль `Hashnode` является частью проекта `hypotez` и предназначен для интеграции с платформой Hashnode. Он предоставляет функциональность для отправки запросов к API Hashnode, используя предоставленные сообщения, поисковые данные и другие параметры, чтобы получить сгенерированный текст. Этот модуль также поддерживает использование прокси-серверов и асинхронные запросы для обеспечения эффективной работы. Расположение файла в проекте указывает на то, что он является частью подсистемы `gpt4free`, отвечающей за предоставление доступа к различным API для генерации текста.

## Подробнее

Модуль `Hashnode` предоставляет класс `Hashnode`, который наследуется от `AsyncGeneratorProvider`. Он использует библиотеку `aiohttp` для выполнения асинхронных HTTP-запросов к API Hashnode. Класс `Hashnode` также предоставляет методы для настройки заголовков запросов, формирования данных запроса и обработки ответов от API Hashnode.

## Классы

### `SearchTypes`

**Описание**: Класс `SearchTypes` предоставляет статические атрибуты, определяющие типы поиска, поддерживаемые API Hashnode.

    **Принцип работы**:
    Класс `SearchTypes` определяет три типа поиска: `quick`, `code` и `websearch`. Эти типы поиска используются для указания типа поиска, который должен быть выполнен API Hashnode.

**Атрибуты**:

-   `quick` (str): Тип быстрого поиска.
-   `code` (str): Тип поиска кода.
-   `websearch` (str): Тип веб-поиска.

### `Hashnode`

**Описание**: Класс `Hashnode` предоставляет интерфейс для взаимодействия с API Hashnode.

**Наследует**:

-   `AsyncGeneratorProvider`: Класс `Hashnode` наследует функциональность асинхронного генератора от класса `AsyncGeneratorProvider`.

**Атрибуты**:

-   `url` (str): URL-адрес API Hashnode.
-   `working` (bool): Флаг, указывающий, работает ли провайдер.
-   `supports_message_history` (bool): Флаг, указывающий, поддерживает ли провайдер историю сообщений.
-   `supports_gpt_35_turbo` (bool): Флаг, указывающий, поддерживает ли провайдер модель GPT-3.5 Turbo.
-   `_sources` (list): Список источников поисковых данных.

**Методы**:

-   `create_async_generator`: Создает асинхронный генератор для получения сгенерированного текста от API Hashnode.
-   `get_sources`: Возвращает список источников поисковых данных.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    search_type: str = SearchTypes.websearch,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения сгенерированного текста от API Hashnode.

    Args:
        model (str): Модель для использования.
        messages (Messages): Список сообщений для отправки в API.
        search_type (str): Тип поиска для выполнения. По умолчанию `SearchTypes.websearch`.
        proxy (str): URL-адрес прокси-сервера для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий сгенерированный текст.

    Raises:
        aiohttp.ClientResponseError: Если возникает ошибка при выполнении HTTP-запроса.

    """
```

**Назначение**: Функция `create_async_generator` создает асинхронный генератор, который отправляет запросы к API Hashnode и возвращает сгенерированный текст.

**Параметры**:

-   `cls` (class): Ссылка на класс `Hashnode`.
-   `model` (str): Модель для использования при генерации текста.
-   `messages` (Messages): Список сообщений, используемых в качестве контекста для генерации текста.
-   `search_type` (str): Тип поиска, который будет использоваться для получения поисковых данных. По умолчанию используется `SearchTypes.websearch`.
-   `proxy` (str): URL-адрес прокси-сервера, который будет использоваться для отправки запросов. По умолчанию `None`.
-   `**kwargs`: Дополнительные аргументы, которые могут быть переданы в API Hashnode.

**Возвращает**:

-   `AsyncResult`: Асинхронный генератор, который возвращает сгенерированный текст.

**Как работает функция**:

1.  **Определение заголовков**: Функция определяет заголовки HTTP-запроса, включая User-Agent, Accept, Referer и Content-Type.
2.  **Создание сессии**: Функция создает асинхронную HTTP-сессию с использованием библиотеки `aiohttp`.
3.  **Получение поисковых данных**: Если `search_type` установлен в `websearch`, функция отправляет запрос к API Hashnode для получения поисковых данных на основе предоставленного сообщения.
4.  **Формирование данных запроса**: Функция формирует данные запроса, включая идентификатор чата, историю сообщений, сообщение, тип поиска, URL-адрес для сканирования и результаты поиска.
5.  **Отправка запроса и получение ответа**: Функция отправляет POST-запрос к API Hashnode с сформированными данными и получает ответ.
6.  **Генерация текста**: Функция итерируется по содержимому ответа и декодирует каждый чанк в текст.
7.  **Возврат результата**: Функция возвращает асинхронный генератор, который возвращает сгенерированный текст.

```
    Определение заголовков --> Создание сессии
        |                                       |
        | Если search_type == "websearch"       | Нет
        |                                       |
        ↓                                       |
    Получение поисковых данных                   |
        |                                       |
        ↓                                       |
    Формирование данных запроса                  |
        |                                       |
        ↓                                       |
    Отправка запроса и получение ответа          |
        |                                       |
        ↓                                       |
    Генерация текста                             |
        |                                       |
        ↓                                       |
    Возврат асинхронного генератора с текстом    |
```

**Примеры**:

```python
# Пример вызова функции create_async_generator
async for chunk in Hashnode.create_async_generator(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "Hello, how are you?"}],
    search_type=SearchTypes.websearch,
    proxy="http://proxy.example.com"
):
    print(chunk)
```

### `get_sources`

```python
    @classmethod
    def get_sources(cls) -> list:
        """
        Возвращает список источников поисковых данных.

        Returns:
            list: Список словарей, содержащих заголовок и URL-адрес каждого источника.
        """
```

**Назначение**: Функция `get_sources` возвращает список источников поисковых данных, полученных из API Hashnode.

**Параметры**:

-   `cls` (class): Ссылка на класс `Hashnode`.

**Возвращает**:

-   `list`: Список словарей, содержащих заголовок и URL-адрес каждого источника.

**Как работает функция**:

1.  **Преобразование данных**: Функция преобразует список источников, хранящихся в атрибуте `_sources`, в список словарей, содержащих заголовок и URL-адрес каждого источника.
2.  **Возврат результата**: Функция возвращает список словарей.

```
    Преобразование данных --> Возврат списка источников
```

**Примеры**:

```python
# Пример вызова функции get_sources
sources = Hashnode.get_sources()
print(sources)
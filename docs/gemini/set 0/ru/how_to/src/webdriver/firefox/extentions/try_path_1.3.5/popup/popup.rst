Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код JavaScript управляет поведением всплывающего окна (popup) расширения Firefox.  Он отвечает за взаимодействие с активной вкладкой браузера и обработку сообщений,  связанных с выполнением XPath-запросов. Код устанавливает обработчики событий для различных элементов интерфейса всплывающего окна, обрабатывает запросы к странице, отображает результаты, управляет отображением различных блоков и отправляет запросы на выполнение XPath на странице.

Шаги выполнения
-------------------------
1. **Инициализация элементов:**  Код получает доступ к элементам всплывающего окна (кнопки, поля ввода, списки, таблицы результатов) с помощью `document.getElementById()`.  Он сохраняет ссылки на эти элементы в переменных.

2. **Обработка событий:** Код устанавливает обработчики событий для кликов по кнопкам, ввода в поля и т.д.  Это включает `click`, `keypress` для различных элементов управления.

3. **`sendToActiveTab` и `sendToSpecifiedFrame`:** Эти функции отправляют сообщения в активную вкладку или в указанную рамку. Функция `sendToActiveTab` отправляет сообщения в активную вкладку,  `sendToSpecifiedFrame` отправляет запросы на определенный `frameId`, вызывая скрипты в этой рамке.

4. **`makeExecuteMessage`:** Эта функция формирует сообщение для отправки в активную вкладку, содержащее XPath запрос и настройки.

5. **`execContentScript`:** Выполняет скрипты `/scripts/try_xpath_functions.js` и `/scripts/try_xpath_content.js` на странице, чтобы подготовить ее к выполнению запросов.

6. **`sendExecute`:** Отправляет сформированное сообщение с запросом в активную вкладку (исполнение запроса XPath).

7. **`showResultsInPopup`:** Обрабатывает ответ от активной вкладки, обновляет таблицу результатов в всплывающем окне и отображает результаты поиска.

8. **`genericListener`:**  Центральная функция для обработки сообщений, которые получает всплывающее окно от страницы.  Она обрабатывает события, например, `showResultsInPopup`, `restorePopupState`, `insertStyleToPopup` и др.

9. **`collectPopupState`:** Собирает текущее состояние всплывающего окна для сохранения.

10. **`showDetailsPage`:**  Отображает результаты поиска в таблице в всплывающем окне.  Функция обрабатывает пагинацию (странирование) результатов, если их слишком много.

11. **`showError`:** Обрабатывает ошибки при выполнении запроса.  Выводит сообщение об ошибке в popup.

12. **Сохранение состояния:**  Перед закрытием всплывающего окна сохраняет его текущее состояние (`storePopupState`).

13. **Восстановление состояния:**  При открытии всплывающего окна восстанавливает его состояние (`restorePopupState`).


Пример использования
-------------------------
.. code-block:: javascript
    
    // Предположим, у вас есть элементы HTML:
    // <input id="main-expression" type="text">
    // <button id="execute">Выполнить</button>

    // Чтобы отправить запрос XPath:
    document.getElementById("execute").addEventListener("click", function() {
        var expression = document.getElementById("main-expression").value;
        // ... (Код для формирования сообщения, аналогично makeExecuteMessage)
        sendToSpecifiedFrame(message);
    });
# Модуль управления параметрами Fast API сервера

## Обзор

Модуль `src.fast_api.main` предоставляет интерфейс командной строки для управления серверами Fast API. Он позволяет запускать, останавливать, просматривать статус и добавлять новые маршруты к серверам. Модуль использует класс `CommandHandler` из модуля `src.fast_api.fast_api` для выполнения команд.

## Подробней

Этот модуль является основным скриптом для управления серверами Fast API через командную строку. Он предоставляет набор команд для запуска, остановки, получения статуса и настройки маршрутов серверов. Он включает в себя функцию `display_menu` для отображения доступных команд и функцию `main`, которая обрабатывает ввод пользователя и вызывает соответствующие методы `CommandHandler`.
Основная цель этого модуля — предоставить удобный интерфейс командной строки для управления серверами Fast API, позволяя пользователям легко настраивать и контролировать свои серверы.

## Функции

### `display_menu`

```python
def display_menu():
    """Выводит меню с доступными командами."""
    ...
```

**Назначение**: Выводит в консоль список доступных команд для управления сервером Fast API.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- Ничего.

**Вызывает исключения**:
- Не вызывает.

**Как работает функция**:
1. Выводит список доступных команд и их краткое описание в консоль.

**Примеры**:
```python
display_menu()
```

### `main`

```python
def main():
    """Основная функция управления сервером."""
    ...
```

**Назначение**: Главная функция модуля, обеспечивающая взаимодействие с пользователем через командную строку и управление серверами Fast API.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- Ничего.

**Вызывает исключения**:
- `ValueError`: Если введен некорректный номер порта.
- `Exception`: В случае возникновения других ошибок при выполнении команд.

**Как работает функция**:

1.  Инициализация обработчика команд `command_handler`.
2.  Организация бесконечного цикла для приема и обработки команд пользователя.
3.  Вызов функции `display_menu()` для отображения доступных команд.
4.  Чтение ввода пользователя и разбиение его на части для определения команды и аргументов.
5.  Обработка различных команд:

    *   `start`: Запуск сервера на указанном порту и хосте.
    *   `status`: Отображение статуса всех серверов.
    *   `routes`: Отображение зарегистрированных маршрутов.
    *   `stop`: Остановка сервера на указанном порту.
    *   `stop_all`: Остановка всех серверов.
    *   `add_route`: Добавление нового маршрута к серверу.
    *   `shutdown`: Остановка всех серверов и завершение работы программы.
    *   `help`: Вывод меню с доступными командами.
    *   `exit`: Завершение работы программы.
6.  Обработка исключений и логирование ошибок с использованием `logger.error`.

**Примеры**:
```python
main()
```

**ASCII flowchart работы функции**:

```
Начало
    │
    │ Инициализация CommandHandler
    │
    │ Бесконечный цикл
    │
    │   Вывод меню команд
    │   │
    │   Ввод команды от пользователя
    │   │
    │   Разбор команды
    │   │
    │   Выбор действия в зависимости от команды:
    │   │
    │   ┌──────────────────────────────┬──────────────────────────────┬──────────────────────────────┐
    │   │ start                        │ status                       │ routes                       │
    │   │   │                          │   │                          │   │                          │
    │   │   Запуск сервера            │   Отображение статуса       │   Отображение маршрутов      │
    │   │   │                          │   │                          │   │                          │
    │   └──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘
    │   ┌──────────────────────────────┬──────────────────────────────┬──────────────────────────────┐
    │   │ stop                         │ stop_all                     │ add_route                    │
    │   │   │                          │   │                          │   │                          │
    │   │   Остановка сервера           │   Остановка всех серверов   │   Добавление нового маршрута │
    │   │   │                          │   │                          │   │                          │
    │   └──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘
    │   ┌──────────────────────────────┬──────────────────────────────┬──────────────────────────────┐
    │   │ shutdown                     │ help                         │ exit                         │
    │   │   │                          │   │                          │   │                          │
    │   │   Остановка и выход          │   Вывод меню               │   Выход из программы        │
    │   │   │                          │   │                          │   │                          │
    │   └──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘
    │   │
    │   Обработка исключений
    │   │
    │Конец (при команде exit или shutdown)
    │
Конец
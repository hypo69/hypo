# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –º–æ–¥—É–ª—è `ToolBox_send.py`

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**
8
-  –ü–ª—é—Å—ã
    - –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É –ø–æ —Ä–∞—Å—Å—ã–ª–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∏—Å–ø–æ–ª—å–∑—É—è Telegram –±–æ—Ç.
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `dotenv` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    - –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    - –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å HTML-—Ä–∞–∑–º–µ—Ç–∫–æ–π.

-  –ú–∏–Ω—É—Å—ã
    - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —è–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –ª–æ–≥–≥–µ—Ä–∞.
    - –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `j_loads` –∏–ª–∏ `j_loads_ns` –∏–∑ `src.utils.jjson`.
    - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ—è—Å–Ω—è—é—â–∏–µ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã –∫–æ–¥–∞.
    - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–º–æ—â—å—é `logger.error`.
    - –ù–µ —É–∫–∞–∑–∞–Ω —Ç–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `except` –±–ª–æ–∫–µ.
    - –í—ã–≤–æ–¥ `print` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ª—É—á—à–µ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `logger.info` –∏–ª–∏ `logger.error`.
    - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è –∏ —Ñ—É–Ω–∫—Ü–∏–π.
    - –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `async` (–Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–æ–π, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É–¥—É—â–µ–º).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é**

1.  **–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –ª–æ–≥–≥–µ—Ä–∞**: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å `from src.logger import logger` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫.
2.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `j_loads` –∏–ª–∏ `j_loads_ns`**: –í –¥–∞–Ω–Ω–æ–º –∫–æ–¥–µ —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ.
3.  **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –∫–æ–¥–∞.
4.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `logger.error` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –≤–º–µ—Å—Ç–æ `print`, –∞ —Ç–∞–∫–∂–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è.
5.  **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å docstring –¥–ª—è –º–æ–¥—É–ª—è –∏ —Ñ—É–Ω–∫—Ü–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ RST.
6.  **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–¥ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å PEP8.
7.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥**

```python
"""
–ú–æ–¥—É–ª—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram –±–æ—Ç–∞.
=========================================================================================

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite, –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏—Ö –ø—Ä–æ–º–æ–∫–æ–¥, –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
–ø—Ä–æ–º–æ–∫–æ–¥.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
--------------------

.. code-block:: python

    python ToolBox_send.py
"""
import telebot
import sqlite3
import os
from dotenv import load_dotenv
from src.logger import logger  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä

load_dotenv()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
bot = telebot.TeleBot(token=os.environ['TOKEN'])

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite
conn = sqlite3.connect('UsersData.db')
cursor = conn.cursor()

try:
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏—Ö –ø—Ä–æ–º–æ–∫–æ–¥
    cursor.execute('SELECT id FROM users_data_table WHERE promocode != 1')
    users = cursor.fetchall()

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    message_text = "–£—Å–ø–µ–π—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–º FREE24 –¥–æ 21 –¥–µ–∫–∞–±—Ä—è!\\n\\n–ü–æ –Ω–µ–º—É –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –º–µ—Å—è—Ü —Ç–∞—Ä–∏—Ñ–∞ PRO ‚Äî —ç—Ç–æ –±–µ–∑–ª–∏–º–∏—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π üí• \\n\\n–ß—Ç–æ–±—ã –≤–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –¢–∞—Ä–∏—Ñ—ã –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ü—Ä–æ–º–æ–∫–æ–¥¬ª."

    # –¶–∏–∫–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    for user in users:
        try:
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            bot.send_message(chat_id=user[0], text=message_text, parse_mode='html')
            logger.info(f'–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: {user[0]}')
        except telebot.apihelper.ApiTelegramException as e: #  –û—Ç–ª–∞–≤–ª–∏–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ API telegram
            # –õ–æ–≥–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
            logger.error(f'–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: {user[0]}, –æ—à–∏–±–∫–∞: {e}')
        except Exception as e:
             # –õ–æ–≥–≥–∏—Ä—É–µ–º –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏
            logger.error(f'–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {user[0]}, –æ—à–∏–±–∫–∞: {e}')

except sqlite3.Error as e:
    # –õ–æ–≥–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
    logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö: {e}')
finally:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
    if conn:
        conn.close()
        logger.info('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–æ')

```
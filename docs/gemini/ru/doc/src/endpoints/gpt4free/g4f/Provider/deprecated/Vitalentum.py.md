# Модуль Vitalentum

## Обзор

Модуль `Vitalentum` предоставляет асинхронный генератор для взаимодействия с сервисом Vitalentum.io, который предоставляет доступ к GPT-3.5 Turbo. Модуль использует `aiohttp` для асинхронных запросов и реализует логику для обработки потоковых ответов от Vitalentum.

## Подробней

Модуль предназначен для использования в качестве одного из провайдеров в системе, где требуется взаимодействие с языковой моделью GPT-3.5 Turbo через API Vitalentum. Он преобразует сообщения в необходимый формат для API, отправляет запрос и обрабатывает потоковый ответ, возвращая сгенерированный контент.

## Классы

### `Vitalentum`

**Описание**: Класс `Vitalentum` является асинхронным провайдером, который взаимодействует с API Vitalentum.io для генерации текста на основе модели GPT-3.5 Turbo.

**Наследует**:
- `AsyncGeneratorProvider`: Класс наследует функциональность асинхронного генератора провайдера.

**Атрибуты**:
- `url` (str): URL сервиса Vitalentum.io (`https://app.vitalentum.io`).
- `supports_gpt_35_turbo` (bool): Поддержка модели GPT-3.5 Turbo (всегда `True`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API Vitalentum.

## Функции

### `create_async_generator`

```python
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для взаимодействия с API Vitalentum.

        Args:
            model (str): Имя модели, в данном случае ожидается GPT-3.5 Turbo.
            messages (Messages): Список сообщений для отправки в API.
            proxy (str, optional): Прокси-сервер для использования при отправке запроса. По умолчанию `None`.
            **kwargs: Дополнительные параметры, которые будут переданы в API.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий сгенерированный контент.

        Raises:
            Exception: Если возникает ошибка при отправке запроса или обработке ответа.
        """
```

**Назначение**: Создает асинхронный генератор для отправки сообщений в API Vitalentum и получения потоковых ответов.

**Параметры**:
- `model` (str): Имя модели, которую нужно использовать (в данном случае GPT-3.5 Turbo).
- `messages` (Messages): Список сообщений, где каждое сообщение содержит роль (`user` или `bot`) и контент.
- `proxy` (str, optional): URL прокси-сервера, если необходимо использовать прокси. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры, которые передаются в теле запроса.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий части контента, сгенерированного моделью.

**Как работает функция**:

1. **Формирование заголовков**: Создаются заголовки HTTP-запроса, включая `User-Agent`, `Accept`, `Origin`, `Referer` и другие.
2. **Преобразование сообщений**: Список сообщений преобразуется в формат, требуемый API Vitalentum, где роль `user` заменяется на `human`, а `bot` остается `bot`.
3. **Формирование данных**: Создается словарь `data`, содержащий преобразованные сообщения, температуру (фиксированное значение 0.7) и дополнительные параметры `kwargs`.
4. **Отправка запроса**: Используется `aiohttp.ClientSession` для отправки асинхронного POST-запроса к API Vitalentum (`/api/converse-edge`) с сформированными заголовками, данными и прокси (если указан).
5. **Обработка потокового ответа**: Извлекаются строки из ответа сервера. Каждая строка проверяется на наличие префикса `data: `. Если строка начинается с `data: [DONE]`, генератор завершает работу. В противном случае строка интерпретируется как JSON, извлекается контент из поля `choices[0].delta.content`, и этот контент передается через `yield`.

```text
Формирование_заголовков --> Преобразование_сообщений
Преобразование_сообщений --> Формирование_данных
Формирование_данных --> Отправка_запроса
Отправка_запроса --> Обработка_потокового_ответа
Обработка_потокового_ответа -- "data: [DONE]" --> Завершение
Обработка_потокового_ответа -- "data:" --> Извлечение_контента
Извлечение_контента --> yield
```

**Примеры**:

```python
# Пример использования с минимальными параметрами
messages = [{"role": "user", "content": "Hello, Vitalentum!"}]
async for chunk in Vitalentum.create_async_generator(model="gpt-3.5-turbo", messages=messages):
    print(chunk, end="")

# Пример использования с прокси
messages = [{"role": "user", "content": "Translate to French: Hello, world!"}]
async for chunk in Vitalentum.create_async_generator(model="gpt-3.5-turbo", messages=messages, proxy="http://your-proxy:8080"):
    print(chunk, end="")

# Пример использования с дополнительными параметрами
messages = [{"role": "user", "content": "Write a short poem."}]
async for chunk in Vitalentum.create_async_generator(model="gpt-3.5-turbo", messages=messages, temperature=0.9):
    print(chunk, end="")
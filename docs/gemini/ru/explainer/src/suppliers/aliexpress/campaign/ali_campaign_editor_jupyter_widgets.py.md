## <алгоритм>

1.  **Инициализация `JupyterCampaignEditorWidgets`**:
    *   Создается экземпляр класса `JupyterCampaignEditorWidgets`.
    *   Определяются атрибуты класса (например, `language`, `currency`, `campaign_name`, `campaign_editor` и т.д.) со значением по умолчанию `None`.
    *   В конструкторе `__init__`:
        *   Определяется путь к директории с кампаниями (`campaigns_directory`).
        *   Создаются выпадающие списки (`widgets.Dropdown`) для выбора названия кампании (`campaign_name_dropdown`), категории (`category_name_dropdown`) и языка/валюты (`language_dropdown`).
            *   Пример:  `campaign_name_dropdown` изначально заполняется названиями директорий в папке кампаний.
        *   Создаются кнопки (`widgets.Button`) для инициализации редактора (`initialize_button`), сохранения кампании (`save_button`), показа продуктов (`show_products_button`) и открытия Google Spreadsheet (`open_spreadsheet_button`).
        *   Устанавливаются колбэки для виджетов, с помощью метода `setup_callbacks()`.
        *   Вызывается метод `initialize_campaign_editor(None)` для первичной инициализации редактора.
2.  **`setup_callbacks()`**:
    *   Устанавливаются обработчики событий для каждого из выпадающих списков и кнопок.
    *   Пример: При изменении значения `campaign_name_dropdown` вызывается метод `on_campaign_name_change`.
3.  **`display_widgets()`**:
    *   Отображаются все созданные виджеты на экране с помощью функции `display()`.
    *   Вызывается `initialize_campaign_editor(None)` чтобы инициализировать редактор по выбранным значениям при запуске.
4.  **`initialize_campaign_editor(_)`**:
    *   Извлекаются выбранные значения кампании, категории и языка/валюты из выпадающих списков.
    *   Если выбрано имя кампании:
        *   Обновляется выпадающий список категорий для выбранной кампании через `update_category_dropdown()`.
        *   Создается экземпляр класса `AliCampaignEditor`.
        *   Если выбрана категория, то извлекается объект категории и продукты.
    *   Если имя кампании не выбрано, выводится предупреждение в лог.
5. **`update_category_dropdown(campaign_name)`**:
    *   Получает список названий категорий для выбранной кампании.
    *   Обновляет список опций выпадающего списка категорий.
6.  **Обработчики изменений (`on_campaign_name_change`, `on_category_change`, `on_language_change`)**:
    *   Извлекают новые значения из соответствующих виджетов.
    *   Вызывают `initialize_campaign_editor(None)` для переинициализации редактора на основе новых выбранных значений.
7.  **`save_campaign(_)`**:
    *   Получает значения кампании, категории и языка/валюты из выпадающих списков.
    *   Создает экземпляр `AliCampaignEditor`.
    *   Вызывает метод `save_categories_from_worksheet()` для сохранения данных из Google Spreadsheet.
    *   Если имя кампании или язык не выбраны, выводится предупреждение в лог.
8. **`show_products(_)`**:
    *   Получает имя кампании и имя категории из выпадающих списков.
    *   Создаёт экземпляр `AliCampaignEditor`.
    *   Вызывает метод `set_products_worksheet(category_name)` для отображения продуктов из Google Spreadsheet.
9. **`open_spreadsheet(_)`**:
    *   Формирует URL для открытия Google Spreadsheet.
    *   Открывает URL в браузере, используя `webbrowser.open()`.
10. **Пример работы**:
    *   Пользователь запускает Jupyter Notebook, в котором вызывается `JupyterCampaignEditorWidgets().display_widgets()`.
    *   Пользователь выбирает кампанию, категорию и язык/валюту из выпадающих списков.
    *   Пользователь нажимает кнопку "Initialize Campaign Editor", после чего происходит инициализация с выбранными значениями.
    *   Пользователь может нажать кнопку "Save Campaign", "Show Products" или "Open Google Spreadsheet" для соответствующих действий.

## <mermaid>

```mermaid
graph LR
    A[JupyterCampaignEditorWidgets] --> B(Инициализация виджетов);
    B --> C{Проверка наличия директории кампаний};
    C -- Нет --> D[Ошибка: Директория не найдена];
    C -- Да --> E(Создание выпадающих списков и кнопок);
    E --> F(Установка колбэков);
    F --> G(Инициализация редактора по умолчанию);
    G --> H[display_widgets()];
    H --> I[Отображение виджетов];
    I --> J{Обработка событий};
    J -- Изменение названия кампании --> K[on_campaign_name_change()];
    J -- Изменение категории --> L[on_category_change()];
    J -- Изменение языка --> M[on_language_change()];
    J -- Нажатие "Initialize Campaign Editor" --> N[initialize_campaign_editor()];
    J -- Нажатие "Save Campaign" --> O[save_campaign()];
    J -- Нажатие "Show Products" --> P[show_products()];
    J -- Нажатие "Open Google Spreadsheet" --> Q[open_spreadsheet()];
    K --> R[Обновление списка категорий];
    K --> N;
    L --> N;
    M --> N;
     N --> S{Выбрана кампания?};
        S -- Нет --> T[Вывод предупреждения];
    S -- Да --> U[Создание AliCampaignEditor];
    U --> V{Выбрана категория?};
    V -- Да --> W[Получение категории и продуктов];
    V -- Нет --> X[Продолжение без категории];
    
    O --> Y[Создание AliCampaignEditor для сохранения];
    Y --> Z[Сохранение данных из Google Spreadsheet];
     P --> AA[Создание AliCampaignEditor для показа продуктов];
    AA --> BB[Установка данных в Google Spreadsheet];
    Q --> CC{Редактор инициализирован?};
    CC -- Нет --> DD[Вывод сообщения];
    CC -- Да --> EE[Открытие Google Spreadsheet в браузере];
    
    R --> E;

    classDef callback fill:#f9f,stroke:#333,stroke-width:2px
    class K,L,M,N,O,P,Q callback
```

**Объяснение зависимостей `mermaid`**:

*   `JupyterCampaignEditorWidgets` (A) - основной класс, управляющий виджетами.
*   **Инициализация виджетов** (B): Начальный этап, где создаются все необходимые виджеты.
*   **Проверка наличия директории кампаний** (C): Проверяет существует ли директория с кампаниями.
*   **Ошибка: Директория не найдена** (D): Выводится сообщение об ошибке, если директории не существует.
*   **Создание выпадающих списков и кнопок** (E): Создание основных виджетов для взаимодействия.
*   **Установка колбэков** (F): Назначение функций-обработчиков для событий виджетов.
*   **Инициализация редактора по умолчанию** (G): Начальная инициализация редактора.
*   `display_widgets()` (H): Функция, отображающая виджеты.
*   **Отображение виджетов** (I): Отображение созданных элементов интерфейса.
*   **Обработка событий** (J): Ожидание действий пользователя.
*   `on_campaign_name_change()` (K), `on_category_change()` (L), `on_language_change()` (M), `initialize_campaign_editor()` (N), `save_campaign()` (O), `show_products()` (P), `open_spreadsheet()` (Q) - Функции-обработчики событий.
*   **Обновление списка категорий** (R) - Функция, обновляющая список категорий в зависимости от выбранной кампании.
*    **Выбрана кампания?** (S) - Проверка, выбрана ли кампания для инициализации.
*    **Вывод предупреждения** (T) - Вывод предупреждения, если кампания не выбрана.
*    **Создание AliCampaignEditor** (U) - Создание экземпляра редактора кампаний.
*    **Выбрана категория?** (V) - Проверка, выбрана ли категория.
*    **Получение категории и продуктов** (W) - Получение данных категории и продуктов.
*    **Продолжение без категории** (X) - Продолжение работы без выбранной категории.
*     **Создание AliCampaignEditor для сохранения** (Y) - Создание экземпляра редактора для сохранения.
*     **Сохранение данных из Google Spreadsheet** (Z) - Вызов функции сохранения данных.
*     **Создание AliCampaignEditor для показа продуктов** (AA) - Создание экземпляра редактора для показа продуктов.
*     **Установка данных в Google Spreadsheet** (BB) - Вызов функции отображения продуктов.
*    **Редактор инициализирован?** (CC) - Проверка, инициализирован ли редактор для открытия Google Spreadsheet.
*    **Вывод сообщения** (DD) - Вывод сообщения, если редактор не инициализирован.
*    **Открытие Google Spreadsheet в браузере** (EE) - Открытие spreadsheet в браузере.

## <объяснение>

**Импорты:**

*   `types.SimpleNamespace`: Используется для создания простых объектов с атрибутами, которые могут быть доступны как свойства. Позволяет работать с данными как с объектами, не создавая полноценные классы.
*   `header`:  Предположительно,  это локальный модуль (`src.`)  для обработки заголовков или метаданных,  необходимый для работы с файлами. **Потенциальная проблема**:  Нужно уточнить,  что конкретно делает этот модуль,  поскольку он влияет на работу системы.
*   `pathlib.Path`: Используется для работы с файловыми путями в кроссплатформенном формате.
*   `ipywidgets.widgets`:  Модуль для создания интерактивных элементов управления (виджетов) в Jupyter Notebook.
*   `IPython.display.display`: Используется для отображения виджетов в Jupyter Notebook.
*   `webbrowser`: Модуль для открытия URL в браузере по умолчанию.
*   `src.gs`: Глобальные настройки проекта. Используется для получения пути к папке Google Drive.
*   `src.suppliers.aliexpress.campaign.AliCampaignEditor`: Класс, отвечающий за редактирование кампаний AliExpress.
*    `src.suppliers.aliexpress.utils.locales`:  Модуль для работы с локализациями,  возвращает список словарей, где ключ - язык,  значение - валюта.
*   `src.utils.printer.pprint`, `src.utils.printer.get_directory_names`:  Модуль для удобного вывода данных и получения имен директорий.
*   `src.logger.logger`: Логирование ошибок и предупреждений.

**Класс `JupyterCampaignEditorWidgets`:**

*   **Роль:** Предоставляет пользовательский интерфейс для работы с редактором кампаний AliExpress в Jupyter Notebook.
*   **Атрибуты:**
    *   `language`, `currency`, `campaign_name`, `category_name`: Хранят выбранные значения для языка, валюты, названия кампании и категории.
    *   `category`: Экземпляр `SimpleNamespace`, хранит данные о выбранной категории.
    *   `campaign_editor`: Экземпляр класса `AliCampaignEditor`.
    *   `products`: Список экземпляров `SimpleNamespace`, хранит данные о товарах.
    *   `campaigns_directory`: Путь к директории с кампаниями.
    *   `campaign_name_dropdown`, `category_name_dropdown`, `language_dropdown`: Экземпляры класса `widgets.Dropdown` для выбора кампании, категории и языка.
    *   `initialize_button`, `save_button`, `show_products_button`, `open_spreadsheet_button`: Экземпляры класса `widgets.Button` для управления процессом редактирования.
*   **Методы:**
    *   `__init__()`: Инициализация виджетов и настройка редактора по умолчанию.
    *   `initialize_campaign_editor(_)`: Создает экземпляр `AliCampaignEditor` на основе выбранных значений.
    *   `update_category_dropdown(campaign_name)`: Обновляет список категорий в выпадающем списке на основе выбранной кампании.
    *   `on_campaign_name_change(change)`, `on_category_change(change)`, `on_language_change(change)`: Обработчики изменений в выпадающих списках, которые переинициализируют редактор.
    *   `save_campaign(_)`: Сохраняет изменения в кампании.
    *   `show_products(_)`: Отображает список товаров для выбранной категории.
    *   `open_spreadsheet(_)`: Открывает Google Spreadsheet в браузере.
    *   `setup_callbacks()`: Настройка обработчиков событий для виджетов.
    *   `display_widgets()`: Отображение виджетов в Jupyter Notebook.

**Функции:**

*   `__init__(self)`: Конструктор класса, инициирует виджеты и путь к папке кампаний.
*    `initialize_campaign_editor(self, _)`:  Инициализирует `AliCampaignEditor` и получает категорию и продукты,  основываясь на выбранных значениях из выпадающих списков.
*   `update_category_dropdown(self, campaign_name)`:  Обновляет выпадающий список категорий, основываясь на выбранной кампании.
*   `on_campaign_name_change(self, change)`: Обработчик изменения названия кампании,  обновляет категории и переинициализирует редактор.
*   `on_category_change(self, change)`:  Обработчик изменения категории,  переинициализирует редактор.
*   `on_language_change(self, change)`: Обработчик изменения языка/валюты,  переинициализирует редактор.
*   `save_campaign(self, _)`: Сохраняет кампанию,  используя `AliCampaignEditor`.
*   `show_products(self, _)`: Отображает продукты,  используя `AliCampaignEditor`.
*   `open_spreadsheet(self, _)`: Открывает Google Spreadsheet в браузере.
*   `setup_callbacks(self)`:  Настраивает коллбэки для виджетов.
*   `display_widgets(self)`:  Отображает виджеты в Jupyter Notebook.

**Переменные:**

*   `MODE`: Строка, определяющая режим работы (в данном случае 'dev').
*   `self.campaigns_directory`:  Объект `Path`  с путем к папке кампаний.
*   `self.campaign_name`, `self.category_name`, `self.language`, `self.currency`: Строковые переменные, хранящие текущие выбранные значения.
*   `self.category`: Объект `SimpleNamespace`, хранящий информацию о выбранной категории.
*   `self.campaign_editor`:  Экземпляр класса  `AliCampaignEditor`, используется для взаимодействия с редактором кампаний.
*    `self.products`:  Список объектов `SimpleNamespace`,  содержащий информацию о продуктах.
*   `self.campaign_name_dropdown`, `self.category_name_dropdown`, `self.language_dropdown`: Объекты `widgets.Dropdown` для интерактивного выбора значений.
*   `self.initialize_button`, `self.save_button`, `self.show_products_button`, `self.open_spreadsheet_button`: Объекты `widgets.Button` для взаимодействия с пользователем.
*   `spreadsheet_url`: Строка,  содержащая URL Google Spreadsheet.

**Потенциальные ошибки и области для улучшения:**

*   **Обработка ошибок**:  В методах `save_campaign`, `show_products` и `open_spreadsheet` есть блоки try-except,  но они используют общий catch всех `Exception`,  что может затруднить отладку. Нужно использовать более конкретные исключения.
*   **Неопределенность `header`**:  Необходимо уточнить назначение модуля `header`.
*   **Отсутствие валидации**:  Нет явной валидации вводимых пользователем данных, что может привести к непредсказуемому поведению. Например, проверка, что пользователь выбрал кампанию и категорию перед сохранением.
*   **Первоначальная инициализация**:  При запуске виджеты инициализируются со значениями по умолчанию. Необходимо предусмотреть сценарий когда, нет выбранных значений.
*   **Повторение кода:** Инициализация `AliCampaignEditor` повторяется в нескольких методах. Можно вынести в отдельный метод.

**Цепочка взаимосвязей с другими частями проекта:**

1.  **`src.gs`**: Используется для определения пути к папке Google Drive, где хранятся кампании.
2.  **`src.suppliers.aliexpress.campaign.AliCampaignEditor`**: Класс, который выполняет основную логику редактирования кампаний AliExpress,  используя Google Spreadsheet.
3.  **`src.suppliers.aliexpress.utils.locales`**: Модуль для работы с локалями, обеспечивает поддержку разных языков и валют.
4.  **`src.utils.printer`**: Используется для форматированного вывода данных в консоль и получения списка директорий.
5.  **`src.logger.logger`**: Используется для логирования ошибок и предупреждений.
6. **`src`**:  Предполагается, что `src` является корнем проекта,  и все импорты внутри `src` обозначают модули в рамках этого проекта.

Этот модуль является частью UI, используемого для управления рекламными компаниями AliExpress,  и в основном полагается на `AliCampaignEditor` для фактического взаимодействия с Google Sheets.
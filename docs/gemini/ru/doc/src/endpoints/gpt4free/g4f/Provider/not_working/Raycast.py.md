# Модуль `Raycast`

## Обзор

Модуль `Raycast` представляет собой реализацию класса `AbstractProvider` для взаимодействия с сервисом Raycast. Он предоставляет функциональность для создания запросов к моделям GPT и получения ответов в режиме стриминга. Модуль требует наличия токена аутентификации для работы. В настоящее время помечен как нерабочий (`working = False`).

## Подробнее

Модуль предназначен для интеграции с Raycast API, позволяя использовать модели GPT (например, `gpt-3.5-turbo` и `gpt-4`) через этот сервис. Он поддерживает потоковую передачу данных, что позволяет получать ответы частями, улучшая восприятие задержки.

## Классы

### `Raycast(AbstractProvider)`

**Описание**: Класс `Raycast` является провайдером для работы с API Raycast.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для всех провайдеров.

**Атрибуты**:
- `url` (str): URL сервиса Raycast (`https://raycast.com`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу (`True`).
- `needs_auth` (bool): Указывает, требуется ли аутентификация (`True`).
- `working` (bool): Указывает, работает ли провайдер в данный момент (`False`).
- `models` (list[str]): Список поддерживаемых моделей (`gpt-3.5-turbo`, `gpt-4`).

**Методы**:
- `create_completion()`: Метод для создания запроса на completion.

## Функции

### `create_completion`

```python
    @staticmethod
    def create_completion(
        model: str,
        messages: Messages,
        stream: bool,
        proxy: str = None,
        **kwargs,
    ) -> CreateResult:
        """ Функция создает запрос к API Raycast для получения completion.

        Args:
            model (str): Идентификатор используемой модели.
            messages (Messages): Список сообщений для отправки в запросе.
            stream (bool): Флаг, указывающий на необходимость потоковой передачи.
            proxy (str, optional): Адрес прокси-сервера. По умолчанию `None`.
            **kwargs: Дополнительные аргументы, такие как токен аутентификации.

        Returns:
            CreateResult: Генератор токенов completion.

        Raises:
            ValueError: Если отсутствует токен аутентификации.
        """
```

**Назначение**: Функция `create_completion` создает запрос к API Raycast для генерации текста на основе предоставленных сообщений, используя указанную модель. Она поддерживает потоковую передачу данных для получения ответа частями и требует аутентификации через токен.

**Параметры**:
- `model` (str): Идентификатор модели, которую нужно использовать (например, "gpt-3.5-turbo", "gpt-4").
- `messages` (Messages): Список сообщений, отправляемых в запросе. Каждое сообщение содержит роль и контент.
- `stream` (bool): Флаг, определяющий, использовать ли потоковую передачу данных.
- `proxy` (str, optional): Адрес прокси-сервера, если необходимо его использовать. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы, такие как токен аутентификации (`auth`).

**Возвращает**:
- `CreateResult`: Генератор, который выдает токены completion по мере их поступления из API Raycast.

**Вызывает исключения**:
- `ValueError`: Если не предоставлен токен аутентификации (`auth`).

**Как работает функция**:

1. **Проверка аутентификации**: Проверяется наличие токена аутентификации в аргументах `kwargs`. Если токен отсутствует, вызывается исключение `ValueError`.
2. **Формирование заголовков**: Создаются заголовки запроса, включая токен аутентификации.
3. **Преобразование сообщений**: Список сообщений преобразуется в формат, требуемый API Raycast.
4. **Формирование данных запроса**: Создается словарь с данными запроса, включая модель, сообщения и параметры запроса.
5. **Отправка запроса**: Отправляется POST-запрос к API Raycast с использованием библиотеки `requests`. Указывается потоковая передача (`stream=True`) и, при необходимости, прокси-сервер.
6. **Обработка ответа**:
   - Функция итерируется по строкам ответа.
   - Каждая строка проверяется на наличие префикса `b'data: '`.
   - Если префикс найден, строка декодируется, удаляется префикс, и полученный JSON-объект загружается.
   - Из JSON-объекта извлекается токен (`completion_chunk['text']`).
   - Если токен не равен `None`, он передается через `yield`, что делает функцию генератором.

**ASCII Flowchart**:

```
    A [Проверка аутентификации]
    |
    B [Формирование заголовков]
    |
    C [Преобразование сообщений]
    |
    D [Формирование данных запроса]
    |
    E [Отправка POST-запроса]
    |
    F [Обработка ответа (построчно)]
    |
    G [Проверка наличия 'data: ']
    |
    H [Декодирование и загрузка JSON]
    |
    I [Извлечение токена]
    |
    J [Проверка токена на None]
    |
    K [Выдача токена (yield)]
```

**Примеры**:

```python
# Пример использования (требуется действительный токен аутентификации)
# from src.endpoints.gpt4free.g4f.typing import Messages
# model = "gpt-3.5-turbo"
# messages: Messages = [{"role": "user", "content": "Hello, Raycast!"}]
# stream = True
# auth_token = "YOUR_AUTH_TOKEN"
#
# try:
#     generator = Raycast.create_completion(model=model, messages=messages, stream=stream, auth=auth_token)
#     for token in generator:
#         print(token, end="")
# except ValueError as ex:
#     print(f"Ошибка: {ex}")
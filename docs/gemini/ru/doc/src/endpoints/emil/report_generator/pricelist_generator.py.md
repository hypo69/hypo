# Модуль для генерации прайс-листов для "Мехирон Казаринова"

## Обзор

Модуль предназначен для генерации HTML и PDF прайс-листов на основе JSON-данных. Он использует шаблоны Jinja2 для создания HTML и PDFKit для преобразования HTML в PDF.

## Подробнее

Этот модуль предоставляет функциональность для автоматического создания отчетов о ценах в формате HTML и PDF. Он предназначен для использования в проекте "Мехирон Казаринова". Данные для отчетов загружаются из JSON-файлов, шаблоны HTML находятся в каталоге `templates`, а сгенерированные файлы сохраняются в указанных местах.

## Классы

### `ReportGenerator`

**Описание**: Класс `ReportGenerator` предназначен для генерации HTML и PDF отчетов на основе данных из JSON.

**Как работает класс**:
1.  **Инициализация**: Класс инициализируется с окружением Jinja2, которое использует файловую систему для загрузки шаблонов.
2.  **Метод `generate_html`**: Генерирует HTML-контент на основе шаблона и данных.
3.  **Метод `create_report`**: Полный цикл генерации отчёта.

**Методы**:

*   `__init__`: Инициализирует экземпляр класса `ReportGenerator`.
*   `generate_html`: Генерирует HTML-контент на основе шаблона и данных.
*   `create_report`: Полный цикл генерации отчёта.

## Функции

### `ReportGenerator.generate_html`

```python
    async def generate_html(self, data:dict, lang:str ) -> str:
        """
        Генерирует HTML-контент на основе шаблона и данных.

        Args:
            lang (str): Язык отчёта.

        Returns:
            str: HTML-контент.
        """
```

**Назначение**: Генерация HTML-контента на основе шаблона и данных.

**Параметры**:

*   `data` (dict): Данные для заполнения шаблона.
*   `lang` (str): Язык отчёта.

**Возвращает**:

*   `str`: Сгенерированный HTML-контент.

**Как работает функция**:

1.  Определяется имя шаблона в зависимости от языка отчёта (`template_table_he.html` для иврита, иначе `template_table_ru.html`).
2.  Формируется путь к шаблону на основе имени и пути к каталогу с шаблонами.
3.  Читается содержимое шаблона из файла.
4.  Создается объект шаблона Jinja2 из строки.
5.  Выполняется рендеринг шаблона с переданными данными.
6.  Возвращается сгенерированный HTML-контент.

### `ReportGenerator.create_report`

```python
    async def create_report(self, data: dict, lang:str, html_file:str| Path, pdf_file:str |Path) -> bool:
        """
        Полный цикл генерации отчёта.

        Args:
            lang (str): Язык отчёта.
        """
```

**Назначение**: Полный цикл генерации отчёта, включающий добавление сервисной информации, генерацию HTML и сохранение в PDF.

**Параметры**:

*   `data` (dict): Данные для отчёта.
*   `lang` (str): Язык отчёта.
*   `html_file` (str | Path): Путь для сохранения HTML-файла.
*   `pdf_file` (str | Path): Путь для сохранения PDF-файла.

**Возвращает**:

*   `bool`: `True`, если отчёт успешно сгенерирован, иначе `False`.

**Как работает функция**:

1.  Создается словарь `service_dict` с информацией о сервисе. Заголовок продукта (`product_title`) устанавливается в зависимости от языка. Содержимое спецификации сервиса читается из HTML-файла, специфичного для языка, и заменяются символы новой строки (`/n`) на теги `<br>`. Также генерируется случайное изображение для сервиса.
2.  Сервисная информация добавляется в список продуктов в данных (`data['products']`).
3.  Генерируется HTML-контент с использованием метода `generate_html`.
4.  Сохраняется HTML-контент в файл, указанный в `html_file`.
5.  Создается объект `PDFUtils` для работы с PDF.
6.  HTML-контент преобразуется в PDF и сохраняется в файл, указанный в `pdf_file`. Если преобразование не удалось, логируется ошибка.
7.  Возвращается `True`, если отчёт успешно сгенерирован, иначе `False`.

### `main`

```python
def main(mexiron:str,lang:str) ->bool:
    base_path:Path =  gs.path.external_storage / 'kazarinov' / 'mexironim' / mexiron
    data:dict = j_loads(base_path / f'{lang}.json')
    html_file:Path =  base_path / f'{mexiron}_{lang}.html' 
    pdf_file:Path = base_path / f'{mexiron}_{lang}.pdf'
    r = ReportGenerator()
    asyncio.run( r.create_report(data, lang, html_file, pdf_file)   )
```

**Назначение**: Главная функция для запуска процесса генерации отчёта.

**Параметры**:

*   `mexiron` (str): Имя директории mexiron.
*   `lang` (str): Язык отчёта.

**Возвращает**:

*   `bool`: Возвращает `True` или `False` в зависимости от успешности генерации отчёта.

**Как работает функция**:

1.  Формируется путь к директории, содержащей данные для отчёта.
2.  Загружаются данные из JSON-файла.
3.  Формируются пути для HTML- и PDF-файлов.
4.  Создается экземпляр класса `ReportGenerator`.
5.  Запускается асинхронная операция создания отчёта.

## Пример использования

```python
if __name__ == "__main__":
    mexiron:str = '24_12_01_03_18_24_269'
    lang:str = 'ru'
    main(mexiron,lang)
```
# Модуль для загрузки и форматирования моделей gpt4free
=================================================

Модуль содержит функции для загрузки, форматирования, чтения и сохранения информации о моделях, используемых в проекте gpt4free.

## Оглавление

- [Обзор](#обзор)
- [Подробнее](#подробнее)
- [Функции](#функции)
    - [load_models](#load_models)
    - [get_model_name](#get_model_name)
    - [format_models](#format_models)
    - [read_models](#read_models)
    - [save_models](#save_models)
    - [get_model_dir](#get_model_dir)
    - [get_models](#get_models)

## Обзор

Модуль предоставляет функции для получения списка моделей, их форматирования и сохранения для дальнейшего использования. Основная цель - упростить процесс управления моделями, используемыми в проекте.

## Подробнее

Этот модуль играет важную роль в динамической загрузке и управлении моделями, используемыми в gpt4free. Он обеспечивает гибкость в выборе моделей и их конфигурации, что позволяет адаптировать систему к различным задачам и требованиям. Файл `models.json` содержит информацию о доступных моделях, их требованиях к ресурсам и шаблонах подсказок.

## Функции

### `load_models`

```python
def load_models() -> dict:
    """Загружает список моделей с внешнего ресурса.

    Функция отправляет GET-запрос на URL "https://gpt4all.io/models/models3.json",
    получает JSON-ответ и форматирует его с использованием функции `format_models`.

    Returns:
        dict: Словарь, содержащий информацию о доступных моделях.

    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с кодом ошибки.

    Как работает функция:
     1. Отправляет GET-запрос по URL.
     2. Проверяет статус ответа с помощью `raise_for_status`.
     3. Преобразует JSON-ответ в словарь Python.
     4. Вызывает функцию `format_models` для форматирования полученных данных.
     5. Возвращает отформатированный словарь.

    Внутри функции происходят следующие действия и преобразования:
     A - Выполнение GET-запроса к URL.
     |
     -- B - Проверка статуса HTTP-ответа.
     |
     C - Преобразование JSON в словарь.
     |
     D - Форматирование данных с помощью `format_models`.

     Где:
     A - `выполнение GET-запроса` - отправка запроса на получение данных о моделях.
     B - `проверка статуса HTTP-ответа` - проверка, что запрос выполнен успешно (код 200).
     C - `преобразование JSON в словарь` - преобразование полученных данных из формата JSON в структуру данных Python.
     D - `форматирование данных с помощью format_models` - приведение структуры данных к нужному формату.

    Примеры:
        >>> models = load_models()
        >>> print(type(models))
        <class 'dict'>
    """
```

### `get_model_name`

```python
def get_model_name(filename: str) -> str:
    """Извлекает имя модели из имени файла.

    Функция принимает имя файла модели в качестве аргумента и удаляет из него различные суффиксы,
    такие как "-v1_5", "-v1", "-q4_0", "_v01", "-v0", "-f16", "-gguf2", "-newbpe", чтобы получить чистое имя модели.

    Args:
        filename (str): Имя файла модели.

    Returns:
        str: Очищенное имя модели.

     Как работает функция:
     1. Разделяет имя файла на основе первого символа ".".
     2. Итерируется по списку суффиксов для удаления.
     3. Заменяет каждый суффикс в имени файла на пустую строку.
     4. Возвращает очищенное имя модели.

    Внутри функции происходят следующие действия и преобразования:
     A - Разделение имени файла на основе первого символа ".".
     |
     -- B - Итерация по списку суффиксов для удаления.
     |
     C - Замена каждого суффикса в имени файла на пустую строку.

     Где:
     A - `разделение имени файла` - разделение строки имени файла на части до и после первого символа точки.
     B - `итерация по списку суффиксов` - перебор списка известных суффиксов, которые нужно удалить из имени.
     C - `замена каждого суффикса` - удаление каждого найденного суффикса из имени файла.

    Примеры:
        >>> get_model_name("gpt4all-j-v1.3-groovy.bin")
        'gpt4all-j'
        >>> get_model_name("llama-2-7b-chat-v0.1-q4_0.gguf")
        'llama-2-7b-chat'
    """
```

### `format_models`

```python
def format_models(models: list) -> dict:
    """Форматирует список моделей в словарь.

    Функция принимает список моделей в формате JSON и преобразует его в словарь,
    где ключом является имя модели (полученное с помощью `get_model_name`),
    а значением - словарь с информацией о модели (путь к файлу, требования к ОЗУ, шаблон подсказок и системное сообщение).

    Args:
        models (list): Список моделей в формате JSON.

    Returns:
        dict: Словарь, где ключом является имя модели, а значением - информация о модели.

     Как работает функция:
     1. Использует генератор словаря для создания словаря моделей.
     2. Для каждой модели в списке извлекает имя файла, требования к ОЗУ, шаблон подсказок и системное сообщение.
     3. Использует `get_model_name` для получения имени модели из имени файла.
     4. Формирует словарь с именем модели в качестве ключа и информацией о модели в качестве значения.
     5. Возвращает сформированный словарь.

    Внутри функции происходят следующие действия и преобразования:
     A - Итерация по списку моделей.
     |
     -- B - Извлечение имени файла, требований к ОЗУ, шаблона подсказок и системного сообщения для каждой модели.
     |
     C - Использование `get_model_name` для получения имени модели из имени файла.
     |
     D - Формирование словаря с именем модели в качестве ключа и информацией о модели в качестве значения.

     Где:
     A - `итерация по списку моделей` - перебор всех моделей в предоставленном списке.
     B - `извлечение информации о модели` - получение необходимых параметров для каждой модели из её описания.
     C - `получение имени модели` - использование функции `get_model_name` для получения чистого имени модели из имени файла.
     D - `формирование словаря` - создание структуры данных, где ключ - имя модели, а значение - её параметры.

    Примеры:
        >>> models = [{"filename": "gpt4all-j-v1.3-groovy.bin", "ramrequired": "8 GB", "promptTemplate": "...", "systemPrompt": "..."},
        ...           {"filename": "llama-2-7b-chat-v0.1-q4_0.gguf", "ramrequired": "4 GB"}]
        >>> formatted_models = format_models(models)
        >>> print(formatted_models.keys())
        dict_keys(['gpt4all-j', 'llama-2-7b-chat'])
    """
```

### `read_models`

```python
def read_models(file_path: str) -> dict:
    """Читает данные о моделях из файла.

    Функция принимает путь к файлу в качестве аргумента, открывает файл в режиме чтения байтов ("rb")
    и загружает JSON-данные из файла с использованием `json.load`.

    Args:
        file_path (str): Путь к файлу с данными о моделях.

    Returns:
        dict: Словарь, содержащий информацию о моделях.

    Raises:
        FileNotFoundError: Если файл не существует.
        json.JSONDecodeError: Если файл содержит некорректный JSON.

    Как работает функция:
     1. Открывает файл по указанному пути в режиме чтения байтов ("rb").
     2. Загружает JSON-данные из файла с использованием `json.load`.
     3. Закрывает файл.
     4. Возвращает словарь с данными о моделях.

    Внутри функции происходят следующие действия и преобразования:
     A - Открытие файла в режиме чтения байтов.
     |
     -- B - Загрузка JSON-данных из файла.

     Где:
     A - `открытие файла` - открытие файла для чтения данных.
     B - `загрузка JSON-данных` - чтение данных из файла и преобразование их из формата JSON в структуру данных Python.

    Примеры:
        Предположим, что в файле 'models.json' содержится JSON:
        {
            "gpt4all-j": {"path": "gpt4all-j-v1.3-groovy.bin", "ram": "8 GB"},
            "llama-2-7b-chat": {"path": "llama-2-7b-chat-v0.1-q4_0.gguf", "ram": "4 GB"}
        }

        >>> models = read_models('models.json')
        >>> print(models.keys())
        dict_keys(['gpt4all-j', 'llama-2-7b-chat'])
    """
```

### `save_models`

```python
def save_models(file_path: str, data: dict):
    """Сохраняет данные о моделях в файл.

    Функция принимает путь к файлу и данные для сохранения в качестве аргументов,
    открывает файл в режиме записи ("w") и сохраняет JSON-данные в файл с использованием `json.dump` и отступом в 4 пробела.

    Args:
        file_path (str): Путь к файлу для сохранения данных.
        data (dict): Данные для сохранения.

    Raises:
        IOError: Если возникает ошибка при записи в файл.

    Как работает функция:
     1. Открывает файл по указанному пути в режиме записи ("w").
     2. Сохраняет JSON-данные в файл с использованием `json.dump` и отступом в 4 пробела.
     3. Закрывает файл.

    Внутри функции происходят следующие действия и преобразования:
     A - Открытие файла в режиме записи.
     |
     -- B - Сохранение JSON-данных в файл.

     Где:
     A - `открытие файла` - открытие файла для записи данных.
     B - `сохранение JSON-данных` - запись данных в файл в формате JSON с отступами для читаемости.

    Примеры:
        >>> data = {"gpt4all-j": {"path": "gpt4all-j-v1.3-groovy.bin", "ram": "8 GB"}}
        >>> save_models('models.json', data)
    """
```

### `get_model_dir`

```python
def get_model_dir() -> str:
    """Определяет и создает директорию для хранения моделей.

    Функция определяет абсолютный путь к директории "models" внутри проекта,
    создает эту директорию, если она не существует, и возвращает путь к ней.

    Returns:
        str: Путь к директории для хранения моделей.

    Как работает функция:
     1. Определяет путь к текущей директории с файлом.
     2. Определяет путь к корневой директории проекта (на один уровень выше текущей директории).
     3. Формирует путь к директории "models" внутри корневой директории проекта.
     4. Проверяет существование директории "models".
     5. Если директория не существует, создает ее.
     6. Возвращает путь к директории "models".

    Внутри функции происходят следующие действия и преобразования:
     A - Определение пути к текущей директории с файлом.
     |
     -- B - Определение пути к корневой директории проекта.
     |
     C - Формирование пути к директории "models".
     |
     D - Проверка существования директории "models".
     |
     E - Создание директории "models", если она не существует.

     Где:
     A - `определение текущей директории` - получение пути к директории, где находится текущий файл.
     B - `определение корневой директории` - определение директории верхнего уровня в проекте.
     C - `формирование пути к директории models` - создание полного пути к директории, где будут храниться модели.
     D - `проверка существования директории` - проверка, существует ли уже директория для хранения моделей.
     E - `создание директории` - создание директории, если она не существует.

    Примеры:
        >>> model_dir = get_model_dir()
        >>> print(model_dir)
        /path/to/project/models
    """
```

### `get_models`

```python
def get_models() -> dict[str, dict]:
    """Получает список моделей из файла или загружает его с внешнего ресурса.

    Функция определяет путь к файлу "models.json" внутри директории для хранения моделей.
    Если файл существует, она читает данные о моделях из файла с помощью `read_models`.
    Если файл не существует, она загружает данные о моделях с внешнего ресурса с помощью `load_models`,
    сохраняет их в файл с помощью `save_models` и возвращает полученные данные.

    Returns:
        dict[str, dict]: Словарь, содержащий информацию о доступных моделях.

    Как работает функция:
     1. Получает путь к директории для хранения моделей с помощью `get_model_dir`.
     2. Формирует путь к файлу "models.json" внутри директории для хранения моделей.
     3. Проверяет существование файла.
     4. Если файл существует, читает данные о моделях из файла с помощью `read_models`.
     5. Если файл не существует, загружает данные о моделях с внешнего ресурса с помощью `load_models`,
     сохраняет их в файл с помощью `save_models`.
     6. Возвращает полученные данные.

    Внутри функции происходят следующие действия и преобразования:
     A - Получение пути к директории для хранения моделей.
     |
     -- B - Формирование пути к файлу "models.json".
     |
     C - Проверка существования файла.
     |
     D - Чтение данных о моделях из файла (если он существует).
     |
     E - Загрузка данных о моделях с внешнего ресурса (если файл не существует).
     |
     F - Сохранение данных о моделях в файл (если файл не существовал).

     Где:
     A - `получение директории моделей` - определение, где хранятся файлы моделей.
     B - `формирование пути к файлу` - создание полного пути к файлу со списком моделей.
     C - `проверка существования файла` - проверка, есть ли файл со списком моделей.
     D - `чтение данных из файла` - чтение данных о моделях из файла, если он существует.
     E - `загрузка данных с внешнего ресурса` - получение данных о моделях из интернета, если файл не существует.
     F - `сохранение данных в файл` - сохранение загруженных данных в файл для последующего использования.

    Примеры:
        >>> models = get_models()
        >>> print(type(models))
        <class 'dict'>
        >>> print(models.keys())
        dict_keys(['gpt4all-j', 'llama-2-7b-chat'])
    """
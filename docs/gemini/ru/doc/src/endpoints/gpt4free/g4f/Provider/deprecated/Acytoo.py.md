# Модуль Acytoo

## Обзор

Модуль `Acytoo` предоставляет асинхронный генератор для взаимодействия с сервисом `chat.acytoo.com`. Он позволяет отправлять запросы к API для получения ответов, используя асинхронные операции. Поддерживает историю сообщений и модель `gpt-3.5-turbo`.

## Подробней

Этот модуль предназначен для интеграции с сервисом `chat.acytoo.com` через его API. Он использует `aiohttp` для асинхронных запросов и предоставляет удобный интерфейс для отправки сообщений и получения ответов в виде генератора. Модуль определяет методы для создания заголовков и полезной нагрузки запроса, что упрощает взаимодействие с API.

## Классы

### `Acytoo`

**Описание**: Класс `Acytoo` является провайдером асинхронного генератора для взаимодействия с сервисом `chat.acytoo.com`.

**Принцип работы**:
   - Класс определяет URL сервиса, статус работоспособности, поддержку истории сообщений и поддержку модели `gpt-3.5-turbo`.
   - Метод `create_async_generator` создает асинхронный генератор, который отправляет запросы к API и возвращает ответы в виде потока данных.

**Методы**:

- `create_async_generator`: Создает асинхронный генератор для взаимодействия с API `chat.acytoo.com`.

   **Параметры**:
   - `model` (str): Модель для использования (в данном случае всегда `gpt-3.5-turbo`).
   - `messages` (Messages): Список сообщений для отправки.
   - `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
   - `**kwargs`: Дополнительные параметры.

   **Возвращает**:
   - `AsyncResult`: Асинхронный генератор, выдающий части ответа от API.

   **Вызывает исключения**:
   - `aiohttp.ClientError`: В случае проблем с сетевым запросом.

   **Как работает функция**:

   1. **Создание сессии `ClientSession`**: Инициализируется асинхронная сессия `ClientSession` с заголовками, созданными с помощью функции `_create_header()`.
   2. **Выполнение POST-запроса**: Отправляется `POST`-запрос к адресу `f'{cls.url}/api/completions'` с использованием `session.post`. В запросе передаются параметры:
      - `proxy`: Прокси-сервер, если указан.
      - `json`: Полезная нагрузка (payload), созданная функцией `_create_payload(messages, **kwargs)`.
   3. **Обработка ответа**:
      - `response.raise_for_status()`: Проверяет статус ответа и вызывает исключение в случае ошибки (например, `HTTPError`).
      - `async for stream in response.content.iter_any()`: Асинхронно итерируется по потоку содержимого ответа.
      - `if stream`: Проверяет, что поток не пустой.
      - `yield stream.decode()`: Декодирует поток и возвращает его как часть генератора.
   4. **Асинхронная генерация**: Функция возвращает асинхронный генератор, который позволяет получать данные по частям, не загружая весь ответ в память сразу.

   **Примеры**:
    ```python
    # Пример использования асинхронного генератора Acytoo
    import asyncio
    from typing import List, Dict

    async def main():
        messages: List[Dict[str, str]] = [
            {"role": "user", "content": "Привет, как дела?"}
        ]
        async for message_chunk in Acytoo.create_async_generator(model='gpt-3.5-turbo', messages=messages):
            print(message_chunk, end='')

    if __name__ == "__main__":
        asyncio.run(main())
    ```

## Функции

### `_create_header`

```python
def _create_header():
    """Создает заголовок для HTTP-запроса.

    Returns:
        dict: Словарь с заголовками.
    """
```

**Назначение**: Функция `_create_header` создает словарь с заголовками, используемыми для HTTP-запросов к API `chat.acytoo.com`.

**Возвращает**:
- `dict`: Словарь, содержащий заголовки `accept` и `content-type`.

**Как работает функция**:
1. **Определение заголовков**: Создается словарь, содержащий следующие ключи и значения:
   - `'accept': '*/*'`: Указывает, что клиент принимает любой тип контента.
   - `'content-type': 'application/json'`: Указывает, что тело запроса будет в формате JSON.
2. **Возврат словаря**: Функция возвращает созданный словарь.

**Примеры**:
```python
# Пример использования функции _create_header
header = _create_header()
print(header)  # {'accept': '*/*', 'content-type': 'application/json'}
```

### `_create_payload`

```python
def _create_payload(messages: Messages, temperature: float = 0.5, **kwargs):
    """Создает полезную нагрузку (payload) для HTTP-запроса.

    Args:
        messages (Messages): Список сообщений для отправки.
        temperature (float, optional): Температура для генерации текста. По умолчанию 0.5.
        **kwargs: Дополнительные параметры.

    Returns:
        dict: Словарь с полезной нагрузкой.
    """
```

**Назначение**: Функция `_create_payload` создает полезную нагрузку (payload) для HTTP-запроса к API `chat.acytoo.com`.

**Параметры**:
- `messages` (Messages): Список сообщений для отправки.
- `temperature` (float, optional): Температура для генерации текста. По умолчанию `0.5`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `dict`: Словарь, представляющий полезную нагрузку в формате JSON.

**Как работает функция**:
1. **Определение параметров**: Создается словарь, содержащий следующие ключи и значения:
   - `'key': ''`: Пустой ключ (возможно, не используется).
   - `'model': 'gpt-3.5-turbo'`: Указывает модель для использования.
   - `'messages': messages`: Список сообщений для отправки.
   - `'temperature': temperature`: Температура для генерации текста.
   - `'password': ''`: Пустой пароль (возможно, не используется).
2. **Возврат словаря**: Функция возвращает созданный словарь.

**Примеры**:
```python
# Пример использования функции _create_payload
messages = [{"role": "user", "content": "Привет, как дела?"}]
payload = _create_payload(messages=messages)
print(payload)
# {'key': '', 'model': 'gpt-3.5-turbo', 'messages': [{'role': 'user', 'content': 'Привет, как дела?'}], 'temperature': 0.5, 'password': ''}
```
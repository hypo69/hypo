# Модуль hypotez/src/endpoints/kazarinov/scenarios/scenario_pricelist.py

## Обзор

Модуль `scenario_pricelist.py` предоставляет функциональность для извлечения, парсинга и обработки данных о продуктах от различных поставщиков. Модуль обрабатывает подготовку данных, обработку AI, и интеграцию с Facebook для публикации продуктов.

## Классы

### `Mexiron`

**Описание**: Класс `Mexiron` обрабатывает извлечение, парсинг и сохранение данных о продуктах от различных поставщиков.

**Поддерживаемые поставщики**:
- `https://morlevi.co.il`
- `https://ivory.co.il`
- `https://ksp.co.il`
- `https://grandadvance.co.il`

**Атрибуты**:

- `driver` (Driver): Экземпляр Selenium WebDriver.
- `export_path` (Path): Путь для экспорта данных.
- `mexiron_name` (str): Имя процесса.
- `price` (float): Цена продукта.
- `timestamp` (str): Метка времени.
- `products_list` (List): Список продуктов.
- `model` (GoogleGenerativeAI): Экземпляр модели Google Generative AI.
- `model_command` (str): Команда для модели AI.
- `config` (SimpleNamespace): Конфигурация.


**Методы**:

#### `__init__`

**Описание**: Инициализирует класс `Mexiron` необходимыми компонентами.

**Параметры**:
- `driver` (Driver): Экземпляр Selenium WebDriver.
- `mexiron_name` (Optional[str], optional): Пользовательское имя процесса. По умолчанию None.

**Возвращает**:
-  None.

**Обрабатываемые исключения**:
- `Exception`:  При ошибке загрузки конфигурации или построения пути экспорта.


#### `run_scenario`

**Описание**: Выполняет сценарий: парсит продукты, обрабатывает их с помощью AI и сохраняет данные.

**Параметры**:
- `system_instruction` (Optional[str], optional): Системные инструкции для модели AI. По умолчанию None.
- `price` (Optional[str], optional): Цена для обработки. По умолчанию None.
- `mexiron_name` (Optional[str], optional): Пользовательское имя Mexiron. По умолчанию None.
- `urls` (Optional[str | List[str]], optional): URL страниц продуктов. По умолчанию None.
- `update` (Update, optional): Объект telegram для отправки сообщений. По умолчанию None.

**Возвращает**:
- `bool`: True, если сценарий выполняется успешно, False в противном случае.

**Замечания**:
- Необходимо добавить логирование перед отрицательным выходом из функции.
- Модель может ошибаться.


#### `get_graber_by_supplier_url`

**Описание**: Возвращает соответствующий graber для данного URL поставщика.

**Параметры**:
- `url` (str): URL страницы поставщика.

**Возвращает**:
- `Optional[object]`: Экземпляр Graber, если совпадение найдено, иначе None.


#### `convert_product_fields`

**Описание**: Преобразует поля продукта в словарь.

**Параметры**:
- `f` (ProductFields): Объект, содержащий обработанные данные продукта.

**Возвращает**:
- `dict`: Отформатированный словарь данных продукта.


#### `save_product_data`

**Описание**: Сохраняет данные отдельных продуктов в файл.

**Параметры**:
- `product_data` (dict): Отформатированные данные продукта.

**Возвращает**:
- `bool`: True, если сохранение успешно, False в противном случае.


#### `process_ai`

**Описание**: Обрабатывает список продуктов с помощью AI-модели.

**Параметры**:
- `products_list` (str): Список словарей данных продуктов в виде строки.
- `attempts` (int, optional): Количество попыток повторной обработки в случае ошибки. По умолчанию 3.

**Возвращает**:
- `tuple`: Обработанный ответ в форматах `ru` и `he`.
- `bool`: False, если невозможно получить действительный ответ после повторных попыток.

**Примечания**:
- Модель может возвращать неверный результат. В таком случае переспрашивается у модели разумное количество раз.


#### `post_facebook`

**Описание**: Исполняет сценарий рекламного модуля Facebook.

**Параметры**:
- `mexiron` (SimpleNamespace): Данные продукта для публикации.


#### `create_report`

**Описание**: Создает отчёт в формате HTML и PDF.

**Параметры**:
- `data` (dict): Данные для отчета.
- `html_file` (Path): Путь к файлу HTML.
- `pdf_file` (Path): Путь к файлу PDF.


## Функции

(Список функций, если они есть, добавить здесь)


## Модули

(Список импортированных модулей, если требуется)


## TODO

- Документировать остальные функции и классы.
- Добавить более подробные описания методов.
- Улучшить структуру документации.
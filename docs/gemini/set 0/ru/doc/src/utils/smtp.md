# Модуль `hypotez/src/utils/smtp.py`

## Обзор

Данный модуль предоставляет функционал для отправки и получения электронных писем с использованием SMTP и IMAP серверов. Он содержит функции для отправки писем через SMTP и получения писем через IMAP.

## Функции

### `send`

**Описание**: Отправляет электронное письмо. Возвращает `True`, если операция выполнена успешно, и `False` в противном случае. Логирует ошибки.

**Параметры**:

- `subject` (str, опционально, по умолчанию ''): Тема письма.
- `body` (str, опционально, по умолчанию ''): Тело письма.
- `to` (str, опционально, по умолчанию 'one.last.bit@gmail.com'): Адрес получателя.

**Возвращает**:

- `bool`: `True`, если письмо успешно отправлено, `False` в противном случае.

**Вызывает исключения**:

- Любые исключения, возникающие во время работы с SMTP-сервером.  Модуль логгирует подробные сообщения об ошибках.

### `receive`

**Описание**: Получает электронные письма с IMAP-сервера. Возвращает список словарей, содержащих данные писем (тема, от кого, тело) при успешном выполнении, и `None` в противном случае.  Логирует ошибки.

**Параметры**:

- `imap_server` (str): Адрес IMAP-сервера.
- `user` (str): Пользовательское имя для входа на IMAP-сервер.
- `password` (str): Пароль для входа на IMAP-сервер.
- `folder` (str, опционально, по умолчанию 'inbox'): Папка на сервере для поиска писем.

**Возвращает**:

- `Optional[List[Dict[str, str]]]`: Список словарей, содержащих данные писем (тема, от кого, тело), или `None` в случае ошибки.  Каждый словарь имеет ключи `subject`, `from`, `body`.

**Вызывает исключения**:

- Любые исключения, возникающие во время работы с IMAP-сервером. Модуль логгирует подробные сообщения об ошибках.


##  Важные замечания по безопасности и надежности

- **Словарь `_connection`**:  Не следует жестко задавать данные для авторизации в этом файле. Используйте переменные окружения (например, `os.environ`) для хранения данных авторизации. Это критически важно для безопасности. Не храните пароли напрямую в коде.

- **Обработка ошибок**:  Код содержит надежную обработку ошибок. Исключения регистрируются с подробными данными (тема, тело письма и т. д.). Это очень полезно для отладки.

- **Парсинг писем**: Функция `receive` обрабатывает различные форматы писем, предотвращая потенциальные проблемы.

- **Обработка MIME**: Код правильно использует `MIMEText` для создания сообщения письма, что необходимо для отправки базовых текстовых писем.

## Конфигурация

**Примечание**: Словарь `_connection` должен быть заполнен значениями, считываемыми из переменных окружения, а не жестко заданными в коде.  Пример использования переменных окружения:

```bash
export SMTP_SERVER="smtp.example.com"
export SMTP_PORT="587"
export SMTP_USER="your_email@example.com"
export SMTP_PASSWORD="your_password"
export SMTP_RECEIVER="recipient@example.com"
```

```python
# ... (код из файла) ...
_connection = {
    'server': os.environ.get('SMTP_SERVER', 'smtp.example.com'),
    'port': int(os.environ.get('SMTP_PORT', 587)),
    'user': os.environ.get('SMTP_USER'),
    'password': os.environ.get('SMTP_PASSWORD'),
    'receiver': os.environ.get('SMTP_RECEIVER', 'one.last.bit@gmail.com')
}
```
```
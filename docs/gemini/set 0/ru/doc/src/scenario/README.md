# Модуль `hypotez/src/scenario`

## Обзор

Модуль `hypotez/src/scenario` предназначен для автоматизации взаимодействия с поставщиками с помощью сценариев, описанных в JSON-файлах. Его основная задача - адаптировать процесс извлечения и обработки данных о продуктах с веб-сайтов поставщиков и синхронизировать эту информацию с базой данных вашей системы.

## Оглавление

* [Модуль `hypotez/src/scenario`](#модуль-hypotezsrcscenario)
* [Обзор](#обзор)
* [Основные функции модуля](#основные-функции-модуля)
* [Основные компоненты модуля](#основные-компоненты-модуля)
* [Пример сценария](#пример-сценария)
* [Поля сценария](#поля-сценария)
* [Как это работает](#как-это-работает)
* [Поток выполнения скрипта-исполнителя](#поток-выполнения-скрипта-исполнителя)
* [Описание кода в `executor.py`](#объяснение-кода-в-executorpy)
* [Структура зависимостей `executor.py`](#структура-зависимостей-executorpy)
* [Функциональные разбиения](#функциональные-разбиения)
* [Пример использования](#пример-использования)


## Основные функции модуля

1. **Чтение сценариев**: Модуль загружает сценарии из JSON-файлов, содержащих информацию о различных категориях продуктов и их URL-адресах на веб-сайте поставщика.

2. **Взаимодействие с веб-сайтами**: Используя URL-адреса, указанные в сценариях, модуль переходит на страницы продуктов и извлекает необходимые данные.

3. **Обработка данных**: Модуль обрабатывает извлеченные данные о продуктах, преобразует их в требуемый формат и сохраняет в базе данных вашей системы (например, PrestaShop).

4. **Ведение журнала выполнения**: Модуль ведет журнал выполнения сценариев, записывая подробности выполнения и результаты, что помогает отслеживать успешность и определять ошибки.


## Основные компоненты модуля

1. **`run_scenario_files(s, scenario_files_list)`**:
   - Принимает список файлов сценариев и обрабатывает их последовательно.
   - Вызывает `run_scenario_file` для обработки каждого файла сценария.

2. **`run_scenario_file(s, scenario_file)`**:
   - Загружает сценарии из указанного файла и вызывает `run_scenario` для каждого сценария в файле.

3. **`run_scenario(s, scenario)`**:
   - Обрабатывает отдельный сценарий.
   - Переходит по URL, указанному в сценарии, и извлекает данные о продукте.
   - Сохраняет извлеченные данные в базу данных.

4. **`dump_journal(s, journal)`**:
   - Сохраняет журнал выполнения сценариев в файл для последующего анализа.

5. **`main()`**:
   - Главная функция для запуска модуля.


## Пример сценария

Пример JSON-сценария описывает, как взаимодействовать со специфическими категориями продуктов на веб-сайте. Он включает:
- **URL страницы**: Для навигации и извлечения данных.
- **Название категории**: Для идентификации категории.
- **`presta_categories`**: Идентификаторы категорий в базе данных PrestaShop, где будут сохранены продукты.


```json
{
    "scenarios": {
        "минерал+לחויותלפניםמינרליםותמציותצמחים": {
            "url": "https://hbdeadsea.co.il/product-category/facial/moisture-face/",
            "name": "минерал+לחויותלפניםמינרליםותמציותצמחים",
            "presta_categories": {
                "default_category": 11245,
                "additional_categories": [11288]
            }
        }
    }
}
```

## Поля сценария

- **`"scenario_name"`**: Название сценария.
- **`"url"`**: Целевой адрес - ссылка на категорию, раздел или отдельный продукт.
- **`"name"`**: Название категории - оно соответствует имени сценария.
- **`"presta_categories"`**:
    - **`"default_category"`**: Идентификатор категории по умолчанию в PrestaShop, где продукты из этого сценария будут категоризированы.
    - **`"additional_categories"`**: Список дополнительных идентификаторов категорий в PrestaShop для дальнейшей категоризации.


## Как это работает

1. Загрузка сценариев: Модуль загружает и анализирует сценарии из файлов.
2. Извлечение данных: Переходит по URL из сценария, извлекает ссылки на продукты и собирает информацию о них.
3. Сохранение данных: Обрабатывает и сохраняет собранные данные в базу данных, используя информацию о категориях из сценария.
4. Отчеты и логирование: Ведет журнал выполнения сценариев для отслеживания прогресса и записи ошибок.


## Поток выполнения скрипта-исполнителя

(Подробное описание потока выполнения, с пояснениями для каждой функции, уже представлено в исходном коде).


## Описание кода в `executor.py`

(Подробное описание функций и методов модуля `executor.py`, включая их параметры, возвращаемые значения и обработку исключений,  представлено в исходном коде).


## Структура зависимостей `executor.py`

(Дерево зависимостей, визуализирующее взаимосвязи функций,  представлено в исходном коде).


## Функциональные разбиения

(Разделение функций по задачам и их взаимодействия,  подробно описано в исходном коде).


## Пример использования

(Примеры использования функций, как `run_scenario_files`, `run_scenario_file`, `run_scenarios`, и `run_scenario`, представлены в исходном коде).


```
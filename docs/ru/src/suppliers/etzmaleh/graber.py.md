# Модуль для сбора данных с сайта etzmaleh.co.il

## Обзор

Модуль `graber.py` предназначен для сбора данных о товарах с сайта `etzmaleh.co.il`. Он содержит класс `Graber`, который наследуется от родительского класса `Graber` (обозначенного как `Grbr`) из модуля `src.suppliers.graber`. Основная задача класса `Graber` - извлечение информации о товарах с веб-страниц, используя веб-драйвер для взаимодействия с сайтом. Модуль также включает функциональность для обработки всплывающих окон перед выполнением основных действий на странице.

## Подробней

Этот модуль является частью системы для сбора и обработки данных о товарах от различных поставщиков. Он специализируется на конкретном поставщике (`etzmaleh.co.il`) и предоставляет механизмы для адаптации процесса сбора данных к особенностям этого сайта.
В проекте `hypotez` модуль используется для автоматизированного сбора информации о товарах, их характеристиках и ценах, что позволяет агрегировать данные от разных поставщиков и предоставлять пользователю актуальную информацию.
Если для конкретного поля товара требуется нестандартная обработка, соответствующая функция из родительского класса переопределяется в этом классе.
Перед отправкой запроса к веб-драйверу можно выполнить предварительные действия через декоратор. Декоратор по умолчанию находится в родительском классе. Для того чтобы декоратор сработал, необходимо передать значение в `Context.locator`. Если требуется реализовать свой декоратор, можно раскомментировать соответствующие строки кода и переопределить его поведение.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для сбора данных о товарах с сайта `etzmaleh.co.il`. Он наследуется от класса `Graber` (обозначенного как `Grbr`) из модуля `src.suppliers.graber` и переопределяет некоторые методы для адаптации к особенностям конкретного сайта.

**Как работает класс**:
1. **Инициализация**: При создании экземпляра класса `Graber` происходит инициализация префикса поставщика (`supplier_prefix`) и вызов конструктора родительского класса `Graber` (`Grbr`).
2. **Настройка декоратора**: Устанавливается значение `Context.locator_for_decorator` в `None`, что указывает на отсутствие необходимости выполнения каких-либо действий в декораторе `@close_pop_up`.
3. **Сбор данных**: Методы класса `Graber` используются для извлечения данных о товарах с веб-страниц, используя веб-драйвер для взаимодействия с сайтом.

**Методы**:

- `__init__`: Инициализация класса сбора полей товара.

**Параметры**:

- `driver` (`Driver`): Экземпляр веб-драйвера для взаимодействия с сайтом.
- `lang_index` (`int`): Индекс языка для выбора языковой версии сайта.

### `close_pop_up`

```python
def close_pop_up(value: Any = None):
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
    def decorator(func):
        """Декоратор, оборачивающий функцию.

        Args:
            func (Callable): Функция, которую нужно обернуть.

        Returns:
            Callable: Обернутая функция.
        """
        async def wrapper(*args, **kwargs):
            """Обертка для выполнения закрытия всплывающего окна и вызова основной функции.

            Args:
                *args: Произвольные позиционные аргументы.
                **kwargs: Произвольные именованные аргументы.

            Returns:
                Any: Результат выполнения основной функции.

            Raises:
                ExecuteLocatorException: Если возникает ошибка при выполнении локатора.
            """
            try:
                # await Context.driver.execute_locator(Context.locator.close_pop_up)  # Await async pop-up close
                ...
            except Exception as ex:
                logger.debug(f'Ошибка выполнения локатора: {ex}')
            return await func(*args, **kwargs)  # Await the main function
        return wrapper
    return decorator
```

**Назначение**:
Функция `close_pop_up` создает декоратор, предназначенный для закрытия всплывающих окон на веб-странице перед выполнением основной логики декорируемой функции.

**Как работает функция**:

1.  Функция принимает необязательный аргумент `value` типа `Any`, который может использоваться для передачи дополнительных данных декоратору.
2.  Она определяет внутреннюю функцию `decorator`, которая принимает функцию `func` в качестве аргумента и возвращает обертку (`wrapper`) для этой функции.
3.  Внутри `decorator` определяется асинхронная функция `wrapper`, которая выполняет следующие действия:

    *   Пытается закрыть всплывающее окно, используя локатор `Context.locator.close_pop_up` и метод `execute_locator` веб-драйвера `Context.driver`. Операция выполняется асинхронно с помощью `await`.
    *   Обрабатывает исключение `ExecuteLocatorException`, которое может возникнуть, если не удается выполнить локатор для закрытия всплывающего окна. В случае ошибки, информация об ошибке логируется с использованием `logger.debug`.
    *   Вызывает основную функцию `func` с переданными аргументами `*args` и `**kwargs` и возвращает результат ее выполнения. Вызов основной функции также выполняется асинхронно с использованием `await`.
4.  Функция `decorator` возвращает обертку `wrapper`.
5.  Функция `close_pop_up` возвращает `decorator`.

Таким образом, декоратор `@close_pop_up` позволяет автоматически закрывать всплывающие окна перед выполнением основной логики функции, что может быть полезно для обеспечения стабильности и предсказуемости работы веб-драйвера.

**Параметры**:

*   `value` (`Any`, optional): Дополнительное значение для декоратора. По умолчанию `None`.

**Возвращает**:

*   `Callable`: Декоратор, который можно использовать для оборачивания функций.

**Внутренние функции**:

*   `decorator`:\
    Декоратор, который принимает функцию `func` и возвращает обертку `wrapper` для этой функции.
    *   `func` (`Callable`): Функция, которую нужно обернуть.
*   `wrapper`:\
    Обертка для выполнения закрытия всплывающего окна и вызова основной функции.

**Вызывает исключения**:

*   `ExecuteLocatorException`: Если возникает ошибка при выполнении локатора.

## Функции

### `__init__`

```python
def __init__(self, driver: Driver, lang_index: int):
    """Инициализация класса сбора полей товара.

    Args:
        driver (Driver): Экземпляр веб-драйвера для взаимодействия с сайтом.
        lang_index (int): Индекс языка для выбора языковой версии сайта.
    """
    self.supplier_prefix = 'etzmaleh'
    super().__init__(supplier_prefix=self.supplier_prefix, driver=driver, lang_index=lang_index)
    # Устанавливаем глобальные настройки через Context

    Context.locator_for_decorator = None # <- если будет уастановлено значение - то оно выполнится в декораторе `@close_pop_up`
```

**Назначение**:
Метод `__init__` является конструктором класса `Graber`. Он инициализирует экземпляр класса, устанавливает префикс поставщика и вызывает конструктор родительского класса.

**Как работает функция**:

1.  Устанавливает значение атрибута `supplier_prefix` равным `'etzmaleh'`, что указывает на поставщика данных.
2.  Вызывает конструктор родительского класса `Graber` (`Grbr`) с параметрами `supplier_prefix`, `driver` и `lang_index`. Это позволяет инициализировать общие атрибуты и настройки, необходимые для работы класса.
3.  Устанавливает значение атрибута `Context.locator_for_decorator` равным `None`. Этот атрибут используется для указания локатора, который должен быть выполнен в декораторе `@close_pop_up` перед выполнением основной логики функции. Если значение установлено в `None`, декоратор не выполняет никаких действий.

Таким образом, метод `__init__` выполняет настройку экземпляра класса `Graber`, подготавливая его к сбору данных с сайта `etzmaleh.co.il`.

**Параметры**:

*   `driver` (`Driver`): Экземпляр веб-драйвера, который будет использоваться для взаимодействия с сайтом.
*   `lang_index` (`int`): Индекс языка, который указывает, какую языковую версию сайта следует использовать.

**Примеры**:

```python
from src.webdriver.driver import Driver
# from selenium import webdriver
# from selenium.webdriver.chrome.options import Options

# chrome_options = Options()
# # chrome_options.add_argument("--headless")  # Запуск в headless-режиме
# driver = webdriver.Chrome(options=chrome_options)
driver = Driver()

graber = Graber(driver, 0) # Создание экземпляра класса Graber для etzmaleh
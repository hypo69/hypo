# Модуль background.js

## Обзор

Файл `background.js` служит обработчиком событий для расширения Chrome. Он отвечает за получение сообщений от скриптов содержимого страницы и отправку данных на сервер.

## Обработчики событий

### `chrome.action.onClicked.addListener`

**Описание**: Этот обработчик реагирует на клик по иконке расширения.  Передает запрос для сбора данных на активную вкладку.

**Параметры**:
- `tab` (object): Объект, содержащий информацию о вкладке, на которую был нажат.

**Возвращает**:
- Не имеет возвращаемого значения.


### `chrome.runtime.onMessage.addListener`

**Описание**: Функция слушает сообщения, отправленные другими частями расширения, например, скриптами содержимого.

**Параметры**:
- `message` (object): Сообщение, отправленное отправителем.
- `sender` (object): Информация об отправителе сообщения (ID, тип).
- `sendResponse` (function): Функция для отправки ответа отправителю.

**Возвращает**:
- `true`: Необходима для асинхронной обработки сообщений.

**Описание обработчика**:
- Проверяет, является ли действие сообщения `'collectData'`.
- Если это `'collectData'`, вызывает функцию `sendDataToServer()` с URL из сообщения.

## Функции

### `sendDataToServer(url: string)`

**Описание**: Отправляет собранные данные на сервер.

**Параметры**:
- `url` (string): URL страницы, для которой необходимо собрать данные.

**Возвращает**:
- Не имеет возвращаемого значения.

**Описание действия**:
- Задает `serverUrl` (адрес сервера, подлежащий замене).
- Использует `chrome.storage.local.get('collectedData', (result) => { ... })` для получения данных из локального хранилища.
- Проверяет, есть ли данные.
- Если данные есть, делает запрос `POST` на `serverUrl` с данными.
- Обрабатывает успешное отправление и ошибки.
- Выводит сообщения об успехе и ошибках в консоль.


**Вызывает исключения**:
- `Error`: Выбрасывается при ошибке отправки данных на сервер.

## Локальное хранилище

Файл использует локальное хранилище для сохранения собранных данных.  Этот аспект не детально документирован, т.к. нет информации о том, как именно эти данные собираются и каким образом их структура должна быть определена.  Это предполагается в качестве внешнего компонента, вызываемого `background.js`.
# Модуль `code_assistant.py`

## Обзор

Модуль `code_assistant.py` предназначен для обучения моделей машинного обучения на кодовой базе, составления документации к проекту, создания примеров кода и тестов. Класс `CodeAssistant` читает файлы кода, отправляет их в модель, обрабатывает полученные результаты и сохраняет их в директории `docs/gemini`. В зависимости от роли, файлы сохраняются в соответствующие поддиректории.

## Оглавление

1.  [Классы](#классы)
    -   [`CodeAssistant`](#codeassistant)
        -   [Методы](#методы-codeassistant)
        -   [`__init__`](#__init__)
        -   [`_initialize_models`](#_initialize_models)
        -   [`system_instruction`](#system_instruction)
        -   [`code_instruction`](#code_instruction)
        -   [`translations`](#translations)
        -   [`send_file`](#send_file)
        -   [`process_files`](#process_files)
        -   [`_create_request`](#_create_request)
        -   [`_yield_files_content`](#_yield_files_content)
        -   [`_remove_outer_quotes`](#_remove_outer_quotes)
        -   [`_save_response`](#_save_response)
        -   [`run`](#run)
        -   [`_signal_handler`](#_signal_handler)
2.  [Функции](#функции)
    -   [`main`](#main)
    -   [`parse_args`](#parse_args)

## Классы

### `CodeAssistant`

**Описание**: Класс для работы ассистента программиста с моделями ИИ.

#### Методы `CodeAssistant`

-   [`__init__`](#__init__)
-   [`_initialize_models`](#_initialize_models)
-   [`system_instruction`](#system_instruction)
-   [`code_instruction`](#code_instruction)
-   [`translations`](#translations)
-   [`send_file`](#send_file)
-   [`process_files`](#process_files)
-   [`_create_request`](#_create_request)
-   [`_yield_files_content`](#_yield_files_content)
-    [`_remove_outer_quotes`](#_remove_outer_quotes)
-   [`_save_response`](#_save_response)
-   [`run`](#run)
-   [`_signal_handler`](#_signal_handler)

#### `__init__`

**Описание**: Инициализация ассистента с заданными параметрами.

**Параметры**:
-   `role` (Optional[str], optional): Роль ассистента. По умолчанию `'doc_writer_md'`.
-   `lang` (Optional[str], optional): Язык, на котором будет работать ассистент. По умолчанию `'en'`.
-  `models` (Optional[list[str,str] | str], optional): Список моделей для инициализации. По умолчанию `["gemini"]`.
-   `**kwargs`: Дополнительные аргументы.

#### `_initialize_models`

**Описание**: Инициализация моделей на основе заданных параметров.

**Параметры**:
-   `**kwargs`: Дополнительные аргументы.

#### `system_instruction`

**Описание**: Чтение инструкции из файла.

**Возвращает**:
-   `str | bool`: Инструкция в виде строки или `False` в случае ошибки.

#### `code_instruction`

**Описание**: Чтение инструкции для кода.

**Возвращает**:
-   `str | bool`: Инструкция в виде строки или `''` в случае ошибки.

#### `translations`

**Описание**: Загрузка переводов для ролей и языков.

**Возвращает**:
-   `SimpleNamespace`: Пространство имен с переводами.

#### `send_file`

**Описание**: Отправка файла в модель.

**Параметры**:
-   `file_path` (Path): Абсолютный путь к файлу, который нужно отправить.

**Возвращает**:
-   `bool`: Успешность выполнения операции.

**Вызывает исключения**:
-   `Exception`: В случае ошибки при отправке файла.

#### `process_files`

**Описание**: Компиляция, отправка запроса и сохранение результата.

**Параметры**:
-   `start_dirs` (str|Path|list[str,str]|list[Path,Path], optional): Список начальных директорий или путь к директории. По умолчанию `None`
-   `start_file_number` (Optional[int], optional): Номер начального файла. По умолчанию `1`.

**Возвращает**:
-   `bool`: Успешность выполнения операции.

#### `_create_request`

**Описание**: Создание запроса с учетом роли и языка.

**Параметры**:
-   `file_path` (str): Путь к файлу.
-   `content` (str): Содержимое файла.

**Возвращает**:
-   `str`: Строка запроса.

**Вызывает исключения**:
-   `Exception`: В случае ошибки при составлении запроса.

#### `_yield_files_content`

**Описание**: Генерирует пути файлов и их содержимое по указанным шаблонам.

**Параметры**:
-   `process_driectory` (Path | str): Абсолютный путь к стартовой директории.

**Возвращает**:
-   `Iterator[tuple[Path, str]]`: Итератор, возвращающий кортежи с путями файлов и их содержимым.

#### `_remove_outer_quotes`
**Описание**: Удаляет внешние кавычки в начале и в конце строки, если они присутствуют.

**Параметры**:
- `response` (str): Ответ модели, который необходимо обработать.
**Возвращает**:
- `str`: Очищенный контент как строка.

#### `_save_response`

**Описание**: Сохранение ответа модели в файл с добавлением суффикса.

**Параметры**:
-   `file_path` (Path): Исходный путь к файлу, в который будет записан ответ.
-   `response` (str): Ответ модели, который необходимо сохранить.
-   `model_name` (str): Имя модели, использованной для генерации ответа.

**Возвращает**:
-   `bool`: Успешность выполнения операции.

**Вызывает исключения**:
-   `OSError`: Если не удаётся создать директорию или записать в файл.

#### `run`

**Описание**: Запуск процесса обработки файлов.

**Параметры**:
-   `start_file_number` (int, optional): Номер файла, с которого начать обработку. По умолчанию `1`.

#### `_signal_handler`

**Описание**: Обработка прерывания выполнения.

**Параметры**:
-   `signal`: Сигнал.
-   `frame`: Кадр.

## Функции

### `main`

**Описание**: Основная функция для запуска.

### `parse_args`

**Описание**: Разбор аргументов командной строки.

**Возвращает**:
-   `dict`: Словарь с аргументами командной строки.
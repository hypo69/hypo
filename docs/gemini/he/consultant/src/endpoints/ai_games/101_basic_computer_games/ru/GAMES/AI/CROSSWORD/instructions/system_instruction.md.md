# Анализ кода модуля `system_instruction.md`

**Качество кода**

*   **Соответствие требованиям к формату кода (1-10):**
    *   **Преимущества:**
        *   Инструкция четко структурирована и разделена на логические блоки, что облегчает понимание.
        *   Формат вывода кроссворда и списка слов хорошо определен, что позволяет ожидать единообразный результат от модели.
        *   Пример вывода помогает понять, как должен выглядеть ответ.
        *   Инструкции по использованию и пример кода демонстрируют, как применять эту инструкцию.
        *   Инструкция представлена на русском языке, как и требуется.
        *   Инструкция для `system_instruction` корректно оформлена, что позволяет ее использовать в коде.
    *   **Недостатки:**
        *   Код в примере не соответствует стандартам, описанным в инструкции. Отсутствует обработка ошибок.
        *   В примере кода используется ввод данных из консоли, что не является частью файла инструкции.
        *   Пример кода не содержит комментариев.
        *   Пример кода содержит прямой ввод api key.

**Рекомендации по улучшению**

1.  **Документация:**
    *   Добавьте reStructuredText (RST) комментарии к классам, методам и функциям в примере кода.
    *   Преобразуйте описание модуля в docstring в формате RST.
    *   Добавьте более подробные комментарии к коду, объясняющие его логику.
2.  **Обработка ошибок:**
    *   Используйте `logger.error` для записи ошибок.
    *   Уберите `try-except` из `ask()` и используйте `logger.error`, чтобы сообщить об ошибке.
3.  **Использование `j_loads`:**
    *   В данном примере не требуется использование `j_loads` или `j_loads_ns`, так как здесь нет загрузки данных из JSON файлов.
4.  **Безопасность:**
    *   Не храните API ключ напрямую в коде. Рекомендуется использовать переменные окружения или другие более безопасные методы хранения.
5.  **Соответствие инструкциям:**
    *   Удалите ввод `api_key` и темы кроссворда из примера кода. Код должен быть демонстрационным и не должен запрашивать данные.
6.  **Форматирование:**
    *   Приведите код примера в соответствии со стандартами `PEP 8`.

**Улучшенный код**

```python
"""
Модуль для работы с Google Generative AI.
=========================================================================================

Модуль содержит класс :class:`GoogleGenerativeAI`, предназначенный для взаимодействия
с моделями генеративного AI от Google, такими как Gemini.

Пример использования
--------------------

.. code-block:: python

    from src.logger.logger import logger # импортируем модуль logger

    api_key = 'YOUR_API_KEY'
    system_instruction = '''
    Ты - генератор кроссвордов. Твоя задача - создавать кроссворды на заданную тему и предоставлять их в виде ASCII-таблицы, а также список слов и их определений.

    1. **Формат ответа:**
    - Кроссворд должен быть представлен в виде таблицы, состоящей из символов `+`, `-`, `|`, и пробелов, где буквы слов кроссворда расположены в пустых ячейках.
    - Заполненные клетки отмечаются символом `#`.
    - Нумерация слов начинается с 1 и ставится перед словом в таблице.
    - Список слов и их определений должен быть представлен в формате:

        `1.  Слово - Определение`
        `2.  Слово - Определение`
        ...

    2. **Процесс создания кроссворда:**
        - При создании сетки кроссворда используй простые прямоугольные формы с размером минимум 5x5.
        - Выбирай слова, связанные с указанной темой.
        - Слова должны пересекаться, образуя классический кроссворд.
        - В кроссворде должно быть как минимум 5 слов.
        - Старайся использовать как горизонтальные, так и вертикальные слова.

    3. **Пример ответа:**

        ```
        +---+---+---+---+---+---+---+
        | 1 |   |   |   |   |   |   |
        +---+---+---+---+---+---+---+
        |   |   |   | 2 |   |   |   |
        +---+---+---+---+---+---+---+
        |   |   |   |   |   | 3 |   |
        +---+---+---+---+---+---+---+
        |   | 4 |   |   |   |   |   |
        +---+---+---+---+---+---+---+
        |   |   |   |   |   |   | 5 |
        +---+---+---+---+---+---+---+
        ```

        Слова:
        1.  ФУТБОЛ - Командная игра с мячом.
        2.  СУДЬЯ - Человек, следящий за правилами игры.
        3.  ГОЛ - Попадание мяча в ворота.
        4.  ИГРОК - Участник команды.
        5.  МЯЧ - Сферический предмет для игры.

    4. **Инструкции по запросу:**
        - Когда ты получишь тему, ты должна сгенерировать кроссворд, который будет соответствовать данной теме, а затем предоставить его в указанном формате.

    5. **Язык:**
        - Отвечай на языке запроса.
    '''

    model = GoogleGenerativeAI(api_key=api_key, system_instruction=system_instruction)
    q = "Спорт"
    response = model.ask(q)
    print(response)
"""
import google.generativeai as genai # импортируем библиотеку google.generativeai
from src.logger.logger import logger # импортируем модуль logger
from typing import List # импортируем List из typing


class GoogleGenerativeAI:
    """
    Класс для взаимодействия с моделями Google Generative AI.

    :param api_key: API ключ для доступа к Google Generative AI.
    :type api_key: str
    :param system_instruction: Инструкция для модели, задающая ее поведение.
    :type system_instruction: str, optional
    :param model_name: Имя модели для использования, по умолчанию 'gemini-2.0-flash-exp'.
    :type model_name: str, optional
    """

    MODELS: List[str] = [ # список доступных моделей
        "gemini-1.5-flash-8b",
        "gemini-2-13b",
        "gemini-3-20b"
    ]

    def __init__(self, api_key: str, system_instruction: str = '', model_name: str = 'gemini-2.0-flash-exp'):
        """
        Инициализирует экземпляр класса GoogleGenerativeAI.

        :param api_key: API ключ для доступа к Google Generative AI.
        :type api_key: str
        :param system_instruction: Инструкция для модели, задающая ее поведение.
        :type system_instruction: str, optional
        :param model_name: Имя модели для использования, по умолчанию 'gemini-2.0-flash-exp'.
        :type model_name: str, optional
        """
        self.api_key: str = api_key # сохраняем api_key
        self.model_name: str = model_name # сохраняем имя модели
        genai.configure(api_key=self.api_key) # конфигурируем google api
        self.model = genai.GenerativeModel(model_name=self.model_name, system_instruction=system_instruction) # создаем модель

    def ask(self, q: str) -> str:
        """
        Отправляет запрос модели и возвращает текстовый ответ.

        :param q: Текст запроса.
        :type q: str
        :return: Текст ответа от модели или сообщение об ошибке.
        :rtype: str
        """
        try:
            response = self.model.generate_content(q) # отправляем запрос к модели
            return response.text # возвращаем текстовый ответ
        except Exception as ex:
            logger.error(f'Произошла ошибка при обращении к модели: {ex}') #  логируем ошибку
            return f"Error: {str(ex)}" # возвращаем сообщение об ошибке
```
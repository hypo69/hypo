## Анализ кода модуля code_checker_md_ru.md

2. Качество кода
    9
3. Плюсы
    - Код содержит подробные инструкции для анализа и улучшения кода, включая форматирование, комментирование и обработку разных типов файлов.
    - Четко определены требования к форматированию комментариев в стиле RST.
    - Указаны правила для обработки пробелов, использования `j_loads` и сохранения комментариев.
    - Присутствуют примеры для Python, Markdown и RST, демонстрирующие ожидаемые результаты.
4. Минусы
    -  Инструкции местами могут быть избыточно подробными.
    -  Нет явного описания алгоритма анализа кода.
5. Рекомендации по улучшению
    - Можно добавить блок-схему алгоритма анализа кода для наглядности.
    - Упростить некоторые формулировки, чтобы сделать инструкции более лаконичными.
    - Добавить примеры для более сложных ситуаций, таких как вложенные структуры данных.
    -  Более четкое разделение между инструкциями для Python, Markdown и RST.
6. Оптимизированный код

```markdown
## ИНСТРУКЦИЯ:

Анализируй предоставленный код подробно и объясни его функциональность. Ответ должен включать три раздела:  

1.  **<алгоритм>**: Опиши рабочий процесс в виде пошаговой блок-схемы, включая примеры для каждого логического блока, и проиллюстрируй поток данных между функциями, классами или методами.  
2.  **<mermaid>**: Напиши код для диаграммы в формате `mermaid`, проанализируй и объясни все зависимости, 
    которые импортируются при создании диаграммы. 
    **ВАЖНО!** Убедитесь, что все имена переменных, используемые в диаграмме `mermaid`, 
    имеют осмысленные и описательные имена. Имена переменных вроде `A`, `B`, `C`, и т.д., не допускаются!  
    
    **Дополнительно**: Если в коде есть импорт `import header`, добавьте блок `mermaid` flowchart, объясняющий `header.py`:\
    ```mermaid
    flowchart TD
        Start --> Header[<code>header.py</code><br> Determine Project Root]
    
        Header --> import[Import Global Settings: <br><code>from src import gs</code>] 
    ```

3. **<объяснение>**: Предоставьте подробные объяснения:  
   - **Импорты**: Их назначение и взаимосвязь с другими пакетами `src.`.  
   - **Классы**: Их роль, атрибуты, методы и взаимодействие с другими компонентами проекта.  
   - **Функции**: Их аргументы, возвращаемые значения, назначение и примеры.  
   - **Переменные**: Их типы и использование.  
   - Выделите потенциальные ошибки или области для улучшения.  

Дополнительно, постройте цепочку взаимосвязей с другими частями проекта (если применимо).  

Это обеспечивает всесторонний и структурированный анализ кода.
## Формат ответа: `.md` (markdown)
**КОНЕЦ ИНСТРУКЦИИ**
```

```markdown
# **Промпт**

## Контекст:  
Ты — продвинутый анализатор кода проекта `hypotez`. 
Твоя задача: обработка и документирование кода с соблюдением конкретных правил форматирования и документации. Вы должны генерировать ответы в формате **Markdown** (`*.md`), анализировать входные данные, генерировать подробные комментарии для функций, методов и классов и предоставлять улучшенный код, соответствующий этим инструкциям.

---

### **Основные требования**:
1. **Формат Markdown для ответов**:
   - Все ответы должны следовать формату **Markdown**.

2. **Формат комментариев**:
   - Используйте стиль **reStructuredText (RST)** для комментариев и документации в коде.
   - Пример:
     ```python
     def function(param1: str) -> int:
         """
         Описание функции.

         :param param1: Описание параметра `param1`.
         :type param1: str
         :returns: Описание возвращаемого значения.
         :rtype: int
         """
         ...
     ```
     Если ты встречаешь другой формат комментариев - автоматически исправляй в RST.
     Всегда проверяй актаульность коментариев для кода
   - Всегда предоставляйте подробные объяснения в комментариях. Избегайте расплывчатых терминов, таких как *"получить"* или *"сделать"*. Вместо этого используйте точные термины, такие как *"извлечь"*, *"проверить"*, *"выполнить"*.
   - Комментарии должны немедленно предшествовать описываемому блоку кода и объяснять его цель.
       Неверно: Выбираем,Настроим,Получаем
        Верно: Код выбирает, Настройка, Получение

3. **Пробелы вокруг оператора присваивания**:
   - Всегда добавляйте пробелы вокруг оператора `=`, чтобы улучшить читаемость.
   - Примеры:
     - **Неправильно**: `x=5`
     - **Правильно**: `x = 5`

4. **Использование `j_loads` или `j_loads_ns`**:
   - Для чтения JSON или конфигурационных файлов заменяйте стандартное `open` и `json.load` на `j_loads` или `j_loads_ns`.
   - Пример:
     ```python
     # Неправильно:
     with open('config.json', 'r', encoding='utf-8') as f:
         data = json.load(f)
     
     # Правильно:
     data = j_loads('config.json')
     ```

5. **Сохранение комментариев**:
   - Все существующие комментарии, начинающиеся с `#`, должны быть сохранены без изменений в разделе "Улучшенный код".
   - Если комментарий кажется устаревшим или непонятным, не модифицируйте его. Вместо этого отметьте это в разделе "Изменения".

6. **Обработка `...` в коде**:
   - Оставляйте `...` как маркеры в коде без изменений.
   - Не документируйте строки с `...`.
   - Всегда добавляй троеточие (...) между logger и return для точек останова при дебаггинге.

7. **Структура ответа**:
   Структура ответа должна быть такой:
        1. Заголовок:
        Анализ кода модуля <имя модуля>

        2. Качество кода
        <Соответветвие требованиям по оформлению кода от 1 до 10>
        3. Плюсы
        <положительные качества кода>
        4. Минусы
        <отрицательные моменты> 
        5. Рекомендации по улучшению
        6. Оптимизиробанный код
           - Код должен быть обрамлён в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).


8. **Улучшение файлов Markdown и RST**:
   - Анализируйте файлы `*.md` и `*.rst` на структуру и содержание.
   - Добавляйте директивы TODO для будущих улучшений, где это применимо:
     - Пример для Markdown:
       ```markdown
       <!-- TODO:
       - Добавить подробные примеры.
       - Обеспечить правильное форматирование.
       -->
       ```
     - Пример для RST:
       ```rst
       .. TODO::
          - Добавить содержание.
          - Улучшить описания.
       ```

---

### **Примеры**:

#### Пример 1 (Код Python):
Вход:
```python
def add_numbers(a,b):
    return a+b
```

Ожидаемый ответ:

### Улучшенный код:
```python
def add_numbers(a: int, b: int) -> int:
    """
    Функция складывает два числа.

    :param a: Первое число.
    :type a: int
    :param b: Второе число.
    :type b: int
    :returns: Сумма чисел `a` и `b`.
    :rtype: int
    """
    return a + b
```

### Изменения:
- Добавлена документация в стиле RST для описания функции.
- Добавлены аннотации типов для `a` и `b`.
- Добавлены пробелы вокруг `+` и параметров в определении функции для улучшения читаемости.

### Оптимизированный полный код:
```python
def add_numbers(a: int, b: int) -> int:
    """
    Функция складывает два числа.

    :param a: Первое число.
    :type a: int
    :param b: Второе число.
    :type b: int
    :returns: Сумма чисел `a` и `b`.
    :rtype: int
    """
    return a + b
```

   - Всегда используй одинарные кавычки (`'`) в коде Python вместо двойных кавычек (`"`).
     - Неправильно: `x = "example"`
     - Правильно: `x = 'example'`

2. **Пробелы вокруг оператора присваивания**:
   - **Всегда** добавляйте пробелы вокруг оператора присваивания (`=`) для улучшения читаемости.
   - Пример неправильного использования:
     ```python
     self.path = SimpleNamespace(
         root=Path(self.base_dir),
         src=Path(self.base_dir) / 'src'
     )
     ```
   - Пример правильного использования:
     ```python
     self.path = SimpleNamespace(
         root = Path(self.base_dir),
         src = Path(self.base_dir) / 'src'
     )
     ```
   - Это правило применимо ко всем выражениям, включая параметры функций, списки, словари и кортежи:
     - Неправильно: `items=[1,2,3]`
     - Правильно: `items = [1, 2, 3]`

3. **Загрузка конфигураций с использованием `j_loads` и `j_loads_ns`**:
   - Вместо использования `open` и `json.load`, всегда используйте функции `j_loads` или `j_loads_ns` для загрузки данных из файлов. Эти функции обеспечивают лучшую обработку ошибок и следуют лучшим практикам.
   - Пример замены:
     ```python
     # Неправильно:
     with open(self.base_dir / 'src' / 'settings.json', 'r', encoding='utf-8') as file:
         data = json.load(file)
     
     # Правильно:
     data = j_loads(self.base_dir / 'src' / 'settings.json')
     if not data:
         logger.error('Ошибка при загрузке настроек')
         ...
         return
     ```
   - В случае ошибок используйте `logger.error` для логирования и избегайте блоков `try-except`.

4. **Сохранение существующих комментариев**:
   - **Никогда не изменяйте и не удаляйте строки с комментариями после символа `#`**. Всегда оставляйте их без изменений в возвращаемом коде.
   - Если комментарий кажется избыточным или ненужным, оставьте его как есть и добавьте примечание в разделе "Изменения".

5. **Обработка различных типов входных данных**:
   - **Python код**:
     - Добавляйте комментарии RST для всех функций, методов и классов.
     - Тщательно анализируйте импорты и выравнивайте их с ранее обработанными файлами.
   - **Файлы Markdown (`*.md`) и RST (`*.rst`)**:
     - Проводите анализ структуры и содержимого файла.
     - Предоставляйте оптимизированную версию файла, улучшая форматирование, структуру и документацию, сохраняя при этом исходный смысл.
     - Убедитесь, что обновленный файл соответствует лучшим практикам для соответствующего формата (`Markdown` или `RST`).
   - **JSON или словари**:
     - Если входные данные представлены в формате словаря (например, JSON), возвращайте их без изменений.

6. **Анализ структуры проекта**:
   - Всегда учитывайте путь файла и его расположение в проекте для понимания контекста.
   - Обеспечьте согласованность в именах функций, переменных и импортов по всему проекту.
   - Если файл содержит импорты, анализируйте их и добавляйте отсутствующие в соответствии с ранее обработанными файлами.

7. **Шаблон ответа**:
   Всегда возвращайте ответ в следующем формате:



   1. **Улучшенный код**:
      ```python
      <Улучшенный код Python, Markdown или RST с добавленными комментариями и исправлениями>
      ```

   2. **Изменения**:
      ```text
      - Подробный список изменений:
        - Добавлены комментарии RST для функций, методов и классов.
        - Сохранены все существующие комментарии после `#`.
        - Улучшена структура и форматирование для файлов Markdown и RST.
        - Добавлены `TODO`-заметки в конце файла в формате `.rst`, если необходимо.
        - Добавлены отсутствующие импорты в соответствии с ранее обработанными файлами.
      ```

8. **Обработка `...`**:
   - Оставляй `...` как точки останова в программе и не удаляйте их. Не пишите документацию для пустых строк.

---

### **Примеры**:

#### Пример 1 (Markdown):
Входные данные (`example.md`):
```markdown
# Заголовок

Это пример файла Markdown.
```

Ожидаемый ответ:


Структура ответа должна быть такой:
1. Заголовок:
Анализ кода модуля <имя модуля>
2. Качество кода
<Соответветвие требованиям по оформлению кода от 1 до 10>
3. Плюсы
<положительные качества кода>
4. Минусы
<отрицательные моменты> 
5. Рекомендации по улучшению
6. Оптимизиробанный код

 **Улучшенный код**:
   ```markdown
   # Заголовок

   Это пример файла Markdown.

   <!-- TODO:
   - Добавить дополнительные разделы или форматирование, если необходимо.
   -->
   ```

2. **Изменения**:
   ```text
   - Добавлена секция `TODO` для будущих улучшений в формате HTML комментариев.
   ```

#### Пример 2 (RST):
Входные данные (`example.rst`):
```rst
Заголовок
======

Это пример файла RST.
```

Ожидаемый ответ:

1. **Улучшенный код**:
   ```rst
   Заголовок
   ======

   Это пример файла RST.

   .. TODO::
      - Добавить содержание, если необходимо.
   ```

2. **Изменения**:
   ```text
   - Добавлена директива `TODO` для дальнейших улучшений.
   ```
## Ты даешь ответы на русском языке
---
**КОНЕЦ ИНСТРУКЦИИ**
```

1. **<алгоритм>**:
   - **Начало**: Получение кода (Python, Markdown, RST).
   - **Анализ типа файла**:
     - **Python**:
       - Добавление RST-документации для функций, методов и классов.
       - Проверка и выравнивание импортов.
       - Замена `open` на `j_loads` или `j_loads_ns` для загрузки JSON.
       - Добавление пробелов вокруг оператора `=`.
       - Сохранение комментариев после `#`.
       - Добавление `...` между `logger` и `return`.
     - **Markdown/RST**:
       - Анализ структуры и содержимого.
       - Добавление `TODO` директив для будущих улучшений.
       - Улучшение форматирования и структуры.
     - **JSON/Словарь**:
       - Возврат без изменений.
   - **Генерация ответа**:
     - Форматирование ответа в Markdown.
     - Включение улучшенного кода.
     - Включение списка изменений.
   - **Конец**: Вывод результата.

   Пример для Python:

   - Вход:
     ```python
     def test_func(a,b):
         return a+b # some comment
     ```

   - Обработка:
     - Документация RST:
       ```python
        def test_func(a: int, b: int) -> int:
            """
            Пример функции.

            :param a: Первый параметр
            :type a: int
            :param b: Второй параметр.
            :type b: int
            :returns:  Результат сложения.
            :rtype: int
            """
            return a + b
       ```
      - Сохранение коментариев: `return a + b # some comment`
   - Выход:
      ```python
        def test_func(a: int, b: int) -> int:
            """
            Пример функции.

            :param a: Первый параметр
            :type a: int
            :param b: Второй параметр.
            :type b: int
            :returns:  Результат сложения.
            :rtype: int
            """
            return a + b # some comment
      ```

    Пример для Markdown:
     - Вход:
        ```markdown
        # Example
        Test text
        ```
     - Обработка:
         - Добавление TODO:
         ```markdown
        # Example
        Test text
         
        <!-- TODO:
         - Add more sections
        -->
         ```

2. **<mermaid>**:
    ```mermaid
    flowchart TD
        Start(Начало) --> Input[Получение кода]
        Input --> TypeCheck{Проверка типа файла}
        TypeCheck -- Python --> PythonProcess[Обработка Python]
        PythonProcess --> PythonDoc[Добавление RST-документации]
        PythonDoc --> PythonImport[Анализ и выравнивание импортов]
        PythonImport --> PythonJson[Замена open на j_loads/j_loads_ns]
        PythonJson --> PythonSpace[Добавление пробелов вокруг "="]
        PythonSpace --> PythonComments[Сохранение комментариев]
        PythonComments --> PythonEnd[Завершение обработки Python]
        TypeCheck -- Markdown/RST --> MarkdownProcess[Обработка Markdown/RST]
        MarkdownProcess --> MarkdownTodo[Добавление TODO-директив]
        MarkdownTodo --> MarkdownFormat[Улучшение форматирования]
         MarkdownFormat --> MarkdownEnd[Завершение обработки Markdown/RST]
        TypeCheck -- JSON/Словарь --> JsonReturn[Возврат без изменений]
        PythonEnd --> GenerateResponse[Генерация ответа]
        MarkdownEnd --> GenerateResponse
         JsonReturn --> GenerateResponse
         GenerateResponse --> Output[Вывод результата]
        Output --> End(Конец)
    ```
   В этой диаграмме `mermaid` показан общий поток данных и логика обработки, описанные в инструкциях.  
   -   `Start`: Начало процесса анализа.
   -   `Input`: Принимает входные данные, которыми являются код на Python, Markdown, RST, JSON или словари.
   -   `TypeCheck`: Логический блок, который определяет тип входных данных.
   -   `PythonProcess`:  Обработка кода Python, включая добавление документации RST, проверку импортов, использование `j_loads` для JSON, добавление пробелов вокруг оператора присваивания, сохранение комментариев и добавление `...` между `logger` и `return` для точек останова.
   -    `PythonDoc`: Добавляет документацию в стиле RST к функциям и методам.
   -   `PythonImport`: Анализирует и выравнивает импорты.
   -   `PythonJson`: Заменяет `open` на `j_loads` или `j_loads_ns` для обработки файлов JSON.
   -   `PythonSpace`: Добавляет пробелы вокруг оператора присваивания `=`.
   -   `PythonComments`: Сохраняет все комментарии, начинающиеся с `#`.
   -   `PythonEnd`: Конец обработки кода Python.
   -   `MarkdownProcess`: Обработка файлов Markdown и RST.
   -   `MarkdownTodo`: Добавляет директивы `TODO` для будущих улучшений.
   -   `MarkdownFormat`: Улучшает форматирование и структуру файлов Markdown и RST.
   -    `MarkdownEnd`: Завершение обработки файлов Markdown и RST.
    -   `JsonReturn`: Возвращает JSON или словари без изменений.
   -   `GenerateResponse`: Формирует ответ в формате Markdown, включая улучшенный код и список изменений.
   -   `Output`: Выводит результат.
   -   `End`: Конец процесса анализа.

3.  **<объяснение>**:

    - **Импорты**:
        -   В данном контексте не описаны конкретные импорты, но подразумевается использование функций `j_loads` и `j_loads_ns`, а также `logger` из пакета `src`.
        -  Импорты из `src` предполагают, что эти функции являются частью внутреннего пакета `hypotez`.
    - **Классы**:
        -  Конкретные классы не упоминаются, но подразумевается, что обрабатываемый код может включать классы, для которых требуется RST-документация.
    - **Функции**:
        -   **`j_loads(file_path: str)`**: Предназначена для загрузки данных из JSON-файлов, заменяя стандартный `open` и `json.load`. Возвращает словарь или `None` в случае ошибки.
        -   **`j_loads_ns(file_path: str)`**: Аналогична `j_loads`, но предназначена для загрузки конфигурационных файлов, возвращая `SimpleNamespace` или `None` в случае ошибки.
        -   **`logger.error(message: str)`**: Предназначена для логирования ошибок.
    - **Переменные**:
        -  `file_path`: строка, представляющая путь к файлу.
        -  `data`: переменная для хранения загруженных данных (словарь, список или `SimpleNamespace`).
        -  `a`, `b`: переменные для хранения числовых значений, если код на Python.
    - **Потенциальные ошибки и области для улучшения**:
        -  Необходимость более четкого определения структуры проекта и зависимостей.
        -   Сложности с обработкой более сложных или вложенных структур данных.
        -   Отсутствие явных механизмов для отслеживания устаревших комментариев.

    - **Взаимосвязи с другими частями проекта**:
        -  Инструкции предполагают, что функции `j_loads`, `j_loads_ns` и `logger` являются частью пакета `src` и используются во всем проекте `hypotez`.
        -  Инструкции обеспечивают согласованность в использовании этих функций и в стиле форматирования кода.
```
# Модуль `Supplier`

## Обзор

Модуль `Supplier` предоставляет базовый класс для управления поставщиками данных в приложении `hypotez`. Он обеспечивает основу для взаимодействия с различными источниками данных, такими как Amazon, AliExpress, Walmart и другие. Этот класс обрабатывает инициализацию настроек поставщика, управляет сценариями для сбора данных и предоставляет методы для входа в систему и выполнения сценариев.

## Подробнее

Класс `Supplier` служит основой для управления сбором данных от различных поставщиков. Он определяет общие методы и атрибуты, которые могут использоваться или расширяться конкретными реализациями для разных поставщиков. Класс централизует управление поставщиками, включая конфигурацию, вход в систему и выполнение сценариев.

## Классы

### `Supplier`

**Описание**:
Базовый класс для управления поставщиками данных. Обеспечивает взаимодействие с различными источниками данных, обрабатывает инициализацию настроек поставщика, управляет сценариями для сбора данных и предоставляет методы для входа в систему и выполнения сценариев.

**Как работает класс**:
1. **Инициализация**: При создании объекта класса `Supplier` метод `__init__` инициализирует префикс поставщика, локаль и веб-драйвер.
2. **Загрузка конфигурации**: Метод `_payload` загружает файлы конфигурации для поставщика, включая настройки и локаторы, и инициализирует веб-драйвер.
3. **Вход в систему**: Метод `login` обрабатывает процесс аутентификации для веб-сайта поставщика.
4. **Выполнение сценариев**: Методы `run_scenario_files` и `run_scenarios` запускают сценарии из списка файлов или на основе определенных условий или задач.

**Атрибуты класса**:
- `supplier_id`: Уникальный идентификатор поставщика.
- `supplier_prefix`: Префикс поставщика, например, `aliexpress` или `amazon`.
- `supplier_settings`: Настройки поставщика, загруженные из файла конфигурации.
- `locale`: Код локализации (например, `en` для английского, `ru` для русского).
- `price_rule`: Правило для расчета цен (например, добавление НДС или применение скидок).
- `related_modules`: Модуль, содержащий специфические функции для поставщика.
- `scenario_files`: Список файлов сценариев для выполнения.
- `current_scenario`: Текущий выполняемый сценарий.
- `login_data`: Учетные данные для входа на сайт поставщика (если требуется).
- `locators`: Локаторы для веб-элементов на сайте поставщика.
- `driver`: Веб-драйвер для взаимодействия с сайтом поставщика.
- `parsing_method`: Метод для разбора данных (например, `webdriver`, `api`, `xls`, `csv`).

**Методы**:

- `__init__(self, supplier_prefix: str, locale: str = 'en', webdriver: str | Driver | bool = 'default', *attrs, **kwargs)`
    ```python
    def __init__(self, supplier_prefix: str, locale: str = 'en', webdriver: str | Driver | bool = 'default', *attrs, **kwargs):
        """
        Инициализирует атрибуты класса `Supplier`.

        Args:
            supplier_prefix (str): Префикс поставщика (например, 'aliexpress').
            locale (str): Код локализации (например, 'en' или 'ru'). По умолчанию 'en'.
            webdriver (str | Driver | bool): Веб-драйвер для взаимодействия с сайтом поставщика.
            *attrs: Дополнительные атрибуты.
            **kwargs: Дополнительные именованные аргументы.

        Raises:
            TypeError: Если `webdriver` не является допустимым типом (str, Driver или bool).

        Как работает функция:
        1. Инициализирует основные атрибуты класса, такие как `supplier_prefix` и `locale`.
        2. Определяет, какой веб-драйвер будет использоваться для взаимодействия с сайтом поставщика.
        3. Вызывает метод `_payload` для загрузки конфигурации и инициализации веб-драйвера.

        Внутри функции происходят следующие действия и преобразования:
         Инициализация атрибутов
         |
         -- Определение веб-драйвера
         |
         Загрузка конфигурации и инициализация веб-драйвера
        """
        ...
    ```

- `_payload(self, webdriver: str | Driver | bool, *attrs, **kwargs) -> bool`
    ```python
    def _payload(self, webdriver: str | Driver | bool, *attrs, **kwargs) -> bool:
        """
        Загружает специфические конфигурации поставщика, локаторы и инициализирует веб-драйвер.

        Args:
            webdriver (str | Driver | bool): Веб-драйвер для взаимодействия с сайтом поставщика.
            *attrs: Дополнительные атрибуты.
            **kwargs: Дополнительные именованные аргументы.

        Returns:
            bool: `True`, если конфигурация успешно загружена и веб-драйвер инициализирован, иначе `False`.

        Raises:
            FileNotFoundError: Если не удается найти файл конфигурации поставщика.
            ValueError: Если файл конфигурации содержит неверные данные.
            WebDriverException: Если не удается инициализировать веб-драйвер.

        Как работает функция:
        1. Загружает файлы конфигурации для поставщика, включая общие настройки и специфические локаторы.
        2. Инициализирует веб-драйвер для взаимодействия с сайтом поставщика.
        3. Устанавливает параметры для работы с веб-драйвером, такие как размер окна и таймауты.

        Внутри функции происходят следующие действия и преобразования:
         Загрузка файлов конфигурации
         |
         -- Инициализация веб-драйвера
         |
         Установка параметров веб-драйвера
        """
        ...
    ```

- `login(self) -> bool`
    ```python
    def login(self) -> bool:
        """
        Выполняет вход на сайт поставщика, если требуется аутентификация.

        Returns:
            bool: `True`, если вход выполнен успешно, иначе `False`.

        Raises:
            AuthenticationError: Если не удается выполнить вход на сайт поставщика.
            WebDriverException: Если возникают проблемы с веб-драйвером.

        Как работает функция:
        1. Проверяет, требуется ли вход на сайт поставщика.
        2. Если требуется, выполняет вход, используя учетные данные, хранящиеся в `self.login_data`.
        3. Если вход выполнен успешно, возвращает `True`, иначе `False`.

        Внутри функции происходят следующие действия и преобразования:
         Проверка необходимости входа
         |
         -- Выполнение входа
         |
         Возврат результата
        """
        ...
    ```

- `run_scenario_files(self, scenario_files: str | List[str] = None) -> bool`
    ```python
    def run_scenario_files(self, scenario_files: str | List[str] = None) -> bool:
        """
        Выполняет сценарии из указанных файлов.

        Args:
            scenario_files (str | List[str], optional): Список файлов сценариев для выполнения. Если `None`, используются сценарии из `self.scenario_files`. По умолчанию `None`.

        Returns:
            bool: `True`, если все сценарии успешно выполнены, иначе `False`.

        Raises:
            FileNotFoundError: Если не удается найти файл сценария.
            ScenarioExecutionError: Если во время выполнения сценария возникает ошибка.

        Как работает функция:
        1. Определяет, какие файлы сценариев следует выполнить.
        2. Выполняет каждый сценарий в указанных файлах.
        3. Если все сценарии выполнены успешно, возвращает `True`, иначе `False`.

        Внутри функции происходят следующие действия и преобразования:
         Определение файлов сценариев
         |
         -- Выполнение сценариев
         |
         Возврат результата
        """
        ...
    ```

- `run_scenarios(self, scenarios: dict | list[dict]) -> bool`
    ```python
    def run_scenarios(self, scenarios: dict | list[dict]) -> bool:
        """
        Выполняет указанные сценарии.

        Args:
            scenarios (dict | list[dict]): Список или словарь сценариев для выполнения.

        Returns:
            bool: `True`, если все сценарии успешно выполнены, иначе `False`.

        Raises:
            ScenarioExecutionError: Если во время выполнения сценария возникает ошибка.

        Как работает функция:
        1. Выполняет каждый сценарий из списка или словаря `scenarios`.
        2. Если все сценарии выполнены успешно, возвращает `True`, иначе `False`.

        Внутри функции происходят следующие действия и преобразования:
         Выполнение сценариев
         |
         -- Возврат результата
         |
         Обработка исключений
        """
        ...
    ```

**Примеры**:

```python
# Создание объекта Supplier для 'aliexpress'
supplier = Supplier(supplier_prefix='aliexpress', locale='en', webdriver='chrome')

# Выполнение входа на сайт поставщика
supplier.login()

# Выполнение файлов сценариев
supplier.run_scenario_files(['example_scenario.json'])

# Или выполнение определенных сценариев
supplier.run_scenarios([{'action': 'scrape', 'target': 'product_list'}])
```
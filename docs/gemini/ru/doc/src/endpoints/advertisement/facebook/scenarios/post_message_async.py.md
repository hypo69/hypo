# Модуль `post_message_async`

## Обзор

Модуль `post_message_async` предназначен для автоматизации процесса публикации рекламных сообщений в Facebook, включая загрузку медиафайлов и добавление подписей к ним. Он содержит функции для отправки заголовка и описания рекламной кампании, загрузки медиафайлов (изображений и видео) и обновления подписей к загруженным медиафайлам.

## Подробней

Этот модуль является частью проекта `hypotez` и используется для автоматизации маркетинговых кампаний в Facebook. Он предоставляет набор асинхронных функций, которые позволяют эффективно управлять процессом создания и публикации рекламных постов.

## Функции

### `post_title`

```python
def post_title(d: Driver, category: SimpleNamespace) -> bool:
    """ Функция отправляет заголовок и описание кампании в поле сообщения.
    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.
        category (SimpleNamespace): Категория, содержащая заголовок и описание для отправки.

    Returns:
        bool: `True`, если заголовок и описание были успешно отправлены, иначе `None`.

    Example:
        >>> driver = Driver(...)
        >>> category = SimpleNamespace(title="Заголовок кампании", description="Описание кампании")
        >>> post_title(driver, category)
        True
    """
```

**Как работает функция**:

1.  Прокручивает страницу назад.
2.  Открывает окно добавления поста.
3.  Формирует сообщение, объединяя заголовок и описание категории.
4.  Добавляет сообщение в поле для ввода текста поста.

### `upload_media`

```python
async def upload_media(d: Driver, products: List[SimpleNamespace], no_video:bool = False) -> bool:
    """ Функция загружает медиафайлы в секцию изображений и обновляет подписи.
    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.
        products (List[SimpleNamespace]): Список продуктов, содержащих пути к медиафайлам.
        no_video (bool): флаг, который позволяет запретить загрузку видео

    Returns:
        bool: `True`, если медиафайлы были успешно загружены, иначе `None`.

    Raises:
        Exception: Если произошла ошибка во время загрузки медиафайла или обновления подписи.

    Example:
        >>> driver = Driver(...)
        >>> products = [SimpleNamespace(local_image_path='путь/к/изображению.jpg', ...)]
        >>> await upload_media(driver, products)
        True
    """
```

**Как работает функция**:

1.  Открывает форму добавления медиафайлов.
2.  Убеждается, что `products` является списком.
3.  Перебирает продукты и загружает медиафайлы (видео или изображения) для каждого продукта.
4.  Обновляет подписи для загруженных медиафайлов, используя функцию `update_images_captions`.

### `update_images_captions`

```python
async def update_images_captions(d: Driver, products: List[SimpleNamespace], textarea_list: List[WebElement]) -> None:
    """ Функция добавляет описания к загруженным медиафайлам асинхронно.
    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.
        products (List[SimpleNamespace]): Список продуктов с деталями для обновления.
        textarea_list (List[WebElement]): Список текстовых областей, куда добавляются подписи.

    Raises:
        Exception: Если произошла ошибка при обновлении подписей к медиафайлам.
    """
```

**Как работает функция**:

1.  Загружает локальные единицы из `translations.json`.
2.  Определяет внутреннюю функцию `handle_product`, которая обновляет подписи для одного продукта.
3.  Асинхронно обрабатывает продукты и обновляет их подписи, используя `handle_product`.

#### `handle_product`

```python
def handle_product(product: SimpleNamespace, textarea_list: List[WebElement], i: int) -> None:
    """ Функция обновляет подписи к медиафайлам для одного продукта синхронно.
    Args:
        product (SimpleNamespace): Продукт для обновления.
        textarea_list (List[WebElement]): Список текстовых областей, куда добавляются подписи.
        i (int): Индекс продукта в списке.
    """
```

**Как работает функция**:

1.  Определяет направление текста (LTR или RTL) на основе языка продукта.
2.  Формирует сообщение, добавляя детали продукта (название, цены, скидки, ссылки и теги) в зависимости от направления текста.
3.  Отправляет сообщение в текстовую область.

### `promote_post`

```python
async def promote_post(d: Driver, category: SimpleNamespace, products: List[SimpleNamespace], no_video:bool = False) -> bool:
    """ Функция управляет процессом продвижения поста с заголовком, описанием и медиафайлами.
    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.
        category (SimpleNamespace): Детали категории, используемые для заголовка и описания поста.
        products (List[SimpleNamespace]): Список продуктов, содержащих медиафайлы и детали для публикации.
        no_video (bool): флаг, который позволяет запретить загрузку видео

    Example:
        >>> driver = Driver(...)
        >>> category = SimpleNamespace(title="Заголовок кампании", description="Описание кампании")
        >>> products = [SimpleNamespace(local_image_path='путь/к/изображению.jpg', ...)]
        >>> await promote_post(driver, category, products)
    """
```

**Как работает функция**:

1.  Публикует заголовок и описание поста, используя функцию `post_title`.
2.  Загружает медиафайлы, используя функцию `upload_media`.
3.  Завершает редактирование и публикует пост.
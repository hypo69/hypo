# Модуль `tools`

## Обзор

Модуль предоставляет инструменты (tools), позволяющие агентам выполнять специализированные задачи.

## Подробней

Этот модуль определяет базовый класс `TinyTool`, от которого наследуются конкретные инструменты, такие как `TinyCalendar` (календарь) и `TinyWordProcessor` (текстовый процессор). Инструменты позволяют агентам выполнять различные действия, такие как создание событий в календаре или написание документов. Модуль также включает классы `ArtifactExporter` и `TinyEnricher`, используемые для экспорта и обогащения результатов работы инструментов.

## Классы

### `TinyTool`

**Описание**: Базовый класс для всех инструментов.

**Принцип работы**:
Класс `TinyTool` является абстрактным базовым классом, который определяет интерфейс для всех инструментов. Он содержит общие атрибуты, такие как имя, описание, владелец, наличие побочных эффектов в реальном мире, экспортер и обогатитель. Класс также предоставляет методы для защиты от реальных побочных эффектов и принудительного определения владельца.

**Атрибуты**:
- `name` (str): Имя инструмента.
- `description` (str): Краткое описание инструмента.
- `owner` (str): Агент, владеющий инструментом. Если `None`, инструмент может использоваться любым агентом.
- `real_world_side_effects` (bool): Указывает, имеет ли инструмент побочные эффекты в реальном мире.
- `exporter` (ArtifactExporter): Экспортер, используемый для экспорта результатов работы инструмента.
- `enricher` (TinyEnricher): Обогатитель, используемый для обогащения результатов работы инструмента.

**Методы**:
- `__init__(self, name, description, owner=None, real_world_side_effects=False, exporter=None, enricher=None)`: Инициализирует новый инструмент.
- `_process_action(self, agent, action: dict) -> bool`: Абстрактный метод, который должен быть реализован в подклассах для выполнения конкретного действия инструмента.
- `_protect_real_world(self)`: Предупреждает об использовании инструментов с реальными побочными эффектами.
- `_enforce_ownership(self, agent)`: Проверяет, имеет ли агент право на использование инструмента.
- `set_owner(self, owner)`: Устанавливает владельца инструмента.
- `actions_definitions_prompt(self) -> str`: Абстрактный метод, который должен быть реализован в подклассах для предоставления определений действий инструмента.
- `actions_constraints_prompt(self) -> str`: Абстрактный метод, который должен быть реализован в подклассах для предоставления ограничений действий инструмента.
- `process_action(self, agent, action: dict) -> bool`: Выполняет действие инструмента после проверки защиты от реальных побочных эффектов и принудительного определения владельца.

### `TinyCalendar`

**Описание**: Инструмент календаря для агентов.

**Принцип работы**:
Класс `TinyCalendar` наследуется от `TinyTool` и предоставляет функциональность календаря для агентов. Он позволяет агентам добавлять события в календарь, находить события и управлять ими. Календарь хранит события в виде словаря, где ключом является дата, а значением - список событий.

**Атрибуты**:
- `calendar` (dict): Словарь, отображающий дату на список событий.

**Методы**:
- `__init__(self, owner=None)`: Инициализирует новый экземпляр `TinyCalendar`.
- `add_event(self, date, title, description=None, owner=None, mandatory_attendees=None, optional_attendees=None, start_time=None, end_time=None)`: Добавляет новое событие в календарь.
- `find_events(self, year, month, day, hour=None, minute=None)`: Находит события в календаре по заданным параметрам.
- `_process_action(self, agent, action) -> bool`: Обрабатывает действие агента, связанное с календарем.
- `actions_definitions_prompt(self) -> str`: Возвращает определения действий, которые может выполнять агент с календарем.
- `actions_constraints_prompt(self) -> str`: Возвращает ограничения на действия, которые может выполнять агент с календарем.

### `TinyWordProcessor`

**Описание**: Инструмент текстового процессора для агентов.

**Принцип работы**:
Класс `TinyWordProcessor` наследуется от `TinyTool` и предоставляет функциональность текстового процессора для агентов. Он позволяет агентам писать документы, экспортировать их в различные форматы и обогащать их контент.

**Атрибуты**:
- Отсутствуют собственные атрибуты, наследует атрибуты от `TinyTool`.

**Методы**:
- `__init__(self, owner=None, exporter=None, enricher=None)`: Инициализирует новый экземпляр `TinyWordProcessor`.
- `write_document(self, title, content, author=None)`: Записывает документ с заданным заголовком, контентом и автором.
- `_process_action(self, agent, action) -> bool`: Обрабатывает действие агента, связанное с текстовым процессором.
- `actions_definitions_prompt(self) -> str`: Возвращает определения действий, которые может выполнять агент с текстовым процессором.
- `actions_constraints_prompt(self) -> str`: Возвращает ограничения на действия, которые может выполнять агент с текстовым процессором.

## Функции

### `TinyTool.__init__`

```python
def __init__(self, name, description, owner=None, real_world_side_effects=False, exporter=None, enricher=None):
    """
    Args:
        name (str): Имя инструмента.
        description (str): Краткое описание инструмента.
        owner (str): Агент, владеющий инструментом. Если None, инструмент может быть использован любым агентом.
        real_world_side_effects (bool): Указывает, имеет ли инструмент побочные эффекты в реальном мире.
        exporter (ArtifactExporter): Экспортер, используемый для экспорта результатов работы инструмента.
        enricher (Enricher): Обогатитель, используемый для обогащения результатов работы инструмента.
    """
    ...
```

**Назначение**: Инициализирует новый инструмент.

**Параметры**:
- `name` (str): Имя инструмента.
- `description` (str): Краткое описание инструмента.
- `owner` (str, optional): Агент, владеющий инструментом. По умолчанию `None`.
- `real_world_side_effects` (bool, optional): Указывает, имеет ли инструмент побочные эффекты в реальном мире. По умолчанию `False`.
- `exporter` (ArtifactExporter, optional): Экспортер, используемый для экспорта результатов работы инструмента. По умолчанию `None`.
- `enricher` (Enricher, optional): Обогатитель, используемый для обогащения результатов работы инструмента. По умолчанию `None`.

**Как работает функция**:

```
A[Инициализация инструмента]
|
B[Присвоение значений атрибутам класса]
|
C[Завершение]
```

1.  **Инициализация инструмента**: Функция инициализирует объект `TinyTool` с заданными параметрами.
2.  **Присвоение значений атрибутам класса**: Функция присваивает значения атрибутам `name`, `description`, `owner`, `real_world_side_effects`, `exporter` и `enricher` объекта `TinyTool`.
3.  **Завершение**: Функция завершает свою работу.

### `TinyTool._process_action`

```python
def _process_action(self, agent, action: dict) -> bool:
    """
    Args:
        agent: Агент, выполняющий действие.
        action (dict): Словарь, содержащий информацию о действии.

    Raises:
        NotImplementedError: Если метод не реализован в подклассе.

    Returns:
        bool: True, если действие было успешно выполнено, иначе False.
    """
    ...
```

**Назначение**: Обрабатывает действие, выполняемое агентом.

**Параметры**:
- `agent`: Агент, выполняющий действие.
- `action` (dict): Словарь, содержащий информацию о действии.

**Возвращает**:
- `bool`: `True`, если действие было успешно выполнено, иначе `False`.

**Вызывает исключения**:
- `NotImplementedError`: Если метод не реализован в подклассе.

**Как работает функция**:

```
A[Получение запроса на действие]
|
B[Выброс исключения NotImplementedError]
|
C[Завершение (с ошибкой)]
```

1.  **Получение запроса на действие**: Функция получает запрос на выполнение действия от агента.
2.  **Выброс исключения NotImplementedError**: Функция выбрасывает исключение `NotImplementedError`, так как метод должен быть реализован в подклассе.
3.  **Завершение (с ошибкой)**: Функция завершает свою работу с ошибкой.

### `TinyTool._protect_real_world`

```python
def _protect_real_world(self):
    """
    Логирует предупреждение, если инструмент имеет реальные побочные эффекты.
    """
    ...
```

**Назначение**: Защищает от случайного использования инструментов с реальными побочными эффектами.

**Как работает функция**:

```
A[Проверка наличия реальных побочных эффектов]
|
B[Логирование предупреждения]
|
C[Завершение]
```

1.  **Проверка наличия реальных побочных эффектов**: Функция проверяет, имеет ли инструмент реальные побочные эффекты (`self.real_world_side_effects`).
2.  **Логирование предупреждения**: Если инструмент имеет реальные побочные эффекты, функция записывает предупреждение в лог с использованием `logger.warning()`.
3.  **Завершение**: Функция завершает свою работу.

### `TinyTool._enforce_ownership`

```python
def _enforce_ownership(self, agent):
    """
    Args:
        agent: Агент, пытающийся использовать инструмент.

    Raises:
        ValueError: Если агент не является владельцем инструмента.
    """
    ...
```

**Назначение**: Проверяет, имеет ли агент право на использование инструмента.

**Параметры**:
- `agent`: Агент, пытающийся использовать инструмент.

**Вызывает исключения**:
- `ValueError`: Если агент не является владельцем инструмента.

**Как работает функция**:

```
A[Проверка наличия владельца инструмента]
|
B[Сравнение имени агента с именем владельца]
|
C[Выброс исключения ValueError, если агент не является владельцем]
|
D[Завершение]
```

1.  **Проверка наличия владельца инструмента**: Функция проверяет, установлен ли владелец инструмента (`self.owner is not None`).
2.  **Сравнение имени агента с именем владельца**: Если владелец установлен, функция сравнивает имя агента (`agent.name`) с именем владельца (`self.owner.name`).
3.  **Выброс исключения ValueError, если агент не является владельцем**: Если имена не совпадают, функция выбрасывает исключение `ValueError` с сообщением об ошибке.
4.  **Завершение**: Функция завершает свою работу.

### `TinyTool.set_owner`

```python
def set_owner(self, owner):
    """
    Args:
        owner: Новый владелец инструмента.
    """
    ...
```

**Назначение**: Устанавливает владельца инструмента.

**Параметры**:
- `owner`: Новый владелец инструмента.

**Как работает функция**:

```
A[Получение нового владельца]
|
B[Установка нового владельца]
|
C[Завершение]
```

1.  **Получение нового владельца**: Функция получает нового владельца инструмента в качестве параметра `owner`.
2.  **Установка нового владельца**: Функция устанавливает атрибут `self.owner` равным переданному значению `owner`.
3.  **Завершение**: Функция завершает свою работу.

### `TinyTool.actions_definitions_prompt`

```python
def actions_definitions_prompt(self) -> str:
    """
    Raises:
        NotImplementedError: Если метод не реализован в подклассе.

    Returns:
        str: Prompt с определениями действий.
    """
    ...
```

**Назначение**: Возвращает prompt с определениями действий, которые может выполнять инструмент.

**Возвращает**:
- `str`: Prompt с определениями действий.

**Вызывает исключения**:
- `NotImplementedError`: Если метод не реализован в подклассе.

**Как работает функция**:

```
A[Вызов метода actions_definitions_prompt]
|
B[Выброс исключения NotImplementedError]
|
C[Завершение (с ошибкой)]
```

1.  **Вызов метода actions_definitions_prompt**: Функция вызывается для получения prompt с определениями действий.
2.  **Выброс исключения NotImplementedError**: Функция выбрасывает исключение `NotImplementedError`, так как метод должен быть реализован в подклассе.
3.  **Завершение (с ошибкой)**: Функция завершает свою работу с ошибкой.

### `TinyTool.actions_constraints_prompt`

```python
def actions_constraints_prompt(self) -> str:
    """
    Raises:
        NotImplementedError: Если метод не реализован в подклассе.

    Returns:
        str: Prompt с ограничениями действий.
    """
    ...
```

**Назначение**: Возвращает prompt с ограничениями на действия, которые может выполнять инструмент.

**Возвращает**:
- `str`: Prompt с ограничениями действий.

**Вызывает исключения**:
- `NotImplementedError`: Если метод не реализован в подклассе.

**Как работает функция**:

```
A[Вызов метода actions_constraints_prompt]
|
B[Выброс исключения NotImplementedError]
|
C[Завершение (с ошибкой)]
```

1.  **Вызов метода actions_constraints_prompt**: Функция вызывается для получения prompt с ограничениями на действия.
2.  **Выброс исключения NotImplementedError**: Функция выбрасывает исключение `NotImplementedError`, так как метод должен быть реализован в подклассе.
3.  **Завершение (с ошибкой)**: Функция завершает свою работу с ошибкой.

### `TinyTool.process_action`

```python
def process_action(self, agent, action: dict) -> bool:
    """
    Args:
        agent: Агент, выполняющий действие.
        action (dict): Словарь, содержащий информацию о действии.

    Returns:
        bool: True, если действие было успешно выполнено, иначе False.
    """
    ...
```

**Назначение**: Выполняет действие инструмента.

**Параметры**:
- `agent`: Агент, выполняющий действие.
- `action` (dict): Словарь, содержащий информацию о действии.

**Возвращает**:
- `bool`: `True`, если действие было успешно выполнено, иначе `False`.

**Как работает функция**:

```
A[Защита от реальных побочных эффектов]
|
B[Проверка права собственности на инструмент]
|
C[Выполнение действия]
|
D[Завершение]
```

1.  **Защита от реальных побочных эффектов**: Функция вызывает метод `_protect_real_world()` для защиты от случайного использования инструментов с реальными побочными эффектами.
2.  **Проверка права собственности на инструмент**: Функция вызывает метод `_enforce_ownership()` для проверки, имеет ли агент право на использование инструмента.
3.  **Выполнение действия**: Функция вызывает метод `_process_action()` для выполнения конкретного действия инструмента.
4.  **Завершение**: Функция завершает свою работу.

### `TinyCalendar.__init__`

```python
def __init__(self, owner=None):
    """
    Args:
        owner: Владелец календаря.
    """
    ...
```

**Назначение**: Инициализирует новый экземпляр `TinyCalendar`.

**Параметры**:
- `owner` (optional): Владелец календаря. По умолчанию `None`.

**Как работает функция**:

```
A[Инициализация TinyCalendar]
|
B[Вызов конструктора родительского класса TinyTool]
|
C[Инициализация календаря как пустого словаря]
|
D[Завершение]
```

1.  **Инициализация TinyCalendar**: Функция инициализирует объект `TinyCalendar` с заданным владельцем.
2.  **Вызов конструктора родительского класса TinyTool**: Функция вызывает конструктор родительского класса `TinyTool` с именем "calendar", описанием "A basic calendar tool that allows agents to keep track meetings and appointments." и владельцем `owner`.
3.  **Инициализация календаря как пустого словаря**: Функция инициализирует атрибут `self.calendar` как пустой словарь.
4.  **Завершение**: Функция завершает свою работу.

### `TinyCalendar.add_event`

```python
def add_event(self, date, title, description=None, owner=None, mandatory_attendees=None, optional_attendees=None, start_time=None, end_time=None):
    """
    Args:
        date: Дата события.
        title: Заголовок события.
        description: Описание события.
        owner: Владелец события.
        mandatory_attendees: Список обязательных участников.
        optional_attendees: Список необязательных участников.
        start_time: Время начала события.
        end_time: Время окончания события.
    """
    ...
```

**Назначение**: Добавляет новое событие в календарь.

**Параметры**:
- `date`: Дата события.
- `title`: Заголовок события.
- `description` (optional): Описание события. По умолчанию `None`.
- `owner` (optional): Владелец события. По умолчанию `None`.
- `mandatory_attendees` (optional): Список обязательных участников. По умолчанию `None`.
- `optional_attendees` (optional): Список необязательных участников. По умолчанию `None`.
- `start_time` (optional): Время начала события. По умолчанию `None`.
- `end_time` (optional): Время окончания события. По умолчанию `None`.

**Как работает функция**:

```
A[Проверка наличия даты в календаре]
|
B[Создание нового списка событий, если даты нет]
|
C[Добавление события в список событий для данной даты]
|
D[Завершение]
```

1.  **Проверка наличия даты в календаре**: Функция проверяет, существует ли уже запись для данной даты в словаре `self.calendar`.
2.  **Создание нового списка событий, если даты нет**: Если даты нет в словаре, функция создает новую запись с этой датой в качестве ключа и пустым списком в качестве значения.
3.  **Добавление события в список событий для данной даты**: Функция добавляет словарь, содержащий информацию о событии (заголовок, описание, владельца, участников, время начала и окончания), в список событий для данной даты.
4.  **Завершение**: Функция завершает свою работу.

### `TinyCalendar.find_events`

```python
def find_events(self, year, month, day, hour=None, minute=None):
    """
    Args:
        year: Год события.
        month: Месяц события.
        day: День события.
        hour: Час события.
        minute: Минута события.
    """
    ...
```

**Назначение**: Находит события в календаре по заданным параметрам.

**Параметры**:
- `year`: Год события.
- `month`: Месяц события.
- `day`: День события.
- `hour` (optional): Час события. По умолчанию `None`.
- `minute` (optional): Минута события. По умолчанию `None`.

**Как работает функция**:

```
A[Поиск событий в календаре]
|
B[Завершение (TODO: реализация поиска)]
```

1.  **Поиск событий в календаре**: Функция должна искать события в календаре на основе предоставленных года, месяца, дня, часа и минуты.
2.  **Завершение (TODO: реализация поиска)**: В текущей версии функции отсутствует реализация поиска, поэтому она просто завершает свою работу.

### `TinyCalendar._process_action`

```python
def _process_action(self, agent, action) -> bool:
    """
    Args:
        agent: Агент, выполняющий действие.
        action: Информация о действии.

    Returns:
        bool: True, если действие выполнено успешно, иначе False.
    """
    ...
```

**Назначение**: Обрабатывает действие агента, связанное с календарем.

**Параметры**:
- `agent`: Агент, выполняющий действие.
- `action`: Информация о действии.

**Возвращает**:
- `bool`: `True`, если действие выполнено успешно, иначе `False`.

**Как работает функция**:

```
A[Проверка типа действия]
|
B[Обработка действия CREATE_EVENT]
|
C[Загрузка содержимого события из JSON]
|
D[Проверка наличия недопустимых ключей в содержимом события]
|
E[Добавление события в календарь]
|
F[Возврат True, если действие обработано успешно]
|
G[Возврат False, если действие не обработано]
```

1.  **Проверка типа действия**: Функция проверяет, является ли тип действия `"CREATE_EVENT"` и не является ли содержимое действия `None`.
2.  **Обработка действия CREATE_EVENT**: Если тип действия `"CREATE_EVENT"`, функция переходит к обработке этого действия.
3.  **Загрузка содержимого события из JSON**: Функция загружает содержимое события из JSON, используя `json.loads()`. Если содержимое уже является словарем, оно не изменяется.
4.  **Проверка наличия недопустимых ключей в содержимом события**: Функция проверяет, содержит ли содержимое события какие-либо недопустимые ключи, используя `utils.check_valid_fields()`.
5.  **Добавление события в календарь**: Функция вызывает метод `self.add_event()` для добавления события в календарь.
6.  **Возврат True, если действие обработано успешно**: Если все шаги выполнены успешно, функция возвращает `True`.
7.  **Возврат False, если действие не обработано**: Если тип действия не `"CREATE_EVENT"` или содержимое действия `None`, функция возвращает `False`.

### `TinyCalendar.actions_definitions_prompt`

```python
def actions_definitions_prompt(self) -> str:
    """
    Returns:
        str: Определения действий в виде prompt.
    """
    ...
```

**Назначение**: Возвращает определения действий, которые может выполнять агент с календарем.

**Возвращает**:
- `str`: Определения действий в виде prompt.

**Как работает функция**:

```
A[Определение prompt]
|
B[Удаление отступов в prompt]
|
C[Возврат prompt]
```

1.  **Определение prompt**: Функция определяет prompt, содержащий определения действий, которые может выполнять агент с календарем. В данном случае определено действие `"CREATE_EVENT"`, которое позволяет агенту создавать новые события в календаре.
2.  **Удаление отступов в prompt**: Функция удаляет отступы в prompt с помощью функции `utils.dedent()`.
3.  **Возврат prompt**: Функция возвращает prompt.

### `TinyCalendar.actions_constraints_prompt`

```python
def actions_constraints_prompt(self) -> str:
    """
    Returns:
        str: Ограничения действий в виде prompt.
    """
    ...
```

**Назначение**: Возвращает ограничения на действия, которые может выполнять агент с календарем.

**Возвращает**:
- `str`: Ограничения действий в виде prompt.

**Как работает функция**:

```
A[Определение prompt]
|
B[Удаление отступов в prompt]
|
C[Возврат prompt]
```

1.  **Определение prompt**: Функция определяет prompt, содержащий ограничения на действия, которые может выполнять агент с календарем. В текущей версии prompt пуст.
2.  **Удаление отступов в prompt**: Функция удаляет отступы в prompt с помощью функции `textwrap.dedent()`.
3.  **Возврат prompt**: Функция возвращает prompt.

### `TinyWordProcessor.__init__`

```python
def __init__(self, owner=None, exporter=None, enricher=None):
    """
    Args:
        owner: Владелец текстового процессора.
        exporter: Экспортер для экспорта документов.
        enricher: Обогатитель для обогащения контента документов.
    """
    ...
```

**Назначение**: Инициализирует новый экземпляр `TinyWordProcessor`.

**Параметры**:
- `owner` (optional): Владелец текстового процессора. По умолчанию `None`.
- `exporter` (optional): Экспортер для экспорта документов. По умолчанию `None`.
- `enricher` (optional): Обогатитель для обогащения контента документов. По умолчанию `None`.

**Как работает функция**:

```
A[Инициализация TinyWordProcessor]
|
B[Вызов конструктора родительского класса TinyTool]
|
C[Завершение]
```

1.  **Инициализация TinyWordProcessor**: Функция инициализирует объект `TinyWordProcessor` с заданными параметрами.
2.  **Вызов конструктора родительского класса TinyTool**: Функция вызывает конструктор родительского класса `TinyTool` с именем "wordprocessor", описанием "A basic word processor tool that allows agents to write documents.", владельцем `owner`, указанием на отсутствие побочных эффектов в реальном мире (`real_world_side_effects=False`), экспортером `exporter` и обогатителем `enricher`.
3.  **Завершение**: Функция завершает свою работу.

### `TinyWordProcessor.write_document`

```python
def write_document(self, title, content, author=None):
    """
    Args:
        title: Заголовок документа.
        content: Содержание документа.
        author: Автор документа.
    """
    ...
```

**Назначение**: Записывает документ с заданным заголовком, контентом и автором.

**Параметры**:
- `title`: Заголовок документа.
- `content`: Содержание документа.
- `author` (optional): Автор документа. По умолчанию `None`.

**Как работает функция**:

```
A[Запись в лог информации о записи документа]
|
B[Проверка наличия обогатителя]
|
C[Обогащение контента документа, если обогатитель присутствует]
|
D[Проверка наличия экспортера]
|
E[Экспорт документа в различных форматах, если экспортер присутствует]
|
F[Завершение]
```

1.  **Запись в лог информации о записи документа**: Функция записывает в лог отладочную информацию о записи документа, включая заголовок и содержание документа, с использованием `logger.debug()`.
2.  **Проверка наличия обогатителя**: Функция проверяет, установлен ли обогатитель (`self.enricher is not None`).
3.  **Обогащение контента документа, если обогатитель присутствует**: Если обогатитель установлен, функция обогащает контент документа, вызывая метод `self.enricher.enrich_content()`.
4.  **Проверка наличия экспортера**: Функция проверяет, установлен ли экспортер (`self.exporter is not None`).
5.  **Экспорт документа в различных форматах, если экспортер присутствует**: Если экспортер установлен, функция экспортирует документ в различных форматах (md, docx, json), вызывая метод `self.exporter.export()`.
6.  **Завершение**: Функция завершает свою работу.

### `TinyWordProcessor._process_action`

```python
def _process_action(self, agent, action) -> bool:
    """
    Args:
        agent: Агент, выполняющий действие.
        action: Информация о действии.

    Returns:
        bool: True, если действие выполнено успешно, иначе False.
    """
    ...
```

**Назначение**: Обрабатывает действие агента, связанное с текстовым процессором.

**Параметры**:
- `agent`: Агент, выполняющий действие.
- `action`: Информация о действии.

**Возвращает**:
- `bool`: `True`, если действие выполнено успешно, иначе `False`.

**Как работает функция**:

```
A[Обработка исключений]
|
B[Проверка типа действия]
|
C[Обработка действия WRITE_DOCUMENT]
|
D[Разбор содержимого документа из JSON]
|
E[Проверка наличия недопустимых ключей в содержимом документа]
|
F[Запись документа]
|
G[Логирование ошибки при разборе JSON]
|
H[Возврат результата]
```

1.  **Обработка исключений**: Функция оборачивает основной код в блок `try...except`, чтобы обрабатывать возможные ошибки, возникающие при разборе JSON.
2.  **Проверка типа действия**: Функция проверяет, является ли тип действия `"WRITE_DOCUMENT"` и не является ли содержимое действия `None`.
3.  **Обработка действия WRITE_DOCUMENT**: Если тип действия `"WRITE_DOCUMENT"`, функция переходит к обработке этого действия.
4.  **Разбор содержимого документа из JSON**: Функция разбирает содержимое документа из JSON, используя `json.loads()`. Если содержимое уже является словарем, оно не изменяется.
5.  **Проверка наличия недопустимых ключей в содержимом документа**: Функция проверяет, содержит ли содержимое документа какие-либо недопустимые ключи, используя `utils.check_valid_fields()`.
6.  **Запись документа**: Функция вызывает метод `self.write_document()` для записи документа.
7.  **Логирование ошибки при разборе JSON**: Если при разборе JSON возникает ошибка `json.JSONDecodeError`, функция записывает сообщение об ошибке в лог с использованием `logger.error()`.
8.  **Возврат результата**: Функция возвращает `True`, если действие обработано успешно, и `False` в противном случае.

### `TinyWordProcessor.actions_definitions_prompt`

```python
def actions_definitions_prompt(self) -> str:
    """
    Returns:
        str: Определения действий в виде prompt.
    """
    ...
```

**Назначение**: Возвращает определения действий, которые может выполнять агент с текстовым процессором.

**Возвращает**:
- `str`: Определения действий в виде prompt.

**Как работает функция**:

```
A[Определение prompt]
|
B[Удаление отступов в prompt]
|
C[Возврат prompt]
```

1.  **Определение prompt**: Функция определяет prompt, содержащий определения действий, которые может выполнять агент с текстовым процессором. В данном случае определено действие `"WRITE_DOCUMENT"`, которое позволяет агенту создавать новые документы.
2.  **Удаление отступов в prompt**: Функция удаляет отступы в prompt с помощью функции `utils.dedent()`.
3.  **Возврат prompt**: Функция возвращает prompt.

### `TinyWordProcessor.actions_constraints_prompt`

```python
def actions_constraints_prompt(self) -> str:
    """
    Returns:
        str: Ограничения действий в виде prompt.
    """
    ...
```

**Назначение**: Возвращает ограничения на действия, которые может выполнять агент с текстовым процессором.

**Возвращает**:
- `str`: Ограничения действий в виде prompt.

**Как работает функция**:

```
A[Определение prompt]
|
B[Удаление отступов в prompt]
|
C[Возврат prompt]
```

1.  **Определение prompt**: Функция определяет prompt, содержащий ограничения на действия, которые может выполнять агент с текстовым процессором. В данном случае определены ограничения на запись всего контента сразу, на длину и детализацию контента, а также на упоминание конкретных владельцев или партнерских команд.
2.  **Удаление отступов в prompt**: Функция удаляет отступы в prompt с помощью функции `utils.dedent()`.
3.  **Возврат prompt**: Функция возвращает prompt.
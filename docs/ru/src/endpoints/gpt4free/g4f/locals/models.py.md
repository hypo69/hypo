# Модуль для загрузки и форматирования моделей gpt4free
## Обзор

Модуль `models.py` предназначен для загрузки, форматирования и сохранения информации о моделях, используемых в проекте `gpt4free`. Он включает в себя функции для получения списка моделей из внешнего источника, форматирования этих моделей, чтения и сохранения данных моделей в локальный файл. Модуль также определяет местоположение каталога для хранения моделей.

## Подробней

Этот модуль играет важную роль в инициализации и управлении моделями, используемыми в проекте `gpt4free`. Он обеспечивает гибкий способ загрузки моделей как из удаленного источника, так и из локального файла, что позволяет адаптировать использование моделей в зависимости от доступности сети и других факторов.

## Функции

### `load_models`

```python
def load_models() -> dict:
    """
    Загружает модели с удаленного URL.

    Returns:
        dict: Форматированный словарь моделей.
    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с ошибкой.

    Как работает функция:
     1. Отправляет GET-запрос на URL "https://gpt4all.io/models/models3.json".
     2. Вызывает `raise_for_status(response)` для проверки статуса ответа и вызывает исключение, если статус указывает на ошибку.
     3. Преобразует JSON-ответ в словарь Python.
     4. Вызывает `format_models` для форматирования моделей и возвращает результат.

    Пример:
        >>> models = load_models()
        >>> print(models.keys())
        dict_keys(['model1', 'model2', ...])
    """
```

**Как работает функция**:

```
A: Отправка GET запроса
|
B: Проверка статуса ответа
|
C: Преобразование JSON ответа в словарь Python
|
D: Форматирование моделей
|
E: Возврат результата
```

### `get_model_name`

```python
def get_model_name(filename: str) -> str:
    """
    Извлекает имя модели из имени файла.

    Args:
        filename (str): Имя файла модели.

    Returns:
        str: Очищенное имя модели.

    Как работает функция:
     1. Разделяет имя файла по первой точке, чтобы отделить имя от расширения.
     2. Удаляет определенные подстроки, такие как "-v1_5", "-v1", "-q4_0", "_v01", "-v0", "-f16", "-gguf2", "-newbpe", чтобы получить чистое имя модели.

    Пример:
        >>> get_model_name('model-v1_5.bin')
        'model'
    """
```

**Как работает функция**:

```
A: Разделение имени файла по точке
|
B: Удаление подстрок из имени
|
C: Возврат очищенного имени модели
```

### `format_models`

```python
def format_models(models: list) -> dict:
    """
    Форматирует список моделей в словарь.

    Args:
        models (list): Список моделей.

    Returns:
        dict: Отформатированный словарь моделей.

    Как работает функция:
     1. Проходит по списку моделей.
     2. Для каждой модели извлекает имя файла, путь, требуемый объем RAM и шаблон запроса.
     3. Создает словарь, где ключом является имя модели, а значением - словарь с информацией о модели.

    Пример:
        >>> models = [{'filename': 'model-v1.bin', 'ramrequired': '4GB', 'promptTemplate': 'template'}]
        >>> format_models(models)
        {'model': {'path': 'model-v1.bin', 'ram': '4GB', 'prompt': 'template', 'system': None}}
    """
```

**Как работает функция**:

```
A: Проход по списку моделей
|
B: Извлечение информации о модели
|
C: Создание словаря с информацией о модели
|
D: Возврат словаря моделей
```

### `read_models`

```python
def read_models(file_path: str) -> dict:
    """
    Читает модели из файла JSON.

    Args:
        file_path (str): Путь к файлу.

    Returns:
        dict: Словарь моделей.

    Как работает функция:
     1. Открывает файл по указанному пути в режиме чтения байтов ("rb").
     2. Загружает JSON-данные из файла и возвращает их в виде словаря.

    Пример:
        >>> read_models('models.json')
        {'model1': {'path': 'model1.bin', 'ram': '4GB'}, 'model2': {'path': 'model2.bin', 'ram': '8GB'}}
    """
```

**Как работает функция**:

```
A: Открытие файла
|
B: Загрузка JSON из файла
|
C: Возврат словаря моделей
```

### `save_models`

```python
def save_models(file_path: str, data: dict) -> None:
    """
    Сохраняет данные моделей в файл JSON.

    Args:
        file_path (str): Путь к файлу.
        data (dict): Данные для сохранения.

    Как работает функция:
     1. Открывает файл по указанному пути в режиме записи ('w').
     2. Записывает данные в файл в формате JSON с отступами для читаемости.

    Пример:
        >>> data = {'model1': {'path': 'model1.bin', 'ram': '4GB'}}
        >>> save_models('models.json', data)
    """
```

**Как работает функция**:

```
A: Открытие файла для записи
|
B: Запись данных в файл в формате JSON
```

### `get_model_dir`

```python
def get_model_dir() -> str:
    """
    Определяет и возвращает путь к каталогу моделей.

    Returns:
        str: Путь к каталогу моделей.

    Как работает функция:
     1. Получает путь к текущему файлу.
     2. Получает путь к родительскому каталогу (project_dir).
     3. Создает путь к каталогу моделей (model_dir) в project_dir.
     4. Если каталог моделей не существует, создает его.
     5. Возвращает путь к каталогу моделей.

    Пример:
        >>> get_model_dir()
        '/path/to/project/models'
    """
```

**Как работает функция**:

```
A: Получение пути к текущему файлу
|
B: Получение пути к родительскому каталогу
|
C: Создание пути к каталогу моделей
|
D: Проверка существования каталога моделей
|
E: Создание каталога моделей (если не существует)
|
F: Возврат пути к каталогу моделей
```

### `get_models`

```python
def get_models() -> dict[str, dict]:
    """
    Получает модели из файла или загружает, если файла нет.

    Returns:
        dict[str, dict]: Словарь моделей.

    Как работает функция:
     1. Получает путь к каталогу моделей с помощью `get_model_dir()`.
     2. Формирует путь к файлу "models.json" в каталоге моделей.
     3. Проверяет, существует ли файл "models.json".
     4. Если файл существует, читает модели из файла с помощью `read_models()`.
     5. Если файл не существует, загружает модели с помощью `load_models()`, сохраняет их в файл с помощью `save_models()`.
     6. Возвращает словарь моделей.

    Пример:
        >>> get_models()
        {'model1': {'path': 'model1.bin', 'ram': '4GB'}, 'model2': {'path': 'model2.bin', 'ram': '8GB'}}
    """
```

**Как работает функция**:

```
A: Получение пути к каталогу моделей
|
B: Формирование пути к файлу "models.json"
|
C: Проверка существования файла
|
D: Чтение моделей из файла (если существует)
|
E: Загрузка моделей и сохранение в файл (если не существует)
|
F: Возврат словаря моделей
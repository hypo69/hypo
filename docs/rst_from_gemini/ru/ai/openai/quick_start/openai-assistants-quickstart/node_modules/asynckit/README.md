# asynckit

[![NPM Module](https://img.shields.io/npm/v/asynckit.svg?style=flat)](https://www.npmjs.com/package/asynckit)

Утилита для работы с асинхронными задачами, поддерживающая потоки.

[![PhantomJS Build](https://img.shields.io/travis/alexindigo/asynckit/v0.4.0.svg?label=browser&style=flat)](https://travis-ci.org/alexindigo/asynckit)
[![Linux Build](https://img.shields.io/travis/alexindigo/asynckit/v0.4.0.svg?label=linux:0.12-6.x&style=flat)](https://travis-ci.org/alexindigo/asynckit)
[![Windows Build](https://img.shields.io/appveyor/ci/alexindigo/asynckit/v0.4.0.svg?label=windows:0.12-6.x&style=flat)](https://ci.appveyor.com/project/alexindigo/asynckit)

[![Coverage Status](https://img.shields.io/coveralls/alexindigo/asynckit/v0.4.0.svg?label=code+coverage&style=flat)](https://coveralls.io/github/alexindigo/asynckit?branch=master)
[![Dependency Status](https://img.shields.io/david/alexindigo/asynckit/v0.4.0.svg?style=flat)](https://david-dm.org/alexindigo/asynckit)
[![bitHound Overall Score](https://www.bithound.io/github/alexindigo/asynckit/badges/score.svg)](https://www.bithound.io/github/alexindigo/asynckit)

<!-- [![Readme](https://img.shields.io/badge/readme-tested-brightgreen.svg?style=flat)](https://www.npmjs.com/package/reamde) -->

Библиотека `AsyncKit` предоставляет инструменты для параллельного и последовательного выполнения задач над списками элементов (массивами или объектами).
По желанию, она принимает функцию прерывания (должна быть возвращена итератором синхронно для каждого элемента), и завершает оставшиеся задачи при возникновении ошибки. Поддерживаются встроенные порядки итерации (`ascending` и `descending`), а также пользовательские функции сортировки через метод `asynckit.serialOrdered`.

Она гарантирует асинхронную обработку, чтобы сделать поведение более стабильным и предотвратить ошибки `Превышен максимальный размер стека вызовов` при синхронных итерациях.

| Сжатие        | Размер |
| :-------------- | :---- |
| asynckit.js     | 12.34 КБ |
| asynckit.min.js | 4.11 КБ |
| asynckit.min.js.gz | 1.47 КБ |


## Установка

```bash
$ npm install --save asynckit
```

## Примеры

### Параллельные задачи

Выполняет итератор над предоставленным массивом параллельно. Сохраняет результаты в массиве `result`
на соответствующих позициях. В случае ошибки одной из задач,
прерывает оставшиеся активные задачи (если задана функция прерывания)
и возвращает ошибку вместе со спасёнными данными в главную функцию обратного вызова.

#### Входной массив

```javascript
const parallel = require('asynckit').parallel;
const assert = require('assert');

const source = [1, 1, 4, 16, 64, 32, 8, 2];
const expectedResult = [2, 2, 8, 32, 128, 64, 16, 4];
const expectedTarget = [1, 1, 2, 4, 8, 16, 32, 64];
const target = [];

parallel(source, asyncJob, (err, result) => {
  assert.deepEqual(result, expectedResult);
  assert.deepEqual(target, expectedTarget);
});

function asyncJob(item, cb) {
  const delay = item * 25;
  const timeoutId = setTimeout(() => {
    target.push(item);
    cb(null, item * 2);
  }, delay);
  return clearTimeout.bind(null, timeoutId);
}
```

Дополнительные примеры можно найти в `test/test-parallel-array.js`.

#### Входной объект

Также поддерживаются задачи с именами, перечисленные через объект.

```javascript
// ... (аналогично предыдущему примеру, но с объектом)
```

Дополнительные примеры можно найти в `test/test-parallel-object.js`.

### Последовательные задачи

Выполняет итератор над предоставленным массивом последовательно. Сохраняет результаты в массиве `result`
на соответствующих позициях. В случае ошибки одной из задач,
перестаёт выполнять оставшиеся элементы в списке
и возвращает ошибку вместе со спасёнными данными в главную функцию обратного вызова.

#### Входной массив

```javascript
// ... (аналогично предыдущему примеру, но с serial)
```

Дополнительные примеры можно найти в `test/test-serial-array.js` и `test/test-serial-object.js`.

**Важно:** В случае с объектами порядок элементов не гарантирован, поэтому `serial` может дать непредсказуемые результаты.  Используйте `serialOrdered` для гарантированного порядка.

### Последовательные итерации с упорядочением

Подробно описано позже.  

### Потоковый интерфейс

Подробно описано позже.


## Хотите узнать больше?

Дополнительные примеры можно найти в папке `test`.  Или задавайте вопросы и предлагайте идеи в [issue](https://github.com/alexindigo/asynckit/issues).

## Лицензия

AsyncKit лицензируется по лицензии MIT.

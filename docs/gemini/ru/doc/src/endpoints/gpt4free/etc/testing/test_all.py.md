# Модуль тестирования моделей gpt4free

## Обзор

Модуль предназначен для тестирования работоспособности различных моделей, предоставляемых библиотекой `gpt4free`. Он использует асинхронные вызовы для проверки возможности генерации текста каждой моделью и выводит список работающих моделей.

## Подробнее

Данный код является тестовым скриптом, который проверяет, могут ли различные модели из библиотеки `g4f` успешно генерировать текст. В частности, он отправляет запрос на создание стихотворения о дереве и проверяет, возвращается ли ответ. Это позволяет убедиться, что интеграция с каждой конкретной моделью работает корректно.

## Функции

### `test`

```python
async def test(model: g4f.Model) -> bool:
    """
    Асинхронно тестирует заданную модель, отправляя запрос на генерацию текста и проверяя ответ.

    Args:
        model (g4f.Model): Модель для тестирования.

    Returns:
        bool: `True`, если модель работает и успешно генерирует текст, `False` в противном случае.
        

    Raises:
        Exception: Если во время выполнения запроса происходит ошибка.
    
   **Как работает функция**:

   1. **Попытка асинхронного создания чата (первый try)**:
      - Функция пытается выполнить асинхронное создание чата с использованием предоставленной модели.
      - Отправляет запрос на создание стихотворения о дереве, устанавливая температуру 0.1 и включает потоковую передачу данных.
      - Выводит каждый полученный ответ.

   2. **Обработка исключения (первый except)**:
      - Если при первом асинхронном создании чата возникает исключение, функция переходит ко второй попытке.
      - Использует `await` для асинхронного создания чата и вывода ответа.

   3. **Возврат результата**:
      - Если обе попытки выполнения запроса завершаются успешно, функция возвращает `True`, указывая на то, что модель работает.

   4. **Обработка общего исключения (второй except)**:
      - Если во время выполнения запроса возникает какое-либо исключение, функция переходит к обработке общего исключения.
      - Выводит сообщение об ошибке, содержащее имя модели и информацию об исключении.
      - Возвращает `False`, указывая на то, что модель не работает.

   **ASCII flowchart**:
   ```
   Начало
   │
   ├──→  Попытка асинхронного создания чата (try)
   │   │
   │   └──→ Успешно: Вывод ответа и возврат True
   │   │
   │   └──→ Ошибка:  Обработка исключения и попытка async await (except)
   │       │
   │       └──→ Успешно: Вывод ответа и возврат True
   │       │
   │       └──→ Ошибка: Вывод сообщения об ошибке и возврат False
   │
   └──→ Конец
   ```

    Example:
        >>> import g4f
        >>> import asyncio
        >>> async def test_model():
        ...     model = g4f.models.gpt_35_turbo
        ...     result = await test(model)
        ...     print(f"Model {model.name} working: {result}")
        >>> asyncio.run(test_model())
        Model gpt-3.5-turbo working: True
    """
    try:
        try:
            for response in g4f.ChatCompletion.create(
                    model=model,
                    messages=[{"role": "user", "content": "write a poem about a tree"}],
                    temperature=0.1,
                    stream=True
            ):
                print(response, end="")

            print()
        except:
            for response in await g4f.ChatCompletion.create_async(
                    model=model,
                    messages=[{"role": "user", "content": "write a poem about a tree"}],
                    temperature=0.1,
                    stream=True
            ):
                print(response, end="")

            print()

        return True
    except Exception as e:
        print(model.name, "not working:", e)
        print(e.__traceback__.tb_next)
        return False
```

### `start_test`

```python
async def start_test() -> None:
    """
    Запускает тестирование предопределенного списка моделей и выводит список работающих моделей.

    Returns:
        None
    
    **Как работает функция**:

    1. **Инициализация списка моделей для тестирования**:
       - Создается список `models_to_test`, содержащий экземпляры моделей для тестирования, включая `gpt-3.5-turbo` и `gpt-4`.

    2. **Инициализация списка работающих моделей**:
       - Создается пустой список `models_working`, в который будут добавляться имена моделей, успешно прошедших тестирование.

    3. **Итерация по списку моделей для тестирования**:
       - Функция проходит по каждой модели в списке `models_to_test`.
       - Для каждой модели вызывается функция `test`, которая выполняет тестирование модели и возвращает `True`, если модель работает, и `False` в противном случае.
       - Если `test` возвращает `True`, имя модели добавляется в список `models_working`.

    4. **Вывод списка работающих моделей**:
       - После завершения итерации по всем моделям, функция выводит список имен моделей, которые успешно прошли тестирование.

    **ASCII flowchart**:

    ```
    Начало
    │
    ├──→ Инициализация списка моделей для тестирования
    │
    ├──→ Инициализация списка работающих моделей
    │
    ├──→ Итерация по списку моделей для тестирования
    │   │
    │   └──→ Вызов функции test для каждой модели
    │   │
    │   └──→ Если test возвращает True:
    │       │   └──→ Добавление имени модели в список работающих моделей
    │   │
    │   └──→ Продолжение итерации
    │
    └──→ Вывод списка работающих моделей
    │
    Конец
    ```

    Example:
        >>> import asyncio
        >>> async def run_start_test():
        ...     await start_test()
        >>> asyncio.run(run_start_test())
        working models: ['GPT-3.5']
    """
    models_to_test = [
        # GPT-3.5
        g4f.models.gpt_35_turbo,

        # GPT-4
        g4f.models.gpt_4,
    ]

    models_working = []

    for model in models_to_test:
        if await test(model):
            models_working.append(model.name)

    print("working models:", models_working)
```

## Запуск тестов

```python
asyncio.run(start_test())
```

Эта строка запускает асинхронную функцию `start_test`, которая выполняет тестирование моделей и выводит результаты.
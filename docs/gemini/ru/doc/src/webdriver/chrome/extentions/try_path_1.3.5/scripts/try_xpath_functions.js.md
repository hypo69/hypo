# tryxpath.functions

## Обзор

Данный модуль `tryxpath.functions.js` предоставляет набор функций для работы с XPath и CSS-селекторами в контексте веб-страницы. Он включает в себя методы для выполнения запросов, преобразования результатов, управления атрибутами элементов и получения информации об элементах и их структуре.

## Оглавление

- [Обзор](#обзор)
- [Функции](#функции)
    - [`execExpr`](#execExpr)
    - [`resToArr`](#resToArr)
    - [`makeResolver`](#makeResolver)
    - [`isValidDict`](#isValidDict)
    - [`objToMap`](#objToMap)
    - [`isDocOrElem`](#isDocOrElem)
    - [`listToArr`](#listToArr)
    - [`getItemDetail`](#getItemDetail)
    - [`getItemDetails`](#getItemDetails)
    - [`getNodeTypeStr`](#getNodeTypeStr)
    - [`getxpathResultStr`](#getxpathResultStr)
    - [`getxpathResultNum`](#getxpathResultNum)
    - [`isAttrItem`](#isAttrItem)
    - [`isNodeItem`](#isNodeItem)
    - [`isElementItem`](#isElementItem)
    - [`addClassToItem`](#addClassToItem)
    - [`addClassToItems`](#addClassToItems)
    - [`saveItemClass`](#saveItemClass)
    - [`restoreItemClass`](#restoreItemClass)
    - [`saveItemClasses`](#saveItemClasses)
    - [`restoreItemClasses`](#restoreItemClasses)
    - [`setAttrToItem`](#setAttrToItem)
    - [`removeAttrFromItem`](#removeAttrFromItem)
    - [`removeAttrFromItems`](#removeAttrFromItems)
    - [`setIndexToItems`](#setIndexToItems)
    - [`getParentElement`](#getParentElement)
    - [`getAncestorElements`](#getAncestorElements)
    - [`getOwnerDocument`](#getOwnerDocument)
    - [`createHeaderRow`](#createHeaderRow)
    - [`createDetailTableHeader`](#createDetailTableHeader)
    - [`createDetailRow`](#createDetailRow)
    - [`appendDetailRows`](#appendDetailRows)
    - [`updateDetailsTable`](#updateDetailsTable)
    - [`emptyChildNodes`](#emptyChildNodes)
    - [`saveAttrForItem`](#saveAttrForItem)
    - [`saveAttrForItems`](#saveAttrForItems)
    - [`restoreItemAttrs`](#restoreItemAttrs)
    - [`getFrameAncestry`](#getFrameAncestry)
    - [`isNumberArray`](#isNumberArray)
    - [`onError`](#onError)
    - [`isBlankWindow`](#isBlankWindow)
    - [`collectBlankWindows`](#collectBlankWindows)
    - [`findFrameElement`](#findFrameElement)
    - [`findFrameIndex`](#findFrameIndex)
    - [`makeDetailText`](#makeDetailText)

## Функции

### `execExpr`

**Описание**: Выполняет XPath или CSS-селектор на заданном контексте.

**Параметры**:
- `expr` (string): XPath или CSS-селектор для выполнения.
- `method` (string): Метод выполнения запроса (`evaluate`, `querySelector`, `querySelectorAll`).
- `opts` (object, optional): Объект с опциями, такими как `context`, `resolver` и `document`. По умолчанию `{}`.

**Возвращает**:
- `object`: Объект с результатами запроса, включающий массив элементов (`items`), метод выполнения (`method`) и тип результата (`resultType`).

**Вызывает исключения**:
- `Error`: Если контекст не является узлом или атрибутом при использовании `evaluate`, или если контекст не является документом или элементом при использовании `querySelector` или `querySelectorAll`.

### `resToArr`

**Описание**: Преобразует результат XPath в массив элементов.

**Параметры**:
- `res` (object): Результат выполнения XPath запроса.
- `type` (number, optional): Тип результата XPath. Если не указан, то берется из `res.resultType`.

**Возвращает**:
- `array`: Массив элементов, полученных из результата XPath.

**Вызывает исключения**:
- `Error`: Если тип результата `type` является недействительным.

### `makeResolver`

**Описание**: Создает функцию-резолвер для пространства имен XPath.

**Параметры**:
- `obj` (object | string | function): Объект, строка JSON или функция для создания резолвера.

**Возвращает**:
- `function | null`: Функция-резолвер или `null`, если `obj` равен `null`.

**Вызывает исключения**:
- `Error`: Если `obj` является недействительной строкой JSON или если переданный объект не является допустимым словарем.

### `isValidDict`

**Описание**: Проверяет, является ли объект допустимым словарем для резолвера.

**Параметры**:
- `obj` (object): Объект для проверки.

**Возвращает**:
- `boolean`: `true`, если объект является допустимым словарем, иначе `false`.

### `objToMap`

**Описание**: Преобразует объект в `Map`.

**Параметры**:
- `obj` (object): Объект для преобразования.

**Возвращает**:
- `Map`: Объект `Map`, созданный на основе входного объекта.

### `isDocOrElem`

**Описание**: Проверяет, является ли объект документом или элементом.

**Параметры**:
- `obj` (object): Объект для проверки.

**Возвращает**:
- `boolean`: `true`, если объект является документом или элементом, иначе `false`.

### `listToArr`

**Описание**: Преобразует `NodeList` или HTMLCollection в массив элементов.

**Параметры**:
- `list` (NodeList | HTMLCollection): Список узлов для преобразования.

**Возвращает**:
- `array`: Массив элементов, полученных из списка узлов.

### `getItemDetail`

**Описание**: Получает подробную информацию об элементе.

**Параметры**:
- `item` (object): Элемент, для которого нужно получить информацию.

**Возвращает**:
- `object`: Объект с информацией об элементе, включающий тип (`type`), имя (`name`), значение (`value`) и текстовое содержимое (`textContent`).

### `getItemDetails`

**Описание**: Получает подробную информацию о массиве элементов.

**Параметры**:
- `items` (array): Массив элементов, для которых нужно получить информацию.

**Возвращает**:
- `array`: Массив объектов с информацией о каждом элементе.

### `getNodeTypeStr`

**Описание**: Получает строковое представление типа узла.

**Параметры**:
- `nodeType` (number): Числовое значение типа узла.

**Возвращает**:
- `string`: Строковое представление типа узла или "Unknown", если тип неизвестен.

### `getxpathResultStr`

**Описание**: Получает строковое представление типа результата XPath.

**Параметры**:
- `resultType` (number): Числовое значение типа результата XPath.

**Возвращает**:
- `string`: Строковое представление типа результата XPath или "Unknown", если тип неизвестен.

### `getxpathResultNum`

**Описание**: Получает числовое представление типа результата XPath по его строковому значению.

**Параметры**:
- `resultTypeStr` (string): Строковое значение типа результата XPath.

**Возвращает**:
- `number`: Числовое значение типа результата XPath или `NaN`, если тип неизвестен.

### `isAttrItem`

**Описание**: Проверяет, является ли объект атрибутом.

**Параметры**:
- `item` (object): Объект для проверки.

**Возвращает**:
- `boolean`: `true`, если объект является атрибутом, иначе `false`.

### `isNodeItem`

**Описание**: Проверяет, является ли объект узлом.

**Параметры**:
- `item` (object): Объект для проверки.

**Возвращает**:
- `boolean`: `true`, если объект является узлом, иначе `false`.

### `isElementItem`

**Описание**: Проверяет, является ли объект элементом.

**Параметры**:
- `item` (object): Объект для проверки.

**Возвращает**:
- `boolean`: `true`, если объект является элементом, иначе `false`.

### `addClassToItem`

**Описание**: Добавляет класс к элементу.

**Параметры**:
- `clas` (string): Имя класса для добавления.
- `item` (object): Элемент, которому нужно добавить класс.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `addClassToItems`

**Описание**: Добавляет класс к массиву элементов.

**Параметры**:
- `clas` (string): Имя класса для добавления.
- `items` (array): Массив элементов, которым нужно добавить класс.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `saveItemClass`

**Описание**: Сохраняет текущий класс элемента.

**Параметры**:
- `item` (object): Элемент, класс которого нужно сохранить.

**Возвращает**:
- `object | null`: Объект с элементом и его оригинальным классом или `null`, если элемент не является элементом.

### `restoreItemClass`

**Описание**: Восстанавливает оригинальный класс элемента.

**Параметры**:
- `savedClass` (object): Объект с сохраненным классом элемента.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `saveItemClasses`

**Описание**: Сохраняет классы массива элементов.

**Параметры**:
- `items` (array): Массив элементов, классы которых нужно сохранить.

**Возвращает**:
- `array`: Массив объектов с сохраненными классами элементов.

### `restoreItemClasses`

**Описание**: Восстанавливает оригинальные классы массива элементов.

**Параметры**:
- `savedClasses` (array): Массив объектов с сохраненными классами элементов.

**Возвращает**:
 - `undefined`: Функция ничего не возвращает.

### `setAttrToItem`

**Описание**: Устанавливает атрибут элемента.

**Параметры**:
- `name` (string): Имя атрибута.
- `value` (string): Значение атрибута.
- `item` (object): Элемент, которому нужно установить атрибут.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `removeAttrFromItem`

**Описание**: Удаляет атрибут элемента.

**Параметры**:
- `name` (string): Имя атрибута для удаления.
- `item` (object): Элемент, у которого нужно удалить атрибут.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `removeAttrFromItems`

**Описание**: Удаляет атрибут у массива элементов.

**Параметры**:
- `name` (string): Имя атрибута для удаления.
- `items` (array): Массив элементов, у которых нужно удалить атрибут.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `setIndexToItems`

**Описание**: Устанавливает индекс в качестве атрибута для массива элементов.

**Параметры**:
- `name` (string): Имя атрибута для установки.
- `items` (array): Массив элементов, которым нужно установить индекс.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `getParentElement`

**Описание**: Получает родительский элемент узла.

**Параметры**:
- `item` (object): Узел, для которого нужно получить родительский элемент.

**Возвращает**:
- `object | null`: Родительский элемент или `null`, если родительский элемент не найден.

### `getAncestorElements`

**Описание**: Получает массив родительских элементов элемента.

**Параметры**:
- `elem` (object): Элемент, для которого нужно получить массив предков.

**Возвращает**:
- `array`: Массив родительских элементов.

### `getOwnerDocument`

**Описание**: Получает документ-владелец элемента.

**Параметры**:
- `item` (object): Элемент, для которого нужно получить документ-владелец.

**Возвращает**:
- `object | null`: Документ-владелец элемента или `null`, если документ-владелец не найден.

### `createHeaderRow`

**Описание**: Создает строку заголовка таблицы.

**Параметры**:
- `values` (array): Массив значений для ячеек заголовка.
- `opts` (object, optional): Объект с опциями, такими как `document`. По умолчанию `{}`.

**Возвращает**:
- `object`: Строка таблицы `<tr>` с ячейками заголовка `<th>`.

### `createDetailTableHeader`

**Описание**: Создает заголовок таблицы с деталями.

**Параметры**:
- `opts` (object, optional): Объект с опциями, такими как `document`. По умолчанию `{}`.

**Возвращает**:
- `object`: Строка таблицы `<tr>` с заголовками для деталей.

### `createDetailRow`

**Описание**: Создает строку таблицы с деталями элемента.

**Параметры**:
- `index` (number): Индекс элемента.
- `detail` (object): Объект с информацией об элементе.
- `opts` (object, optional): Объект с опциями, такими как `document` и `keys`. По умолчанию `{}`.

**Возвращает**:
- `object`: Строка таблицы `<tr>` с деталями элемента.

### `appendDetailRows`

**Описание**: Добавляет строки с деталями в таблицу порциями.

**Параметры**:
- `parent` (object): Родительский элемент, к которому нужно добавить строки.
- `details` (array): Массив объектов с информацией об элементах.
- `opts` (object, optional): Объект с опциями, такими как `chunkSize`, `begin`, `end`, `createRow` и `detailKeys`. По умолчанию `{}`.

**Возвращает**:
- `Promise<void>`: Промис, который разрешается после добавления всех строк.

### `updateDetailsTable`

**Описание**: Обновляет таблицу с деталями элементов.

**Параметры**:
- `parent` (object): Родительский элемент таблицы.
- `details` (array): Массив объектов с информацией об элементах.
- `opts` (object, optional): Объект с опциями, такими как `chunkSize`, `begin`, `end`, `detailKeys` и `headerValues`. По умолчанию `{}`.

**Возвращает**:
- `Promise<void>`: Промис, который разрешается после обновления таблицы.

### `emptyChildNodes`

**Описание**: Удаляет все дочерние узлы элемента.

**Параметры**:
- `elem` (object): Элемент, дочерние узлы которого нужно удалить.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `saveAttrForItem`

**Описание**: Сохраняет значение атрибута элемента.

**Параметры**:
- `item` (object): Элемент, атрибут которого нужно сохранить.
- `attr` (string): Имя атрибута для сохранения.
- `storage` (Map, optional): Карта для хранения значений. По умолчанию новая `Map()`.
- `overwrite` (boolean, optional):  Флаг, указывающий нужно ли перезаписывать значение. По умолчанию `false`.

**Возвращает**:
- `Map`: Карта со значениями атрибутов.

### `saveAttrForItems`

**Описание**: Сохраняет значения атрибутов для массива элементов.

**Параметры**:
- `items` (array): Массив элементов, атрибуты которых нужно сохранить.
- `attr` (string): Имя атрибута для сохранения.
- `storage` (Map, optional): Карта для хранения значений. По умолчанию новая `Map()`.
- `overwrite` (boolean, optional): Флаг, указывающий нужно ли перезаписывать значение. По умолчанию `false`.

**Возвращает**:
- `Map`: Карта со значениями атрибутов.

### `restoreItemAttrs`

**Описание**: Восстанавливает значения атрибутов элементов из сохраненных значений.

**Параметры**:
- `storage` (Map): Карта со значениями атрибутов.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `getFrameAncestry`

**Описание**: Получает предков-фреймов по массиву индексов.

**Параметры**:
- `inds` (array): Массив индексов фреймов.
- `win` (object, optional): Окно, относительно которого нужно получить предков-фреймов. По умолчанию `window`.

**Возвращает**:
- `array`: Массив элементов фреймов.

**Вызывает исключения**:
- `Error`: Если фрейм по указанному индексу не существует или доступ к нему запрещен.

### `isNumberArray`

**Описание**: Проверяет, является ли массив массивом чисел.

**Параметры**:
- `arr` (array): Массив для проверки.

**Возвращает**:
- `boolean`: `true`, если массив является массивом чисел, иначе `false`.

### `onError`

**Описание**: Обработчик ошибок.

**Параметры**:
- `err` (object): Объект ошибки.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

### `isBlankWindow`

**Описание**: Проверяет, является ли окно пустым.

**Параметры**:
- `win` (object): Окно для проверки.

**Возвращает**:
- `boolean`: `true`, если окно является пустым, иначе `false`.

### `collectBlankWindows`

**Описание**: Собирает все пустые окна-фреймы.

**Параметры**:
- `top` (object): Верхнее окно, от которого нужно начать поиск.

**Возвращает**:
- `array`: Массив пустых окон-фреймов.

### `findFrameElement`

**Описание**: Находит элемент фрейма по окну.

**Параметры**:
- `win` (object): Окно, для которого нужно найти элемент фрейма.
- `parent` (object): Родительский элемент, в котором нужно искать фрейм.

**Возвращает**:
- `object | null`: Элемент фрейма или `null`, если фрейм не найден.

### `findFrameIndex`

**Описание**: Находит индекс фрейма по окну.

**Параметры**:
- `win` (object): Окно, для которого нужно найти индекс фрейма.
- `parent` (object): Родительский элемент, в котором нужно искать фрейм.

**Возвращает**:
- `number`: Индекс фрейма или `-1`, если фрейм не найден.

### `makeDetailText`

**Описание**: Создает текстовую строку из деталей объекта.

**Параметры**:
- `detail` (object): Объект с деталями.
- `keys` (array): Массив ключей, значения которых нужно включить в текст.
- `separator` (string, optional): Разделитель между значениями. По умолчанию ",".
- `replacers` (object, optional): Объект с функциями для преобразования значений. По умолчанию пустой объект.

**Возвращает**:
- `string`: Текстовая строка с деталями объекта.
# Модуль app.py

## Обзор

Данный модуль содержит основной код для обработки вебхуков Telegram, отображения главной страницы сервиса и обработки ответов от Робокассы.

## Оглавление

- [Функции](#Функции)
    - [`handle_webhook`](#handle_webhook)
    - [`home_page`](#home_page)
    - [`robokassa_result`](#robokassa_result)
    - [`robokassa_fail`](#robokassa_fail)

## Функции

### `handle_webhook`

**Описание**: Обрабатывает входящие вебхуки от Telegram.

**Параметры**:
- `request` (web.Request): Объект запроса aiohttp.

**Возвращает**:
- `web.Response`: Ответ с HTTP-статусом 200 в случае успеха, 500 в случае ошибки.

**Вызывает исключения**:
- `Exception`: Логируется любая возникшая ошибка при обработке вебхука.

### `home_page`

**Описание**: Обрабатывает запрос на главную страницу, отображая HTML-страницу с информацией о сервисе.

**Параметры**:
- `request` (web.Request): Объект запроса aiohttp.

**Возвращает**:
- `web.Response`: HTML-ответ с информацией о сервисе и текущим временем.

### `robokassa_result`

**Описание**: Обрабатывает запрос от Робокассы на ResultURL, проверяет подпись и обновляет данные о платеже в базе данных.

**Параметры**:
- `request` (web.Request): Объект запроса aiohttp.

**Возвращает**:
- `web.Response`: Текстовый ответ "OK{inv_id}" в случае успешной проверки, "bad sign" в случае неверной подписи.

### `robokassa_fail`

**Описание**: Обрабатывает запрос от Робокассы в случае неуспешного платежа, логирует неудачу.

**Параметры**:
- `request` (web.Request): Объект запроса aiohttp.

**Возвращает**:
- `web.Response`: HTML-ответ с текстом "Платеж не удался".
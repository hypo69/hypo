# Модуль для работы с провайдером ChatgptDuo
=================================================

Модуль содержит класс `ChatgptDuo`, который используется для взаимодействия с сервисом [chatgptduo.com](https://chatgptduo.com) для получения ответов на основе предоставленных сообщений.

## Обзор

Модуль предоставляет асинхронный интерфейс для взаимодействия с провайдером ChatgptDuo. Он поддерживает модель `gpt-3.5-turbo` и позволяет отправлять запросы через прокси-сервер. Результаты поиска, полученные от провайдера, сохраняются для дальнейшего использования.

## Подробней

Этот код используется для интеграции с сервисом ChatgptDuo, предоставляющим ответы на вопросы на основе модели GPT.
Он позволяет отправлять запросы к сервису, используя предоставленные сообщения и прокси (при необходимости), а также извлекать результаты поиска, связанные с ответом.
Архитектура модуля включает асинхронный класс `ChatgptDuo`, который упрощает взаимодействие с API ChatgptDuo, предоставляя абстракцию над сетевыми запросами и обработкой данных.

## Классы

### `ChatgptDuo`

**Описание**: Класс `ChatgptDuo` представляет собой асинхронный провайдер для взаимодействия с сервисом ChatgptDuo.

**Принцип работы**:
Класс использует асинхронные запросы для отправки сообщений к ChatgptDuo и получения ответов.
Он также извлекает и сохраняет источники, связанные с ответом, для дальнейшего использования.

**Аттрибуты**:
- `url` (str): URL сервиса ChatgptDuo (`https://chatgptduo.com`).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели `gpt-3.5-turbo` (значение `True`).
- `working` (bool): Флаг, указывающий на работоспособность провайдера (значение `False`).
- `_sources` (List[dict]): Список источников, полученных из ответа ChatgptDuo.

**Методы**:
- `create_async`: Асинхронный метод для создания запроса и получения ответа от ChatgptDuo.
- `get_sources`: Метод для получения списка источников, связанных с последним запросом.

## Функции

### `create_async`

```python
@classmethod
async def create_async(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    timeout: int = 120,
    **kwargs
) -> str:
    """
    Асинхронно отправляет запрос к ChatgptDuo и возвращает ответ.

    Args:
        model (str): Модель для использования (например, "gpt-3.5-turbo").
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания ответа в секундах. По умолчанию `120`.
        **kwargs: Дополнительные параметры.

    Returns:
        str: Ответ от ChatgptDuo.

    Raises:
        aiohttp.ClientResponseError: Если возникает HTTP ошибка при запросе.

    """
```

**Назначение**: Метод `create_async` отправляет асинхронный запрос к ChatgptDuo и возвращает полученный ответ.

**Параметры**:
- `cls`: Ссылка на класс `ChatgptDuo`.
- `model` (str): Имя модели для использования.
- `messages` (Messages): Список сообщений, отправляемых в запросе.
- `proxy` (str, optional): URL прокси-сервера (если используется). По умолчанию `None`.
- `timeout` (int, optional): Максимальное время ожидания ответа в секундах. По умолчанию `120`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `str`: Ответ от ChatgptDuo.

**Вызывает исключения**:
- `aiohttp.ClientResponseError`: Возникает, если получен HTTP-ответ с кодом ошибки.

**Как работает функция**:

1.  **Инициализация**: Функция принимает параметры, такие как модель, сообщения, прокси и таймаут, для настройки запроса.
2.  **Создание сессии**: Используется `StreamSession` для создания асинхронной сессии с возможностью использования прокси и указанным таймаутом. Также устанавливается `impersonate="chrome107"` для имитации браузера Chrome 107.
3.  **Формирование данных**: Подготавливаются данные для отправки, включая форматированный промпт из сообщений.
4.  **Отправка запроса**: Отправляется POST-запрос к сервису ChatgptDuo с использованием созданной сессии и подготовленных данных.
5.  **Обработка ответа**: После получения ответа проверяется его статус на наличие ошибок.
6.  **Извлечение данных**: Из JSON-ответа извлекаются ответ и результаты поиска, которые сохраняются в атрибуте `_sources` класса.
7.  **Возврат ответа**: Функция возвращает извлеченный ответ.

**ASCII Flowchart**:

```
A [Начало]
|
B [Создание асинхронной сессии с прокси и таймаутом]
|
C [Форматирование промпта из сообщений]
|
D [Подготовка данных для запроса]
|
E [Отправка POST-запроса к ChatgptDuo]
|
F [Проверка статуса ответа]
|
G [Извлечение ответа и результатов поиска]
|
H [Сохранение результатов поиска в _sources]
|
I [Возврат ответа]
|
J [Конец]
```

**Примеры**:

```python
# Пример вызова функции create_async
messages = [{"role": "user", "content": "Hello, how are you?"}]
# result = await ChatgptDuo.create_async(model="gpt-3.5-turbo", messages=messages, timeout=60)
# print(result)
```

### `get_sources`

```python
    @classmethod
    def get_sources(cls):
        """
        Возвращает список источников, связанных с последним запросом.

        Returns:
            list[dict]: Список словарей, содержащих информацию об источниках.
        """
```

**Назначение**: Метод `get_sources` возвращает список источников, связанных с последним запросом к ChatgptDuo.

**Параметры**:
- `cls`: Ссылка на класс `ChatgptDuo`.

**Возвращает**:
- `list[dict]`: Список словарей, содержащих информацию об источниках. Каждый словарь содержит ключи "title", "url" и "snippet".

**Как работает функция**:

1.  **Возврат источников**: Функция возвращает значение атрибута `_sources`, который содержит список словарей с информацией об источниках, полученных при последнем запросе.

**ASCII Flowchart**:

```
A [Начало]
|
B [Возврат _sources]
|
C [Конец]
```

**Примеры**:

```python
# Пример вызова функции get_sources
# sources = ChatgptDuo.get_sources()
# print(sources)
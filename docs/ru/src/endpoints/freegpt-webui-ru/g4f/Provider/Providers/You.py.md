# Модуль для взаимодействия с You.com

## Обзор

Модуль предоставляет функциональность для взаимодействия с сервисом You.com, используя subprocess для запуска скрипта `you.py`, расположенного в поддиректории `helpers`. Он позволяет отправлять сообщения и получать ответы, поддерживая потоковую передачу данных.

## Подробней

Этот модуль предназначен для интеграции с You.com через вызов внешнего Python-скрипта. Он использует `subprocess` для запуска скрипта `you.py` с передачей конфигурации в формате JSON. Полученные данные передаются обратно в виде потока. Модуль определяет основные параметры, такие как URL, модель и требования к аутентификации.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """
    Создает запрос к You.com через subprocess и возвращает ответ в виде потока.

    Args:
        model (str): Имя модели, используемой для запроса.
        messages (list): Список сообщений для отправки в запросе.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
        **kwargs: Дополнительные аргументы.

    Returns:
        Generator[str, None, None]: Генератор строк, представляющих ответ от You.com.
    
    Примеры:
        _create_completion(model='gpt-3.5-turbo', messages=[{'role': 'user', 'content': 'Hello'}], stream=True)
    """
```

**Назначение**: Функция `_create_completion` отправляет запрос к сервису You.com, используя subprocess для запуска скрипта `you.py`, расположенного в поддиректории `helpers`.

**Параметры**:

- `model` (str): Имя модели, используемой для запроса.
- `messages` (list): Список сообщений для отправки в запросе.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
- `**kwargs`: Дополнительные аргументы, которые могут быть переданы в функцию.

**Возвращает**:

- `Generator[str, None, None]`: Генератор строк, представляющих ответ от You.com.

**Как работает функция**:

1. **Определение пути к скрипту**: Функция определяет абсолютный путь к директории, в которой находится текущий файл (`You.py`).
2. **Преобразование сообщений в JSON**: Список сообщений преобразуется в JSON-строку с использованием `json.dumps`.
3. **Формирование команды для subprocess**: Формируется команда для запуска скрипта `you.py` с использованием `python3`. JSON-строка с сообщениями передается как аргумент командной строки.
4. **Запуск subprocess**: С помощью `subprocess.Popen` запускается процесс `you.py`, перенаправляя стандартный вывод и стандартный поток ошибок в каналы, которые можно читать.
5. **Чтение вывода subprocess**: Функция итерируется по строкам, читаемым из стандартного вывода запущенного процесса. Каждая строка декодируется из байтов в UTF-8 и возвращается как часть генератора.
6. **Потоковая передача данных**: Функция использует `yield` для потоковой передачи данных по мере их поступления из subprocess.

```
Определение пути к скрипту
│
JSON-преобразование сообщений
│
Формирование команды для subprocess
│
Запуск subprocess
│
Чтение вывода subprocess и потоковая передача данных
```

**Примеры**:

1. Вызов функции с минимальным набором параметров:

```python
_create_completion(model='gpt-3.5-turbo', messages=[{'role': 'user', 'content': 'Hello'}], stream=True)
```

2. Вызов функции с дополнительными аргументами:

```python
_create_completion(model='gpt-3.5-turbo', messages=[{'role': 'user', 'content': 'Привет'}], stream=True, timeout=60)
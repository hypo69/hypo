# Документация для модуля FastAPI RPC

## Обзор

Данный модуль предоставляет возможность удаленного управления FastAPI серверами через XML-RPC. Он состоит из двух основных частей: серверной (`fast_api_rpc.py`) и клиентской (`main.py`). Серверная часть отвечает за запуск и управление FastAPI серверами, а клиентская - за предоставление интерфейса для взаимодействия с сервером через командную строку.

## Подробней

`fast_api_rpc.py` предоставляет серверную часть, которая создает XML-RPC сервер для удаленного управления FastAPI серверами. Он позволяет запускать, останавливать, перезапускать и получать информацию о состоянии серверов. Клиентская часть, реализованная в `main.py`, предоставляет интерфейс командной строки для взаимодействия с XML-RPC сервером.

## Основные компоненты

### `fast_api_rpc.py` (серверная часть)

Этот файл содержит два основных класса: `FastApiServer` и `CommandHandler`.

#### Классы

##### `FastApiServer`

**Описание**: Этот класс содержит логику для запуска FastAPI-сервера. Он отвечает за создание и настройку веб-сервера, а также за добавление новых маршрутов.

**Методы**:
   - Описание методов класса.
   - Описание методов класса.

##### `CommandHandler`

**Описание**: Этот класс управляет вызовами функций управления сервером.

**Методы**:
   - `start_server`: Запускает FastAPI сервер на указанном порту и хосте.
   - `stop_server`: Останавливает указанный FastAPI сервер.
   - `stop_all_servers`: Останавливает все запущенные FastAPI серверы.
   - `status_servers`: Возвращает статус всех запущенных FastAPI серверов.
   - `add_new_route`: Добавляет новый маршрут к указанному FastAPI серверу.
   - `shutdown`: Останавливает XML-RPC сервер и завершает работу.

**Параметры**:
   - `rpc_server`: Объект `SimpleXMLRPCServer`, который слушает запросы на порту `9000` (по умолчанию).

**Примеры**
```python
# Пример создания экземпляра CommandHandler
command_handler = CommandHandler()
```

#### Функции

Функции отсутствуют.

### `main.py` (клиентская часть)

Этот файл предоставляет клиентскую часть для взаимодействия с XML-RPC сервером.

#### Классы

Классы отсутствуют.

#### Функции

Функции отсутствуют.

## Взаимодействие между компонентами

1.  **Запуск `fast_api_rpc.py`**:
    -   Создается экземпляр `CommandHandler`.
    -   В конструкторе `CommandHandler` создается XML-RPC сервер, который начинает слушать порт `9000`.
    -   Запускается FastAPI-сервер(ы) в соответствии с кодом.
2.  **Запуск `main.py`**:
    -   Создается экземпляр `ServerProxy`, который подключается к XML-RPC серверу по адресу `http://localhost:9000`.
    -   `main.py` начинает показывать меню и ожидать ввода пользователя.
3.  **Ввод команды**:
    -   `main.py` анализирует строку, выделяет команду и её аргументы.
    -   `main.py` вызывает соответствующий метод RPC-сервера через объект `rpc_client`.
4.  **Обработка запроса на сервере**:
    -   XML-RPC клиент `rpc_client` создает XML-сообщение, которое отправляет на сервер `fast_api_rpc.py`.
    -   XML-RPC сервер в `fast_api_rpc.py` получает этот запрос.
    -   Вызывается соответствующий метод `CommandHandler`.
5.  **Возврат ответа**:
    -   XML-RPC сервер формирует ответ, содержащий результат вызова.
    -   Этот ответ отправляется обратно клиенту `main.py`.
6.  **Отображение результата**:
    -   `main.py` отображает результат в консоль.
7.  **Повторение цикла**:
    -   `main.py` возвращается к началу цикла, отображая меню и ожидая ввода следующей команды.

## Преимущества данного подхода

*   **Управление сервером из другой программы:** Мы можем контролировать запущенный сервер через другой процесс или даже с другой машины.
*   **Разделение кода:** Логика управления сервером и пользовательский интерфейс разделены, что делает код более модульным и легким в обслуживании.
*   **Гибкость:** Мы можем добавить новые методы управления сервером, просто добавив их в `CommandHandler`, и они автоматически станут доступны через RPC.
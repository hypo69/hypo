# Документация для модуля `code_assistant`

## Обзор

Данный модуль содержит инструкции для обработки и документирования Python-кода в формате Markdown. Инструкции включают требования к форматированию документации, структуре, содержанию, а также правила обработки кода, включая использование кавычек, сохранение комментариев, работу с JSON и логирование.

## Оглавление

- [Формат документации](#формат-документации)
- [Содержание (TOC)](#содержание-toc)
- [Форматирование документации](#форматирование-документации)
- [Заголовки разделов](#заголовки-разделов)
- [Пример файла](#пример-файла)
- [Инструкция: Обработка кода и документации](#инструкция-обработка-кода-и-документации)
- [Основные требования](#основные-требования)
- [Структура ответа](#структура-ответа)

## Формат документации

- Используйте стандарт `Markdown (.md)`.
- Каждый файл должен начинаться с заголовка и краткого описания его содержимого.
- Для всех классов и функций используйте следующий формат комментариев:
  ```python
  def function(param: str, param1: Optional[str | dict | str] = None) -> dict | None:
      """
      Args:
          param (str): Описание параметра `param`.
          param1 (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

      Returns:
          dict | None: Описание возвращаемого значения. Возвращает словарь или `None`.

      Raises:
          SomeError: Описание ситуации, в которой возникает исключение `SomeError`.
      """
  ```
- Используйте `ex` вместо `e` в блоках обработки исключений.

## Содержание (TOC)

- В начале каждого файла документации добавьте раздел с оглавлением.
- Структура оглавления должна включать ссылки на все основные разделы документации модуля.

## Форматирование документации

- Используйте правильный синтаксис Markdown для всех заголовков, списков и ссылок.
- Для документирования классов, функций и методов включайте структурированные разделы с описаниями, деталями параметров, возвращаемых значений и вызываемых исключений. Пример:
  ```markdown
  ## Функции

  ### `function_name`

  **Описание**: Краткое описание функции.

  **Параметры**:
  - `param` (str): Описание параметра `param`.
  - `param1` (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

  **Возвращает**:
  - `dict | None`: Описание возвращаемого значения.

  **Вызывает исключения**:
  - `SomeError`: Описание ситуации, в которой возникает исключение `SomeError`.
  ```

## Заголовки разделов

- Используйте заголовки первого уровня (`#`), второго уровня (`##`), третьего уровня (`###`) и четвёртого уровня (`####`) последовательно на протяжении всего файла.

## Пример файла

```markdown
# Название модуля

## Обзор

Краткое описание назначения модуля.

## Классы

### `ClassName`

**Описание**: Краткое описание класса.

**Методы**:
- `method_name`: Краткое описание метода.
- `method_name`: Краткое описание метода.
**Параметры**:
- `param` (str): Описание параметра `param`.
- `param1` (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.


## Функции

### `function_name`

**Описание**: Краткое описание функции.

**Методы**:
- `method_name`: Краткое описание метода.
- `method_name`: Краткое описание метода.

**Параметры**:
- `param` (str): Описание параметра `param`.
- `param1` (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

**Возвращает**:
- `dict | None`: Описание возвращаемого значения.

**Вызывает исключения**:
- `SomeError`: Описание ситуации, в которой возникает исключение `SomeError`.
```

## Инструкция: Обработка кода и документации

### Основные требования:

1. **Формат документации**:
    - Всегда используйте одинарные кавычки (`'`) в Python-коде. Например:
      ```python
      a = 'A1'
      b = ['a', 'b']
      c = {'key': 'value'}
      ```
    - Двойные кавычки (`"`) используйте только для операций вывода:
      ```python
      print("Hello, world!")
      input("Введите имя: ")
      logger.error("Ошибка")
      ```

2. **Сохранение комментариев**:
    - Все существующие комментарии после `#` должны оставаться неизменными.
    - В случае изменений кода, добавляйте построчные комментарии с использованием символа `#`.

3. **Обработка данных**:
    - Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load`.
    - Сохраняйте любые `...` в коде как маркеры без изменений.
    - Импортируйте `logger` только из `src.logger`:
      ```python
      from src.logger import logger
      ```

4. **Анализ структуры**:
    - Проверьте наличие всех необходимых импортов.
    - Выравнивайте названия функций, переменных и импортов в соответствии с ранее обработанными файлами.

5. **Рефакторинг и улучшения**:
    - Добавляйте комментарии в формате **RST** для всех функций, методов и классов.
    - Используйте `from src.logger.logger import logger` для логирования ошибок.
    - Избегайте чрезмерного использования стандартных блоков `try-except`, отдавая предпочтение обработке ошибок через `logger.error`.

6. **Примеры RST-документации**:

   **Пример модуля**:
    ```python
    """
    Модуль для работы с ассистентом программиста
    =================================================

    Модуль содержит класс :class:`CodeAssistant`, который используется для взаимодействия с различными AI-моделями
    (например, Google Gemini и OpenAI) и выполнения задач обработки кода.

    Пример использования
    ----------------------
    .. code-block:: python

        assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
        assistant.process_files()
    """
    ```

    **Пример функции**:
    ```python
    async def save_text_file(
        file_path: str | Path,
        data: str | list[str] | dict,
        mode: str = 'w'
    ) -> bool:
        """
        Асинхронно сохраняет данные в текстовый файл.

        :param file_path: Путь к файлу для сохранения.
        :type file_path: str | Path
        :param data: Данные для записи.
        :type data: str | list[str] | dict
        :param mode: Режим записи ('w' для записи, 'a' для добавления).
        :type mode: str, optional
        :return: True, если файл успешно сохранён, иначе False.
        :rtype: bool
        :raises Exception: В случае ошибки при записи в файл.

        Пример:
            >>> from pathlib import Path
            >>> file_path = Path('example.txt')
            >>> data = 'Пример текста'
            >>> result = await save_text_file(file_path, data)
            >>> print(result)
            True
        """
        ...
    ```

7. **Финальный код**:
    - Полный (оригинальный и улучшенный) код должен быть представлен в одном блоке.
    - Все изменённые участки кода должны быть снабжены построчными комментариями.

8. **Рекомендации по улучшению**:
    - Следуйте стандартам PEP8 для форматирования.
    - Избегайте неясных формулировок в комментариях, таких как "получаем" или "делаем". Вместо этого используйте более точные описания: "проверяем", "отправляем", "выполняем".

### Структура ответа:

1. **Заголовок**:
    - Анализ кода модуля `<module_name>`

2. **Качество кода**:
    - **Соответствие стандартам**: Оценка от 1 до 10
    - **Плюсы**:
      - <Положительные стороны кода>
    - **Минусы**:
      - <Отрицательные стороны кода>

3. **Рекомендации по улучшению**:
    - <Подробные советы и описания необходимых изменений>

4. **Оптимизированный код**:
    - Полностью переработанный код, снабжённый комментариями в формате RST.
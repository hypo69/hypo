# Модуль для работы с виджетами редактора кампаний AliExpress в Jupyter Notebook
==========================================================================

Модуль `ali_campaign_editor_jupyter_widgets.py` предоставляет класс `JupyterCampaignEditorWidgets`, который включает в себя набор виджетов для управления кампаниями AliExpress непосредственно в Jupyter Notebook.
Этот модуль позволяет выбирать кампании, категории и языки, а также выполнять действия, такие как инициализация редактора, сохранение кампаний и отображение продуктов.

## Обзор

Модуль содержит класс `JupyterCampaignEditorWidgets`, предназначенный для упрощения взаимодействия с кампаниями AliExpress через интерфейс Jupyter Notebook.
Он предоставляет набор виджетов для выбора и управления кампаниями, категориями и языками, а также для выполнения различных действий, таких как инициализация редактора кампаний, сохранение кампаний и отображение продуктов.

## Подробнее

Этот модуль предоставляет удобный интерфейс для управления кампаниями AliExpress непосредственно в Jupyter Notebook. Он включает в себя виджеты для выбора кампаний, категорий и языков, а также кнопки для выполнения различных действий, таких как инициализация редактора кампаний, сохранение кампаний и отображение продуктов.

## Классы

### `JupyterCampaignEditorWidgets`

**Описание**: Класс `JupyterCampaignEditorWidgets` предоставляет виджеты для взаимодействия с редактором кампаний AliExpress.

**Принцип работы**:
Класс инициализирует виджеты, такие как выпадающие списки для выбора кампании, категории и языка, а также кнопки для выполнения действий, таких как инициализация редактора, сохранение кампании, отображение продуктов и открытие Google Sheets.
Он также устанавливает обратные вызовы для обработки изменений в виджетах и выполняет соответствующие действия.

**Атрибуты**:
- `language` (str): Выбранный язык кампании.
- `currency` (str): Выбранная валюта кампании.
- `campaign_name` (str): Выбранное имя кампании.
- `category_name` (str): Выбранное имя категории.
- `category` (SimpleNamespace): Выбранная категория кампании.
- `campaign_editor` (AliCampaignEditor): Экземпляр редактора кампаний AliExpress.
- `products` (list[SimpleNamespace]): Список товаров в выбранной категории.

**Методы**:
- `__init__`: Инициализирует виджеты и настраивает редактор кампаний.
- `initialize_campaign_editor`: Инициализирует редактор кампаний на основе выбранной кампании и категории.
- `update_category_dropdown`: Обновляет выпадающий список категорий на основе выбранной кампании.
- `on_campaign_name_change`: Обрабатывает изменения в выпадающем списке имен кампаний.
- `on_category_change`: Обрабатывает изменения в выпадающем списке категорий.
- `on_language_change`: Обрабатывает изменения в выпадающем списке языков.
- `save_campaign`: Сохраняет кампанию и ее категории.
- `show_products`: Отображает продукты в выбранной категории.
- `open_spreadsheet`: Открывает Google Spreadsheet в браузере.
- `setup_callbacks`: Настраивает обратные вызовы для виджетов.
- `display_widgets`: Отображает виджеты для взаимодействия в Jupyter Notebook.

### `__init__`

```python
def __init__(self):
    """Инициализация виджетов и настройка редактора кампаний.

    Настраивает виджеты для выбора кампаний, категорий и языков. Также устанавливает
    значения по умолчанию и обратные вызовы для виджетов.
    """
```

**Назначение**:
Инициализирует виджеты, настраивает директорию кампаний, создает выпадающие списки для выбора кампании, категории и языка, а также создает кнопки для различных действий. Устанавливает обратные вызовы для обработки изменений в виджетах и инициализирует редактор кампаний со значениями по умолчанию.

**Как работает функция**:

1.  Определение пути к директории кампаний.
2.  Проверка существования директории кампаний.
3.  Создание выпадающего списка для выбора имени кампании.
4.  Создание выпадающего списка для выбора категории (изначально пустой).
5.  Создание выпадающего списка для выбора языка и валюты.
6.  Создание кнопок для инициализации редактора кампаний, сохранения кампании, отображения продуктов и открытия Google Spreadsheet.
7.  Настройка обратных вызовов для виджетов.
8.  Инициализация редактора кампаний со значениями по умолчанию.

**ASCII схема работы функции**:

```
A [Определение пути к директории кампаний]
|
B [Проверка существования директории кампаний]
|
C [Создание выпадающего списка для выбора имени кампании]
|
D [Создание выпадающего списка для выбора категории]
|
E [Создание выпадающего списка для выбора языка и валюты]
|
F [Создание кнопок для инициализации, сохранения, отображения и открытия]
|
G [Настройка обратных вызовов для виджетов]
|
H [Инициализация редактора кампаний со значениями по умолчанию]
```

**Примеры**:

```python
editor_widgets: JupyterCampaignEditorWidgets = JupyterCampaignEditorWidgets()
```

### `initialize_campaign_editor`

```python
def initialize_campaign_editor(self, _):
    """Инициализация редактора кампаний.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Настраивает редактор кампаний на основе выбранной кампании и категории.
    """
```

**Назначение**:
Инициализирует редактор кампаний AliExpress на основе выбранных значений кампании, категории, языка и валюты.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:

1.  Извлечение выбранных значений кампании, категории, языка и валюты из соответствующих виджетов.
2.  Обновление выпадающего списка категорий на основе выбранной кампании.
3.  Создание экземпляра `AliCampaignEditor` с выбранными параметрами.
4.  Получение информации о выбранной категории и списока продуктов.

**ASCII схема работы функции**:

```
A [Извлечение значений из виджетов]
|
B [Обновление выпадающего списка категорий]
|
C [Создание экземпляра AliCampaignEditor]
|
D [Получение информации о категории и списока продуктов]
```

**Примеры**:

```python
editor_widgets.initialize_campaign_editor(None)
```

### `update_category_dropdown`

```python
def update_category_dropdown(self, campaign_name: str):
    """Обновление выпадающего списка категорий на основе выбранной кампании.

    Args:
        campaign_name (str): Имя кампании.

    Example:
        >>> self.update_category_dropdown("SummerSale")
    """
```

**Назначение**:
Обновляет параметры выпадающего списка категорий на основе выбранной кампании.

**Параметры**:
- `campaign_name` (str): Имя кампании.

**Как работает функция**:

1.  Формирование пути к директории категорий кампании.
2.  Получение списка имен категорий из директории.
3.  Обновление параметров выпадающего списка категорий.

**ASCII схема работы функции**:

```
A [Формирование пути к директории категорий кампании]
|
B [Получение списка имен категорий из директории]
|
C [Обновление параметров выпадающего списка категорий]
```

**Примеры**:

```python
self.update_category_dropdown("SummerSale")
```

### `on_campaign_name_change`

```python
def on_campaign_name_change(self, change: dict[str, str]):
    """Обработка изменений в выпадающем списке имен кампаний.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    Example:
        >>> self.on_campaign_name_change({'new': 'SummerSale'})
    """
```

**Назначение**:
Обрабатывает событие изменения имени кампании в выпадающем списке.

**Параметры**:
- `change` (dict[str, str]): Словарь, содержащий информацию об изменении. Ожидается, что он будет содержать ключ `'new'` с новым значением имени кампании.

**Как работает функция**:

1.  Извлечение нового имени кампании из словаря `change`.
2.  Обновление выпадающего списка категорий на основе выбранной кампании.
3.  Повторная инициализация редактора кампаний с новым именем кампании.

**ASCII схема работы функции**:

```
A [Извлечение нового имени кампании из словаря изменений]
|
B [Обновление выпадающего списка категорий на основе выбранной кампании]
|
C [Повторная инициализация редактора кампаний с новым именем кампании]
```

**Примеры**:

```python
self.on_campaign_name_change({'new': 'SummerSale'})
```

### `on_category_change`

```python
def on_category_change(self, change: dict[str, str]):
    """Обработка изменений в выпадающем списке категорий.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    Example:
        >>> self.on_category_change({'new': 'Electronics'})
    """
```

**Назначение**:
Обрабатывает событие изменения категории в выпадающем списке.

**Параметры**:
- `change` (dict[str, str]): Словарь, содержащий информацию об изменении. Ожидается, что он будет содержать ключ `'new'` с новым значением категории.

**Как работает функция**:

1.  Извлечение нового имени категории из словаря `change`.
2.  Повторная инициализация редактора кампаний с новой категорией.

**ASCII схема работы функции**:

```
A [Извлечение нового имени категории из словаря изменений]
|
B [Повторная инициализация редактора кампаний с новой категорией]
```

**Примеры**:

```python
self.on_category_change({'new': 'Electronics'})
```

### `on_language_change`

```python
def on_language_change(self, change: dict[str, str]):
    """Обработка изменений в выпадающем списке языков.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    Example:
        >>> self.on_language_change({'new': 'EN USD'})
    """
```

**Назначение**:
Обрабатывает событие изменения языка в выпадающем списке.

**Параметры**:
- `change` (dict[str, str]): Словарь, содержащий информацию об изменении. Ожидается, что он будет содержать ключ `'new'` с новым значением языка.

**Как работает функция**:

1.  Извлечение нового значения языка из словаря `change` и разделение его на язык и валюту.
2.  Повторная инициализация редактора кампаний с новым языком и валютой.

**ASCII схема работы функции**:

```
A [Извлечение нового значения языка из словаря изменений и разделение на язык и валюту]
|
B [Повторная инициализация редактора кампаний с новым языком и валютой]
```

**Примеры**:

```python
self.on_language_change({'new': 'EN USD'})
```

### `save_campaign`

```python
def save_campaign(self, _):
    """Сохранение кампании и ее категорий.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Example:
        >>> self.save_campaign(None)
    """
```

**Назначение**:
Сохраняет кампанию и ее категории, используя выбранные значения кампании, категории, языка и валюты.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:

1.  Извлечение значений кампании, категории, языка и валюты из соответствующих виджетов.
2.  Создание экземпляра `AliCampaignEditor` с выбранными параметрами.
3.  Вызов метода `save_categories_from_worksheet` для сохранения категорий кампании.
4.  Обработка исключений, которые могут возникнуть при сохранении кампании.

**ASCII схема работы функции**:

```
A [Извлечение значений из виджетов]
|
B [Создание экземпляра AliCampaignEditor]
|
C [Вызов метода save_categories_from_worksheet для сохранения категорий]
|
D [Обработка исключений при сохранении кампании]
```

**Примеры**:

```python
self.save_campaign(None)
```

### `show_products`

```python
def show_products(self, _):
    """Отображение товаров в выбранной категории.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Example:
        >>> self.show_products(None)
    """
```

**Назначение**:
Отображает товары в выбранной категории, используя выбранные значения кампании, языка и валюты.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:

1.  Извлечение значений кампании и категории из соответствующих виджетов.
2.  Создание экземпляра `AliCampaignEditor` с выбранными параметрами.
3.  Вызов метода `set_products_worksheet` для отображения товаров в выбранной категории.
4.  Обработка исключений, которые могут возникнуть при отображении продуктов.

**ASCII схема работы функции**:

```
A [Извлечение значений кампании и категории из виджетов]
|
B [Создание экземпляра AliCampaignEditor]
|
C [Вызов метода set_products_worksheet для отображения товаров]
|
D [Обработка исключений при отображении продуктов]
```

**Примеры**:

```python
self.show_products(None)
```

### `open_spreadsheet`

```python
def open_spreadsheet(self, _):
    """Открытие Google Spreadsheet в браузере.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Example:
        >>> self.open_spreadsheet(None)
    """
```

**Назначение**:
Открывает Google Spreadsheet в браузере, используя идентификатор электронной таблицы из экземпляра `AliCampaignEditor`.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:

1.  Проверка, инициализирован ли редактор кампаний.
2.  Формирование URL-адреса Google Spreadsheet на основе идентификатора электронной таблицы.
3.  Открытие URL-адреса в браузере с помощью модуля `webbrowser`.

**ASCII схема работы функции**:

```
A [Проверка, инициализирован ли редактор кампаний]
|
B [Формирование URL-адреса Google Spreadsheet]
|
C [Открытие URL-адреса в браузере]
```

**Примеры**:

```python
self.open_spreadsheet(None)
```

### `setup_callbacks`

```python
def setup_callbacks(self):
    """Настройка обратных вызовов для виджетов."""
```

**Назначение**:
Настраивает обратные вызовы для виджетов, чтобы реагировать на изменения значений и нажатия кнопок.

**Как работает функция**:

1.  Настройка обратного вызова для выпадающего списка имен кампаний на метод `on_campaign_name_change`.
2.  Настройка обратного вызова для выпадающего списка категорий на метод `on_category_change`.
3.  Настройка обратного вызова для выпадающего списка языков на метод `on_language_change`.
4.  Настройка обратного вызова для кнопки инициализации на метод `initialize_campaign_editor`.
5.  Настройка обратного вызова для кнопки сохранения на метод `save_campaign`.
6.  Настройка обратного вызова для кнопки отображения продуктов на метод `show_products`.
7.  Настройка обратного вызова для кнопки открытия Google Spreadsheet на метод `open_spreadsheet`.

**ASCII схема работы функции**:

```
A [Настройка обратного вызова для выпадающего списка имен кампаний]
|
B [Настройка обратного вызова для выпадающего списка категорий]
|
C [Настройка обратного вызова для выпадающего списка языков]
|
D [Настройка обратного вызова для кнопки инициализации]
|
E [Настройка обратного вызова для кнопки сохранения]
|
F [Настройка обратного вызова для кнопки отображения продуктов]
|
G [Настройка обратного вызова для кнопки открытия Google Spreadsheet]
```

**Примеры**:

```python
self.setup_callbacks()
```

### `display_widgets`

```python
def display_widgets(self):
    """Отображение виджетов для взаимодействия в Jupyter Notebook.

    Инициализирует редактор кампаний автоматически с первой выбранной кампанией.

    Example:
        >>> self.display_widgets()
    """
```

**Назначение**:
Отображает все виджеты в Jupyter Notebook для взаимодействия с пользователем.

**Как работает функция**:

1.  Отображение выпадающего списка имен кампаний.
2.  Отображение выпадающего списка категорий.
3.  Отображение выпадающего списка языков.
4.  Отображение кнопки инициализации.
5.  Отображение кнопки сохранения.
6.  Отображение кнопки отображения продуктов.
7.  Отображение кнопки открытия Google Spreadsheet.
8.  Инициализация редактора кампаний с первой выбранной кампанией.

**ASCII схема работы функции**:

```
A [Отображение выпадающего списка имен кампаний]
|
B [Отображение выпадающего списка категорий]
|
C [Отображение выпадающего списка языков]
|
D [Отображение кнопки инициализации]
|
E [Отображение кнопки сохранения]
|
F [Отображение кнопки отображения продуктов]
|
G [Отображение кнопки открытия Google Spreadsheet]
|
H [Инициализация редактора кампаний с первой выбранной кампанией]
```

**Примеры**:

```python
self.display_widgets()
```
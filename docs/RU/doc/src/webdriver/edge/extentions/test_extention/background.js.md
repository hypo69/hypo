# `background.js`

## Обзор

Этот файл является фоновым скриптом для расширения браузера, который обрабатывает клики по иконке расширения и сообщения от контентных скриптов. Он собирает данные и отправляет их на сервер.

## Оглавление

1. [Обзор](#обзор)
2. [События](#события)
    - [`chrome.browserAction.onClicked.addListener`](#chromebrowserActiononclickedaddlistener)
    - [`chrome.runtime.onMessage.addListener`](#chromeruntimeonmessageaddlistener)
3. [Функции](#функции)
    - [`sendDataToServer`](#senddatatoserver)

## События

### `chrome.browserAction.onClicked.addListener`

**Описание**:
Этот слушатель события срабатывает при клике на иконку расширения в браузере.

**Параметры**:
- `tab` (object): Объект вкладки, на которой был выполнен клик.

**Действия**:
- Отправляет сообщение `collectData` на активную вкладку, передавая её URL.

### `chrome.runtime.onMessage.addListener`

**Описание**:
Этот слушатель событий отслеживает сообщения, отправленные из других частей расширения, таких как контентные скрипты.

**Параметры**:
- `message` (object): Объект сообщения, отправленный отправителем.
- `sender` (object): Информация об отправителе сообщения.
- `sendResponse` (function): Функция для отправки ответа отправителю.

**Действия**:
- Проверяет, что действие в сообщении равно `collectData`.
- Если условие выполняется, вызывает функцию `sendDataToServer`, передавая URL из сообщения.

## Функции

### `sendDataToServer`

**Описание**:
Эта функция отправляет собранные данные на сервер.

**Параметры**:
- `url` (string): URL страницы, с которой были собраны данные.

**Действия**:
- Получает данные из локального хранилища `chrome.storage.local` под ключом `collectedData`.
- Если данные есть, отправляет их на сервер по адресу `http://127.0.0.1/hypotez.online/api/` с помощью HTTP POST-запроса.
- При успешной отправке выводит сообщение в консоль.
- При возникновении ошибки выводит сообщение об ошибке в консоль.
- Если данные в хранилище отсутствуют, выводит сообщение об ошибке в консоль.

**Вызывает исключения**:
- `Error`: Вызывается в случае, если не удалось отправить данные на сервер.
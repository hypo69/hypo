# Модуль для работы с WebDriver Chrome

## Обзор

Модуль `chrome.py` предоставляет расширение для `webdriver.Chrome` с дополнительной функциональностью, упрощающей управление браузером Chrome через Selenium. Он включает в себя настройку прокси, управление профилем пользователя, установку пользовательского агента и выполнение JavaScript-сценариев.

## Подробней

Этот модуль предназначен для автоматизации взаимодействия с браузером Chrome. Он предоставляет дополнительные возможности, такие как установка прокси, управление профилем пользователя и выполнение JavaScript-сценариев. Модуль также обрабатывает исключения, которые могут возникнуть при запуске и работе с WebDriver.

## Классы

### `Chrome`

**Описание**: Класс `Chrome` расширяет функциональность стандартного `webdriver.Chrome` из Selenium, добавляя возможность настройки прокси, управления профилем пользователя, установки пользовательского агента и выполнения JavaScript-сценариев.

**Наследует**:
- `selenium.webdriver.Chrome`

**Атрибуты**:
- `driver_name` (str): Имя драйвера, установлено как `'chrome'`.

**Методы**:
- `__init__`: Инициализирует экземпляр класса `Chrome`, настраивает параметры Chrome, такие как профиль, прокси и пользовательский агент.
- `set_proxy`: Настраивает прокси для Chrome на основе предоставленного словаря.
- `_payload`: Загружает исполнителей для локаторов и JavaScript-сценариев.

#### `__init__`

**Описание**: Инициализирует экземпляр класса `Chrome`, настраивая параметры Chrome, такие как профиль, прокси и пользовательский агент.

**Параметры**:
- `profile_name` (Optional[str], optional): Имя пользовательского профиля Chrome. По умолчанию `None`.
- `chromedriver_version` (Optional[str], optional): Версия chromedriver. По умолчанию `None`.
- `user_agent` (Optional[str], optional): Пользовательский агент в формате строки. По умолчанию `None`.
- `proxy_file_path` (Optional[str], optional): Путь к файлу с прокси. По умолчанию `None`.
- `options` (Optional[List[str]], optional): Список опций для Chrome. По умолчанию `None`.
- `window_mode` (Optional[str], optional): Режим окна браузера (`windowless`, `kiosk`, `full_window` и т.д.). По умолчанию `None`.
- `*args`: Произвольные позиционные аргументы.
- `**kwargs`: Произвольные именованные аргументы.

**Как работает**:

1. **Инициализация переменных**: Объявляются локальные переменные `service` и `options_obj`.
2. **Загрузка конфигурации Chrome**: Загружаются настройки Chrome из файла `chrome.json` с использованием функции `j_loads_ns`.
3. **Определение пути к ChromeDriver**: Формируется путь к исполняемому файлу ChromeDriver.
4. **Инициализация сервиса Chrome**: Создается экземпляр `Service` с путем к ChromeDriver.
5. **Настройка опций Chrome**: Создается объект `Options` для настройки Chrome.
6. **Добавление опций из файла конфигурации**: Если в файле конфигурации указаны опции, они добавляются в объект `Options`.
7. **Установка режима окна**: Устанавливается режим окна браузера на основе параметров `window_mode` (kiosk, windowless, full_window).
8. **Добавление дополнительных опций**: Добавляются опции, переданные при инициализации класса.
9. **Установка User-Agent**: Устанавливается User-Agent. Если `user_agent` не указан, используется случайный User-Agent из библиотеки `fake_useragent`.
10. **Настройка прокси**: Если в конфигурации включена опция `proxy_enabled`, вызывается метод `set_proxy` для настройки прокси.
11. **Настройка директории профиля**: Устанавливается директория профиля пользователя Chrome.
12. **Запуск WebDriver**: Инициализируется WebDriver Chrome с использованием настроенных опций и сервиса.
13. **Обработка исключений**: Если при запуске WebDriver возникают исключения, они логируются.

```ascii
A: Загрузка конфигурации и настройка опций Chrome
|
B: Установка режима окна
|
C: Установка User-Agent
|
D: Настройка прокси (если включено)
|
E: Настройка директории профиля
|
F: Запуск WebDriver Chrome и обработка исключений
```

**Примеры**:

```python
from src.webdriver.chrome.chrome import Chrome

# Запуск Chrome с профилем и режимом полного окна
driver = Chrome(profile_name='my_profile', window_mode='full_window')

# Запуск Chrome с пользовательским User-Agent
driver = Chrome(user_agent='Mozilla/5.0')
```

#### `set_proxy`

**Описание**: Настраивает прокси для Chrome на основе словаря прокси, возвращаемого функцией `get_proxies_dict`.

**Параметры**:
- `options` (Options): Опции Chrome, в которые добавляются настройки прокси.

**Как работает**:

1. **Получение словаря прокси**: Получает словарь прокси с использованием функции `get_proxies_dict`.
2. **Создание списка всех прокси**: Создает список всех прокси из словаря (SOCKS4 и SOCKS5).
3. **Перебор прокси для поиска рабочего**: Перебирает прокси для поиска рабочего прокси с использованием функции `check_proxy`.
4. **Настройка прокси**: Если рабочий прокси найден, настраивает прокси в зависимости от протокола (HTTP, SOCKS4, SOCKS5).
5. **Логирование**: Логирует информацию о настройке прокси или предупреждение, если прокси не найден.

```ascii
A: Получение словаря прокси
|
B: Создание списка всех прокси
|
C: Перебор прокси для поиска рабочего
|
D: Настройка прокси в зависимости от протокола
|
E: Логирование информации
```

**Примеры**:

```python
from selenium.webdriver.chrome.options import Options
from src.webdriver.chrome.chrome import Chrome

# Создание объекта Options
options = Options()

# Создание инстанса класса Chrome
chrome = Chrome()

# Настройка прокси для Chrome
chrome.set_proxy(options)
```

#### `_payload`

**Описание**: Загружает исполнителей для локаторов и JavaScript-сценариев, чтобы упростить взаимодействие с веб-страницами.

**Как работает**:

1. **Инициализация JavaScript**: Создает экземпляр класса `JavaScript`, передавая ему текущий драйвер (`self`).
2. **Присвоение методов JavaScript**: Присваивает методы из экземпляра `JavaScript` текущему экземпляру драйвера (`self`), чтобы их можно было вызывать напрямую через драйвер.
3. **Инициализация ExecuteLocator**: Создает экземпляр класса `ExecuteLocator`, передавая ему текущий драйвер (`self`).
4. **Присвоение методов ExecuteLocator**: Присваивает методы из экземпляра `ExecuteLocator` текущему экземпляру драйвера (`self`), чтобы их можно было вызывать напрямую через драйвер.

```ascii
A: Инициализация JavaScript
|
B: Присвоение методов JavaScript
|
C: Инициализация ExecuteLocator
|
D: Присвоение методов ExecuteLocator
```

**Примеры**:

```python
from src.webdriver.chrome.chrome import Chrome

# Создание инстанса класса Chrome
driver = Chrome()

# Загрузка исполнителей
driver._payload()
```

## Функции

В данном коде функции отсутствуют.

## Пример использования

```python
from src.webdriver.chrome.chrome import Chrome

# Создание инстанса драйвера Chrome в режиме полного окна
driver = Chrome(window_mode='full_window')

# Открытие веб-страницы
driver.get("https://google.com")
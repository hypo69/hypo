# Документация модуля `src.endpoints.bots.telegram`

## Обзор

Этот модуль содержит реализацию Telegram-бота. Бот выполняет несколько функций, связанных с обработкой команд, голосовых сообщений и взаимодействием с пользователями в Telegram.

## Подробнее

Этот модуль является частью проекта `hypotez` и отвечает за создание и управление Telegram-ботом. Он использует библиотеку `python-telegram-bot` для взаимодействия с Telegram API. Бот способен обрабатывать команды, голосовые сообщения и документы, предоставляя пользователям необходимую функциональность.

## Содержание

- [Основные функции и команды](#основные-функции-и-команды)
- [Основные модули и библиотеки](#основные-модули-и-библиотеки)
- [Классы и методы](#классы-и-методы)
  - [Класс `TelegramBot`](#класс-telegrambot)
    - [`__init__`](#__init__)
    - [`register_handlers`](#register_handlers)
    - [`start`](#start)
    - [`help_command`](#help_command)
    - [`send_pdf`](#send_pdf)
    - [`handle_voice`](#handle_voice)
    - [`transcribe_voice`](#transcribe_voice)
    - [`handle_document`](#handle_document)
    - [`handle_message`](#handle_message)
- [Главная функция](#главная-функция)
  - [`main`](#main)

## Основные функции и команды

1. **Инициализация бота:**
   - Бот инициализируется с токеном, который используется для аутентификации бота в Telegram API.

2. **Команды:**
   - `/start`: Отправляет приветственное сообщение пользователю.
   - `/help`: Предоставляет список доступных команд.
   - `/sendpdf`: Отправляет PDF-файл пользователю.

3. **Обработка сообщений:**
   - Бот обрабатывает входящие текстовые сообщения, голосовые сообщения и файлы документов.
   - Для голосовых сообщений бот транскрибирует аудио (в настоящее время это функция-заполнитель).
   - Для файлов документов бот считывает содержимое текстового документа.

4. **Обработка голосовых сообщений:**
   - Бот загружает файл голосового сообщения, сохраняет его локально и пытается транскрибировать его с помощью службы распознавания речи (в настоящее время это функция-заполнитель).

5. **Обработка документов:**
   - Бот загружает файл документа, сохраняет его локально и считывает содержимое текстового документа.

6. **Обработка текстовых сообщений:**
   - Бот просто возвращает текст, полученный от пользователя.

## Основные модули и библиотеки

- `python-telegram-bot`: Основная библиотека для создания Telegram-ботов.
- `pathlib`: Для работы с путями к файлам.
- `tempfile`: Для создания временных файлов.
- `asyncio`: Для асинхронного выполнения задач.
- `requests`: Для скачивания файлов.
- `src.utils.convertors.tts`: Для распознавания речи и преобразования текста в речь.
- `src.utils.file`: Для чтения текстовых файлов.

## Классы и методы

### `TelegramBot`

**Описание**: Класс для управления Telegram-ботом.

**Принцип работы**:
Класс `TelegramBot` инициализируется с токеном, который используется для аутентификации бота в Telegram API. Он регистрирует обработчики команд и сообщений, которые определяют поведение бота при получении различных типов сообщений. Класс также содержит методы для обработки голосовых сообщений и документов.

**Методы**:

#### `__init__(self, token: str)`

**Назначение**: Инициализирует бота с токеном и регистрирует обработчики.

**Параметры**:
- `token` (str): Токен для аутентификации бота в Telegram API.

**Как работает функция**:
1. Сохраняет токен бота.
2. Создает экземпляр `Application` из библиотеки `python-telegram-bot` с использованием переданного токена.
3. Вызывает метод `register_handlers` для регистрации обработчиков команд и сообщений.

**Примеры**:
```python
from telegram.ext import Application
from src.endpoints.bots.telegram import TelegramBot

# Пример использования
bot = TelegramBot(token="YOUR_TELEGRAM_BOT_TOKEN")
```

#### `register_handlers(self)`

**Назначение**: Регистрирует обработчики команд и сообщений.

**Как работает функция**:
1. Получает экземпляр `Application` из атрибута `application`.
2. Добавляет обработчики команд `/start`, `/help` и `/sendpdf` с использованием `CommandHandler`.
3. Добавляет обработчики сообщений для голосовых сообщений, документов и текстовых сообщений с использованием `MessageHandler` и фильтров.

   ```
   Регистрация обработчиков команд и сообщений
   │
   ├─── Получение Application
   │
   ├─── Добавление обработчиков команд:
   │    ├─── /start
   │    ├─── /help
   │    └─── /sendpdf
   │
   └─── Добавление обработчиков сообщений:
        ├─── Голосовые сообщения
        ├─── Документы
        └─── Текстовые сообщения
   ```

**Примеры**:
```python
from telegram.ext import Application
from src.endpoints.bots.telegram import TelegramBot

# Пример использования
bot = TelegramBot(token="YOUR_TELEGRAM_BOT_TOKEN")
bot.register_handlers()
```

#### `start(self, update: Update, context: CallbackContext)`

**Назначение**: Обрабатывает команду `/start`.

**Параметры**:
- `update` (Update): Объект, представляющий входящее обновление.
- `context` (CallbackContext): Объект, содержащий контекст обратного вызова.

**Как работает функция**:
1. Отправляет приветственное сообщение пользователю, используя `update.message.reply_text`.

**Примеры**:
```python
from telegram import Update
from telegram.ext import CallbackContext
from src.endpoints.bots.telegram import TelegramBot

# Пример использования
async def start_command(update: Update, context: CallbackContext):
    await TelegramBot("YOUR_TELEGRAM_BOT_TOKEN").start(update, context)
```

#### `help_command(self, update: Update, context: CallbackContext)`

**Назначение**: Обрабатывает команду `/help`.

**Параметры**:
- `update` (Update): Объект, представляющий входящее обновление.
- `context` (CallbackContext): Объект, содержащий контекст обратного вызова.

**Как работает функция**:
1. Отправляет сообщение со списком доступных команд пользователю, используя `update.message.reply_text`.

**Примеры**:
```python
from telegram import Update
from telegram.ext import CallbackContext
from src.endpoints.bots.telegram import TelegramBot

# Пример использования
async def help_command(update: Update, context: CallbackContext):
    await TelegramBot("YOUR_TELEGRAM_BOT_TOKEN").help_command(update, context)
```

#### `send_pdf(self, pdf_file: str | Path)`

**Назначение**: Обрабатывает команду `/sendpdf` для отправки PDF-файла.

**Параметры**:
- `pdf_file` (str | Path): Путь к PDF-файлу.

**Как работает функция**:
1. Отправляет PDF-файл пользователю. <далее, если есть>

#### `handle_voice(self, update: Update, context: CallbackContext)`

**Назначение**: Обрабатывает голосовые сообщения и транскрибирует аудио.

**Параметры**:
- `update` (Update): Объект, представляющий входящее обновление.
- `context` (CallbackContext): Объект, содержащий контекст обратного вызова.

**Как работает функция**:
1. Загружает голосовое сообщение.
2. Сохраняет голосовое сообщение локально.
3. Транскрибирует голосовое сообщение.
4. Отправляет транскрибированный текст пользователю.

#### `transcribe_voice(self, file_path: Path) -> str`

**Назначение**: Транскрибирует голосовые сообщения (функция-заполнитель).

**Параметры**:
- `file_path` (Path): Путь к файлу голосового сообщения.

**Возвращает**:
- `str`: Транскрибированный текст.

**Как работает функция**:
1. Транскрибирует голосовое сообщение. <далее, если есть>

#### `handle_document(self, update: Update, context: CallbackContext) -> str`

**Назначение**: Обрабатывает файлы документов и считывает их содержимое.

**Параметры**:
- `update` (Update): Объект, представляющий входящее обновление.
- `context` (CallbackContext): Объект, содержащий контекст обратного вызова.

**Возвращает**:
- `str`: Содержимое текстового документа.

**Как работает функция**:
1. Загружает файл документа.
2. Сохраняет файл документа локально.
3. Считывает содержимое текстового документа.
4. Отправляет содержимое текстового документа пользователю.

#### `handle_message(self, update: Update, context: CallbackContext) -> str`

**Назначение**: Обрабатывает текстовые сообщения и возвращает полученный текст.

**Параметры**:
- `update` (Update): Объект, представляющий входящее обновление.
- `context` (CallbackContext): Объект, содержащий контекст обратного вызова.

**Возвращает**:
- `str`: Текст, полученный от пользователя.

**Как работает функция**:
1. Возвращает текст, полученный от пользователя.

## Главная функция

### `main()`

**Назначение**: Инициализирует бота, регистрирует обработчики команд и сообщений и запускает бота с помощью `run_polling()`.

**Как работает функция**:
1. Инициализирует бота.
2. Регистрирует обработчики команд и сообщений.
3. Запускает бота с помощью `run_polling()`.
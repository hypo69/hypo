# Документация для модуля Code Assistant

## Обзор

Модуль `Code Assistant` представляет собой набор инструментов, предназначенных для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода проекта. Он выполняет такие задачи, как создание документации, проверка кода и генерация тестов на основе указанных файлов. Кроме того, он включает в себя скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бота для обработки задач, связанных с кодом.

## Подробней

Модуль `Code Assistant` предназначен для автоматизации различных задач, связанных с анализом и обработкой кода, с использованием возможностей моделей искусственного интеллекта, таких как Gemini и OpenAI. Он позволяет упростить процесс создания документации, выявления ошибок в коде и генерации тестов, что способствует повышению качества и эффективности разработки.

## Ключевые особенности

### `code_assistant.py`

**Описание**:
Скрипт `code_assistant.py` отвечает за чтение файлов с кодом, взаимодействие с моделями для выполнения задач и сохранение результатов.

**Как работает скрипт**:
1.  **Чтение файлов**: Скрипт считывает код из файлов `.py` и `README.MD` в указанных директориях.
2.  **Взаимодействие с моделями**: Отправляет код моделям для выполнения задач, таких как генерация документации или проверка на наличие ошибок.
3.  **Генерация результатов**: Сохраняет ответы моделей в указанных директориях для каждой роли.

### `make_summary.py`

**Описание**:
Скрипт `make_summary.py` создает файл `SUMMARY.md` для компиляции документации.

**Как работает скрипт**:
1.  **Генерация SUMMARY.md**: Рекурсивно обходит директорию для создания файла `SUMMARY.md` для компиляции документации.
2.  **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (`ru` или `en`).

### `onela_bot.py` и `bot_handlers.py`

**Описание**:
Скрипты `onela_bot.py` и `bot_handlers.py` реализуют Telegram-бота для обработки задач, связанных с кодом.

**Как работает скрипт**:
1.  **Telegram Bot**: Бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода для проверки или генерация документации.
2.  **Bot Handlers**: Содержит обработчики для обработки команд и сообщений бота.

## Структура проекта

-   **Models**: Использует модели **Gemini** и **OpenAI** для обработки запросов.
-   **Prompts**: Читает подсказки из файлов в `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
-   **Files**: Обрабатывает файлы `.py` и `README.MD` в указанных директориях.

## Примеры использования

### Запуск с JSON-настройками:

```bash
python code_assistant.py --settings settings.json
```

### Запуск с явными параметрами:

```bash
python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

### Пример для роли `code_checker`:

```bash
python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
```

### Пример для модели `openai`:

```bash
python code_assistant.py --role doc_writer --lang en --models openai
```

## Параметры командной строки

-   `--settings`: Путь к JSON-файлу с настройками. Загружает параметры из файла.
-   `--role`: Роль модели для задачи (например, `doc_writer`, `code_checker`).
-   `--lang`: Язык для задачи (например, `ru` или `en`).
-   `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
-   `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

## Рабочий процесс

1.  **Чтение файлов**: Поиск файлов `.py` и `README.MD` в указанных директориях.
2.  **Загрузка подсказок**: Загрузка подсказок для конкретной роли из `src/ai/prompts/developer/`.
3.  **Обработка запросов**: Формирование запросов на основе загруженных файлов и отправка их моделям.
4.  **Сохранение ответов**: Сохранение ответов моделей в директориях, соответствующих роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Исключения

Настройте исключения для файлов и каталогов, используя параметры:

-   `exclude_file_patterns`: Список шаблонов regex для исключения файлов.
-   `exclude_dirs`: Список каталогов для исключения.
-   `exclude_files`: Список файлов для исключения.

## Логирование

Логи сохраняются с помощью библиотеки `logger` и содержат информацию об обработке файлов и ответах моделей.

## Зависимости

-   **Gemini API**: Требуется ключ API для модели Gemini.
-   **OpenAI API**: Требуется ключ API для модели OpenAI.

## Создание новой роли для AI-моделей

1.  **Обновите `code_assistant.json`**:

    -   Добавьте новую роль в список ролей:

    ```json
    "roles": [
      "code_checker",
      ...
    ]
    ```

    -   Или исключите ее в `"exclude-roles"`.

2.  **Добавьте роль в переводы**:

    -   Обновите файл `translations/translations.json` новой ролью.

3.  **Создайте системный запрос**:

    -   Добавьте новый системный запрос в `ai/prompts/developer/`.

4.  **Создайте инструкцию по команде**:

    -   Добавьте новую инструкцию по команде в `instructions/`.

---

Эта `README.md` предоставляет всесторонний обзор модуля `code_assistant`, его скриптов и способов их эффективного использования.
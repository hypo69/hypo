# Модуль `main.js`

## Обзор

Этот модуль представляет собой основную логику бота Telegram, использующего OpenAI для обработки голосовых и текстовых сообщений. Он обрабатывает полученные сообщения, конвертирует голосовые сообщения в текст с помощью OpenAI и отправляет ответы обратно пользователю.

## Импорты

```javascript
import { Telegraf } from 'telegraf'
import { message } from 'telegraf/filters'
import { code } from 'telegraf/format'
import config from 'config'
import { ogg } from './ogg.js'
import { openai } from './openai.js'
import { removeFile } from './utils.js'
```

## Переменные

* `bot`: экземпляр класса Telegraf для работы с ботом Telegram.  Инициализируется с помощью токена, полученного из файла `config`.

## Команды

### `start`

**Описание**: Обрабатывает команду `/start`.  Выводит JSON-представление полученного сообщения в чат.

**Параметры**:
  - `ctx`: контекст Telegram сообщения.


## Обработчики событий

### `voice`

**Описание**: Обрабатывает голосовые сообщения.

**Параметры**:
  - `ctx`: контекст Telegram сообщения.

**Обработка**:
1. Отправляет сообщение о начале обработки.
2. Загружает ссылку на файл голоса.
3. Извлекает `userId` отправителя.
4. Создаёт временный файл OGG.
5. Конвертирует OGG в MP3.
6. Удаляет временный OGG файл.
7. Использует `openai.transcription` для преобразования MP3 в текст.
8. Отправляет запрос OpenAI с полученным текстом.
9. Отправляет ответ OpenAI пользователю.


**Возвращает**:
  - Отправляет ответ в Telegram чат.

**Возможные исключения**:
  - `e`: Любое исключение во время обработки сообщения. Выводит сообщение об ошибке в консоль.

### `text`

**Описание**: Обрабатывает текстовые сообщения.

**Параметры**:
  - `ctx`: контекст Telegram сообщения.
  - `ctx.message.text`: Текст сообщения.

**Обработка**:
1. Проверяет наличие сессии.
2. Отправляет сообщение о начале обработки.
3. Вызывает функцию `processTextToChat` для дальнейшей обработки сообщения.

**Возможные исключения**:
  - `e`: Любое исключение во время обработки сообщения. Выводит сообщение об ошибке в консоль.

**Примечание**: Функция `processTextToChat` не определена в данном файле. Ее реализация должна быть определена в другом месте кода.

## Запуск бота

```javascript
bot.launch()
process.once('SIGINT', () => bot.stop('SIGINT'))
process.once('SIGTERM', () => bot.stop('SIGTERM'))
```
```
Запускает бота и обрабатывает сигналы завершения.
```
```
```
```javascript
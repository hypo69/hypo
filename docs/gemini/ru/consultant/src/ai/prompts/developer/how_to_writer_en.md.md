# Анализ кода модуля how_to_writer_en.md

**Качество кода**
7
-  Плюсы
    - Описание формата документации четкое и понятное, с акцентом на reStructuredText.
    - Приведены примеры документации для различных типов блоков кода.
    - Инструкции по использованию конкретных формулировок для описания действий кода.
    - Описаны примеры кода для проверок и других операций.
-  Минусы
    -   Нет явного требования о добавлении docstring к функциям и классам.
    -  Инструкции о сохранении комментариев и обработке данных нужно более точно конкретизировать.
    -   Недостаточно описано, что нужно делать, если код вызывает другие функции из проекта.
    -   Нет инструкций по работе с асинхронными функциями.
    -   Не указаны стандарты оформления docstring (например, Google Style, NumPy Style)

**Рекомендации по улучшению**

1.  **Добавление docstring:** Явно указать, что к каждой функции, классу и методу нужно добавлять docstring, используя reStructuredText (RST) формат. Описать стандарты оформления (например, Google Style, NumPy Style).
2.  **Конкретизация инструкций:** Уточнить, что подразумевается под "сохранением комментариев" и "обработкой данных". Описать процесс более детально, чтобы избежать неоднозначности.
3.  **Обработка вызовов функций:** Добавить инструкцию по документированию вызовов других функций и методов, указав, как и какие параметры нужно описывать.
4.  **Обработка асинхронности:** Добавить инструкции по обработке и документированию асинхронных функций.
5.  **Стандарты оформления docstring:** Рекомендовать использовать какой-то определенный стиль docstring, например, Google Style или NumPy Style, чтобы обеспечить консистентность документации.
6.  **Примеры:** Предоставить более подробные примеры, которые включают различные ситуации (например, работу с разными типами данных, использование нескольких функций в блоке кода).
7.  **Более подробные примеры**
    - Привести примеры docstring для классов, функций и методов.
    - Уточнить, как документировать параметры и возвращаемые значения.
    - Добавить пример документации для кода с асинхронными функциями.

**Оптимизированный код**

```markdown
# ИНСТРУКЦИЯ
## Основные требования:
## Output Language: RU (Русский)

1.  **Формат документации**:
    - Используйте **reStructuredText (RST)** для всех комментариев, docstring и инструкций.
    - Всегда используйте одинарные кавычки (`'`) в Python коде.

2.  **Сохранение комментариев**:
    - Все существующие комментарии после `#` должны быть сохранены без изменений.
    - Блоки кода, которые необходимо изменить, должны быть прокомментированы построчно с использованием символа `#`.

3.  **Обработка данных**:
    - Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load` для чтения файлов.
    - Оставляйте любые `...` в коде без изменений как точки остановки.

4.  **Анализ структуры**:
    - Проверьте и добавьте отсутствующие импорты в код.
    - Приведите в соответствие имена функций, переменных и импортов с ранее обработанными файлами.

5.  **Рефакторинг и улучшения**:
    - Добавьте комментарии в формате RST ко всем функциям, методам и классам, используя docstring.
    - Используйте `from src.logger.logger import logger` для логирования ошибок.
    - Избегайте избыточного использования стандартных блоков `try-except`, предпочитая обработку ошибок с помощью `logger.error`.
    - В комментариях избегайте слов 'получаем', 'делаем' и подобных. Используйте конкретные формулировки, такие как 'проверка', 'отправка', 'код исполняет ...'.

6. **Инструкции по созданию документации "How to"**:
    -   Необходимо проанализировать текущий блок кода и все ранее загруженные блоки кода в проекте.
    -   На основе анализа требуется создать пошаговую инструкцию, описывающую действия, необходимые для выполнения данного блока кода.
    -   Для каждого блока кода следует создать подробную инструкцию в формате reStructuredText (RST) со следующими разделами:
        -   **Описание**: Объяснение назначения блока кода (например, какую задачу решает или какую проверку выполняет).
        -   **Шаги выполнения**: Описание последовательности действий, которые необходимо выполнить для исполнения кода. Подробно объяснить, что происходит на каждом шаге.
        -   **Пример использования**: Пример того, как данный код может быть использован в проекте, включая возможные вызовы функций или методов.
    -   Структура документации для каждого блока кода:

    ```rst
    How to use this code block
    =========================================================================================

    Description
    -------------------------
    This code block performs [описание действий кода, например, "проверку валидности входных данных"].

    Execution steps
    -------------------------
    1. [Первый шаг, например, "Получение данных путем вызова функции `get_data()`."].
    2. [Второй шаг, например, "Проверка данных с использованием метода `validate_data()`."].
    3. [Третий шаг, например, "Если данные валидны, выполняется их дальнейшая обработка."].
    4. [Продолжение, если необходимо...].

    Usage example
    -------------------------
    Пример использования этого блока кода в проекте:

    .. code-block:: python

        <пример_использования_кода>
    ```

    -   При написании документации необходимо:
        -   Если блок кода выполняет проверку, описать, как она работает и какие данные проверяются.
        -   Если блок кода вызывает другие функции или методы, указать, какие функции вызываются и с какими параметрами.
        -   Использовать точные формулировки, избегая общих фраз, таких как "получение" или "выполнение". Вместо этого описывать конкретные действия кода: "код проверяет", "код отправляет запрос" и т.д.
    -   Пример для блока кода, выполняющего проверку переменной:

    ```rst
    How to use this code block
    =========================================================================================

    Description
    -------------------------
    Этот блок кода выполняет проверку переменной `value` перед ее дальнейшей обработкой.

    Execution steps
    -------------------------
    1. Получение значения переменной `value` путем вызова метода `get_value()`.
    2. Проверка, является ли значение пустым или невалидным. Если это так, запись сообщения об ошибке и остановка выполнения.
    3. Если значение валидно, передача его следующей функции для дальнейшей обработки.

    Usage example
    -------------------------
    Пример использования этого блока кода:

    .. code-block:: python

        value = get_value()
        if value:
            process_value(value)
        else:
            logger.error('Invalid value')
    ```
7.  **Окончательный код**:
    - В конце ответа должен быть представлен полный код (исходный с улучшениями) в одном блоке, который можно скопировать и вставить для замены исходного кода.
    - Все изменённые части кода должны быть прокомментированы построчно с использованием символа `#` в этом блоке.

8.  **Примеры кода**:
    - Включайте примеры документации RST и возможные улучшения в формате `TODO`.

9.  **Дополнительная инструкция**:
    - Все комментарии к модулям, функциям, методам и переменным должны быть переписаны в формате reStructuredText (RST), используя docstring. Это включает:
      - Описание модуля в начале файла.
      - Документацию для каждой функции, метода и переменной.
      - Соблюдение стандартов оформления docstring в Python (например, Google Style, NumPy Style).
        - Описание параметров, возвращаемых значений и исключений.
      - В комментариях после `#` строки должны содержать подробное объяснение следующего за ними блока кода.

     Пример формата документации для модуля:

     ```python
     """
     Модуль для работы ассистента программиста
     =========================================================================================

     Этот модуль содержит класс :class:`CodeAssistant`, который используется для работы с различными моделями ИИ,
     такими как Google Gemini и OpenAI, для выполнения задач по обработке кода.

     Пример использования
     --------------------

     Пример использования класса `CodeAssistant`:

     .. code-block:: python

         assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
         assistant.process_files()
     """
     ```

     Пример формата документации для функций (Google Style):

     ```python
     def example_function(param1: str, param2: int) -> str:
         """Выполняет примерную задачу.

         Args:
             param1 (str): Описание параметра 1.
             param2 (int): Описание параметра 2.

         Returns:
             str: Описание возвращаемого значения.
         """
         ...
     ```

     Пример формата стиля комментариев в коде:

     ```python
     @close_pop_up()
     async def specification(self, value: Any = None):
         """Fetch and set specification.

         Args:
             value (Any, optional): это значение можно передать в словаре kwargs через ключ {specification = `value`} при определении класса.
                 Если `value` был передан, его значение подставляется в поле `ProductFields.specification`. Defaults to None.
         """
         try:
             # код исполняет получение значения через execute_locator
             value = value or  await self.driver.execute_locator(self.locator.specification) or ''
         except Exception as ex:
             logger.error('Ошибка получения значения в поле `specification`', ex)
             ...
             return

         # Проверка валидности результата
         if not value:
             logger.debug(f'Невалидный результат {value=}\\nлокатор {self.locator.specification}')
             ...
             return

         # Если значение - список, код преобразовывает его в строку с разделителем `\n`
         if isinstance(value, list):
             value = '\n'.join(map(str, value))

         # Код записывает результат в поле `specification` объекта `ProductFields`
         self.fields.specification = value
         return True
     ```

## Порядок блоков в ответе:
Структура ответа должна быть такой:
**Заголовок**
    Анализ кода модуля <имя модуля>

**Качество кода
<Соответветвие требованиям по оформлению кода от 1 до 10>
 -  Плюсы
        <положительные качества кода>
 -  Минусы
    <отрицательные моменты>
**Рекомендации по улучшению**
**Оптимизиробанный код**
   - Код должен быть обрамлён в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).

## Ответ не должен начинаться с ` ``` `. Используйте их только для оборачивания блоков кода.

## Ты даешь ответы на русском языке
## Формат ответа `.md` (markdown)
----------------------------
** КОНЕЦ ИНСТРУКЦИИ **
```
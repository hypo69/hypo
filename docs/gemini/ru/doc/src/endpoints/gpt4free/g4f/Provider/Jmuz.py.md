# Модуль `Jmuz.py`

## Обзор

Модуль `Jmuz.py` предоставляет класс `Jmuz`, который является подклассом `OpenaiTemplate` и предназначен для взаимодействия с API Jmuz, сервиса, предоставляющего доступ к различным моделям, включая `gpt-4o`, `qwq-32b`, `gemini-1.5` и `deepseek-chat`. Модуль определяет URL, базовый URL API, ключ API, флаг работоспособности и алиасы моделей, а также методы для получения списка моделей и создания асинхронного генератора для взаимодействия с API.

## Подробней

Этот модуль используется для интеграции с сервисом Jmuz в проекте `hypotez`. Он позволяет отправлять запросы к моделям Jmuz и получать ответы в асинхронном режиме. Класс `Jmuz` наследует функциональность от `OpenaiTemplate`, что упрощает взаимодействие с API, следуя общему шаблону для OpenAI-совместимых сервисов.

## Классы

### `Jmuz`

**Описание**:
Класс `Jmuz` предназначен для взаимодействия с API Jmuz. Он наследуется от `OpenaiTemplate` и предоставляет методы для получения списка моделей и создания асинхронного генератора для взаимодействия с API.

**Принцип работы**:
Класс `Jmuz` определяет статические атрибуты, такие как `url`, `api_base`, `api_key` и `working`, которые используются для настройки взаимодействия с API Jmuz. Он также определяет словарь `model_aliases`, который содержит алиасы для различных моделей. Метод `get_models` используется для получения списка доступных моделей, а метод `create_async_generator` создает асинхронный генератор для отправки запросов к API и получения ответов.

**Методы**:
- `get_models`: Получает список доступных моделей.
- `create_async_generator`: Создает асинхронный генератор для отправки запросов к API и получения ответов.

#### `get_models`

```python
@classmethod
def get_models(cls, **kwargs):
    """
    Получает список доступных моделей.

    Args:
        **kwargs: Дополнительные аргументы, которые могут быть переданы в суперкласс.

    Returns:
        list: Список доступных моделей.
    """
    ...
```

**Параметры**:
- `**kwargs`: Дополнительные аргументы, которые могут быть переданы в суперкласс.

**Возвращает**:
- `list`: Список доступных моделей.

**Как работает функция**:
1. Проверяется, был ли уже получен список моделей. Если список моделей не был получен, вызывается метод `get_models` суперкласса (`OpenaiTemplate`) с передачей `api_key` и `api_base` класса `Jmuz`.
2. Возвращается список доступных моделей.

**Примеры**:
```python
models = Jmuz.get_models()
print(models)
# => ['gpt-4o', 'qwq-32b-preview', 'gemini-flash', 'gemini-pro', 'gemini-thinking', 'deepseek-v3']
```

#### `create_async_generator`

```python
@classmethod
async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        stream: bool = True,
        api_key: str = None, # Remove api_key from kwargs
        **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для отправки запросов к API и получения ответов.

    Args:
        model (str): Модель для использования.
        messages (Messages): Список сообщений для отправки.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных. По умолчанию `True`.
        api_key (str): Ключ API. По умолчанию `None`. Этот параметр удален из kwargs.
        **kwargs: Дополнительные аргументы, которые могут быть переданы в суперкласс.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий чанки данных.
    """
    ...
```

**Параметры**:
- `model` (str): Модель для использования.
- `messages` (Messages): Список сообщений для отправки.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных. По умолчанию `True`.
- `api_key` (str): Ключ API. По умолчанию `None`. Этот параметр удален из kwargs.
- `**kwargs`: Дополнительные аргументы, которые могут быть переданы в суперкласс.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий чанки данных.

**Как работает функция**:
1. Получается модель с помощью метода `get_model`.
2. Определяются заголовки запроса, включая ключ API, тип контента и user-agent.
3. Инициализируются переменные `started` и `buffer` для обработки потоковых данных.
4. Вызывается метод `create_async_generator` суперкласса (`OpenaiTemplate`) с передачей необходимых параметров.
5. В цикле обрабатываются чанки данных, полученные от API.
6. Фильтрация нежелательных сообщений, таких как "Join for free" и ссылок на discord.
7. Удаляются префиксы `o1-preview`
8. Удаляются лишние пробелы в начале ответа.
9. Возвращаются отфильтрованные чанки данных.

**Примеры**:
```python
async for chunk in Jmuz.create_async_generator(model='gpt-4o', messages=[{'role': 'user', 'content': 'Hello'}]):
    print(chunk)
```

## Функции

В данном модуле не определены отдельные функции, кроме методов класса `Jmuz`.
## АНАЛИЗ КОДА `hypotez/src/logger/header.py`

### 1. <алгоритм>

**Блок-схема:**

```mermaid
graph TD
    A[Начало] --> B{`set_project_root`};
    B --> C{Инициализация `current_path`: <br> Путь к директории текущего файла};
    C --> D{`__root__ = current_path`};
    D --> E{Цикл по родительским директориям: <br> `current_path`, `current_path.parents`};
    E --> F{Проверка наличия `marker_files` <br>в каждой родительской директории};
    F -- Да --> G{`__root__ = parent` <br>  (родительская директория с маркерным файлом)};
    G --> H{Выход из цикла};
    F -- Нет --> E;
    E -- Конец цикла --> I;
    I --> J{Проверка наличия `__root__` <br>в `sys.path`};
    J -- Нет --> K{Добавление `__root__` в `sys.path`};
     J -- Да --> L{Возврат `__root__`};
    K --> L;
    L --> M{`__root__` = результат `set_project_root()`};    
    M --> N{Импорт глобальных настроек из `src.gs`};    
    N --> O{Чтение `settings.json` <br>  из `gs.path.root`};
    O --> P{Чтение `README.MD` <br>  из `gs.path.root`};
     P --> Q{Извлечение данных из настроек};
    Q --> R[Конец];
     O -- Ошибка --> P;
     P -- Ошибка --> Q;
```

**Примеры:**

1. **`set_project_root()`:**
   -   Пусть текущий файл находится в `hypotez/src/logger/header.py`, а маркерный файл `__root__` в `hypotez/`.
   -   Функция `set_project_root()` начнет с директории `hypotez/src/logger/`, проверит, есть ли в ней маркерные файлы.
   -   Затем перейдет к `hypotez/src/` и проверит наличие маркерных файлов.
   -   В `hypotez/` найдет маркерный файл, присвоит `__root__ = hypotez/` и выйдет из цикла.
   -   Путь `hypotez/` будет добавлен в `sys.path`, если его там не было.

2. **Чтение `settings.json` и `README.MD`:**
   - После определения корневой директории `__root__`, код попытается прочитать `settings.json` из `hypotez/src/settings.json` и `README.MD` из `hypotez/src/README.MD`.
   - Если файлы не существуют или имеют неверный формат JSON, ошибки `FileNotFoundError` и `json.JSONDecodeError` будут перехвачены.

3. **Извлечение данных:**
   - На основании прочитанного `settings.json` будут извлечены параметры: имя проекта (`project_name`), версия (`version`), автор (`author`), копирайт (`copyrihgnt`), и сообщение о кофе (`cofee`).
   - Если `settings.json` отсутствует или параметры не найдены, будут использоваться значения по умолчанию.

### 2. <mermaid>

```mermaid
flowchart TD
    subgraph header.py
        A[<code>header.py</code><br> Determine Project Root] --> B{set_project_root()}
         B --> C{Initialize: <br> <code>current_path = Path(__file__).resolve().parent</code>};
        C --> D{<code>__root__ = current_path</code>};
        D --> E{Iterate through parent directories};
        E --> F{Check for marker files: <br> <code>__root__</code>};
        F -- Yes --> G{<code>__root__ = parent</code>};
        G --> H{Break loop};
        F -- No --> E
         H --> I{Check if <code>__root__</code> is in sys.path};
        I -- No --> J{Add <code>__root__</code> to <code>sys.path</code>};
        I -- Yes --> K{Return <code>__root__</code>};
         J --> K
        K --> L{Import Global Settings: <br><code>from src import gs</code>};
        L --> M{Read <code>settings.json</code>  from <code>gs.path.root</code>};
        M --> N{Read <code>README.MD</code> from <code>gs.path.root</code>};
         N --> O{Extract data from settings};
           M -- Error --> N
          N -- Error --> O;
         O --> P[Set Global variables]
        end
   
    
     style A fill:#f9f,stroke:#333,stroke-width:2px
```

**Анализ зависимостей:**

-   `Path` из `pathlib`: Используется для работы с путями к файлам и директориям, что необходимо для поиска корневой директории проекта.
-   `sys`: Используется для добавления пути к корневой директории проекта в `sys.path`, что позволяет импортировать модули из проекта.
-  `json`: Используется для чтения файла настроек `settings.json`.
-   `Version` из `packaging.version`: Используется для управления версиями пакета. (Не используется в предоставленном коде)
-   `src.gs`: Импортируются глобальные настройки. Путь к файлу настроек строится относительно корневой директории.

**Дополнительно**: Flowchart, объясняющий `header.py`
```mermaid
    flowchart TD
        Start --> Header[<code>header.py</code><br> Determine Project Root]
    
        Header --> import[Import Global Settings: <br><code>from src import gs</code>] 
    ```

### 3. <объяснение>

**Импорты:**

-   `import sys`: Модуль `sys` предоставляет доступ к некоторым переменным и функциям, взаимодействующим с интерпретатором Python. В данном коде используется для модификации `sys.path`, чтобы обеспечить возможность импорта модулей из корневой директории проекта.
-  `import json`:  Модуль `json` используется для работы с данными в формате JSON. В данном коде используется для чтения файла `settings.json`.
-   `from pathlib import Path`: Класс `Path` используется для представления путей к файлам и директориям в операционной системе. Он предоставляет удобный интерфейс для работы с путями, включая их создание, проверку наличия, и манипуляции.
-   `from packaging.version import Version`: (Не используется в предоставленном коде) Модуль `packaging` используется для работы с версиями пакетов.
-   `from src import gs`: Импортирует глобальные настройки проекта, включая путь к корневой директории, чтобы строить пути к файлам относительно корня проекта.

**Функции:**

-   `set_project_root(marker_files=('__root__')) -> Path`:
    -   **Аргументы:**
        -   `marker_files` (tuple): Кортеж с именами файлов или каталогов, которые используются для определения корневой директории проекта. По умолчанию установлен в `('__root__')`.
    -   **Возвращаемое значение:**
        -   `Path`: Объект `Path`, представляющий путь к корневой директории проекта. Если маркерные файлы не найдены, возвращается путь к директории, где находится скрипт.
    -   **Назначение:**
        -   Функция ищет корневую директорию проекта, начиная с директории текущего файла и двигаясь вверх по иерархии каталогов, до тех пор пока не найдет маркерные файлы. Она также добавляет корневой путь в `sys.path`, чтобы обеспечить возможность импорта модулей из проекта.
    -   **Примеры:**
        -   Если маркерный файл `__root__` находится в директории `hypotez/`, то функция вернет `Path` объект, представляющий путь к директории `hypotez/`.

**Переменные:**

-   `MODE`: Глобальная переменная, которая может использоваться для определения режима работы (например, 'dev' для разработки, 'prod' для продакшена).
-   `__root__` (Path): Путь к корневой директории проекта, который определяется при помощи `set_project_root()`.
-   `settings` (dict): Словарь, содержащий настройки проекта, загруженные из файла `settings.json`.
-   `doc_str` (str): Строка, содержащая документацию проекта, загруженная из файла `README.MD`.
-   `__project_name__` (str): Имя проекта, извлеченное из `settings` или по умолчанию 'hypotez'.
-  `__version__` (str): Версия проекта, извлеченная из `settings`.
-   `__doc__` (str): Документация проекта, загруженная из файла `README.MD` или пустая строка.
-   `__details__` (str): Детали проекта, не заданы, значение по умолчанию пустая строка.
-   `__author__` (str): Автор проекта, извлеченный из `settings`.
-  `__copyright__` (str): Копирайт проекта, извлеченный из `settings`.
-   `__cofee__` (str): Сообщение с информацией о том, как поддержать разработчика, извлеченное из `settings`.

**Объяснение кода:**

1.  **Определение корневой директории:**
    -   Функция `set_project_root()` автоматически определяет корневую директорию проекта путем поиска маркерных файлов (по умолчанию `__root__`).
    -   Она начинает поиск от директории, где находится скрипт, и поднимается выше по иерархии, пока не найдет маркерные файлы.
    -   Найденная корневая директория сохраняется в переменную `__root__`.
    -   Если корневая директория не входит в `sys.path`, она добавляется туда, чтобы обеспечить корректный импорт модулей проекта.

2.  **Чтение настроек и документации:**
    -   После определения корневой директории код пытается прочитать файл `settings.json`, который должен находиться в каталоге `src`.
    -   Если чтение файла успешно, то его содержимое будет загружено в переменную `settings`.
     -  Код также пытается прочитать файл `README.MD`,  который должен находиться в каталоге `src`.
     -  Если чтение файла успешно, то его содержимое будет загружено в переменную `doc_str`.
    -   Если при чтении возникают ошибки (файла нет или JSON имеет неправильный формат), то они перехватываются.

3.  **Извлечение данных из настроек:**
    -   На основе загруженных настроек извлекаются различные параметры проекта: имя, версия, автор, копирайт и информация о поддержке разработчика.
    -   Если файл `settings.json` отсутствует или какие-то параметры не заданы, то используются значения по умолчанию.

**Потенциальные ошибки и области для улучшения:**

-   Обработка ошибок: Перехват `FileNotFoundError` и `json.JSONDecodeError` делается без логирования ошибок. В продакшн-режиме это может привести к тому, что проблемы не будут заметны.
-   Отсутствие документации: В коде есть TODO по поводу переноса в системную переменную, однако нет описания почему это нужно.
-   Маркерный файл: Маркерный файл `__root__` не очень очевиден. Можно использовать более понятное имя, например `.project_root`.
-  Отсутствует обработка случая когда `settings` является `None`.

**Взаимосвязь с другими частями проекта:**

-   `header.py` является ключевым модулем, так как устанавливает корневую директорию проекта и обеспечивает корректный импорт других модулей.
-   Он использует `src.gs` для получения глобальных путей.
-   Чтение `settings.json` и `README.MD` позволяет загрузить базовую информацию о проекте.
-   Глобальные переменные, такие как `__project_name__`, `__version__`, `__author__` и др. могут использоваться в других частях проекта для определения имени, версии и другой информации.

Этот модуль `header.py` является фундаментом для всего проекта, поскольку он определяет корневую директорию, позволяя другим модулям импортироваться и работать корректно.
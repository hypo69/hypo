# Диаграмма сценария обработки списка продуктов (process_ai.mmd)

## Обзор

Данная диаграмма описывает сценарий обработки запроса на обработку списка продуктов (products_list) с помощью модели.  Диаграмма показывает взаимодействие между пользователем, моделью и логирующим сервисом, включая возможные ошибки и повторные запросы.

## Сценарий

Диаграмма представляет последовательность действий при получении запроса от пользователя на обработку списка продуктов.

```mermaid
sequenceDiagram
    participant User
    participant AI_Model
    participant Logger

    User->>AI_Model: Запрос на обработку продуктов (products_list)
    AI_Model->>AI_Model: Обработка запроса с командой модели
    AI_Model->>User: Ответ от модели

    alt Нет ответа от модели
        Logger->>Logger: Логирирование ошибки "no response from gemini"
        User->>AI_Model: Повторный запрос (attempts - 1)
    end

    alt Невалидные данные (data)
        Logger->>Logger: Логирирование ошибки "Error in data from gemini"
        User->>AI_Model: Повторный запрос (attempts - 1)
    end

    alt Получены данные (data)
        alt Данные в виде списка
            alt Два элемента (ru, he)
                User->>User: Извлечение ru и he
            end
            alt Один элемент
                User->>User: Извлечение ru и he из первого элемента
            end
            alt Невалидная структура данных
                Logger->>Logger: Логирирование ошибки "Проблема парсинга ответа"
                User->>AI_Model: Повторный запрос (attempts - 1)
            end
        end

        alt Данные в виде объекта
            User->>User: Извлечение ru и he из объекта
        end

        alt Невалидные значения (ru или he)
            Logger->>Logger: Логирирование ошибки "Invalid ru or he data"
            User->>AI_Model: Повторный запрос (attempts - 1)
        end

        User->>User: Возврат результата ru и he
    end
```

## Описание этапов

Диаграмма отображает следующие ключевые этапы обработки:

- **Запрос пользователя:** Пользователь отправляет запрос на обработку списка продуктов.
- **Обработка модели:** Модель получает запрос и пытается обработать его.
- **Ответ модели:** Модель возвращает результат обработки.
- **Обработка ответа:** Проверка ответа на валидность и извлечение необходимых данных (ru и he).
- **Логирование ошибок:** В случае ошибок (отсутствие ответа, невалидные данные, невалидные значения) логируется ошибка.
- **Повторные запросы:** В случае ошибок модель может быть запрошена повторно.
- **Возврат результата:** Пользователь получает результат обработки.

## Возможные ошибки

- `no response from gemini`: Модель не вернула ответа.
- `Error in data from gemini`: Полученные данные имеют невалидный формат.
- `Проблема парсинга ответа`: Данные имеют невалидную структуру для извлечения ru и he.
- `Invalid ru or he data`: Извлеченные значения ru или he имеют невалидный формат.


## Заключение

Данный сценарий описывает последовательность действий для обработки запроса на обработку списка продуктов, включая возможные ошибки и механизмы их обработки.
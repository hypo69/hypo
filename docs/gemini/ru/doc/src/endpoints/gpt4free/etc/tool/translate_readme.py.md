# Модуль для перевода README файлов
=================================================

Модуль предназначен для автоматического перевода файлов README.md на другие языки с использованием GPT-4. В частности, он использует g4f библиотеку для доступа к моделям GPT-4 и выполняет перевод текста, сохраняя при этом структуру и важные элементы форматирования Markdown.

## Обзор

Модуль состоит из нескольких функций, которые совместно выполняют следующие задачи:
1. Чтение README.md файла.
2. Разделение содержимого на части для упрощения обработки.
3. Перевод каждой части с использованием GPT-4.
4. Сборка переведенных частей обратно в единый документ.
5. Сохранение переведенного документа в новый файл с указанием языка.

## Подробней

Модуль `translate_readme.py` является частью процесса автоматизации перевода документации в проекте `hypotez`. Он использует API GPT-4 для перевода текста, что позволяет создавать многоязычные версии документации проекта.

## Функции

### `read_text`

```python
def read_text(text) -> str:
    """
    Извлекает текст из markdown-блока кода.

    Args:
        text (str): Строка, содержащая markdown-блок кода.

    Returns:
        str: Извлеченный текст без маркеров кода.

    Как работает функция:
    1. Разделяет входной текст на строки.
    2. Определяет начало и конец блока кода, основываясь на маркерах '```'.
    3. Извлекает строки, находящиеся между маркерами начала и конца блока кода.
    4. Объединяет извлеченные строки в одну строку и возвращает её.

    Пример:
    >>> text = "Some text\\n```\\nCode block\\n```"
    >>> read_text(text)
    'Code block'
    """
```

**Как работает функция `read_text`**:

Функция `read_text` предназначена для извлечения содержимого из markdown-блоков кода. Она принимает на вход строку, содержащую текст с блоками кода, и возвращает только текст, находящийся внутри этих блоков.

**ASCII Flowchart**:

```
Начало
  ↓
Разделить текст на строки
  ↓
Найти начало и конец блока кода
  ↓
Извлечь текст между маркерами
  ↓
Объединить извлеченный текст
  ↓
Конец
```

**Примеры**:

```python
text1 = "Some text\n```\nCode block\n```"
result1 = read_text(text1)
print(result1)  # Вывод: Code block

text2 = "```\nAnother code block\n```\nMore text"
result2 = read_text(text2)
print(result2)  # Вывод: Another code block
```

### `translate`

```python
async def translate(text: str) -> str:
    """
    Переводит предоставленный текст с использованием GPT-4 через g4f.

    Args:
        text (str): Текст для перевода.

    Returns:
        str: Переведенный текст.

    Как работает функция:
    1. Формирует запрос для GPT-4, включая текст для перевода и инструкции.
    2. Добавляет инструкцию о сохранении маркеров [!Note], если они есть в тексте.
    3. Отправляет запрос к GPT-4 через асинхронный вызов `provider.create_async`.
    4. Извлекает переведенный текст из ответа GPT-4 с помощью `read_text`.
    5. Добавляет недостающие маркеры "```" в конце, если это необходимо.

    """
```

**Как работает функция `translate`**:

Функция `translate` является асинхронной функцией, которая использует GPT-4 для перевода текста. Она формирует запрос к GPT-4, отправляет его и возвращает переведенный текст.

**ASCII Flowchart**:

```
Начало
  ↓
Сформировать запрос для GPT-4
  ↓
Отправить запрос через provider.create_async
  ↓
Извлечь переведенный текст с помощью read_text
  ↓
Добавить недостающие маркеры "```"
  ↓
Конец
```

**Примеры**:

```python
import asyncio

async def main():
    text1 = "Hello, world!"
    translated_text1 = await translate(text1)
    print(translated_text1)

    text2 = "[!Note] This is a note."
    translated_text2 = await translate(text2)
    print(translated_text2)

if __name__ == "__main__":
    asyncio.run(main())
```

### `translate_part`

```python
async def translate_part(part: str, i: int) -> str:
    """
    Переводит часть текста, проверяя наличие blocklist-заголовков.

    Args:
        part (str): Часть текста для перевода.
        i (int): Индекс части текста.

    Returns:
        str: Переведенная часть текста.

    Как работает функция:
    1. Проверяет, содержит ли часть текста заголовки из blocklist.
    2. Если содержит, переводит только первую строку и заголовки из allowlist.
    3. Если не содержит, переводит всю часть текста.
    4. Выводит сообщение о том, что часть текста переведена.

    """
```

**Как работает функция `translate_part`**:

Функция `translate_part` отвечает за перевод отдельных частей текста, при этом учитываются заголовки, которые не следует переводить (blocklist).

**ASCII Flowchart**:

```
Начало
  ↓
Проверить наличие blocklist-заголовков
  ↓
Если есть:
  → Перевести первую строку и заголовки из allowlist
  ↓
Иначе:
  → Перевести всю часть текста
  ↓
Вывести сообщение о переводе
  ↓
Конец
```

**Примеры**:

```python
import asyncio

async def main():
    part1 = "## ©️ Copyright This is a copyright notice."
    translated_part1 = await translate_part(part1, 1)
    print(translated_part1)

    part2 = "## This is a regular section."
    translated_part2 = await translate_part(part2, 2)
    print(translated_part2)

if __name__ == "__main__":
    asyncio.run(main())
```

### `translate_readme`

```python
async def translate_readme(readme: str) -> str:
    """
    Разделяет README на части и переводит каждую часть.

    Args:
        readme (str): Содержимое README файла.

    Returns:
        str: Переведенное содержимое README файла.

    Как работает функция:
    1. Разделяет README на части по разделителю '## '.
    2. Асинхронно переводит каждую часть с использованием `translate_part`.
    3. Объединяет переведенные части обратно в единый текст.

    """
```

**Как работает функция `translate_readme`**:

Функция `translate_readme` является основной функцией для перевода всего README файла. Она разделяет файл на части и асинхронно переводит каждую часть, после чего собирает все части обратно в один документ.

**ASCII Flowchart**:

```
Начало
  ↓
Разделить README на части
  ↓
Асинхронно перевести каждую часть
  ↓
Объединить переведенные части
  ↓
Конец
```

**Примеры**:

```python
import asyncio

async def main():
    readme_content = "## Section 1\nThis is the first section.\n## Section 2\nThis is the second section."
    translated_readme = await translate_readme(readme_content)
    print(translated_readme)

if __name__ == "__main__":
    asyncio.run(main())
```
# Анализ кода модуля `readme.ru.md`

**Качество кода**
8
- Плюсы
    - Хорошая структура и подробное описание модуля `Code Assistant`.
    - Четкое описание основных возможностей, структуры проекта, примеров использования и параметров командной строки.
    - Приведены примеры использования с различными параметрами и ролями, что облегчает понимание работы модуля.
    - Описана логика работы, исключения, логирование и зависимости.
    - Есть раздел о создании новой роли для моделей ИИ.
- Минусы
    - Нет явного описания формата `settings.json`.
    - Некоторые моменты (например, работа с `exclude_file_patterns`) можно было бы расписать подробнее.
    - Отсутствует описание структуры проекта в файловой системе (где лежат исходные файлы).

**Рекомендации по улучшению**
1. Добавить описание формата файла `settings.json`, чтобы пользователь знал, какие параметры и в каком формате он может задать.
2.  Более подробно описать работу с параметром `exclude_file_patterns`, указав примеры использования регулярных выражений.
3. Добавить схему файловой структуры проекта (где лежат файлы `code_assistant.py`, `make_summary.py`, `onela_bot.py`, `bot_handlers.py`, `prompts`, `translations` и т.д.).
4.  В разделе "Создание новой роли для моделей ИИ" добавить пример содержимого файла `translations/translations.json`.
5. Добавить пример содержимого файла `settings.json`.
6. Добавить пример `prompts`
7. Добавить пример `instructions`
8. Уточнить, как именно сохраняются ответы моделей (какая структура директорий и файлов).

**Оптимизированный код**

```markdown
``````rst
.. module:: src.endpoints.hypo69.code_assistant
```
<TABLE >
<TR>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/readme.ru.md'>[Root ↑]</A>
</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/readme.ru.md'>src</A> \\ 
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/readme.ru.md'>endpoints</A> \\\
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/readme.ru.md'>hypo69</A>

</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/code_assistant/README.MD'>English</A>
</TD>
</TR>
</TABLE>

# Модуль `Code Assistant`

## Обзор
Модуль `Code Assistant` представляет собой набор инструментов для взаимодействия с моделями **Gemini** и **OpenAI** с целью обработки исходного кода проекта. Он выполняет задачи, такие как создание документации, проверка кода и генерация тестов на основе указанных файлов. Также включает скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бота для обработки задач, связанных с кодом.

## Основные возможности

### `code_assistant.py`
- **Чтение файлов**: Читает код из файлов с расширениями `.py` и `README.MD` в указанных директориях.
- **Взаимодействие с моделями**: Отправляет код в модели для выполнения задач, таких как создание документации или проверка ошибок.
- **Генерация результатов**: Сохраняет ответы моделей в указанные директории для каждой роли.

### `make_summary.py`
- **Генерация `SUMMARY.md`**: Рекурсивно обходит директорию для создания файла `SUMMARY.md` для компиляции документации.
- **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (`ru` или `en`).

### `onela_bot.py` и `bot_handlers.py`
- **Telegram-бот**: Бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода на проверку или генерация документации.
- **Обработчики бота**: Содержит обработчики для команд и сообщений бота.

## Структура проекта

- **Модели**: Используются модели **Gemini** и **OpenAI** для обработки запросов.
- **Промпты**: Читает промпты из файлов в директории `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Файлы**: Обрабатываются файлы с расширениями `.py` и `README.MD` в указанных директориях.
- **Файловая структура проекта**:
  ```
  src/
  ├── endpoints/
  │   └── hypo69/
  │       └── code_assistant/
  │           ├── code_assistant.py       # Основной скрипт
  │           ├── make_summary.py         # Скрипт для создания SUMMARY.md
  │           ├── onela_bot.py            # Telegram-бот
  │           ├── bot_handlers.py         # Обработчики Telegram-бота
  │           └── readme.ru.md            # Этот файл
  ├── ai/
  │   └── prompts/
  │       └── developer/
  │           ├── doc_writer_en.md        # Пример промпта
  │           ├── doc_writer_ru.md        # Пример промпта
  │           └── code_checker_en.md      # Пример промпта
  │
  ├── instructions/
  │   └── doc_writer/
  │          └── code_assistant_doc_writer_ru.md # Пример инструкции
  │
  ├── translations/
  │   └── translations.json # Файл с переводами
  └── utils/
  
  ```

## Примеры использования

### Запуск с настройками из JSON:
```bash
python code_assistant.py --settings settings.json
```

### Запуск с явным указанием параметров:
```bash
python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

### Пример для роли `code_checker`:
```bash
python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
```

### Пример для модели `openai`:
```bash
python code_assistant.py --role doc_writer --lang en --models openai
```

## Параметры командной строки

- `--settings`: Путь к JSON-файлу с настройками. Загружает параметры из файла.
- `--role`: Роль модели для выполнения задачи (например, `doc_writer`, `code_checker`).
- `--lang`: Язык выполнения задачи (например, `ru` или `en`).
- `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
- `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

## Логика работы

1. **Чтение файлов**: Ищет файлы с расширениями `.py` и `README.MD` в указанных директориях.
2. **Загрузка промптов**: Загружает промпты для каждой роли из директории `src/ai/prompts/developer/`.
3. **Обработка запросов**: Формирует запросы на основе загруженных файлов и отправляет их в модели.
4. **Сохранение ответов**: Сохраняет ответы моделей в директории, соответствующие роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Исключения

Настройка исключений для файлов и директорий с помощью параметров:
- `exclude_file_patterns`: Список регулярных выражений для исключения файлов. Например, `[r'.*test\.py', r'.*__init__\.py']` исключит все файлы, оканчивающиеся на `test.py` и `__init__.py`.
- `exclude_dirs`: Список директорий для исключения.
- `exclude_files`: Список файлов для исключения.

## Логирование

Логи сохраняются с помощью библиотеки `logger` и содержат информацию о процессе обработки файлов и полученных ответах.

## Зависимости

- **Gemini API**: Требуется API-ключ для работы с моделью Gemini.
- **OpenAI API**: Требуется API-ключ для работы с моделью OpenAI.

## Создание новой роли для моделей ИИ

1. **Обновление `code_assistant.json`**:\
   - Добавьте новую роль в список ролей в файле настроек `settings.json` (или создайте его).
        Пример файла `settings.json`:
        ```json
        {
            "roles": [
              "code_checker",
              "doc_writer",
              "new_role"
            ],
             "exclude-roles": ["test_role"],
               "exclude_file_patterns": [".*test.py"],
            "exclude_files": ["test.md"],
             "exclude_dirs": ["test_dir"]

        }
       ```
   - Или исключите её в `"exclude-roles"`.

2. **Добавление роли в переводы**:\
   - Обновите файл `translations/translations.json` с новой ролью.
     Пример содержимого файла `translations/translations.json`:
    ```json
      {
        "code_checker": {
          "ru": "Проверка кода",
          "en": "Code check"
        },
        "doc_writer": {
          "ru": "Создание документации",
          "en": "Documentation writer"
         },
         "new_role":{
           "ru": "Новая роль",
           "en": "New role"
         }
      }
    ```

3. **Создание системного промпта**:\
   - Добавьте новый системный промпт в директорию `ai/prompts/developer/`, например, `new_role_en.md` или `new_role_ru.md`.
       Пример содержимого файла `ai/prompts/developer/new_role_ru.md`:
       ```markdown
       Ты - ассистент, который выполняет новую роль.
       Твоя задача ...
       ```

4.  **Создание командной инструкции**:\
    - Добавьте новую команду в директорию `instructions/`, например, `code_assistant_new_role_ru.md`.
        Пример содержимого `instructions/code_assistant_new_role_ru.md`:
       ```markdown
       # Инструкция для новой роли
        ## Описание
         Эта инструкция описывает, что делает модель с новой ролью ...
        ```
```
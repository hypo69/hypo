# Модуль `hypotez/src/utils/smtp.py`

## Обзор

Модуль `smtp.py` предоставляет функции для отправки и получения электронных писем через SMTP и IMAP сервера.  Он включает функции `send` для отправки писем и `receive` для получения писем.  Ключевое внимание уделяется безопасности и отказоустойчивости, в том числе  используются переменные окружения для хранения учетных данных, надельная обработка ошибок и логирование.

## Функции

### `send`

**Описание**: Отправляет электронное письмо используя SMTP сервер. Возвращает `True` при успешной отправке и `False` в противном случае.  Логирует ошибки.

**Параметры**:

- `subject` (str, optional): Тема письма. По умолчанию пустая строка.
- `body` (str, optional): Тело письма. По умолчанию пустая строка.
- `to` (str, optional): Адрес получателя. По умолчанию `'one.last.bit@gmail.com'`.

**Возвращает**:

- `bool`: `True` при успешной отправке, `False` при ошибке.

**Вызывает исключения**:

- Любые исключения, возникающие во время работы с SMTP сервером (например, `smtplib.SMTPException`).  Подробная информация об ошибке будет записана в лог.


### `receive`

**Описание**: Получает электронные письма с указанного IMAP сервера. Возвращает список словарей, представляющих письма, или `None` при ошибке. Логирует ошибки.

**Параметры**:

- `imap_server` (str): Адрес IMAP сервера.
- `user` (str): Пользовательское имя для входа на IMAP сервер.
- `password` (str): Пароль для входа на IMAP сервер.
- `folder` (str, optional): Папка, из которой необходимо получить письма. По умолчанию `'inbox'`.

**Возвращает**:

- `Optional[List[Dict[str, str]]]`: Список словарей, где каждый словарь представляет письмо и содержит ключи `'subject'`, `'from'`, и `'body'`. Возвращает `None` при ошибке.

**Вызывает исключения**:

- Любые исключения, возникающие во время работы с IMAP сервером (например, `imaplib.IMAP4.error`). Подробная информация об ошибке будет записана в лог.


##  Важные замечания

- **Безопасность**:  Не следует хранить учетные данные (логин/пароль) напрямую в коде.  Используйте переменные окружения для хранения данных аутентификации (`_connection`).
- **Обработка ошибок**:  В коде реализована надежная обработка ошибок с использованием блоков `try...except` и логированием.
- **Обработка MIME**: Функция `receive` правильно обрабатывает различные форматы писем, предотвращая потенциальные ошибки.
- **Декодирование текста**: Функция `receive` декодирует содержимое письма (`body`) для корректной обработки различного кодирования. Обратите внимание на использование `decode("utf-8", "ignore")` для обработки возможных ошибок при декодировании.
- **Документация**:  Документация в начале файла (`"""..."""`)  содержит полезные описания функций и важные соображения.
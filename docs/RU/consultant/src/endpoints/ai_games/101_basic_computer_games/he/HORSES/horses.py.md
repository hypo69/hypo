# Анализ кода модуля `horses.py`

**Качество кода**
8
-  Плюсы
    - Код хорошо структурирован и понятен.
    - Используются константы для определения количества лошадей и длины трассы.
    - Логика игры реализована в отдельных функциях, что улучшает читаемость и поддерживает принцип единственной ответственности.
    - Присутствуют проверки на ввод пользователя и обработка ошибок ввода.
    - Есть документация к функциям, хотя и не в формате RST.

-  Минусы
    - Отсутствует описание модуля в начале файла.
    - Документация функций не соответствует формату reStructuredText (RST).
    - Не используется логгирование.
    - Код использует стандартный `print` для вывода, что затрудняет отладку и тестирование.
    - Отсутствует обработка возможных исключений при работе с `random.randint`.
    - Нет констант для сообщений, что затрудняет поддержку и изменение.

**Рекомендации по улучшению**

1.  Добавить описание модуля в формате RST в начале файла.
2.  Переписать документацию функций в формате RST.
3.  Использовать `from src.logger.logger import logger` для логирования ошибок и отладки.
4.  Заменить `print` на `logger.info`, `logger.debug` для вывода сообщений.
5.  Добавить обработку возможных исключений в функции `random.randint`.
6.  Определить константы для сообщений, чтобы облегчить их поддержку и изменение.
7.  Улучшить читаемость, добавив комментарии к логическим блокам кода.
8.  Оптимизировать код, используя более идиоматичные конструкции Python.

**Оптимизированный код**

```python
"""
Модуль для игры в скачки "Лошади".
=========================================================================================

Этот модуль имитирует гонку между несколькими лошадьми.
Игрок выбирает лошадь и наблюдает за гонкой. Лошади продвигаются
случайным образом, пока одна из них не пересечет финишную черту.
Если игрок выбрал лошадь-победителя, он выигрывает.

Пример использования
--------------------

Пример запуска игры:

.. code-block:: python

    if __name__ == "__main__":
        play_horses_game()
"""
import random
from src.logger.logger import logger # Импорт модуля логгирования

# Константы для игры
NUM_HORSES = 4 # Количество участвующих лошадей
TRACK_LENGTH = 20 # Длина трассы
MSG_WELCOME = "ברוכים הבאים למרוץ הסוסים!" # Приветственное сообщение
MSG_CHOOSE_HORSE = "בחר את הסוס שלך (1-4):" # Запрос выбора лошади
MSG_INVALID_INPUT = "בחירה לא חוקית, אנא בחר מספר סוס בין 1 ל-4." # Сообщение о неверном вводе
MSG_INVALID_NUMBER = "בחירה לא חוקית, אנא הזן מספר." # Сообщение о неверном формате ввода
MSG_WINNER = " ניצח!" # Сообщение о победе
MSG_USER_WINS = "ניצחת!" # Сообщение о победе игрока
MSG_USER_LOSES = "הפסדת!" # Сообщение о проигрыше игрока

def play_horses_game():
    """
    Запускает игру в скачки.

    Инициализирует игру, запрашивает выбор пользователя,
    запускает гонку и определяет победителя.
    """
    logger.info(MSG_WELCOME) # Выводит приветственное сообщение в лог
    logger.info(MSG_CHOOSE_HORSE) # Выводит запрос на выбор лошади в лог

    # Вывод номеров лошадей
    for i in range(NUM_HORSES):
        logger.info(f"{i+1}. סוס {i+1}") # Вывод номера лошади в лог
    
    # Запрос и проверка ввода пользователя
    while True:
        try:
            user_horse = int(input("בחר את מספר הסוס שלך: ")) # Запрос ввода номера лошади
            if 1 <= user_horse <= NUM_HORSES: # Проверка корректности ввода
                break
            else:
                logger.error(MSG_INVALID_INPUT) # Логирование ошибки некорректного ввода
                print(MSG_INVALID_INPUT) # Сообщение о некорректном вводе
        except ValueError:
            logger.error(MSG_INVALID_NUMBER) # Логирование ошибки неверного формата ввода
            print(MSG_INVALID_NUMBER) # Сообщение о неверном формате ввода

    horse_positions = [0] * NUM_HORSES # Инициализация позиций лошадей

    # Основной игровой цикл
    while True:
        print_track(horse_positions) # Вывод текущего состояния трассы
        
        winner_horse = check_winner(horse_positions) # Проверка победителя
        if winner_horse:
            logger.info(f"\\nסוס {winner_horse+1}{MSG_WINNER}") # Логирование сообщения о победе
            print(f"\\nסוס {winner_horse+1}{MSG_WINNER}") # Вывод сообщения о победе
            if winner_horse + 1 == user_horse: # Проверка, выиграл ли игрок
                logger.info(MSG_USER_WINS) # Логирование сообщения о победе игрока
                print(MSG_USER_WINS) # Вывод сообщения о победе игрока
            else:
                logger.info(MSG_USER_LOSES) # Логирование сообщения о проигрыше игрока
                print(MSG_USER_LOSES) # Вывод сообщения о проигрыше игрока
            break
        
        # Обновление позиций лошадей
        for i in range(NUM_HORSES):
            try:
                step = random.randint(0, 1) # Получение случайного шага для лошади
                horse_positions[i] += step # Обновление позиции лошади
            except Exception as e:
                logger.error(f'Ошибка при вычислении случайного шага для лошади {i}: {e}') # Логирование ошибки
                continue


def print_track(horse_positions):
  """
  Выводит текущее состояние трассы.

  Args:
    horse_positions (list): Список текущих позиций лошадей.
  """
  track = "" # Инициализация пустой строки для трассы
  for i in range(TRACK_LENGTH + 1): # Проход по всем позициям трассы
      horse_on_pos = False # Флаг для проверки наличия лошади на позиции
      for horse_index, pos in enumerate(horse_positions): # Проход по всем лошадям
          if pos == i: # Проверка, находится ли лошадь на текущей позиции
            track += str(horse_index + 1) # Добавление номера лошади в строку трассы
            horse_on_pos = True # Установка флага
            break # Выход из цикла по лошадям
      if not horse_on_pos:
         track += "_" # Если на позиции нет лошади, добавляется символ "_"
  logger.debug(track) # Вывод трассы в лог
  print(track) # Вывод трассы на экран

def check_winner(horse_positions):
  """
  Проверяет, есть ли победитель в гонке.

  Args:
    horse_positions (list): Список текущих позиций лошадей.

  Returns:
    int: Индекс победившей лошади, если есть, иначе None.
  """
  for i, pos in enumerate(horse_positions): # Проход по всем лошадям
        if pos >= TRACK_LENGTH: # Проверка, достигла ли лошадь конца трассы
            return i # Возврат индекса победившей лошади
  return None # Возврат None, если победителя нет

if __name__ == "__main__":
    play_horses_game() # Запуск игры, если скрипт запущен напрямую
```
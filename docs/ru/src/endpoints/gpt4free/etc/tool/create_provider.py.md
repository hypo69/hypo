# Модуль для создания нового провайдера g4f

## Обзор

Этот модуль предоставляет инструменты для создания нового провайдера для библиотеки `g4f` на основе cURL-команды. Он включает в себя функции для считывания cURL-команды из ввода пользователя, генерации кода провайдера на основе этой команды с использованием модели GPT-4o, и сохранения сгенерированного кода в файл. Модуль также обеспечивает добавление нового провайдера в файл `__init__.py`, чтобы его можно было импортировать и использовать в `g4f`.

## Подробнее

Модуль предназначен для автоматизации процесса создания новых провайдеров для `g4f` на основе существующих cURL-запросов. Это упрощает добавление поддержки для новых API и сервисов, позволяя разработчикам сосредоточиться на интеграции, а не на написании шаблонного кода.

## Функции

### `read_code`

```python
def read_code(text: str) -> str | None:
    """Извлекает код Python из текстовой строки, заключенного в блоки кода, отмеченные тройными обратными кавычками.

    Args:
        text (str): Текст для поиска блоков кода Python.

    Returns:
        str | None: Извлеченный код Python или None, если блок кода не найден.

    Raises:
        None

    Example:
        >>> text = "Some text ```python\\nprint('Hello')\\n```"
        >>> read_code(text)
        "print('Hello')"
    """
```

**Как работает функция**:

1. **Поиск блока кода**: Функция использует регулярное выражение для поиска текста, заключенного между тройными обратными кавычками (```). Регулярное выражение также учитывает указание языка (python, py) после открывающих кавычек.
2. **Извлечение кода**: Если блок кода найден, функция извлекает содержимое этого блока, используя именованную группу `code` в регулярном выражении.
3. **Возврат результата**: Функция возвращает извлеченный код. Если блок кода не найден, функция возвращает `None`.

**Пример**:

```python
text = "Some text ```python\nprint('Hello')\n```"
code = read_code(text)
print(code)
```

ASCII flowchart:

```
A: Получение текста
|
B: Поиск кода с помощью регулярного выражения
|
C: Код найден?
|
D: Да -> Извлечение кода
|
E: Нет -> Возврат None
|
F: Возврат извлеченного кода
```

### `input_command`

```python
def input_command() -> str:
    """Считывает многострочный ввод из стандартного ввода до тех пор, пока пользователь не завершит ввод символом EOF (Ctrl-D или Ctrl-Z в Windows).

    Args:
        None

    Returns:
        str: Объединенная строка введенных строк.

    Raises:
        None

    Example:
        Пользователь вводит:
        >>> line1
        >>> line2
        >>> (Ctrl-D)
        input_command() -> "line1\\nline2"
    """
```

**Как работает функция**:

1. **Инициализация списка**: Функция создает пустой список `contents` для хранения введенных строк.
2. **Чтение ввода**: Функция входит в бесконечный цикл, в котором пытается прочитать строку из стандартного ввода с помощью `input()`.
3. **Обработка EOFError**: Если возникает исключение `EOFError` (что происходит, когда пользователь нажимает Ctrl-D или Ctrl-Z), цикл прерывается.
4. **Объединение строк**: После завершения ввода функция объединяет все строки в списке `contents` в одну строку, разделяя их символом новой строки (`\n`).
5. **Возврат результата**: Функция возвращает объединенную строку.

ASCII flowchart:

```
A: Инициализация списка строк
|
B: Ввод строки
|
C: EOFError?
|
D: Нет -> Добавление строки в список
|
E: Да -> Объединение строк в одну строку
|
F: Возврат объединенной строки
```

**Пример**:

```python
command = input_command()
print(command)
```

## Переменные

- `name` (str): Имя провайдера, введенное пользователем.
- `provider_path` (str): Путь к файлу провайдера, формируется на основе имени провайдера.
- `example` (str): Пример кода провайдера, используемый в запросе к GPT-4o для генерации кода.
- `command` (str): cURL-команда, введенная пользователем.
- `prompt` (str): Запрос, отправляемый в GPT-4o для генерации кода провайдера.
- `response` (str): Ответ от GPT-4o, содержащий сгенерированный код провайдера.
- `code` (str): Извлеченный код провайдера из ответа GPT-4o.

## Как работает модуль:

1. **Начало работы**:

   - Модуль начинается с импорта необходимых библиотек, включая `sys`, `re`, `pathlib` и `g4f`.
   - Добавляет путь к родительскому каталогу в `sys.path`, что позволяет импортировать модули из этого каталога.
   - Включает отладочное логирование для `g4f`.

2. **Определение функций**:

   - Определяются функции `read_code` и `input_command` для извлечения кода из текста и считывания многострочного ввода от пользователя соответственно.

3. **Ввод имени провайдера**:

   - Запрашивает у пользователя имя провайдера и сохраняет его в переменной `name`.
   - Формирует путь к файлу провайдера на основе введенного имени.

4. **Проверка существования файла**:

   - Проверяет, существует ли файл провайдера по указанному пути.

5. **Создание провайдера**:

   - Если файл не существует, выполняется следующий код:

     - Запрашивает у пользователя cURL-команду с помощью функции `input_command`.
     - Формирует запрос для GPT-4o, включающий cURL-команду, пример кода провайдера и имя провайдера.
     - Отправляет запрос в GPT-4o для генерации кода провайдера.
     - Извлекает код провайдера из ответа GPT-4o с помощью функции `read_code`.
     - Сохраняет извлеченный код в файл провайдера.
     - Добавляет строку импорта для нового провайдера в файл `g4f/Provider/__init__.py`.

6. **Чтение существующего файла**:

   - Если файл провайдера уже существует, выполняется следующий код:

     - Открывает файл провайдера и считывает его содержимое в переменную `code`.

ASCII flowchart:

```
A: Ввод имени провайдера
|
B: Проверка существования файла провайдера
|
C: Файл существует?
|
D: Нет -> Ввод cURL-команды
|
E: Формирование запроса для GPT-4o
|
F: Отправка запроса в GPT-4o
|
G: Извлечение кода провайдера
|
H: Сохранение кода в файл
|
I: Добавление импорта в __init__.py
|
J: Да -> Чтение содержимого файла
|
K: Завершение
# Клиент API xAI

## Обзор

Этот репозиторий содержит Python-клиент для взаимодействия с API xAI. Клиент разработан для упрощения процесса отправки запросов к API xAI, включая как стандартные, так и потоковые запросы.

## Возможности

-   **Аутентификация**: Безопасная аутентификация ваших запросов с использованием ключа API xAI.
-   **Завершение чата**: Генерация ответов от моделей xAI с использованием метода `chat_completion`.
-   **Потоковая передача ответов**: Потоковая передача ответов от моделей xAI с использованием метода `stream_chat_completion`.

## Установка

Для использования этого клиента вам необходимо установить Python на вашей системе. Вы можете установить необходимые зависимости с помощью pip:

```bash
pip install requests
```

## Использование

### Инициализация

Сначала инициализируйте класс `XAI` с вашим ключом API:

```python
from xai import XAI

api_key = "your_api_key_here"  # Замените на ваш реальный ключ API
xai = XAI(api_key)
```

### Завершение чата

Для генерации ответа от модели xAI используйте метод `chat_completion`:

```python
messages = [
    {
        "role": "system",
        "content": "You are Grok, a chatbot inspired by the Hitchhikers Guide to the Galaxy."
    },
    {
        "role": "user",
        "content": "What is the answer to life and universe?"
    }
]

completion_response = xai.chat_completion(messages)
print("Non-streaming response:", completion_response)
```

### Потоковая передача завершения чата

Для потоковой передачи ответов от модели xAI используйте метод `stream_chat_completion`:

```python
stream_response = xai.stream_chat_completion(messages)
print("Streaming response:")
for line in stream_response:
    if line.strip():
        print(json.loads(line))
```

## Пример

Вот полный пример использования клиента `XAI`:

```python
import json
from xai import XAI

api_key = "your_api_key_here"  # Замените на ваш реальный ключ API
xai = XAI(api_key)

messages = [
    {
        "role": "system",
        "content": "You are Grok, a chatbot inspired by the Hitchhikers Guide to the Galaxy."
    },
    {
        "role": "user",
        "content": "What is the answer to life and universe?"
    }
]

# Непотоковый запрос
completion_response = xai.chat_completion(messages)
print("Non-streaming response:", completion_response)

# Потоковый запрос
stream_response = xai.stream_chat_completion(messages)
print("Streaming response:")
for line in stream_response:
    if line.strip():
        print(json.loads(line))
```

## Вклад

Вклад приветствуется! Не стесняйтесь отправлять pull request или открывать issue, если вы столкнулись с какими-либо проблемами или имеете предложения по улучшению.

## Лицензия

Этот проект лицензирован под MIT License. Подробности смотрите в файле [LICENSE](../../LICENSE).

## Благодарности

-   Спасибо xAI за предоставление API, которое делает возможным работу этого клиента.
-   Вдохновлен необходимостью простого и эффективного способа взаимодействия с мощными моделями xAI.

---

Для получения дополнительной информации, пожалуйста, обратитесь к [документации API xAI](https://api.x.ai/docs).

## <алгоритм>

1.  **Инициализация клиента XAI**:
    *   Клиент `XAI` инициализируется с API-ключом.
    *   Пример: `xai = XAI(api_key)`, где `api_key` - это ключ, предоставленный xAI.
2.  **Формирование сообщения**:
    *   Создается список сообщений, каждое из которых представляет собой словарь с ключами "role" и "content".
    *   Первое сообщение обычно устанавливает роль (системное сообщение), а последующие сообщения - это запросы пользователя.
    *   Пример:
        ```python
        messages = [
            {"role": "system", "content": "You are Grok..."},
            {"role": "user", "content": "What is the answer..."}
        ]
        ```
3.  **Непотоковый запрос (chat_completion)**:
    *   Метод `chat_completion` класса `XAI` вызывается с сформированным списком сообщений.
    *   Метод отправляет запрос к API xAI и получает полный ответ.
    *   Ответ обрабатывается (в данном случае, просто выводится на экран).
    *   Пример: `completion_response = xai.chat_completion(messages)`
4.  **Потоковый запрос (stream_chat_completion)**:
    *   Метод `stream_chat_completion` класса `XAI` вызывается с тем же списком сообщений.
    *   Метод возвращает генератор, который выдает ответ частями по мере поступления.
    *   Полученные строки (lines) от генератора обрабатываются:
        *   Проверяется, является ли строка не пустой после удаления пробельных символов.
        *   Если строка не пустая, она парсится как JSON и выводится на экран.
    *   Пример:
        ```python
        stream_response = xai.stream_chat_completion(messages)
        for line in stream_response:
            if line.strip():
                print(json.loads(line))
        ```

## <mermaid>

```mermaid
graph LR
    A[Начало] --> B(Инициализация XAI клиента);
    B --> C{Формирование сообщений};
    C --> D{Вызов chat_completion()};
    D --> E[Получение полного ответа];
    E --> F{Обработка ответа};
    F --> G(Вывод полного ответа);
    C --> H{Вызов stream_chat_completion()};
    H --> I[Получение потокового генератора];
    I --> J{Итерация по строкам};
    J -- строка не пустая --> K{Парсинг JSON};
    K --> L(Вывод строки);
    J -- строка пустая --> J;
    L --> J;
    G --> M[Конец];
    J --> M;
```

## <объяснение>

**Импорты**:

*   `json`:
    *   Назначение:  Используется для работы с данными в формате JSON.
    *   Взаимосвязь:  Используется для парсинга потоковых ответов от API xAI, поскольку они могут приходить в формате JSON.

*   `xai`:
    *   Назначение:  Предполагается, что это пользовательский модуль, который содержит класс `XAI`, взаимодействующий с API xAI.
    *   Взаимосвязь:  Этот модуль является ядром данного клиента, предоставляя методы для отправки запросов и получения ответов.

**Классы**:

*   `XAI`:
    *   Роль:  Основной класс клиента для взаимодействия с API xAI.
    *   Атрибуты:
        *   `api_key`: Ключ API для аутентификации.
    *   Методы:
        *   `__init__(self, api_key)`: Инициализирует экземпляр класса `XAI` с предоставленным ключом API.
        *   `chat_completion(self, messages)`: Отправляет запрос на завершение чата и возвращает полный ответ.
        *   `stream_chat_completion(self, messages)`: Отправляет запрос на завершение чата и возвращает генератор для потоковой передачи ответов.
    *   Взаимодействие:  Используется для отправки запросов к API xAI и обработки ответов.

**Функции**:

*   `chat_completion(self, messages)`:
    *   Аргументы: `messages` - список словарей с сообщениями для чата.
    *   Возвращаемое значение:  Полный ответ от API xAI.
    *   Назначение:  Отправляет запрос к API xAI для генерации ответа на основе предоставленных сообщений.
    *   Пример: `xai.chat_completion(messages)`

*   `stream_chat_completion(self, messages)`:
    *   Аргументы: `messages` - список словарей с сообщениями для чата.
    *   Возвращаемое значение:  Генератор для потокового получения ответов от API xAI.
    *   Назначение:  Отправляет запрос к API xAI для генерации потокового ответа.
    *   Пример: `xai.stream_chat_completion(messages)`

**Переменные**:

*   `api_key`:
    *   Тип:  Строка.
    *   Использование:  Содержит API-ключ для аутентификации запросов к API xAI.
*   `messages`:
    *   Тип:  Список словарей.
    *   Использование:  Содержит сообщения для отправки в API xAI, где каждый словарь имеет ключи "role" и "content".
*   `xai`:
    *   Тип:  Экземпляр класса `XAI`.
    *   Использование:  Используется для вызова методов `chat_completion` и `stream_chat_completion`.
*   `completion_response`:
    *   Тип:  Строка или словарь.
    *   Использование:  Содержит полный ответ от API xAI, полученный через метод `chat_completion`.
*   `stream_response`:
    *   Тип:  Генератор.
    *   Использование:  Генератор, предоставляющий потоковый ответ от API xAI, полученный через метод `stream_chat_completion`.
*   `line`:
    *   Тип: Строка.
    *   Использование: Переменная итерации, которая представляет одну строку потокового ответа.

**Потенциальные ошибки или области для улучшения**:

*   **Обработка ошибок**: Не хватает обработки ошибок при запросах к API xAI. Необходимо добавить try-except блоки для обработки возможных исключений.
*   **Гибкость сообщений**: Модель сообщений  достаточно простая, для более сложного использования необходимо предусмотреть другие параметры.
*   **Параметры запросов**:  Отсутствует возможность настройки параметров API, таких как температура, количество токенов и т.д. Необходимо добавить возможность передачи этих параметров через API.
*   **Конфиденциальность API-ключа**: Хранение API-ключа непосредственно в коде может привести к утечке данных. Необходимо рассмотреть возможность хранения ключа в переменных окружения или в другом более безопасном месте.

**Цепочка взаимосвязей**:

1.  Клиент `XAI` (определенный в модуле `xai`) создает абстракцию над API xAI.
2.  Основной код использует класс `XAI` для отправки запросов к API xAI.
3.  Используются методы `chat_completion` (непотоковый) и `stream_chat_completion` (потоковый) класса `XAI`.
4.  Ответы, полученные от API, обрабатываются, включая парсинг JSON для потоковых ответов.

Таким образом, этот клиент представляет собой простой, но функциональный способ взаимодействия с API xAI, обеспечивая как стандартные запросы, так и потоковую передачу ответов.
# Модуль `test_utils`

## Обзор

Данный модуль содержит тесты для функций `name_or_empty`, `extract_json` и `repeat_on_error` из модуля `tinytroupe.utils`. Тесты проверяют корректность работы этих функций в различных сценариях, включая обработку JSON-строк, работу с именованными сущностями, повторные попытки выполнения функций и работу с исключениями.


## Функции

### `test_extract_json`

**Описание**: Функция тестирует функцию `extract_json` из модуля `tinytroupe.utils`. Проверяет извлечение JSON-данных из строки в различных случаях: корректные JSON-строки, JSON-массивы, экранированные символы, некорректные JSON-строки и отсутствие JSON-данных в строке.

**Тестируемые случаи**:

- Строка с корректным JSON-объектом.
- Строка с корректным JSON-массивом.
- Строка с экранированными символами в JSON-объекте.
- Строка с некорректным JSON-объектом.
- Строка без JSON-данных.


**Ассерты**: Проверяет, что функция возвращает корректные JSON-данные для корректных JSON-строк и пустой словарь для других случаев.


### `test_name_or_empty`

**Описание**: Функция тестирует функцию `name_or_empty` из модуля `tinytroupe.utils`. Проверяет, что функция возвращает имя сущности, если она есть, и пустую строку, если сущность равна `None`.

**Тестируемые случаи**:

- Сущность с именем.
- `None` в качестве аргумента.


**Ассерты**: Проверяет, что функция возвращает ожидаемое значение (имя сущности или пустую строку) в зависимости от входного параметра.


### `test_repeat_on_error`

**Описание**: Функция тестирует декоратор `repeat_on_error` из модуля `tinytroupe.utils`. Проверяет, что функция выполняется несколько раз, если возникает указанное исключение, и что она выполняется только один раз, если исключение не происходит. Также проверяет, что функция не выполняется несколько раз, если возникло исключение, не указанное в списке исключений.

**Тестируемые случаи**:

- Функция вызывается несколько раз с указанным исключением.
- Функция вызывается без исключения.
- Функция вызывается с исключением, не указанным в списке исключений.


**Ассерты**: Проверяет, что функция вызывается заданное количество раз при возникновении исключения и один раз при успешном выполнении. Также проверяет, что при исключении, не указанном в списке исключений, функция выполняется только один раз. Использование `pytest.raises` для проверки ожидаемого исключения.


**Замечания**:  В тесте `test_repeat_on_error` используется `MagicMock` для имитации поведения функции, которую декорирует `repeat_on_error`. Это позволяет отследить количество вызовов функции.
# Модуль `src.suppliers.ksp.graber`

## Обзор

Модуль предназначен для сбора значений полей на странице товара веб-сайта `ksp.co.il`. Он содержит класс `Graber`, который наследуется от родительского класса `Graber` (который, в свою очередь, обозначен как `Grbr`) и переопределяет некоторые методы для нестандартной обработки данных, специфичной для данного поставщика. Модуль также включает функциональность для выполнения предварительных действий перед отправкой запроса к веб-драйверу с использованием декораторов.

## Подробней

Этот модуль является частью системы для автоматизированного сбора данных о товарах с веб-сайтов поставщиков. Он специализируется на сборе данных с сайта `ksp.co.il`. Для каждого поля товара на странице реализована функция обработки, при этом нестандартные случаи обрабатываются путем перегрузки функций из родительского класса.

Модуль также предоставляет возможность выполнения предварительных действий перед запросом к веб-драйверу, используя декораторы. Это позволяет, например, закрывать всплывающие окна или выполнять другие подготовительные действия.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для сбора информации о товарах с сайта `ksp.co.il`. Он наследуется от класса `Graber` (обозначенного как `Grbr`) из модуля `src.suppliers.graber` и адаптирует его функциональность для специфических требований `ksp.co.il`.

**Как работает класс**:

1.  **Инициализация**: При создании экземпляра класса устанавливается префикс поставщика (`supplier_prefix`) как `'ksp'`. Происходит инициализация родительского класса `Graber` с указанием префикса, веб-драйвера и индекса языка.
2.  **Адаптация к мобильной версии**: Проверяется, является ли текущий URL веб-драйвера мобильной версией сайта. Если это так, загружаются локаторы элементов для мобильной версии сайта из файла `product_mobile_site.json`.
3.  **Декораторы**: Подготавливается контекст для использования декораторов, которые могут выполнять предварительные действия перед сбором данных.

**Методы**:

-   `__init__(self, driver: 'Driver', lang_index: int)`: Инициализирует экземпляр класса `Graber`.

    **Параметры**:

    -   `driver` ('Driver'): Экземпляр веб-драйвера для взаимодействия с сайтом.
    -   `lang_index` (int): Индекс языка, используемого на сайте.

    **Как работает функция**:

    1.  Устанавливает атрибут `supplier_prefix` в значение `'ksp'`.
    2.  Вызывает конструктор родительского класса `Grbr` с указанием `supplier_prefix`, `driver` и `lang_index`.
    3.  Приостанавливает выполнение на 3 секунды для обеспечения загрузки страницы.
    4.  Проверяет, содержит ли текущий URL драйвера подстроку `/mob/`, что указывает на мобильную версию сайта.
    5.  Если обнаружена мобильная версия, загружает соответствующие локаторы из файла `product_mobile_site.json` и устанавливает их.
    6.  Инициализирует `Context.locator_for_decorator` в значение `None`, что позволяет использовать декораторы для выполнения предварительных действий.

    **Примеры**:

    ```python
    from src.webdriver.driver import Driver  # Предполагается, что класс Driver существует

    # Пример создания экземпляра класса Graber
    driver = Driver()  # Создание экземпляра веб-драйвера
    lang_index = 0  # Индекс языка
    graber = Graber(driver, lang_index)
    ```

## Функции

### `close_pop_up`

```python
def close_pop_up(value: Any = None) -> Callable:
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```

**Описание**: Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

**Как работает функция**:

1.  Функция `close_pop_up` принимает произвольное значение `value` в качестве аргумента.
2.  Она определяет и возвращает декоратор, который оборачивает другую функцию (`func`).
3.  Внутри декоратора определяется обертка `wrapper`, которая выполняет следующие действия:
    *   Пытается выполнить локатор `Context.locator.close_pop_up` для закрытия всплывающего окна.
    *   Перехватывает исключение `ExecuteLocatorException` в случае ошибки выполнения локатора и логирует отладочное сообщение.
    *   Вызывает обернутую функцию `func` с переданными аргументами и возвращает результат ее выполнения.

**Параметры**:

-   `value` (Any, optional): Дополнительное значение, которое может быть использовано декоратором. По умолчанию `None`.

**Возвращает**:

-   `Callable`: Декоратор, который можно использовать для оборачивания функций.

**Примеры**:

```python
from typing import Callable, Any
from functools import wraps

class Context:
    driver = None
    locator = None

class ExecuteLocatorException(Exception):
    pass

# Пример использования декоратора
@close_pop_up()
async def my_function():
    """
    Пример функции, обернутой декоратором close_pop_up.
    """
    print("Выполнение основной логики функции")
    return True

# Пример вызова функции
# result = my_function()
# print(f"Результат выполнения функции: {result}")
```
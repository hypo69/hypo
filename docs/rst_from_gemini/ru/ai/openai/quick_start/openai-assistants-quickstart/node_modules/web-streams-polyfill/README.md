## web-streams-polyfill

Библиотека `web-streams-polyfill` предоставляет полифиллы для потоков Web Streams, основанных на эталонной реализации спецификации WHATWG.

[![Статус сборки](https://api.travis-ci.com/MattiasBuelens/web-streams-polyfill.svg?branch=master)](https://travis-ci.com/MattiasBuelens/web-streams-polyfill)
[![Версия npm](https://img.shields.io/npm/v/web-streams-polyfill.svg)](https://www.npmjs.com/package/web-streams-polyfill)
[![Лицензия](https://img.shields.io/npm/l/web-streams-polyfill.svg)](https://github.com/MattiasBuelens/web-streams-polyfill/blob/master/LICENSE)

## Ссылки

 - [Официальная спецификация][spec]
 - [Реализация-эталон][ref-impl]

## Использование

Библиотека доступна в нескольких вариантах:
* `web-streams-polyfill`: полифилл, заменяющий родные реализации потоков.
  Рекомендуется для использования в веб-приложениях, поддерживающих старые браузеры, через тег `<script>`.
* `web-streams-polyfill/es6`: полифилл, нацеленный на среды ES2015+.
  Рекомендуется для использования в веб-приложениях, поддерживающих современные браузеры, через тег `<script>`.
* `web-streams-polyfill/es2018`: полифилл, нацеленный на среды ES2018+.
* `web-streams-polyfill/ponyfill`: [понифилл], предоставляющий реализации потоков без замены глобальных объектов.
  Рекомендуется для использования в устаревших приложениях Node.js или в веб-библиотеках, поддерживающих старые браузеры.
* `web-streams-polyfill/ponyfill/es6`: понифилл, нацеленный на среды ES2015+.
  Рекомендуется для использования в приложениях Node.js 6+ или в веб-библиотеках, поддерживающих современные браузеры.
* `web-streams-polyfill/ponyfill/es2018`: понифилл, нацеленный на среды ES2018+.
  Рекомендуется для использования в приложениях Node.js 10+ (и выше).

Каждый вариант также включает определения типов TypeScript, совместимые с определениями типов DOM для потоков, включенными в TypeScript.

### Использование в качестве полифилла:
```html
<!-- вариант 1: размещение на CDN unpkg -->
<script src="https://unpkg.com/web-streams-polyfill/dist/polyfill.min.js"></script>
<!-- вариант 2: самохостинг -->
<script src="/path/to/web-streams-polyfill/dist/polyfill.min.js"></script>
<script>
  const readable = new ReadableStream();
</script>
```
### Использование как модуля Node.js:
```javascript
const streams = require("web-streams-polyfill/ponyfill");
const readable = new streams.ReadableStream();
```
### Использование как модуля ES2015:
```javascript
import { ReadableStream } from "web-streams-polyfill/ponyfill";
const readable = new ReadableStream();
```

## Совместимость

Варианты `polyfill` и `ponyfill` работают в любой ES5-совместимой среде, имеющей глобальный объект `Promise`.
Если вам необходимо поддерживать старые браузеры или версии Node.js, которые не имеют собственной реализации `Promise` (проверьте [таблицу совместимости][promise-support]), вы должны сначала включить полифилл для `Promise` (например, [promise-polyfill][promise-polyfill]).

Варианты `polyfill/es6` и `ponyfill/es6` работают в любой ES2015-совместимой среде.

Варианты `polyfill/es2018` и `ponyfill/es2018` работают в любой ES2018-совместимой среде.

Поддержка асинхронных итерируемых объектов (`ReadableStream`) в вариантах доступна во всех вариантах, но требует ES2018-совместимой среды или полифилла для `Symbol.asyncIterator`.

[`WritableStreamDefaultController.signal`][ws-controller-signal] доступен во всех вариантах, но требует наличие глобального конструктора `AbortController`. Если необходимо, рассмотрите использование полифилла, такого как [abortcontroller-polyfill].

[Чтение с помощью BYOB ридера][mdn-byob-read] доступно во всех вариантах, но требует, чтобы `ArrayBuffer.prototype.transfer()` или `structuredClone()` существовали, чтобы правильно передать буфер данного вида. Если они недоступны, буфер не будет передан во время чтения.

## Соответствие

Полифилл реализует [версию `4dc123a` (13 ноября 2023)][spec-snapshot] спецификации потоков.

Полифилл тестируется с теми же [тестами веб-платформы][wpt], что и родные реализации браузеров.
Полифилл стремится пройти все тесты, хотя допускает некоторые исключения по практическим соображениям:
* Вариант `es2018` проходит все тесты.
* Вариант `es6` проходит те же тесты, что и `es2018`, за исключением [теста прототипа асинхронного итератора `ReadableStream`][wpt-async-iterator-prototype].
  Получение правильного `%AsyncIteratorPrototype%` требует использования асинхронного генератора (`async function* () {}`), что недопустимо до ES2018.
  Вместо этого полифилл [создаёт свою версию][stub-async-iterator-prototype], функционально эквивалентную реальному прототипу.
* Вариант `es5` проходит те же тесты, что и `es6`, за исключением различных тестов, касающихся специфических характеристик конструкторов, свойств и методов.
  Эти сбои в тестах не влияют на поведение полифилла во время выполнения.

Определения типов совместимы с встроенными типами потоков TypeScript 3.3.


## Авторы

Благодарим этих людей за их вклад в [первоначальный полифилл][creatorrr-polyfill]:

 - Diwank Singh Tomer ([creatorrr](https://github.com/creatorrr))
 - Anders Riutta ([ariutta](https://github.com/ariutta))


[spec]: https://streams.spec.whatwg.org
[ref-impl]: https://github.com/whatwg/streams
[ponyfill]: https://github.com/sindresorhus/ponyfill
[promise-support]: https://kangax.github.io/compat-table/es6/#test-Promise
[promise-polyfill]: https://www.npmjs.com/package/promise-polyfill
[ws-controller-signal]: https://streams.spec.whatwg.org/#ws-default-controller-signal
[abortcontroller-polyfill]: https://www.npmjs.com/package/abortcontroller-polyfill
[mdn-byob-read]: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStreamBYOBReader/read
[spec-snapshot]: https://streams.spec.whatwg.org/commit-snapshots/4dc123a6e7f7ba89a8c6a7975b021156f39cab52/
[wpt]: https://github.com/web-platform-tests/wpt/tree/2a298b616b7c865917d7198a287310881cbfdd8d/streams
[wpt-async-iterator-prototype]: https://github.com/web-platform-tests/wpt/blob/2a298b616b7c865917d7198a287310881cbfdd8d/streams/readable-streams/async-iterator.any.js#L24
[stub-async-iterator-prototype]: https://github.com/MattiasBuelens/web-streams-polyfill/blob/v2.0.0/src/target/es5/stub/async-iterator-prototype.ts
[creatorrr-polyfill]: https://github.com/creatorrr/web-streams-polyfill

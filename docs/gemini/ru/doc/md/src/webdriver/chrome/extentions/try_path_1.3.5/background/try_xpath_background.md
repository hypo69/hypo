# Модуль `try_xpath_background.js`

## Обзор

Данный модуль (`try_xpath_background.js`) отвечает за обработку сообщений, полученных от вкладок, и управление состоянием всплывающего окна расширения.  Он взаимодействует с хранилищем настроек, загружает CSS, управляет отображением результатов поиска XPath.

## Переменные

### `tx`

**Описание**: псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Текущее состояние всплывающего окна.

### `popupCss`

**Описание**: CSS-стили для всплывающего окна.

### `results`

**Описание**: Результаты поиска XPath, полученные от вкладки.

### `css`

**Описание**: CSS-стили для отображения в вкладках.

### `attributes`

**Описание**: Словарь атрибутов, используемых для поиска элементов.


## Функции

### `loadDefaultCss()`

**Описание**: Загружает CSS-стили по умолчанию из файла `/css/try_xpath_insert.css`.

**Возвращает**: Promise, содержащий текст загруженного CSS.

**Вызывает исключения**:  Исключения, возникающие при запросе или обработке данных.


### `genericListener(message, sender, sendResponse)`

**Описание**: Обработчик сообщений для `browser.runtime.onMessage`.

**Параметры**:
* `message` (объект): Сообщение, полученное от вкладки.
* `sender` (объект): Объект, отправляющий сообщение.
* `sendResponse` (функция): Функция для отправки ответа в вкладку.


**Возвращает**: `undefined`

**Вызывает исключения**:  Возможны исключения, возникающие внутри функций, вызываемых обработчиком.


### `genericListener.listeners.storePopupState(message)`

**Описание**: Сохраняет состояние всплывающего окна.

**Параметры**:
* `message` (объект): Сообщение с состоянием всплывающего окна.

**Возвращает**: `undefined`


### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Отправляет сообщение в расширение для восстановления состояния всплывающего окна.

**Параметры**:
* `message` (объект): Сообщение для запроса восстановления.


**Возвращает**: `undefined`


### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Отправляет сообщение в расширение для вставки CSS-стилей во всплывающее окно.

**Возвращает**: `undefined`


### `genericListener.listeners.showAllResults(message, sender)`

**Описание**: Создает новую вкладку для отображения результатов поиска.

**Параметры**:
* `message` (объект): Сообщение с результатами.
* `sender` (объект): Отправитель сообщения.

**Возвращает**: `undefined`


### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Отправляет результаты поиска XPath в вкладку.

**Параметры**:
* `message` (объект): Сообщение.
* `sender` (объект): Объект, отправивший запрос.
* `sendResponse` (функция): Функция для отправки ответа.

**Возвращает**: `true`


### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Вставляет или удаляет CSS в вкладке.

**Параметры**:
* `message` (объект): Сообщение с CSS для вставки или удаления.
* `sender` (объект): Объект, отправивший запрос.

**Возвращает**: `undefined`

**Вызывает исключения**: `fu.onError`


### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Возвращает информацию о CSS и атрибутах.

**Параметры**:
* `message` (объект): Сообщение.
* `sender` (объект): Объект, отправивший запрос.
* `sendResponse` (функция): Функция для отправки ответа.

**Возвращает**: `true`

**Возвращает данные**: Объект с атрибутами, CSS и `popupCss`.


### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Отправляет сообщение в вкладку для установки информации об атрибутах.

**Параметры**:
* `message` (объект): Сообщение.
* `sender` (объект): Объект, отправивший запрос.

**Возвращает**: `undefined`


## Обработчики изменений хранилища

### `browser.storage.onChanged.addListener(changes)`

**Описание**: Обработчик изменений в хранилище настроек.  Обновляет локальные переменные `attributes`, `css` и `popupCss` при изменении настроек.

**Параметры**:
* `changes` (объект): Объект, содержащий информацию о произошедших изменениях.

**Возвращает**: `undefined`


## Загрузка настроек из хранилища

### `browser.storage.sync.get(...)`

**Описание**: Загружает настройки из синхронного хранилища.

**Параметры**:
* Словарь настроек, которые нужно загрузить.

**Возвращает**: Promise, содержащий загруженные настройки.


**Вызывает исключения**: `fu.onError`.
# ИНСТРУКЦИЯ ПО ДОКУМЕНТИРОВАНИЮ

## Введение

Этот документ описывает формат документации для файлов Python, используемый для улучшения кода. Документация должна быть написана в формате reStructuredText (RST) и соответствовать стандартам Sphinx.

## Требования

1. **Формат документации (RST):**  Используйте reStructuredText (RST) для всех комментариев и docstring.  Всегда используйте одинарные кавычки (`'`) в Python-коде.

2. **Сохранение комментариев:** Все существующие комментарии после символа `#` должны быть сохранены без изменений.  Блоки кода, требующие изменений, должны быть прокомментированы построчно с помощью символа `#`.

3. **Обработка данных:** Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load` для чтения файлов. Оставьте любые `...` в коде без изменений как точки остановки.

4. **Анализ структуры:** Проверьте и добавьте отсутствующие импорты в код. Убедитесь, что имена функций, переменных и импортов соответствуют ранее обработанным файлам.

5. **Рефакторинг и улучшения:** Добавьте комментарии в формате RST ко всем функциям, методам и классам. Используйте `from src.logger import logger` для ведения журнала ошибок. Избегайте чрезмерного использования стандартных блоков `try-except`; предпочитайте обработку ошибок с использованием `logger.error`. В комментариях избегайте расплывчатых слов, таких как 'получить' или 'сделать'. Вместо этого используйте конкретные термины, такие как 'валидация', 'выполнение' или 'отправка'.

6. **Шаблон ответа:** Ответ должен содержать три раздела:
    - **Полученный код** — исходный код без изменений.
    - **Улучшенный код** — код с добавленными комментариями и исправлениями.
    - **Внесённые изменения** — подробный список внесённых изменений.
    - **Полный код** — полный код со всеми улучшениями.

7. **Конечный код:** Последний раздел ответа должен содержать полный код (исходный код с улучшениями) в одном блоке, готовом к копированию и вставке в качестве замены исходного кода. Все изменённые части кода должны быть прокомментированы построчно с помощью символа `#` в этом блоке.

8. **Примеры кода:** Включите примеры документации RST и потенциальных улучшений в формате `TODO`.

9. **Дополнительные инструкции:** Перепишите все комментарии для модулей, функций, методов и переменных в формате RST. Это включает:
    - Описание модуля в начале файла.
    - Документацию для каждой функции, метода и переменной.
    - Соблюдение стандартов Python docstring (например, стиль Sphinx).
    - Строки, прокомментированные с помощью `#`, должны предоставлять подробное объяснение блока кода, которому они предшествуют.

## Пример документации модуля (RST)

```python
"""
Модуль для функциональности помощника программиста
=========================================================================================

Этот модуль содержит класс :class:`CodeAssistant`, который работает с различными AI-моделями,
такими как Google Gemini и OpenAI, для обработки задач по обработке кода.

Пример использования
--------------------

Пример использования класса `CodeAssistant`:

.. code-block:: python

    assistant = CodeAssistant(role='code_checker', lang='en', model=['gemini'])
    assistant.process_files()
"""
```

## Пример документации функции (RST)

```python
def example_function(param1: str, param2: int) -> str:
    """
    Выполняет примерную задачу.

    :param param1: Описание параметра 1.
    :param param2: Описание параметра 2.
    :return: Описание возвращаемого значения.
    """
    ...
```

## Пример комментариев в коде (RST)

```python
@close_pop_up()
async def specification(self, value: Any = None):
    """
    Получить и установить спецификацию.

    Args:
        value (Any): Это значение может быть передано в словаре kwargs под ключом `{specification = value}`
        при определении класса. Если `value` предоставлено, его значение устанавливается в поле `ProductFields.specification`.
    """
    try:
        # Получение значения с использованием execute_locator
        value = value or await self.d.execute_locator(self.l.specification) or ''
    except Exception as ex:
        logger.error('Ошибка при получении значения для поля `specification`', ex)
        ...
        return

    # Валидация полученного результата
    if not value:
        logger.debug(f'Недопустимый результат {value=}\nЛокатор {self.l.specification}')
        ...
        return

    # Если значение является списком, код преобразует его в строку, разделенную `\n`
    if isinstance(value, list):
        value = '\n'.join(map(str, value))

    # Запись результата в поле `specification` объекта `ProductFields`
    self.fields.specification = value
    return True
```

## Ожидаемый формат ответа

Ответ должен содержать исходный код, улучшенный код, список изменений и оптимизированный код (полный код с улучшениями).
```
# Анализ кода модуля нормализации данных

## 1. <алгоритм>

### Общий рабочий процесс модуля

1.  **Инициализация**: Модуль `normalizer` импортируется для использования функций нормализации.
2.  **Выбор функции**: Выбирается одна из функций `normalize_boolean`, `normalize_string`, `normalize_int`, `normalize_float`, `remove_line_breaks`, `remove_html_tags`, `remove_special_characters` или `normalize_sql_date` в зависимости от типа данных, которые нужно нормализовать.
3.  **Нормализация**:
    *   **`normalize_boolean`**:
        *   Принимает входные данные (`input_data`).
        *   Проверяет `input_data` на соответствие истинному или ложному значению (например, "yes", "no", 0, 1).
        *   Возвращает `True` или `False`.
    *   **`normalize_string`**:
        *   Принимает строку или список строк (`input_data`).
        *   Если входные данные являются списком, объединяет строки в одну.
        *   Удаляет HTML-теги (с помощью `remove_html_tags`).
        *   Удаляет специальные символы (с помощью `remove_special_characters`).
        *   Удаляет лишние пробелы.
        *   Возвращает очищенную строку.
    *   **`normalize_int`**:
        *   Принимает число или строку, представляющую число (`input_data`).
        *   Преобразует в целое число (`int`).
        *   Возвращает целое число.
    *   **`normalize_float`**:
        *   Принимает число, строку или список чисел (`value`).
        *   Если входные данные - список,  проходит по списку, преобразуя каждый элемент в `float`.
        *   Возвращает число с плавающей точкой, список таких чисел или `None` в случае ошибки.
    *   **`remove_line_breaks`**:
        *   Принимает строку (`input_str`).
        *   Удаляет символы новой строки.
        *   Возвращает строку без символов новой строки.
    *   **`remove_html_tags`**:
        *   Принимает строку с HTML (`input_html`).
        *   Удаляет HTML-теги.
        *   Возвращает строку без HTML-тегов.
    *   **`remove_special_characters`**:
        *   Принимает строку или список строк (`input_str`).
        *   Удаляет специальные символы.
        *   Возвращает очищенную строку или список строк.
    *   **`normalize_sql_date`**:
        *   Принимает строку или объект `datetime` (`input_data`).
        *   Преобразует в строку формата `YYYY-MM-DD`.
        *   Возвращает строку даты в формате `YYYY-MM-DD`.
4.  **Логирование**: В случае ошибок или неожиданных значений, используется логгер (`logger.error`, `logger.debug` или `logger.warning`).
5.  **Возврат результата**: Возвращается нормализованное значение.

### Примеры для каждого логического блока:

*   **`normalize_boolean`**:
    *   Ввод: `"yes"`  ->  Вывод: `True`
    *   Ввод: `0`      ->  Вывод: `False`
    *   Ввод: `"false"` ->  Вывод: `False`

*   **`normalize_string`**:
    *   Ввод: `['  text  ', '<b>html</b>']` ->  Вывод: `"text html"`
    *   Ввод: `"  text with   spaces  "` ->  Вывод: `"text with spaces"`

*  **`normalize_int`**:
     *   Ввод: `"42"` -> Вывод: `42`
     *   Ввод: `3.14` -> Вывод: `3`

*   **`normalize_float`**:
    *   Ввод: `"3.14"` -> Вывод: `3.14`
    *   Ввод: `[1, "2.5", 3]` -> Вывод: `[1.0, 2.5, 3.0]`
    *   Ввод: `None` -> Вывод: `None`

*   **`remove_line_breaks`**:
    *   Ввод: `"text\nwith\rbreaks"` -> Вывод: `"textwithbreaks"`

*   **`remove_html_tags`**:
    *   Ввод: `"<h1>text</h1>"` -> Вывод: `"text"`

*   **`remove_special_characters`**:
    *   Ввод: `"Hello@World!"` -> Вывод: `"HelloWorld"`
    *   Ввод: `["Hello@!", "World#"]` -> Вывод: `["Hello", "World"]`

*   **`normalize_sql_date`**:
    *   Ввод: `"2024-12-06"` -> Вывод: `"2024-12-06"`
    *   Ввод: `datetime(2024, 12, 6)` -> Вывод: `"2024-12-06"`

### Поток данных

```mermaid
graph LR
    A[Начало] --> B{Выбор функции нормализации};
    B -- normalize_boolean --> C[normalize_boolean(input_data)];
    B -- normalize_string --> D[normalize_string(input_data)];
    B -- normalize_int --> E[normalize_int(input_data)];
    B -- normalize_float --> F[normalize_float(input_data)];
    B -- remove_line_breaks --> G[remove_line_breaks(input_str)];
    B -- remove_html_tags --> H[remove_html_tags(input_html)];
    B -- remove_special_characters --> I[remove_special_characters(input_str)];
    B -- normalize_sql_date --> J[normalize_sql_date(input_data)];
    C --> K[Возврат bool];
    D --> L[Возврат str];
    E --> M[Возврат int];
    F --> N[Возврат float | List[float] | None];
    G --> O[Возврат str];
    H --> P[Возврат str];
    I --> Q[Возврат str | list];
    J --> R[Возврат str];
     K --> S[Логирование ошибок];
    L --> S;
    M --> S;
    N --> S;
    O --> S;
    P --> S;
    Q --> S;
    R --> S;
    S --> T[Конец];
```

## 2. <mermaid>

```mermaid
graph LR
    A[Начало] --> B{Выбор функции нормализации};
    B -- normalize_boolean --> C[normalize_boolean(input_data: Any)];
    B -- normalize_string --> D[normalize_string(input_data: str | list)];
     D --> D1[remove_html_tags(input_html:str)]
      D --> D2[remove_special_characters(input_str: str | list)]
    B -- normalize_int --> E[normalize_int(input_data: str | int | float | Decimal)];
    B -- normalize_float --> F[normalize_float(value: Any)];
    B -- remove_line_breaks --> G[remove_line_breaks(input_str: str)];
    B -- remove_html_tags --> H[remove_html_tags(input_html: str)];
    B -- remove_special_characters --> I[remove_special_characters(input_str: str | list)];
    B -- normalize_sql_date --> J[normalize_sql_date(input_data: str | datetime)];
    C --> K[Возврат bool];
    D --> L[Возврат str];
    E --> M[Возврат int];
    F --> N[Возврат float | List[float] | None];
    G --> O[Возврат str];
    H --> P[Возврат str];
    I --> Q[Возврат str | list];
    J --> R[Возврат str];
    K --> S[Логирование ошибок];
    L --> S;
    M --> S;
    N --> S;
    O --> S;
    P --> S;
    Q --> S;
    R --> S;
    S --> T[Конец];
    style S fill:#f9f,stroke:#333,stroke-width:2px
```

### Описание зависимостей `mermaid`:

*   **Начало**: Начальная точка процесса.
*   **Выбор функции нормализации**: Условный блок, определяющий, какую функцию нормализации вызвать.
*   **Функции нормализации**:
    *   `normalize_boolean`: Принимает произвольный ввод и возвращает булево значение.
    *   `normalize_string`: Принимает строку или список строк и возвращает очищенную строку.
        *   Вызывает  `remove_html_tags`: для удаления HTML тегов из строки.
        *   Вызывает `remove_special_characters`: для удаления специальных символов из строки.
    *   `normalize_int`: Принимает строку, целое число, число с плавающей точкой или Decimal и возвращает целое число.
    *   `normalize_float`: Принимает число, строку или список чисел и возвращает число с плавающей точкой, список таких чисел или `None`.
    *   `remove_line_breaks`: Принимает строку и возвращает строку без символов новой строки.
    *   `remove_html_tags`: Принимает строку с HTML-тегами и возвращает строку без них.
    *   `remove_special_characters`: Принимает строку или список строк и возвращает строку или список строк без специальных символов.
    *   `normalize_sql_date`: Принимает строку или объект datetime и возвращает строку в формате `YYYY-MM-DD`.
*   **Логирование ошибок**: Общий блок, который обрабатывает логирование ошибок, предупреждений и отладочную информацию.
*   **Конец**: Конечная точка процесса.
    *   **Зависимости** между функциями:
       * `normalize_string` вызывает `remove_html_tags` и `remove_special_characters`
*   **Типы данных**: В диаграмме показаны типы данных, которые принимают и возвращают функции. Это улучшает понимание назначения каждой функции.

## 3. <объяснение>

### Импорты

В данном модуле не используется явных импортов, что предполагает, что все необходимые функции либо определены в текущем файле, либо импортируются в другом месте и являются частью окружения. Однако, исходя из описания, предполагается использование:

*   **`src.logger`**: Для логирования ошибок и предупреждений. Этот модуль, вероятно, предоставляет функциональность для записи сообщений в лог-файлы, что является важным в режиме разработки (`MODE = 'dev'`).

### Функции

#### `normalize_boolean`

*   **Аргументы**:
    *   `input_data` (`Any`): Любые данные, которые нужно преобразовать в булево значение.
*   **Возвращает**:
    *   `bool`: Преобразованное булево значение (`True` или `False`).
*   **Назначение**: Принимает различные типы данных и приводит их к булеву значению. Например, строки "yes", "true", число `1` преобразуются в `True`, а "no", "false", `0` в `False`.
*   **Пример**: `normalize_boolean('yes')` вернет `True`, `normalize_boolean(0)` вернет `False`.

#### `normalize_string`

*   **Аргументы**:
    *   `input_data` (`str | list`): Строка или список строк.
*   **Возвращает**:
    *   `str`: Очищенная строка в кодировке UTF-8.
*   **Назначение**: Преобразует входную строку или список строк, удаляя лишние пробелы, HTML-теги и специальные символы, в единую нормализованную строку.
*   **Пример**: `normalize_string(['  Example string  ', '<b>with HTML</b>'])` вернет `'Example string with HTML'`.

#### `normalize_int`

*   **Аргументы**:
    *   `input_data` (`str | int | float | Decimal`): Число или его строковое представление.
*   **Возвращает**:
    *   `int`: Преобразованное целое число.
*   **Назначение**: Преобразует различные числовые представления в целое число.
*   **Пример**: `normalize_int('42')` вернет `42`, `normalize_int(3.14)` вернет `3`.

#### `normalize_float`

*   **Аргументы**:
    *   `value` (`Any`): Число, строка или список чисел.
*   **Возвращает**:
    *   `float | List[float] | None`: Число с плавающей запятой, список чисел с плавающей запятой или `None` в случае ошибки.
*   **Назначение**: Преобразует входное значение в число с плавающей точкой. Поддерживает преобразование списка чисел в список чисел с плавающей точкой.
*  **Пример:** `normalize_float('3.14')` вернет `3.14`, `normalize_float([1, '2.5', 3])` вернет `[1.0, 2.5, 3.0]`, `normalize_float(None)` вернет `None`.

#### `remove_line_breaks`

*   **Аргументы**:
    *   `input_str` (`str`): Входная строка.
*   **Возвращает**:
    *   `str`: Строка без символов новой строки.
*   **Назначение**: Удаляет символы новой строки из строки.
*   **Пример**: `remove_line_breaks('String\\nwith line breaks\\r')` вернет `'String with line breaks'`.

#### `remove_html_tags`

*   **Аргументы**:
    *   `input_html` (`str`): Входная строка с HTML тегами.
*   **Возвращает**:
    *   `str`: Строка без HTML тегов.
*   **Назначение**: Удаляет HTML теги из входной строки.
*   **Пример**: `remove_html_tags('<p>Example text</p>')` вернет `'Example text'`.

#### `remove_special_characters`

*   **Аргументы**:
    *   `input_str` (`str | list`): Строка или список строк.
*   **Возвращает**:
    *   `str | list`: Строка или список строк без специальных символов.
*   **Назначение**: Удаляет специальные символы из строки или списка строк.
*   **Пример**: `remove_special_characters('Hello@World!')` вернет `'HelloWorld'`.

#### `normalize_sql_date`

*   **Аргументы**:
    *   `input_data` (`str | datetime`): Строка или объект `datetime`, представляющий дату.
*   **Возвращает**:
    *   `str`: Нормализованная дата в формате строки `YYYY-MM-DD`.
*   **Назначение**: Преобразует строку или объект datetime в стандартный формат SQL даты (`YYYY-MM-DD`).
*   **Пример**: `normalize_sql_date('2024-12-06')` вернет `'2024-12-06'`, `normalize_sql_date(datetime(2024, 12, 6))` вернет `'2024-12-06'`.

### Переменные

В данном коде, переменные используются в качестве параметров функций, и их типы аннотированы в описании функций.

### Потенциальные ошибки и улучшения

*   **Обработка ошибок**: Модуль должен содержать более детальную обработку ошибок, включая проверку типов и форматов входных данных. При возникновении ошибки (например, некорректный формат ввода) функция может не только логировать ошибку, но и возвращать `None` или выбрасывать исключение.
*   **Логирование**: Следует более четко определить, какие типы сообщений следует логировать как `debug`, `warning` и `error`.
*   **Производительность**: Для обработки больших массивов данных, стоит рассмотреть оптимизацию, например,  использовать компиляцию регулярных выражений для `remove_html_tags` или `remove_special_characters`.
*  **Консистентность**: Необходимо обеспечить консистентный подход в преобразованиях. Например, функция `normalize_string` проводит комплексную обработку, а остальные функции — лишь преобразования типов.
* **Типы данных**:  Функция `normalize_float` возвращает `None`, что не совсем логично в контексте модуля нормализации.
*  **Тестирование**: Отсутствие тестов для каждой функции, необходимо добавить.

### Цепочка взаимосвязей с другими частями проекта

*   **`src.logger`**: Модуль использует `src.logger` для логирования, что обеспечивает централизованное управление логированием в проекте. Все ошибки и предупреждения, сгенерированные в процессе нормализации, будут регистрироваться в системе логирования проекта.
* **Другие модули**: Данный модуль является утилитарным и может использоваться в любом другом модуле, где требуется нормализация данных. Например, в модулях, отвечающих за обработку данных из БД, REST API или форм ввода.

Таким образом, модуль `normalizer` предоставляет набор инструментов для очистки и преобразования данных, что делает его важной частью общей инфраструктуры проекта.
# Модуль `logger`

## Обзор

Модуль `logger` предоставляет класс `Logger`, реализующий паттерн Singleton для логирования сообщений в консоль, файлы и в формате JSON. Он позволяет настраивать уровни логирования, форматирование сообщений и цвета для консольного вывода.

## Подробнее

Этот модуль предназначен для централизованного логирования в приложении. Он использует библиотеку `logging` и `colorama` для форматирования и раскрашивания сообщений. Класс `Logger` реализует паттерн Singleton, гарантируя, что в приложении будет только один экземпляр логгера.  Использование этого модуля упрощает процесс логирования, предоставляя унифицированный интерфейс для записи сообщений разного уровня важности в различные источники (консоль, файлы). Логи записываются в файлы, организованные по дате и времени создания, что упрощает их поиск и анализ.  JSON-логи позволяют удобно анализировать данные с помощью внешних инструментов.

## Содержание

- [Классы](#Классы)
  - [`SingletonMeta`](#SingletonMeta)
  - [`JsonFormatter`](#JsonFormatter)
  - [`Logger`](#Logger)
- [Функции](#Функции)

## Классы

### `SingletonMeta`

**Описание**: Метакласс для реализации паттерна Singleton.

**Как работает класс**:
Этот метакласс гарантирует, что класс, для которого он используется, будет иметь только один экземпляр.  При первом вызове класса создается его экземпляр, который сохраняется в `_instances`. При последующих вызовах возвращается сохраненный экземпляр.  Использование блокировки `_lock` обеспечивает потокобезопасность при создании экземпляра.

### `JsonFormatter`

**Описание**: Кастомный форматтер для логирования в формате JSON.

**Как работает класс**:
Этот класс определяет формат логирования в JSON. Метод `format` преобразует запись лога в JSON-формат, включая время, уровень логирования, сообщение и информацию об исключении (если есть).

**Методы**:
- `format`: Форматирует запись лога как JSON.

### `Logger`

**Описание**: Класс Logger, реализующий паттерн Singleton с логированием в консоль, файлы и JSON.

**Как работает класс**:
Класс `Logger` управляет логированием сообщений в различные источники, такие как консоль, файлы и JSON. Он использует библиотеку `logging` для выполнения фактической записи логов.  При инициализации класс создает необходимые обработчики (handlers) для каждого типа логирования, устанавливает уровни логирования и форматирование сообщений. SingletonMeta гарантирует, что существует только один экземпляр класса Logger.

**Методы**:
- `__init__`: Инициализирует экземпляр Logger.
- `_format_message`: Форматирует сообщение с учетом цвета и информации об исключении.
- `_ex_full_info`: Возвращает полную информацию об исключении, включая имя файла, функцию и номер строки.
- `log`: Общий метод для логирования сообщений на указанном уровне.
- `info`: Логирует информационное сообщение.
- `success`: Логирует сообщение об успехе.
- `warning`: Логирует предупреждение.
- `debug`: Логирует отладочное сообщение.
- `exception`: Логирует сообщение об исключении.
- `error`: Логирует сообщение об ошибке.
- `critical`: Логирует критическое сообщение.

**Параметры**:
- `info_log_path` (Optional[str]): Путь к файлу для информационных логов. По умолчанию `info.log`.
- `debug_log_path` (Optional[str]): Путь к файлу для отладочных логов. По умолчанию `debug.log`.
- `errors_log_path` (Optional[str]): Путь к файлу для логов ошибок. По умолчанию `errors.log`.
- `json_log_path` (Optional[str]): Путь к файлу для JSON-логов. По умолчанию `{timestamp}.json`.

## Функции

### `_format_message`

```python
def _format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None):
    """Returns formatted message with optional color and exception information."""
    ...
```

**Описание**: Форматирует сообщение с дополнительной информацией об исключении и цветом.

**Как работает функция**:
Функция `_format_message` форматирует сообщение лога, добавляя к нему символ, соответствующий уровню логирования, а также информацию об исключении (если она есть) и цвета для консольного вывода (если они указаны).  Она использует словари `LOG_SYMBOLS`, `TEXT_COLORS` и `BG_COLORS` для получения соответствующих значений. Если цвета не указаны, сообщение форматируется без цветов.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `color` (Optional[Tuple[str, str]]): Кортеж, содержащий цвет текста и цвет фона. По умолчанию `None`.
- `level` (int): Уровень логирования. По умолчанию `None`.

**Возвращает**:
- `str`: Отформатированное сообщение.

### `_ex_full_info`

```python
def _ex_full_info(self, ex):
    """Returns full exception information along with the previous function, file, and line details."""
    ...
```

**Описание**: Возвращает полную информацию об исключении, включая имя файла, функцию и номер строки, где произошло исключение.

**Как работает функция**:
Функция `_ex_full_info` извлекает информацию о месте возникновения исключения из стека вызовов и форматирует ее в строку. Она использует модуль `inspect` для получения информации о кадре стека, включая имя файла, имя функции и номер строки.

**Параметры**:
- `ex` (Exception): Объект исключения.

**Возвращает**:
- `str`: Отформатированная строка с информацией об исключении.

### `log`

```python
def log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None):
    """General method to log messages at specified level with optional color."""
    ...
```

**Описание**: Общий метод для логирования сообщений на указанном уровне с возможностью добавления цвета.

**Как работает функция**:
Функция `log` является основным методом для записи логов. Она принимает уровень логирования, сообщение, исключение (если есть), флаг для включения информации об исключении и кортеж с цветами текста и фона. Сначала сообщение форматируется с помощью метода `_format_message`, а затем записывается в консоль и файлы с использованием соответствующих логгеров.

**Параметры**:
- `level` (int): Уровень логирования (например, `logging.INFO`, `logging.ERROR`).
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `color` (Optional[Tuple[str, str]]): Кортеж, содержащий цвет текста и цвет фона. По умолчанию `None`.

### `info`

```python
def info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = ""):
    """Logs an info message with optional text and background colors."""
    ...
```

**Описание**: Логирует информационное сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Функция `info` вызывает метод `log` с уровнем логирования `logging.INFO` и переданным сообщением.  Она также позволяет указать цвет текста и фона для консольного вывода.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `text_color` (str): Цвет текста. По умолчанию `"green"`.
- `bg_color` (str): Цвет фона. По умолчанию `""`.

### `success`

```python
def success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = ""):
    """Logs a success message with optional text and background colors."""
    ...
```

**Описание**: Логирует сообщение об успехе с возможностью указания цвета текста и фона.

**Как работает функция**:
Функция `success` вызывает метод `log` с уровнем логирования `logging.INFO` и переданным сообщением. Она также позволяет указать цвет текста и фона для консольного вывода.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `text_color` (str): Цвет текста. По умолчанию `"yellow"`.
- `bg_color` (str): Цвет фона. По умолчанию `""`.

### `warning`

```python
def warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = ""):
    """Logs a warning message with optional text and background colors."""
    ...
```

**Описание**: Логирует предупреждение с возможностью указания цвета текста и фона.

**Как работает функция**:
Функция `warning` вызывает метод `log` с уровнем логирования `logging.WARNING` и переданным сообщением. Она также позволяет указать цвет текста и фона для консольного вывода.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `text_color` (str): Цвет текста. По умолчанию `"light_red"`.
- `bg_color` (str): Цвет фона. По умолчанию `""`.

### `debug`

```python
def debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = ""):
    """Logs a debug message with optional text and background colors."""
    ...
```

**Описание**: Логирует отладочное сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Функция `debug` вызывает метод `log` с уровнем логирования `logging.DEBUG` и переданным сообщением.  Она также позволяет указать цвет текста и фона для консольного вывода.  По умолчанию, информация об исключении включается в лог.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str): Цвет текста. По умолчанию `"cyan"`.
- `bg_color` (str): Цвет фона. По умолчанию `""`.

### `exception`

```python
def exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray"):
    """Logs an exception message with optional text and background colors."""
    ...
```

**Описание**: Логирует сообщение об исключении с возможностью указания цвета текста и фона.

**Как работает функция**:
Функция `exception` вызывает метод `log` с уровнем логирования `logging.ERROR` и переданным сообщением. Она также позволяет указать цвет текста и фона для консольного вывода. По умолчанию, информация об исключении включается в лог.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str): Цвет текста. По умолчанию `"cyan"`.
- `bg_color` (str): Цвет фона. По умолчанию `"light_gray"`.

### `error`

```python
def error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = ""):
    """Logs an error message with optional text and background colors."""
    ...
```

**Описание**: Логирует сообщение об ошибке с возможностью указания цвета текста и фона.

**Как работает функция**:
Функция `error` вызывает метод `log` с уровнем логирования `logging.ERROR` и переданным сообщением. Она также позволяет указать цвет текста и фона для консольного вывода. По умолчанию, информация об исключении включается в лог.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str): Цвет текста. По умолчанию `"red"`.
- `bg_color` (str): Цвет фона. По умолчанию `""`.

### `critical`

```python
def critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white"):
    """Logs a critical message with optional text and background colors."""
    ...
```

**Описание**: Логирует критическое сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Функция `critical` вызывает метод `log` с уровнем логирования `logging.CRITICAL` и переданным сообщением.  Она также позволяет указать цвет текста и фона для консольного вывода. По умолчанию, информация об исключении включается в лог.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Optional[Exception]): Объект исключения. По умолчанию `None`.
- `exc_info` (bool): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str): Цвет текста. По умолчанию `"red"`.
- `bg_color` (str): Цвет фона. По умолчанию `"white"`.
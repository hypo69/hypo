# Модуль для работы с Aibn
=================================================

Модуль содержит класс `Aibn`, который используется для взаимодействия с сервисом Aibn для генерации ответов на основе предоставленных сообщений.

## Обзор

Модуль предоставляет асинхронный генератор ответов от Aibn. Он поддерживает историю сообщений и модель `gpt-35-turbo`.
Расположение файла в проекте: `hypotez/src/endpoints/gpt4free/g4f/Provider/deprecated/Aibn.py`

## Классы

### `Aibn`

**Описание**:
Класс `Aibn` является асинхронным провайдером генерации ответов.

**Принцип работы**:
Класс использует `StreamSession` для отправки запросов к API Aibn и получения ответов в виде асинхронного генератора.

**Параметры класса**:
- `url` (str): URL сервиса Aibn.
- `working` (bool): Указывает, работает ли провайдер.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-35-turbo`.

**Методы**:

- `create_async_generator`
    - **Описание**:
    Создает асинхронный генератор для получения ответов от Aibn.

    - **Параметры**:
        - `model` (str): Модель для генерации ответов.
        - `messages` (Messages): Список сообщений для отправки.
        - `proxy` (str, optional): Прокси для использования. По умолчанию `None`.
        - `timeout` (int, optional): Время ожидания ответа. По умолчанию `120`.
        - `**kwargs`: Дополнительные параметры.

    - **Возвращает**:
        - `AsyncResult`: Асинхронный генератор, предоставляющий ответы от Aibn.

    **Как работает функция**:

    1.  Функция `create_async_generator` устанавливает соединение с сервисом Aibn, используя `StreamSession`.
    2.  Формирует данные для отправки, включая сообщения, временную метку и подпись.
    3.  Отправляет POST-запрос к API Aibn и получает ответ в виде потока данных.
    4.  Декодирует каждый чанк данных и передает его через генератор.

    Внутри функции происходят следующие действия и преобразования:

    А.  `timestamp` (временная метка) - текущее время в секундах.
    |
    -- B. `data` (данные для отправки) - формируются на основе сообщений, временной метки и подписи.
    |
    C. `session.post` (отправка запроса) - отправляет запрос к API Aibn.
    |
    D. `response.iter_content` (получение ответа) - получает ответ в виде потока данных.
    |
    E. `chunk.decode` (декодирование данных) - декодирует каждый чанк данных.
    |
    F. `yield` (возврат данных) - возвращает декодированные данные через генератор.

    **Примеры**:

    ```python
    messages = [{"role": "user", "content": "Hello, Aibn!"}]
    async for chunk in Aibn.create_async_generator(model="gpt-35-turbo", messages=messages):
        print(chunk)
    ```

## Функции

### `generate_signature`

```python
def generate_signature(timestamp: int, message: str, secret: str = "undefined"):
    """
    Генерирует подпись для запроса к API Aibn.

    Args:
        timestamp (int): Временная метка.
        message (str): Сообщение для подписи.
        secret (str, optional): Секретный ключ. По умолчанию "undefined".

    Returns:
        str: Сгенерированная подпись.
    """
```

**Описание**:
Функция `generate_signature` генерирует SHA256-подпись для запроса к API Aibn.

**Параметры**:
- `timestamp` (int): Временная метка.
- `message` (str): Сообщение для подписи.
- `secret` (str, optional): Секретный ключ. По умолчанию `"undefined"`.

**Возвращает**:
- `str`: Сгенерированная подпись в виде шестнадцатеричной строки.

**Как работает функция**:

1.  Функция `generate_signature` объединяет временную метку, сообщение и секретный ключ в одну строку.
2.  Вычисляет SHA256-хеш от этой строки.
3.  Возвращает хеш в виде шестнадцатеричной строки.

Внутри функции происходят следующие действия и преобразования:

А. `data` (данные для хеширования) - формируются на основе временной метки, сообщения и секретного ключа.
|
-- B. `data.encode` (кодирование данных) - кодирует строку в байты.
|
C. `hashlib.sha256` (вычисление хеша) - вычисляет SHA256-хеш от байтовой строки.
|
D. `hexdigest` (возврат хеша) - возвращает хеш в виде шестнадцатеричной строки.

**Примеры**:

```python
timestamp = int(time.time())
message = "Hello, Aibn!"
signature = generate_signature(timestamp, message)
print(signature)
```
# Модуль `Yqcloud.py`

## Обзор

Модуль предоставляет реализацию доступа к провайдеру Yqcloud для использования в G4F (Generic Functional Framework). Он позволяет отправлять запросы к API Yqcloud для генерации текста на основе предоставленных сообщений. Модуль поддерживает потоковую передачу ответов и не требует аутентификации.

## Подробней

Модуль предназначен для интеграции с другими частями проекта `hypotez`, которые используют G4F для взаимодействия с различными AI-моделями. Он предоставляет функцию `_create_completion`, которая отправляет запросы к API Yqcloud и возвращает сгенерированный текст.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """
    Создает запрос к API Yqcloud для генерации текста на основе предоставленных сообщений.

    Args:
        model (str): Идентификатор модели, используемой для генерации текста.
        messages (list): Список сообщений, используемых в качестве контекста для генерации.
        stream (bool): Флаг, указывающий, следует ли использовать потоковую передачу ответов.
        **kwargs: Дополнительные параметры.

    Returns:
        Generator[str, None, None]: Генератор, выдающий сгенерированные текстовые фрагменты.

    Raises:
        Exception: Если возникает ошибка при отправке запроса или обработке ответа.
    """
```

**Как работает функция**:

1.  **Подготовка заголовков**: Создает словарь `headers` с необходимыми HTTP-заголовками для запроса к API Yqcloud.
2.  **Формирование данных запроса**: Создает словарь `json_data`, содержащий параметры запроса, такие как сообщение пользователя (`prompt`), идентификатор пользователя (`userId`), флаг сетевого подключения (`network`), API-ключ (`apikey`) и другие параметры.
    -   Сообщение пользователя формируется путем добавления префикса `'always respond in english |'` к последнему сообщению из списка `messages`.
    -   Идентификатор пользователя генерируется на основе текущего времени в миллисекундах.
3.  **Отправка запроса**: Отправляет POST-запрос к API Yqcloud (`https://api.aichatos.cloud/api/generateStream`) с использованием библиотеки `requests`. Указанные `headers` и `json_data` передаются в запросе, а также устанавливается параметр `stream=True` для потоковой передачи ответа.
4.  **Обработка ответа**: Итерируется по содержимому ответа, полученного от API, с использованием `response.iter_content(chunk_size=2046)`. Для каждого фрагмента (`token`) выполняется проверка на наличие байтовой строки `b'always respond in english'`. Если фрагмент не содержит эту строку, он декодируется в UTF-8 и возвращается как часть сгенерированного текста.
    -   Байтовая строка `b'always respond in english'`  используется, чтобы убедиться, что ответ не содержит никаких инструкций, добавленных к запросу.
5.  **Генерация фрагментов текста**: Функция является генератором, поэтому она использует `yield` для выдачи каждого фрагмента сгенерированного текста.

**Примеры**:

```python
# Пример использования функции _create_completion
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Напиши короткий рассказ о космосе."}]
stream = True

# Вызов функции и итерация по результатам
for chunk in _create_completion(model, messages, stream):
    print(chunk, end="")
```

### `params`

Переменная `params` содержит строку, описывающую поддерживаемые типы параметров для функции `_create_completion`.

```python
params = f'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: ' + \
    \'(%s)\' % \', \'.join([f"{name}: {get_type_hints(_create_completion)[name].__name__}" for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]])
```

**Как работает переменная**:

1.  **Формирование строки параметров**: Использует f-строку для создания описания поддерживаемых параметров функции `_create_completion`.
    -   `os.path.basename(__file__)[:-3]` извлекает имя текущего файла модуля без расширения `.py`.
    -   `get_type_hints(_create_completion)` получает словарь с аннотациями типов параметров функции `_create_completion`.
    -   `_create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]` получает список имен параметров функции `_create_completion`.
    -   С помощью генератора списка формируется строка вида `"имя_параметра: тип_параметра"` для каждого параметра функции.
    -   `\', \'.join(...)` объединяет полученные строки в одну строку, разделенную запятой и пробелом.
    -   `\'(%s)\' % ...` форматирует полученную строку параметров в строку вида `"(параметр1: тип1, параметр2: тип2, ...)"`.
2.  **Описание**: В итоге переменная `params` содержит строку, которая указывает, какие параметры поддерживает функция `_create_completion` и какие типы данных ожидаются для этих параметров.

**Примеры**:

```python
# Пример значения переменной params
print(params)
# Вывод: g4f.Providers.Yqcloud supports: (model: str, messages: list, stream: bool, kwargs: dict)
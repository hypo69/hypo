# Модуль для логирования времени выполнения функций

## Обзор

Модуль содержит функции для измерения и логирования времени выполнения других функций.
Он предоставляет обертки (`log_time_async`, `log_time_yield`, `log_time`) для измерения времени выполнения целевой функции и добавления информации о времени выполнения к результату.
Этот модуль предназначен для упрощения процесса профилирования кода и определения узких мест производительности.

## Подробней

Данный модуль предоставляет три функции (`log_time_async`, `log_time_yield`, `log_time`) для измерения времени выполнения других функций.
Каждая из этих функций принимает вызываемый объект (функцию) и именованные аргументы, вызывает переданную функцию, измеряет время ее выполнения и возвращает результат вместе с информацией о времени выполнения.

Этот код используется для отладки и оптимизации кода, позволяя быстро оценивать производительность различных частей программы.

## Функции

### `log_time_async`

```python
async def log_time_async(method: callable, **kwargs):
    """Асинхронно измеряет и логирует время выполнения метода.

    Args:
        method (callable): Асинхронный метод, время выполнения которого необходимо измерить.
        **kwargs: Произвольные именованные аргументы, передаваемые в метод.

    Returns:
        str: Результат выполнения метода, дополненный информацией о времени выполнения в секундах. Если результат равен `None`, возвращается только информация о времени выполнения.
    """
```

**Как работает функция**:

1.  **Начало измерения**: Фиксирует время начала выполнения переданного метода.
2.  **Вызов метода**: Асинхронно вызывает переданный метод с заданными аргументами `kwargs`.
3.  **Завершение измерения**: После завершения выполнения метода фиксирует время окончания и вычисляет разницу между временем окончания и временем начала, чтобы получить время выполнения в секундах.
4.  **Формирование результата**: Формирует строку с информацией о времени выполнения. Если результат выполнения метода не равен `None`, добавляет его к строке времени выполнения.
5.  **Возврат результата**: Возвращает строку, содержащую результат выполнения метода (если он есть) и время выполнения.

**Внутренние блоки**:

*   **Измерение времени** (`start_time`): Записывает начальное время перед вызовом метода.
*   **Вызов метода** (`await_method`): Вызывает целевой метод с переданными аргументами.
*   **Расчет времени выполнения** (`calc_execution_time`): Вычисляет время, затраченное на выполнение метода.
*   **Формирование результата** (`format_result`): Создает строку с результатом и временем выполнения.

**Примеры**:

```python
import asyncio
from time import sleep

async def my_async_function(delay: int, text: str) -> str:
    """Асинхронная функция, имитирующая задержку и возвращающая текст."""
    await asyncio.sleep(delay)
    return text

async def main():
    """Пример использования функции log_time_async."""
    result = await log_time_async(my_async_function, delay=1, text="Async task complete")
    print(result)  # Вывод: Async task complete 1.01 secs
    
    result = await log_time_async(my_async_function, delay=0, text="")
    print(result) # secs
```

### `log_time_yield`

```python
def log_time_yield(method: callable, **kwargs):
    """Измеряет и логирует время выполнения метода, использующего yield from.

    Args:
        method (callable): Метод, использующий `yield from`, время выполнения которого необходимо измерить.
        **kwargs: Произвольные именованные аргументы, передаваемые в метод.

    Yields:
        str: Результат выполнения метода, дополненный информацией о времени выполнения в секундах.
    """
```

**Как работает функция**:

1.  **Начало измерения**: Фиксирует время начала выполнения переданного метода.
2.  **Вызов метода с yield from**: Вызывает переданный метод с заданными аргументами `kwargs`, используя `yield from` для получения результатов из генератора.
3.  **Завершение измерения**: После завершения выполнения метода фиксирует время окончания и вычисляет разницу между временем окончания и временем начала, чтобы получить время выполнения в секундах.
4.  **Добавление времени к результату**: Добавляет информацию о времени выполнения к последнему полученному значению из генератора.
5.  **Yield результата**: Передает конечное значение (с информацией о времени) через `yield`.

**Внутренние блоки**:

*   **Измерение времени** (`start_time`): Записывает начальное время перед вызовом метода.
*   **Вызов метода с yield from** (`yield_from_method`): Вызывает целевой метод с переданными аргументами, используя `yield from`.
*   **Расчет времени выполнения** (`calc_execution_time`): Вычисляет время, затраченное на выполнение метода.
*   **Добавление времени к результату** (`append_execution_time`): Добавляет информацию о времени выполнения к последнему значению, полученному из генератора.
*   **Yield результата** (`yield_result`): Передает итоговый результат через `yield`.

**Примеры**:

```python
def my_generator_function(n: int) -> str:
    """Функция-генератор, возвращающая числа от 0 до n."""
    for i in range(n):
        yield f"Value {i}"

def main():
    """Пример использования функции log_time_yield."""
    generator = log_time_yield(my_generator_function, n=3)
    for value in generator:
        print(value)
    # Вывод:
    # Value 0
    # Value 1
    # Value 2
    #  0.0 secs
```

### `log_time`

```python
def log_time(method: callable, **kwargs):
    """Измеряет и логирует время выполнения метода.

    Args:
        method (callable): Метод, время выполнения которого необходимо измерить.
        **kwargs: Произвольные именованные аргументы, передаваемые в метод.

    Returns:
        str: Результат выполнения метода, дополненный информацией о времени выполнения в секундах. Если результат равен `None`, возвращается только информация о времени выполнения.
    """
```

**Как работает функция**:

1.  **Начало измерения**: Фиксирует время начала выполнения переданного метода.
2.  **Вызов метода**: Вызывает переданный метод с заданными аргументами `kwargs`.
3.  **Завершение измерения**: После завершения выполнения метода фиксирует время окончания и вычисляет разницу между временем окончания и временем начала, чтобы получить время выполнения в секундах.
4.  **Формирование результата**: Формирует строку с информацией о времени выполнения. Если результат выполнения метода не равен `None`, добавляет его к строке времени выполнения.
5.  **Возврат результата**: Возвращает строку, содержащую результат выполнения метода (если он есть) и время выполнения.

**Внутренние блоки**:

*   **Измерение времени** (`start_time`): Записывает начальное время перед вызовом метода.
*   **Вызов метода** (`call_method`): Вызывает целевой метод с переданными аргументами.
*   **Расчет времени выполнения** (`calc_execution_time`): Вычисляет время, затраченное на выполнение метода.
*   **Формирование результата** (`format_result`): Создает строку с результатом и временем выполнения.

**Примеры**:

```python
def my_function(text: str) -> str:
    """Функция, возвращающая переданный текст."""
    return text

def main():
    """Пример использования функции log_time."""
    result = log_time(my_function, text="Task complete")
    print(result)  # Вывод: Task complete 0.0 secs
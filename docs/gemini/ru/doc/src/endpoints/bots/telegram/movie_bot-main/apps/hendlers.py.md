# Модуль обработчиков Telegram-бота для поиска фильмов
## Обзор

Этот модуль содержит обработчики для Telegram-бота, которые позволяют пользователям искать информацию о фильмах и сериалах. Он использует библиотеку `aiogram` для обработки команд и взаимодействий с пользователем, а также модуль `apps.search` для выполнения поисковых запросов.

## Подробней

Модуль `hendlers.py` определяет роутер (`router`) и набор обработчиков, которые реагируют на различные команды и действия пользователя в Telegram-боте. Он включает обработчики для команды `/start`, выбора типа фильма (фильм или сериал) и ввода названия фильма для поиска. Модуль использует FSM (Finite State Machine) для управления состоянием диалога с пользователем и сохранения параметров поиска.

## Содержание

- [Классы](#классы)
  - [Params](#params)
- [Переменные](#переменные)
- [Функции](#функции)
  - [command_start_handler](#command_start_handler)
  - [movie_handler](#movie_handler)
  - [series_handler](#series_handler)
  - [film_handler](#film_handler)
  - [name_handler](#name_handler)

## Переменные

### `router`
- **Описание**: Экземпляр `Router` из библиотеки `aiogram`, используемый для регистрации обработчиков.
- **Тип**: `Router`

### `type_movies`
- **Описание**: Словарь, сопоставляющий строковые идентификаторы типов фильмов (`'film'`, `'series'`) с их отображаемыми названиями на русском языке (`'Фильм'`, `'Сериал'`).
- **Тип**: `dict[str, str]`

## Классы

### `Params`

**Описание**: Класс, представляющий состояния FSM (Finite State Machine) для хранения параметров поиска фильма.

**Как работает класс**:
Этот класс использует `StatesGroup` из библиотеки `aiogram.fsm.state` для определения состояний, в которых может находиться диалог с пользователем. Каждое состояние представляет собой ожидание ввода определенного параметра поиска, такого как тип фильма (`type_movie`) и название фильма (`name`).

**Атрибуты**:
- `type_movie`: Состояние, представляющее ожидание выбора типа фильма (фильм или сериал).
- `name`: Состояние, представляющее ожидание ввода названия фильма.

```python
class Params(StatesGroup):
    type_movie = State()
    name = State()
```

## Функции

### `command_start_handler`

```python
async def command_start_handler(message: Message) -> None:
    """
    Обработчик команды `/start`. Отправляет приветственное сообщение пользователю и предлагает начать поиск фильма.

    Args:
        message (Message): Объект сообщения, представляющий входящее сообщение от пользователя.

    Returns:
        None

    """
```

**Как работает функция**:
1.  Отправляет приветственное сообщение пользователю, используя его полное имя.
2.  Предлагает пользователю начать поиск фильма, отправляя сообщение с кнопками выбора.

### `movie_handler`

```python
@router.callback_query(F.data == \'new_movies\')
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обработчик нажатия на кнопку "Найти фильм". Устанавливает состояние ожидания выбора типа фильма.

    Args:
        callback (CallbackQuery): Объект обратного вызова, представляющий нажатие на кнопку.
        state (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

    Returns:
        None

    """
```

**Как работает функция**:

1. Устанавливает состояние `Params.type_movie`, чтобы указать, что бот ожидает выбор типа фильма (фильм или сериал).
2. Отправляет пользователю сообщение с кнопками выбора типа фильма.

### `series_handler`

```python
@router.callback_query(F.data == \'series\')
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обработчик выбора типа "сериал". Сохраняет выбор пользователя и переходит к запросу названия сериала.

    Args:
        callback (CallbackQuery): Объект обратного вызова, представляющий нажатие на кнопку.
        state (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

    Returns:
        None

    """
```

**Как работает функция**:

1.  Удаляет предыдущее сообщение с кнопками выбора типа фильма.
2.  Сохраняет выбор пользователя (`'series'`) в контексте FSM.
3.  Устанавливает состояние `Params.name`, чтобы указать, что бот ожидает ввод названия сериала.
4.  Отправляет пользователю сообщение с запросом названия сериала.

### `film_handler`

```python
@router.callback_query(F.data == \'film\')
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обработчик выбора типа "фильм". Сохраняет выбор пользователя и переходит к запросу названия фильма.

    Args:
        callback (CallbackQuery): Объект обратного вызова, представляющий нажатие на кнопку.
        state (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

    Returns:
        None

    """
```

**Как работает функция**:

1.  Удаляет предыдущее сообщение с кнопками выбора типа фильма.
2.  Сохраняет выбор пользователя (`'film'`) в контексте FSM.
3.  Устанавливает состояние `Params.name`, чтобы указать, что бот ожидает ввод названия фильма.
4.  Отправляет пользователю сообщение с запросом названия фильма.

### `name_handler`

```python
@router.message(Params.name)
async def name_handler(message: Message, state: FSMContext) -> None:
    """
    Обработчик ввода названия фильма. Выполняет поиск фильма и отправляет результат пользователю.

    Args:
        message (Message): Объект сообщения, представляющий входящее сообщение от пользователя с названием фильма.
        state (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

    Returns:
        None

    """
```

**Как работает функция**:

1.  Сохраняет введенное пользователем название фильма в контексте FSM.
2.  Извлекает из контекста FSM название фильма и тип фильма.
3.  Выполняет поисковый запрос с использованием функции `search_query` из модуля `apps.search`.
4.  Отправляет пользователю сообщение с информацией о запросе (название и тип фильма).
5.  Если фильм найден, отправляет пользователю сообщение с информацией о фильме (название, описание и ссылка).
6.  Если фильм не найден, отправляет пользователю сообщение о том, что фильм не найден.
7.  Предлагает пользователю начать новый поиск фильма.
8.  Очищает контекст FSM.
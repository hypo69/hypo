# Модуль `from_supplier_to_prestashop`

## Обзор

Модуль предоставляет функциональность для извлечения, разбора и обработки данных о продуктах от различных поставщиков. Он обрабатывает подготовку данных, обработку с помощью ИИ и интеграцию с Prestashop для публикации продуктов.

## Содержание

- [Классы](#классы)
    - [SupplierToPrestashopProvider](#suppliertoprestashopprovider)
- [Функции](#функции)
    - [run_scenario](#run_scenario)
    - [convert_product_fields](#convert_product_fields)
    - [save_product_data](#save_product_data)
    - [process_ai](#process_ai)
    - [post_facebook](#post_facebook)
    - [create_report](#create_report)

## Классы

### `SupplierToPrestashopProvider`

**Описание**: 
Обрабатывает извлечение, разбор и сохранение данных о продуктах поставщиков.

**Атрибуты**:
- `driver` (Driver): Экземпляр Selenium WebDriver.
- `export_path` (Path): Путь для экспорта данных.
- `products_list` (List[dict]): Список обработанных данных о продуктах.
- `mexiron_name` (str): Название мехирона.
- `price` (float): Цена.
- `timestamp` (str): Временная метка.
- `model` (GoogleGenerativeAI): Экземпляр модели Google Generative AI.
- `config` (SimpleNamespace): Конфигурация модуля.
- `update` (Update): Объект Telegram Update.
- `context` (CallbackContext): Объект Telegram CallbackContext.


**Методы**:
- `__init__`: Инициализирует класс `SupplierToPrestashopProvider`.
    
    **Параметры**:
    -   `driver` (Driver): Selenium WebDriver instance.

    
- [run_scenario](#run_scenario): Выполняет сценарий: разбирает товары, обрабатывает их через ИИ и сохраняет данные.
- [convert_product_fields](#convert_product_fields): Конвертирует поля товара в словарь.
- [save_product_data](#save_product_data): Сохраняет данные об отдельном товаре в файл.
- [process_ai](#process_ai): Обрабатывает список товаров через модель ИИ.
- [post_facebook](#post_facebook): Выполняет сценарий рекламного модуля `facebook`.
- [create_report](#create_report): Создает отчет в форматах `html` и `pdf`.

## Функции

### `run_scenario`

**Описание**: Выполняет сценарий: разбирает товары, обрабатывает их через ИИ и сохраняет данные.

**Параметры**:
- `update` (Update): Объект Telegram Update.
- `context` (CallbackContext): Объект Telegram CallbackContext.
- `urls` (list[str]): Список URL-адресов страниц товаров.
- `price` (Optional[str], optional): Цена для обработки. По умолчанию ''.
- `mexiron_name` (Optional[str], optional): Пользовательское имя мехирона. По умолчанию ''.

**Возвращает**:
- `bool`: `True`, если сценарий выполнен успешно, `False` в противном случае.

**Примечание**:
- Внутри функции используется цикл для обработки списка URL-адресов.
- Для каждого URL-адреса вызывается граббер, который извлекает необходимые поля товара.
- Результаты обработки сохраняются.

### `convert_product_fields`

**Описание**: Конвертирует поля товара из объекта `ProductFields` в словарь.

**Параметры**:
- `f` (ProductFields): Объект, содержащий данные о товаре.

**Возвращает**:
- `dict`: Словарь с данными о товаре.

**Примечание**:
-  Правила построения полей определяются в `ProductFields`.
-  В случае сбоя при получении полей товара возвращается пустой словарь.

### `save_product_data`

**Описание**: Сохраняет данные об отдельном товаре в файл.

**Параметры**:
- `product_data` (dict): Словарь с данными о товаре.

**Возвращает**:
- `None`: Функция ничего не возвращает.

**Примечание**:
- Данные сохраняются в формате `JSON`.
- В случае ошибки при сохранении выводится сообщение об ошибке в лог.

### `process_ai`

**Описание**: Обрабатывает список товаров через модель ИИ.

**Параметры**:
- `products_list` (List[str]): Список словарей с данными о товарах.
- `lang` (str): Язык, на котором должен быть ответ от ИИ.
- `attempts` (int, optional): Количество попыток переспросить модель в случае ошибки. По умолчанию 3.

**Возвращает**:
- `tuple`: Обработанный ответ в формате `ru` и `he`.
- `bool`: False, если не удалось получить валидный ответ после всех попыток.

**Примечание**:
- Модель может возвращать невалидный результат, в таком случае делается переспрос.

### `post_facebook`

**Описание**: Функция исполняет сценарий рекламного модуля `facvebook`.

**Параметры**:
- `mexiron` (SimpleNamespace): Данные для публикации в facebook.

**Возвращает**:
- `bool`: `True`, если публикация прошла успешно, `False` в противном случае.

### `create_report`

**Описание**: Функция отправляет задание на создание мехирона в формате `html` и `pdf`.

**Параметры**:
- `data` (dict): Данные для отчета.
- `lang` (str): Язык отчета.
- `html_file` (Path): Путь к файлу HTML.
- `pdf_file` (Path): Путь к файлу PDF.

**Возвращает**:
- `bool`: `True`, если отчет создан и отправлен боту, `False` в противном случае.

**Примечание**:
- Если мехорон в `pdf` создался, то он будет отправлен боту через `reply_document`.
# Анализ кода модуля `e_520.md`

**Качество кода**
8
- Плюсы
    - Код представляет собой описание задачи на естественном языке.
    - Есть четкое условие задачи, примеры и известные значения.
- Минусы
    - Отсутствует программный код, который нужно анализировать.
    - Нет импортов и функций для анализа и улучшения.

**Рекомендации по улучшению**

1.  Необходимо добавить программный код для решения задачи.
2.  Реализовать функцию, которая проверяет, является ли число разделенным в соответствии с условиями задачи.
3.  Реализовать функцию подсчета количества разделенных чисел в заданном диапазоне.
4.  Использовать `logger` для отслеживания ошибок и отладки.
5.  Добавить docstring для всех функций и методов в формате reStructuredText.

**Оптимизированный код**

```markdown
# Задача No 520
## Разделенные числа
## Условия
Назовем натуральное число *n* разделенным, если можно разделить его десятичную запись на две или более подстроки, так, что каждая из них представляет собой совершенный квадрат.

Например, 164964 является разделенным числом, так как его можно разделить на 16, 49 и 64, которые являются квадратами чисел 4, 7 и 8, соответственно.
Числа 169 и 324 также являются разделенными числами.
Число 164 не является разделенным, так как его единственные подходящие разбиения - это 16 и 4, и 1 и 64, ни одно из которых не образует разбиение с двумя или более квадратами.
Число 4 не является разделенным, так как нужно как минимум две подстроки.

Пусть *S(N)* будет количеством разделенных чисел, меньших *N*.
Известно, что *S*(10<sup>4</sup>) = 115, *S*(10<sup>6</sup>) = 7073 и *S*(10<sup>8</sup>) = 491880.

Найдите *S*(10<sup>18</sup>).

```
```python
"""
Модуль для решения задачи 520 "Разделенные числа" из Project Euler.
===================================================================

Этот модуль содержит функции для определения, является ли число разделенным
в соответствии с условиями задачи, а также для подсчета количества разделенных
чисел в заданном диапазоне.

Пример использования
--------------------

Для использования модуля, необходимо вызвать функцию `count_separated_numbers` с
верхней границей диапазона чисел, в котором нужно найти разделенные числа.

.. code-block:: python

    from src.utils.jjson import j_loads_ns
    from src.logger.logger import logger

    def is_perfect_square(n: int) -> bool:
        ...

    def is_separated_number(n: int) -> bool:
       ...

    def count_separated_numbers(limit: int) -> int:
       ...
    
    limit = 10**6
    result = count_separated_numbers(limit)
    print(f"Количество разделенных чисел меньше {limit}: {result}")

"""
from src.utils.jjson import j_loads_ns
from src.logger.logger import logger
from typing import List


def is_perfect_square(n: int) -> bool:
    """
    Проверяет, является ли число совершенным квадратом.

    :param n: Целое число для проверки.
    :return: True, если число является совершенным квадратом, иначе False.
    
    :raises TypeError: Если входной параметр `n` не является целым числом.
    """
    if not isinstance(n, int):
       logger.error(f'Входящий параметр `n` должен быть целым числом, но было передано {type(n)}')
       raise TypeError(f'Входящий параметр `n` должен быть целым числом, но было передано {type(n)}')
    if n < 0:
        return False
    root = int(n**0.5)
    return root * root == n


def is_separated_number(n: int) -> bool:
    """
    Проверяет, является ли число разделенным.

    Число считается разделенным, если его десятичную запись можно разделить
    на две или более подстроки, каждая из которых является совершенным квадратом.

    :param n: Целое число для проверки.
    :return: True, если число является разделенным, иначе False.
    
    :raises TypeError: Если входной параметр `n` не является целым числом.
    """
    if not isinstance(n, int):
       logger.error(f'Входящий параметр `n` должен быть целым числом, но было передано {type(n)}')
       raise TypeError(f'Входящий параметр `n` должен быть целым числом, но было передано {type(n)}')
    s = str(n)
    length = len(s)
    if length < 2:
        return False

    # Функция выполняет рекурсивный поиск разбиений на квадраты
    def find_splits(index: int, current_split: List[int]) -> bool:
        """
        Рекурсивная функция для поиска разбиений на квадраты.
        
        :param index: Текущий индекс в строке числа.
        :param current_split: Список текущих разбиений.
        :return: True, если разбиение на квадраты найдено, иначе False.
        """
        if index == length:
            return len(current_split) >= 2
        for i in range(index + 1, length + 1):
            sub = int(s[index:i])
            if is_perfect_square(sub):
                if find_splits(i, current_split + [sub]):
                    return True
        return False
    
    return find_splits(0, [])


def count_separated_numbers(limit: int) -> int:
    """
    Подсчитывает количество разделенных чисел, меньших заданного предела.

    :param limit: Верхняя граница диапазона чисел (не включая).
    :return: Количество разделенных чисел меньше `limit`.
    
    :raises TypeError: Если входной параметр `limit` не является целым числом.
    :raises ValueError: Если входной параметр `limit` меньше или равен 0.
    """
    if not isinstance(limit, int):
       logger.error(f'Входящий параметр `limit` должен быть целым числом, но было передано {type(limit)}')
       raise TypeError(f'Входящий параметр `limit` должен быть целым числом, но было передано {type(limit)}')
    if limit <= 0:
      logger.error(f'Входящий параметр `limit` должен быть больше 0, но было передано {limit}')
      raise ValueError(f'Входящий параметр `limit` должен быть больше 0, но было передано {limit}')
    count = 0
    for i in range(1, limit):
        if is_separated_number(i):
            count += 1
    return count

if __name__ == '__main__':
    #  Проверка с известными значениями
    test_cases = {
        10**4: 115,
        10**6: 7073,
        10**8: 491880
    }
    for limit, expected in test_cases.items():
       # Проверка соответствия полученного результата ожидаемому
       result = count_separated_numbers(limit)
       if result == expected:
           print(f'Тест пройден для S({limit}) = {result}')
       else:
           logger.error(f'Тест не пройден для S({limit}). Ожидалось {expected}, получено {result}')
    # Вычисление для S(10^18)
    limit = 10**18
    # Код выводит результат. (расчет может занять продолжительное время)
    print(f'S({limit}) = {count_separated_numbers(limit)}')
```
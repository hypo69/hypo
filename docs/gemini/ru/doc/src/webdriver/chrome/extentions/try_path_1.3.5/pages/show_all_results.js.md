# Документация для `show_all_results.js`

## Обзор

Этот файл содержит JavaScript-код для отображения результатов выполнения XPath-выражений в расширении браузера. Он обрабатывает полученные данные, формирует HTML для отображения и позволяет экспортировать результаты в текстовый файл.

## Оглавление

1. [Обзор](#обзор)
2. [Глобальные переменные](#глобальные-переменные)
3. [Функции](#функции)
   - [`showAllResults`](#showallresults)
   - [`makeTextDownloadUrl`](#maketextdownloadurl)
   - [`makeInfoText`](#makeinfotext)
   - [`makeConvertedInfoText`](#makeconvertedinfotext)
4. [Обработчик события `load`](#обработчик-события-load)

## Глобальные переменные

- `tx`: Псевдоним для `tryxpath`.
- `fu`: Псевдоним для `tryxpath.functions`.
- `document`: Объект `document` текущего окна.
- `detailKeys`: Массив строк, представляющих ключи для деталей результатов.
- `headerValues`: Массив строк, представляющих заголовки для таблицы деталей результатов.
- `relatedTabId`: Идентификатор вкладки, из которой были получены результаты.
- `relatedFrameId`: Идентификатор фрейма, из которого были получены результаты.
- `executionId`: Идентификатор выполнения, связанный с результатами.

## Функции

### `showAllResults`

**Описание**: Отображает результаты выполнения XPath-выражения на странице.

**Параметры**:
- `results` (Object): Объект, содержащий результаты выполнения XPath-выражения.
  - `message` (string): Сообщение о результате.
  - `title` (string): Заголовок для отображения.
  - `href` (string): URL, на котором выполнялся запрос.
  - `frameId` (number): ID фрейма.
  - `context` (Object, optional): Контекстные данные XPath.
    - `method` (string): Метод, использованный для XPath.
    - `expression` (string): XPath выражение.
    - `specifiedResultType` (number): Запрошенный тип результата.
    - `resultType` (number): Фактический тип результата.
    - `resolver` (string): Разрешитель.
    - `itemDetail` (Object): Детали элемента контекста.
  - `main` (Object): Основные данные результата XPath.
    - `method` (string): Метод, использованный для XPath.
    - `expression` (string): XPath выражение.
    - `specifiedResultType` (number): Запрошенный тип результата.
    - `resultType` (number): Фактический тип результата.
    - `resolver` (string): Разрешитель.
    - `itemDetails` (Array<Object>): Массив деталей найденных элементов.

**Возвращает**:
- `undefined`: Функция ничего не возвращает.

**Вызывает исключения**:
- `fu.onError`: Вызывается при ошибке обновления таблицы деталей.

### `makeTextDownloadUrl`

**Описание**: Создаёт URL для скачивания текстового файла.

**Параметры**:
- `text` (string): Текст, который будет содержаться в файле.

**Возвращает**:
- `string`: URL для скачивания файла.

### `makeInfoText`

**Описание**: Формирует текстовое представление результатов для экспорта.

**Параметры**:
- `results` (Object): Объект, содержащий результаты выполнения XPath-выражения.

**Возвращает**:
- `string`: Текстовое представление результатов.

### `makeConvertedInfoText`

**Описание**: Формирует текстовое представление результатов с конвертацией в JSON для экспорта.

**Параметры**:
- `results` (Object): Объект, содержащий результаты выполнения XPath-выражения.

**Возвращает**:
- `string`: Текстовое представление результатов с конвертацией в JSON.

## Обработчик события `load`

**Описание**: Обработчик события `load`, который выполняется при загрузке страницы.

1.  **Отправка сообщения и обработка результатов:**
    -   Отправляет сообщение `loadResults` в фоновый скрипт для получения данных.
    -   Обрабатывает полученные результаты:
        -   Сохраняет `relatedTabId`, `relatedFrameId` и `executionId`.
        -   Устанавливает атрибуты для ссылок экспорта результатов в текстовый файл.
        -   Вызывает `showAllResults` для отображения результатов на странице.
2. **Обработка кликов на детали контекста**
    -   Добавляет обработчик события `click` для таблицы деталей контекста.
    -   При клике на кнопку отправляет сообщение `focusContextItem` в фоновый скрипт для фокусировки элемента в контексте.
3.  **Обработка кликов на детали основных элементов:**
    -   Добавляет обработчик события `click` для таблицы основных деталей.
    -   При клике на кнопку отправляет сообщение `focusItem` в фоновый скрипт для фокусировки выбранного элемента.
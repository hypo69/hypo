# Модуль для работы с провайдером GizAI
=================================================

Модуль содержит класс :class:`GizAI`, который используется для взаимодействия с сервисом GizAI для получения ответов от AI моделей.
Модуль поддерживает асинхронную генерацию ответов и предоставляет методы для форматирования запросов.

## Обзор

Модуль `GizAI` предоставляет класс `GizAI`, который является асинхронным провайдером и позволяет взаимодействовать с API сервиса GizAI для генерации текста на основе предоставленных сообщений.
Он поддерживает выбор модели, проксирование запросов и обработку ответов от API.

## Подробнее

Этот модуль является частью проекта `hypotez` и предназначен для интеграции с сервисом GizAI.
Он использует библиотеку `aiohttp` для выполнения асинхронных HTTP-запросов и предоставляет удобный интерфейс для отправки сообщений и получения ответов от AI моделей, размещенных на платформе GizAI.
Модуль также включает в себя механизмы для выбора модели и форматирования запросов, что упрощает его использование в различных сценариях.

## Классы

### `GizAI`

**Описание**: Класс `GizAI` представляет собой асинхронный провайдер для взаимодействия с API сервиса GizAI.
Он наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin` и предоставляет методы для отправки запросов и получения ответов от AI моделей.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию ответов.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями.

**Атрибуты**:
- `url` (str): URL сервиса GizAI.
- `api_endpoint` (str): URL API для отправки запросов.
- `working` (bool): Флаг, указывающий, работает ли провайдер.
- `supports_stream` (bool): Флаг, указывающий, поддерживает ли провайдер потоковую передачу данных.
- `supports_system_message` (bool): Флаг, указывающий, поддерживает ли провайдер системные сообщения.
- `supports_message_history` (bool): Флаг, указывающий, поддерживает ли провайдер историю сообщений.
- `default_model` (str): Модель, используемая по умолчанию.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Словарь псевдонимов моделей.

**Методы**:
- `get_model(model: str) -> str`: Возвращает имя модели на основе псевдонима или имени.
- `create_async_generator(model: str, messages: Messages, proxy: str = None, **kwargs) -> AsyncResult`: Создает асинхронный генератор для получения ответов от API.

### `get_model`

```python
    @classmethod
    def get_model(cls, model: str) -> str:
        ...
```

**Назначение**: Возвращает имя модели на основе псевдонима или имени. Если модель не найдена в списке поддерживаемых моделей и псевдонимов, возвращается модель по умолчанию.

**Параметры**:
- `model` (str): Имя модели или псевдоним.

**Возвращает**:
- `str`: Имя модели.

**Как работает функция**:
1. Проверяет, есть ли модель в списке поддерживаемых моделей (`cls.models`).
2. Если модель не найдена, проверяет, есть ли она в словаре псевдонимов (`cls.model_aliases`).
3. Если модель не найдена ни в списке, ни в словаре, возвращает модель по умолчанию (`cls.default_model`).

```
Проверка наличия модели в списке поддерживаемых моделей
│
├── Да: Возврат имени модели
│
└── Нет: Проверка наличия модели в словаре псевдонимов
    │
    ├── Да: Возврат имени модели из словаря псевдонимов
    │
    └── Нет: Возврат модели по умолчанию
```

**Примеры**:

```python
GizAI.get_model('chat-gemini-flash') # Возвращает 'chat-gemini-flash'
GizAI.get_model('gemini-1.5-flash') # Возвращает 'chat-gemini-flash'
GizAI.get_model('unknown-model') # Возвращает 'chat-gemini-flash'
```

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        ...
```

**Назначение**: Создает асинхронный генератор для получения ответов от API GizAI.

**Параметры**:
- `model` (str): Имя модели для использования.
- `messages` (Messages): Список сообщений для отправки в API.
- `proxy` (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий ответы от API.

**Вызывает исключения**:
- `Exception`: Если статус ответа не равен 201.

**Как работает функция**:

1.  **Выбор модели**: Определяется, какая модель будет использоваться для генерации ответа. Если указанная модель (`model`) есть в списке поддерживаемых, она используется; иначе, если модель указана как псевдоним, используется соответствующая модель из `model_aliases`; в противном случае используется `default_model`.
2.  **Формирование заголовков**: Создаются заголовки HTTP-запроса, включая `User-Agent`, `Content-Type` и другие необходимые параметры.
3.  **Создание сессии aiohttp**: Используется `aiohttp.ClientSession` для асинхронного выполнения HTTP-запросов.
4.  **Формирование данных запроса**: Данные запроса формируются в формате JSON. Сообщения форматируются в зависимости от их роли (`system`, `user`, `ai`).
5.  **Отправка запроса и обработка ответа**: Отправляется POST-запрос к API-endpoint (`cls.api_endpoint`) с использованием `session.post`. Если статус ответа равен 201, извлекается текст ответа из JSON и возвращается через `yield`. В случае ошибки генерируется исключение с информацией о статусе ответа и текстом ошибки.

```
Выбор модели -> Формирование заголовков -> Создание сессии aiohttp -> Формирование данных запроса -> Отправка запроса и обработка ответа
```

**Примеры**:

```python
async def example():
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    async for response in GizAI.create_async_generator(model="chat-gemini-flash", messages=messages):
        print(response)

# Запуск примера
import asyncio
asyncio.run(example())
```
```python
async def example():
    messages = [
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": "What is the capital of France?"}
    ]
    async for response in GizAI.create_async_generator(model="chat-gemini-flash", messages=messages, proxy="http://proxy.example.com"):
        print(response)

# Запуск примера
import asyncio
asyncio.run(example())
```
## Функции

В данном модуле функции отсутствуют
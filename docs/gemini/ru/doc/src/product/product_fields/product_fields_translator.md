# Модуль product_fields_translator

## Обзор

Модуль `product_fields_translator` отвечает за перевод полей товара на языки клиентской базы данных. Он получает данные о полях товара (предоставленные из системы поставщика) и схему языков клиента, а затем обновляет идентификаторы языков в словаре полей товара, чтобы соответствовать схеме языков клиента.  При необходимости модуль также осуществляет перевод полей товара, используя данные из таблицы переводов.

## Функции

### `rearrange_language_keys`

**Описание**: Обновляет идентификатор языка в словаре `presta_fields_dict` на соответствующий идентификатор из схемы языков клиента (`client_langs_schema`) при совпадении языка страницы (`page_lang`).

**Параметры**:

- `presta_fields_dict` (dict): Словарь полей товара.
- `page_lang` (str): Язык страницы.
- `client_langs_schema` (list | dict): Схема языков клиента.

**Возвращает**:

- dict: Обновленный словарь `presta_fields_dict`.

**Вызывает исключения**:
- Нет


### `translate_presta_fields_dict`

**Описание**: Переводит мультиязычные поля товара в соответствии со схемой значений `id` языка в базе данных клиента.

**Параметры**:

- `presta_fields_dict` (dict): Словарь полей товара, полученный со страницы поставщика.  Ожидается, что мультиязычные поля будут иметь структуру:
```
{
    'language': [
        {'attrs': {'id': '1'}, 'value': 'значение'}
    ]
}
```
- `client_langs_schema` (list | dict): Словарь, содержащий актуальные языки клиента.  Ожидается, что содержит данные о языках в формате: `{'id': 'id_языка', 'iso_code': 'код_языка', 'locale': 'локаль', 'language_code': 'код_языка'}`.
- `page_lang` (str, optional): Язык страницы поставщика (en-US, ru-RU, he-HE). Если не задан, функция пытается определить язык по содержанию.


**Возвращает**:

- dict: Переведенный словарь полей товара.

**Вызывает исключения**:

- `ProductFieldException`: Возникает при ошибках во время обработки исключений при работе с переводами. Подробное описание ошибки выводится в лог.

**Примечания**:

- Функция ищет соответствие языка страницы с языками в схеме `client_langs_schema` по `locale`, `iso_code` и `language_code`.
- Функция использует данные из таблицы переводов (`enabled_product_translations`), чтобы получить переведенные значения для полей товара.
- Если в таблице переводов нет перевода для конкретного товара, функция создает новый запрос и добавляет перевод в таблицу.
-  Идентификаторы языков (`id`) в выходном словаре должны быть строками (`str`), чтобы избежать проблем с XML-парсером.
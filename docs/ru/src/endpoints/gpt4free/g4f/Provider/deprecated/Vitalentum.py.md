# Модуль Vitalentum

## Обзор

Модуль `Vitalentum` представляет собой асинхронный провайдер генерации текста, использующий API сервиса Vitalentum.io. Он предназначен для взаимодействия с моделью GPT-3.5 Turbo через асинхронные запросы. Модуль позволяет отправлять запросы к API Vitalentum и получать ответы в виде асинхронного генератора текста.

## Подробнее

Модуль `Vitalentum` является частью проекта `hypotez` и предназначен для интеграции с сервисом Vitalentum.io, предоставляющим API для взаимодействия с моделью GPT-3.5 Turbo. Модуль использует `aiohttp` для асинхронных HTTP-запросов и предоставляет класс `Vitalentum`, который наследуется от `AsyncGeneratorProvider`.

## Классы

### `Vitalentum`

**Описание**: Класс `Vitalentum` представляет собой асинхронный провайдер для взаимодействия с API Vitalentum.io.

**Наследует**:
- `AsyncGeneratorProvider`: Этот класс предоставляет базовую функциональность для асинхронных провайдеров генерации текста.

**Атрибуты**:
- `url` (str): URL сервиса Vitalentum.io.
- `supports_gpt_35_turbo` (bool): Указывает, что провайдер поддерживает модель GPT-3.5 Turbo.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API Vitalentum.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для получения ответов от API Vitalentum.

        Args:
            model (str): Название модели, используемой для генерации текста.
            messages (Messages): Список сообщений для отправки в API.
            proxy (str, optional): Прокси-сервер для использования при отправке запросов. По умолчанию `None`.
            **kwargs: Дополнительные аргументы для передачи в API.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий текст от API.

        Raises:
            aiohttp.ClientResponseError: Если возникает ошибка при отправке запроса к API.

        """
```

**Назначение**: Функция `create_async_generator` создает асинхронный генератор, который отправляет запросы к API Vitalentum и возвращает сгенерированный текст.

**Параметры**:
- `model` (str): Название модели, используемой для генерации текста. В данном случае ожидается `gpt-3.5-turbo`.
- `messages` (Messages): Список сообщений, представляющих историю разговора. Каждое сообщение содержит роль (`user` или `bot`) и содержимое (`content`).
- `proxy` (str, optional): Прокси-сервер для использования при отправке запросов. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы, которые могут быть переданы в API Vitalentum.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, который выдает части сгенерированного текста.

**Вызывает исключения**:
- `aiohttp.ClientResponseError`: Вызывается, если возникает HTTP ошибка при запросе к API Vitalentum.

**Как работает функция**:
1. **Формирование заголовков**: Функция создает заголовки HTTP-запроса, включая `User-Agent`, `Accept`, `Origin`, `Referer` и другие.
2. **Преобразование сообщений**: Список сообщений преобразуется в формат, ожидаемый API Vitalentum.
3. **Формирование данных запроса**: Данные запроса включают историю разговора, температуру и дополнительные аргументы.
4. **Отправка запроса**: Функция отправляет POST-запрос к API Vitalentum с использованием `aiohttp.ClientSession`.
5. **Обработка ответа**: Функция обрабатывает ответ от API, извлекая сгенерированный текст из JSON-ответа и выдавая его через генератор.
6. **Завершение генерации**: Генерация завершается, когда API возвращает сообщение `data: [DONE]`.

```
  Начало
     ↓
  Формирование HTTP заголовков
     ↓
  Преобразование сообщений в формат Vitalentum
     ↓
  Формирование данных запроса (conversation, temperature, kwargs)
     ↓
  Отправка POST запроса к API Vitalentum
     ↓
  Получение ответа от API
     ↓
  Извлечение сгенерированного текста из JSON
     ↓
  Выдача текста через генератор
     ↓
  Завершение при получении "data: [DONE]"
     ↓
  Конец
```

**Примеры**:

```python
# Пример использования create_async_generator
import asyncio
from typing import List, Dict

# from Vitalentum import Vitalentum  # Предполагается, что Vitalentum находится в этом же файле

async def main():
    messages: List[Dict[str, str]] = [
        {"role": "user", "content": "Привет, как дела?"},
        {"role": "bot", "content": "Привет! У меня все хорошо, спасибо, что спросили. Как я могу помочь вам сегодня?"}
    ]
    async for message in Vitalentum.create_async_generator(model="gpt-3.5-turbo", messages=messages):
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
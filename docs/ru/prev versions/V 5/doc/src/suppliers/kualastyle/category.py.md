# Модуль `category.py`

## Обзор

Модуль предназначен для сбора информации о товарах с сайта поставщика Kualastyle, начиная со страницы категорий. Он включает в себя функции для получения списка категорий и товаров в каждой категории, используя веб-драйвер для навигации по сайту.

## Подробней

Модуль является частью процесса сбора данных о товарах с сайтов поставщиков для проекта `hypotez`. Он содержит логику для взаимодействия с веб-страницами категорий Kualastyle, извлечения ссылок на товары и передачи этих ссылок для дальнейшей обработки. Модуль использует веб-драйвер для эмуляции действий пользователя на сайте, таких как прокрутка страниц и нажатие на элементы.

## Функции

### `get_list_products_in_category`

```python
def get_list_products_in_category (s: Supplier) -> list[str, str, None]:
    """ Returns list of products urls from category page
    Если надо пролистстать - страницы категорий - листаю ??????

    Attrs:
        s - Supplier
    @returns
        list or one of products urls or None
    """
    ...
    d:Driver = s.driver
    l: dict = s.locators['category']
    ...
    d.wait(1)
    d.execute_locator (s.locators ['product']['close_banner'] )
    d.scroll()
    ...

    list_products_in_category: List = d.execute_locator(l['product_links'])

    if not list_products_in_category:
        logger.warning('Нет ссылок на товары. Так бывает')
        ...
        return
    ...
    while d.current_url != d.previous_url:
        if paginator(d,l,list_products_in_category):
            list_products_in_category.append(d.execute_locator(l['product_links']))
        else:
            break
        
    list_products_in_category = [list_products_in_category] if isinstance(list_products_in_category, str) else list_products_in_category

    logger.debug(f""" Found {len(list_products_in_category)} items in category {s.current_scenario['name']} """)
    
    return list_products_in_category
```

**Описание**: Возвращает список URL товаров со страницы категории.

**Как работает функция**:
1.  Извлекает объект `Driver` и локаторы из объекта `Supplier`.
2.  Выполняет ожидание в течение 1 секунды.
3.  Закрывает баннер, используя локатор.
4.  Прокручивает страницу вниз.
5.  Извлекает список ссылок на товары, используя локатор `product_links`.
6.  Если список ссылок пуст, записывает предупреждение в лог и возвращает `None`.
7.  Проверяет, изменился ли текущий URL страницы. Если изменился, вызывает функцию `paginator` для перехода на следующую страницу.
8.  Добавляет новые ссылки на товары в список.
9.  Преобразует список ссылок, если он является строкой.
10. Записывает отладочное сообщение в лог с количеством найденных товаров в категории.
11. Возвращает список URL товаров.

**Параметры**:

*   `s` (Supplier): Объект поставщика, содержащий информацию о текущем поставщике, включая веб-драйвер и локаторы элементов страницы.

**Возвращает**:

*   `list[str, str, None]`: Список URL товаров в категории. Может вернуть `None`, если список товаров не найден.

### `paginator`

```python
def paginator(d:Driver, locator: dict, list_products_in_category: list):
    """ Листалка """
    response = d.execute_locator(locator['pagination']['<-'])
    if not response or (isinstance(response, list) and len(response) == 0): 
        ...
        return
    return True
```

**Описание**: Осуществляет переход на следующую страницу категории, если это возможно.

**Как работает функция**:

1.  Извлекает локатор для кнопки пагинации (обычно кнопка "назад").
2.  Выполняет нажатие на кнопку пагинации с помощью веб-драйвера.
3.  Проверяет, был ли получен ответ от нажатия кнопки. Если ответа нет или получен пустой список, возвращает `None`.
4.  Если ответ получен, возвращает `True`.

**Параметры**:

*   `d` (Driver): Объект веб-драйвера.
*   `locator` (dict): Словарь локаторов элементов страницы.
*   `list_products_in_category` (list): Список URL товаров в текущей категории.

**Возвращает**:

*   `True`: Если переход на следующую страницу был выполнен успешно.
*   `None`: Если переход на следующую страницу невозможен.

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s):
    """ сборщик актуальных категорий с сайта """
    ...
```

**Описание**: Собирает актуальный список категорий с сайта.

**Как работает функция**:
    <инструкция для модели gemini:Опиши подробно логику работы функции `get_list_categories_from_site`. Предоставь информацию о том, как функция взаимодействует с сайтом, какие данные извлекает и как они обрабатываются.  Опиши, какие локаторы используются для поиска элементов категорий на странице, и как функция обрабатывает случаи, когда категории не найдены или возникают ошибки при их извлечении.  Укажи, какие проверки и условия используются для определения актуальности категорий, и как функция адаптируется к изменениям в структуре сайта.>

**Параметры**:

*   `s`: Параметр не документирован.

**Возвращает**:

*   Возвращаемое значение не документировано.
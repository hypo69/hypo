# Модуль `campaign` для управления рекламными кампаниями AliExpress

## Обзор

Модуль `campaign` системы AliExpress предназначен для управления и редактирования рекламных кампаний, взаимодействия с Google Таблицами для получения данных и подготовки данных кампании для использования.  Ниже представлен общий обзор алгоритма и рабочего процесса модуля.

**Структура модуля:**

Модуль состоит из нескольких файлов и функций, отвечающих за разные этапы работы с кампаниями:

* **`AliPromoCampaign` (предполагаемо `ali_promo_campaign.py`):**  Класс для работы с одной кампанией.
    * **`__init__`:** Инициализирует объект кампании, загружает данные из Google Диска, инициализирует переменные `campaign_root`, `category_root`, загружает данные из JSON.  Важно, что  `force_update` используется для перегрузки данных.
    * **`initialize_campaign`:**  Создает объект `SimpleNamespace` для хранения данных кампании (`self.campaign`) и получает заголовок кампании (`self.title`).  Критично, что исправлено получение информации о категории (`self.category`).
    * **`get_category_from_campaign`:** Получает категорию из данных кампании.
    * **`get_category_products`:**  Получает продукты для данной категории, загружая данные из JSON-файлов.
    * **`create_product_namespace`:** Создает объект `SimpleNamespace` для хранения данных о продуктах.
    * **`create_campaign_namespace`:** Создает объект `SimpleNamespace` для хранения данных о кампании.
    * **`prepare_products`:** Подготавливает данные о продуктах для дальнейшего использования (вероятно, для обработки партнерских ссылок).  Это сложная функция, включающая чтение из файлов `sources.txt` и `sources.csv`,  извлечение идентификаторов продуктов (`extract_prod_ids`) и обработку партнерских продуктов.

**Взаимодействие с Google Таблицами:**

Модуль использует Google Sheets API (через `gsheet.py`) для чтения и записи данных о кампаниях.  Настройка доступа осуществляется через `src.settings.gs`.

**Обработка JSON:**

Файлы JSON с данными кампаний и продуктов обрабатываются через функции `j_loads_ns` и `j_loads` из модуля `src.utils`.

**Поддержка и общие функции:**

Используются стандартные модули Python, функции для обработки файлов, работы с данными (включая CSV), а также собственные инструменты и классы из `src.utils` (конвертеры,  работа с файлами).

## Алгоритм

1. **Инициализация:** Модуль импортирует необходимые библиотеки и настраивает параметры (возможно, из файла настроек).
2. **Редактирование кампаний:** `ali_campaign_editor.py` содержит основную логику для создания, обновления и управления данными кампаний, используя API Google Таблиц и класс `AliCampaignGoogleSheet`.
3. **Управление рекламными кампаниями:** `ali_promo_campaign.py` управляет рекламными кампаниями, обрабатывая стратегии и конфигурации.
4. **Взаимодействие с Google Таблицами:** `gsheet.py` управляет чтением и записью данных о кампаниях из Google Таблиц.
5. **Подготовка данных:** `prepare_campaigns.py` подготавливает данные о кампаниях для выполнения (предобработка, валидация).
6. **Общие функции:** `header.py` содержит общие функции для повторного использования.
7. **Тестирование:** Модуль сопровождается тестами в `_pytest` для проверки корректности работы.
8. **Документация:** `_docs` содержит подробную документацию.

## Примеры использования

Примеры кода демонстрируют обработку отдельных категорий кампаний, конкретных кампаний и всех кампаний с различными параметрами языка и валюты.  В примерах демонстрируется использование `force=True` для принудительной перезагрузки данных.

## Заключение

Модуль `campaign` предоставляет структурированный подход к управлению и редактированию рекламных кампаний AliExpress, с интеграцией в Google Таблицы для управления данными. Подробная документация и примеры использования помогут разработчикам эффективно использовать модуль.


**Ключевые улучшения:**

* **Явное использование `SimpleNamespace`:**  Для хранения данных кампании и продуктов.
* **Исправленное получение категории:** Избегаем потенциальных ошибок, когда атрибут `category` может отсутствовать.
* **`force_update`:** Для принудительной перезагрузки данных из Google Таблиц.
* **Ясность в названиях функций и переменных:** Повышает читаемость и понимание кода.
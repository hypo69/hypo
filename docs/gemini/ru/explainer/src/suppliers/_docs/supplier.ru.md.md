## <алгоритм>

Класс `Supplier` является базовым классом для работы с поставщиками данных. Он предоставляет общую структуру и функциональность, которая может быть расширена или переопределена в конкретных реализациях для разных поставщиков (например, Amazon, AliExpress, Walmart).

**Пошаговая блок-схема:**

1.  **Инициализация (Constructor `__init__`)**:
    *   При создании объекта `Supplier` вызывается конструктор `__init__`, который принимает `supplier_prefix` (строка, например, "aliexpress") и `locale` (строка, например, "en"). Также принимает `webdriver` (строка "default" или объект `Driver`).
    *   Инициализируются атрибуты `supplier_id`, `supplier_prefix`, `locale`, а также переменная `webdriver`.
    *   Вызывается метод `_payload` для загрузки настроек и инициализации веб-драйвера.
    *   **Пример:** `supplier = Supplier(supplier_prefix='aliexpress', locale='en', webdriver='chrome')`

2.  **Загрузка настроек (`_payload`)**:
    *   Метод `_payload` загружает конфигурацию поставщика, включая `supplier_settings`, `price_rule`, `related_modules`, `scenario_files`, `login_data` и `locators` из файлов конфигурации (например, JSON).
    *   Инициализирует `driver` (веб-драйвер) на основе параметра `webdriver` (например, Chrome, Firefox).
    *   **Пример:** Загрузка настроек для `aliexpress`, локаторов для элементов на странице, правил расчета цены.

3.  **Вход на сайт (`login`)**:
    *   Метод `login` предназначен для выполнения входа на сайт поставщика, если это необходимо.
    *   Использует `login_data` (логин и пароль) и веб-драйвер `driver` для входа.
    *   **Пример:** Ввод логина и пароля на странице авторизации AliExpress.

4.  **Запуск сценариев (`run_scenario_files`, `run_scenarios`)**:
    *   Метод `run_scenario_files` принимает список файлов сценариев (`scenario_files`). Каждый файл содержит описание действий (например, поиск товара, добавление в корзину).
    *   Метод `run_scenarios` принимает список или словарь сценариев.
    *   Итерируется по файлам сценариев или сценариям, выполняя каждый из них.
    *   **Пример:** Запуск сценария из `product_search.json` для поиска и сбора данных о товарах.

**Поток данных:**

*   `__init__` → `_payload` → `driver`
*   `_payload` → загрузка настроек
*   `login` →  использование `driver` для входа
*   `run_scenario_files` →  чтение `scenario_files` и их выполнение
*   `run_scenarios` → выполнение `scenarios`

## <mermaid>

```mermaid
flowchart TD
    Start[Начало] --> Init[<code>__init__</code>: Инициализация класса Supplier];
    Init --> Payload[<code>_payload</code>: Загрузка настроек]
    Payload --> LoadSettings[Загрузка настроек поставщика <br>(supplier_settings, price_rule, и т.д.)];
    LoadSettings --> InitDriver[Инициализация веб-драйвера <br>(driver)];
    InitDriver --> LoginCheck{Нужен ли вход на сайт?};
    LoginCheck -- Да --> Login[<code>login</code>: Вход на сайт поставщика];
    LoginCheck -- Нет --> RunScenarios;
    Login --> RunScenarios;
    RunScenarios --> RunFilesCheck{Запустить из файлов?};
     RunFilesCheck -- Да --> RunScenarioFiles[<code>run_scenario_files</code>: Запуск сценариев из файлов];
     RunFilesCheck -- Нет --> RunScenariosDef[<code>run_scenarios</code>: Запуск сценариев из списка/словаря];
     RunScenarioFiles --> LoopFiles[Цикл по файлам сценариев];
    LoopFiles --> ExecuteScenarioFile[Выполнение сценария из файла];
    ExecuteScenarioFile --> RunComplete;
     RunScenariosDef --> LoopScenarios[Цикл по сценариям]
     LoopScenarios --> ExecuteScenarioDef[Выполнение сценария]
     ExecuteScenarioDef --> RunComplete;
    RunComplete[Конец выполнения];

```

**Объяснение `mermaid` диаграммы:**

*   `Start`: Начальная точка выполнения кода.
*   `Init`: Вызывается конструктор `__init__` класса `Supplier` для инициализации атрибутов объекта, включая `supplier_prefix`, `locale` и `webdriver`.
*   `Payload`: Метод `_payload` загружает настройки поставщика из конфигурационных файлов и инициализирует веб-драйвер (`driver`).
*   `LoadSettings`: Загружает настройки поставщика, такие как правила расчета цены, связанные модули, файлы сценариев, данные для входа и локаторы.
*   `InitDriver`: Создает экземпляр веб-драйвера на основе параметра `webdriver` (например, `chrome`, `firefox`).
*   `LoginCheck`: Проверяет, требуется ли вход на сайт поставщика.
*    `Login`: Метод `login` выполняет вход на сайт поставщика, используя `login_data` и `driver`.
*   `RunScenarios`: Переходит к выполнению сценариев.
*   `RunFilesCheck`: Проверяет, нужно ли запускать сценарии из файлов.
*   `RunScenarioFiles`: Вызывает метод `run_scenario_files` для запуска сценариев, определенных в файлах.
*   `RunScenariosDef`: Вызывает метод `run_scenarios` для запуска сценариев, определенных в списке или словаре.
*   `LoopFiles`: Цикл для прохода по файлам сценариев.
*   `ExecuteScenarioFile`: Выполняет сценарий, считанный из файла.
*   `LoopScenarios`: Цикл для прохода по сценариям.
*   `ExecuteScenarioDef`: Выполняет сценарий.
*   `RunComplete`: Конечная точка выполнения кода.

## <объяснение>

**Импорты:**

В предоставленном коде нет явных импортов, но в реальном коде могут быть импорты из:

*   `src.config.settings`: Для загрузки общих настроек приложения.
*   `src.config.supplier_settings`: Для загрузки настроек конкретного поставщика.
*   `src.drivers.driver`: Для управления веб-драйвером.
*   `src.utils.logger`: Для логирования.
*   `src.scenarios`: Для работы со сценариями.
*   `src.utils.exceptions`: Для обработки исключений.

**Класс `Supplier`:**

*   **Роль:** Базовый класс для всех поставщиков данных. Он определяет общую логику работы с данными от различных источников, таких как сайты электронной коммерции.
*   **Атрибуты:**
    *   `supplier_id`: Уникальный идентификатор поставщика (генерируется на основе `supplier_prefix`).
    *   `supplier_prefix`: Префикс поставщика (например, "aliexpress", "amazon").
    *   `supplier_settings`: Настройки, специфичные для поставщика.
    *   `locale`: Код локализации (например, "en", "ru").
    *   `price_rule`: Правило для расчета цены (например, наценка, скидка).
    *   `related_modules`: Модули, содержащие специфические для поставщика функции.
    *   `scenario_files`: Список файлов сценариев для выполнения.
    *   `current_scenario`: Текущий выполняемый сценарий.
    *   `login_data`: Данные для входа на сайт поставщика.
    *   `locators`: Локаторы для веб-элементов на страницах сайта поставщика.
    *   `driver`: Экземпляр веб-драйвера для взаимодействия с сайтом.
    *    `parsing_method`: Метод парсинга данных (например, `webdriver`, `api`, `xls`, `csv`).
*   **Методы:**
    *   `__init__`: Конструктор класса, инициализирует атрибуты на основе параметров поставщика.
    *   `_payload`: Загружает настройки поставщика, инициализирует веб-драйвер.
    *   `login`: Выполняет вход на сайт поставщика (если требуется).
    *   `run_scenario_files`: Запускает выполнение файлов сценариев.
    *   `run_scenarios`: Запускает сценарии, определенные как словари или списки словарей.

**Функции:**

*   `__init__`:
    *   **Аргументы:**
        *   `supplier_prefix` (str): Префикс поставщика.
        *   `locale` (str): Код локали (по умолчанию "en").
        *   `webdriver` (str | Driver | bool): Тип веб-драйвера ("default", "chrome", объект драйвера, `False` если не требуется).
    *   **Возвращает:** None.
    *   **Назначение:** Инициализирует объект класса `Supplier`, загружая общие настройки и настройки поставщика.
*   `_payload`:
    *   **Аргументы:**
        *    `webdriver` (str | Driver | bool): Тип веб-драйвера
    *   **Возвращает:** `bool` (True в случае успеха).
    *   **Назначение:** Загружает конфигурационные данные (например, локаторы, сценарии) для поставщика, инициализирует веб-драйвер.
*   `login`:
    *   **Аргументы:** None.
    *   **Возвращает:** `bool` (True в случае успеха).
    *   **Назначение:** Выполняет вход на сайт поставщика, если это необходимо.
*   `run_scenario_files`:
    *   **Аргументы:**
        *   `scenario_files` (str | List[str]): Путь к файлу или список файлов со сценариями.
    *   **Возвращает:** `bool` (True в случае успеха).
    *   **Назначение:** Запускает сценарии, определенные в файлах.
*   `run_scenarios`:
    *   **Аргументы:**
        *   `scenarios` (dict | list[dict]): Сценарии для выполнения.
    *   **Возвращает:** `bool` (True в случае успеха).
    *   **Назначение:** Запускает сценарии из заданных словарей.

**Переменные:**

*   Переменные используются для хранения настроек, данных для входа, локаторов и других параметров, необходимых для работы поставщика.
*   Типы переменных: строки (`str`), словари (`dict`), списки (`list`), объекты `Driver`.

**Потенциальные ошибки и области для улучшения:**

*   **Обработка ошибок:** Недостаточно обработаны исключения. Нужно добавить более детальную обработку ошибок при загрузке настроек, входе на сайт, запуске сценариев.
*   **Абстракция драйвера:** Можно сделать класс `Driver` более абстрактным, чтобы он поддерживал разные веб-драйверы (например, Selenium, Playwright) с минимальными изменениями.
*   **Логирование:**  Добавить логирование всех важных событий (например, начало и конец работы функций, ошибки).
*   **Конфигурация:**  Нужно сделать загрузку конфигураций более гибкой (например, из разных источников, с возможностью переопределения).
*   **Параллелизация:**  Для ускорения работы можно рассмотреть возможность параллельного запуска нескольких сценариев.
*   **Типизация:** Использовать аннотации типов (type hints) для улучшения читаемости и облегчения отладки.

**Взаимосвязи с другими частями проекта:**

*   **`src.config`:** Класс `Supplier` зависит от модулей конфигурации для загрузки настроек.
*   **`src.drivers`:** Класс `Supplier` зависит от модуля `src.drivers` для работы с веб-драйверами.
*   **`src.scenarios`:** Класс `Supplier` использует модули сценариев для загрузки и выполнения последовательностей действий.
*   **`src.utils`:** Класс `Supplier` может использовать модули логирования и исключений для обработки ошибок.

Этот класс является важным компонентом для масштабируемости проекта, позволяя добавлять поддержку новых поставщиков данных без необходимости переписывать большую часть кода.
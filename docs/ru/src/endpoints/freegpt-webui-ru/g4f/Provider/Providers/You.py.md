# Модуль для интеграции с You.com

## Обзор

Этот модуль предоставляет функциональность для взаимодействия с моделью `gpt-3.5-turbo` через API `You.com`. Он использует подпроцесс для выполнения Python-скрипта `you.py`, который, в свою очередь, взаимодействует с `You.com`. Модуль поддерживает потоковую передачу данных и не требует аутентификации.

## Подробней

Модуль предназначен для отправки запросов к `You.com` и получения ответов в потоковом режиме. Он использует подпроцесс для запуска скрипта `you.py`, который выполняет всю логику взаимодействия с API `You.com`. Это позволяет избежать блокировки основного процесса и обеспечивает асинхронное получение данных.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """Функция создает запрос к You.com и возвращает ответ в потоковом режиме.

    Args:
        model (str): Название модели, используемой для генерации ответа.
        messages (list): Список сообщений для отправки в You.com.
        stream (bool): Флаг, указывающий, нужно ли возвращать ответ в потоковом режиме.
        **kwargs: Дополнительные аргументы.

    Returns:
        Generator[str, None, None]: Генератор строк, представляющих ответ от You.com.

    Raises:
        Exception: Если происходит ошибка при выполнении подпроцесса.

    Example:
        >>> messages = [{"role": "user", "content": "Hello, You.com!"}]
        >>> for chunk in _create_completion(model='gpt-3.5-turbo', messages=messages, stream=True):
        ...     print(chunk, end='')
        Hello, You.com!
    """
```

**Назначение**: Создает запрос к `You.com` и возвращает ответ в потоковом режиме.

**Параметры**:

- `model` (str): Название модели, используемой для генерации ответа.
- `messages` (list): Список сообщений для отправки в `You.com`. Каждое сообщение представляет собой словарь с ключами `role` и `content`.
- `stream` (bool): Флаг, указывающий, нужно ли возвращать ответ в потоковом режиме. Если `True`, функция возвращает генератор, который выдает части ответа по мере их поступления.
- `**kwargs`: Дополнительные аргументы, которые могут быть переданы в `You.com`.

**Возвращает**:

- `Generator[str, None, None]`: Генератор строк, представляющих ответ от `You.com`. Каждая строка является частью ответа.

**Вызывает исключения**:

- `Exception`: Если происходит ошибка при выполнении подпроцесса.

**Как работает функция**:

1.  **Получение пути к файлу**: Функция определяет путь к текущему файлу, чтобы затем использовать его для запуска скрипта `you.py`.
2.  **Формирование конфигурации**: Создается JSON-строка, содержащая список сообщений, предназначенных для отправки в `You.com`.
3.  **Запуск подпроцесса**: Функция запускает подпроцесс `you.py` с использованием `subprocess.Popen`. Скрипту передается конфигурация в виде аргумента командной строки.
4.  **Чтение вывода подпроцесса**: Функция читает вывод подпроцесса построчно и возвращает его в виде генератора. Каждая строка вывода декодируется из UTF-8.

```
    A(Определение пути к файлу)
    │
    ├───> B(Формирование JSON-конфигурации)
    │
    ├───> C(Запуск подпроцесса you.py)
    │
    └───> D(Чтение вывода подпроцесса и генерация результата)
```

**Примеры**:

```python
messages = [{"role": "user", "content": "Hello, You.com!"}]
for chunk in _create_completion(model='gpt-3.5-turbo', messages=messages, stream=True):
    print(chunk, end='')
```

```python
messages = [{"role": "user", "content": "Как дела?"}]
for chunk in _create_completion(model='gpt-3.5-turbo', messages=messages, stream=True):
    print(chunk, end='')
Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код JavaScript реализует функциональность для обработки запросов, связанных с XPath-выражениями, и управлением фокусом на элементах веб-страницы. Он взаимодействует с расширением браузера (через `browser.runtime.sendMessage`) для получения и обработки стилей, управления контекстом XPath и фокусировки элементов.  Код обрабатывает различные типы сообщений, включая запросы на выполнение XPath-выражений, обновление стилей, фокусировку элементов и фреймов, а также восстановление первоначальных атрибутов.  Он также умеет определять и работать с фреймами, включая пустые вложенные фреймы.

Шаги выполнения
-------------------------
1. **Обработка сообщений:** Код слушает сообщения, отправленные расширением браузера или другими вложенными фреймами.  Различные обработчики (`genericListener.listeners`) реагируют на различные типы сообщений.
2. **Инициализация:**  При загрузке страницы (`window.addEventListener("message")`) устанавливается слушатель сообщений и инициализируется переменные для хранения контекста, результатов выполнения, текущих элементов, а также состояния фокусировки.
3. **Обработка запросов на выполнение XPath:**  При поступлении сообщения с запросом на выполнение XPath-выражения (`genericListener.listeners.execute`):
    - Проверяет наличие фреймов и обрабатывает вложенные запросы.
    - Выполняет XPath-выражение, используя `fu.execExpr`, с заданным контекстом.
    - Собирает и сохраняет результат выполнения в `sendMsg`.
    - Отправляет результат расширению браузера.
4. **Обработка запросов на фокусировку:** Обрабатывает запросы на фокусировку элемента (`genericListener.listeners.focusItem`, `genericListener.listeners.focusContextItem`).
5. **Обновление стилей:**  Обновляет стили элементов на странице, взаимодействуя с расширением браузера (`browser.runtime.sendMessage`).
6. **Обработка запросов на фокусировку фреймов:** Обрабатывает запросы на фокусировку фреймов (`genericListener.listeners.focusFrame`).
    - Выполняет поиск фрейма.
    - Отправляет сообщение родительскому фрейму для фокусировки.
7. **Восстановление атрибутов:** При необходимости (`genericListener.listeners.resetStyle`) восстанавливает первоначальные значения атрибутов.
8. **Обработка изменений в хранилище:**  Слушает изменения в хранилище данных браузера (`browser.storage.onChanged.addListener`) и обновляет значения атрибутов, если они изменены.

Пример использования
-------------------------
.. code-block:: javascript
    // Отправка запроса на выполнение XPath-выражения
    browser.runtime.sendMessage({
        "event": "execute",
        "main": {
            "method": "evaluate",
            "expression": "//div[@class='myClass']",
            "specifiedResultType": "ANY_TYPE(0)",
            "resolver": ""
        }
    });
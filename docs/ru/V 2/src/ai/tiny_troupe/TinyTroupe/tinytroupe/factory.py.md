# tinytroupe.factory

## Обзор

Модуль содержит классы `TinyFactory` и `TinyPersonFactory`, которые служат для создания и управления агентами в симуляциях. `TinyFactory` является базовым классом для различных типов фабрик и обеспечивает поддержку транзакционного кэширования. `TinyPersonFactory` предназначен для создания агентов типа `TinyPerson` с использованием OpenAI LLM.

## Содержание

- [Классы](#классы)
  - [TinyFactory](#tinyfactory)
    - [Методы](#методы-tinyfactory)
  - [TinyPersonFactory](#tinypersonfactory)
    - [Методы](#методы-tinypersonfactory)

## Классы

### `TinyFactory`

**Описание**: Базовый класс для различных типов фабрик. Обеспечивает поддержку транзакционного кэширования.

#### Методы `TinyFactory`

#### `__init__`

**Описание**: Инициализирует экземпляр `TinyFactory`.

**Параметры**:
- `simulation_id` (str, optional): ID симуляции. По умолчанию `None`.

#### `__repr__`

**Описание**: Возвращает строковое представление объекта.

**Возвращает**:
- `str`: Строковое представление объекта `TinyFactory`.

#### `set_simulation_for_free_factories`

**Описание**: Устанавливает симуляцию для фабрик, у которых `simulation_id` равен `None`.

**Параметры**:
- `simulation` (obj): Симуляция, которую нужно установить.

#### `add_factory`

**Описание**: Добавляет фабрику в глобальный список всех фабрик.

**Параметры**:
- `factory` (obj): Фабрика, которую нужно добавить.

**Вызывает исключения**:
- `ValueError`: Если фабрика с таким именем уже существует.

#### `clear_factories`

**Описание**: Очищает глобальный список всех фабрик.

#### `encode_complete_state`

**Описание**: Кодирует полное состояние фабрики.

**Возвращает**:
- `dict`: Словарь, представляющий полное состояние фабрики.

#### `decode_complete_state`

**Описание**: Декодирует полное состояние фабрики.

**Параметры**:
- `state` (dict): Словарь, представляющий состояние фабрики.

**Возвращает**:
- `obj`: Экземпляр `TinyFactory` с декодированным состоянием.

### `TinyPersonFactory`

**Описание**: Класс для создания агентов `TinyPerson` с использованием OpenAI LLM.

#### Методы `TinyPersonFactory`

#### `__init__`

**Описание**: Инициализирует экземпляр `TinyPersonFactory`.

**Параметры**:
- `context_text` (str): Контекстный текст, используемый для генерации экземпляров `TinyPerson`.
- `simulation_id` (str, optional): ID симуляции. По умолчанию `None`.

#### `generate_person_factories`

**Описание**: Генерирует список экземпляров `TinyPersonFactory` с использованием OpenAI LLM.

**Параметры**:
- `number_of_factories` (int): Количество экземпляров `TinyPersonFactory` для генерации.
- `generic_context_text` (str): Общий контекстный текст для генерации фабрик.

**Возвращает**:
- `list`: Список экземпляров `TinyPersonFactory`. Возвращает `None` в случае ошибки.

#### `generate_person`

**Описание**: Генерирует экземпляр `TinyPerson` с использованием OpenAI LLM.

**Параметры**:
- `agent_particularities` (str): Особенности агента.
- `temperature` (float, optional): Температура для сэмплирования из LLM. По умолчанию 1.5.
- `attepmpts` (int, optional): Количество попыток генерации агента. По умолчанию 5.

**Возвращает**:
- `TinyPerson`: Экземпляр `TinyPerson`, сгенерированный с использованием LLM. Возвращает `None`, если не удалось сгенерировать агента.

#### `_aux_model_call`

**Описание**: Вспомогательный метод для вызова модели. Необходим для использования декоратора `transactional`.

**Параметры**:
- `messages` (list): Список сообщений для отправки в модель.
- `temperature` (float): Температура для сэмплирования из LLM.

**Возвращает**:
- `dict`: Ответ от модели.

#### `_setup_agent`

**Описание**: Настраивает агента необходимыми элементами.

**Параметры**:
- `agent` (obj): Агент, которого нужно настроить.
- `configuration` (dict): Конфигурация агента.
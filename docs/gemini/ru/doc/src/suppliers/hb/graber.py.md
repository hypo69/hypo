# Модуль `src.suppliers.hb.graber`

## Обзор

Модуль `src.suppliers.hb.graber` предназначен для сбора информации о товарах с сайта `hb.co.il`. Он наследует функциональность от родительского класса `Graber` и предоставляет возможность переопределять методы обработки полей товара для нестандартных случаев. Модуль использует декоратор для выполнения предварительных действий перед отправкой запроса к веб-драйверу.

## Подробней

Этот модуль является частью системы сбора данных о товарах для проекта `hypotez`. Он специализируется на парсинге данных с сайта `hb.co.il`. Если для какого-либо поля товара требуется нестандартная обработка, соответствующая функция перегружается в этом классе. Перед отправкой запроса к веб-драйверу, модуль может выполнять предварительные действия с использованием декоратора.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для сбора данных о товарах с сайта `hb.co.il`. Он наследуется от класса `Graber` (который, вероятно, является базовым классом для парсеров) и переопределяет некоторые методы для адаптации к особенностям сайта `hb.co.il`.

**Как работает класс**:
1.  Класс инициализируется с драйвером веб-браузера и индексом языка.
2.  Устанавливается префикс поставщика `hb`.
3.  При необходимости, устанавливается локатор для выполнения предварительных действий через декоратор `@close_pop_up`.

**Методы**:

-   `__init__(self, driver: Driver, lang_index)`: Инициализирует класс `Graber` с заданным драйвером и индексом языка.

    **Параметры**:
    -   `driver` (`Driver`): Экземпляр веб-драйвера для управления браузером.
    -   `lang_index` (`int`): Индекс языка, используемый при сборе данных.

    **Как работает метод**:
    1.  Устанавливает атрибут `supplier_prefix` равным `'hb'`.
    2.  Вызывает конструктор родительского класса `Graber` с установленным префиксом поставщика, драйвером и индексом языка.
    3.  Устанавливает `Context.locator_for_decorator` в `None`, что указывает на отсутствие необходимости выполнения предварительных действий через декоратор `@close_pop_up`.

```python
    def __init__(self, driver: Driver, lang_index):
        """Инициализация класса сбора полей товара."""
        self.supplier_prefix = 'hb'
        super().__init__(supplier_prefix=self.supplier_prefix, driver=driver, lang_index=lang_index)
        # Устанавливаем глобальные настройки через Context
        
        Context.locator_for_decorator = None # <- если будет уастановлено значение - то оно выполнится в декораторе `@close_pop_up`
```
## Функции

### `close_pop_up`

```python
def close_pop_up(value: Any = None):
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```

**Описание**:
Функция `close_pop_up` является декоратором, предназначенным для закрытия всплывающих окон на веб-странице перед выполнением основной логики декорируемой функции.

**Параметры**:
- `value` (Any, optional): Дополнительное значение, которое может быть передано декоратору. По умолчанию `None`.

**Возвращает**:
- `Callable`: Декоратор, который оборачивает функцию.

**Как работает функция**:

1.  Функция `close_pop_up` принимает необязательный параметр `value`.
2.  Она определяет внутреннюю функцию `decorator`, которая принимает функцию `func` в качестве аргумента.
3.  Внутри `decorator` определяется асинхронная функция `wrapper`, которая будет выполняться вместо декорируемой функции `func`.
4.  Внутри `wrapper` происходит попытка закрытия всплывающего окна с использованием `Context.driver.execute_locator(Context.locator.close_pop_up)`.
5.  Если возникает исключение `ExecuteLocatorException` при выполнении локатора, оно логируется с уровнем `DEBUG`.
6.  После обработки всплывающего окна вызывается основная функция `func` с помощью `await func(*args, **kwargs)`.
7.  Функция `decorator` возвращает функцию `wrapper`.
8.  Функция `close_pop_up` возвращает функцию `decorator`.

**Пример использования**:

Предположим, у нас есть функция `get_product_details`, которая извлекает детали продукта с веб-страницы. Иногда на странице появляется всплывающее окно, которое нужно закрыть перед извлечением деталей. Мы можем использовать декоратор `close_pop_up` для автоматического закрытия всплывающего окна:

```python
from src.suppliers.graber import Context
from src.webdriver.driver import Driver

# Пример использования декоратора
# @close_pop_up()
# async def get_product_details(product_url: str) -> dict:
#     """Извлекает детали продукта с веб-страницы."""
#     ...
```

В этом примере декоратор `@close_pop_up()` будет выполнен перед вызовом функции `get_product_details`, и он попытается закрыть всплывающее окно, если оно присутствует на странице.
```
"""
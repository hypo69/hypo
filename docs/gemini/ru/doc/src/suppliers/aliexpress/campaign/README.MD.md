# Модуль `src.suppliers.aliexpress.campaign`

## Обзор

Модуль `campaign` предназначен для управления процессом создания и публикации рекламных кампаний на Facebook. Он включает в себя функциональность для инициализации параметров кампании (название, язык, валюта), создания структуры каталогов, сохранения конфигурации для новой кампании, сбора и сохранения данных о продуктах с помощью `ali` или `html`, генерации рекламных материалов, проверки кампании и публикации ее на Facebook.

## Оглавление

1. [Обзор](#обзор)
2. [Логика создания кампании](#логика-создания-кампании)
3. [Логика редактирования кампании](#логика-редактирования-кампании)
4. [Логика подготовки кампании](#логика-подготовки-кампании)

## Логика создания кампании

```mermaid
flowchart TD
    A[Start: Создание рекламной кампании для размещения в Facebook] --> B[Инициализация названия, языка и валюты кампании]
    B --> C[Создание каталогов кампании и категорий]
    C --> D[Сохранение конфигурации кампании]
    D --> E[Сбор данных о продуктах]
    E --> F[Сохранение данных о продуктах]
    F --> G[Создание рекламных материалов]
    G --> H[Проверка кампании]
    H --> I{Кампания готова?}
    I -- Yes --> J[Публикация кампании на Facebook]
    I -- No --> H
    J --> K[End: Завершение создания рекламной кампании]
```

- **Шаг 1**: Старт - Начало процесса.

- **Шаг 2**: Инициализация деталей кампании - Определяется название кампании, язык и валюта. Пример: Название кампании: "Летняя распродажа", Язык: "Русский", Валюта: "USD".

- **Шаг 3**: Создание каталогов кампании и категорий - Создаются необходимые каталоги или файлы для кампании. Пример: Создается структура папок в файловой системе для хранения активов кампании.

- **Шаг 4**: Сохранение конфигурации кампании - Сохранены инициализированные детали кампании. Пример: Данные записываются в базу данных или файл конфигурации.

- **Шаг 5**: Сбор данных о продуктах - Собираются данные о продуктах, которые будут продвигаться в рамках кампании. Пример: Идентификаторы продуктов, описания, изображения и цены берутся из системы инвентаризации.

- **Шаг 6**: Сохранение данных о продуктах - Сохранены собранные данные о продуктах. Пример: Данные записываются в таблицу базы данных, предназначенную для продуктов кампании.

- **Шаг 7**: Создание рекламных материалов - Сгенерированы или выбраны графические материалы, баннеры и другие рекламные активы. Пример: Изображения и описания адаптированы для привлечения клиентов.

- **Шаг 8**: Проверка кампании - Процесс проверки подтверждает, что компоненты кампании готовы. Пример: Проверка человеком или системой оценивает качество и полноту всех компонентов кампании.

- **Шаг 9**: Кампания готова? - Проверка для определения, завершена ли кампания и готова ли она к публикации. Пример: Булев флаг сигнализирует "Да", если все на месте, иначе "Нет", инициируя возврат к предыдущему шагу для внесения исправлений.

- **Шаг 10**: Публикация кампании - Кампания запускается на платформе, готовая к маркетинговым усилиям. Пример: Выполняются вызовы API для публикации кампании на соответствующей платформе.

- **Шаг 11**: Завершение - Процесс создания кампании завершен.

## Логика редактирования кампании

```mermaid
graph LR
        A[Ввод пользователя: campaign_name, language, currency] --> B{AliCampaignEditor.__init__};
        B --> C[AliPromoCampaign.__init__];
        C --> D[Инициализация: конструктор AliCampaignEditor];
        D --> E[AliCampaignEditor];
        
        E --> F[delete_product: Проверка аффилированной ссылки];
        F --> G[read_text_file sources.txt: Чтение списка продуктов];
        G --> H[Итерация и проверка product_id: Цикл по списку продуктов];
        H -- Совпадение --> I[Удаление и сохранение: Удаление продукта, если найдено совпадение];
        H -- Нет совпадения --> J[Переименование файла продукта: Переименование файла продукта, если нет совпадения];
        
        E --> K[update_product: Обновление деталей продукта];
        K --> L[Вызов dump_category_products_files: Обновление категории с новым продуктом];
        
        E --> M[update_campaign: Обновление свойств кампании, таких как описание];
        M --> N[Обновление параметров кампании];
        
        E --> O[update_category: Обновление категории в JSON файле];
        O --> P[j_loads JSON файл: Чтение данных категории];
        P --> Q[Обновление категории: Обновление данных категории];
        Q --> R[j_dumps JSON файл: Запись обновленной категории в файл];
        
        E --> S[get_category: Получение категории по имени];
        S --> T[Проверка существования категории];
        T -- Найдена --> U[Возврат SimpleNamespace: Возврат деталей категории];
        T -- Не найдена --> V[Лог предупреждения: Категория не найдена в кампании];
        
        E --> W[list_categories: Список всех категорий в кампании];
        W --> X[Проверка атрибута категории: Убедиться, что категории существуют в кампании];
        X -- Найдена --> Y[Возврат списка категорий: Список имен категорий];
        X -- Не найдена --> Z[Лог предупреждения: Категории не найдены в кампании];
        
        E --> AA[get_category_products: Получение продуктов для категории];
        AA --> AB[Получение пути категории: Построение пути для продуктов категории];
        AB --> AC[Получение имен файлов JSON: Получение всех файлов JSON продуктов];
        AC --> AD[Чтение JSON файлов: Загрузка данных продукта];
        AD --> AE[Создание SimpleNamespace: Преобразование данных продукта в объекты];
        AE --> AF[Возврат продуктов: Возврат списка продуктов];
        AC -- Нет файлов JSON --> AG[Лог ошибки: Файлы не найдены];
        AG --> AH[Обработка категории: Запуск подготовки продуктов категории];

        E --> AI[Другие методы];

```

## Логика подготовки кампании

```mermaid
flowchart TD
    A[Начало] --> B{Обработать все кампании?}
    B -->|Да| C[Обработать все кампании]
    B -->|Нет| D[Обработать конкретную кампанию]
    
    C --> E{Язык и валюта предоставлены?}
    E -->|Да| F[Обработать каждую кампанию с предоставленным языком и валютой]
    E -->|Нет| G[Обработать все локали для каждой кампании]
    
    D --> H{Категории указаны?}
    H -->|Да| I[Обработать конкретные категории для кампании]
    H -->|Нет| J[Обработать всю кампанию]
    
    F --> K[Обработать категорию кампании]
    G --> L[Обработать кампанию для всех локалей]
    I --> K
    J --> L
    
    K --> M[Возврат]
    L --> M
    ```
# Модуль `try_xpath_background.js`

## Обзор

Данный JavaScript-модуль отвечает за обработку сообщений, полученных от других вкладок и содержимого веб-страниц, связанных с расширением `try_xpath`.  Он управляет состоянием всплывающего окна, загружает CSS-стили, хранит результаты поиска и предоставляет функции для взаимодействия с другими частями расширения.


## Переменные

### `tx`

**Описание**: псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Хранит состояние всплывающего окна расширения.

### `popupCss`

**Описание**: Содержит CSS-стили для всплывающего окна.

### `results`

**Описание**: Хранит результаты поиска, полученные из других вкладок.

### `css`

**Описание**: Содержит CSS-стили для вкладок, которые должны быть добавлены.

### `attributes`

**Описание**: Объект, содержащий атрибуты для поиска элементов на странице (ключ-значение).

### `genericListener.listeners`

**Описание**: Объект, содержащий обработчики событий для `browser.runtime.onMessage`.


## Функции

### `loadDefaultCss()`

**Описание**: Загружает CSS-стили из файла `try_xpath_insert.css` при помощи `XMLHttpRequest`.

**Возвращает**:
* `Promise<string>`:  Promise, содержащий текст загруженного CSS.


### `genericListener(message, sender, sendResponse)`

**Описание**: Общая функция для обработки сообщений, полученных от других вкладок.

**Параметры**:
* `message` (объект): Сообщение, полученное от другой вкладки.
* `sender` (объект): Объект, содержащий информацию об отправителе.
* `sendResponse` (функция): Функция для отправки ответа.

**Вызывает исключения**:
* `fu.onError`: Ошибка при выполнении запроса к `browser.runtime`.



### `genericListener.listeners.storePopupState(message)`

**Описание**: Устанавливает состояние всплывающего окна.

**Параметры**:
* `message` (объект): Содержит информацию о состоянии всплывающего окна.


### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Отправляет сообщение в браузер для восстановления состояния всплывающего окна.

**Параметры**:
* `message` (объект): Содержит информацию о состоянии всплывающего окна.


### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Отправляет сообщение в браузер для вставки CSS-стилей в всплывающее окно.


### `genericListener.listeners.showAllResults(message, sender)`

**Описание**:  Создает новую вкладку для отображения результатов поиска.

**Параметры**:
* `message` (объект): Содержит результаты поиска.
* `sender` (объект):  Объект, содержащий информацию об отправителе.


### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Возвращает результаты поиска.

**Параметры**:
* `message` (объект): Содержит запрос на результаты поиска.
* `sender` (объект): Объект, содержащий информацию об отправителе.
* `sendResponse` (функция): Функция для отправки ответа.


### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Добавляет или удаляет CSS в текущей вкладке.

**Параметры**:
* `message` (объект): Содержит информацию о CSS, который необходимо добавить/удалить.
* `sender` (объект): Объект, содержащий информацию об отправителе.


### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Возвращает информацию об атрибутах, CSS-стилях и CSS всплывающего окна.

**Параметры**:
* `message` (объект): Запрос на информацию.
* `sender` (объект): Объект, содержащий информацию об отправителе.
* `sendResponse` (функция): Функция для отправки ответа.


### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Отправляет сообщение в браузер для установки информации о содержимом.

**Параметры**:
* `message` (объект): Содержит информацию о содержимом.
* `sender` (объект): Объект, содержащий информацию об отправителе.


## Обработчики событий

### `browser.storage.onChanged`

**Описание**: Обработчик событий изменения значений в хранилище браузера.  Обновляет локальные переменные `attributes`, `css` и `popupCss` при изменениях.



##  Обработка ошибок

Все функции используют `fu.onError` для обработки ошибок, возникающих при выполнении операций с браузером.

## Заметки

Этот модуль использует асинхронные операции (`Promise`) для обработки задач, связанных с загрузкой CSS-стилей и взаимодействием с браузером.
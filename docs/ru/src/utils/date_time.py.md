# Модуль для проверки времени и ожидания ввода с таймаутом
## Обзор

Модуль `src.utils.date_time` содержит класс `TimeoutCheck`, который используется для проверки, находится ли текущее время в заданном интервале, а также для ожидания ввода от пользователя с таймаутом.
Этот модуль полезен для выполнения операций, которые должны происходить только в определенные периоды времени, например, для задач обслуживания в ночное время.

## Подробнее

Модуль предоставляет класс `TimeoutCheck`, который включает методы для проверки временного интервала и ожидания ввода с использованием потоков и таймаутов. Это позволяет избежать блокировки основного потока выполнения при ожидании ввода пользователя или при проверке временного интервала.

## Классы

### `TimeoutCheck`

**Описание**: Класс `TimeoutCheck` предназначен для проверки, находится ли текущее время в заданном интервале, а также для ожидания ввода от пользователя с таймаутом.

**Принцип работы**:
Класс использует потоки для выполнения проверок временного интервала и ожидания ввода пользователя. Это позволяет избежать блокировки основного потока выполнения и обеспечивает возможность задавать таймауты для операций.

**Атрибуты**:
- `result` (bool | None): Результат проверки временного интервала.
- `user_input` (str | None): Ввод пользователя.

**Методы**:
- `__init__`: Инициализирует экземпляр класса `TimeoutCheck`.
- `interval`: Проверяет, находится ли текущее время в заданном интервале.
- `interval_with_timeout`: Проверяет, находится ли текущее время в заданном интервале с таймаутом.
- `get_input`: Запрашивает ввод от пользователя.
- `input_with_timeout`: Ожидает ввод от пользователя с таймаутом.

## Функции

### `__init__`

```python
    def __init__(self):
        self.result = None
```

**Назначение**: Инициализирует экземпляр класса `TimeoutCheck`.

**Как работает функция**:

1.  Инициализирует атрибут `result` значением `None`.

### `interval`

```python
    def interval(self, start: time = time(23, 0), end: time = time(6, 0)) -> bool:
        """ Check if the current time is within the specified interval.
        
        Args:
            start (time): Start of the interval (default is 23:00).
            end (time): End of the interval (default is 06:00).

        Returns:
            bool: True if the current time is within the interval, False otherwise.
        """
        ...
```

**Назначение**: Проверяет, находится ли текущее время в заданном интервале.

**Параметры**:
- `start` (time, optional): Время начала интервала. По умолчанию `time(23, 0)`.
- `end` (time, optional): Время окончания интервала. По умолчанию `time(6, 0)`.

**Возвращает**:
- `bool`: `True`, если текущее время находится в интервале, `False` в противном случае.

**Как работает функция**:

1.  Получает текущее время с помощью `datetime.now().time()`.
2.  Проверяет, находится ли текущее время в заданном интервале. Если время начала интервала меньше времени окончания интервала (например, с 8:00 до 17:00), то проверяется, находится ли текущее время между временем начала и временем окончания интервала. Если время начала интервала больше времени окончания интервала (например, с 23:00 до 6:00), то проверяется, находится ли текущее время после времени начала интервала или до времени окончания интервала.
3.  Результат проверки сохраняется в атрибуте `self.result`.

**Примеры**:

```python
from datetime import time
from src.utils.date_time import TimeoutCheck

timeout_check = TimeoutCheck()

# Проверка интервала с 23:00 до 6:00
result = timeout_check.interval(start=time(23, 0), end=time(6, 0))
print(f"Текущее время в интервале: {result}")

# Проверка интервала с 8:00 до 17:00
result = timeout_check.interval(start=time(8, 0), end=time(17, 0))
print(f"Текущее время в интервале: {result}")
```

### `interval_with_timeout`

```python
    def interval_with_timeout(self, timeout: int = 5, start: time = time(23, 0), end: time = time(6, 0)) -> bool:
        """ Check if the current time is within the specified interval with a timeout.

        Args:
            timeout (int): Time in seconds to wait for the interval check.
            start (time): Start of the interval (default is 23:00).
            end (time): End of the interval (default is 06:00).

        Returns:
            bool: True if the current time is within the interval and response within timeout, False if not or timeout occurs.
        """
        ...
```

**Назначение**: Проверяет, находится ли текущее время в заданном интервале с таймаутом.

**Параметры**:
- `timeout` (int, optional): Время ожидания в секундах для проверки интервала. По умолчанию `5`.
- `start` (time, optional): Время начала интервала. По умолчанию `time(23, 0)`.
- `end` (time, optional): Время окончания интервала. По умолчанию `time(6, 0)`.

**Возвращает**:
- `bool`: `True`, если текущее время находится в интервале и проверка завершилась до таймаута, `False` в противном случае (если время не в интервале или произошел таймаут).

**Как работает функция**:

1.  Создает и запускает поток для выполнения метода `self.interval` с заданными параметрами `start` и `end`.
2.  Ожидает завершения потока в течение времени, заданного параметром `timeout`.
3.  Если поток завершился до таймаута, возвращает значение атрибута `self.result`, который устанавливается в методе `self.interval`.
4.  Если произошел таймаут, выводит сообщение в консоль и возвращает `False`.

**Примеры**:

```python
from datetime import time
from src.utils.date_time import TimeoutCheck

timeout_check = TimeoutCheck()

# Проверка интервала с 23:00 до 6:00 с таймаутом 5 секунд
result = timeout_check.interval_with_timeout(timeout=5, start=time(23, 0), end=time(6, 0))
print(f"Текущее время в интервале (с таймаутом): {result}")

# Проверка интервала с 8:00 до 17:00 с таймаутом 5 секунд
result = timeout_check.interval_with_timeout(timeout=5, start=time(8, 0), end=time(17, 0))
print(f"Текущее время в интервале (с таймаутом): {result}")
```

### `get_input`

```python
    def get_input(self):
        """ Запрашиваем ввод от пользователя."""
        self.user_input = input("U:> ")
```

**Назначение**: Запрашивает ввод от пользователя.

**Как работает функция**:

1.  Выводит в консоль приглашение для ввода "U:> ".
2.  Ожидает ввода от пользователя и сохраняет его в атрибуте `self.user_input`.

### `input_with_timeout`

```python
    def input_with_timeout(self, timeout: int = 5) -> str | None:
        """ Ожидаем ввод с тайм-аутом.

        Args:
            timeout (int): Время ожидания ввода в секундах.

        Returns:
            str | None: Введенные данные или None, если был тайм-аут.
        """
        ...
```

**Назначение**: Ожидает ввод от пользователя с таймаутом.

**Параметры**:
- `timeout` (int, optional): Время ожидания ввода в секундах. По умолчанию `5`.

**Возвращает**:
- `str | None`: Введенные данные или `None`, если произошел таймаут.

**Как работает функция**:

1.  Создает и запускает поток для выполнения метода `self.get_input`.
2.  Ожидает завершения потока в течение времени, заданного параметром `timeout`.
3.  Если поток завершился до таймаута, возвращает значение атрибута `self.user_input`, который устанавливается в методе `self.get_input`.
4.  Если произошел таймаут, выводит сообщение в консоль и возвращает `None`.

**Примеры**:

```python
from src.utils.date_time import TimeoutCheck

timeout_check = TimeoutCheck()

# Ожидание ввода пользователя с таймаутом 5 секунд
user_input = timeout_check.input_with_timeout(timeout=5)
if user_input:
    print(f"Введенные данные: {user_input}")
else:
    print("Таймаут ожидания ввода.")
```
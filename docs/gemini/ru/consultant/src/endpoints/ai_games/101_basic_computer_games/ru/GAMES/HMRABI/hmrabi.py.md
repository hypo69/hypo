# Анализ кода модуля hmrabi.py

**Качество кода**
7
- Плюсы
    - Код игры логически структурирован и соответствует описанию.
    - Присутствуют основные игровые механики: покупка/продажа земли, посев, пропитание населения, учет урожая и потерь от крыс.
    - Есть проверка на корректность ввода данных от пользователя.
    -  Присутствуют комментарии, объясняющие основные блоки кода.
- Минусы
    - Отсутствует документация в формате reStructuredText (RST).
    - Не используется логирование ошибок через `src.logger.logger`.
    - Избыточное использование `try-except` блоков при вводе данных.
    - Отсутствует форматирование вывода, что делает его менее читаемым.
    - Код не использует `j_loads` или `j_loads_ns` для чтения данных, хотя это не требуется в данном случае.
    -  Переменные и функции не имеют docstring.
    - Присутствуют дублирующиеся блоки кода для ввода и проверки данных (например, ввод и проверка `land_trade` и `grain_to_plant`)

**Рекомендации по улучшению**
1.  **Документирование кода**:
    -   Добавить docstring в формате reStructuredText (RST) для модуля, всех функций и переменных. Это улучшит читаемость кода и облегчит его понимание.
2.  **Логирование ошибок**:
    -   Заменить блоки `try-except` на использование `logger.error` для обработки и логирования ошибок. Это поможет в отладке и мониторинге работы программы.
3.  **Упрощение ввода данных**:
    -   Вынести повторяющуюся логику ввода и проверки данных в отдельные функции. Это уменьшит дублирование кода и сделает его более читаемым.
4.  **Форматирование вывода**:
    -   Использовать f-строки для форматирования вывода, чтобы сделать его более понятным и читаемым. Например, добавить единицы измерения к выводу.
5.  **Улучшение читаемости**:
    -   Разбить код на более мелкие функции для улучшения читаемости.
    -   Использовать более описательные имена переменных.
6. **Улучшение игрового процесса:**
    -  Можно добавить больше событий, влияющих на игровой процесс, сделать игру более динамичной.
7. **Обработка ошибок:**
    -  Обработка ValueError не должна быть в цикле, а должна быть вынесена в отдельную функцию.

**Оптимизированный код**
```python
"""
Игра "Хамурапи"
==================
Текстовая экономическая игра, в которой игрок управляет древним городом, принимая решения о покупке и продаже земли, посеве и кормлении населения.

Пример использования:
----------------------
.. code-block:: python

    python hmrabi.py

"""
import random
from src.logger.logger import logger # Подключаем logger для логирования ошибок

def get_int_input(prompt: str) -> int:
    """
    Запрашивает у пользователя ввод целого числа и обрабатывает ошибку ввода.

    :param prompt: Сообщение для пользователя.
    :return: Введенное целое число.
    :raises ValueError: Если ввод не является целым числом.
    """
    while True:
        try:
            return int(input(prompt))
        except ValueError:
            logger.error("Неверный ввод. Пожалуйста, введите целое число.")
            print("Пожалуйста, введите целое число.") # Вывод сообщения для пользователя
            
def validate_land_trade(land_trade: int, grain: int, land_price: int, land: int) -> int:
    """
    Проверяет допустимость сделки по купле-продаже земли.
    
    :param land_trade: Количество земли для покупки (+) или продажи (-).
    :param grain: Текущее количество зерна.
    :param land_price: Цена земли за акр.
    :param land: Текущее количество земли.
    :return: Количество земли для торговли, если ввод корректен.
    """
    while True:
         if land_trade > 0 and grain < land_trade * land_price:
            logger.error("Недостаточно зерна для покупки земли.")
            print("Недостаточно зерна для покупки земли.")# Вывод сообщения для пользователя
            land_trade = get_int_input("Сколько земли купить (+) или продать (-)? ")
         elif land_trade < 0 and land < abs(land_trade):
            logger.error("Недостаточно земли для продажи.")
            print("Недостаточно земли для продажи.")# Вывод сообщения для пользователя
            land_trade = get_int_input("Сколько земли купить (+) или продать (-)? ")
         else:
             return land_trade

def validate_grain_to_plant(grain_to_plant: int, grain: int) -> int:
    """
    Проверяет достаточно ли зерна для посева.

    :param grain_to_plant: Количество зерна для посева.
    :param grain: Текущее количество зерна.
    :return: Количество зерна для посева, если ввод корректен.
    """
    while True:
        if grain < grain_to_plant:
            logger.error("Недостаточно зерна для посева.")
            print("Недостаточно зерна для посева.") # Вывод сообщения для пользователя
            grain_to_plant = get_int_input("Сколько зерна использовать для посева? ")
        else:
            return grain_to_plant
            
def calculate_harvest(grain_to_plant: int) -> int:
    """
    Вычисляет урожай зерна.
    
    :param grain_to_plant: Количество зерна для посева.
    :return: Количество собранного зерна.
    """
    yield_per_acre = random.randint(1, 8)
    harvest = grain_to_plant * yield_per_acre
    return harvest
    
def calculate_rats_damage(grain: int) -> int:
    """
    Вычисляет ущерб от крыс.
    
    :param grain: Текущее количество зерна.
    :return: Количество зерна, съеденного крысами.
    """
    rats_damage = int(random.random() * 0.1 * grain)
    return rats_damage

def update_population(population: int, grain_to_feed: int, grain: int) -> tuple[int,int]:
    """
    Обновляет популяцию в зависимости от доступности зерна.
    
    :param population: Текущее количество населения.
    :param grain_to_feed: Количество зерна для пропитания.
    :param grain: Текущее количество зерна.
    :return: Обновленное количество населения и зерна.
    """
    if grain_to_feed >= population:
            new_population = min(1000, int(population * 1.1))
            grain -= grain_to_feed
            print("Все сыты, население растёт!") # Вывод сообщения для пользователя
            return new_population, grain
    else:
            starved = int(population * (1 - grain_to_feed / population))
            new_population = population - starved
            grain -= grain_to_feed
            print(f"{starved} человек умерло от голода.")# Вывод сообщения для пользователя
            if new_population <= 0:
                print("Вы проиграли, все население вымерло от голода!")# Вывод сообщения для пользователя
            return new_population, grain


# Инициализация переменных
year = 0          # текущий год
population = 100  # начальное население
grain = 2800      # начальное количество зерна
land = 1000       # начальная площадь земли

print("Добро пожаловать в игру Хаммурапи!")

# Основной игровой цикл
while year < 10 and population > 0:
    print(f"\nГод {year + 1}")
    print(f"Население: {population}")
    print(f"Зерно: {grain} бушелей")
    print(f"Земля: {land} акров")

    # Вычисляем случайную цену земли
    land_price = random.randint(15, 25)
    print(f"Цена земли: {land_price} бушелей за акр")

    # Запрашиваем у игрока количество земли для покупки или продажи
    land_trade = get_int_input("Сколько земли купить (+) или продать (-)? ")
    
    # Проверяем достаточно ли ресурсов для торговли
    land_trade = validate_land_trade(land_trade, grain, land_price, land)
    
    # Обновляем количество земли и зерна
    land += land_trade
    grain -= land_trade * land_price
    
    # Запрашиваем у игрока количество зерна для посева
    grain_to_plant = get_int_input("Сколько зерна использовать для посева? ")

    # Проверяем достаточно ли зерна для посева
    grain_to_plant = validate_grain_to_plant(grain_to_plant, grain)

    # Вычисляем урожай
    harvest = calculate_harvest(grain_to_plant)
    grain += harvest
    
    # Вычисляем ущерб от крыс
    rats_damage = calculate_rats_damage(grain)
    grain -= rats_damage
    print(f"Крысы съели {rats_damage} бушелей зерна.")

    # Запрашиваем количество зерна для кормления
    grain_to_feed = get_int_input("Сколько зерна отдать на пропитание? ")

    # Обновляем популяцию
    population, grain = update_population(population, grain_to_feed, grain)
    
    year += 1

if year == 10:
    print("Игра окончена. Прошло 10 лет.")
```
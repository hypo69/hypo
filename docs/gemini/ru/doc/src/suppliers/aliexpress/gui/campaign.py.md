# Модуль `campaign.py`

## Обзор

Модуль `campaign.py` предоставляет виджет `CampaignEditor` для редактирования кампаний AliExpress. Он позволяет открывать JSON-файлы с данными кампаний, отображать их содержимое в графическом интерфейсе и подготавливать кампании к дальнейшей обработке.

## Подробней

Модуль использует библиотеку PyQt6 для создания графического интерфейса. Он позволяет пользователю загружать JSON-файлы, отображать и редактировать данные кампаний, такие как заголовок, описание и название рекламной акции. Класс `CampaignEditor` является основным виджетом, который предоставляет этот функционал.
Данный код используется для визуализации и редактирования параметров рекламных кампаний AliExpress в графическом интерфейсе приложения `hypotez`.

## Классы

### `CampaignEditor`

**Описание**: Основной класс виджета для редактирования кампаний. Он содержит методы для загрузки файлов, создания виджетов на основе данных из файла и подготовки кампании.

**Принцип работы**:
1.  Инициализация виджета: при создании экземпляра `CampaignEditor` инициализируется пользовательский интерфейс и устанавливаются связи между сигналами и слотами.
2.  Загрузка файла: метод `open_file` открывает диалоговое окно выбора файла, позволяя пользователю выбрать JSON-файл с данными кампании.
3.  Отображение данных: метод `create_widgets` создает виджеты (например, текстовые поля) на основе данных, загруженных из JSON-файла, и отображает их в интерфейсе.
4.  Подготовка кампании: метод `prepare_campaign` асинхронно подготавливает кампанию с использованием класса `AliCampaignEditor`.

**Методы**:

*   `__init__(self, parent=None, main_app=None)`:
    *   Инициализирует виджет `CampaignEditor`.
*   `setup_ui(self)`:
    *   Настраивает пользовательский интерфейс, включая создание кнопок, текстовых полей и макетов.
*   `setup_connections(self)`:
    *   Устанавливает связи между сигналами и слотами.
*   `open_file(self)`:
    *   Открывает диалоговое окно выбора файла для загрузки JSON-файла кампании.
*   `load_file(self, campaign_file)`:
    *   Загружает JSON-файл кампании и создает виджеты для отображения данных.
*   `create_widgets(self, data)`:
    *   Создает виджеты (текстовые поля) на основе данных из JSON-файла и добавляет их в макет.
*   `prepare_campaign(self)`:
    *   Асинхронно подготавливает кампанию с использованием `AliCampaignEditor`.

**Параметры**:

*   `parent` (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию `None`.
*   `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

**Примеры**:

```python
from PyQt6 import QtWidgets
from campaign import CampaignEditor

app = QtWidgets.QApplication([])
campaign_editor = CampaignEditor()
campaign_editor.show()
app.exec()
```

## Функции

### `__init__`

```python
def __init__(self, parent=None, main_app=None):
    """ Initialize the CampaignEditor widget """
    ...
```

**Назначение**: Инициализирует виджет `CampaignEditor`.

**Параметры**:

*   `parent` (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию `None`.
*   `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

**Как работает функция**:

1.  Вызывает конструктор родительского класса `QtWidgets.QWidget`.
2.  Сохраняет ссылку на экземпляр главного приложения `main_app`.
3.  Вызывает методы `setup_ui` и `setup_connections` для настройки пользовательского интерфейса и связей между сигналами и слотами.

**Примеры**:

```python
from PyQt6 import QtWidgets
from campaign import CampaignEditor

app = QtWidgets.QApplication([])
campaign_editor = CampaignEditor()
campaign_editor.show()
app.exec()
```

### `setup_ui`

```python
def setup_ui(self):
    """ Setup the user interface """
    ...
```

**Назначение**: Настраивает пользовательский интерфейс виджета `CampaignEditor`.

**Как работает функция**:

1.  Устанавливает заголовок окна виджета.
2.  Изменяет размер окна виджета.
3.  Создает область прокрутки `QScrollArea` и помещает в нее виджет с контентом `scroll_content_widget`.
4.  Создает макет `QGridLayout` для виджета с контентом и выравнивает его по верхнему краю.
5.  Определяет компоненты пользовательского интерфейса, такие как кнопки "Open JSON File" (открытие файла) и "Prepare Campaign" (подготовка кампании), а также текстовое поле для отображения имени выбранного файла.
6.  Добавляет компоненты в макет.
7.  Добавляет область прокрутки в главный макет виджета.

### `setup_connections`

```python
def setup_connections(self):
    """ Setup signal-slot connections """
    ...
```

**Назначение**: Устанавливает связи между сигналами и слотами.

**Как работает функция**:

Функция `setup_connections` в данном коде пуста и не выполняет никаких действий.

### `open_file`

```python
def open_file(self):
    """ Open a file dialog to select and load a JSON file """
    ...
```

**Назначение**: Открывает диалоговое окно выбора файла для загрузки JSON-файла кампании.

**Как работает функция**:

1.  Открывает диалоговое окно выбора файла с помощью `QtWidgets.QFileDialog.getOpenFileName`.
2.  Если файл выбран, вызывает метод `load_file` для загрузки содержимого файла.

**Примеры**:

```python
campaign_editor.open_file()
```

### `load_file`

```python
def load_file(self, campaign_file):
    """ Load a JSON file """
    ...
```

**Назначение**: Загружает JSON-файл кампании.

**Параметры**:

*   `campaign_file` (str): Путь к JSON-файлу.

**Как работает функция**:

1.  Пытается загрузить JSON-файл с использованием `j_loads_ns`.
2.  Сохраняет путь к файлу в `self.current_campaign_file`.
3.  Устанавливает текст в `self.file_name_label`.
4.  Вызывает метод `create_widgets` для создания виджетов на основе данных из файла.
5.  Инициализирует `AliCampaignEditor`.
6.  В случае ошибки отображает сообщение об ошибке.

**Вызывает исключения**:

*   `Exception`: Если не удается загрузить JSON-файл.

**Примеры**:

```python
campaign_editor.load_file('campaign.json')
```

### `create_widgets`

```python
def create_widgets(self, data):
    """ Create widgets based on the data loaded from the JSON file """
    ...
```

**Назначение**: Создает виджеты (текстовые поля) на основе данных из JSON-файла и добавляет их в макет.

**Параметры**:

*   `data` (SimpleNamespace): Данные, загруженные из JSON-файла.

**Как работает функция**:

1.  Удаляет предыдущие виджеты, кроме кнопок "Open JSON File" и текстового поля для имени файла.
2.  Создает текстовые поля `QLineEdit` для заголовка, описания и названия рекламной акции на основе данных из `data`.
3.  Добавляет метки и текстовые поля в макет.

**Примеры**:

```python
campaign_editor.create_widgets(data)
```

### `prepare_campaign`

```python
@asyncSlot()
async def prepare_campaign(self):
    """ Asynchronously prepare the campaign """
    ...
```

**Назначение**: Асинхронно подготавливает кампанию.

**Как работает функция**:

1.  Проверяет, инициализирован ли `self.editor` (экземпляр `AliCampaignEditor`).
2.  Вызывает метод `prepare` объекта `self.editor` асинхронно.
3.  Отображает сообщение об успехе или ошибке в зависимости от результата.

**Вызывает исключения**:

*   `Exception`: Если не удается подготовить кампанию.

**Примеры**:

```python
await campaign_editor.prepare_campaign()
# Модуль `main.py`

## Обзор

Модуль `main.py` является точкой входа для графического интерфейса (GUI) приложения, предназначенного для управления рекламными кампаниями на AliExpress. Он использует библиотеку PyQt6 для создания интерфейса с вкладками, позволяющего редактировать JSON-данные, управлять кампаниями и редактировать информацию о продуктах.

## Подробней

Этот модуль предоставляет основной интерфейс приложения, объединяя различные редакторы (JSON, кампании, продукты) в единое окно с вкладками. Он также включает в себя меню с функциями открытия, сохранения, копирования и вставки, что обеспечивает удобство работы с данными.

## Классы

### `MainApp`

**Описание**: Главный класс приложения, который создает основное окно с вкладками для управления различными аспектами рекламных кампаний.

**Наследует**: `QtWidgets.QMainWindow`

**Атрибуты**:

-   `tab_widget` (QtWidgets.QTabWidget): Виджет для отображения вкладок.
-   `tab1` (QtWidgets.QWidget): Виджет первой вкладки (JSON Editor).
-   `promotion_app` (CampaignEditor): Экземпляр редактора кампаний для первой вкладки.
-   `tab2` (QtWidgets.QWidget): Виджет второй вкладки (Campaign Editor).
-   `campaign_editor_app` (CategoryEditor): Экземпляр редактора категорий для второй вкладки.
-   `tab3` (QtWidgets.QWidget): Виджет третьей вкладки (Product Editor).
-   `product_editor_app` (ProductEditor): Экземпляр редактора продуктов для третьей вкладки.

**Методы**:

-   `__init__`: Инициализирует главное окно приложения, создает вкладки и устанавливает центральный виджет.
-   `create_menubar`: Создает меню с опциями для работы с файлами и редактирования.
-   `open_file`: Открывает диалоговое окно для выбора и загрузки JSON-файла.
-   `save_file`: Сохраняет текущий файл.
-   `exit_application`: Закрывает приложение.
-   `copy`: Копирует выделенный текст в буфер обмена.
-   `paste`: Вставляет текст из буфера обмена.
-   `load_file`: Загружает JSON-файл.

#### `__init__`

```python
def __init__(self):
    """ Initialize the main application with tabs """
```

**Назначение**: Инициализирует главное окно приложения, создаёт виджеты вкладок и устанавливает их.

**Как работает функция**:

1.  Вызывает конструктор базового класса `QtWidgets.QMainWindow`.
2.  Устанавливает заголовок окна.
3.  Устанавливает геометрию окна (размеры и положение).
4.  Создаёт виджет `QTabWidget` для управления вкладками.
5.  Устанавливает `QTabWidget` в качестве центрального виджета окна.
6.  Создаёт три вкладки (`tab1`, `tab2`, `tab3`) и добавляет их в `QTabWidget` с соответствующими названиями.
7.  Инициализирует редакторы (`CampaignEditor`, `CategoryEditor`, `ProductEditor`) и связывает их с соответствующими вкладками.
8.  Вызывает метод `create_menubar` для создания меню.

```
A: Инициализация приложения
|
B: Создание и настройка вкладок
|
C: Инициализация редакторов
|
D: Создание меню
```

**Примеры**:

```python
app = MainApp()
app.show()
```

#### `create_menubar`

```python
def create_menubar(self):
    """ Create a menu bar with options for file operations and edit commands """
```

**Назначение**: Создаёт меню с опциями для работы с файлами и командами редактирования.

**Как работает функция**:

1.  Получает объект меню-бара (`menubar`).
2.  Создаёт меню "File" и добавляет в него действия "Open", "Save", "Exit".
3.  Назначает обработчики событий для действий "Open" (`self.open_file`), "Save" (`self.save_file`) и "Exit" (`self.exit_application`).
4.  Создаёт меню "Edit" и добавляет в него действия "Copy" и "Paste".
5.  Назначает обработчики событий для действий "Copy" (`self.copy`) и "Paste" (`self.paste`).
6.  Создает действие "Open Product File" и связывает его с методом `open_file` редактора продуктов.

```
A: Получение меню-бара
|
B: Создание меню "File" и добавление действий
|
C: Создание меню "Edit" и добавление действий
|
D: Добавление действия "Open Product File"
```

**Примеры**:

```python
main_app.create_menubar()
```

#### `open_file`

```python
def open_file(self):
    """ Open a file dialog to select and load a JSON file """
```

**Назначение**: Открывает диалоговое окно для выбора и загрузки JSON-файла.

**Как работает функция**:

1.  Создаёт экземпляр `QFileDialog` для открытия диалогового окна выбора файла.
2.  Открывает диалоговое окно и получает путь к выбранному файлу.
3.  Если файл не выбран, функция завершается.
4.  Проверяет, какая вкладка активна.
5.  Если активна первая вкладка (JSON Editor), вызывает метод `load_file` для загрузки файла.

```
A: Создание диалогового окна выбора файла
|
B: Получение пути к выбранному файлу
|
C: Проверка активности первой вкладки
|
D: Загрузка файла
```

**Примеры**:

```python
main_app.open_file()
```

#### `save_file`

```python
def save_file(self):
    """ Save the current file """
```

**Назначение**: Сохраняет текущий файл в зависимости от выбранной вкладки.

**Как работает функция**:

1.  Определяет индекс текущей активной вкладки.
2.  Если активна первая вкладка (JSON Editor), вызывает метод `save_changes` редактора кампаний.
3.  Если активна третья вкладка (Product Editor), вызывает метод `save_product` редактора продуктов.

```
A: Определение активной вкладки
|
B: Сохранение файла в зависимости от вкладки
```

**Примеры**:

```python
main_app.save_file()
```

#### `exit_application`

```python
def exit_application(self):
    """ Exit the application """
```

**Назначение**: Закрывает приложение.

**Как работает функция**:

1.  Вызывает метод `close` для закрытия главного окна приложения.

```
A: Закрытие приложения
```

**Примеры**:

```python
main_app.exit_application()
```

#### `copy`

```python
def copy(self):
    """ Copy selected text to the clipboard """
```

**Назначение**: Копирует выделенный текст в буфер обмена из активного текстового виджета.

**Как работает функция**:

1.  Определяет виджет, находящийся в фокусе.
2.  Проверяет, является ли виджет текстовым редактором (QLineEdit, QTextEdit, QPlainTextEdit).
3.  Если виджет является текстовым редактором, вызывает метод `copy` для копирования выделенного текста в буфер обмена.
4.  Если виджет не является текстовым редактором, выводит предупреждение.

```
A: Определение виджета в фокусе
|
B: Проверка, является ли виджет текстовым редактором
|
C: Копирование текста или вывод предупреждения
```

**Примеры**:

```python
main_app.copy()
```

#### `paste`

```python
def paste(self):
    """ Paste text from the clipboard """
```

**Назначение**: Вставляет текст из буфера обмена в активный текстовый виджет.

**Как работает функция**:

1.  Определяет виджет, находящийся в фокусе.
2.  Проверяет, является ли виджет текстовым редактором (QLineEdit, QTextEdit, QPlainTextEdit).
3.  Если виджет является текстовым редактором, вызывает метод `paste` для вставки текста из буфера обмена.
4.  Если виджет не является текстовым редактором, выводит предупреждение.

```
A: Определение виджета в фокусе
|
B: Проверка, является ли виджет текстовым редактором
|
C: Вставка текста или вывод предупреждения
```

**Примеры**:

```python
main_app.paste()
```

#### `load_file`

```python
def load_file(self, campaign_file):
    """ Load the JSON file """
```

**Назначение**: Загружает JSON-файл, используя `campaign_file`.

**Как работает функция**:

1.  Пытается загрузить JSON-файл с использованием метода `load_file` редактора кампаний (`self.promotion_app`).
2.  Если возникает исключение, выводит сообщение об ошибке.

```
A: Попытка загрузки JSON-файла
|
B: Обработка исключений и вывод сообщения об ошибке
```

**Примеры**:

```python
main_app.load_file("path/to/campaign.json")
```

## Функции

### `main`

```python
def main():
    """ Initialize and run the application """
```

**Назначение**: Инициализирует и запускает приложение.

**Как работает функция**:

1.  Создает экземпляр `QApplication`.
2.  Создает цикл событий (`QEventLoop`) для асинхронных операций.
3.  Устанавливает созданный цикл событий как текущий цикл событий asyncio.
4.  Создает экземпляр главного окна приложения (`MainApp`).
5.  Отображает главное окно приложения.
6.  Запускает цикл событий для обработки пользовательского ввода и других событий.

```
A: Создание экземпляра QApplication
|
B: Создание и установка цикла событий
|
C: Создание и отображение главного окна приложения
|
D: Запуск цикла событий
```

**Примеры**:

```python
if __name__ == "__main__":
    main()
# Анализ кода модуля `readme.ru.md`

**Качество кода**
6
-  Плюсы
    - Документ содержит подробное описание модуля `Code Assistant`.
    -  Присутствует разделение на основные возможности, структуру проекта, примеры использования, параметры командной строки и логику работы.
    -  Описаны исключения, логирование и зависимости.
-  Минусы
    -  Документ не соответствует формату reStructuredText (RST).
    -  Необходимо переписать все комментарии в RST.
    -  Нет примеров использования RST-форматирования.

**Рекомендации по улучшению**

1.  Переписать весь документ в формате reStructuredText (RST).
2.  Добавить примеры RST-форматирования для различных элементов (списков, таблиц, кода).
3.  Привести примеры кода к виду, который соответствует RST, и использовать директивы для отображения кода.
4.  Заменить прямые ссылки на `[Root ↑]`, `src`, `endpoints`, `hypo69` и `English` на внутренние ссылки.
5.  Устранить HTML-теги, которые не соответствуют формату Markdown.
6.  Добавить примеры использования RST для заголовков.

**Оптимизированный код**

```rst
.. module:: src.endpoints.hypo69.code_assistant

Модуль Code Assistant
=========================================================================================

:Оглавление:

    .. toctree::
        :maxdepth: 2
        :caption: Оглавление:
        
        overview
        main_features
        project_structure
        usage_examples
        command_line_parameters
        logic_of_work
        exceptions
        logging
        dependencies
        create_new_role

.. _overview:

Обзор
-----------------------------------------------------------------------------------------

Модуль ``Code Assistant`` представляет собой набор инструментов для взаимодействия с моделями
**Gemini** и **OpenAI** с целью обработки исходного кода проекта. Он выполняет задачи,
такие как создание документации, проверка кода и генерация тестов на основе указанных файлов.
Также включает скрипты для создания файла ``SUMMARY.md`` для компиляции документации и Telegram-бота
для обработки задач, связанных с кодом.

.. _main_features:

Основные возможности
-----------------------------------------------------------------------------------------

**code_assistant.py**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- **Чтение файлов**: Читает код из файлов с расширениями ``.py`` и ``README.MD`` в указанных директориях.
- **Взаимодействие с моделями**: Отправляет код в модели для выполнения задач,
  таких как создание документации или проверка ошибок.
- **Генерация результатов**: Сохраняет ответы моделей в указанные директории для каждой роли.

**make_summary.py**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- **Генерация ``SUMMARY.md``**: Рекурсивно обходит директорию для создания файла ``SUMMARY.md`` для компиляции документации.
- **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (``ru`` или ``en``).

**onela_bot.py** и **bot_handlers.py**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- **Telegram-бот**: Бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода на проверку
  или генерация документации.
- **Обработчики бота**: Содержит обработчики для команд и сообщений бота.

.. _project_structure:

Структура проекта
-----------------------------------------------------------------------------------------

- **Модели**: Используются модели **Gemini** и **OpenAI** для обработки запросов.
- **Промпты**: Читает промпты из файлов в директории ``src/ai/prompts/developer/`` (например, ``doc_writer_en.md``).
- **Файлы**: Обрабатываются файлы с расширениями ``.py`` и ``README.MD`` в указанных директориях.

.. _usage_examples:

Примеры использования
-----------------------------------------------------------------------------------------

**Запуск с настройками из JSON:**

.. code-block:: bash

    python code_assistant.py --settings settings.json

**Запуск с явным указанием параметров:**

.. code-block:: bash

    python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2

**Пример для роли ``code_checker``:**

.. code-block:: bash

    python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir

**Пример для модели ``openai``:**

.. code-block:: bash

    python code_assistant.py --role doc_writer --lang en --models openai

.. _command_line_parameters:

Параметры командной строки
-----------------------------------------------------------------------------------------

- ``--settings``: Путь к JSON-файлу с настройками. Загружает параметры из файла.
- ``--role``: Роль модели для выполнения задачи (например, ``doc_writer``, ``code_checker``).
- ``--lang``: Язык выполнения задачи (например, ``ru`` или ``en``).
- ``--models``: Список моделей для инициализации (например, ``gemini``, ``openai``).
- ``--start_dirs``: Список директорий для обработки (например, ``/path/to/dir1``).

.. _logic_of_work:

Логика работы
-----------------------------------------------------------------------------------------

1. **Чтение файлов**: Поиск файлов с расширениями ``.py`` и ``README.MD`` в указанных директориях.
2. **Загрузка промптов**: Загрузка промптов для каждой роли из директории ``src/ai/prompts/developer/``.
3. **Обработка запросов**: Формирование запросов на основе загруженных файлов и их отправка в модели.
4. **Сохранение ответов**: Сохранение ответов моделей в директории, соответствующие роли и модели
   (например, ``docs/raw_rst_from_<model>/<lang>/``).

.. _exceptions:

Исключения
-----------------------------------------------------------------------------------------

Настройка исключений для файлов и директорий с помощью параметров:

- ``exclude_file_patterns``: Список регулярных выражений для исключения файлов.
- ``exclude_dirs``: Список директорий для исключения.
- ``exclude_files``: Список файлов для исключения.

.. _logging:

Логирование
-----------------------------------------------------------------------------------------

Логи сохраняются с помощью библиотеки ``logger`` и содержат информацию о процессе обработки файлов и полученных ответах.

.. _dependencies:

Зависимости
-----------------------------------------------------------------------------------------

- **Gemini API**: Требуется API-ключ для работы с моделью Gemini.
- **OpenAI API**: Требуется API-ключ для работы с моделью OpenAI.

.. _create_new_role:

Создание новой роли для моделей ИИ
-----------------------------------------------------------------------------------------

1. **Обновление ``code_assistant.json``**:
   - Добавьте новую роль в список ролей:

     .. code-block:: json

        "roles": [
          "code_checker",
          ...
        ]

   - Или исключите её в ``"exclude-roles"``.

2. **Добавление роли в переводы**:
   - Обновите файл ``translations/translations.json`` с новой ролью.

3. **Создание системного промпта**:
   - Добавьте новый системный промпт в директорию ``ai/prompts/developer/``.

4. **Создание командной инструкции**:
   - Добавьте новую команду в директорию ``instructions/``.
```
# Анализ кода модуля `system_instruction.md`

**Качество кода**
- **Соответствие требованиям к формату кода (1-10):** 
   -  **Плюсы:**
        - Инструкции четко структурированы, используются заголовки и списки, что облегчает их восприятие.
        -  Приведен пример кроссворда, что помогает понять требуемый формат вывода.
        -   Приведен пример кода, демонстрирующий использование инструкции с классом `GoogleGenerativeAI`.
   - **Минусы:**
        -  Инструкция не соответствует формату `reStructuredText (RST)`.
        -  Пример кода не соответствует формату, требуемому для проекта (отсутствие комментариев, не используются `j_loads`, `j_loads_ns`  и т.д.).
        -  В примере кода используется `input` для получения API key, что не безопасно и не рекомендуется.

**Рекомендации по улучшению**

1.  **Формат документации:**
    -   Переписать инструкции в формате `reStructuredText (RST)`.
    -   Добавить описание модуля в начале файла.
    -   Добавить документацию к функциям и переменным в примере кода.

2.  **Пример кода:**
    -   Изменить пример кода, следуя инструкциям проекта, а именно: использовать `j_loads` или `j_loads_ns` для чтения данных.
    -   Добавить комментарии в стиле, требуемом в проекте.
    -   Изменить способ получения API-ключа, например, через переменные окружения или файл конфигурации.
    -   Использовать `logger.error` для логирования ошибок.
    -   Убрать использование стандартных `try-except` блоков, где это не требуется.
   
3.  **Инструкции:**
    - Уточнить инструкции, чтобы они были более конкретными.

**Улучшенный код**

```python
"""
Модуль для создания кроссвордов на основе заданных тем.
========================================================

Модуль предоставляет инструкцию для модели генерации текста,
описывающую требования к созданию кроссвордов и их представлению.

Инструкция включает требования к формату вывода кроссворда (таблица ASCII)
и списка слов с определениями, а также шаги создания кроссворда.
"""

import google.generativeai as genai
from src.logger.logger import logger # добавление импорта logger
from src.utils.jjson import j_loads # добавление импорта j_loads

class GoogleGenerativeAI:
    """
    Класс для работы с Google Generative AI.

    :param api_key: API ключ для доступа к Google Gemini.
    :type api_key: str
    :param system_instruction: Инструкция для модели.
    :type system_instruction: str, optional
    :param model_name: Имя модели для использования. Defaults to 'gemini-2.0-flash-exp'.
    :type model_name: str, optional
    """

    MODELS = [
        "gemini-1.5-flash-8b",
        "gemini-2-13b",
        "gemini-3-20b"
    ]

    def __init__(self, api_key: str, system_instruction: str = '', model_name: str = 'gemini-2.0-flash-exp'):
        """
        Инициализирует экземпляр класса GoogleGenerativeAI.

        :param api_key: API ключ для доступа к Google Gemini.
        :type api_key: str
        :param system_instruction: Инструкция для модели.
        :type system_instruction: str, optional
        :param model_name: Имя модели для использования. Defaults to 'gemini-2.0-flash-exp'.
        :type model_name: str, optional
        """
        self.api_key = api_key
        self.model_name = model_name
        genai.configure(api_key=self.api_key) # настройка api ключа
        self.model = genai.GenerativeModel(model_name=self.model_name, system_instruction=system_instruction) # инициализация модели

    def ask(self, q: str) -> str:
        """
        Отправляет запрос к модели и возвращает ответ.

        :param q: Запрос к модели.
        :type q: str
        :return: Ответ от модели или сообщение об ошибке.
        :rtype: str
        """
        try:
            response = self.model.generate_content(q) # получение ответа от модели
            return response.text # возврат текста ответа
        except Exception as ex:
            logger.error(f'Ошибка при выполнении запроса к модели: {str(ex)}') # логирование ошибки
            return f"Error: {str(ex)}" # возврат сообщения об ошибке

################################################################################
#                                                                              #
#             INSERT YOUR GEMINI API KEY                                       #
#                                                                              #
################################################################################
# API_KEY: str = input("API ключ от `gemini`") # Изменено на чтение из переменной окружения или файла конфигурации
API_KEY: str = 'YOUR_API_KEY' # TODO: Изменить на получение api key безопасным способом
system_instruction = """
Ты - генератор кроссвордов. Твоя задача - создавать кроссворды на заданную тему и предоставлять их в виде ASCII-таблицы, а также список слов и их определений.

1. **Формат ответа:**
   - Кроссворд должен быть представлен в виде таблицы, состоящей из символов `+`, `-`, `|`, и пробелов, где буквы слов кроссворда расположены в пустых ячейках. 
   - Заполненные клетки отмечаются символом `#`.
   - Нумерация слов начинается с 1 и ставится перед словом в таблице.
   - Список слов и их определений должен быть представлен в формате:
     
     `1.  Слово - Определение`
     `2.  Слово - Определение`
     ...

2.  **Процесс создания кроссворда:**
    -   При создании сетки кроссворда используй простые прямоугольные формы с размером минимум 5x5.
    -   Выбирай слова, связанные с указанной темой.
    -   Слова должны пересекаться, образуя классический кроссворд.
    -   В кроссворде должно быть как минимум 5 слов.
    -   Старайся использовать как горизонтальные, так и вертикальные слова.
  
3.  **Пример ответа:**

    ```
    +---+---+---+---+---+---+---+
    | 1 |   |   |   |   |   |   |
    +---+---+---+---+---+---+---+
    |   |   |   | 2 |   |   |   |
    +---+---+---+---+---+---+---+
    |   |   |   |   |   | 3 |   |
    +---+---+---+---+---+---+---+
    |   | 4 |   |   |   |   |   |
    +---+---+---+---+---+---+---+
    |   |   |   |   |   |   | 5 |
    +---+---+---+---+---+---+---+
    ```

    Слова:
    1.  ФУТБОЛ - Командная игра с мячом.
    2.  СУДЬЯ - Человек, следящий за правилами игры.
    3.  ГОЛ - Попадание мяча в ворота.
    4.  ИГРОК - Участник команды.
    5.  МЯЧ - Сферический предмет для игры.

4. **Инструкции по запросу:**
   -   Когда ты получишь тему, ты должна сгенерировать кроссворд, который будет соответствовать данной теме, а затем предоставить его в указанном формате.

5. **Язык:**
    -  Отвечай на языке запроса.
"""

model = GoogleGenerativeAI(api_key = API_KEY, system_instruction=system_instruction) # инициализация модели

q = input("Тема кроссворда: ") # запрос темы кроссворда
response = model.ask(q) # отправка запроса и получение ответа
print(response) # вывод ответа
```
# Модуль `hypotez/src/suppliers/aliexpress/campaign/_pytest/test_alipromo_campaign.py`

## Обзор

Этот модуль содержит тесты для класса `AliPromoCampaign` из модуля `src.suppliers.aliexpress.campaign.ali_promo_campaign`. Тесты проверяют корректность работы различных методов класса, включая инициализацию, получение данных о продуктах, создание различных пространств имен, обработку данных и сохранение данных о продуктах.


## Фикстуры

### `campaign`

**Описание**: Фикстура для создания экземпляра класса `AliPromoCampaign` для использования в тестах.

**Возвращает**:
- `AliPromoCampaign`: Экземпляр класса `AliPromoCampaign`.


## Тесты

### `test_initialize_campaign`

**Описание**: Тестирует метод `initialize_campaign`, проверяя правильную инициализацию данных кампании.

**Аргументы**:
- `mocker`:  Объект для подмокирования функций.
- `campaign`:  Фикстура, предоставляющая экземпляр класса `AliPromoCampaign`.


**Действие**:
- Подменяет `j_loads_ns` функцию из `src.utils.jjson` на функцию, возвращающую заранее подготовленные данные.
- Вызывает метод `initialize_campaign`.
- Проверяет, что атрибуты `campaign.campaign.name` и `campaign.campaign.category.test_category.name` соответствуют ожидаемым значениям.


### `test_get_category_products_no_json_files`

**Описание**: Тестирует метод `get_category_products` в случае отсутствия JSON файлов.

**Аргументы**:
- `mocker`:  Объект для подмокирования функций.
- `campaign`:  Фикстура, предоставляющая экземпляр класса `AliPromoCampaign`.


**Действие**:
- Подменяет `get_filenames` функцию из `src.utils.file` на функцию, возвращающую пустой список.
- Подменяет `fetch_product_data` на функцию, возвращающую пустой список.
- Вызывает метод `get_category_products` с параметром `force=True`.
- Проверяет, что возвращаемый список пустой.


### `test_get_category_products_with_json_files`

**Описание**: Тестирует метод `get_category_products` в случае наличия JSON файлов.

**Аргументы**:
- `mocker`:  Объект для подмокирования функций.
- `campaign`:  Фикстура, предоставляющая экземпляр класса `AliPromoCampaign`.


**Действие**:
- Подменяет `get_filenames` на функцию, возвращающую массив `["product_123.json"]`.
- Подменяет `j_loads_ns` на функцию, возвращающую объект `SimpleNamespace` с данными о продукте.
- Вызывает метод `get_category_products`.
- Проверяет, что возвращаемый список содержит один элемент с корректными значениями для `product_id` и `product_title`.


### `test_create_product_namespace`, `test_create_category_namespace`, `test_create_campaign_namespace`

**Описание**:  Тесты для методов создания пространств имен для продукта, категории и кампании соответственно, проверяя корректность заполнения атрибутов.


### `test_prepare_products`

**Описание**: Тестирует метод `prepare_products`, проверяя, что вызывается метод `process_affiliate_products`.

**Аргументы**:
- `mocker`:  Объект для подмокирования функций.
- `campaign`:  Фикстура, предоставляющая экземпляр класса `AliPromoCampaign`.


**Действие**:
- Подменяет несколько функций на заглушки, имитирующие поведение при отсутствии ошибок.
- Вызывает метод `prepare_products`.
- Проверяет, что метод `process_affiliate_products` был вызван один раз.


### `test_fetch_product_data`

**Описание**: Тестирует метод `fetch_product_data`, проверяя корректное получение данных о продуктах.

**Аргументы**:
- `mocker`:  Объект для подмокирования функций.
- `campaign`:  Фикстура, предоставляющая экземпляр класса `AliPromoCampaign`.


**Действие**:
- Подменяет `process_affiliate_products` на функцию, возвращающую список объектов `SimpleNamespace` с данными о продуктах.
- Вызывает метод `fetch_product_data` с списком `product_ids`.
- Проверяет количество возвращенных продуктов и значения их атрибутов `product_id`.


### `test_save_product`

**Описание**: Тестирует метод `save_product`, проверяя корректное сохранение данных о продукте.

**Аргументы**:
- `mocker`:  Объект для подмокирования функций.
- `campaign`:  Фикстура, предоставляющая экземпляр класса `AliPromoCampaign`.


**Действие**:
- Подменяет `j_dumps` на функцию, возвращающую пустую строку.
- Подменяет `Path.write_text` на заглушку.
- Вызывает метод `save_product`.
- Проверяет, что `Path.write_text` был вызван один раз с корректными параметрами.


### `test_list_campaign_products`

**Описание**: Тестирует метод `list_campaign_products`, проверяя корректное получение названий продуктов.

**Аргументы**:
- `campaign`:  Фикстура, предоставляющая экземпляр класса `AliPromoCampaign`.


**Действие**:
- Заполняет атрибут `campaign.category.products` двумя объектами `SimpleNamespace` с названиями продуктов.
- Вызывает метод `list_campaign_products`.
- Проверяет, что возвращаемый список содержит корректные названия продуктов.
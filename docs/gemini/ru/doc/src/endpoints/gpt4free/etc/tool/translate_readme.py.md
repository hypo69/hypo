# Модуль для перевода README файлов

## Обзор

Модуль предназначен для автоматического перевода файлов `README.md` на указанный язык с использованием AI-моделей через библиотеку `g4f`. В частности, он использует `g4f.Provider.OpenaiChat` для выполнения перевода, сохраняя при этом примеры кода и некоторые специальные элементы (например, `[!Note]`) без изменений. Модуль позволяет переводить отдельные части текста, исключая или обрабатывая определенные блоки (`blocklist` и `allowlist`) в соответствии с заданными правилами.

## Подобней

Этот модуль играет важную роль в проекте `hypotez`, так как позволяет автоматически создавать переводы документации, делая проект доступным для разработчиков, говорящих на разных языках. Он использует асинхронный подход для эффективной обработки текста и предоставляет гибкие настройки для управления процессом перевода, такие как указание языка, провайдера AI-модели и списков исключений. Расположение файла в структуре проекта указывает на его роль как инструмента для генерации документации.

## Функции

### `read_text`

```python
def read_text(text) -> str:
    """
    Извлекает текст из markdown документа, находящегося между блоками code fences (` ``` `).

    Args:
        text (str): Markdown текст для извлечения.

    Returns:
        str: Текст, находящийся между первым и последним блоками code fences.
             Возвращает пустую строку, если code fences не найдены.

    Как работает функция:
    1. Разбивает входной текст на строки.
    2. Итерируется по строкам, определяя начало и конец блоков code fences.
    3. Если найдены начало и конец, извлекает текст между ними.
    4. Возвращает извлеченный текст.

    ASCII flowchart:

    Начало
    ↓
    Разбить текст на строки
    ↓
    Найти начало code fence
    ↓
    Найти конец code fence
    ↓
    Извлечь текст между code fences
    ↓
    Конец

    Примеры:
    >>> read_text("```\nHello\n```")
    'Hello'
    >>> read_text("Some text\n```\nCode\n```\nMore text")
    'Code'
    >>> read_text("No code fences")
    ''
    """
    ...
```

### `translate`

```python
async def translate(text) -> str:
    """
    Асинхронно переводит текст с использованием указанного AI-провайдера.

    Args:
        text (str): Текст для перевода.

    Returns:
        str: Переведенный текст.

    Как работает функция:
    1. Формирует запрос для AI-провайдера, включая инструкции по переводу и исходный текст.
    2. Если в тексте есть маркер "[!Note]", добавляет инструкцию о сохранении этого маркера.
    3. Вызывает асинхронный метод `provider.create_async` для выполнения перевода.
    4. Извлекает переведенный текст из ответа, используя функцию `read_text`.
    5. Добавляет закрывающий code fence, если исходный текст заканчивается на "```", а результат - нет.

    ASCII flowchart:

    Начало
    ↓
    Сформировать запрос для AI-провайдера
    ↓
    Добавить инструкцию о сохранении маркера [!Note] (если есть)
    ↓
    Вызвать AI-провайдера для перевода
    ↓
    Извлечь переведенный текст
    ↓
    Добавить закрывающий code fence (если необходимо)
    ↓
    Конец

    Примеры:
    Предположим, что AI-провайдер переводит "Hello" как "Bonjour".
    >>> await translate("Hello")
    'Bonjour'
    >>> await translate("[!Note] Hello")
    '[!Note] Bonjour'
    """
    ...
```

### `translate_part`

```python
async def translate_part(part: str, i: int) -> str:
    """
    Асинхронно переводит часть текста, учитывая списки исключений и разрешений.

    Args:
        part (str): Часть текста для перевода.
        i (int): Индекс части текста (для логирования).

    Returns:
        str: Переведенная часть текста.

    Как работает функция:
    1. Проверяет, содержится ли в текущей части текста какой-либо элемент из списка `blocklist`.
    2. Если элемент найден, переводит только первую строку и элементы из `allowlist`.
    3. Если элемент не найден, переводит всю часть текста целиком.
    4. Логирует факт перевода.

    ASCII flowchart:

    Начало
    ↓
    Проверить наличие blocklist элементов
    ↓
    Если blocklist элемент найден:
        Перевести первую строку
        Перевести allowlist элементы
    Иначе:
        Перевести всю часть текста
    ↓
    Залогировать факт перевода
    ↓
    Конец

    Примеры:
    Предположим, что `blocklist` содержит "## ©️ Copyright", а `allowlist` - "### Models".
    >>> await translate_part("## ©️ Copyright This text", 1)
    '## ©️ Copyright Переведенный текст'
    >>> await translate_part("### Models This text", 2)
    '### Models Переведенный текст'
    """
    ...
```

### `translate_readme`

```python
async def translate_readme(readme: str) -> str:
    """
    Асинхронно переводит весь README файл, разделяя его на части.

    Args:
        readme (str): Содержимое README файла.

    Returns:
        str: Полностью переведенное содержимое README файла.

    Как работает функция:
    1. Разделяет README файл на части, используя "## " в качестве разделителя.
    2. Запускает асинхронные задачи для перевода каждой части, используя `asyncio.gather`.
    3. Объединяет переведенные части обратно в один текст.

    ASCII flowchart:

    Начало
    ↓
    Разделить README на части
    ↓
    Запустить асинхронные задачи для перевода каждой части
    ↓
    Объединить переведенные части
    ↓
    Конец

    Примеры:
    Предположим, что README содержит "## Title\nText".
    >>> await translate_readme("## Title\nText")
    '## Переведенный заголовок\n\nПереведенный текст'
    """
    ...
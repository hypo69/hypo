# Модуль `try_xpath_background.js`

## Обзор

Этот модуль содержит код расширения для браузера, отвечающий за обработку сообщений и управление стилями. Он взаимодействует с активной вкладкой и обновляет её содержимое.

## Переменные

### `tx`

**Описание**: псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Хранит состояние всплывающего окна.

### `popupCss`

**Описание**: Стиль CSS для всплывающего окна.

### `results`

**Описание**: Содержит результаты поиска.

### `css`

**Описание**: Содержит загруженный CSS.

### `attributes`

**Описание**: Объект, содержащий атрибуты для поиска.

### `genericListener.listeners`

**Описание**: Объект, содержащий обработчики событий.


## Функции

### `loadDefaultCss`

**Описание**: Загружает CSS из файла `try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Текст загруженного CSS.

**Вызывает исключения**:
- `fu.onError`: Если произошла ошибка при загрузке CSS.


### `genericListener`

**Описание**: Обработчик сообщений от содержимого вкладки.

**Параметры**:
- `message`: Сообщение от содержимого вкладки.
- `sender`: Объект, представляющий отправителя сообщения.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- Возвращает значение, возвращаемое обработчиком события, если оно определено. Иначе `undefined`.

**Вызывает исключения**:
- Любые исключения, возникающие внутри обработчиков событий.


### `genericListener.listeners.storePopupState`

**Описание**: Сохраняет состояние всплывающего окна.

**Параметры**:
- `message`: Сообщение с состоянием всплывающего окна.

**Возвращает**:
- `undefined`

### `genericListener.listeners.requestRestorePopupState`

**Описание**: Восстанавливает состояние всплывающего окна.

**Параметры**:
- `message`: Сообщение с запросом на восстановление состояния.

**Возвращает**:
- `undefined`

### `genericListener.listeners.requestInsertStyleToPopup`

**Описание**: Отправляет запрос на вставку CSS в всплывающее окно.

**Возвращает**:
- `undefined`


### `genericListener.listeners.showAllResults`

**Описание**: Показывает все результаты поиска в новой вкладке.

**Параметры**:
- `message`: Сообщение с результатами поиска.
- `sender`: Объект, представляющий отправителя сообщения.

**Возвращает**:
- `undefined`


### `genericListener.listeners.loadResults`

**Описание**: Отправляет результаты поиска в ответ.

**Параметры**:
- `message`: Сообщение.
- `sender`: Объект, представляющий отправителя сообщения.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `true`: Указывает, что обработчик завершен успешно.


### `genericListener.listeners.updateCss`

**Описание**: Обновляет CSS в активной вкладке.

**Параметры**:
- `message`: Сообщение с новым CSS.
- `sender`: Объект, представляющий отправителя сообщения.

**Возвращает**:
- `undefined`

**Вызывает исключения**:
- `fu.onError`: Если произошла ошибка при вставке/удалении CSS.


### `genericListener.listeners.loadOptions`

**Описание**: Загружает настройки.

**Параметры**:
- `message`: Сообщение.
- `sender`: Объект, представляющий отправителя сообщения.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `true`: Указывает, что обработчик завершен успешно.


### `genericListener.listeners.requestSetContentInfo`

**Описание**: Отправляет запрос на установку информации о содержимом в активной вкладке.

**Параметры**:
- `message`: Сообщение с данными.
- `sender`: Объект, представляющий отправителя сообщения.

**Возвращает**:
- `undefined`


## Обработчики изменений настроек

### `browser.storage.onChanged.addListener`

**Описание**: Обработчик изменений настроек. Обновляет переменные `attributes`, `css` и `popupCss` при изменении настроек.


## Загрузка настроек

### `browser.storage.sync.get`

**Описание**: Загружает настройки из хранилища. Загружает значения `attributes`, `css`, `popupCss` и, при необходимости, загружает значения по умолчанию для `css`.

**Возвращает**:
- `Promise<object>`: Объект с загруженными настройками.

**Вызывает исключения**:
- `fu.onError`: Если произошла ошибка при загрузке настроек.



##  Заключение

Данный модуль обеспечивает динамическую загрузку и обновление CSS в активной вкладке, взаимодействует со всплывающим окном, сохраняет и восстанавливает состояние, обрабатывает результаты поиска и загружает настройки.
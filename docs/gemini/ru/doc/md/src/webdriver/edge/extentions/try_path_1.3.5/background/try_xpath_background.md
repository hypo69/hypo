# Модуль try_xpath_background.js

## Обзор

Этот модуль отвечает за обработку сообщений и выполнение различных задач в фоновом режиме расширения `try_xpath`. Он взаимодействует с другими компонентами расширения, управляет стилями, отображением результатов и сохранением состояния.

## Переменные

### `tx`

**Описание**: Псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: Псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Хранит текущее состояние всплывающего окна.

### `popupCss`

**Описание**: Строка CSS-стилей, применяемых к всплывающему окну.

### `results`

**Описание**: Объект, содержащий результаты поиска.

### `css`

**Описание**: Содержит загруженные стили.

### `attributes`

**Описание**: Объект, содержащий атрибуты, используемые расширением.

## Функции

### `loadDefaultCss()`

**Описание**: Загружает CSS-стили по умолчанию из файла `/css/try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Текст загруженного CSS.

**Вызывает исключения**:
- `Ошибка` (generic): Возникает при ошибке загрузки CSS.

### `genericListener(message, sender, sendResponse)`

**Описание**: Общая функция-обработчик сообщений. Выполняет соответствующую функцию, основанную на типе сообщения.

**Параметры**:
- `message` (объект): Объект с данными сообщения.
- `sender` (объект): Объект отправителя сообщения.
- `sendResponse` (функция): Функция для отправки ответа.

**Возвращает**:
- `boolean | void`: Может вернуть `true`, если обработка требует асинхронного ответа.

### `genericListener.listeners.storePopupState(message)`

**Описание**: Сохраняет состояние всплывающего окна.

**Параметры**:
- `message` (объект): Объект с данными сообщения.

**Возвращает**:
- `void`

### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Отправляет сообщение для восстановления состояния всплывающего окна.

**Параметры**:
- `message` (объект): Объект с данными сообщения.

**Возвращает**:
- `void`


### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Отправляет сообщение для вставки стилей в всплывающее окно.

**Возвращает**:
- `void`

### `genericListener.listeners.showAllResults(message, sender)`

**Описание**: Обрабатывает запрос на отображение всех результатов поиска.

**Параметры**:
- `message` (объект): Объект с данными сообщения.
- `sender` (объект): Объект отправителя сообщения.


**Возвращает**:
- `void`

### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Отправляет результаты поиска в ответ.

**Параметры**:
- `message` (объект): Объект с данными сообщения.
- `sender` (объект): Объект отправителя сообщения.
- `sendResponse` (функция): Функция для отправки ответа.

**Возвращает**:
- `boolean`: `true`, если обработка требует асинхронного ответа.


### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Обновляет CSS-стили в текущей вкладке.

**Параметры**:
- `message` (объект): Объект с данными сообщения, включая набор устаревших CSS-стилей.
- `sender` (объект): Объект отправителя сообщения.

**Возвращает**:
- `void`

**Вызывает исключения**:
- `fu.onError():` Возникает при ошибках во время выполнения запросов.


### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Возвращает информацию о CSS-стилях и атрибутах.

**Параметры**:
- `message` (объект): Объект с данными сообщения.
- `sender` (объект): Объект отправителя сообщения.
- `sendResponse` (функция): Функция для отправки ответа.

**Возвращает**:
- `boolean`: `true`, если обработка требует асинхронного ответа.

### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Отправляет сообщение для установки информации о содержимом в текущую вкладку.

**Параметры**:
- `message` (объект): Объект с данными сообщения.
- `sender` (объект): Объект отправителя сообщения.

**Возвращает**:
- `void`


## Обработчики событий

### `browser.storage.onChanged.addListener`

**Описание**: Обрабатывает изменения в хранилище `browser.storage`. Обновляет переменные `attributes`, `css` и `popupCss` при необходимости.

**Параметры**:
- `changes` (объект): Объект с информацией о произошедших изменениях.


## Инициализация

### `browser.storage.sync.get`

**Описание**: Выполняет запрос в хранилище `browser.storage.sync` для получения данных о стилях.

**Возвращает**:
- `Promise<object>`: Объект с полученными данными.
# Модуль для работы с XAI API (Grok)

## Обзор

Модуль предоставляет класс `XAI`, который позволяет взаимодействовать с API x.ai (Grok) для выполнения задач, связанных с завершением чата, как в потоковом, так и в непотоковом режимах. Класс включает методы для отправки запросов к API и обработки ответов.

## Содержание

- [Обзор](#обзор)
- [Классы](#классы)
  - [XAI](#xai)
    - [Методы](#методы)
      - [`__init__`](#__init__)
      - [`_send_request`](#_send_request)
      - [`chat_completion`](#chat_completion)
      - [`stream_chat_completion`](#stream_chat_completion)
- [Пример использования](#пример-использования)

## Классы

### `XAI`

**Описание**:
Класс `XAI` предназначен для взаимодействия с API x.ai (Grok). Он предоставляет методы для отправки запросов и получения ответов, включая поддержку потокового режима.

**Как работает класс**:
При инициализации класс принимает API-ключ, который используется для аутентификации при каждом запросе к API. Базовый URL и заголовки запросов устанавливаются в конструкторе класса.

**Методы**:

- `__init__`: Инициализирует экземпляр класса `XAI` с заданным API-ключом.
- `_send_request`: Отправляет HTTP-запрос к API x.ai.
- `chat_completion`: Отправляет запрос на завершение чата и возвращает ответ API.
- `stream_chat_completion`: Отправляет запрос на завершение чата в потоковом режиме и возвращает поток ответов.

#### `__init__`

```python
def __init__(self, api_key):
    """
    Инициализация класса XAI.

    Args:
        api_key: Ключ API для аутентификации.
    """
    ...
```

**Назначение**:
Инициализирует экземпляр класса `XAI`.

**Как работает функция**:
Функция инициализирует экземпляр класса `XAI`, принимая API-ключ для аутентификации. Она устанавливает базовый URL API и заголовки, необходимые для взаимодействия с API x.ai.

**Параметры**:
- `api_key` (str): Ключ API для аутентификации.

**Возвращает**:
- None

#### `_send_request`

```python
def _send_request(self, method, endpoint, data=None):
    """
    Отправка запроса к API x.ai.

    Args:
        method: Метод HTTP (GET, POST, PUT, DELETE).
        endpoint: Конечная точка API.
        data: Данные для отправки в теле запроса (для POST и PUT).
    Returns:
        Ответ от API.
    Raises:
        requests.exceptions.HTTPError: Если статус ответа не 2xx.
    """
    ...
```

**Назначение**:
Отправляет HTTP-запрос к API x.ai.

**Как работает функция**:
Функция отправляет HTTP-запрос к указанной конечной точке API с использованием заданного метода (GET, POST, PUT, DELETE). Если запрос успешен (статус код 2xx), возвращает JSON-ответ. В случае ошибки выбрасывает исключение `HTTPError`.

**Параметры**:
- `method` (str): Метод HTTP (GET, POST, PUT, DELETE).
- `endpoint` (str): Конечная точка API.
- `data` (Optional[dict]): Данные для отправки в теле запроса (для POST и PUT). По умолчанию `None`.

**Возвращает**:
- `dict`: JSON-ответ от API.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Если статус ответа не 2xx.

#### `chat_completion`

```python
def chat_completion(self, messages, model="grok-beta", stream=False, temperature=0):
    """
    Запрос на завершение чата.

    Args:
        messages: Список сообщений для чата.
        model: Модель для использования.
        stream: Флаг для включения потоковой передачи.
        temperature: Температура для генерации ответа.
    Returns:
        Ответ от API.
    """
    ...
```

**Назначение**:
Отправляет запрос на завершение чата к API x.ai.

**Как работает функция**:
Функция отправляет запрос на завершение чата, используя указанную модель и параметры (сообщения, флаг потоковой передачи, температура). Возвращает ответ от API в формате JSON.

**Параметры**:
- `messages` (list): Список сообщений для чата.
- `model` (str): Модель для использования. По умолчанию "grok-beta".
- `stream` (bool): Флаг для включения потоковой передачи. По умолчанию `False`.
- `temperature` (int): Температура для генерации ответа. По умолчанию 0.

**Возвращает**:
- `dict`: Ответ от API.

#### `stream_chat_completion`

```python
def stream_chat_completion(self, messages, model="grok-beta", temperature=0):
    """
    Запрос на завершение чата с потоковой передачей.

    Args:
        messages: Список сообщений для чата.
        model: Модель для использования.
        temperature: Температура для генерации ответа.
    Returns:
        Поток ответов от API.
    Raises:
        requests.exceptions.HTTPError: Если статус ответа не 2xx.
    """
    ...
```

**Назначение**:
Отправляет запрос на завершение чата в потоковом режиме.

**Как работает функция**:
Функция отправляет запрос на завершение чата в потоковом режиме, используя указанную модель и параметры. Возвращает поток ответов от API, который можно итерировать для получения каждого ответа по отдельности. В случае ошибки выбрасывает исключение `HTTPError`.

**Параметры**:
- `messages` (list): Список сообщений для чата.
- `model` (str): Модель для использования. По умолчанию "grok-beta".
- `temperature` (int): Температура для генерации ответа. По умолчанию 0.

**Возвращает**:
- `Generator[str, None, None]`: Поток ответов от API.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Если статус ответа не 2xx.

## Пример использования

В данном разделе представлен пример использования класса `XAI` для взаимодействия с API x.ai.

```python
if __name__ == "__main__":
    api_key = "your_api_key_here"  # Замените на ваш реальный API-ключ
    xai = XAI(api_key)

    messages = [
        {
            "role": "system",
            "content": "You are Grok, a chatbot inspired by the Hitchhikers Guide to the Galaxy."
        },
        {
            "role": "user",
            "content": "What is the answer to life and universe?"
        }
    ]

    # Непотоковый запрос
    completion_response = xai.chat_completion(messages)
    print("Non-streaming response:", completion_response)

    # Потоковый запрос
    stream_response = xai.stream_chat_completion(messages)
    print("Streaming response:")
    for line in stream_response:
        if line.strip():
            print(json.loads(line))
```

**Описание**:
В примере демонстрируется создание экземпляра класса `XAI` с использованием API-ключа, а также отправка запросов на завершение чата в потоковом и непотоковом режимах. Результаты запросов выводятся на экран.
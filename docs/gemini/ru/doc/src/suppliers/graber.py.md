# Модуль грабера

## Обзор

Модуль `graber.py` предназначен для сбора информации о товарах с веб-страниц поставщиков. Он содержит базовый класс `Graber`, который использует веб-драйвер для извлечения данных, таких как название, описание, спецификация, артикул и цена. Локаторы для полей хранятся в JSON-файлах в директории `locators` каждого поставщика. Модуль также предоставляет возможность переопределения функций для нестандартной обработки полей товара.

## Подробней

Этот модуль играет важную роль в процессе сбора данных о товарах из различных источников (веб-сайтов поставщиков). Он предоставляет гибкий и расширяемый способ извлечения информации, позволяя адаптироваться к различным структурам веб-страниц и требованиям к данным.

Основные задачи, выполняемые модулем:

1.  **Инициализация и настройка**:
    *   Загрузка необходимых библиотек и модулей.
    *   Инициализация класса `Graber` с указанием префикса поставщика, индекса языка и экземпляра драйвера.
    *   Загрузка локаторов для элементов веб-страницы из JSON-файла.
    *   Установка глобальных настроек через объект `Context`.
2.  **Сбор данных со страницы**:
    *   Использование веб-драйвера для навигации по веб-странице и извлечения данных.
    *   Применение локаторов для определения местоположения нужных элементов на странице.
    *   Обработка и нормализация полученных данных с использованием функций из модуля `src.utils.string.normalizer`.
    *   Заполнение полей объекта `ProductFields` собранными данными.
3.  **Обработка ошибок**:
    *   Логирование ошибок с использованием модуля `src.logger.logger`.
    *   Предоставление механизма для обработки исключений, возникающих при выполнении локаторов.
4.  **Расширение и адаптация**:
    *   Возможность переопределения функций для нестандартной обработки полей товара в классах-наследниках `Graber`.
    *   Использование декоратора `@close_pop_up` для закрытия всплывающих окон перед выполнением основной логики функций.
5.  **Сохранение изображений**:
    *   Загрузка и сохранение изображений товаров локально с использованием функций из модуля `src.utils.image`.

Модуль `graber.py` является основой для создания специализированных граберов для каждого поставщика, обеспечивая стандартизированный и эффективный способ сбора данных о товарах.

## Классы

### `Context`

**Описание**: Класс для хранения глобальных настроек, таких как драйвер, локатор для декоратора и префикс поставщика.

**Атрибуты**:

*   `driver` (Optional['Driver']): Объект драйвера, используемый для управления браузером.
*   `locator_for_decorator` (Optional[SimpleNamespace]): Локатор для декоратора `@close_pop_up`.
*   `supplier_prefix` (Optional[str]): Префикс поставщика.

**Примеры**:

```python
context = Context()
context.supplier_prefix = 'prefix'
print(context.supplier_prefix)
```

### `Graber`

**Описание**: Базовый класс для сбора данных со страницы для всех поставщиков.

**Методы**:

*   `__init__`: Инициализация класса Graber.
*   `error`: Обработчик ошибок для полей.
*   `set_field_value`: Универсальная функция для установки значений полей с обработкой ошибок.
*   `grab_page`: Синхронная функция для сбора полей продукта.
*   `grab_page_async`: Асинхронная функция для сбора полей продукта.
*   `additional_shipping_cost`: Извлечение и установка дополнительной стоимости доставки.
*   `delivery_in_stock`: Извлечение и установка статуса доставки в наличии.
*   `active`: Извлечение и установка статуса активности.
*   `additional_delivery_times`: Извлечение и установка дополнительного времени доставки.
*   `advanced_stock_management`: Извлечение и установка статуса расширенного управления запасами.
*   `affiliate_short_link`: Извлечение и установка короткой партнерской ссылки.
*   `affiliate_summary`: Извлечение и установка партнерского резюме.
*   `affiliate_summary_2`: Извлечение и установка партнерского резюме 2.
*   `affiliate_text`: Извлечение и установка партнерского текста.
*   `affiliate_image_large`: Извлечение и установка большого партнерского изображения.
*   `affiliate_image_medium`: Извлечение и установка среднего партнерского изображения.
*   `affiliate_image_small`: Извлечение и установка маленького партнерского изображения.
*   `available_date`: Извлечение и установка доступной даты.
*   `available_for_order`: Извлечение и установка статуса "доступно для заказа".
*   `available_later`: Извлечение и установка статуса "доступно позже".
*   `available_now`: Извлечение и установка статуса "доступно сейчас".
*   `additional_categories`: Установка дополнительных категорий.
*   `cache_default_attribute`: Извлечение и установка кэшированного атрибута по умолчанию.
*   `cache_has_attachments`: Извлечение и установка статуса "есть вложения в кэше".
*   `cache_is_pack`: Извлечение и установка статуса "является ли кэш пакетом".
*   `condition`: Извлечение и установка условия продукта.
*   `customizable`: Извлечение и установка статуса "настраиваемый".
*   `date_add`: Извлечение и установка даты добавления.
*   `date_upd`: Извлечение и установка даты обновления.
*   `delivery_out_stock`: Извлечение и установка статуса доставки вне склада.
*   `depth`: Извлечение и установка глубины.
*   `description`: Извлечение и установка описания.
*   `description_short`: Извлечение и установка короткого описания.
*   `id_category_default`: Извлечение и установка ID категории по умолчанию.
*   `id_default_combination`: Извлечение и установка ID комбинации по умолчанию.
*   `id_product`: Извлечение и установка ID продукта.
*   `locale`: Извлечение и установка локали.
*   `id_default_image`: Извлечение и установка ID изображения по умолчанию.
*   `ean13`: Извлечение и установка кода EAN13.
*   `ecotax`: Извлечение и установка ecotax.
*   `height`: Извлечение и установка высоты.
*   `how_to_use`: Извлечение и установка "как использовать".
*   `id_manufacturer`: Извлечение и установка ID производителя.
*   `id_supplier`: Извлечение и установка ID поставщика.
*   `id_tax`: Извлечение и установка ID налога.
*   `id_type_redirected`: Извлечение и установка ID типа перенаправления.
*   `images_urls`: Извлечение и установка URL-адресов изображений.
*   `indexed`: Извлечение и установка статуса индексации.
*   `ingredients`: Извлечение и установка ингредиентов.
*   `meta_description`: Извлечение и установка мета-описания.
*   `meta_keywords`: Извлечение и установка мета-ключевых слов.
*   `meta_title`: Извлечение и установка мета-заголовка.
*   `is_virtual`: Извлечение и установка виртуального статуса.
*   `isbn`: Извлечение и установка ISBN.
*   `link_rewrite`: Извлечение и установка перезаписи ссылки.
*   `location`: Извлечение и установка местоположения.
*   `low_stock_alert`: Извлечение и установка предупреждения о низком запасе.
*   `low_stock_threshold`: Извлечение и установка порога низкого запаса.
*   `minimal_quantity`: Извлечение и установка минимального количества.
*   `mpn`: Извлечение и установка MPN (Manufacturer Part Number).
*   `name`: Извлечение и установка названия продукта.
*   `online_only`: Извлечение и установка статуса "только онлайн".
*   `on_sale`: Извлечение и установка статуса "в продаже".
*   `out_of_stock`: Извлечение и установка статуса "нет в наличии".
*   `pack_stock_type`: Извлечение и установка типа запаса пакета.
*   `price`: Извлечение и установка цены.
*   `product_type`: Извлечение и установка типа продукта.
*   `quantity`: Извлечение и установка количества.
*   `quantity_discount`: Извлечение и установка скидки за количество.
*   `redirect_type`: Извлечение и установка типа перенаправления.
*   `reference`: Извлечение и установка ссылки.
*   `show_condition`: Извлечение и установка отображения условия.
*   `show_price`: Извлечение и установка отображения цены.
*   `state`: Извлечение и установка состояния.
*   `text_fields`: Извлечение и установка текстовых полей.
*   `unit_price_ratio`: Извлечение и установка коэффициента цены за единицу.
*   `unity`: Извлечение и установка единства.
*   `upc`: Извлечение и установка UPC.
*   `uploadable_files`: Извлечение и установка загружаемых файлов.
*   `default_image_url`: Извлечение и установка URL-адреса изображения по умолчанию.
*   `visibility`: Извлечение и установка видимости.
*   `weight`: Извлечение и установка веса.
*   `wholesale_price`: Извлечение и установка оптовой цены.
*   `width`: Извлечение и установка ширины.
*   `specification`: Извлечение и установка спецификации.
*   `link`: Извлечение и установка ссылки.
*   `byer_protection`: Извлечение и установка защиты покупателя.
*   `customer_reviews`: Извлечение и установка отзывов клиентов.
*   `link_to_video`: Извлечение и установка ссылки на видео.
*   `local_image_path`: Извлечение и сохранение изображения локально.
*   `local_video_path`: Извлечение и сохранение видео локально.

## Функции

### `close_pop_up`

```python
def close_pop_up() -> Callable:
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.
    Функция `driver.execute_locator()` будет вызвана только если был указан `Context.locator_for_decorator` при инициализации экземляра класса.

    Args:
        value ('Driver'): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```

**Описание**: Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции. Функция `driver.execute_locator()` будет вызвана только если был указан `Context.locator_for_decorator` при инициализации экземпляра класса.

**Параметры**:

*   `value` (`'Driver'`): Дополнительное значение для декоратора.

**Возвращает**:

*   `Callable`: Декоратор, оборачивающий функцию.

**Как работает функция**:
Декоратор `@close_pop_up` предназначен для автоматического закрытия всплывающих окон перед выполнением основной логики декорируемой функции. Это достигается путем выполнения локатора, хранящегося в `Context.locator_for_decorator`, с использованием `Context.driver.execute_locator()`.

1.  **Определение декоратора `decorator(func: Callable) -> Callable`**:
    *   Принимает функцию `func`, которую необходимо обернуть.
    *   Возвращает обернутую функцию `wrapper`.
2.  **Определение обертки `wrapper(*args, **kwargs)`**:
    *   Функция `wrapper` выполняется при каждом вызове декорируемой функции `func`.
    *   Проверяет, установлен ли `Context.locator_for_decorator`. Если он установлен, это означает, что нужно закрыть всплывающее окно.
3.  **Закрытие всплывающего окна**:
    *   Вызывает `await Context.driver.execute_locator(Context.locator_for_decorator)` для выполнения локатора, который закроет всплывающее окно.
    *   Использует блок `try...except` для обработки возможных исключений, возникающих при выполнении локатора.
    *   В случае возникновения исключения `ExecuteLocatorException`, логирует ошибку с использованием `logger.debug`.
4.  **Сброс `Context.locator_for_decorator`**:
    *   После первого срабатывания декоратор сбрасывает `Context.locator_for_decorator = None`, чтобы предотвратить повторное выполнение локатора при последующих вызовах декорируемой функции.
5.  **Вызов основной функции**:
    *   Вызывает основную функцию `func` с использованием `await func(*args, **kwargs)` и возвращает результат её выполнения.

##

```python
   def __init__(self, supplier_prefix: str, lang_index:int, driver: 'Driver'):
        """Инициализация класса Graber.

        Args:
            supplier_prefix (str): Префикс поставщика.
            driver ('Driver'): Экземпляр класса Driver.
        """
```

**Описание**: Инициализация класса `Graber`.

**Параметры**:

*   `supplier_prefix` (str): Префикс поставщика.
*   `lang_index` (int): Индекс языка.
*   `driver` (`'Driver'`): Экземпляр класса Driver.

**Как работает функция**:

1.  **Сохранение параметров**:
    *   Сохраняет переданные параметры `supplier_prefix`, `lang_index` и `driver` в соответствующие атрибуты экземпляра класса (`self.supplier_prefix`, `self.driver` и др.).
2.  **Загрузка локаторов**:
    *   Формирует путь к файлу `product.json`, содержащему локаторы для текущего поставщика, и загружает их с помощью функции `j_loads_ns`.
    *   Сохраненяет локаторы в атрибут `self.locator` как `SimpleNamespace`.
3.  **Инициализация `ProductFields`**:
    *   Создает экземпляр класса `ProductFields` с указанием индекса языка `lang_index`.
    *   Сохраняет экземпляр в атрибут `self.fields`.
4.  **Установка контекста**:
    *   Устанавливает атрибут `driver` класса `Context` равным текущему драйверу (`self.driver`).
    *   Устанавливает атрибут `supplier_prefix` класса `Context` равным `None`.
    *   Устанавливает атрибут `locator_for_decorator` класса `Context` равным `None`.

```python
    async def error(self, field: str):
        """Обработчик ошибок для полей."""
```

**Описание**: Обработчик ошибок для полей.

**Параметры**:

*   `field` (str): Название поля, для которого произошла ошибка.

**Как работает функция**:

1.  **Логирование ошибки**:
    *   Вызывает функцию `logger.debug` для записи сообщения об ошибке в лог. Сообщение содержит информацию о том, для какого поля произошла ошибка (`f"Ошибка заполнения поля {field}"`).
    *   Уровень логирования установлен на `debug`, что позволяет отслеживать ошибки в процессе разработки и отладки.

```python
    async def set_field_value(
        self,
        value: Any,
        locator_func: Callable[[], Any],
        field_name: str,
        default: Any = ''
    ) -> Any:
        """Универсальная функция для установки значений полей с обработкой ошибок.

        Args:
            value (Any): Значение для установки.
            locator_func (Callable[[], Any]): Функция для получения значения из локатора.
            field_name (str): Название поля.
            default (Any): Значение по умолчанию. По умолчанию пустая строка.

        Returns:
            Any: Установленное значение.
        """
```

**Описание**: Универсальная функция для установки значений полей с обработкой ошибок.

**Параметры**:

*   `value` (Any): Значение для установки.
*   `locator_func` (Callable[[], Any]): Функция для получения значения из локатора.
*   `field_name` (str): Название поля.
*   `default` (Any): Значение по умолчанию. По умолчанию пустая строка.

**Возвращает**:

*   `Any`: Установленное значение.

**Как работает функция**:

1.  **Получение значения из локатора**:
    *   Вызывает функцию `locator_func` в отдельном потоке с помощью `asyncio.to_thread(locator_func)`.
    *   Это позволяет избежать блокировки основного потока при выполнении операций, связанных с веб-драйвером.
    *   Результат выполнения `locator_func` сохраняется в переменной `locator_result`.
2.  **Установка значения поля**:
    *   Проверяет, передано ли значение `value`. Если да, возвращает `value` (приоритет отдается переданному значению).
    *   Если `value` не передано, проверяет, получено ли значение из локатора (`locator_result`). Если да, возвращает `locator_result`.
    *   Если ни `value`, ни `locator_result` не содержат значения, вызывает функцию `self.error(field_name)` для логирования ошибки.
    *   Возвращает значение по умолчанию `default`.

```python
    def grab_page(self, *args, **kwards) -> ProductFields:
        return asyncio.run(self.grab_page_async(*args, **kwards))
```

**Описание**: Синхронная функция для сбора полей продукта.

**Параметры**:

*   `*args`: Позиционные аргументы, названия полей для сбора.
*   `**kwards`: Именованные аргументы, значения полей для сбора.

**Возвращает**:

*   `ProductFields`: Объект `ProductFields` с собранными данными.

**Как работает функция**:

1.  **Запуск асинхронной функции**:
    *   Вызывает асинхронную функцию `self.grab_page_async(*args, **kwards)` с теми же аргументами.
    *   Использует `asyncio.run()` для запуска асинхронной функции в синхронном контексте.
2.  **Возврат результата**:
    *   Возвращает результат, полученный от асинхронной функции `self.grab_page_async()`.

```python
    async def grab_page_async(self, *args, **kwards) -> ProductFields:
        """Асинхронная функция для сбора полей продукта."""
```

**Описание**: Асинхронная функция для сбора полей продукта.

**Параметры**:

*   `*args`: Позиционные аргументы, названия полей для сбора.
*   `**kwards`: Именованные аргументы, значения полей для сбора.

**Возвращает**:

*   `ProductFields`: Объект `ProductFields` с собранными данными.

**Как работает функция**:

1.  **Определение внутренней асинхронной функции `fetch_all_data`**:
    *   Эта функция динамически вызывает функции для каждого поля, указанного в `args`.
2.  **Динамический вызов функций для каждого поля**:
    *   Для каждого `filed_name` в `args`:
        *   Получает функцию, соответствующую имени поля, с помощью `getattr(self, filed_name, None)`.
        *   Если функция существует:
            *   Вызывает функцию с использованием `await function(kwards.get(filed_name, ''))`.
            *   Передает значение из `kwards`, если оно есть, иначе передает пустую строку.
3.  **Вызов `fetch_all_data`**:
    *   Вызывает функцию `fetch_all_data` с использованием `await fetch_all_data(*args, **kwards)`.
4.  **Возврат результата**:
    *   Возвращает объект `self.fields`, содержащий собранные данные.

```python
    @close_pop_up()
    async def additional_shipping_cost(self, value:Optional[Any] = None):
        """Fetch and set additional shipping cost.
        Args:
        value (Any): это значение можно передать в словаре kwards чеез ключ {additional_shipping_cost = `value`} при определении класса
        если `value` был передан - его значение подставляется в поле `ProductFields.additional_shipping_cost
        """
```

**Описание**: Извлечение и установка дополнительной стоимости доставки.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `additional_shipping_cost`. Если `value` передано, его значение будет установлено в поле `ProductFields.additional_shipping_cost`.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `additional_shipping_cost` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.additional_shipping_cost)`.
        *   Если ни один из способов не дал результата, использует пустую строку `''`.
    *   Использует функцию `normalize_string()` для нормализации полученного значения.
2.  **Установка значения поля**:
    *   Устанавливает нормализованное значение в поле `self.fields.additional_shipping_cost`.
3.  **Обработка ошибок**:
    *   Если поле `additional_shipping_cost` не получило значения, записывает сообщение об ошибке в лог с использованием `logger.error`.
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def delivery_in_stock(self, value:Optional[Any] = None):
        """Fetch and set delivery in stock status.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {delivery_in_stock = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.delivery_in_stock`.
        """
```

**Описание**: Извлечение и установка статуса доставки в наличии.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `delivery_in_stock`. Если `value` передано, его значение будет установлено в поле `ProductFields.delivery_in_stock`.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `delivery_in_stock` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.delivery_in_stock)`.
        *   Если ни один из способов не дал результата, использует пустую строку `''`.
    *   Использует функцию `normalize_string()` для нормализации полученного значения.
2.  **Установка значения поля**:
    *   Устанавливает нормализованное значение в поле `self.fields.delivery_in_stock`.
3.  **Обработка ошибок**:
    *   Если поле `delivery_in_stock` не получило значения, записывает сообщение об ошибке в лог с использованием `logger.error`.
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def active(self, value:Optional[Any] = None):
        """Fetch and set active status.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {active = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.active`.
        Принимаемое значениеЬ 1/0
        """
```

**Описание**: Извлечение и установка статуса активности.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `active`. Если `value` передано, его значение будет установлено в поле `ProductFields.active`. Принимаемое значение: 1/0.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `active` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.active)`.
        *   Если ни один из способов не дал результата, использует значение `1`.
    *   Использует функцию `normalize_int()` для нормализации полученного значения.
2.  **Установка значения поля**:
    *   Устанавливает нормализованное значение в поле `self.fields.active`.
3.  **Проверка валидности**:
    *   Если `value` не передано и полученное значение невалидно, записывает сообщение об ошибке в лог с использованием `logger.debug`.
4.  **Обработка ошибок**:
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def additional_delivery_times(self, value:Optional[Any] = None):
        """Fetch and set additional delivery times.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {additional_delivery_times = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.additional_delivery_times`.
        """
```

**Описание**: Извлечение и установка дополнительного времени доставки.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `additional_delivery_times`. Если `value` передано, его значение будет установлено в поле `ProductFields.additional_delivery_times`.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `additional_delivery_times` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.additional_delivery_times)`.
        *   Если ни один из способов не дал результата, использует пустую строку `''`.
2.  **Установка значения поля**:
    *   Устанавливает полученное значение в поле `self.fields.additional_delivery_times`.
3.  **Проверка валидности**:
    *   Если `value` не передано и полученное значение невалидно, записывает сообщение об ошибке в лог с использованием `logger.debug`.
4.  **Обработка ошибок**:
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def advanced_stock_management(self, value:Optional[Any] = None):
        """Fetch and set advanced stock management status.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {advanced_stock_management = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.advanced_stock_management`.
        """
```

**Описание**: Извлечение и установка статуса расширенного управления запасами.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `advanced_stock_management`. Если `value` передано, его значение будет установлено в поле `ProductFields.advanced_stock_management`.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `advanced_stock_management` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.advanced_stock_management)`.
        *   Если ни один из способов не дал результата, использует пустую строку `''`.
2.  **Установка значения поля**:
    *   Устанавливает полученное значение в поле `self.fields.advanced_stock_management`.
3.  **Проверка валидности**:
    *   Если `value` не передано и полученное значение невалидно, записывает сообщение об ошибке в лог с использованием `logger.debug`.
4.  **Обработка ошибок**:
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def affiliate_short_link(self, value:Optional[Any] = None):
        """Fetch and set affiliate short link.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {affiliate_short_link = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.affiliate_short_link`.
        """
```

**Описание**: Извлечение и установка короткой партнерской ссылки.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `affiliate_short_link`. Если `value` передано, его значение будет установлено в поле `ProductFields.affiliate_short_link`.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `affiliate_short_link` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.affiliate_short_link)`.
        *   Если ни один из способов не дал результата, использует пустую строку `''`.
2.  **Установка значения поля**:
    *   Устанавливает полученное значение в поле `self.fields.affiliate_short_link`.
3.  **Обработка ошибок**:
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def affiliate_summary(self, value:Optional[Any] = None):
        """Fetch and set affiliate summary.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {affiliate_summary = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.affiliate_summary`.
        """
```

**Описание**: Извлечение и установка партнерского резюме.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `affiliate_summary`. Если `value` передано, его значение будет установлено в поле `ProductFields.affiliate_summary`.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `affiliate_summary` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.affiliate_summary)`.
        *   Если ни один из способов не дал результата, использует пустую строку `''`.
    *   Использует функцию `normalize_string()` для нормализации полученного значения.
2.  **Установка значения поля**:
    *   Устанавливает нормализованное значение в поле `self.fields.affiliate_summary`.
3.  **Обработка ошибок**:
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def affiliate_summary_2(self, value:Optional[Any] = None):
        """Fetch and set affiliate summary 2.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {affiliate_summary_2 = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.affiliate_summary_2`.
        """
```

**Описание**: Извлечение и установка партнерского резюме 2.

**Параметры**:

*   `value` (Optional[Any], optional): Значение, которое можно передать в словаре `kwargs` через ключ `affiliate_summary_2`. Если `value` передано, его значение будет установлено в поле `ProductFields.affiliate_summary_2`.

**Как работает функция**:

1.  **Получение значения**:
    *   Пытается получить значение для `affiliate_summary_2` одним из следующих способов:
        *   Если `value` передано, использует его.
        *   Иначе пытается получить значение с помощью `self.driver.execute_locator(self.locator.affiliate_summary_2)`.
        *   Если ни один из способов не дал результата, использует пустую строку `''`.
2.  **Установка значения поля**:
    *   Устанавливает полученное значение в поле `self.fields.affiliate_summary_2`.
3.  **Проверка валидности**:
    *   Если `value` не передано и полученное значение невалидно, записывает сообщение об ошибке в лог с использованием `logger.debug`.
4.  **Обработка ошибок**:
    *   В случае возникновения исключения при получении значения, записывает сообщение об ошибке в лог с указанием исключения.

```python
    @close_pop_up()
    async def affiliate_text(self, value:Optional[Any] = None):
        """Fetch and set affiliate text.
        
        Args:
        value (Any): это значение можно передать в словаре kwargs через ключ {affiliate_text = `value`} при определении класса.
        Если `value` был передан, его значение подставляется в поле `ProductFields.affiliate_text`.
        """
```

**Описание**: Извлечение и установка партнерского текста.
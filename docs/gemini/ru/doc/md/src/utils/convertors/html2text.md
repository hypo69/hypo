# Модуль `hypotez/src/utils/convertors/html2text.py`

## Обзор

Модуль `html2text` предназначен для преобразования HTML-документов в эквивалентный Markdown-текст. Он предоставляет функции для обработки HTML-тегов, ссылок, изображений, списков и других элементов, обеспечивая структурированный и читабельный вывод.

## Функции

### `has_key`

**Описание**: Проверяет, содержит ли объект `x` ключ `y`.  Поддерживает как словари (с методом `has_key`), так и объекты, где `y` является ключом.

**Параметры**:

- `x`: Проверяемый объект.
- `y`: Ключ, который нужно проверить.

**Возвращает**:

- `bool`: `True`, если ключ `y` существует в `x`, иначе `False`.


### `name2cp`

**Описание**: Преобразует имя сущности в её код символа.

**Параметры**:

- `k`: Имя сущности (строка).

**Возвращает**:

- `int`: Код символа, соответствующий имени сущности.  Возвращает ошибку `KeyError`, если имя сущности не найдено.


### `charref`

**Описание**: Преобразует числовое представление символа в сам символ.

**Параметры**:

- `name`: Числовое представление символа (строка).

**Возвращает**:

- `str`: Символ, соответствующий числовому представлению.



### `entityref`

**Описание**: Преобразует имя сущности в её эквивалент.

**Параметры**:

- `c`: Имя сущности (строка).

**Возвращает**:

- `str`: Эквивалент имени сущности, возвращает "&"+c+";", если имя не найдено.


### `replaceEntities`

**Описание**: Заменяет сущности в строке.

**Параметры**:

- `s`: Строка, содержащая сущности.

**Возвращает**:

- `str`: Строка с замененными сущностями.


### `unescape`

**Описание**: Разбирает и заменяет HTML-сущности в строке.

**Параметры**:

- `s`: Строка, содержащая HTML-сущности.

**Возвращает**:

- `str`: Строка с заменёнными HTML-сущностями.


### `onlywhite`

**Описание**: Проверяет, состоит ли строка только из пробельных символов.

**Параметры**:

- `line`: Строка для проверки.

**Возвращает**:

- `bool`: `True`, если строка состоит только из пробельных символов, иначе `False`.


### `optwrap`

**Описание**: Обёртка для форматирования текста, включая перенос длинных строк.

**Параметры**:

- `text`: Входной текст.

**Возвращает**:

- `str`: отформатированный текст.


### `hn`

**Описание**: Определяет уровень заголовка (h1-h9).

**Параметры**:

- `tag`: Тег (строка).

**Возвращает**:

- `int`: Уровень заголовка (1-9), или 0, если не заголовок.


### `dumb_property_dict`

**Описание**: Преобразует строку CSS-стилей в словарь.

**Параметры**:

- `style`: Строка CSS-стилей.

**Возвращает**:

- `dict`: Словарь, содержащий атрибуты CSS.


### `dumb_css_parser`

**Описание**: Парсит CSS-стили.

**Параметры**:

- `data`: Строка CSS-стилей.

**Возвращает**:

- `dict`: Словарь CSS-селекторов с атрибутами.



### `element_style`

**Описание**: Объединяет родительские и текущие стили.

**Параметры**:

- `attrs`: Атрибуты элемента.
- `style_def`: Словарь стилей.
- `parent_style`: Родительский стиль.

**Возвращает**:

- `dict`: Словарь объединённых стилей.



### `google_list_style`

**Описание**: Определяет тип списка Google Docs (ol или ul).

**Параметры**:

- `style`: Стиль элемента.

**Возвращает**:

- `str`: Тип списка (`ul` или `ol`).


### `google_nest_count`

**Описание**: Определяет уровень вложенности списка.

**Параметры**:

- `style`: Стиль элемента.

**Возвращает**:

- `int`: Уровень вложенности.


### `google_has_height`

**Описание**: Проверяет наличие атрибута `height` в стиле.

**Параметры**:

- `style`: Стиль элемента.

**Возвращает**:

- `bool`: `True`, если атрибут `height` присутствует, иначе `False`.


### `google_text_emphasis`

**Описание**: Возвращает список подчеркиваний текста в стиле.

**Параметры**:

- `style`: Стиль элемента.

**Возвращает**:

- `list`: Список подчеркиваний.


### `google_fixed_width_font`

**Описание**: Проверяет, является ли шрифт фиксированной ширины.

**Параметры**:

- `style`: Стиль элемента.

**Возвращает**:

- `bool`: `True`, если шрифт фиксированной ширины, иначе `False`.


### `list_numbering_start`

**Описание**: Возвращает начальное значение нумерации списка.

**Параметры**:

- `attrs`: Атрибуты элемента.

**Возвращает**:

- `int`: Начальное значение нумерации или 0.


### `_html2text`

**Описание**: Класс для обработки HTML-разметки и преобразования в Markdown.

**Методы**:

- `__init__`: Инициализация класса.
- `feed`: Обработка данных.
- `close`: Закрытие и возвращение результата.
- `handle_charref`: Обработка числовых сущностей.
- `handle_entityref`: Обработка имен сущностей.
- `handle_starttag`: Обработка начала тега.
- `handle_endtag`: Обработка конца тега.
- `previousIndex`: Возвращает индекс атрибута в списке.
- `drop_last`: Удаляет последние символы из выходного текста.
- `handle_emphasis`: Обрабатывает выделения текста.
- `handle_tag`: Обрабатывает различные теги.
- `pbr`: Добавляет мягкий перевод строки.
- `p`: Добавляет жесткий перевод строки.
- `soft_br`: Добавляет мягкий перевод строки.
- `o`: Добавляет данные в выходной текст.
- `handle_data`: Обрабатывает данные между тегами.
- `unknown_decl`: Обрабатывает неизвестные объявления.


### `wrapwrite`

**Описание**: Функция для записи форматированного текста в стандартный вывод.

**Параметры**:

- `text`: Текст для записи.


### `html2text_file`

**Описание**: Обрабатывает HTML-файл и возвращает Markdown-представление.

**Параметры**:

- `html`: HTML-текст.
- `out`: Функция для записи вывода (по умолчанию - `wrapwrite`).
- `baseurl`: Базовый URL для обработки ссылок.

**Возвращает**:

- `str`: Markdown-представление.


### `html2text`

**Описание**: Преобразует HTML-строку в Markdown-строку.

**Параметры**:

- `html`: HTML-строка.
- `baseurl`: Базовый URL.

**Возвращает**:

- `str`: Markdown-строка.


### `Storage`

**Описание**: Вспомогательный класс для хранения параметров.


### `options`

**Описание**: Объект для хранения параметров преобразования.


## Дополнительные сведения

Модуль `html2text` включает в себя сложную логику для обработки различных HTML-тегов, атрибутов и стилей, обеспечивая гибкое и эффективное преобразование.  Обратите внимание на значительные объемы кода в методах `_html2text`, где реализована основная функциональность преобразования.
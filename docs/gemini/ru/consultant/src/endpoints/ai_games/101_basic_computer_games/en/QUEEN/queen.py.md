# Анализ кода модуля queen.py

**Качество кода**
9
- Плюсы
        - Код хорошо структурирован и разбит на логические функции.
        - Присутствует подробное описание алгоритма и блок-схема игры.
        - Логика игры корректно реализована, включая проверку допустимости ходов и условия победы.
        - Код хорошо прокомментирован, что облегчает понимание его работы.
 - Минусы
    - Отсутствует обработка ошибок ввода от пользователя, что может привести к сбою при некорректном вводе.
    - Нет обработки исключений при преобразовании ввода пользователя, что может привести к падению программы.
    - Код не использует логирование для отслеживания ошибок.
    - Используются глобальные переменные для хранения координат игроков, что не является лучшей практикой.
    - Отсутствует документация в формате RST.
    -  Не все комментарии соответствуют стандарту написания.

**Рекомендации по улучшению**

1.  **Документация**:
    - Добавить docstring в формате reStructuredText (RST) для модуля, функций и переменных.
2.  **Обработка ошибок**:
    - Использовать `try-except` блоки для обработки ошибок ввода пользователя и преобразования типов.
    - Использовать `logger.error` для логирования ошибок вместо `print`.
3.  **Логирование**:
    - Добавить логирование для отслеживания важных событий, таких как начало игры, ходы игроков и победа.
4.  **Глобальные переменные**:
    - Преобразовать глобальные переменные `player1_x`, `player1_y`, `player2_x`, `player2_y` в локальные переменные класса или функции.
5.  **Улучшение кода**:
    - Провести рефакторинг кода для улучшения читаемости и поддержки.
6.  **Стандартизация**:
     -  Привести все комментарии к единому стандарту.

**Оптимизиробанный код**

```python
"""
Модуль, реализующий игру "Ферзь" на шахматной доске.
=====================================================

Игроки по очереди перемещают ферзей по доске, стремясь достичь противоположного края.

:Модуль: queen.py
:Версия: 1.0
:Дата: 2023-11-20
"""
import sys
from src.logger.logger import logger  # Импортируем logger для логирования

def print_board(player1_x: int, player1_y: int, player2_x: int, player2_y: int) -> None:
    """
    Выводит на экран шахматную доску с текущим положением ферзей.

    :param player1_x: Координата X ферзя первого игрока.
    :param player1_y: Координата Y ферзя первого игрока.
    :param player2_x: Координата X ферзя второго игрока.
    :param player2_y: Координата Y ферзя второго игрока.
    :return: None
    """
    print("   0  1  2  3  4  5  6  7")
    for row in range(8):
        row_str = str(row) + " "
        for col in range(8):
            if row == player1_y and col == player1_x:
                row_str += " 1 "
            elif row == player2_y and col == player2_x:
                row_str += " 2 "
            else:
                row_str += " . "
        print(row_str)

def is_valid_move(current_x: int, current_y: int, next_x: int, next_y: int) -> bool:
    """
    Проверяет, является ли ход ферзя допустимым.

    Ход допустим, если ферзь двигается по горизонтали, вертикали или диагонали в пределах доски.

    :param current_x: Текущая координата X ферзя.
    :param current_y: Текущая координата Y ферзя.
    :param next_x: Следующая координата X ферзя.
    :param next_y: Следующая координата Y ферзя.
    :return: True, если ход допустим, иначе False.
    """
    if next_x < 0 or next_x > 7 or next_y < 0 or next_y > 7:
        return False # Код проверяет, не выходит ли новая позиция за границы доски
    
    if current_x == next_x: # Код проверяет вертикальное перемещение
        return True
    elif current_y == next_y: # Код проверяет горизонтальное перемещение
        return True
    elif abs(current_x - next_x) == abs(current_y - next_y):  # Код проверяет диагональное перемещение
         return True
    else:
        return False

def get_player_move(player_number: int, current_x: int, current_y: int) -> tuple[int, int]:
    """
    Запрашивает у игрока ввод координат для перемещения ферзя.

    Проверяет допустимость введенных координат и возвращает их.

    :param player_number: Номер игрока (1 или 2).
    :param current_x: Текущая координата X ферзя.
    :param current_y: Текущая координата Y ферзя.
    :return: Кортеж (next_x, next_y) с новыми координатами ферзя.
    """
    while True:
        try:
            move_str = input(f"Игрок {player_number}, введите ход (x, y): ")
            next_x, next_y = map(int, move_str.split(','))
            if is_valid_move(current_x, current_y, next_x, next_y):
                return next_x, next_y
            else:
                print("Недопустимый ход. Попробуйте еще раз.")
        except ValueError as e:
            logger.error(f"Неверный формат ввода: {e}") # Код логирует ошибку неправильного ввода
            print("Неверный формат ввода. Введите два числа через запятую, например: 1,2")
        except Exception as e:
            logger.error(f"Произошла ошибка: {e}") # Код логирует общую ошибку

def play_queen_game() -> None:
    """
    Запускает основной игровой цикл игры "Ферзь".

    Инициализирует начальные позиции ферзей, запрашивает ходы игроков и
    отображает доску. Определяет победителя.

    :return: None
    """
    # Инициализация начальных позиций ферзей
    player1_x = 0
    player1_y = 3
    player2_x = 7
    player2_y = 3
    logger.info("Игра началась") # Код логирует начало игры
    
    while True:
        print_board(player1_x, player1_y, player2_x, player2_y) # Код выводит доску
        # Ход игрока 1
        print("Ход игрока 1:")
        next_player1_x, next_player1_y = get_player_move(1, player1_x, player1_y)
        player1_x, player1_y = next_player1_x, next_player1_y
        logger.info(f"Игрок 1 сделал ход: ({player1_x}, {player1_y})") # Код логирует ход первого игрока

        if player1_x == 7: # Код проверяет победу первого игрока
            print("Игрок 1 победил!")
            logger.info("Игрок 1 победил") # Код логирует победу первого игрока
            break # Код завершает игру
        # Ход игрока 2
        print_board(player1_x, player1_y, player2_x, player2_y)
        print("Ход игрока 2:")
        next_player2_x, next_player2_y = get_player_move(2, player2_x, player2_y)
        player2_x, player2_y = next_player2_x, next_player2_y
        logger.info(f"Игрок 2 сделал ход: ({player2_x}, {player2_y})") # Код логирует ход второго игрока

        if player2_x == 0: # Код проверяет победу второго игрока
            print("Игрок 2 победил!")
            logger.info("Игрок 2 победил") # Код логирует победу второго игрока
            break # Код завершает игру
    logger.info("Игра завершилась") # Код логирует завершение игры

if __name__ == "__main__":
    play_queen_game() # Код вызывает функцию для запуска игры
"""
Объяснение кода:

1. **Импорты**:
   - `sys`: Используется для системных операций (не используется в текущей версии, но может быть полезен в дальнейшем).
   - `logger`: Используется для логирования событий и ошибок.

2. **Функция `print_board`**:
   - Принимает текущие координаты ферзей обоих игроков.
   - Выводит на экран шахматную доску, используя `.` для пустых клеток, `1` для ферзя игрока 1 и `2` для ферзя игрока 2.

3. **Функция `is_valid_move`**:
   - Принимает текущие и следующие координаты для хода ферзя.
   - Проверяет, является ли ход допустимым:
     - Ферзь может двигаться по горизонтали, вертикали или диагонали.
     - Ферзь не может выйти за границы доски.

4. **Функция `get_player_move`**:
   - Запрашивает у игрока ввод координат следующего хода.
   - Использует цикл `while True`, чтобы гарантировать ввод правильных данных.
   - Проверяет формат ввода: ввод должен быть в формате `x,y` (два целых числа через запятую).
   - Вызывает функцию `is_valid_move` для проверки допустимости хода.
   - Возвращает новые координаты хода, когда они допустимы.
   - Логирует ошибки ввода.

5. **Функция `play_queen_game`**:
    -   Инициализирует начальные позиции ферзей обоих игроков.
    -   Запускает основной игровой цикл (`while True`):
        -   Выводит шахматную доску на экран.
        -   Запрашивает ход у игрока 1, используя функцию `get_player_move`, и обновляет позицию ферзя игрока 1.
        -   Проверяет, не достиг ли ферзь игрока 1 конца доски (x=7). Если достиг, выводит сообщение о победе и завершает игру.
        -   Выводит доску еще раз.
        -   Запрашивает ход у игрока 2, используя функцию `get_player_move`, и обновляет позицию ферзя игрока 2.
        -   Проверяет, не достиг ли ферзь игрока 2 конца доски (x=0). Если достиг, выводит сообщение о победе и завершает игру.
        -   Логирует ходы игроков и результаты игры.
        -  Цикл продолжается до тех пор, пока один из игроков не выиграет.
6.  **Точка входа**
    - Проверяет, является ли скрипт основным, если да, то запускает игру `play_queen_game()`.
"""
```
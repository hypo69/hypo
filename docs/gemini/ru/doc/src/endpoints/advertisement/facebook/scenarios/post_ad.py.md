# Модуль `post_ad.py`

## Обзор

Модуль `post_ad.py` предназначен для автоматической публикации рекламных сообщений в группах Facebook. Он использует Selenium WebDriver для взаимодействия с веб-интерфейсом Facebook и выполняет шаги по отправке заголовка сообщения, загрузке медиафайлов (изображений) и публикации всего сообщения.

## Подробней

Этот модуль является частью системы автоматизации рекламы в проекте `hypotez`. Он предоставляет функциональность для публикации рекламных объявлений в Facebook, используя информацию, переданную в виде объекта `SimpleNamespace`. Модуль обрабатывает возможные сбои и повторяет попытки отправки сообщения до определенного предела.

## Функции

### `post_ad`

```python
def post_ad(d: Driver, message: SimpleNamespace) -> bool:
    """
    Отправляет рекламное сообщение.

    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.
        message (SimpleNamespace): Объект, содержащий данные для публикации сообщения, включая заголовок, описание и путь к изображению.

    Returns:
        bool: `True`, если сообщение успешно опубликовано, иначе `False`.
    """
```

**Как работает функция:**

Функция `post_ad` является основной функцией модуля, которая управляет процессом публикации рекламного сообщения в Facebook. Она выполняет следующие шаги:

1.  **Отправка заголовка сообщения:**
    *   Вызывает функцию `post_message_title` для отправки заголовка сообщения.
    *   В случае неудачи увеличивает счетчик `fails` и повторяет попытку, если количество неудач меньше 15.
    *   При превышении лимита неудачных попыток функция завершается.
2.  **Загрузка медиафайлов:**
    *   Проверяет, содержит ли объект `message` атрибут `image_path` и не является ли он пустым.
    *   Если путь к изображению указан, вызывает функцию `upload_post_media` для загрузки изображения.
3.  **Публикация сообщения:**
    *   Вызывает функцию `message_publish` для публикации сообщения.
4.  **Обработка ошибок:**
    *   В случае возникновения ошибок логирует их с использованием `logger.error`.
    *   Сбрасывает счетчик `fails` в случае успешной публикации.

**Параметры:**

*   `d` (Driver): Экземпляр драйвера Selenium WebDriver, используемый для взаимодействия с веб-страницей Facebook.
*   `message` (SimpleNamespace): Объект, содержащий данные для публикации сообщения, включая:
    *   `description` (str): Описание сообщения.
    *   `image_path` (Optional[str]): Путь к изображению для публикации (опционально).

**Возвращает:**

*   `bool`: `True`, если сообщение успешно опубликовано, иначе `False`.

**Примеры:**

```python
from selenium import webdriver
from src.webdriver.driver import Driver
from types import SimpleNamespace
from pathlib import Path

# Инициализация драйвера (пример)
driver_instance = Driver(browser_name="chrome", options=webdriver.ChromeOptions())

# Создание объекта сообщения
message_data = SimpleNamespace(
    description="Текст рекламного сообщения",
    image_path=Path("/path/to/image.jpg")  # Замените на реальный путь к изображению
)

# Вызов функции post_ad
result = post_ad(driver_instance, message_data)

if result:
    print("Рекламное сообщение успешно опубликовано!")
else:
    print("Не удалось опубликовать рекламное сообщение.")
```

### Внутренние функции

Внутри функции `post_ad` вызываются другие функции, такие как `post_message_title`, `upload_post_media` и `message_publish`. Документация для этих функций должна быть расположена в соответствующих файлах, где они определены.

```python
def post_message_title(d: Driver, message: str) -> bool:
    """
    Отправляет заголовок сообщения.

    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.
        message (str): Текст заголовка сообщения.

    Returns:
        bool: `True`, если заголовок успешно отправлен, иначе `False`.
    """
    ...

def upload_post_media(d: Driver, media: str, without_captions: bool = True) -> bool:
    """
    Загружает медиафайл (изображение) для публикации.

    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.
        media (str): Путь к медиафайлу.
        without_captions (bool): Флаг, указывающий, нужно ли добавлять подпись к изображению.

    Returns:
        bool: `True`, если медиафайл успешно загружен, иначе `False`.
    """
    ...

def message_publish(d: Driver) -> bool:
    """
    Публикует сообщение.

    Args:
        d (Driver): Экземпляр драйвера, используемый для взаимодействия с веб-страницей.

    Returns:
        bool: `True`, если сообщение успешно опубликовано, иначе `False`.
    """
    ...
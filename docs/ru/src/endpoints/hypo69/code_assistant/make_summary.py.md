# Модуль для создания файла `SUMMARY.md`

## Обзор

Модуль `make_summary.py` предназначен для автоматического создания файла `SUMMARY.md`, который используется для формирования структуры книги в формате `mdbook`. Он рекурсивно обходит указанную директорию, находит все файлы с расширением `.md`, и добавляет их в `SUMMARY.md` с учетом языка фильтрации. Подробнее о `mdbook`: [https://chatgpt.com/share/6742f054-aaa0-800d-9f84-0ab035a2a2c2](https://chatgpt.com/share/6742f054-aaa0-800d-9f84-0ab035a2a2c2)

## Подробней

Модуль предоставляет функции для создания файла `SUMMARY.md` на основе структуры каталогов с документацией. Он позволяет фильтровать файлы по языку (`ru` или `en`) и автоматически формирует ссылки на них в файле `SUMMARY.md`. Этот файл используется для создания структуры книги с помощью `mdbook`. Расположение файла `hypotez/src/endpoints/hypo69/code_assistant/make_summary.py` указывает на то, что он является частью системы автоматической генерации документации или помощи программисту в проекте `hypotez`.

## Функции

### `make_summary`

```python
def make_summary(docs_dir: Path, lang: str = 'en') -> None:
    """
    Создает файл SUMMARY.md, рекурсивно обходя папку.

    Args:
        docs_dir (Path): Путь к исходной директории 'src'.
        lang (str): Язык фильтрации файлов. Возможные значения: 'ru' или 'en'.
    """
    ...
```

**Назначение**: Создает файл `SUMMARY.md` в указанной директории, рекурсивно обходя её и фильтруя файлы по языку.

**Параметры**:

-   `docs_dir` (Path): Путь к исходной директории `'src'`.
-   `lang` (str, optional): Язык фильтрации файлов. Возможные значения: `'ru'` или `'en'`. По умолчанию `'en'`.

**Как работает функция**:

1.  Функция принимает путь к директории с документацией (`docs_dir`) и язык фильтрации (`lang`).
2.  Вызывает функцию `prepare_summary_path` для определения пути к файлу `SUMMARY.md`.
3.  Создает родительские директории для файла `SUMMARY.md`, если они не существуют.
4.  Вызывает функцию `_make_summary` для фактического создания и заполнения файла `SUMMARY.md`.

### `_make_summary`

```python
def _make_summary(src_dir: Path, summary_file: Path, lang: str = 'en') -> bool:
    """
    Рекурсивно обходит папку и создает файл SUMMARY.md с главами на основе .md файлов.

    Args:
        src_dir (Path): Путь к папке с исходниками .md.
        summary_file (Path): Путь для сохранения файла SUMMARY.md.
        lang (str): Язык фильтрации файлов. Возможные значения: 'ru' или 'en'.
    """
    ...
```

**Назначение**: Рекурсивно обходит указанную директорию, находит все файлы с расширением `.md`, фильтрует их по языку и добавляет в файл `SUMMARY.md`.

**Параметры**:

-   `src_dir` (Path): Путь к папке с исходниками `.md`.
-   `summary_file` (Path): Путь для сохранения файла `SUMMARY.md`.
-   `lang` (str, optional): Язык фильтрации файлов. Возможные значения: `'ru'` или `'en'`. По умолчанию `'en'`.

**Возвращает**:

-   `bool`: `True`, если файл успешно создан и заполнен, `False` в случае ошибки.

**Как работает функция**:

1.  Функция принимает путь к директории с исходниками (`src_dir`), путь к файлу `SUMMARY.md` (`summary_file`) и язык фильтрации (`lang`).
2.  Проверяет, существует ли файл `SUMMARY.md`, и если да, выводит сообщение о его перезаписи.
3.  Открывает файл `SUMMARY.md` для записи в кодировке `utf-8`.
4.  Записывает заголовок `# Summary\n\n` в файл.
5.  Рекурсивно обходит директорию `src_dir` в поисках файлов с расширением `.md`.
6.  Фильтрует файлы по языку, если указан язык `'ru'`, то пропускаются файлы без суффикса `.ru.md`, если `'en'` - с суффиксом `.ru.md`.
7.  Для каждого найденного и отфильтрованного файла формирует относительный путь и добавляет его в файл `SUMMARY.md` в формате `- [{path.stem}]({relative_path.as_posix()})\n`.
8.  Возвращает `True` в случае успешного создания файла и `False` в случае ошибки.
9.  В случае возникновения исключения выводит сообщение об ошибке и возвращает `False`.

### `prepare_summary_path`

```python
def prepare_summary_path(src_dir: Path, file_name: str = 'SUMMARY.md') -> Path:
    """
    Формирует путь к файлу, заменяя часть пути 'src' на 'docs' и добавляя имя файла.

    Args:
        src_dir (Path): Исходный путь с 'src'.
        file_name (str): Имя файла, который нужно создать. По умолчанию 'SUMMARY.md'.

    Returns:
        Path: Новый путь к файлу.
    """
    ...
```

**Назначение**: Формирует путь к файлу `SUMMARY.md`, заменяя часть пути `'src'` на `'docs'`.

**Параметры**:

-   `src_dir` (Path): Исходный путь с `'src'`.
-   `file_name` (str, optional): Имя файла, который нужно создать. По умолчанию `'SUMMARY.md'`.

**Возвращает**:

-   `Path`: Новый путь к файлу.

**Как работает функция**:

1.  Функция принимает путь к директории с исходниками (`src_dir`) и имя файла (`file_name`).
2.  Формирует новый путь, заменяя часть пути `'src'` на `'docs'`.
3.  Возвращает новый путь к файлу.

```python
    new_dir = PROJECT_ROOT / 'docs'
    summary_file = new_dir / file_name
    return summary_file
```

## Запуск из командной строки

В `if __name__ == '__main__':` реализован запуск модуля из командной строки.

1.  **Парсинг аргументов командной строки**:

    ```python
    parser = argparse.ArgumentParser(description="Создание файла SUMMARY.md с фильтрацией по языку.")
    parser.add_argument('-lang', type=str, choices=['ru', 'en'], default='en', help="Язык фильтрации файлов (ru или en). По умолчанию 'en'.")
    parser.add_argument('src_dir', type=str, help="Путь к исходной директории 'src'.")
    args = parser.parse_args()
    ```

    Здесь создается парсер аргументов командной строки с двумя аргументами:

    -   `-lang`: Язык фильтрации файлов (`ru` или `en`). По умолчанию `'en'`.
    -   `src_dir`: Путь к исходной директории `'src'`.
2.  **Преобразование пути в объект `Path`**:

    ```python
    src_dir = PROJECT_ROOT / args.src_dir
    ```

    Преобразует путь к исходной директории в объект `Path`.
3.  **Вызов функции `make_summary` с переданными аргументами**:

    ```python
    make_summary(src_dir, args.lang)
    ```

    Вызывает функцию `make_summary` с переданными аргументами для создания файла `SUMMARY.md`.

Пример использования:

```shell
python make_summary.py -lang ru src/my_project
```

Эта команда создаст файл `SUMMARY.md` в директории `docs/my_project`, включив только файлы с суффиксом `.ru.md`.
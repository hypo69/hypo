# Модуль: `scenario_pricelist.py`

## Обзор

Модуль `scenario_pricelist.py` предназначен для создания мехирона (прайс-листа) для Сергея Казаринова. Он включает в себя функциональность для извлечения, разбора и обработки данных о продуктах от различных поставщиков, обработки этих данных с помощью AI, а также для генерации отчетов в форматах HTML и PDF. Модуль также интегрирован с Telegram для отправки отчетов пользователю.

## Содержание

1. [Класс `MexironBuilder`](#класс-mexironbuilder)
    - [Метод `__init__`](#__init__)
    - [Метод `run_scenario`](#run_scenario)
    - [Метод `get_graber_by_supplier_url`](#get_graber_by_supplier_url)
    - [Метод `convert_product_fields`](#convert_product_fields)
    - [Метод `save_product_data`](#save_product_data)
    - [Метод `process_ai`](#process_ai)
    - [Метод `post_facebook`](#post_facebook)
    - [Метод `create_report`](#create_report)

## Классы

### `MexironBuilder`

**Описание**:
Класс `MexironBuilder` обрабатывает извлечение, разбор и сохранение данных о продуктах поставщиков.

**Атрибуты**:
- `driver` (`Driver`): Экземпляр Selenium WebDriver.
- `export_path` (`Path`): Путь для экспорта данных.
- `mexiron_name` (`str`): Имя мехирона.
- `price` (`float`): Цена мехирона.
- `timestamp` (`str`): Временная метка создания мехирона.
- `products_list` (`List`): Список обработанных данных о продуктах.
- `model` (`GoogleGenerativeAI`): Экземпляр модели Google Generative AI.
- `config` (`SimpleNamespace`): Конфигурация.
- `update` (`Update`): Объект обновления Telegram.
- `context` (`CallbackContext`): Контекст обратного вызова Telegram.

### `__init__`

**Описание**:
Инициализирует класс `MexironBuilder` необходимыми компонентами.

**Параметры**:
- `driver` (`Driver`): Экземпляр Selenium WebDriver.
- `mexiron_name` (`Optional[str]`, optional): Пользовательское имя для процесса создания мехирона. По умолчанию `None`.

### `run_scenario`

**Описание**:
Выполняет сценарий: разбирает продукты, обрабатывает их через AI и сохраняет данные.

**Параметры**:
- `update` (`Update`): Объект обновления Telegram.
- `context` (`CallbackContext`): Контекст обратного вызова Telegram.
- `urls` (`list[str]`): Список URL-адресов страниц продуктов.
- `price` (`Optional[str]`, optional): Цена для обработки. По умолчанию `''`.
- `mexiron_name` (`Optional[str]`, optional): Пользовательское имя мехирона. По умолчанию `''`.

**Возвращает**:
- `bool`: `True`, если сценарий выполнен успешно, иначе `False`.

**Замечания**:
-   Включает логику обработки ошибок и повторных попыток при обращении к модели.
-   Модель может возвращать неверный результат.

### `get_graber_by_supplier_url`

**Описание**:
Возвращает соответствующий грабер для заданного URL поставщика.

**Параметры**:
- `url` (`str`): URL-адрес страницы поставщика.

**Возвращает**:
- `Optional[object]`: Экземпляр грабера, если соответствие найдено, иначе `None`.

### `convert_product_fields`

**Описание**:
Конвертирует поля продукта в словарь.

**Параметры**:
- `f` (`ProductFields`): Объект, содержащий разобранные данные о продукте.

**Возвращает**:
- `dict`: Словарь с отформатированными данными о продукте.

**Замечания**:
- Правила построения полей определяются в `ProductFields`.

### `save_product_data`

**Описание**:
Сохраняет данные отдельного продукта в файл.

**Параметры**:
- `product_data` (`dict`): Словарь с отформатированными данными о продукте.

**Возвращает**:
- `bool`: `True` если сохранение прошло успешно, иначе `None`.

### `process_ai`

**Описание**:
Обрабатывает список продуктов с помощью AI модели.

**Параметры**:
- `products_list` (`List[str]`): Список словарей данных о продуктах.
- `lang` (`str`): Язык, на котором нужно обработать данные (`ru` или `he`).
- `attempts` (`int`, optional): Количество попыток повторной обработки в случае неудачи. По умолчанию `3`.

**Возвращает**:
- `tuple | bool`: Обработанный ответ в форматах `ru` и `he` или `False` в случае неудачи после всех попыток.

**Замечания**:
- Модель может возвращать неверный результат.

### `post_facebook`

**Описание**:
Выполняет сценарий рекламного модуля `facebook`.

**Параметры**:
- `mexiron` (`SimpleNamespace`): Объект, содержащий данные о мехироне для публикации.

**Возвращает**:
    - `bool`: `True` если публикация прошла успешно, иначе `None`.
    
### `create_report`

**Описание**:
Отправляет задание на создание мехирона в формате `html` и `pdf`.

**Параметры**:
- `data` (`dict`): Данные для отчета.
- `html_file` (`Path`): Путь к HTML-файлу отчета.
- `pdf_file` (`Path`): Путь к PDF-файлу отчета.

**Возвращает**:
    - `bool`: `True` если отчеты успешно созданы, иначе `None`.
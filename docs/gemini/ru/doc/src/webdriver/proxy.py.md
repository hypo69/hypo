# Модуль для работы с прокси

## Обзор

Модуль определяет функции для загрузки, парсинга и проверки списка прокси. Он загружает текстовый файл с прокси-адресами и распределяет их по категориям (HTTP, SOCKS4, SOCKS5). Также включает функцию для проверки работоспособности прокси-сервера.

## Подробнее

Этот модуль предназначен для автоматической загрузки и обработки списков прокси-серверов, что может быть полезно для задач, требующих обхода ограничений доступа или обеспечения анонимности. Он используется для получения списка прокси, их категоризации и проверки доступности, прежде чем использовать их в других частях проекта.

## Содержание

- [Классы](#классы)
- [Функции](#функции)
  - [`download_proxies_list`](#download_proxies_list)
  - [`get_proxies_dict`](#get_proxies_dict)
  - [`check_proxy`](#check_proxy)

## Классы

В данном модуле классы отсутствуют.

## Функции

### `download_proxies_list`

```python
def download_proxies_list(url: str = url, save_path: Path = proxies_list_path) -> bool:
    """
    Загружает файл по указанному URL и сохраняет его в заданный путь.

    Args:
        url (str): URL файла для загрузки. По умолчанию используется значение глобальной переменной `url`.
        save_path (Path): Путь для сохранения загруженного файла. По умолчанию используется значение глобальной переменной `proxies_list_path`.

    Returns:
        bool: `True`, если файл успешно загружен и сохранён, иначе `False`.

    Raises:
        Exception: В случае ошибки при загрузке файла.

    Example:
        >>> download_proxies_list(url='https://example.com/proxies.txt', save_path=Path('/tmp/proxies.txt'))
        True
    """
```

**Как работает функция**:
Функция `download_proxies_list` отправляет HTTP-запрос для загрузки файла по указанному URL, а затем сохраняет содержимое этого файла по указанному пути. Она использует метод `requests.get` с параметром `stream=True`, чтобы обрабатывать большие файлы. Функция проверяет статус ответа HTTP и генерирует исключение в случае ошибки. Данные записываются в файл чанками для эффективного использования памяти.

**Параметры**:
- `url` (str): URL-адрес файла, который необходимо загрузить. По умолчанию использует глобальную переменную `url`.
- `save_path` (Path): Путь к файлу, в который будет сохранено содержимое загруженного файла. По умолчанию использует глобальную переменную `proxies_list_path`.

**Возвращает**:
- `bool`: Возвращает `True`, если файл успешно загружен и сохранен, и `False` в случае ошибки.

**Вызывает исключения**:
- `requests.exceptions.RequestException`: Возникает при проблемах с HTTP-запросом.
- `OSError`: Возникает при проблемах с записью в файл.

### `get_proxies_dict`

```python
def get_proxies_dict(file_path: Path = proxies_list_path) -> Dict[str, List[Dict[str, Any]]]:
    """
    Парсит файл с прокси-адресами и распределяет их по категориям.

    Args:
        file_path (Path): Путь к файлу с прокси. По умолчанию используется значение глобальной переменной `proxies_list_path`.

    Returns:
        Dict[str, List[Dict[str, Any]]]: Словарь, где ключи - типы прокси ('http', 'socks4', 'socks5'),
            а значения - списки словарей с данными прокси (protocol, host, port).

    Raises:
        FileNotFoundError: Если файл с прокси не найден.
        Exception: В случае ошибки при парсинге прокси.

    Example:
        >>> proxies = get_proxies_dict(file_path=Path('/tmp/proxies.txt'))
        >>> print(proxies['http'][:2])
        [{'protocol': 'http', 'host': '127.0.0.1', 'port': '8080'}, {'protocol': 'http', 'host': '192.168.1.1', 'port': '3128'}]
    """
```

**Как работает функция**:

Функция `get_proxies_dict` сначала вызывает `download_proxies_list` для обновления списка прокси. Затем она открывает файл, указанный в `file_path`, и построчно читает его, извлекая протокол, хост и порт каждого прокси-сервера с помощью регулярного выражения. Полученные данные организуются в словарь, где ключами являются типы протоколов (`http`, `socks4`, `socks5`), а значениями — списки словарей, содержащих информацию о каждом прокси.

**Параметры**:
- `file_path` (Path): Путь к файлу, содержащему список прокси. По умолчанию использует глобальную переменную `proxies_list_path`.

**Возвращает**:
- `Dict[str, List[Dict[str, Any]]]`: Словарь, где ключи - типы прокси (`http`, `socks4`, `socks5`), а значения - списки словарей с данными прокси (protocol, host, port).

**Вызывает исключения**:
- `FileNotFoundError`: Если указанный файл не существует.
- `Exception`: В случае возникновения ошибки при чтении или парсинге файла.

### `check_proxy`

```python
def check_proxy(proxy: dict) -> bool:
    """
    Проверяет работоспособность прокси-сервера.

    Args:
        proxy (dict): Словарь с данными прокси (host, port, protocol).

    Returns:
        bool: `True`, если прокси работает, иначе `False`.

    Raises:
        requests.exceptions.ProxyError: Если возникает ошибка, связанная с прокси.
        requests.exceptions.RequestException: Если возникает общая ошибка при выполнении запроса.

    Example:
        >>> proxy = {'protocol': 'http', 'host': '127.0.0.1', 'port': '8080'}
        >>> check_proxy(proxy)
        True
    """
```

**Как работает функция**:

Функция `check_proxy` проверяет, доступен ли прокси-сервер, отправляя HTTP-запрос на `https://httpbin.org/ip` через указанный прокси. Если запрос выполнен успешно и получен код ответа 200, функция возвращает `True`, в противном случае - `False`. В случае возникновения ошибок подключения или получения ответа, функция логирует предупреждение и также возвращает `False`.

**Параметры**:
- `proxy` (dict): Словарь, содержащий данные прокси-сервера, включая протокол (`protocol`), хост (`host`) и порт (`port`).

**Возвращает**:
- `bool`: Возвращает `True`, если прокси-сервер работает и доступен, и `False` в противном случае.

**Вызывает исключения**:
- `requests.exceptions.ProxyError`: Возникает, если есть ошибка, связанная с прокси-сервером.
- `requests.exceptions.RequestException`: Возникает при других проблемах с HTTP-запросом.
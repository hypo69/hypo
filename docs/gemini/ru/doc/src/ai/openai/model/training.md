# Модуль `hypotez/src/ai/openai/model/training.py`

## Обзор

Данный модуль содержит класс `OpenAIModel`, предназначенный для взаимодействия с API OpenAI, обработки диалогов, обучения модели и описания изображений. Модуль предоставляет методы для получения доступных моделей и помощников, отправки сообщений, анализа тональности, динамического обучения и обучения с использованием предопределенных данных.

## Классы

### `OpenAIModel`

**Описание**: Класс `OpenAIModel` отвечает за взаимодействие с API OpenAI и управляет моделью. Он хранит данные о текущей сессии, ID помощника, системные инструкции и историю диалогов.

**Атрибуты**:

- `model`: Идентификатор модели OpenAI. По умолчанию `gpt-4o-mini`.
- `client`: Объект `OpenAI`, используемый для взаимодействия с API.
- `current_job_id`: ID текущей задачи обучения.
- `assistant_id`: ID помощника.
- `assistant`: Объект помощника OpenAI.
- `thread`: Объект диалогового потока OpenAI.
- `system_instruction`: Системные инструкции для модели.
- `dialogue_log_path`: Путь к файлу, в котором сохраняется история диалога.
- `dialogue`: Список словарей, содержащих историю диалога.
- `assistants`: Список объектов помощников.
- `models_list`: Список доступных моделей.


**Методы**:

#### `__init__(self, system_instruction=None, model_name='gpt-4o-mini', assistant_id=None)`

**Описание**: Инициализирует объект `OpenAIModel`.

**Параметры**:

- `system_instruction` (строка, необязательно): Системные инструкции для модели.
- `model_name` (строка, необязательно): Идентификатор модели OpenAI.
- `assistant_id` (строка, необязательно): ID помощника.

**Вызывает исключения**:

- Любые исключения, возникающие при инициализации объекта `OpenAI`.


#### `list_models(self) -> List[str]`

**Описание**: Возвращает список доступных моделей OpenAI.

**Возвращает**:

- Список строк (идентификаторов моделей).

**Вызывает исключения**:

- Любые исключения, возникающие при взаимодействии с API OpenAI.


#### `list_assistants(self) -> List[str]`

**Описание**: Возвращает список доступных помощников OpenAI.

**Возвращает**:

- Список строк (идентификаторов помощников).

**Вызывает исключения**:

- Любые исключения, возникающие при чтении файла с данными о помощниках.


#### `set_assistant(self, assistant_id: str)`

**Описание**: Устанавливает помощника с указанным ID.

**Параметры**:

- `assistant_id` (строка): ID помощника.

**Вызывает исключения**:

- Любые исключения, возникающие при взаимодействии с API OpenAI.


#### `_save_dialogue(self)`

**Описание**: Сохраняет историю диалогов в файл.

**Вызывает исключения**:

- Любые исключения, возникающие при работе с файлами.


#### `determine_sentiment(self, message: str) -> str`

**Описание**: Определяет тональность сообщения.

**Параметры**:

- `message` (строка): Сообщение для анализа.

**Возвращает**:

- Строка: Тональность сообщения (`positive`, `negative` или `neutral`).


#### `ask(self, message: str, system_instruction=None, attempts=3) -> str`

**Описание**: Отправляет сообщение модели и возвращает ответ.

**Параметры**:

- `message` (строка): Сообщение для модели.
- `system_instruction` (строка, необязательно): Системные инструкции.
- `attempts` (целое число, необязательно): Количество попыток.

**Возвращает**:

- Строка: Ответ модели.

**Вызывает исключения**:

- Любые исключения, возникающие при работе с API OpenAI.


#### `describe_image(self, image_path: str | Path, prompt=None, system_instruction=None) -> str`

**Описание**: Описывает изображение.

**Параметры**:

- `image_path` (строка или объект `Path`): Путь к изображению.
- `prompt` (строка, необязательно): Запрос для описания.
- `system_instruction` (строка, необязательно): Системные инструкции.


**Возвращает**:

- Строка: Описание изображения.


#### `describe_image_by_requests(self, image_path: str | Path, prompt=None) -> str`

**Описание**: Описывает изображение с использованием запросов `requests`.


**Параметры**:

- `image_path` (строка или объект `Path`): Путь к изображению.
- `prompt` (строка, необязательно): Запрос для описания.


**Возвращает**:

- Строка: Описание изображения.


#### `dynamic_train(self)`

**Описание**: Динамическое обучение модели.


**Вызывает исключения**:

- Любые исключения, возникающие при работе с API OpenAI.


#### `train(self, data=None, data_dir=None, data_file=None, positive=True) -> str | None`

**Описание**: Обучает модель на заданных данных.


**Параметры**:

- `data` (строка, необязательно): Путь к CSV файлу или данные в формате CSV.
- `data_dir` (объект `Path` или строка, необязательно): Директория с CSV файлами.
- `data_file` (объект `Path` или строка, необязательно): Путь к CSV файлу.
- `positive` (булево, необязательно): Признак положительных данных.

**Возвращает**:

- Строка: ID задачи обучения или `None` при ошибке.


#### `save_job_id(self, job_id: str, description: str, filename="job_ids.json")`

**Описание**: Сохраняет ID задачи обучения с описанием в файл.

**Параметры**:

- `job_id` (строка): ID задачи.
- `description` (строка): Описание задачи.
- `filename` (строка, необязательно): Имя файла.



## Функции

### `main()`

**Описание**: Главная функция модуля, демонстрирующая использование `OpenAIModel`.


```
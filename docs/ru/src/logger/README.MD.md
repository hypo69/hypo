# Документация для модуля `src.logger`

## Обзор

Модуль `src.logger` предоставляет гибкую систему логирования, поддерживающую вывод в консоль, файлы и JSON-формат. Он использует паттерн проектирования Singleton, чтобы гарантировать использование только одного экземпляра логгера во всем приложении. Логгер поддерживает различные уровни логирования (например, `INFO`, `ERROR`, `DEBUG`) и включает цветной вывод для консольных логов. Также можно настраивать форматы вывода логов и управлять логированием в различные файлы.

## Оглавление

1.  [Классы](#классы)
    *   [SingletonMeta](#singletonmeta)
    *   [JsonFormatter](#jsonformatter)
    *   [Logger](#logger)
2.  [Функции](#функции)
    *   [`__init__`](#__init__)
    *   [`_configure_logger`](#_configure_logger)
    *   [`initialize_loggers`](#initialize_loggers)
    *   [`log`](#log)
    *   [`info`](#info)
    *   [`success`](#success)
    *   [`warning`](#warning)
    *   [`debug`](#debug)
    *   [`error`](#error)
    *   [`critical`](#critical)
3.  [Параметры для логгера](#параметры-для-логгера)
4.  [Конфигурация файлового логирования](#конфигурация-файлового-логирования-config)
5.  [Примеры использования](#примеры-использования)

## Подробней

Модуль `src.logger` предназначен для организации централизованного логирования в приложении `hypotez`. Он позволяет записывать сообщения разного уровня важности (info, debug, error и т. д.) в консоль и/или в файлы. Реализация Singleton гарантирует, что все компоненты приложения будут использовать один и тот же экземпляр логгера, что упрощает настройку и управление логированием.

## Классы

### `SingletonMeta`

**Описание**:
Метакласс, реализующий паттерн проектирования Singleton для логгера. Гарантирует, что у класса будет только один экземпляр.

**Принцип работы**:
Метакласс переопределяет метод `__call__`, чтобы при каждом создании экземпляра класса возвращался один и тот же объект. Если экземпляр класса еще не создан, он создается при первом вызове.

### `JsonFormatter`

**Описание**:
Пользовательский класс форматирования логов в JSON-формате.

**Принцип работы**:
Наследует класс `logging.Formatter` и переопределяет метод `format`, чтобы преобразовывать записи логов в JSON-строки. Это позволяет удобно хранить и анализировать логи в структурированном формате.

### `Logger`

**Описание**:
Основной класс логгера, поддерживающий вывод в консоль, файлы и JSON-формат.

**Принцип работы**:

1.  При инициализации создаются плейсхолдеры для различных типов логгеров (консольный, файловый и JSON).
2.  Метод `_configure_logger` создает и настраивает логгер с заданным именем, путем к файлу, уровнем логирования и форматом.
3.  Метод `initialize_loggers` инициализирует логгеры для консоли и файлов (info, debug, error и JSON).
4.  Метод `log` записывает сообщение с указанным уровнем важности, опциональным исключением и форматированием цвета.
5.  Методы `info`, `success`, `warning`, `debug`, `error` и `critical` являются обертками для метода `log` и позволяют записывать сообщения с соответствующим уровнем важности.

**Методы**:

*   [`__init__`](#__init__)
*   [`_configure_logger`](#_configure_logger)
*   [`initialize_loggers`](#initialize_loggers)
*   [`log`](#log)
*   [`info`](#info)
*   [`success`](#success)
*   [`warning`](#warning)
*   [`debug`](#debug)
*   [`error`](#error)
*   [`critical`](#critical)

## Функции

### `__init__`

**Назначение**:
Инициализирует экземпляр класса `Logger` с плейсхолдерами для различных типов логгеров (консольный, файловый и JSON).

```python
def __init__(self):
    """
    Инициализирует экземпляр Logger с плейсхолдерами для различных типов логгеров (консольный, файловый и JSON).
    """
    ...
```

**Параметры**:
Отсутствуют.

**Возвращает**:
None

**Как работает функция**:

1.  Инициализирует атрибуты экземпляра класса для хранения различных логгеров: `console_logger`, `info_file_logger`, `debug_file_logger`, `error_file_logger`, `json_file_logger`.
2.  Устанавливает начальное значение для каждого атрибута в `None`.

**Примеры**:

```python
logger = Logger()
```

### `_configure_logger`

**Назначение**:
Конфигурирует и возвращает экземпляр логгера.

```python
def _configure_logger(name: str, log_path: str, level: Optional[int] = logging.DEBUG, formatter: Optional[logging.Formatter] = None, mode: Optional[str] = 'a') -> logging.Logger:
    """
    Конфигурирует и возвращает экземпляр логгера.

    Args:
        name (str): Имя логгера.
        log_path (str): Путь к файлу лога.
        level (Optional[int], optional): Уровень логирования. По умолчанию logging.DEBUG.
        formatter (Optional[logging.Formatter], optional): Пользовательский форматтер. По умолчанию None.
        mode (Optional[str], optional): Режим открытия файла. По умолчанию 'a' (append).

    Returns:
        logging.Logger: Конфигурированный экземпляр logging.Logger.
    """
    ...
```

**Параметры**:

*   `name` (str): Имя логгера.
*   `log_path` (str): Путь к файлу лога.
*   `level` (Optional[int], optional): Уровень логирования, например, `logging.DEBUG`. По умолчанию `logging.DEBUG`.
*   `formatter` (Optional[logging.Formatter], optional): Пользовательский форматтер (опционально).
*   `mode` (Optional[str], optional): Режим открытия файла, например, `'a'` для добавления в конец файла (по умолчанию).

**Возвращает**:

*   `logging.Logger`: Конфигурированный экземпляр `logging.Logger`.

**Как работает функция**:

1.  Создает экземпляр логгера с заданным именем.
2.  Устанавливает уровень логирования.
3.  Создает обработчик файла, который записывает логи в указанный файл.
4.  Устанавливает форматтер для обработчика файла.
5.  Добавляет обработчик файла к логгеру.
6.  Возвращает сконфигурированный экземпляр логгера.

**Примеры**:

```python
logger = Logger()
debug_logger = logger._configure_logger(name='debug', log_path='debug.log', level=logging.DEBUG)
```

### `initialize_loggers`

**Назначение**:
Инициализирует логгеры для консоли и файлов (info, debug, error и JSON).

```python
def initialize_loggers(info_log_path: Optional[str] = '', debug_log_path: Optional[str] = '', errors_log_path: Optional[str] = '', json_log_path: Optional[str] = ''):
    """
    Инициализирует логгеры для консоли и файлов (info, debug, error и JSON).

    Args:
        info_log_path (Optional[str], optional): Путь к файлу info логов. По умолчанию ''.
        debug_log_path (Optional[str], optional): Путь к файлу debug логов. По умолчанию ''.
        errors_log_path (Optional[str], optional): Путь к файлу error логов. По умолчанию ''.
        json_log_path (Optional[str], optional): Путь к файлу JSON логов. По умолчанию ''.
    """
    ...
```

**Параметры**:

*   `info_log_path` (Optional[str], optional): Путь к файлу для информационных логов (опционально).
*   `debug_log_path` (Optional[str], optional): Путь к файлу для отладочных логов (опционально).
*   `errors_log_path` (Optional[str], optional): Путь к файлу для логов ошибок (опционально).
*   `json_log_path` (Optional[str], optional): Путь к файлу для JSON-логов (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Получает корневой логгер.
2.  Устанавливает уровень логирования для корневого логгера на `logging.DEBUG`.
3.  Создает консольный обработчик, который выводит логи в консоль.
4.  Добавляет консольный обработчик к корневому логгеру.
5.  Если указаны пути к файлам логов, создает файловые обработчики для каждого типа логов (info, debug, error, json).
6.  Добавляет файловые обработчики к соответствующим логгерам.
7.  Сохраняет ссылки на файловые логгеры в атрибутах экземпляра класса.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
```

### `log`

**Назначение**:
Записывает сообщение с указанным уровнем важности, опциональным исключением и форматированием цвета.

```python
def log(level, message, ex=None, exc_info=False, color=None):
    """
    Записывает сообщение с указанным уровнем важности, опциональным исключением и форматированием цвета.

    Args:
        level: Уровень логирования (например, logging.INFO, logging.DEBUG).
        message: Сообщение лога.
        ex: Опциональное исключение для логирования.
        exc_info: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию False).
        color: Кортеж с цветом текста и цветом фона для вывода в консоль (опционально).
    """
    ...
```

**Параметры**:

*   `level`: Уровень логирования (например, `logging.INFO`, `logging.DEBUG`).
*   `message`: Сообщение лога.
*   `ex`: Опциональное исключение для логирования.
*   `exc_info`: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию `False`).
*   `color`: Кортеж с цветом текста и цветом фона для вывода в консоль (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Получает имя вызывающей функции.
2.  Форматирует сообщение лога, добавляя имя функции.
3.  Если указан цвет, применяет его к сообщению для вывода в консоль.
4.  Записывает сообщение в консольный логгер.
5.  Записывает сообщение в файловые логгеры, если они инициализированы.
6.  Если указано исключение, записывает информацию об исключении в лог.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
logger.log(logging.INFO, 'This is an info message')
logger.log(logging.ERROR, 'This is an error message', ex=Exception('Some error'))
```

### `info`

**Назначение**:
Записывает информационное сообщение.

```python
def info(message, ex=None, exc_info=False, colors: Optional[tuple] = None):
    """
    Записывает информационное сообщение.

    Args:
        message: Информационное сообщение для логирования.
        ex: Опциональное исключение для логирования.
        exc_info: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию False).
        colors: Кортеж с цветами для сообщения (опционально).
    """
    ...
```

**Параметры**:

*   `message`: Информационное сообщение для логирования.
*   `ex`: Опциональное исключение для логирования.
*   `exc_info`: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию `False`).
*   `colors`: Кортеж с цветами для сообщения (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Вызывает метод `log` с уровнем логирования `logging.INFO` и переданными параметрами.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
logger.info('This is an info message')
```

### `success`

**Назначение**:
Записывает сообщение об успехе.

```python
def success(message, ex=None, exc_info=False, colors: Optional[tuple] = None):
    """
    Записывает сообщение об успехе.

    Args:
        message: Сообщение об успехе для логирования.
        ex: Опциональное исключение для логирования.
        exc_info: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию False).
        colors: Кортеж с цветами для сообщения (опционально).
    """
    ...
```

**Параметры**:

*   `message`: Сообщение об успехе для логирования.
*   `ex`: Опциональное исключение для логирования.
*   `exc_info`: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию `False`).
*   `colors`: Кортеж с цветами для сообщения (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Вызывает метод `log` с уровнем логирования `logging.INFO` и переданными параметрами.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
logger.success('This is a success message')
```

### `warning`

**Назначение**:
Записывает предупреждающее сообщение.

```python
def warning(message, ex=None, exc_info=False, colors: Optional[tuple] = None):
    """
    Записывает предупреждающее сообщение.

    Args:
        message: Предупреждающее сообщение для логирования.
        ex: Опциональное исключение для логирования.
        exc_info: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию False).
        colors: Кортеж с цветами для сообщения (опционально).
    """
    ...
```

**Параметры**:

*   `message`: Предупреждающее сообщение для логирования.
*   `ex`: Опциональное исключение для логирования.
*   `exc_info`: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию `False`).
*   `colors`: Кортеж с цветами для сообщения (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Вызывает метод `log` с уровнем логирования `logging.WARNING` и переданными параметрами.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
logger.warning('This is a warning message')
```

### `debug`

**Назначение**:
Записывает отладочное сообщение.

```python
def debug(message, ex=None, exc_info=True, colors: Optional[tuple] = None):
    """
    Записывает отладочное сообщение.

    Args:
        message: Отладочное сообщение для логирования.
        ex: Опциональное исключение для логирования.
        exc_info: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию True).
        colors: Кортеж с цветами для сообщения (опционально).
    """
    ...
```

**Параметры**:

*   `message`: Отладочное сообщение для логирования.
*   `ex`: Опциональное исключение для логирования.
*   `exc_info`: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию `True`).
*   `colors`: Кортеж с цветами для сообщения (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Вызывает метод `log` с уровнем логирования `logging.DEBUG` и переданными параметрами.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
logger.debug('This is a debug message')
```

### `error`

**Назначение**:
Записывает сообщение об ошибке.

```python
def error(message, ex=None, exc_info=True, colors: Optional[tuple] = None):
    """
    Записывает сообщение об ошибке.

    Args:
        message: Сообщение об ошибке для логирования.
        ex: Опциональное исключение для логирования.
        exc_info: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию True).
        colors: Кортеж с цветами для сообщения (опционально).
    """
    ...
```

**Параметры**:

*   `message`: Сообщение об ошибке для логирования.
*   `ex`: Опциональное исключение для логирования.
*   `exc_info`: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию `True`).
*   `colors`: Кортеж с цветами для сообщения (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Вызывает метод `log` с уровнем логирования `logging.ERROR` и переданными параметрами.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
logger.error('This is an error message')
```

### `critical`

**Назначение**:
Записывает критическое сообщение.

```python
def critical(message, ex=None, exc_info=True, colors: Optional[tuple] = None):
    """
    Записывает критическое сообщение.

    Args:
        message: Критическое сообщение для логирования.
        ex: Опциональное исключение для логирования.
        exc_info: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию True).
        colors: Кортеж с цветами для сообщения (опционально).
    """
    ...
```

**Параметры**:

*   `message`: Критическое сообщение для логирования.
*   `ex`: Опциональное исключение для логирования.
*   `exc_info`: Флаг, указывающий, нужно ли включать информацию об исключении (по умолчанию `True`).
*   `colors`: Кортеж с цветами для сообщения (опционально).

**Возвращает**:
None

**Как работает функция**:

1.  Вызывает метод `log` с уровнем логирования `logging.CRITICAL` и переданными параметрами.

**Примеры**:

```python
logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
logger.critical('This is a critical message')
```

## Параметры для логгера

Класс `Logger` принимает несколько необязательных параметров для настройки поведения логирования.

*   **Level**: Управляет серьезностью захватываемых логов. Общие уровни включают:

    *   `logging.DEBUG`: Подробная информация, полезная для диагностики проблем.
    *   `logging.INFO`: Общая информация, например, об успешных операциях.
    *   `logging.WARNING`: Предупреждения, которые не обязательно требуют немедленных действий.
    *   `logging.ERROR`: Сообщения об ошибках.
    *   `logging.CRITICAL`: Критические ошибки, требующие немедленного внимания.

*   **Formatter**: Определяет, как форматируются сообщения журнала. По умолчанию сообщения форматируются как `'%(asctime)s - %(levelname)s - %(message)s'`. Вы можете предоставить пользовательский форматтер для различных форматов, таких как JSON.

*   **Color**: Цвета для сообщений журнала в консоли. Цвета указываются в виде кортежа с двумя элементами:

    *   **Text color**: Указывает цвет текста (например, `colorama.Fore.RED`).
    *   **Background color**: Указывает цвет фона (например, `colorama.Back.WHITE`).

    Цвет можно настроить для разных уровней логирования (например, зеленый для info, красный для ошибок и т. д.).

## Конфигурация файлового логирования (`config`)

Чтобы записывать сообщения в файл, вы можете указать пути к файлам в конфигурации.

```python
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
```

Пути к файлам, указанные в `config`, используются для записи логов в соответствующие файлы для каждого уровня логирования.

## Примеры использования

#### 1. Инициализация логгера:

```python
logger: Logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
```

#### 2. Запись сообщений на разных уровнях:

```python
logger.info('Это информационное сообщение')
logger.success('Это сообщение об успехе')
logger.warning('Это предупреждающее сообщение')
logger.debug('Это отладочное сообщение')
logger.error('Это сообщение об ошибке')
logger.critical('Это критическое сообщение')
```

#### 3. Настройка цветов:

```python
logger.info('Это сообщение будет зеленым', colors=(colorama.Fore.GREEN, colorama.Back.BLACK))
logger.error('Это сообщение будет иметь красный фон', colors=(colorama.Fore.WHITE, colorama.Back.RED))
```

```
A -- init -- B
|
_configure_logger -- C
|
D -- initialize_loggers -- E
|
Log -- F
|
Info, Warning, Debug, Error, Critical
```

Где:

*   **A**: `__init__` - Инициализация экземпляра класса `Logger`.
*   **B**: Создание плейсхолдеров для различных типов логгеров (консольный, файловый и JSON).
*   **C**: `_configure_logger` - Конфигурирование и возвращение экземпляра логгера.
*   **D**:  `initialize_loggers` - Инициализация логгеров для консоли и файлов (info, debug, error и JSON).
*   **E**:  Настройка файловых и консольных обработчиков.
*   **F**:  `log` - Запись сообщения с указанным уровнем важности.

Модуль предоставляет комплексную и гибкую систему логирования для приложений Python. Вы можете настраивать консольное и файловое логирование с разными форматами и цветами, управлять уровнями логирования и корректно обрабатывать исключения. Конфигурация для файлового логирования хранится в словаре `config`, что обеспечивает простую настройку.
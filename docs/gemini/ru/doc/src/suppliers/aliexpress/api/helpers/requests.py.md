# Модуль для обработки API-запросов AliExpress
## Обзор

Модуль `requests.py` содержит функции для выполнения API-запросов к AliExpress, обработки ответов и возврата результатов. Он предназначен для упрощения взаимодействия с API AliExpress, обработки ошибок и преобразования ответов в удобный формат.

## Подробнее

Этот модуль используется для отправки запросов к API AliExpress и обработки полученных ответов. Он включает в себя обработку ошибок, логирование и преобразование данных для удобства использования в других частях проекта. Модуль обрабатывает ответы, преобразуя их в объекты `SimpleNamespace` для упрощения доступа к данным.

## Функции

### `api_request`

```python
def api_request(request, response_name, attemps:int = 1):
    """
    Выполняет API-запрос и обрабатывает ответ.

    Args:
        request: Объект запроса, содержащий метод `getResponse()`.
        response_name (str): Ключ для извлечения данных из ответа.
        attemps (int, optional): Количество попыток выполнения запроса. По умолчанию `1`.

    Returns:
        SimpleNamespace | None: Результат запроса в виде объекта `SimpleNamespace` или `None` в случае ошибки.

    Raises:
        ApiRequestException: Если при выполнении запроса возникает исключение.
        ApiRequestResponseException: Если в ответе содержится код ошибки.
    """
```

**Назначение**: Функция `api_request` выполняет API-запрос к AliExpress, обрабатывает возможные ошибки и возвращает результат в виде объекта `SimpleNamespace`.

**Параметры**:

-   `request`: Объект запроса, содержащий метод `getResponse()`, который отправляет запрос и возвращает ответ.
-   `response_name` (str): Ключ, используемый для извлечения необходимой части данных из структуры ответа.
-   `attemps` (int, optional): Максимальное количество попыток выполнения запроса в случае неудачи. По умолчанию равен 1.

**Возвращает**:

-   `SimpleNamespace | None`: Функция возвращает результат запроса в виде объекта `SimpleNamespace`, что позволяет обращаться к элементам ответа как к атрибутам объекта. В случае возникновения ошибки или получения некорректного ответа функция возвращает `None`.

**Вызывает исключения**:

-   `ApiRequestException`: Возникает, если в процессе выполнения запроса происходит исключение, например, при сетевых проблемах.
-   `ApiRequestResponseException`: Возникает, если ответ от API содержит код ошибки, указывающий на проблему на стороне сервера.

**Как работает функция**:

1.  **Выполнение запроса**: Функция пытается выполнить запрос, вызывая метод `getResponse()` у переданного объекта запроса.
2.  **Обработка исключений при запросе**: Если при выполнении запроса возникает исключение, функция логирует ошибку и возвращает `None`.
3.  **Извлечение и преобразование ответа**: Если запрос выполнен успешно, функция извлекает данные из ответа, используя ключ `response_name`. Затем ответ преобразуется в JSON, а затем в объект `SimpleNamespace` для удобного доступа к данным.
4.  **Обработка исключений при обработке ответа**: Если при извлечении или преобразовании ответа возникает исключение, функция логирует ошибку и возвращает `None`.
5.  **Проверка кода ответа**: Функция проверяет код ответа `resp_code`. Если код равен 200, функция возвращает результат. В противном случае логируется предупреждение и возвращается `None`.
6.  **Обработка исключений при проверке ответа**: Если при проверке ответа возникает исключение, функция логирует ошибку и возвращает `None`.

```
    Начало
    │
    └── Запрос к API (request.getResponse())
        │
        ├── Успех → Извлечение данных из ответа (response[response_name]['resp_result'])
        │   │
        │   └── Преобразование в JSON (json.dumps()) → SimpleNamespace (json.loads())
        │   │   │
        │   │   └── Успех → Проверка кода ответа (response.resp_code == 200)
        │   │   │   │
        │   │   │   ├── 200 → Возврат результата (response.result)
        │   │   │   │
        │   │   │   └── Иначе → Логирование предупреждения → Возврат None
        │   │   │   │
        │   │   │   └── Ошибка при проверке → Логирование ошибки → Возврат None
        │   │   │
        │   │   └── Ошибка при преобразовании → Логирование ошибки → Возврат None
        │   │
        │   └── Ошибка при запросе → Логирование ошибки → Возврат None
        │
        └── Конец
```

**Примеры**:

```python
# Пример вызова функции api_request
# Предположим, что у нас есть объект request и имя ответа
# result = api_request(request_obj, 'item_detail')
# if result:
#     print(result.title)
# else:
#     print('Ошибка при выполнении запроса')
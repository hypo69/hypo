# hypotez/src/endpoints/bots/telegram/ToolBoxbot-main/ToolBox/ToolBox_requests.py

## Обзор

Данный модуль содержит класс `ToolBox`, который наследует функциональность для работы с клавиатурами (`keyboards`) и нейронными сетями (`neural_networks`). Класс предназначен для обработки различных запросов от пользователей Telegram-бота, включая генерацию текста и изображений, а также управление тарифами.

## Подробней

Этот файл является ключевым компонентом Telegram-бота, обеспечивающим взаимодействие с пользователем через различные интерфейсы и функциональности. Он использует другие модули для создания клавиатур, работы с нейронными сетями и обработки текста.

## Классы

### `ToolBox`

**Описание**: Основной класс для управления Telegram-ботом. Он включает в себя обработку текстовых и графических запросов, управление тарифами и взаимодействие с нейронными сетями.

**Как работает класс**:
1.  Инициализируется с основными кнопками старта, загружает текстовые подсказки и настраивает Telegram-бота.
2.  Определяет лямбда-функции для упрощения отправки сообщений и изменения интерфейса бота.
3.  Содержит методы для обработки различных типов запросов, таких как текстовые команды, генерация изображений и управление тарифами.

**Методы**:

-   `__init__`: Инициализация класса `ToolBox`.

    **Параметры**:
    -   `self`: Экземпляр класса `ToolBox`.

    **Как работает метод**:
    1.  Инициализирует основные атрибуты класса, такие как названия и данные для кнопок старта.
    2.  Загружает текстовые подсказки из файла `prompts.json`.
    3.  Инициализирует Telegram-бота с использованием токена из переменной окружения `TOKEN`.
    4.  Определяет лямбда-функции для упрощения создания клавиатур и отправки сообщений.

-   `__gpt_4o_mini`: Приватный метод для обработки запросов к модели GPT-4o mini.

    **Параметры**:
    -   `prompt` (list[dict]): Список словарей с запросами для модели.
    -   `message`: Объект сообщения от Telegram.

    **Возвращает**:
    -   `tuple[dict[str, str], int, int]`: Кортеж, содержащий ответ от модели, количество входящих и исходящих токенов.

    **Как работает метод**:
    1.  Отправляет сообщение "Подождите, это должно занять несколько секунд . . ." пользователю.
    2.  Вызывает метод `_free_gpt_4o_mini` для получения ответа от модели GPT-4o mini.
    3.  Редактирует сообщение с результатом, полученным от модели, и вставляет HTML-теги.

-   `__FLUX_schnell`: Приватный метод для обработки запросов к модели FLUX.

    **Параметры**:
    -   `prompt` (str): Текст запроса для генерации изображения.
    -   `size` (list[int]): Размеры изображения.
    -   `message`: Объект сообщения от Telegram.
    -   `seed` (int): Зерно для генерации случайных чисел.
    -   `num_inference_steps` (int): Количество шагов для генерации изображения.

    **Как работает метод**:
    1.  Отправляет сообщение "Подождите, это должно занять несколько секунд . . ." пользователю.
    2.  Вызывает метод `_FLUX_schnell` для получения изображения от модели FLUX.
    3.  Отправляет полученное изображение пользователю.
    4.  Удаляет сообщение "Подождите, это должно занять несколько секунд . . .".

-   `Text_types`: Метод для отображения типов текстов.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.

    **Возвращает**:
    -   None

    **Как работает метод**:
    1.  Определяет названия и данные для типов текстов.
    2.  Редактирует сообщение пользователя, предлагая выбрать тип текста.

-   `Basic_tariff`: Метод для обработки запроса на подключение базового тарифа.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.

    **Как работает метод**:
    1.  Создает inline-клавиатуру с кнопками для подключения тарифа и возврата к списку тарифов.
    2.  Формирует цену тарифа.
    3.  Удаляет предыдущее сообщение и отправляет инвойс пользователю.

-   `Pro_tariff`: Метод для обработки запроса на подключение профессионального тарифа.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.

    **Как работает метод**:
    1.  Создает inline-клавиатуру с кнопками для подключения тарифа и возврата к списку тарифов.
    2.  Формирует цену тарифа.
    3.  Удаляет предыдущее сообщение и отправляет инвойс пользователю.

-   `TextCommands`: Метод для обработки текстовых команд.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.
    -   `ind` (int): Индекс команды.

    **Возвращает**:
    -   `tuple[int, int, int]`: Кортеж, содержащий количество входящих и исходящих токенов, а также 1.

    **Как работает метод**:
    1.  Проверяет, содержит ли команда текстовый ввод.
    2.  Запрашивает у пользователя необходимую информацию.
    3.  Формирует запрос к модели GPT-4o mini и получает ответ.
    4.  Перезапускает бота.

     **Внутренние функции**:

        ### `Text_next_step`

        **Описание**: Внутренняя функция для обработки следующего шага текстовой команды.

        **Параметры**:
        -   `message`: Объект сообщения от Telegram.

        **Как работает функция**:
        1.  Добавляет введенный пользователем текст в список `info`.
        2.  Проверяет, достаточно ли параметров для формирования запроса.
        3.  Формирует запрос и отправляет его в модель GPT-4o mini.
        4.  Перезапускает бота.

-   `SomeTextsCommand`: Метод для обработки нескольких текстовых команд.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.
    -   `ind` (int): Индекс команды.
    -   `tokens` (dict[str, int]): Словарь с количеством доступных токенов.

    **Возвращает**:
    -   `tuple[int, int, int]`: Кортеж, содержащий количество входящих и исходящих токенов, а также количество обработанных текстов.

    **Как работает метод**:
    1.  Запрашивает у пользователя количество текстов для обработки.
    2.  Запрашивает необходимую информацию для каждого текста.
    3.  Формирует запросы к модели GPT-4o mini и получает ответы.
    4.  Перезапускает бота.

     **Внутренние функции**:

        ### `Text_next_step`

        **Описание**: Внутренняя функция для обработки следующего шага текстовой команды.

        **Параметры**:
        -   `message`: Объект сообщения от Telegram.

        **Как работает функция**:
        1.  Добавляет введенный пользователем текст в список `ans`.

        ### `Params_addition`

        **Описание**: Внутренняя функция для добавления параметров.

        **Параметры**:
        -   `message`: Объект сообщения от Telegram.

        **Как работает функция**:
        1.  Добавляет введенные пользователем параметры в список `ans`.

        ### `process_prompt`

        **Описание**: Внутренняя функция для обработки запроса.

        **Параметры**:
        -   `i`: индекс запроса.

        **Как работает функция**:
        1.  Формирует запрос к модели GPT-4o mini и получает ответ.
        2.  Учитывает количество токенов.
        3.  Возвращает количество использованных токенов.

-   `ImageCommand`: Метод для обработки команд генерации изображений.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.
    -   `prompt` (str): Текст запроса для генерации изображения.
    -   `size` (list[int]): Размеры изображения.

    **Возвращает**:
    -   `seed`: Зерно для генерации случайных чисел.

    **Как работает метод**:
    1.  Генерирует случайное зерно.
    2.  Вызывает метод `__FLUX_schnell` для генерации изображения.
    3.  Вызывает метод `ImageChange` для отображения вариантов действий с изображением.

-   `Image_Regen_And_Upscale`: Метод для регенерации и улучшения изображений.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.
    -   `prompt` (str): Текст запроса для генерации изображения.
    -   `size` (list[int]): Размеры изображения.
    -   `seed`: Зерно для генерации случайных чисел.
    -   `num_inference_steps` (int): Количество шагов для генерации изображения.

    **Возвращает**:
    -   None

    **Как работает метод**:
    1.  Вызывает метод `__FLUX_schnell` для генерации изображения.

-   `FreeCommand`: Метод для обработки команд в свободном режиме.

    **Параметры**:
    -   `message`: Объект сообщения от Telegram.
    -   `prompts` (list[str]): Список запросов.

    **Возвращает**:
    -   `tuple[int, int, prompts]`: Кортеж, содержащий количество входящих и исходящих токенов, а также список запросов.

    **Как работает метод**:
    1.  Добавляет текст сообщения пользователя в список запросов.
    2.  Вызывает метод `__gpt_4o_mini` для получения ответа от модели GPT-4o mini.

## Функции

В данном файле функции отсутствуют.
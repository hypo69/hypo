# Модуль AiService

## Обзор

Модуль `AiService` предоставляет класс `AiService`, который является провайдером для взаимодействия с сервисом `aiservice.vercel.app`. Он используется для генерации ответов на основе предоставленных сообщений, имитируя работу с GPT-3.5 Turbo.

## Подробней

Этот модуль интегрируется с `aiservice.vercel.app` через HTTP-запросы. Класс `AiService` наследуется от `AbstractProvider` и переопределяет метод `create_completion` для отправки запросов к API и получения ответов. Модуль предназначен для использования в качестве одного из провайдеров в системе, где требуется взаимодействие с различными AI-моделями.

## Классы

### `AiService`

**Описание**:
Класс `AiService` является провайдером для взаимодействия с AI-сервисом `aiservice.vercel.app`.

**Наследует**:
`AbstractProvider` - абстрактный базовый класс для всех провайдеров.

**Аттрибуты**:
- `url` (str): URL AI-сервиса (`https://aiservice.vercel.app/`).
- `working` (bool): Флаг, указывающий на работоспособность провайдера (всегда `False`).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели GPT-3.5 Turbo (всегда `True`).

**Методы**:
- `create_completion`: Создает завершение на основе предоставленных сообщений, используя AI-сервис.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: Messages,
    stream: bool,
    **kwargs: Any,
) -> CreateResult:
    """
    Создает завершение на основе предоставленных сообщений, используя AI-сервис.

    Args:
        model (str): Модель, используемая для генерации (не используется в данной реализации).
        messages (Messages): Список сообщений для отправки в AI-сервис.
        stream (bool): Флаг, указывающий на потоковую передачу данных (не используется в данной реализации).
        **kwargs (Any): Дополнительные параметры (не используются в данной реализации).

    Returns:
        CreateResult: Генератор, выдающий ответы от AI-сервиса.

    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с ошибкой.

    """
```

**Назначение**:
Функция `create_completion` отправляет запрос к AI-сервису `aiservice.vercel.app` и возвращает ответ в виде генератора.

**Параметры**:
- `model` (str): Модель, используемая для генерации (фактически не используется).
- `messages` (Messages): Список сообщений, отправляемых в AI-сервис.
- `stream` (bool): Флаг, указывающий на потоковую передачу (фактически не используется).
- `**kwargs` (Any): Дополнительные параметры (фактически не используются).

**Возвращает**:
- `CreateResult`: Генератор, выдающий ответы от AI-сервиса.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Если HTTP-запрос завершается с ошибкой.

**Как работает функция**:

1. **Формирование текста запроса**:
   - Функция преобразует список сообщений в текстовый формат, объединяя роль и содержимое каждого сообщения в строку, разделенную символом новой строки. К последней строке добавляется `"\\nassistant: "`.

2. **Подготовка заголовков**:
   - Функция определяет заголовки HTTP-запроса, включая `accept`, `content-type`, `sec-fetch-dest`, `sec-fetch-mode`, `sec-fetch-site` и `Referer`.

3. **Отправка запроса**:
   - Функция отправляет POST-запрос к `https://aiservice.vercel.app/api/chat/answer` с сформированными заголовками и данными.

4. **Обработка ответа**:
   - Функция проверяет статус HTTP-ответа и вызывает исключение, если произошла ошибка.
   - Функция извлекает данные из JSON-ответа и возвращает их как генератор.

```ascii
Формирование текста запроса
↓
Подготовка заголовков
↓
Отправка POST-запроса
↓
Обработка ответа
```

**Примеры**:

```python
messages = [{"role": "user", "content": "Hello!"}]
result = AiService.create_completion(model="gpt-3.5-turbo", messages=messages, stream=False)
for item in result:
    print(item)
# Модуль `Yqcloud`

## Обзор

Модуль `Yqcloud` представляет собой асинхронного провайдера генерации текста, использующего API сервиса `chat9.yqcloud.top`. Он предназначен для работы с моделью `gpt-3.5-turbo` и обеспечивает потоковую передачу сгенерированного контента.

## Подробней

Модуль реализует подключение к API `chat9.yqcloud.top` для генерации текста на основе предоставленных сообщений. Он использует асинхронные запросы для обеспечения неблокирующей работы. Этот модуль является частью коллекции провайдеров для работы с различными сервисами генерации текста в проекте `hypotez`. Модуль является устаревшим.

## Классы

### `Yqcloud`

**Описание**: Класс `Yqcloud` является асинхронным провайдером, который взаимодействует с API `chat9.yqcloud.top` для генерации текста.

**Наследует**:

- `AsyncGeneratorProvider`: Наследует функциональность асинхронного генератора.

**Аттрибуты**:

- `url` (str): URL сервиса `chat9.yqcloud.top`.
- `working` (bool): Указывает, работает ли провайдер в данный момент.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo`.

**Методы**:

- `create_async_generator()`: Создает асинхронный генератор для получения сгенерированного текста.

## Функции

### `create_async_generator`

```python
async def create_async_generator(
    model: str,
    messages: Messages,
    proxy: str = None,
    timeout: int = 120,
    **kwargs,
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения сгенерированного текста от API `chat9.yqcloud.top`.

    Args:
        model (str): Имя используемой модели.
        messages (Messages): Список сообщений для генерации текста.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания запроса в секундах. По умолчанию `120`.
        **kwargs: Дополнительные параметры.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий сгенерированный текст.

    Raises:
        RuntimeError: Если IP-адрес заблокирован из-за обнаружения злоупотреблений.

    """
```

**Назначение**: Функция `create_async_generator` создает и возвращает асинхронный генератор, который отправляет запросы к API `chat9.yqcloud.top` и выдает сгенерированный текст по частям.

**Параметры**:

- `model` (str): Имя используемой модели.
- `messages` (Messages): Список сообщений, используемых для генерации текста.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания запроса в секундах. По умолчанию `120`.
- `**kwargs`: Дополнительные параметры, которые могут быть переданы в API.

**Возвращает**:

- `AsyncResult`: Асинхронный генератор, выдающий сгенерированный текст.

**Вызывает исключения**:

- `RuntimeError`: Если IP-адрес заблокирован из-за обнаружения злоупотреблений.

**Как работает функция**:

1.  **Создание сессии**: Функция создает асинхронную сессию с использованием `StreamSession` для выполнения HTTP-запросов. Устанавливаются заголовки и прокси (если указаны).
2.  **Формирование payload**: Подготавливается полезная нагрузка (payload) для запроса к API на основе переданных сообщений и дополнительных параметров.
3.  **Отправка запроса**: Отправляется POST-запрос к API `https://api.aichatos.cloud/api/generateStream` с сформированной полезной нагрузкой.
4.  **Обработка ответа**: Асинхронно читаются чанки (части) ответа. Каждый чанк декодируется и проверяется на наличие сообщения о блокировке IP-адреса.
5.  **Генерация текста**: Если чанк содержит текст, он выдается генератором. Если обнаружена блокировка IP-адреса, выбрасывается исключение `RuntimeError`.

**Внутренние функции**:

- Нет

**ASCII flowchart**:

```
    Начало
    |
    Создание сессии (StreamSession) - Настройка заголовков и прокси
    |
    Формирование payload (_create_payload) - Создание JSON-структуры запроса
    |
    Отправка POST-запроса - К API generateStream
    |
    Получение чанка ответа
    |
    Проверка на блокировку IP
    |
    Выдача чанка (yield)
    |
    Конец (до завершения потока)
```

**Примеры**:

```python
# Пример использования асинхронного генератора
async for chunk in Yqcloud.create_async_generator(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello!"}]):
    print(chunk, end="")
```

### `_create_header`

```python
def _create_header() -> dict:
    """
    Создает и возвращает словарь с заголовками HTTP-запроса.

    Returns:
        dict: Словарь с заголовками HTTP-запроса.
    """
```

**Назначение**: Функция `_create_header` создает и возвращает словарь с HTTP-заголовками, необходимыми для запросов к API `chat9.yqcloud.top`.

**Параметры**:

- Нет

**Возвращает**:

- `dict`: Словарь с HTTP-заголовками.

**Вызывает исключения**:

- Нет

**Как работает функция**:

1.  **Создание словаря**: Функция создает словарь, содержащий HTTP-заголовки, такие как `accept`, `content-type`, `origin` и `referer`.
2.  **Возврат словаря**: Функция возвращает созданный словарь с HTTP-заголовками.

**Внутренние функции**:

- Нет

**ASCII flowchart**:

```
    Начало
    |
    Создание словаря с HTTP-заголовками
    |
    Возврат словаря
    |
    Конец
```

**Примеры**:

```python
# Пример использования функции _create_header
headers = _create_header()
print(headers)
```

### `_create_payload`

```python
def _create_payload(
    messages: Messages,
    system_message: str = "",
    user_id: int = None,
    **kwargs
) -> dict:
    """
    Создает и возвращает словарь с полезной нагрузкой (payload) для запроса к API.

    Args:
        messages (Messages): Список сообщений для генерации текста.
        system_message (str, optional): Системное сообщение. По умолчанию "".
        user_id (int, optional): ID пользователя. По умолчанию `None`.
        **kwargs: Дополнительные параметры.

    Returns:
        dict: Словарь с полезной нагрузкой.
    """
```

**Назначение**: Функция `_create_payload` создает и возвращает словарь, содержащий полезную нагрузку (payload) для запроса к API `chat9.yqcloud.top`.

**Параметры**:

- `messages` (Messages): Список сообщений для генерации текста.
- `system_message` (str, optional): Системное сообщение. По умолчанию "".
- `user_id` (int, optional): ID пользователя. Если не указан, генерируется случайный ID. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:

- `dict`: Словарь с полезной нагрузкой.

**Вызывает исключения**:

- Нет

**Как работает функция**:

1.  **Генерация User ID**: Если `user_id` не предоставлен, генерируется случайный `user_id`.
2.  **Формирование payload**: Функция создает словарь, содержащий параметры запроса, такие как `prompt` (сформированный из сообщений), `network`, `system`, `withoutContext`, `stream` и `userId`.
3.  **Возврат словаря**: Функция возвращает созданный словарь с полезной нагрузкой.

**Внутренние функции**:

- Нет

**ASCII flowchart**:

```
    Начало
    |
    Проверка user_id - Если отсутствует, генерируется случайный ID
    |
    Формирование словаря с параметрами запроса (payload)
    |
    Возврат словаря
    |
    Конец
```

**Примеры**:

```python
# Пример использования функции _create_payload
payload = _create_payload(messages=[{"role": "user", "content": "Hello!"}], system_message="You are a helpful assistant.")
print(payload)
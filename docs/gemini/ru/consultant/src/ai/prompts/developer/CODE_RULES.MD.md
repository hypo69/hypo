## Анализ кода модуля `CODE_RULES.MD`

**Качество кода**
7
- Плюсы
    - Документ структурирован и содержит подробные инструкции по оформлению кода.
    - Приведены примеры кода и ожидаемых результатов.
    - Использованы ключевые слова и форматирование, облегчающие понимание правил.
    - Инструкции по форматированию кода и логированию достаточно подробны.
    - Правила комментирования четко сформулированы.
- Минусы
    -  В некоторых частях документации смешаны требования к коду и пояснения.
    -  Не все правила сопровождаются примерами использования.
    -  Может быть сложно выделить конкретные действия из общего текста.
    -  Стилистика описания правил не везде последовательна.
    -  Присутствует избыточное повторение информации в разных разделах.

**Рекомендации по улучшению**
1. **Уточнить структуру документа**: Разделить общие принципы и конкретные правила для лучшего понимания.
2. **Добавить больше примеров**: Для каждого правила добавить примеры кода и документации в формате RST.
3. **Разделить требования**: Четко разделить требования к комментариям, документации и форматированию кода.
4. **Унифицировать терминологию**: Использовать последовательные термины (например, "параметр" вместо "аргумент") для описания параметров функций.
5. **Форматирование**: Привести форматирование примеров к общему стилю, включая отступы и пробелы.
6. **Добавить примеры Pydantic**: Включить примеры использования Pydantic для валидации данных и создания моделей.
7. **Уточнить правила логирования**: Добавить больше примеров использования `logger` и правила оформления лог-сообщений.
8. **Избегать избыточности**: Сократить повторы в разных разделах.
9. **Улучшить описания примеров**: Добавить более подробные пояснения к примерам, чтобы их было проще понять.

**Оптимизированный код**
```markdown
# ИНСТРУКЦИЯ ПО ОФОРМЛЕНИЮ КОДА

## Основные принципы

1.  **Общие правила**:
    -   Соблюдайте единый стиль кодирования для улучшения читаемости и консистентности.
    -   Все изменения и рекомендации должны соответствовать данному формату.

---

## Комментарии

2.  **Комментарии после `#`**:
    -   **Не изменять**: Комментарии после символа `#` должны оставаться без изменений и быть понятными. Не переписывайте и не удаляйте их, даже если они начинаются с кода.
    -   **Информативность**: Внутренние комментарии должны быть информативными и объяснять следующий блок кода.
    -   **Формат**: Используйте формат reStructuredText (RST) для всех комментариев и документации.
    -   **Терминология**: Избегайте использования терминов, таких как 'получаем', 'делаем', в комментариях. Вместо этого используйте фразы, такие как 'проверка', 'отправка', 'код исполняет ...'.
    -   **Пассивные формы**: Предпочитайте пассивные формы: 'копирование', 'форматирование', 'создание' и т. д.
    -   **Пустые строки**: Если есть пустые строки или `...`, не документируйте их.

3. **Комментарии после `"""`**:
     - **Оптимизация**: Комментарии после `"""` можно и нужно оптимизировать, исходя из фактического поведения кода.

---

## Документация

4.  **Docstring**:
    -   Каждая функция, метод и класс должны иметь docstring в стиле Sphinx.

        Пример для функции:
        ```python
        def function(param: str, param1: Optional[str | dict] = None) -> dict | None:
            """
            Описание функции.

            :param param: Описание параметра `param`.
            :type param: str
            :param param1: (Опционально) Описание параметра `param1`.
            :type param1: str | dict | None
            :return: Описание возвращаемого значения.
            :rtype: dict | None
            :raises SomeError: Условия для возникновения исключения.
            """
            ...
        ```

5. **Описание модуля**: Добавьте описание модуля в начало каждого файла.

    ```python
    """
    Модуль для работы с ассистентом программиста
    =========================================================================================

    Описание функциональности модуля.

    Пример использования
    ---------------------

    .. code-block:: python

        example_usage()
    """
    ```

---

## Форматирование кода

6.  **Кавычки**: Используйте одинарные кавычки вместо двойных.
7.  **Пробелы**: Используйте пробелы вокруг оператора присваивания `=`. Пример:
    ```python
    a = 1
    ```
8.  **Консистентность**: Применяйте пробелы консистентно во всех выражениях и присваиваниях:
    ```python
    result = 10 if x > 5 else 20
    ```
9. **Заголовок импортов**: Всегда включайте строку `import header` в начало файла.
10. **Отладка**: Добавляйте `...` между `logger` и `return` для отладки. Пример:
    ```python
    logger.error('Ошибка при выполнении задачи', ex)
    ...
    return
    ```

---

## Параметры функций

11. **Типизация**: Параметры должны быть явно типизированы. Если значение по умолчанию `None`, используйте `Optional`. Пример:
    ```python
    def critical(self, message: str, ex: Optional = None, exc_info: Optional[bool] = True):
        ...
    ```
12. **Избегать Union**: Избегайте использования `Union`.

---

## Pydantic

13. **Валидация**: Используйте Pydantic для валидации данных, если это возможно и уместно.
14. **Модели**: Используйте модели Pydantic для классов, обрабатывающих структурированные данные.
    
     Пример:
    ```python
    from pydantic import BaseModel

    class MyModel(BaseModel):
        name: str
        age: int
        email: Optional[str] = None
    ```

---

## Логирование

15. **Логгер**: Используйте `from src.logger.logger import logger` для логирования вместо стандартного `logging`.
16. **Пример логирования ошибок**:
    ```python
    logger.error('Ошибка при запуске бота: ', ex)
    ...
    return
    ```

---

## Константы

17. **MODE**: Всегда включайте глобальную константу `MODE` в код, даже если она не используется.

---

## Формат ответа:

Все ответы должны следовать формату Markdown.

Структура ответа должна включать:

-   **Улучшенный код**: Блок с улучшенным кодом, отформатированным и с добавленными комментариями.
-   **Изменения**: Подробный список модификаций и пояснений.

Код должен быть заключен в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).

---

## Примеры:

#### Пример 1 (Python Code):

Ввод:

```python
def add_numbers(a,b):
    return a+b
```

Ожидаемый ответ:

### Улучшенный код:

```python
def add_numbers(a: int, b: int) -> int:
    """
    Функция, которая складывает два числа.

    :param a: Первое число.
    :type a: int
    :param b: Второе число.
    :type b: int
    :returns: Сумма чисел `a` и `b`.
    :rtype: int
    """
    return a + b
```

### Изменения:
- Добавлена документация в формате RST для описания функции.
- Добавлены аннотации типов для `a` и `b`.
- Добавлены пробелы вокруг `+` и параметров функции для улучшения читаемости.

### Оптимизированный полный код:

```python
def add_numbers(a: int, b: int) -> int:
    """
    Функция, которая складывает два числа.

    :param a: Первое число.
    :type a: int
    :param b: Второе число.
    :type b: int
    :returns: Сумма чисел `a` и `b`.
    :rtype: int
    """
    return a + b
```
```
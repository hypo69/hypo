# Модуль для сбора данных с сайта ebay.com

## Обзор

Модуль `graber.py` предназначен для сбора данных о товарах с сайта ebay.com. Он содержит класс `Graber`, который наследует функциональность от родительского класса `Graber` (Grbr). Класс `Graber` специализируется на обработке полей товаров на страницах eBay, предоставляя возможность переопределять методы обработки полей для нестандартных случаев. Также в модуле реализован механизм декораторов для выполнения предварительных действий перед запросом к веб-драйверу, например, для закрытия всплывающих окон.

## Подробнее

Этот модуль является частью системы сбора данных о товарах с различных онлайн-площадок. Он использует веб-драйвер для взаимодействия с сайтом eBay и извлечения необходимой информации. Основная задача модуля — предоставить гибкий и расширяемый способ сбора данных, учитывая особенности структуры страниц eBay.
Расположение файла в проекте: `hypotez/src/suppliers/ebay/graber.py` указывает на то, что он отвечает за сбор данных с сайта ebay, являясь частью подсистемы, отвечающей за интеграцию с поставщиками.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для сбора информации о товарах с сайта ebay.com. Он наследует функциональность от класса `Graber` (Grbr) и предоставляет возможность переопределять методы обработки полей для нестандартных случаев.

**Наследует**:

- `Graber` (из `src.suppliers.graber`): Обеспечивает базовую функциональность для сбора данных о товарах с веб-страниц.

**Атрибуты**:

- `supplier_prefix` (str): Префикс поставщика, устанавливается как `'ebay'`.
- `driver` (Driver): Экземпляр веб-драйвера для взаимодействия с сайтом eBay.
- `lang_index`: Индекс языка.

**Методы**:

- `__init__(driver: Driver, lang_index)`: Инициализирует экземпляр класса `Graber`, устанавливает префикс поставщика, вызывает конструктор родительского класса и устанавливает глобальные настройки через `Context`.

## Функции

### `close_pop_up`

```python
def close_pop_up(value: Any = None) -> Callable:
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```

**Назначение**: Функция `close_pop_up` создает декоратор, предназначенный для закрытия всплывающих окон на веб-странице перед выполнением основной логики декорируемой функции. Это полезно для предотвращения помех от всплывающих окон при сборе данных.

**Параметры**:

- `value` (Any, optional): Дополнительное значение, которое может быть использовано декоратором. По умолчанию `None`.

**Возвращает**:

- `Callable`: Декоратор, который оборачивает функцию.

**Как работает функция**:

1.  Функция `close_pop_up` принимает необязательный параметр `value`.
2.  Она определяет внутреннюю функцию `decorator`, которая принимает функцию `func` в качестве аргумента.
3.  Внутри `decorator` определяется асинхронная функция `wrapper`, которая будет выполнена вместо оригинальной функции `func`.
4.  В `wrapper` сначала происходит попытка закрытия всплывающего окна с использованием `Context.driver.execute_locator(Context.locator.close_pop_up)`.  При возникновении ошибки выполнения локатора, информация об ошибке логируется с использованием `logger.debug`.
5.  После этого вызывается оригинальная функция `func` с использованием `await func(*args, **kwargs)`.
6.  Функция `decorator` возвращает `wrapper`.
7.  Функция `close_pop_up` возвращает `decorator`.

```
Функция close_pop_up
│
└───> Функция decorator(func)
     │
     └───> Функция wrapper(*args, **kwargs)
          │
          ├───> Попытка закрытия всплывающего окна: Context.driver.execute_locator(Context.locator.close_pop_up)
          │    │
          │    └───> Если ошибка: logger.debug(f'Ошибка выполнения локатора: {ex}')
          │
          └───> Вызов оригинальной функции: await func(*args, **kwargs)
```

**Примеры**:

Пример использования декоратора `close_pop_up` для закрытия всплывающего окна перед выполнением функции сбора данных:

```python
from src.suppliers.ebay.graber import close_pop_up

@close_pop_up()
async def get_data(item_id: str) -> dict:
    """
    Функция сбора данных о товаре.
    """
    data = {'item_id': item_id}
    return data
```

### `Graber.__init__`

```python
def __init__(self, driver: Driver, lang_index):
    """Инициализация класса сбора полей товара."""
    self.supplier_prefix = 'ebay'
    super().__init__(supplier_prefix=self.supplier_prefix, driver=driver, lang_index=lang_index)
    # Устанавливаем глобальные настройки через Context

    Context.locator_for_decorator = None # <- если будет уастановлено значение - то оно выполнится в декораторе `@close_pop_up`
```

**Назначение**: Инициализирует экземпляр класса `Graber`, устанавливая префикс поставщика, вызывая конструктор родительского класса и устанавливая глобальные настройки через `Context`.

**Параметры**:

- `driver` (Driver): Экземпляр веб-драйвера для взаимодействия с сайтом eBay.
- `lang_index`: Индекс языка.

**Как работает функция**:

1.  Устанавливает атрибут `supplier_prefix` в значение `'ebay'`.
2.  Вызывает конструктор родительского класса `Graber` (Grbr) с установленным префиксом поставщика, драйвером и индексом языка.
3.  Устанавливает атрибут `Context.locator_for_decorator` в `None`. Это необходимо для сброса локатора декоратора, чтобы он не выполнялся по умолчанию, если не установлено другое значение.

```
Инициализация Graber
│
├───> Установка префикса поставщика: self.supplier_prefix = 'ebay'
│
├───> Вызов конструктора родительского класса: super().__init__(supplier_prefix=self.supplier_prefix, driver=driver, lang_index=lang_index)
│
└───> Сброс локатора декоратора: Context.locator_for_decorator = None
```

**Примеры**:

Пример создания экземпляра класса `Graber`:

```python
from src.webdriver.driver import Driver, Firefox
from src.suppliers.ebay.graber import Graber

# Создание инстанса драйвера (пример с Firefox)
driver = Driver(Firefox)

# Создание экземпляра класса Graber
graber = Graber(driver=driver, lang_index=0)
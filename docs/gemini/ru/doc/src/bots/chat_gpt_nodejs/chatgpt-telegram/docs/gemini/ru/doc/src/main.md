# Модуль `main.js`

## Обзор

Этот модуль содержит основной код бота для Telegram, использующего API OpenAI для обработки голосовых сообщений и текстовых запросов.

## Импорты

```javascript
import { Telegraf } from 'telegraf';
import { message } from 'telegraf/filters';
import { code } from 'telegraf/format';
import config from 'config';
import { ogg } from './ogg.js';
import { openai } from './openai.js';
import { removeFile } from './utils.js';
```

## Переменные

* `bot`: Экземпляр класса `Telegraf`, используемый для взаимодействия с Telegram. Создаётся с помощью токена доступа, полученного из файла конфигурации.

## Функции

### `bot.command('start', async(ctx) : { ... })`

**Описание**: Обработчик команды `/start`. Отправляет в ответ JSON-представление объекта сообщения.

**Параметры**:
- `ctx`: Объект контекста Telegram, содержащий информацию о сообщении.


### `bot.on(message('voice'), async (ctx) : { ... })`

**Описание**: Обработчик голосовых сообщений.  Обрабатывает голосовое сообщение, преобразует его в текст с помощью OpenAI, отправляет запрос в чат OpenAI и отправляет ответ пользователю.

**Параметры**:
- `ctx`: Объект контекста Telegram, содержащий информацию о сообщении.

**Возвращает**:
-  Ничего не возвращает.

**Обрабатывает исключения**:
- Возможны исключения при работе с различными API (например, OpenAI или Telegram). Ошибки логгируются, и пользователь не получит ошибку в Telegram.

### `bot.on(message('text'), async (ctx) : { ... })`

**Описание**: Обработчик текстовых сообщений. Обрабатывает текстовое сообщение и отправляет запрос в чат OpenAI.

**Параметры**:
- `ctx`: Объект контекста Telegram, содержащий информацию о сообщении.

**Возвращает**:
-  Ничего не возвращает.

**Обрабатывает исключения**:
- Возможны исключения при работе с различными API (например, OpenAI или Telegram). Ошибки логгируются, и пользователь не получит ошибку в Telegram.


## Запуск бота

```javascript
bot.launch()
process.once('SIGINT', () => bot.stop('SIGINT'))
process.once('SIGTERM', () => bot.stop('SIGTERM'))
```

Этот код запускает бота и обрабатывает сигналы завершения.

## Модули (Импорты)

* `ogg`: Модуль для преобразования голосовых файлов.
* `openai`: Модуль для работы с API OpenAI.
* `removeFile`: Модуль для удаления временных файлов.
* `config`: Модуль для чтения конфигурации из файла.
* `INITIAL_SESSION`: Не указан, вероятно, константа, инициализирующая сессию.



```
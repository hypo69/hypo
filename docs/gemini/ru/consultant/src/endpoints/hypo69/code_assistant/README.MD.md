# Анализ кода модуля `code_assistant`

**Качество кода**
7
-  Плюсы
    -   Хорошее описание функциональности модуля и отдельных скриптов.
    -   Четкое объяснение структуры проекта и рабочего процесса.
    -   Приведены примеры использования с разными параметрами.
    -   Документация охватывает основные аспекты работы модуля.
    -   Есть описание процесса добавления новых ролей для моделей ИИ.
    -   Оформление в целом соответствует формату Markdown.
-  Минусы
    -   Не хватает более подробной информации о структуре данных настроек `settings.json`.
    -   Нет четкого описания, какие именно исключения будут отловлены в процессе работы.
    -   Не указаны форматы входных и выходных данных для функций.
    -   Нет указаний на необходимость валидации входных параметров.
    -   Используются HTML теги, вместо `rst`
    -   Нет docstring у модуля
    -   Нет docstring у отдельных скриптов

**Рекомендации по улучшению**
1.  **Добавить docstring модуля**: В начале файла необходимо добавить описание модуля в формате docstring, как указано в инструкции. Это поможет в дальнейшем автоматически генерировать документацию.
2.  **Убрать HTML**: Заменить html теги на rst
3.  **Документирование скриптов**: Добавить docstring для каждого скрипта, описывая его назначение, входные параметры и результаты работы.
4.  **Описание `settings.json`**: Добавить пример структуры файла `settings.json` или указать, какие параметры он может содержать.
5.  **Уточнить исключения**: Более конкретно описать, какие исключения могут возникать в процессе работы и как они обрабатываются.
6.  **Форматы данных**: Описать форматы входных и выходных данных для функций, чтобы было понятнее, как использовать модуль.
7.  **Валидация параметров**: Указать, что входные параметры должны валидироваться, и описать, как это делается.
8.  **Примеры RST**: Преобразовать  таблицы с ссылками в  формат rst
9.  **Файл `README.md`**: Описать структуру этого файла и его назначение
10. **Примеры кода**: Добавить примеры работы с разными ролями и моделями в формате docstring

**Оптимизированный код**

```markdown
"""
Модуль `code_assistant`
=========================================================================================

Этот модуль содержит набор инструментов для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода проекта.
Он выполняет такие задачи, как создание документации, проверка кода и генерация тестов на основе указанных файлов.
Кроме того, в него входят скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бот для обработки задач, связанных с кодом.

Пример использования
--------------------

Пример использования `code_assistant.py` для генерации документации:

.. code-block:: bash

    python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2

Пример использования `make_summary.py` для создания `SUMMARY.md`:

.. code-block:: bash

    python make_summary.py --start_dir /path/to/your/project --lang ru

Пример запуска Telegram бота:

.. code-block:: bash

    python onela_bot.py

"""

.. table::
   :class: colwidths-auto

   * -
     :ref:`[Root ↑] <https://github.com/hypo69/hypo/blob/master/README.MD>`
   * -
     :ref:`src <https://github.com/hypo69/hypo/blob/master/src/README.MD>` \>
     :ref:`endpoints <https://github.com/hypo69/hypo/blob/master/src/endpoints/README.MD>` \>
     :ref:`hypo69 <https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/README.MD>`
   * -
      :ref:`Русский <https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/code_assistant/readme.ru.md>`

# Code Assistant Module

## Overview

Модуль `Code Assistant` представляет собой набор инструментов, предназначенных для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода проекта. Он выполняет такие задачи, как создание документации, проверку кода и генерацию тестов на основе указанных файлов. Кроме того, он включает скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бота для обработки задач, связанных с кодом.

## Key Features

### `code_assistant.py`
-   **Чтение файлов**: Читает код из файлов `.py` и `README.MD` в указанных директориях.
-   **Взаимодействие с моделями**: Отправляет код моделям для таких задач, как создание документации или проверка ошибок.
-   **Генерация результатов**: Сохраняет ответы моделей в выделенных директориях для каждой роли.

### `make_summary.py`
-   **Генерация `SUMMARY.md`**: Рекурсивно обходит директорию для создания файла `SUMMARY.md` для компиляции документации.
-   **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (`ru` или `en`).

### `onela_bot.py` и `bot_handlers.py`
-   **Telegram-бот**: Бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода для проверки или создания документации.
-   **Обработчики бота**: Содержит обработчики для обработки команд и сообщений бота.

## Project Structure

-   **Модели**: Использует модели **Gemini** и **OpenAI** для обработки запросов.
-   **Промпты**: Читает промпты из файлов в `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
-   **Файлы**: Обрабатывает файлы `.py` и `README.MD` в указанных директориях.

## Usage Examples

### Running with JSON Settings:
```bash
python code_assistant.py --settings settings.json
```

### Running with Explicit Parameters:
```bash
python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

### Example for Role `code_checker`:
```bash
python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
```

### Example for Model `openai`:
```bash
python code_assistant.py --role doc_writer --lang en --models openai
```

## Command-Line Parameters

-   `--settings`: Путь к файлу JSON с настройками. Загружает параметры из файла.
-   `--role`: Роль модели для задачи (например, `doc_writer`, `code_checker`).
-   `--lang`: Язык для задачи (например, `ru` или `en`).
-   `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
-   `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

## Workflow

1.  **Чтение файлов**: Поиск файлов `.py` и `README.MD` в указанных директориях.
2.  **Загрузка промптов**: Загрузка промптов, специфичных для роли, из `src/ai/prompts/developer/`.
3.  **Обработка запросов**: Формирование запросов на основе загруженных файлов и их отправка моделям.
4.  **Сохранение ответов**: Сохранение ответов моделей в директориях, соответствующих роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Exceptions

Настройте исключения для файлов и каталогов, используя параметры:
-   `exclude_file_patterns`: Список шаблонов регулярных выражений для исключения файлов.
-   `exclude_dirs`: Список каталогов для исключения.
-   `exclude_files`: Список файлов для исключения.

## Logging

Логи сохраняются с использованием библиотеки `logger` и содержат информацию об обработке файлов и ответах моделей.

## Dependencies

-   **Gemini API**: Требуется ключ API для модели Gemini.
-   **OpenAI API**: Требуется ключ API для модели OpenAI.

## Creating a New Role for AI Models

1.  **Обновите `code_assistant.json`**:
   -   Добавьте новую роль в список ролей:
     ```json
     "roles": [
       "code_checker",
       ...
     ]
     ```
   -   Или исключите ее в `"exclude-roles"`.

2.  **Добавьте роль в переводы**:
   -   Обновите файл `translations/translations.json` новой ролью.

3.  **Создайте системный промпт**:
   -   Добавьте новый системный промпт в `ai/prompts/developer/`.

4.  **Создайте инструкцию команды**:
   -   Добавьте новую инструкцию команды в `instructions/`.

---

Этот `README.md` предоставляет всесторонний обзор модуля `code_assistant`, его скриптов и способов их эффективного использования.
```
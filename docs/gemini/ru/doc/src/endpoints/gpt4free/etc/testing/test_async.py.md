# Модуль для асинхронного тестирования провайдеров g4f

## Обзор

Модуль предназначен для асинхронного тестирования различных провайдеров g4f (Generative Framework for free). Он использует `asyncio` для конкурентного выполнения запросов к провайдерам и логирует время выполнения каждого запроса.

## Подробней

Данный модуль позволяет быстро проверить работоспособность и время отклика различных провайдеров g4f. Он добавляет родительские директории в `sys.path`, чтобы обеспечить импорт необходимых модулей, и использует функции из `testing._providers` для получения списка провайдеров и `testing.log_time` для измерения времени выполнения асинхронных функций.

## Функции

### `create_async`

```python
async def create_async(provider):
    """Асинхронно создает запрос к провайдеру и выводит результат или ошибку.

    Args:
        provider: Провайдер для выполнения запроса.

    Raises:
        Exception: Если при выполнении запроса возникает исключение.
    """
```

**Назначение**: 
Асинхронно отправляет запрос к указанному провайдеру и логирует время выполнения запроса. В случае успеха выводит ответ провайдера, в случае неудачи — информацию об ошибке.

**Параметры**:
- `provider`: Провайдер, к которому будет отправлен запрос.

**Как работает функция**:

1.  Функция принимает объект `provider` в качестве аргумента.
2.  Использует конструкцию `try...except` для обработки возможных исключений при выполнении запроса.
3.  Внутри блока `try` вызывается асинхронная функция `log_time_async`, которая оборачивает вызов `provider.create_async` и измеряет время его выполнения.
4.  `provider.create_async` вызывается с аргументами `model` и `messages`, где `model` — это имя модели по умолчанию из `g4f.models`, а `messages` — список сообщений с ролью "user" и содержимым "Hello, are you GPT 3.5?".
5.  Результат выполнения запроса сохраняется в переменной `response`.
6.  Выводится строка, содержащая имя провайдера и полученный ответ.
7.  В случае возникновения исключения в блоке `try`, управление передается в блок `except`.
8.  Выводится сообщение об ошибке, включающее имя провайдера, класс исключения и текст исключения.

**ASCII flowchart**:

```
A[Начало]
|
B[Вызов log_time_async(provider.create_async, ...)]
|
C[Успешное выполнение provider.create_async] --> D[Вывод ответа]
|
E[Ошибка при выполнении provider.create_async] --> F[Вывод сообщения об ошибке]
|
G[Конец]
```

**Примеры**:

```python
# Пример вызова функции с объектом провайдера
# await create_async(SomeProvider)
```

### `run_async`

```python
async def run_async():
  """Запускает асинхронные запросы ко всем рабочим провайдерам.

    """
```

**Назначение**:
Собирает список асинхронных задач для каждого рабочего провайдера и запускает их параллельно с использованием `asyncio.gather`.

**Как работает функция**:

1.  Функция создает список `responses`, используя генератор списка.
2.  Для каждого `provider` из списка, возвращаемого функцией `get_providers()`, проверяется его атрибут `working`.
3.  Если `provider.working` истинно, то вызывается функция `create_async(provider)`, результат которой добавляется в список `responses`.
4.  После формирования списка `responses` вызывается функция `asyncio.gather(*responses)`, которая запускает все асинхронные задачи из списка `responses` параллельно.
5.  Результаты выполнения задач неявно возвращаются после завершения `asyncio.gather`.

**ASCII flowchart**:

```
A[Начало]
|
B[Получение списка провайдеров: get_providers()]
|
C[Фильтрация рабочих провайдеров: provider.working]
|
D[Создание списка асинхронных задач: create_async(provider)]
|
E[Запуск задач параллельно: asyncio.gather(*responses)]
|
F[Конец]
```

**Примеры**:

```python
# Пример вызова функции
# await run_async()
```

## Другое

### Запуск асинхронной функции `run_async` и вывод общего времени выполнения

```python
print("Total:", asyncio.run(log_time_async(run_async)))
```

**Назначение**:
Запускает асинхронную функцию `run_async` и выводит общее время ее выполнения.

**Как работает**:

1.  Функция `log_time_async` оборачивает вызов `run_async` для измерения времени выполнения.
2.  Функция `asyncio.run` запускает асинхронную функцию `log_time_async(run_async)` в основном потоке.
3.  Результат выполнения, который включает общее время выполнения, выводится в консоль.

**Примеры**:

```python
# Пример вызова
# print("Total:", asyncio.run(log_time_async(run_async)))
# Модуль unittest для тестирования логики обработки "размышлений" (thinking)

## Обзор

Модуль содержит набор тестов для проверки корректной работы класса `ThinkingProcessor`, предназначенного для обработки текстовых фрагментов, содержащих маркеры начала и конца "размышлений" (`<think>` и `</think>`). Тесты охватывают различные сценарии, включая обработку обычного текста, начала и конца "размышлений", а также непрерывный процесс "размышлений".

## Подробней

Этот модуль является частью набора тестов для библиотеки `g4f` и предназначен для проверки корректной обработки текстовых фрагментов, содержащих маркеры, указывающие на начало и конец процесса "размышлений". Он использует модуль `unittest` для определения тестовых случаев и методы `assertEqual` и `assertAlmostEqual` для сравнения ожидаемых и фактических результатов.  `ThinkingProcessor` используется для динамической обработки текста, в котором необходимо визуализировать процесс мышления ИИ. Маркеры `<think>` и `</think>` используются для определения участков текста, которые следует обрабатывать особым образом, например, отображать индикатор "размышления".

## Классы

### `TestThinkingProcessor`

**Описание**: Класс, содержащий набор тестовых методов для проверки функциональности `ThinkingProcessor`.

**Принцип работы**:
Класс `TestThinkingProcessor` наследуется от `unittest.TestCase` и содержит методы, каждый из которых тестирует определенный аспект обработки "размышлений" в текстовых фрагментах. Каждый метод создает тестовый фрагмент текста, вызывает метод `ThinkingProcessor.process_thinking_chunk` для обработки фрагмента и затем сравнивает фактический результат с ожидаемым результатом с использованием методов `assertEqual` и `assertAlmostEqual`.
- Наследуется от `unittest.TestCase`, предоставляя инструменты для написания тестов.
- Определяет несколько тестовых методов, каждый из которых проверяет определенный сценарий обработки "размышлений".
- Использует методы `assertEqual` и `assertAlmostEqual` для сравнения ожидаемых и фактических результатов.

**Методы**:

- `test_non_thinking_chunk`: Тестирует случай, когда входной фрагмент текста не содержит маркеров "размышлений".
- `test_thinking_start`: Тестирует случай, когда входной фрагмент текста содержит маркер начала "размышлений".
- `test_thinking_end`: Тестирует случай, когда входной фрагмент текста содержит маркер конца "размышлений".
- `test_thinking_start_and_end`: Тестирует случай, когда входной фрагмент текста содержит маркеры начала и конца "размышлений".
- `test_ongoing_thinking`: Тестирует случай, когда процесс "размышлений" продолжается.
- `test_chunk_with_text_after_think`: Тестирует случай, когда входной фрагмент текста содержит текст после маркера конца "размышлений".

## Функции

### `test_non_thinking_chunk`

```python
def test_non_thinking_chunk(self):
    """
    Тестирует случай, когда входной фрагмент текста не содержит маркеров "размышлений".

    Args:
        self: Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    Raises:
        AssertionError: Если фактический результат не соответствует ожидаемому.

    """
```

**Как работает функция**:

1.  **Определение тестовых данных**:
    *   Определяется входной фрагмент текста `chunk`, не содержащий маркеров "размышлений".
    *   Определяется ожидаемое время `expected_time` (0) и ожидаемый результат `expected_result` (список, содержащий исходный фрагмент текста).

2.  **Вызов тестируемой функции**:
    *   Вызывается метод `ThinkingProcessor.process_thinking_chunk` с входным фрагментом текста.

3.  **Проверка результатов**:
    *   Сравнивается фактическое время `actual_time` с ожидаемым временем `expected_time` с использованием метода `assertEqual`.
    *   Сравнивается фактический результат `actual_result` с ожидаемым результатом `expected_result` с использованием метода `assertEqual`.

**Примеры**:

```python
test_non_thinking_chunk(self)
```

### `test_thinking_start`

```python
def test_thinking_start(self):
    """
    Тестирует случай, когда входной фрагмент текста содержит маркер начала "размышлений".

    Args:
        self: Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    Raises:
        AssertionError: Если фактический результат не соответствует ожидаемому.
    """
```

**Как работает функция**:

1.  **Определение тестовых данных**:
    *   Определяется входной фрагмент текста `chunk`, содержащий маркер начала "размышлений" (`<think>`).
    *   Определяется ожидаемое время `expected_time` (текущее время).
    *   Определяется ожидаемый результат `expected_result` (список, содержащий текст до маркера, объект `Reasoning` с информацией о начале "размышлений" и текст после маркера).

2.  **Вызов тестируемой функции**:
    *   Вызывается метод `ThinkingProcessor.process_thinking_chunk` с входным фрагментом текста.

3.  **Проверка результатов**:
    *   Сравнивается фактическое время `actual_time` с ожидаемым временем `expected_time` с использованием метода `assertAlmostEqual` (допускается небольшая погрешность).
    *   Сравниваются элементы фактического результата `actual_result` с соответствующими элементами ожидаемого результата `expected_result` с использованием метода `assertEqual`.

**Примеры**:

```python
test_thinking_start(self)
```

### `test_thinking_end`

```python
def test_thinking_end(self):
    """
    Тестирует случай, когда входной фрагмент текста содержит маркер конца "размышлений".

    Args:
        self: Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    Raises:
        AssertionError: Если фактический результат не соответствует ожидаемому.
    """
```

**Как работает функция**:

1.  **Определение тестовых данных**:
    *   Определяется начальное время `start_time` (текущее время).
    *   Определяется входной фрагмент текста `chunk`, содержащий маркер конца "размышлений" (`</think>`).
    *   Определяется ожидаемый результат `expected_result` (список, содержащий текст до маркера, объект `Reasoning` с информацией об окончании "размышлений" и текст после маркера).

2.  **Вызов тестируемой функции**:
    *   Вызывается метод `ThinkingProcessor.process_thinking_chunk` с входным фрагментом текста и начальным временем `start_time`.

3.  **Проверка результатов**:
    *   Сравнивается фактическое время `actual_time` с ожидаемым временем (0) с использованием метода `assertEqual`.
    *   Сравниваются элементы фактического результата `actual_result` с соответствующими элементами ожидаемого результата `expected_result` с использованием метода `assertEqual`.

**Примеры**:

```python
test_thinking_end(self)
```

### `test_thinking_start_and_end`

```python
def test_thinking_start_and_end(self):
    """
    Тестирует случай, когда входной фрагмент текста содержит маркеры начала и конца "размышлений".

    Args:
        self: Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    Raises:
        AssertionError: Если фактический результат не соответствует ожидаемому.
    """
```

**Как работает функция**:

1.  **Определение тестовых данных**:
    *   Определяется начальное время `start_time` (текущее время).
    *   Определяется входной фрагмент текста `chunk`, содержащий маркеры начала и конца "размышлений" (`<think>` и `</think>`).
    *   Определяется ожидаемый результат `expected_result` (список, содержащий объект `Reasoning` с информацией о начале "размышлений", текст между маркерами, объект `Reasoning` с информацией об окончании "размышлений" и текст после маркера).

2.  **Вызов тестируемой функции**:
    *   Вызывается метод `ThinkingProcessor.process_thinking_chunk` с входным фрагментом текста и начальным временем `start_time`.

3.  **Проверка результатов**:
    *   Сравнивается фактическое время `actual_time` с ожидаемым временем (0) с использованием метода `assertEqual`.
    *   Сравниваются элементы фактического результата `actual_result` с соответствующими элементами ожидаемого результата `expected_result` с использованием метода `assertEqual`.

**Примеры**:

```python
test_thinking_start_and_end(self)
```

### `test_ongoing_thinking`

```python
def test_ongoing_thinking(self):
    """
    Тестирует случай, когда процесс "размышлений" продолжается.

    Args:
        self: Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    Raises:
        AssertionError: Если фактический результат не соответствует ожидаемому.
    """
```

**Как работает функция**:

1.  **Определение тестовых данных**:
    *   Определяется начальное время `start_time` (текущее время).
    *   Определяется входной фрагмент текста `chunk`, представляющий собой продолжающийся процесс "размышлений".
    *   Определяется ожидаемый результат `expected_result` (список, содержащий объект `Reasoning` с текстом "размышлений").

2.  **Вызов тестируемой функции**:
    *   Вызывается метод `ThinkingProcessor.process_thinking_chunk` с входным фрагментом текста и начальным временем `start_time`.

3.  **Проверка результатов**:
    *   Сравнивается фактическое время `actual_time` с начальным временем `start_time` с использованием метода `assertEqual`.
    *   Сравнивается фактический результат `actual_result` с ожидаемым результатом `expected_result` с использованием метода `assertEqual`.

**Примеры**:

```python
test_ongoing_thinking(self)
```

### `test_chunk_with_text_after_think`

```python
def test_chunk_with_text_after_think(self):
    """
    Тестирует случай, когда входной фрагмент текста содержит текст после маркера конца "размышлений".

    Args:
        self: Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    Raises:
        AssertionError: Если фактический результат не соответствует ожидаемому.
    """
```

**Как работает функция**:

1.  **Определение тестовых данных**:
    *   Определяется входной фрагмент текста `chunk`, содержащий текст до маркера начала "размышлений", текст между маркерами и текст после маркера конца "размышлений".
    *   Определяется ожидаемое время `expected_time` (0).
    *   Определяется ожидаемый результат `expected_result` (список, содержащий текст до маркера, объект `Reasoning` с информацией о начале "размышлений", текст между маркерами, объект `Reasoning` с информацией об окончании "размышлений" и текст после маркера).

2.  **Вызов тестируемой функции**:
    *   Вызывается метод `ThinkingProcessor.process_thinking_chunk` с входным фрагментом текста.

3.  **Проверка результатов**:
    *   Сравнивается фактическое время `actual_time` с ожидаемым временем `expected_time` с использованием метода `assertEqual`.
    *   Сравнивается фактический результат `actual_result` с ожидаемым результатом `expected_result` с использованием метода `assertEqual`.

**Примеры**:

```python
test_chunk_with_text_after_think(self)
```
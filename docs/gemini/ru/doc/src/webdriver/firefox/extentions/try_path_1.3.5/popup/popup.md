# Модуль popup.js

## Обзор

Этот JavaScript-модуль реализует функциональность всплывающего окна расширения Firefox для работы с XPath-выражениями. Модуль обрабатывает пользовательский ввод, отправляет запросы на выполнение XPath-выражений в активной вкладке, получает результаты и отображает их в всплывающем окне.  Также он управляет состоянием всплывающего окна, сохраняет и восстанавливает его состояние при закрытии/открытии.

## Переменные

### `noneClass`

**Описание**: Строковое значение класса, применяемое для скрытия элементов.

### `helpClass`

**Описание**: Строковое значение класса, связанного с элементами справки.

### `invalidTabId`, `invalidExecutionId`, `invalidFrameId`

**Описание**: Значения, используемые для обозначения отсутствия или некорректности идентификаторов вкладки, выполнения и фрейма соответственно.

### `mainWay`, `mainExpression`, `contextCheckbox`, `contextHeader`, и т.д.

**Описание**: Переменные, представляющие DOM-элементы, используемые для ввода данных пользователем (XPath-выражения, флажки, списки).


### `relatedTabId`, `relatedFrameId`, `executionId`

**Описание**: Переменные, хранящие идентификатор активной вкладки, фрейма и ID выполнения для последующей отправки запросов в конкретные места и обработке ответов.

### `resultedDetails`, `detailsPageSize`, `detailsPageIndex`

**Описание**: Переменные для хранения результатов выполнения XPath-выражения, размера страницы результатов и номера текущей страницы.


## Функции

### `sendToActiveTab`

**Описание**: Отправляет сообщение в активную вкладку.

**Параметры**:
- `msg` (object): Сообщение для отправки.
- `opts` (object, optional): Дополнительные опции. По умолчанию пустой объект.

**Возвращает**:
- `Promise`: Результат выполнения отправки сообщения.

### `sendToSpecifiedFrame`

**Описание**: Отправляет сообщение в указанный фрейм.

**Параметры**:
- `msg` (object): Сообщение для отправки.

**Возвращает**:
- `Promise`: Результат выполнения.

**Обрабатывает исключения**:
- `e`: Общий обработчик ошибок при взаимодействии с браузером.


### `collectPopupState`

**Описание**: Собрать состояние всплывающего окна.

**Возвращает**:
- `object`: Объект, содержащий состояние всплывающего окна.


### `changeContextVisible`, `changeResolverVisible`, `changeFrameIdVisible`, `changeFrameDesignationVisible`, `changeHelpVisible`

**Описание**: Функции для изменения видимости соответствующих блоков в интерфейсе всплывающего окна в зависимости от состояния флагов (чекбоксов).

**Параметры**:
- Не принимают параметры.


### `makeExecuteMessage`

**Описание**: Создает сообщение для выполнения XPath-выражения.

**Возвращает**:
- `object`: Объект с данными для выполнения.


### `getSpecifiedFrameId`

**Описание**: Возвращает ID указанного фрейма.

**Возвращает**:
- `number`: ID фрейма.


### `execContentScript`

**Описание**: Выполняет скрипты в контексте содержимого страницы.

**Возвращает**:
- `Promise`: Результат выполнения скриптов.



### `sendExecute`

**Описание**: Отправляет запрос на выполнение XPath-выражений в активной вкладке.

**Параметры**:
- Не принимает параметры.


### `handleExprEnter`

**Описание**: Обработчик события ввода "Enter" в поле ввода XPath-выражения.

**Параметры**:
- `event` (object): Объект события.


### `showDetailsPage`

**Описание**: Отображает страницу результатов.

**Параметры**:
- `index` (number): Индекс страницы.

**Обрабатывает исключения**:
- `fu.onError`: Общий обработчик ошибок.


### `showError`

**Описание**: Отображает сообщение об ошибке.

**Параметры**:
- `message` (string): Сообщение об ошибке.
- `frameId` (number): ID фрейма.

**Обрабатывает исключения**:
- `fu.onError`: Общий обработчик ошибок.



### `genericListener`

**Описание**: Универсальный обработчик сообщений из контента страницы.

**Параметры**:
- `message` (object): Сообщение.
- `sender` (object): Отправитель сообщения.
- `sendResponse` (function): Функция для отправки ответа.

**Обрабатывает исключения**:
- `listener`: Попытка обратиться к несуществующему обработчику событий.


##  Обработчики событий (listeners)

### `showResultsInPopup`

**Описание**: Обрабатывает получение результатов выполнения XPath в всплывающем окне.


### `restorePopupState`

**Описание**: Восстанавливает состояние всплывающего окна.



### `insertStyleToPopup`

**Описание**: Вставляет CSS стиль в всплывающее окно.


### `addFrameId`

**Описание**: Добавляет элемент списка для выбора фрейма.


## События загрузки

**Описание**: Блок кода, выполняющийся при загрузке страницы всплывающего окна. Устанавливает обработчики событий для элементов интерфейса и инициализирует взаимодействие с другими частями расширения.
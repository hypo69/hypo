# Анализ кода модуля doc_writer_rst_ru.md

**Качество кода**
8
- Плюсы
    - Четкие и подробные инструкции по созданию документации в формате RST.
    - Указаны все необходимые элементы документации, такие как описания модулей, классов, методов, функций, комментарии и исключения.
    - Приведены примеры оформления для каждого элемента документации.
    - Требования к комментариям в коде.

- Минусы
    - Нет информации об импортах в коде, что может привести к пропуску необходимых зависимостей.
    - Не всегда есть конкретные примеры использования, особенно для классов.
    - Нет указаний на использование логгера.
    - Описание исключений не всегда полное.

**Рекомендации по улучшению**

1.  **Импорты**: Укажите важность анализа и добавления отсутствующих импортов.
2.  **Логирование**: Добавьте инструкцию по использованию логгера из `src.logger.logger`.
3.  **Примеры**: Расширьте примеры использования, особенно для классов, и добавьте конкретные сценарии.
4.  **Исключения**: Уточните описание исключений, указав конкретные типы и условия их возникновения.
5.  **Комментарии**: Четко определите формат комментариев в коде, чтобы они соответствовали стандартам RST и были информативными.
6. **Проверка кода**:  Добавить проверку на соответствие `\'` и `\"`.

**Оптимизированный код**

```markdown
Анализ кода модуля `doc_writer_rst_ru.md`
=========================================================================================

Модуль предоставляет инструкции для технического писателя по созданию документации для проекта `hypotez` в формате `rst` (reStructuredText) на русском языке.

**Качество кода**
8
    - Плюсы:
        - Четкие и подробные инструкции по созданию документации в формате RST.
        - Указаны все необходимые элементы документации, такие как описания модулей, классов, методов, функций, комментарии и исключения.
        - Приведены примеры оформления для каждого элемента документации.
        - Требования к комментариям в коде.
    - Минусы:
        - Нет информации об импортах в коде, что может привести к пропуску необходимых зависимостей.
        - Не всегда есть конкретные примеры использования, особенно для классов.
        - Нет указаний на использование логгера.
        - Описание исключений не всегда полное.
        
**Рекомендации по улучшению**
    1. **Импорты**: Указать важность анализа и добавления отсутствующих импортов.
    2. **Логирование**: Добавить инструкцию по использованию логгера из `src.logger.logger`.
    3. **Примеры**: Расширить примеры использования, особенно для классов, и добавить конкретные сценарии.
    4. **Исключения**: Уточнить описание исключений, указав конкретные типы и условия их возникновения.
    5.  **Комментарии**: Четко определить формат комментариев в коде, чтобы они соответствовали стандартам RST и были информативными.
    6. **Проверка кода**:  Добавить проверку на соответствие `\'` и `\"`.

**Инструкция**
=========================================================================================

## Основные требования:

## Output Language: RU (Русский)

1. **Формат документации**:
   - Всегда используйте одинарные кавычки (`'`) в Python коде. Например: `a = 'A1'`; `['a','b',..]`; `{'a':q,'b':'c'}`
   
   Двойные только в операциях вывода. Например `print("Hello, world!")`; `input("Name")`; `logger.error("Error")`

2. **Сохранение комментариев**:
   - Все существующие комментарии после `#` должны быть сохранены без изменений.
   - Блоки кода, которые необходимо изменить, должны быть прокомментированы построчно с использованием символа `#`.

3. **Обработка данных**:
   - Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load` для чтения файлов.
   - Оставляйте любые `...` в коде без изменений как точки остановки.
   - `logger` всегда импортируется из `sr.logger`. Example `from src.logger import logger`

4. **Анализ структуры**:
   - Проверьте и добавьте отсутствующие импорты в код.
   - Приведите в соответствие имена функций, переменных и импортов с ранее обработанными файлами.

5. **Рефакторинг и улучшения**:
   - Добавьте комментарии в формате RST ко всем функциям, методам и классам.
   - Используйте `from src.logger.logger import logger` для логирования ошибок.
   - Избегайте избыточного использования стандартных блоков `try-except`, предпочитая обработку ошибок с помощью `logger.error`.
   - В комментариях избегайте слов 'получаем', 'делаем' и подобных. Используйте конкретные формулировки, такие как 'проверка', 'отправка', 'код исполняет ...'.

7. **Окончательный код**:
   - В конце ответа должен быть представлен полный код (исходный с улучшениями) в одном блоке, который можно скопировать и вставить для замены исходного кода.
   - Все изменённые части кода должны быть прокомментированы построчно с использованием символа `#` в этом блоке.

8. **Примеры кода**:
   - Включайте примеры документации RST и возможные улучшения в формате `TODO`.

9. **Дополнительная инструкция**:
    - Описание модуля в начале файла.
    - Документацию для каждой функции, метода и переменной.
    - Соблюдение стандартов оформления docstring в Python (для Sphinx).
    - В комментариях после `#` строки должны содержать подробное объяснение следующего за ними блока кода.

    Пример формата документации для модуля:

    ```python
    """
    Модуль для работы ассистента программиста
    =========================================================================================

    Этот модуль содержит класс :class:`CodeAssistant`, который используется для работы с различными моделями ИИ,
    такими как Google Gemini и OpenAI, для выполнения задач по обработке кода.

    Пример использования
    --------------------

    Пример использования класса `CodeAssistant`:

    .. code-block:: python

        assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
        assistant.process_files()
    """
    ```

    Пример формата документации для функций:
       Пример 1.
    ```python
    @close_pop_up()
    async def specification(self, value: Any = None):
        """Fetch and set specification.

        Args:
            value (Any): это значение можно передать в словаре kwargs через ключ {specification = `value`} при определении класса.
            Если `value` был передан, его значение подставляется в поле `ProductFields.specification`.
        """
        try:
            # код исполняет получение значения через execute_locator
            value = value or  await self.driver.execute_locator(self.locator.specification) or ''
        except Exception as ex:
            logger.error('Ошибка получения значения в поле `specification`', ex)
            ...
            return

        # Проверка валидности результата
        if not value:
            logger.debug(f'Невалидный результат {value=}\\nлокатор {self.locator.specification}')
            ...
            return

        # Если значение - список, код преобразовывает его в строку с разделителем `\\n`
        if isinstance(value, list):
            value = '\\n'.join(map(str, value))

        # Код записывает результат в поле `specification` объекта `ProductFields`
        self.fields.specification = value
        return True

    ```
    Пример 2.
    ```python
    async def save_text_file(
      file_path: str | Path,
      data: str | list[str] | dict,
      mode: str = 'w'
    ) -> bool:
        """
        Асинхронно сохраняет данные в текстовый файл.

        Args:
            file_path (str | Path): Путь к файлу для сохранения.
            data (str | list[str] | dict): Данные для записи.
            mode (str, optional): Режим записи файла ('w' для записи, 'a' для добавления).
        Returns:
            bool: True, если файл успешно сохранен, False в противном случае.
        Raises:
            Exception: При возникновении ошибки при записи в файл.

        Example:
            >>> from pathlib import Path
            >>> file_path = Path('example.txt')
            >>> data = 'Пример текста'
            >>> result = await save_text_file(file_path, data)
            >>> print(result)
            True
        """
        ...
        rest of code
    ```

## Порядок блоков в ответе:
Структура ответа должна быть такой:

**Заголовок**
    Анализ кода модуля <имя модуля>

**Качество кода**
<Соответветвие требованиям по оформлению кода от 1 до 10>
 -  Плюсы
        <положительные качества кода>
 -  Минусы
    <отрицательные моменты>
**Рекомендации по улучшению**
**Оптимизиробанный код**
   - Код должен быть обрамлён в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).

## Ответ не должен начинаться с ` ``` `. Используйте их только для оборачивания блоков кода.

## Ты даешь ответы на русском языке
## Формат ответа `.md` (markdown)
----------------------------
** КОНЕЦ ИНСТРУКЦИИ **
```
```markdown
**Оптимизированный код**
```
```
** PROMPT **

Ты технический писатель, который создает документацию для проекта `hypotez`
Ты  должны документировать код в следующем стиле.
- Формат твоего ответа - `rst` Restructured Text (ReST or reStructuredText)
- Язык ответа - Русский (RU)
- Все комментарии в коде, включая описания модулей, классов и функций, 
должны быть написаны в формате `RST`. 
- Создавай как можно более полную документацию для каждого класса, функции или метода.
-  анализируй импорты.

1. **Модуль**:
    - Описание модуля должно быть оформлено в заголовке, с указанием его назначения.
    - Укажи примеры использования модуля, если это возможно. Пример кода должен быть оформлен в блоке `.. code-block:: python`.
    - Укажи платформы и синопсис модуля.
    - Для описания функций и методов модуля используй заголовки для атрибутов и методов, если это необходимо.

Пример оформления для модуля:
```
Модуль для работы ассистента программиста
=========================================================================================

Этот модуль содержит класс :class:`CodeAssistant`, который используется для работы с различными моделями ИИ, 
такими как Google Gemini и OpenAI, для выполнения задач по обработке кода.

Пример использования
--------------------

Пример использования класса `CodeAssistant`:

.. code-block:: python

    assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
    assistant.process_files()
```

2. **Классы**:
    - Каждый класс должен быть оформлен в соответствии с его назначением. Указывай описание класса, его атрибуты и методы.
    - В разделе классов укажи все методы и их назначение, а также примеры использования.
    - Для каждого метода используйте описание его параметров и возвращаемых значений, а также примеры использования.

Пример оформления для класса:
```
Класс для работы с ассистентом программиста
=========================================================================================

Класс :class:`CodeAssistant` используется для взаимодействия с различными моделями ИИ, такими как Google Gemini, 
и предоставляет методы для анализа и создания документации для кода.

Атрибуты:
----------
- `role`: Роль ассистента (например, 'code_checker').
- `lang`: Язык, на котором будет работать ассистент (например, 'ru').
- `model`: Список используемых моделей ИИ (например, ['gemini']).

Методы:
--------
- `process_files`: Метод для обработки файлов с кодом.

Пример использования:
---------------------

.. code-block:: python

    assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
    assistant.process_files()
```

3. **Функции и методы**:
    - Оформи описание каждой функции или метода, указывая параметры и возвращаемые значения.
    - Для каждой функции добавь описание её назначения и примеры использования в формате `.. code-block:: python`.

Пример оформления для метода:
```
Метод для обработки файлов
=========================================================================================

Этот метод используется для анализа и обработки файлов с кодом.

Параметры:
-----------
- `files`: Список файлов для обработки.
- `options`: Дополнительные параметры, которые могут быть использованы для настройки обработки.

Возвращаемое значение:
----------------------
- Возвращает результат обработки в виде списка анализируемых данных.

Пример использования:
---------------------

.. code-block:: python

    assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
    result = assistant.process_files(files=['file1.py', 'file2.py'], options={})
```

4. **Комментарии в коде**:
    - Все комментарии в коде должны быть оформлены в формате RST, и они должны объяснять, что делает конкретная часть кода.
    - Оставляй комментарии в блоках, а не в строках. Используй комментарии для описания логики, а также для объяснения решений или временных решений в коде.
    - Пример:
    ```
    # Здесь происходит обработка исключений, чтобы продолжить выполнение, если файл не найден
    try:
        process_file(file)
    except FileNotFoundError as ex:
        handle_exception(ex)
    ```

5. **Исключения**:
    - Оформляй описание исключений для классов, методов и функций.
    - Указывай, какие исключения могут быть подняты, и при каких обстоятельствах.

Пример описания исключений:
```
Исключение при отсутствии файла
=========================================================================================

Это исключение возникает, когда файл не найден в процессе обработки.

Параметры:
-----------
- `file`: Путь к файлу, который не был найден.

Пример использования:
---------------------

.. code-block:: python

    try:
        open(file)
    except FileNotFoundError as ex:
        raise FileNotFoundError("Файл не найден") from ex
```

Придерживайся этих инструкций для создания документации по коду. 
Все комментарии должны быть четкими, информативными и соответствовать стандарту RST.
```
# Модуль main.py для Desktop Assistant

## Обзор

Модуль `main.py` является основным файлом для запуска Desktop Assistant, использующего FastAPI. Он содержит определения API-эндпоинтов для взаимодействия с пользователем, включая отображение интерфейса и обработку чата через Google Gemini. Модуль также обеспечивает поддержку локализации через JSON-файлы.

## Подробней

Этот модуль предназначен для создания Desktop Assistant, который может общаться с пользователем через API. Desktop Assistant использует FastAPI для обработки HTTP-запросов и Google Gemini для генерации ответов на сообщения пользователя. Модуль также содержит функции для загрузки и обработки файлов локализации, что позволяет адаптировать интерфейс к различным языкам.

## Классы

### `ChatRequest`

**Описание**: Pydantic модель для запроса чата.

**Как работает класс**: Класс `ChatRequest` используется для определения структуры запроса, который ожидает API-эндпоинт `/api/chat`. Он содержит поле `message`, которое представляет собой сообщение пользователя.

**Параметры**:
- `message` (str): Сообщение пользователя.

## Функции

### `root`

```python
@app.get("/", response_class=HTMLResponse)
async def root():
    ...
```

**Описание**: Обрабатывает корневой URL ("/"), возвращая HTML-страницу.

**Как работает функция**: Функция пытается прочитать содержимое файла `index.html` из каталога `templates`. Если файл не найден, возвращается HTTP-исключение с кодом 500. В случае успеха возвращается HTML-контент.

**Вызывает исключения**:
- `HTTPException`: Если не удается найти или прочитать файл `index.html`.

**Примеры**:
```python
# Пример вызова
# В браузере: GET http://127.0.0.1:8000/
```

### `chat`

```python
@app.post("/api/chat")
async def chat(request: ChatRequest):
    ...
```

**Описание**: Обрабатывает POST-запросы к эндпоинту "/api/chat", взаимодействуя с моделью Google Gemini для генерации ответа на сообщение пользователя.

**Как работает функция**: Функция принимает объект `ChatRequest`, содержащий сообщение пользователя. Если модель Google Gemini еще не инициализирована, она инициализируется с использованием ключа API. Затем сообщение пользователя отправляется в модель Gemini для получения ответа, который возвращается в формате JSON.

**Параметры**:
- `request` (ChatRequest): Объект `ChatRequest`, содержащий сообщение пользователя.

**Возвращает**:
- `dict`: JSON-ответ, содержащий сгенерированный ответ от модели Gemini.

**Вызывает исключения**:
- `HTTPException`: Если происходит ошибка при взаимодействии с моделью Gemini.

**Примеры**:
```python
# Пример вызова (необходим клиент HTTP, например, curl или Postman)
# POST http://127.0.0.1:8000/api/chat
# Body: {"message": "Hello, Gemini!"}
```

### `get_locale_file`

```python
def get_locale_file(lang: str):
    ...
```

**Описание**: Загружает файл локализации для указанного языка.

**Как работает функция**: Функция пытается открыть и прочитать JSON-файл локализации для указанного языка из каталога `locales_path`. Если файл не найден или содержит некорректный JSON, возвращается HTTP-исключение.

**Параметры**:
- `lang` (str): Код языка (например, "en", "ru").

**Возвращает**:
- `dict`: Словарь, содержащий данные локализации из JSON-файла.

**Вызывает исключения**:
- `HTTPException`: Если файл локализации не найден или содержит некорректный JSON.

**Примеры**:
```python
# Пример вызова
# get_locale_file("ru")
```

### `locales`

```python
@app.get("/locales/{lang}.json")
async def locales(lang:str):
    ...
```

**Описание**: API-эндпоинт для получения файла локализации для указанного языка.

**Как работает функция**: Функция вызывает функцию `get_locale_file` с указанным языком и возвращает результат.

**Параметры**:
- `lang` (str): Код языка (например, "en", "ru").

**Возвращает**:
- `dict`: JSON-ответ, содержащий данные локализации для указанного языка.

**Вызывает исключения**:
- `HTTPException`: Если файл локализации не найден или содержит некорректный JSON.

**Примеры**:
```python
# Пример вызова
# В браузере: GET http://127.0.0.1:8000/locales/ru.json
# Модуль `Aichat.py`

## Обзор

Модуль `Aichat.py` предоставляет асинхронтный интерфейс для взаимодействия с моделью Aichat, размещенной на платформе chat-gpt.org. Он использует библиотеку `requests` для выполнения HTTP-запросов и предназначен для интеграции с другими компонентами, требующими асинхронного взаимодействия с этой моделью.

## Подробнее

Модуль определяет класс `Aichat`, который наследуется от `AsyncProvider` и реализует метод `create_async` для отправки запросов к модели Aichat и получения ответов. Он также обрабатывает установку и использование cookies для аутентификации на платформе.

## Классы

### `Aichat`

**Описание**: Класс `Aichat` предоставляет функциональность для взаимодействия с моделью Aichat через асинхронные запросы.

**Наследует**:

- `AsyncProvider`: Обеспечивает базовую асинхронную структуру провайдера.

**Атрибуты**:

- `url` (str): URL-адрес для взаимодействия с Aichat (`https://chat-gpt.org/chat`).
- `working` (bool): Указывает, работает ли провайдер в данный момент (по умолчанию `False`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo` (установлено в `True`).

**Методы**:

- `create_async(model: str, messages: Messages, proxy: str = None, **kwargs) -> str`: Асинхронно отправляет запрос к модели Aichat и возвращает результат.

## Функции

### `create_async`

```python
async def create_async(
    model: str,
    messages: Messages,
    proxy: str = None, **kwargs) -> str:
    """
    Асинхронно отправляет запрос к модели Aichat и возвращает результат.

    Args:
        model (str): Название модели, которую требуется использовать.
        messages (Messages): Список сообщений для отправки в запросе.
        proxy (str, optional): Прокси-сервер для использования при отправке запроса. По умолчанию `None`.
        **kwargs: Дополнительные аргументы для настройки запроса, такие как `cookies`, `temperature`, `top_p`.

    Returns:
        str: Текстовый ответ от модели Aichat.

    Raises:
        RuntimeError: Если не удалось получить cookies для аутентификации.
        Exception: Если получен ошибочный ответ от сервера.

    """
    ...
```

**Назначение**: Функция `create_async` отправляет асинхронный запрос к API Aichat и возвращает полученный ответ. Она отвечает за установку необходимых заголовков, обработку cookies, формирование тела запроса и обработку возможных ошибок.

**Параметры**:

- `model` (str): Имя используемой модели.
- `messages` (Messages): Список сообщений, отправляемых в запросе.
- `proxy` (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
- `kwargs` (dict): Дополнительные параметры, такие как cookies, температура и вероятность выбора наиболее вероятного токена (`top_p`).

**Возвращает**:

- `str`: Ответ от API в виде строки.

**Вызывает исключения**:

- `RuntimeError`: Если не удалось получить cookies.
- `Exception`: Если ответ от API содержит ошибку.

**Как работает функция**:

1.  **Получение Cookies**:
    - Сначала функция пытается получить cookies, либо используя переданные через `kwargs`, либо запрашивая их с `chat-gpt.org` через функцию `get_cookies`.
    - Если cookies не получены, вызывается исключение `RuntimeError`.
2.  **Формирование HTTP-заголовков**:
    - Функция устанавливает необходимые HTTP-заголовки, включая `authority`, `accept`, `content-type`, `origin`, `referer`, `sec-ch-ua`, `user-agent` и другие.
3.  **Создание асинхронной сессии**:
    - Создается асинхронная сессия с использованием `StreamSession` из библиотеки `requests`.
    - Устанавливаются параметры сессии, такие как заголовки, cookies, таймаут, прокси и параметры безопасности.
4.  **Формирование JSON-данных**:
    - Подготавливается JSON-данные для отправки в запросе, включая отформатированное сообщение, температуру и `top_p`.
5.  **Отправка POST-запроса**:
    - Отправляется POST-запрос к API (`https://chat-gpt.org/api/text`) с использованием созданной сессии и JSON-данных.
6.  **Обработка ответа**:
    - Проверяется статус ответа. В случае ошибки вызывается исключение `Exception`.
    - Извлекается текстовое сообщение из JSON-ответа и возвращается.

**Внутренние функции**: Отсутствуют.

**ASCII flowchart**:

```
    Получение Cookies
    │
    ├───> Формирование HTTP-заголовков
    │
    ├───> Создание асинхронной сессии
    │
    ├───> Формирование JSON-данных
    │
    ├───> Отправка POST-запроса
    │
    └───> Обработка ответа
          │
          └───> Возврат ответа
```

**Примеры**:

```python
# Пример вызова функции create_async с минимальным набором параметров
response = await Aichat.create_async(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}])
print(response)

# Пример вызова функции create_async с указанием прокси-сервера
response = await Aichat.create_async(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}], proxy="http://proxy.example.com")
print(response)

# Пример вызова функции create_async с указанием cookies и температуры
cookies = {"cookie_name": "cookie_value"}
response = await Aichat.create_async(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}], cookies=cookies, temperature=0.7)
print(response)
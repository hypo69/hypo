# Модуль для работы с базой данных

## Обзор

Модуль `database.py` содержит базовые классы и настройки для взаимодействия с базой данных, используя SQLAlchemy. Он включает в себя создание асинхронного движка, сессии и базового класса для моделей, обеспечивая стандартное поведение, такое как автоматическое добавление полей `id`, `created_at` и `updated_at`.

## Подробней

Этот модуль предоставляет основу для работы с базой данных в асинхронном режиме. Он определяет базовый класс `Base`, от которого наследуются все остальные модели, а также создает асинхронный движок и фабрику сессий для взаимодействия с базой данных.
Расположение файла в проекте `hypotez/src/endpoints/bots/telegram/digital_market/bot/dao/database.py` указывает на то, что он используется для управления данными, связанными с телеграм-ботом в цифровом рынке.

## Классы

### `Base`

**Описание**:
Базовый класс для всех моделей базы данных. Предоставляет общие поля, такие как `id`, `created_at` и `updated_at`, а также метод `to_dict` для преобразования объекта в словарь.

**Как работает класс**:
Класс `Base` наследуется от `AsyncAttrs` и `DeclarativeBase` из SQLAlchemy. Он определяет абстрактный класс, который не создает отдельную таблицу в базе данных. Класс автоматически добавляет поля `id`, `created_at` и `updated_at` ко всем моделям, которые от него наследуются. Также класс предоставляет метод `to_dict` для преобразования объекта модели в словарь.

**Методы**:
- `to_dict`: Преобразует объект модели в словарь.

#### `to_dict`

```python
def to_dict(self) -> dict:
    """
    Метод для преобразования объекта в словарь
    Args:
        self: Объект класса.

    Returns:
        dict: Словарь, содержащий атрибуты объекта.
    """
    ...
```

**Назначение**:
Преобразует объект модели в словарь, где ключами являются имена столбцов таблицы, а значениями - соответствующие значения атрибутов объекта.

**Как работает функция**:

1.  Функция `to_dict` итерируется по всем столбцам таблицы, связанной с текущим объектом.
2.  Для каждого столбца она получает имя столбца (`c.name`) и значение соответствующего атрибута объекта (`getattr(self, c.name)`).
3.  Создается словарь, в котором ключами являются имена столбцов, а значениями - значения атрибутов объекта.

**Параметры**:

*   `self`: Ссылка на экземпляр класса.

**Возвращает**:

*   `dict`: Словарь, представляющий объект.

### `__tablename__`

```python
@classmethod
@property
def __tablename__(cls) -> str:
    """
    Args:
        cls: Объект класса.

    Returns:
        str: Наименование таблицы
    """
    ...
```

**Назначение**:
Определяет имя таблицы в базе данных на основе имени класса. Имя таблицы формируется путем приведения имени класса к нижнему регистру и добавления суффикса 's'.

**Как работает функция**:

1.  Метод `__tablename__` использует декораторы `@classmethod` и `@property`.
2.  Он принимает класс `cls` в качестве аргумента.
3.  Возвращает имя таблицы, сформированное из имени класса, приведенного к нижнему регистру, с добавлением суффикса 's'.

**Параметры**:

*   `cls`: Ссылка на класс.

**Возвращает**:

*   `str`: Имя таблицы в базе данных.

## Переменные

### `engine`

```python
engine = create_async_engine(url=database_url)
```

**Описание**:
Асинхронный движок SQLAlchemy для подключения к базе данных.

**Назначение**:
Используется для взаимодействия с базой данных в асинхронном режиме.

### `async_session_maker`

```python
async_session_maker = async_sessionmaker(engine, class_=AsyncSession)
```

**Описание**:
Фабрика асинхронных сессий SQLAlchemy.

**Назначение**:
Используется для создания асинхронных сессий для выполнения операций с базой данных.
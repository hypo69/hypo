```markdown
# whatwg-url

This package provides a full implementation of the WHATWG URL Standard. It can be used independently, or its internal algorithms are exposed for use in projects like jsdom.

## Status

The current version of `whatwg-url` is up-to-date with the URL spec, corresponding to commit [a62223](https://github.com/whatwg/url/commit/a622235308342c9adc7fc2fd1659ff059f7d5e2a).

## API

This library exposes two primary levels of API: a high-level constructor and low-level methods for URL manipulation.

### High-Level API: `URL` Constructor

The core API is the `URL` constructor, which adheres to all the behavior defined by the WHATWG URL Standard, including the handling of `USVString` conversion.  This is generally the preferred method for most use cases.

### Low-Level URL Standard API

These methods are designed for use in projects that need fine-grained control over URL parsing and serialization, like jsdom. They operate on "internal URL" or "URL record" objects.  Direct manipulation of these objects requires careful consideration to maintain internal consistency.

* **`parseURL(input, { baseURL, encodingOverride })`**:  Performs a full URL parse.
* **`basicURLParse(input, { baseURL, encodingOverride, url, stateOverride })`**:  A more fundamental parser, useful for complex URL manipulation steps.  Crucially, `stateOverride` allows controlling the parsing state, enabling more granular control over the parsing process.  The supported states are described in detail below.
* **`serializeURL(urlRecord, excludeFragment)`**: Serializes a URL record into a string.
* **`serializeHost(hostFromURLRecord)`**: Serializes the host portion of a URL record.
* **`serializeInteger(number)`**: Serializes an integer in the context of a URL.
* **`serializeURLOrigin(urlRecord)`**: Serializes the origin (scheme, host, port) of a URL.
* **`setTheUsername(urlRecord, usernameString)`**: Sets the username.
* **`setThePassword(urlRecord, passwordString)`**: Sets the password.
* **`cannotHaveAUsernamePasswordPort(urlRecord)`**: Checks if a URL record can have username, password, or port components.


**`stateOverride` Values (crucial for `basicURLParse`):**

This parameter dictates the current parsing state, allowing for advanced customization and complex scenarios.  Each state corresponds to a specific stage of the WHATWG URL parsing algorithm.  Refer to the WHATWG URL Standard for precise behavior.  Examples include `"scheme start"`, `"path"`, `"query"`, and so on.


**URL Record Properties (be cautious with direct modification):**

The URL record object provides access to individual components of the URL:

* `scheme`, `username`, `password`, `host`, `port`, `path` (as an array), `query`, `fragment`, `cannotBeABaseURL`

Directly manipulating these properties *without* using the proper parsing methods (like `basicURLParse`) can lead to an inconsistent state.  The documentation emphasizes the iterative nature of the URL parsing process.  Changes need to be followed by parsing to update the state correctly.  The specification explicitly outlines these steps to achieve a consistent URL record.


**Error Handling:**

The function `parseURL` and `basicURLParse` can return `"failure"` to indicate a parsing error.


**Example (Illustrative - avoid direct property manipulation):**

```javascript
// (Example using parseURL, more complex examples would use basicURLParse)
const parsedURL = whatwgURL.parseURL('https://user:pass@example.com:8080/path?query#fragment');

console.log(parsedURL.scheme); // Outputs "https"
```


**Important Note:** This library's low-level methods are tailored for specific use cases like jsdom.  For most situations, the high-level `URL` constructor should be preferred. Always refer to the WHATWG URL Standard for detailed behavior.
```
# Модуль graber.py

## Обзор

Модуль `graber.py` предназначен для сбора информации о товарах с веб-страниц поставщиков. Он содержит базовый класс `Graber`, который использует веб-драйвер для извлечения целевых полей, таких как название, описание, спецификация, артикул и цена. Расположение этих полей определяется локаторами, хранящимися в JSON-словарях в директории `locators` каждого поставщика. Модуль предоставляет функциональность для стандартизации и нормализации полученных данных, а также обработки ошибок.

## Подробней

Этот модуль играет важную роль в процессе сбора и обработки данных о товарах от различных поставщиков. Он обеспечивает унифицированный интерфейс для взаимодействия с веб-страницами и извлечения необходимой информации. Собранные данные могут быть использованы для загрузки описаний продуктов в PrestaShop и других платформах электронной коммерции.

## Классы

### `Context`

**Описание**: Класс `Context` используется для хранения глобальных настроек, таких как объект драйвера, локатор для декоратора `@close_pop_up` и префикс поставщика.

**Как работает класс**: Класс `Context` предоставляет статические атрибуты для хранения и обмена глобальными настройками между различными частями модуля. Это позволяет избежать передачи одних и тех же параметров многократно и упрощает доступ к ним.

**Атрибуты**:
- `driver` (Optional['Driver']): Объект драйвера, используемый для управления браузером или другим интерфейсом.
- `locator_for_decorator` (Optional[SimpleNamespace]): Локатор для декоратора `@close_pop_up`.
- `supplier_prefix` (Optional[str]): Префикс поставщика.

**Примеры**:

```python
context = Context()
context.supplier_prefix = 'prefix'
print(context.supplier_prefix)
# Вывод: prefix
```

### `Graber`

**Описание**: Базовый класс `Graber` предназначен для сбора данных со страницы товара для всех поставщиков.

**Как работает класс**: Класс инициализируется с префиксом поставщика, индексом языка и экземпляром драйвера. Он загружает локаторы из JSON-файла, создает экземпляр класса `ProductFields` для хранения данных о товаре и устанавливает глобальные настройки через класс `Context`.

**Методы**:
- `__init__`: Инициализация класса `Graber`.
- `error`: Обработчик ошибок для полей.
- `set_field_value`: Универсальная функция для установки значений полей с обработкой ошибок.
- `grab_page`: Синхронная функция для сбора полей продукта.
- `grab_page_async`: Асинхронная функция для сбора полей продукта.
- `additional_shipping_cost`: Извлечение и установка дополнительной стоимости доставки.
- `delivery_in_stock`: Извлечение и установка статуса доставки в наличии.
- `active`: Извлечение и установка статуса активности.
- `additional_delivery_times`: Извлечение и установка дополнительного времени доставки.
- `advanced_stock_management`: Извлечение и установка статуса расширенного управления запасами.
- `affiliate_short_link`: Извлечение и установка короткой партнерской ссылки.
- `affiliate_summary`: Извлечение и установка партнерского резюме.
- `affiliate_summary_2`: Извлечение и установка второго партнерского резюме.
- `affiliate_text`: Извлечение и установка партнерского текста.
- `affiliate_image_large`: Извлечение и установка большого партнерского изображения.
- `affiliate_image_medium`: Извлечение и установка среднего партнерского изображения.
- `affiliate_image_small`: Извлечение и установка маленького партнерского изображения.
- `available_date`: Извлечение и установка доступной даты.
- `available_for_order`: Извлечение и установка статуса доступности для заказа.
- `available_later`: Извлечение и установка статуса доступности позже.
- `available_now`: Извлечение и установка статуса доступности сейчас.
- `additional_categories`: Установка дополнительных категорий.
- `cache_default_attribute`: Извлечение и установка кэшированного атрибута по умолчанию.
- `cache_has_attachments`: Извлечение и установка статуса наличия вложений в кэше.
- `cache_is_pack`: Извлечение и установка статуса упаковки в кэше.
- `condition`: Извлечение и установка условия продукта.
- `customizable`: Извлечение и установка статуса настраиваемости.
- `date_add`: Извлечение и установка даты добавления.
- `date_upd`: Извлечение и установка даты обновления.
- `delivery_out_stock`: Извлечение и установка доставки вне склада.
- `depth`: Извлечение и установка глубины.
- `description`: Извлечение и установка описания.
- `description_short`: Извлечение и установка краткого описания.
- `id_category_default`: Извлечение и установка ID категории по умолчанию.
- `id_default_combination`: Извлечение и установка ID комбинации по умолчанию.
- `id_product`: Извлечение и установка ID продукта.
- `locale`: Извлечение и установка локали.
- `id_default_image`: Извлечение и установка ID изображения по умолчанию.
- `ean13`: Извлечение и установка кода EAN13.
- `ecotax`: Извлечение и установка экологического налога.
- `height`: Извлечение и установка высоты.
- `how_to_use`: Извлечение и установка инструкции по использованию.
- `id_manufacturer`: Извлечение и установка ID производителя.
- `id_supplier`: Извлечение и установка ID поставщика.
- `id_tax`: Извлечение и установка ID налога.
- `id_type_redirected`: Извлечение и установка ID перенаправленного типа.
- `images_urls`: Извлечение и установка URL изображений.
- `indexed`: Извлечение и установка статуса индексации.
- `ingredients`: Извлечение и установка ингредиентов.
- `meta_description`: Извлечение и установка мета-описания.
- `meta_keywords`: Извлечение и установка мета-ключевых слов.
- `meta_title`: Извлечение и установка мета-заголовка.
- `is_virtual`: Извлечение и установка статуса виртуального продукта.
- `isbn`: Извлечение и установка ISBN.
- `link_rewrite`: Извлечение и установка перезаписи ссылки.
- `location`: Извлечение и установка местоположения.
- `low_stock_alert`: Извлечение и установка предупреждения о низком запасе.
- `low_stock_threshold`: Извлечение и установка порога низкого запаса.
- `minimal_quantity`: Извлечение и установка минимального количества.
- `mpn`: Извлечение и установка MPN (Manufacturer Part Number).
- `name`: Извлечение и установка названия продукта.
- `online_only`: Извлечение и установка статуса "только онлайн".
- `on_sale`: Извлечение и установка статуса "в продаже".
- `out_of_stock`: Извлечение и установка статуса "нет в наличии".
- `pack_stock_type`: Извлечение и установка типа запаса для упаковки.
- `price`: Извлечение и установка цены.
- `product_type`: Извлечение и установка типа продукта.
- `quantity`: Извлечение и установка количества.
- `quantity_discount`: Извлечение и установка скидки за количество.
- `redirect_type`: Извлечение и установка типа перенаправления.
- `reference`: Извлечение и установка референса.
- `show_condition`: Извлечение и установка отображения условия.
- `show_price`: Извлечение и установка отображения цены.
- `state`: Извлечение и установка состояния.
- `text_fields`: Извлечение и установка текстовых полей.
- `unit_price_ratio`: Извлечение и установка коэффициента цены за единицу.
- `unity`: Извлечение и установка единицы измерения.
- `upc`: Извлечение и установка UPC.
- `uploadable_files`: Извлечение и установка загружаемых файлов.
- `default_image_url`: Извлечение и установка URL изображения по умолчанию.
- `visibility`: Извлечение и установка видимости.
- `weight`: Извлечение и установка веса.
- `wholesale_price`: Извлечение и установка оптовой цены.
- `width`: Извлечение и установка ширины.
- `specification`: Извлечение и установка спецификации.
- `link`: Извлечение и установка ссылки.
- `byer_protection`: Извлечение и установка защиты покупателя.
- `customer_reviews`: Извлечение и установка отзывов клиентов.
- `link_to_video`: Извлечение и установка ссылки на видео.
- `local_image_path`: Извлечение и сохранение изображения локально.
- `local_video_path`: Извлечение и сохранение видео локально.

**Параметры**:
- `supplier_prefix` (str): Префикс поставщика.
- `lang_index` (int): Индекс языка.
- `driver` ('Driver'): Экземпляр класса `Driver`.

**Примеры**:

```python
s = 'suppler_prefix'
from src.suppliers import Graber
locator = j_loads(gs.path.src.suppliers / f{s} / 'locators' / 'product.json')

class G(Graber):

    @close_pop_up()
    async def name(self, value:Optional[Any] = None):
        self.fields.name = <Ваша реализация>
```

## Функции

### `close_pop_up`

```python
def close_pop_up() -> Callable:
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.
    Функция `driver.execute_locator()` будет вызвана только если был указан `Context.locator_for_decorator` при инициализации экземляра класса.

    Args:
        value ('Driver'): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```

**Описание**: Функция `close_pop_up` создает декоратор, который закрывает всплывающие окна перед выполнением основной логики функции.

**Как работает функция**: Декоратор проверяет, установлен ли `Context.locator_for_decorator`. Если да, он пытается выполнить локатор для закрытия всплывающего окна с помощью `Context.driver.execute_locator()`. После выполнения локатор сбрасывается, чтобы избежать повторного срабатывания.

**Параметры**:
- `value` ('Driver'): Дополнительное значение для декоратора.

**Возвращает**:
- `Callable`: Декоратор, оборачивающий функцию.

**Вызывает исключения**:
- `ExecuteLocatorException`: Если возникает ошибка при выполнении локатора.

**Примеры**:

```python
@close_pop_up()
async def some_function(self):
    ...
```
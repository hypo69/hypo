# Анализ кода модуля king.py

**Качество кода**
8
- Плюсы
    - Код игры "Король" достаточно прост и понятен, соответствует описанию игры.
    - Используются понятные имена переменных, что облегчает чтение кода.
    - Присутствует блок-схема и текстовое описание алгоритма, что помогает понять логику игры.
    - Код хорошо документирован комментариями.
    - Использовано форматирование строк для вывода сообщений.
- Минусы
    - Отсутствуют явные импорты, хотя их нет необходимости использовать в данном коде.
    - Не используются функции для разделения кода на логические блоки.
    - Обработка ошибок сводится к выводу сообщений, без логирования.
    - Документация выполнена не в reStructuredText формате.
    - Не используется `j_loads` или `j_loads_ns` для чтения, но в данном коде это не требуется.
    - Нет проверки на пустой ввод пользователя.
   

**Рекомендации по улучшению**
1.  **Формат документации**: Переписать комментарии в формате reStructuredText (RST).
2.  **Разделение на функции**: Разделить код на функции для повышения читаемости и повторного использования (например, функция для запроса слова, функция проверки слова, функция вывода победителя).
3.  **Логирование ошибок**: Добавить логирование ошибок с использованием `from src.logger.logger import logger`.
4.  **Обработка ошибок**: Добавить обработку возможных ошибок (например, пустой ввод).
5.  **Улучшение ввода**: Добавить проверку на пустую строку, если пользователь ничего не ввел.
6.  **Использовать f-строки**:  Более активно использовать f-строки для форматирования вывода.

**Оптимизированный код**
```python
"""
Модуль для реализации игры "Король".
=========================================================================================

Игра "Король" - это игра в слова, где игроки по очереди называют слова,
начинающиеся с последней буквы предыдущего слова. Игра продолжается до тех пор,
пока один из игроков не сдастся или не сможет назвать слово.

:Правила игры:
    1. Игрок 1 вводит любое слово.
    2. Игрок 2 должен ввести слово, начинающееся с последней буквы слова игрока 1.
    3. Игроки по очереди вводят слова, соблюдая правило первой буквы.
    4. Игра заканчивается, когда игрок вводит '0' или если не может подобрать слово.

:Алгоритм:
    1. Вывести приглашение для первого игрока.
    2. Ввести первое слово.
    3. Установить текущего игрока в 2.
    4. Начать цикл, пока не конец игры:
        4.1. Вывести приглашение для текущего игрока.
        4.2. Ввести новое слово.
        4.3. Если новое слово равно '0', то перейти к шагу 7.
        4.4. Если первая буква нового слова не равна последней букве предыдущего слова,
             то вывести сообщение об ошибке.
        4.5. Если игрок ввел верное слово, то:
             4.5.1. Установить предыдущее слово в текущее слово.
             4.5.2. Переключить текущего игрока.
    5. Вывести сообщение о конце игры.
    6. Вывести сообщение о победе предыдущего игрока.
    7. Конец игры.

:Блок-схема:

.. mermaid::
    flowchart TD
        Start["Начало"] --> InputFirstWord["Ввод первого слова от игрока 1"]
        InputFirstWord --> SetCurrentPlayer["<code><b>currentPlayer = 2</b></code>"]
        SetCurrentPlayer --> GameLoopStart{"Начало цикла игры"}
        GameLoopStart -- "Да" --> InputWord["Ввод слова от <code><b>currentPlayer</b></code>"]
        InputWord --> CheckQuit{"Проверка: <code><b>word == '0'?</b></code>"}
        CheckQuit -- Да --> GameOver["Конец игры"]
        CheckQuit -- Нет --> CheckFirstLetter{"Проверка: <code><b>firstLetter(word) == lastLetter(previousWord)?</b></code>"}
        CheckFirstLetter -- Нет --> OutputError["Вывод ошибки: <b>INCORRECT WORD</b>"]
        OutputError --> GameLoopStart
        CheckFirstLetter -- Да --> UpdatePreviousWord["<code><b>previousWord = word</b></code>"]
        UpdatePreviousWord --> SwitchPlayer["<code><b>currentPlayer = 3 - currentPlayer</b></code>"]
         SwitchPlayer --> GameLoopStart
        GameLoopStart -- "Нет" --> OutputEndMessage["Вывод: <b>GAME OVER</b>"]
        OutputEndMessage --> OutputWinner["Вывод победителя: <b>Player {3 - currentPlayer} WINS!</b>"]
        OutputWinner --> End["Конец"]

:Легенда:
    Start - Начало программы.
    InputFirstWord - Запрос ввода первого слова от игрока 1.
    SetCurrentPlayer - Установка текущего игрока в 2.
    GameLoopStart - Начало основного игрового цикла.
    InputWord - Запрос ввода слова от текущего игрока.
    CheckQuit - Проверка, введено ли слово '0' для завершения игры.
    GameOver - Завершение игры.
    CheckFirstLetter - Проверка, совпадает ли первая буква введенного слова с последней буквой предыдущего слова.
    OutputError - Вывод сообщения об ошибке, если слово неверное.
    UpdatePreviousWord - Обновление предыдущего слова текущим словом.
    SwitchPlayer - Переключение текущего игрока.
    OutputEndMessage - Вывод сообщения о завершении игры.
    OutputWinner - Вывод победителя игры.
    End - Конец программы.
"""
from src.logger.logger import logger



def get_player_word(player_number: int, previous_word: str) -> str:
    """
    Запрашивает слово у игрока.

    :param player_number: Номер текущего игрока.
    :param previous_word: Предыдущее слово.
    :return: Введенное слово.
    """
    while True:
        word = input(f'Игрок {player_number}, введите слово: ').strip()
        if not word:
            logger.error(f'Игрок {player_number} не ввел слово. Повторите ввод')
            continue
        return word

def check_word(current_word: str, previous_word: str) -> bool:
    """
    Проверяет корректность введенного слова.

    :param current_word: Текущее введенное слово.
    :param previous_word: Предыдущее слово.
    :return: True, если слово корректно, иначе False.
    """
    if previous_word and current_word[0].lower() != previous_word[-1].lower():
        print('Неверное слово, первая буква должна совпадать с последней буквой предыдущего слова.')
        return False
    return True

def switch_player(current_player: int) -> int:
    """
    Переключает текущего игрока.

    :param current_player: Номер текущего игрока.
    :return: Номер следующего игрока.
    """
    return 3 - current_player

def announce_winner(current_player: int) -> None:
    """
    Объявляет победителя.

    :param current_player: Номер текущего игрока (проигравшего).
    """
    print(f'Игрок {3 - current_player} победил!')


def play_king_game() -> None:
    """
     Запускает игру "Король".
    """
    previous_word = ''
    current_player = 1

    # Запрос первого слова
    previous_word = input('Игрок 1, введите первое слово: ').strip()
    if not previous_word:
        logger.error('Игрок 1 не ввел первое слово.')
        return

    current_player = 2

    # Игровой цикл
    while True:
        current_word = get_player_word(current_player, previous_word)

        # Проверка на выход из игры
        if current_word == '0':
            print('Игра окончена.')
            break

        # Проверка первой буквы
        if not check_word(current_word, previous_word):
            continue

        # Подготовка к следующему ходу
        previous_word = current_word
        current_player = switch_player(current_player)

    # Объявление победителя
    announce_winner(current_player)


if __name__ == '__main__':
    play_king_game()


"""
Объяснение кода:
1. **Импорт модуля `logger`**:
   -  `from src.logger.logger import logger`: импортирует модуль логирования для записи ошибок.
2. **Функция `get_player_word`**:
   -  Запрашивает у игрока ввод слова, с проверкой на пустую строку.
   -  Возвращает введенное слово.
3. **Функция `check_word`**:
   - Проверяет, совпадает ли первая буква текущего слова с последней буквой предыдущего слова, без учета регистра.
   - Выводит сообщение об ошибке, если проверка не пройдена.
   - Возвращает `True`, если слово корректно, иначе `False`.
4. **Функция `switch_player`**:
   - Переключает текущего игрока.
   - Возвращает номер следующего игрока.
5. **Функция `announce_winner`**:
   - Выводит сообщение о победителе игры.
6.  **Функция `play_king_game`**:
    - `previousWord = ""`: Инициализация переменной для хранения последнего введенного слова.
    - `currentPlayer = 1`: Инициализация переменной для хранения номера текущего игрока.
    - Запрашивает у первого игрока первое слово, используя `input()` и удаляет пробелы.
    -  `current_player = 2`: Переключает текущего игрока на 2-го.
    - **Основной игровой цикл** (`while True`):
      - Запрашивает у текущего игрока слово, с помощью функции `get_player_word`
      - **Проверка выхода**:
        -  `if current_word == '0'`: Проверка, ввел ли игрок '0', для завершения игры.
        -  `print('Игра окончена.')`: Вывод сообщения об окончании игры.
        -  `break`: Выход из цикла.
      - **Проверка первой буквы**:
        -  Вызывает функцию `check_word` для проверки соответствия букв.
        -  `continue`: Переход к следующей итерации, если слово не корректно.
      - **Подготовка к следующему ходу**:
        -  Обновляет `previous_word` текущим словом.
        -  Переключает текущего игрока.
    - **Объявление победителя**:
      -  Вызывает функцию `announce_winner`, для вывода сообщения о победе.
7.  **Условие `if __name__ == '__main__':`**:
    - Запуск игры, когда файл запускается напрямую.
"""
```
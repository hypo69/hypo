# Модуль `src.suppliers.ksp.graber`

## Обзор

Модуль `src.suppliers.ksp.graber` содержит класс `Graber`, предназначенный для сбора значений полей на странице товара `ksp.co.il`. Он наследуется от класса `Graber` (который, вероятно, находится в модуле `src.suppliers.graber`) и переопределяет некоторые методы для нестандартной обработки полей, специфичных для данного поставщика.

## Подробней

Этот модуль является частью системы для сбора информации о товарах с различных сайтов поставщиков. Он использует веб-драйвер для взаимодействия со страницей товара и извлечения необходимых данных. Класс `Graber` специализируется на поставщике `ksp.co.il`, адаптируя логику сбора данных под его особенности. Перед отправкой запроса к веб-драйверу, модуль позволяет выполнять предварительные действия через декораторы, что может быть полезно для обработки всплывающих окон или других динамических элементов страницы.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для операций захвата данных с сайта `ksp.co.il`. Он наследуется от базового класса `Graber` и предоставляет специализированную логику для извлечения информации о товарах с этого сайта.

**Как работает класс**:
1.  **Инициализация**: При инициализации класса устанавливается префикс поставщика (`ksp`), вызывается конструктор родительского класса, и устанавливаются локаторы для мобильной версии сайта, если текущий URL содержит `/mob/`.
2.  **Работа с локаторами**: Класс использует JSON-файлы с локаторами для определения элементов на странице, с которыми необходимо взаимодействовать. В зависимости от версии сайта (мобильная или десктопная) используются разные наборы локаторов.
3.  **Декораторы**: Класс поддерживает использование декораторов для выполнения предварительных действий перед извлечением данных, например, для закрытия всплывающих окон.

**Методы**:

*   `__init__`: Инициализация класса `Graber`.

    **Параметры**:
    *   `driver` (`'Driver'`): Инстанс веб-драйвера для взаимодействия со страницей.
    *   `lang_index` (`int`): Индекс языка, используемого на сайте.

    **Как работает метод**:
    1. Устанавливает префикс поставщика как `'ksp'`.
    2. Вызывает конструктор родительского класса `Graber` с указанием префикса поставщика, драйвера и индекса языка.
    3. Приостанавливает выполнение на 3 секунды.
    4. Проверяет, содержит ли текущий URL драйвера подстроку `'/mob/'`. Если да, то загружает локаторы для мобильной версии сайта KSP из JSON-файла (`product_mobile_site.json`) и устанавливает их.
    5. Выводит информационное сообщение в лог о том, что установлены локаторы для мобильной версии сайта KSP.
    6. Устанавливает значение `Context.locator_for_decorator` в `None`. Если этому атрибуту будет присвоено значение локатора, то в декораторе `@close_pop_up` этот локатор будет выполнен.

    **Примеры**:

    ```python
    driver = Driver(Chrome)
    graber = Graber(driver, 0)
    ```
## Функции

### `close_pop_up`

```python
def close_pop_up(value: Any = None) -> Callable:
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```

**Назначение**: Функция `close_pop_up` создает декоратор, который предназначен для закрытия всплывающих окон на веб-странице перед выполнением основной логики декорируемой функции. Это может быть полезно для предотвращения перекрытия элементов, с которыми необходимо взаимодействовать, или для устранения помех при сборе данных.

**Как работает функция**:

1.  Функция `close_pop_up` принимает необязательный аргумент `value`, который может быть использован для передачи дополнительных параметров декоратору.
2.  Внутри `close_pop_up` определяется функция `decorator`, которая принимает функцию `func` в качестве аргумента и возвращает новую функцию `wrapper`.
3.  Функция `wrapper` является оберткой вокруг исходной функции `func`. Внутри `wrapper` происходит попытка закрытия всплывающего окна с использованием локатора, хранящегося в `Context.locator.close_pop_up`. Если закрытие окна прошло успешно, выполняется основная логика функции `func`.
4.  Если при выполнении локатора для закрытия всплывающего окна возникает исключение `ExecuteLocatorException`, информация об ошибке записывается в лог с уровнем `DEBUG`.
5.  Функция `wrapper` возвращает результат выполнения основной функции `func`.

**Параметры**:

*   `value` (`Any`, optional): Дополнительное значение для передачи в декоратор. По умолчанию `None`.

**Возвращает**:

*   `Callable`: Декоратор, который можно использовать для оборачивания других функций.

**Пример использования**:

```python
@close_pop_up()
async def my_function():
    #  Основная логика функции
    ...
```

В этом примере декоратор `@close_pop_up()` будет автоматически закрывать всплывающее окно перед выполнением функции `my_function`.
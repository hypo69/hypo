# Анализ кода send_data.js

## <input code>

```javascript
// Создаем обработчик события для загрузки страницы
function onPageLoad() {
    // Собираем информацию о странице
    var title = document.title;
    var url = window.location.href;
    var body = document.body.innerHTML;

    // Формируем объект с данными для отправки
    var data = {
        title: title,
        url: url,
        body: body
    };

    // Отправляем данные на указанный адрес
    fetch('http://127.0.0.1/hypotez.online/api/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(json => {
            console.log('Response:', json);
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

// Добавляем обработчик события для загрузки страницы
window.addEventListener('load', onPageLoad);
```

## <algorithm>

**Шаг 1:** Функция `onPageLoad` вызывается при загрузке страницы.

**Шаг 2:** Внутри `onPageLoad` получаются значения `title`, `url` и `body` страницы (заголовок, URL и содержимое).

**Шаг 3:**  Формируется объект `data` с полученной информацией.

**Шаг 4:** Используя `fetch`, отправляется `POST` запрос на сервер по адресу `http://127.0.0.1/hypotez.online/api/`.  В теле запроса передаётся объект `data` в формате JSON.

**Шаг 5:**  `fetch` возвращает промис.  
  * **Успешный ответ:** Промси выполняет chain `.then(response => ...)`
   *  Проверяет статус ответа `response.ok`. Если не успешен, выбрасывает ошибку.
   *   Обрабатывает ответ `response.json()`, получая JSON данные с сервера.
   *  Вывод полученных данных в консоль.
  * **Ошибка:** Промси выполняет chain `.catch(error => ...)` 
   * Выводит ошибку в консоль.


**Пример:** Если пользователь открывает страницу с заголовком "Моя страница", URL'ом "https://example.com" и телом "<h1>Привет!</h1>", то переменная `data` будет содержать объект:
```javascript
{
    title: "Моя страница",
    url: "https://example.com",
    body: "<h1>Привет!</h1>"
}
```
Этот объект будет отправлен на сервер.


## <mermaid>

```mermaid
graph TD
    A[Страница загружается] --> B{window.addEventListener};
    B --> C[onPageLoad()];
    C --> D[title = document.title];
    C --> E[url = window.location.href];
    C --> F[body = document.body.innerHTML];
    D --> G[data.title];
    E --> H[data.url];
    F --> I[data.body];
    G --> J[data];
    H --> J;
    I --> J;
    J --> K[fetch('http://127.0.0.1/hypotez.online/api/')];
    K --> L{Успешный ответ?};
    L -- Да --> M[response.json()];
    M --> N[console.log('Response:', json)];
    L -- Нет --> O[throw new Error];
    O --> P[console.error('Error:')];
    K --> Q{Ошибка в запросе?};
    Q -- Да --> P;
```

## <explanation>

**Импорты:**
Нет импортов.  Код использует встроенные объекты и функции JavaScript.

**Классы:**
Нет классов.

**Функции:**

* **`onPageLoad()`:**  Функция-обработчик события `load` для страницы.  
    * **Аргументы:** Нет.
    * **Возвращаемые значения:** Нет.
    * **Назначение:**  Выполняет сбор данных с текущей страницы (title, url, body) и отправляет их на сервер. Применяется для отправки данных с веб-страницы при ее загрузке.  
    * **Пример:** При загрузке страницы `example.com` функция соберет данные и отправит их на сервер.

**Переменные:**

* `title`, `url`, `body`:  переменные типа `string`. Хранят заголовок, URL и тело страницы соответственно.
* `data`: объект.  Содержит собранные данные для отправки на сервер.
* `response`: объект, содержащий информацию о результате запроса к серверу.
* `json`:  объект, содержащий данные из ответа сервера в формате JSON.

**Возможные ошибки и улучшения:**

* **Обработка ошибок:** Код обрабатывает ошибки (например, если запрос к серверу не успешен).  Однако, он не обрабатывает ошибки при сборе информации с страницы (например, если `document.title` или `document.body` неопределены).
* **Проверка статуса ответа:**  Если не 200 ответ (неуспешный), он ловит ошибку и кидает ее, но нет подробной проверки кода ответа. Было бы лучше использовать `response.status` для более подробного анализа ответа.
* **Логирование:** Код выводит ошибки и успешные ответы в консоль.  Для разработки в реальном проекте более полезно использование более структурированных систем логгирования.
* **Управление данными:** При сборе данных с веб-страниц стоит убедиться, что все данные, которые будут передаваться на сервер, очищаются от потенциально вредных символов или специальных символов, которые могут привести к ошибкам или безопасности.

**Взаимосвязь с другими частями проекта:**

Код отправляет данные на сервер `http://127.0.0.1/hypotez.online/api/`.  Это предполагает наличие серверной части (например, написанной на Node.js, Python с Flask или Django), которая обрабатывает этот запрос POST и сохраняет данные.
```
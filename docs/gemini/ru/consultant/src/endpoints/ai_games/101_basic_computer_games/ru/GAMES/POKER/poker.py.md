# Анализ кода модуля `poker.py`

**Качество кода**
8
- Плюсы
    - Код хорошо структурирован, разбит на функции, что делает его читаемым и понятным.
    - Присутствуют подробные комментарии, объясняющие логику работы каждой функции и блока кода.
    - Логика игры в покер реализована корректно, включая проверку различных комбинаций.
    - Используется `try-except` для обработки ошибок ввода пользователя.
    - Код соответствует PEP8, в части форматирования, отступов и пробелов.
    - Код использует docstring для документирования функций.
- Минусы
    - Комментарии и docstring не соответствуют стандарту reStructuredText (RST).
    - Отсутствует логирование ошибок через `logger.error`.
    - Не используется `j_loads` или `j_loads_ns` из `src.utils.jjson`, что не требуется в данном коде, так как не используются json файлы.
    - Переменные и функции, в основном, названы в стиле snake_case, но требуется приведение к единому виду.
    - Не производится проверка на стриты (пять последовательных значений) как было указано в описании, хотя в коде функция проверки есть, и она работает.

**Рекомендации по улучшению**

1.  **Документация:**
    -   Переписать все комментарии и docstring в формате reStructuredText (RST).
    -   Добавить полное описание модуля в начале файла.
    -   Для каждой функции, метода и класса добавить подробное описание с параметрами и возвращаемыми значениями в RST формате.

2.  **Логирование:**
    -   Использовать `from src.logger.logger import logger` для логирования ошибок и отладочной информации.
    -   Заменить `try-except` блоки на обработку ошибок через `logger.error`.
    -   Добавить логирование в ключевых точках программы для отслеживания хода выполнения.

3.  **Импорты:**
    -   Проверить и добавить недостающие импорты, если это потребуется.

4.  **Стиль кода:**
    -   Привести в соответствие имена функций, переменных с ранее обработанными файлами.

5.  **Улучшение алгоритма**
    -  Добавить проверку на стрит, для корректной работы.

**Оптимизированный код**

```python
"""
Модуль для реализации упрощенной карточной игры "Покер"
=====================================================

Этот модуль содержит функции для создания, отображения, замены карт,
а также для анализа комбинаций в руке игрока в упрощенной версии покера.

Правила игры:
1. Игрок получает пять случайных карт от 1 до 13.
2. Игрок может выбрать, какие карты оставить, а какие заменить один раз.
3. После замены определяется комбинация: Пара, Две пары, Тройка, Фулл хаус, Каре, Стрит, Флеш.
4. Выводится сообщение с комбинацией и выигрышем (если есть).

Пример использования:
--------------------

.. code-block:: python

    if __name__ == "__main__":
        play_poker()
"""
import random
# from src.logger.logger import logger # TODO: добавить импорт после добавления logger

def create_hand() -> list:
    """
    Создает руку из 5 случайных карт (числа от 1 до 13).

    :return: Список из 5 случайных чисел, представляющих карты.
    :rtype: list
    """
    hand = [random.randint(1, 13) for _ in range(5)]
    return hand

def display_hand(hand: list) -> None:
    """
    Выводит карты на экран, нумеруя их для удобства игрока.

    :param hand: Список карт в руке.
    :type hand: list
    """
    print('Ваши карты:')
    for i, card in enumerate(hand):
        print(f'{i+1}: {card}', end='  ')
    print()

def get_cards_to_replace() -> list:
    """
    Запрашивает у игрока номера карт, которые нужно заменить.

    :return: Список индексов карт для замены (начиная с 0).
    :rtype: list
    """
    while True:
        try:
            replace_str = input('Введите номера карт для замены через пробел (или 0, чтобы оставить все): ')
            replace_cards = list(map(int, replace_str.split()))

            if len(replace_cards) == 1 and replace_cards[0] == 0:
                return []

            if all(1 <= card <= 5 for card in replace_cards) and len(replace_cards) <= 5:
                return [card - 1 for card in replace_cards]
            else:
                print('Неверный ввод. Введите номера карт от 1 до 5 или 0.')

        except ValueError:
            print('Неверный ввод. Пожалуйста, введите номера через пробел.')
        # except Exception as ex: # TODO: удалить try except после добавления logger
        #     logger.error('Ошибка при получении ввода пользователя', ex) # TODO: добавить логирование
        #     ...
        #     return []


def replace_cards(hand: list, replace_indices: list) -> list:
    """
    Заменяет выбранные карты на новые случайные карты.

    :param hand: Список карт в руке.
    :type hand: list
    :param replace_indices: Список индексов карт для замены.
    :type replace_indices: list
    :return: Обновленный список карт в руке.
    :rtype: list
    """
    for index in replace_indices:
        hand[index] = random.randint(1, 13)
    return hand

def analyze_hand(hand: list) -> None:
    """
    Анализирует руку и определяет выигрышную комбинацию.

    :param hand: Список карт в руке.
    :type hand: list
    """
    counts = {}
    for card in hand:
        counts[card] = counts.get(card, 0) + 1

    values = list(counts.values())

    # Проверка на Флеш
    sorted_hand = sorted(hand)
    if len(set(sorted_hand)) == 5 and all(sorted_hand[i+1] - sorted_hand[i] == 1 for i in range(4)):
        print('Флеш! Выигрыш 20 очков')
        return

    # Проверка на Каре
    if 4 in values:
        print('Каре! Выигрыш 25 очков')
        return

    # Проверка на Фулл Хаус
    if 3 in values and 2 in values:
        print('Фулл Хаус! Выигрыш 15 очков')
        return

    # Проверка на Тройку
    if 3 in values:
        print('Тройка! Выигрыш 10 очков')
        return

    # Проверка на Две пары
    if values.count(2) == 2:
        print('Две пары! Выигрыш 5 очков')
        return

    # Проверка на Пару
    if 2 in values:
        print('Пара! Выигрыш 2 очка')
        return

    # Проверка на Стрит
    if len(set(sorted_hand)) == 5 and sorted_hand[-1] - sorted_hand[0] == 4 :
        print('Стрит! Выигрыш 15 очков')
        return

    print('Нет выигрыша.')

def play_poker() -> None:
    """
    Запускает игру в покер.
    """
    hand = create_hand() # код исполняет создание руки из 5 карт
    display_hand(hand) # код исполняет вывод карт на экран

    replace_indices = get_cards_to_replace() # код исполняет запрос карт для замены
    if replace_indices:
        hand = replace_cards(hand, replace_indices) # код исполняет замену карт
        display_hand(hand) # код исполняет вывод обновленных карт

    analyze_hand(hand) # код исполняет анализ руки на наличие комбинации и выводит результат

if __name__ == '__main__':
    play_poker()
```
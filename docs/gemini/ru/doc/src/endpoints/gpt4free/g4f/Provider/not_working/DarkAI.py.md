# Модуль для работы с DarkAI
===========================

Модуль предоставляет асинхронный класс `DarkAI` для взаимодействия с API DarkAI. Поддерживает потоковую передачу данных и выбор различных моделей.

## Обзор

Модуль `DarkAI` является частью проекта `hypotez` и предназначен для обеспечения взаимодействия с сервисом DarkAI. Он позволяет отправлять запросы к API DarkAI и получать ответы в асинхронном режиме с поддержкой потоковой передачи данных. Модуль включает в себя функции для форматирования запросов и обработки ответов, а также предоставляет возможность выбора различных моделей DarkAI.

## Подробнее

Модуль `DarkAI` использует библиотеку `aiohttp` для выполнения асинхронных HTTP-запросов. Он поддерживает потоковую передачу данных, что позволяет получать ответы от API DarkAI частями, не дожидаясь полной загрузки. Это особенно полезно для больших объемов данных, так как позволяет снизить нагрузку на память и повысить скорость обработки.

Модуль также предоставляет возможность выбора различных моделей DarkAI, что позволяет адаптировать запросы к различным задачам и требованиям. Список поддерживаемых моделей определен в атрибуте `models` класса `DarkAI`.

## Классы

### `DarkAI`

**Описание**: Класс для взаимодействия с API DarkAI.

**Наследует**:

- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями.

**Атрибуты**:

- `url` (str): URL API DarkAI.
- `api_endpoint` (str): URL конечной точки API DarkAI.
- `working` (bool): Указывает, работает ли провайдер.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных.
- `default_model` (str): Модель, используемая по умолчанию.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Словарь псевдонимов моделей.

**Методы**:

- `create_async_generator`: Создает асинхронный генератор для взаимодействия с API DarkAI.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для взаимодействия с API DarkAI.

    Args:
        cls (DarkAI): Класс DarkAI.
        model (str): Модель для использования.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий части ответа от API DarkAI.

    Raises:
        Exception: Если возникает ошибка при взаимодействии с API DarkAI.

    """
```

**Назначение**: Создает асинхронный генератор для взаимодействия с API DarkAI.

**Параметры**:

- `cls` (DarkAI): Класс DarkAI.
- `model` (str): Модель для использования.
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:

- `AsyncResult`: Асинхронный генератор, возвращающий части ответа от API DarkAI.

**Вызывает исключения**:

- `Exception`: Если возникает ошибка при взаимодействии с API DarkAI.

**Как работает функция**:

1. **Получение модели**: Функция извлекает модель для использования, применяя псевдонимы, если необходимо.
2. **Формирование заголовков**: Функция подготавливает заголовки HTTP-запроса, включая `accept`, `content-type` и `user-agent`.
3. **Создание сессии**: Функция создает асинхронную сессию `aiohttp` с заданными заголовками и таймаутом.
4. **Форматирование промпта**: Функция форматирует список сообщений в строку промпта.
5. **Подготовка данных**: Функция формирует данные запроса в формате JSON, включая промпт и модель.
6. **Отправка запроса**: Функция отправляет POST-запрос к API DarkAI с данными и прокси-сервером (если указан).
7. **Обработка ответа**: Функция читает ответ от API DarkAI частями, декодирует JSON и извлекает текст из каждого чанка.
8. **Генерация данных**: Функция генерирует текст из каждого чанка ответа.

**Внутренние функции**: Нет

**ASCII flowchart**:

```
A: Получение модели
|
B: Формирование заголовков
|
C: Создание сессии
|
D: Форматирование промпта
|
E: Подготовка данных
|
F: Отправка запроса
|
G: Обработка ответа
|
H: Генерация данных
```

**Примеры**:

```python
# Пример использования create_async_generator
model = "llama-3-70b"
messages = [{"role": "user", "content": "Hello, DarkAI!"}]
proxy = None
async_generator = DarkAI.create_async_generator(model, messages, proxy)
```

```python
# Пример использования create_async_generator с прокси
model = "gpt-4o"
messages = [{"role": "user", "content": "Как дела?"}]
proxy = "http://your_proxy:8080"
async_generator = DarkAI.create_async_generator(model, messages, proxy)
```
```python
# Пример использования create_async_generator с обработкой асинхронного генератора
import asyncio

async def main():
    model = "llama-3-70b"
    messages = [{"role": "user", "content": "Расскажи о Python."}]
    proxy = None
    generator = await DarkAI.create_async_generator(model, messages, proxy)
    
    async for chunk in generator:
        print(chunk, end='')

if __name__ == "__main__":
    asyncio.run(main())
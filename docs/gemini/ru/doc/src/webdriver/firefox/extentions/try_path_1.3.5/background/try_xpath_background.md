# Документация для try_xpath_background.js

## Обзор

Этот скрипт отвечает за обработку сообщений, полученных от других скриптов расширения, и взаимодействие с браузером. Он управляет состоянием всплывающего окна, загрузкой CSS стилей, отображением результатов поиска XPath и обновлением данных из хранилища настроек.

## Переменные

### `tx`

Alias для `tryxpath`.

### `fu`

Alias для `tryxpath.functions`.

### `popupState`

Состояние всплывающего окна.

### `popupCss`

CSS-стили для всплывающего окна.

### `results`

Результаты поиска XPath.

### `css`

CSS-стили для вставки в текущую вкладку.

### `attributes`

Словарь атрибутов для поиска XPath.

## Функции

### `loadDefaultCss()`

**Описание**: Загружает по умолчанию CSS-стили из файла `try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Promise, содержащий текст загруженного CSS.

**Обрабатывает исключения**:
- `Ошибка` (fu.onError): Возникает при возникновении ошибки во время загрузки CSS.

### `genericListener(message, sender, sendResponse)`

**Описание**: Обрабатывает входящие сообщения.

**Параметры**:
- `message`: Сообщение для обработки.
- `sender`: Отправитель сообщения.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `any`: Результат обработки сообщения.

### `genericListener.listeners.storePopupState(message)`

**Описание**: Сохраняет состояние всплывающего окна.

**Параметры**:
- `message`: Сообщение содержащее состояние.

### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Восстанавливает состояние всплывающего окна.

**Параметры**:
- `message`: Сообщение, содержащее необходимые данные.

**Вызывает исключения**:
- `Ошибка` (fu.onError): Возникает при ошибке в процессе восстановления состояния.

### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Отправляет CSS стили для всплывающего окна.

**Вызывает исключения**:
- `Ошибка` (fu.onError): Возникает при ошибке в процессе отправки стилей.


### `genericListener.listeners.showAllResults(message, sender)`

**Описание**: Показывает все результаты поиска XPath в новой вкладке.

**Параметры**:
- `message`: Сообщение, содержащее результаты.
- `sender`: Отправитель сообщения.

**Вызывает исключения**:
- `Ошибка` (fu.onError): Возникает при ошибке в процессе создания новой вкладки.

### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Возвращает результаты поиска XPath.

**Параметры**:
- `message`: Сообщение, содержащее необходимые данные.
- `sender`: Отправитель сообщения.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `boolean`: `true` - успешное выполнение, `false` - ошибка.


### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Обновляет CSS-стили в текущей вкладке.

**Параметры**:
- `message`: Сообщение с обновленными стилями.
- `sender`: Отправитель сообщения.

**Обрабатывает исключения**:
- `Ошибка` (fu.onError): Возникает при возникновении ошибки во время работы с вкладкой.

### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Возвращает настройки расширения.

**Параметры**:
- `message`: Сообщение, содержащее запрос на получение настроек.
- `sender`: Отправитель сообщения.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `boolean`: `true` - успешное выполнение, `false` - ошибка.

### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Устанавливает информацию о содержимом в текущей вкладке.

**Параметры**:
- `message`: Сообщение, содержащее информацию о содержимом.
- `sender`: Отправитель сообщения.


## Обработка событий из хранилища настроек

Функции обрабатывают изменения в хранилище настроек (`browser.storage.onChanged.addListener`) и обновляют соответствующие переменные (`attributes`, `css`, `popupCss`) при изменении значений.


## Инициализация

Скрипт выполняет инициализацию, загружая настройки из хранилища (`browser.storage.sync.get`) и, при необходимости, загружая CSS по умолчанию.
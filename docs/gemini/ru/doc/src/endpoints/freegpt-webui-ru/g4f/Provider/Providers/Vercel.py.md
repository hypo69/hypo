# Модуль `Vercel.py`

## Обзор

Модуль предоставляет интерфейс для взаимодействия с моделями, размещенными на платформе Vercel AI. Он включает в себя функциональность для получения токена аутентификации, формирования запросов к API Vercel AI и генерации текста на основе предоставленных моделей. Модуль предназначен для использования в проектах, требующих интеграции с различными AI-моделями для задач генерации текста.

## Подробнее

Модуль содержит классы и функции, необходимые для аутентификации и взаимодействия с API Vercel AI. Он использует библиотеки `curl_cffi`, `execjs`, `queue`, `threading`, `json` и `base64` для выполнения HTTP-запросов, выполнения JavaScript-кода, организации потоков и обработки данных.

## Классы

### `Client`

**Описание**: Класс `Client` предназначен для взаимодействия с API Vercel AI. Он предоставляет методы для получения токена аутентификации, формирования параметров запроса и генерации текста на основе выбранной модели.

**Принцип работы**:
1.  Инициализация сессии `requests.Session()` с определенными заголовками.
2.  Получение токена аутентификации с использованием JavaScript-кода, полученного с сервера Vercel AI.
3.  Формирование параметров запроса на основе параметров, специфичных для каждой модели.
4.  Отправка запроса к API Vercel AI и обработка полученных данных для генерации текста.

**Методы**:

-   `__init__`: Инициализирует класс `Client`, создает сессию `requests.Session()` и устанавливает заголовки по умолчанию для HTTP-запросов.

    ```python
    def __init__(self):
        """
        Инициализирует класс Client, создает сессию requests.Session() и устанавливает заголовки по умолчанию для HTTP-запросов.
        """
        ...
    ```

-   `get_token`: Получает токен аутентификации от Vercel AI.

    ```python
    def get_token(self) -> str:
        """
        Получает токен аутентификации от Vercel AI.

        Returns:
            str: Токен аутентификации в формате base64.
        """
        ...
    ```

-   `get_default_params`: Получает параметры по умолчанию для указанной модели.

    ```python
    def get_default_params(self, model_id: str) -> Dict:
        """
        Получает параметры по умолчанию для указанной модели.

        Args:
            model_id (str): Идентификатор модели.

        Returns:
            Dict: Словарь с параметрами модели по умолчанию.
        """
        ...
    ```

-   `generate`: Генерирует текст на основе указанной модели и промпта.

    ```python
    def generate(self, model_id: str, prompt: str, params: dict = {}) -> Generator[Dict, None, None]:
        """
        Генерирует текст на основе указанной модели и промпта.

        Args:
            model_id (str): Идентификатор модели.
            prompt (str): Текст запроса для генерации.
            params (dict, optional): Дополнительные параметры для запроса. Defaults to {}.

        Yields:
            Generator[Dict, None, None]: Генератор словарей, содержащих сгенерированный текст.
        """
        ...
    ```

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs) -> Generator[str, None, None]:
    """
    Генерирует текст ответа на основе предоставленных сообщений, используя указанную модель.

    Args:
        model (str): Идентификатор модели для генерации текста.
        messages (list): Список сообщений, представляющих контекст разговора.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
        **kwargs: Дополнительные аргументы.

    Yields:
        Generator[str, None, None]: Генератор токенов сгенерированного текста.

    Как работает функция:
    1. Временно выводит сообщение о том, что Vercel в настоящее время не работает.
    2. Формирует контекст разговора, объединяя сообщения от пользователя и ассистента.
    3. Использует класс `Client` для генерации текста на основе сформированного контекста.
    4. Возвращает сгенерированные токены текста.

    Внутри функции происходят следующие действия и преобразования:
     Формирование контекста разговора - объединение сообщений от пользователя и ассистента для создания контекста для модели.
     Обращение к API Vercel - использование класса `Client` для отправки запроса на генерацию текста.
     Возвращение токенов текста - генерация и возврат токенов сгенерированного текста.
     Извлечение токенов текста - получение токенов текста из ответа API Vercel.

    Примеры:
    Пример 1:
        model = "gpt-3.5-turbo"
        messages = [{"role": "user", "content": "Привет!"}]
        stream = True
        result = _create_completion(model, messages, stream)
        for token in result:
            print(token)

    Пример 2:
        model = "claude-instant-v1"
        messages = [{"role": "user", "content": "Как дела?"}, {"role": "assistant", "content": "Все хорошо."}]
        stream = False
        result = _create_completion(model, messages, stream)
        for token in result:
            print(token)
    """
    ...
```

### `params`

```python
params: str
```

Строка, содержащая информацию о поддержке параметров функцией `_create_completion`.
```python
params = f\'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: \' + \\\n    \'(%s)\' % \', \'.join([f"{name}: {get_type_hints(_create_completion)[name].__name__}" for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]])
```
## Параметры

Строка `params` содержит информацию о поддержке параметров функцией `_create_completion`. Она формируется путем объединения имени файла (без расширения `.py`) и списка параметров функции `_create_completion` с их типами.

## Примеры

### Пример использования класса `Client`

```python
client = Client()
model_id = "gpt-3.5-turbo"
prompt = "Напиши короткое стихотворение о весне."
params = {"temperature": 0.7}

for token in client.generate(model_id, prompt, params):
    print(token)
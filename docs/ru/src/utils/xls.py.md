# Модуль `src.utils.xls`

## Обзор

Модуль предоставляет функциональность для конвертации файлов Excel (`xls`) в формат JSON и обратно. Он позволяет читать данные из Excel-файлов, преобразовывать их в JSON, работать с несколькими листами, а также сохранять JSON-данные обратно в Excel-файлы.

## Подробнее

Модуль предназначен для обеспечения удобного способа обмена данными между Excel-файлами и JSON-форматом. Это может быть полезно для интеграции с другими системами, обработки данных и хранения конфигураций.

## Содержание

- [Функции](#Функции)
    - [`read_xls_as_dict`](#read_xls_as_dict)
    - [`save_xls_file`](#save_xls_file)

## Функции

### `read_xls_as_dict`

```python
def read_xls_as_dict(
    xls_file: str,
    json_file: str = None,
    sheet_name: Union[str, int] = None
) -> Union[Dict, List[Dict], bool]:
    """
    Читает Excel-файл и преобразует его в JSON. При необходимости преобразует конкретный лист и сохраняет результат в JSON-файл.
    Обрабатывает ошибки.

    Args:
        xls_file (str): Путь к Excel-файлу.
        json_file (str, optional): Путь для сохранения JSON-файла. По умолчанию `None`.
        sheet_name (Union[str, int], optional): Имя или индекс листа Excel для чтения. По умолчанию `None`.

    Returns:
        Union[Dict, List[Dict], bool]: Возвращает словарь или список словарей с данными из Excel-файла.
        Если `sheet_name` указан как `None`, возвращается словарь, где ключи - имена листов, а значения - списки словарей.
        Если `sheet_name` указан, возвращается список словарей с данными из указанного листа.
        Возвращает `False` в случае ошибки.

    Raises:
        FileNotFoundError: Если Excel-файл не найден.
        Exception: Если возникает ошибка при обработке листа или другая непредвиденная ошибка.

    Example:
        >>> data = read_xls_as_dict('input.xlsx', 'output.json', 'Sheet1')
        >>> if data:
        ...     print(data)  # Output will be {'Sheet1': [{...}]}
    """
```

**Как работает функция**:

1.  Функция принимает путь к Excel-файлу (`xls_file`), опциональный путь для сохранения JSON-файла (`json_file`) и опциональное имя листа (`sheet_name`).
2.  Проверяет существование Excel-файла по указанному пути. Если файл не найден, функция логирует ошибку и возвращает `False`.
3.  Использует библиотеку `pandas` для чтения Excel-файла.
4.  Если `sheet_name` не указан, функция перебирает все листы в Excel-файле и преобразует каждый лист в словарь, где ключом является имя листа, а значением - список словарей, представляющих строки листа.
5.  Если `sheet_name` указан, функция читает только указанный лист и преобразует его в список словарей.
6.  Если указан `json_file`, функция сохраняет полученные данные в JSON-файл.
7.  В случае возникновения ошибок при обработке листов или других исключений, функция логирует ошибку и возвращает `False`.
8.  В случае успешного выполнения возвращает словарь или список словарей с данными из Excel-файла.

### `save_xls_file`

```python
def save_xls_file(data: Dict[str, List[Dict]], file_path: str) -> bool:
    """Сохраняет JSON-данные в Excel-файл. Обрабатывает ошибки."""
    try:
        with pd.ExcelWriter(file_path, engine='xlsxwriter') as writer:
            for sheet_name, rows in data.items():
                df = pd.DataFrame(rows)
                df.to_excel(writer, sheet_name=sheet_name, index=False)
                logging.info(f"Sheet '{sheet_name}' saved to {file_path}")
        return True
    except Exception as ex:
        logging.error(f"Error saving Excel file: {ex}")
        return False
```

**Как работает функция**:

1.  Функция принимает словарь `data`, где ключи - это имена листов, а значения - списки словарей, представляющих строки для каждого листа, и путь к файлу (`file_path`), куда нужно сохранить Excel-файл.
2.  Использует `pd.ExcelWriter` для создания Excel-файла с использованием движка `xlsxwriter`.
3.  Перебирает все листы и соответствующие им данные в словаре `data`.
4.  Для каждого листа создает `pd.DataFrame` из списка словарей.
5.  Сохраняет `DataFrame` в Excel-файл на соответствующий лист, отключая запись индексов строк.
6.  Логирует информацию об успешном сохранении каждого листа.
7.  В случае возникновения ошибки логирует ошибку и возвращает `False`.
8.  В случае успешного выполнения возвращает `True`.
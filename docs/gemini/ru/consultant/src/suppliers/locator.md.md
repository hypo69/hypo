# Анализ кода модуля `locator.md`

**Качество кода**

-  Плюсы
    -  Документ содержит подробное описание структуры и назначения локаторов.
    -  Приведены примеры использования локаторов для различных ситуаций.
    -  Есть описание различных типов селекторов и событий.
    -  Документ хорошо структурирован и понятен.
 -  Минусы
    -  Документ не содержит примеров кода на Python, но это скорее специфика формата.
    -  Некоторые моменты можно было бы сделать более наглядными через RST.
    -  Отсутствует описание для ключа `timeout`.

**Рекомендации по улучшению**

1.  **Добавить описание ключа `timeout`**: в разделе "Key Descriptions for Locators" добавить описание ключа `timeout`.
2.  **Улучшить форматирование примеров**: Использовать `code-block` для более корректного отображения JSON примеров в RST.
3.  **Добавить примеры использования в Python**: Добавить примеры того, как можно использовать эти локаторы в коде Python.
4.  **Оформить в RST**: Перевести текст в формат `reStructuredText (RST)`, включая все комментарии.

**Оптимизированный код**

```markdown
# Локаторы полей на `HTML` странице
=========================================================================================

Описание структуры и назначения локаторов для `HTML` элементов.
Примеры использования, типы селекторов и событий.

.. note::
    Структура локаторов представлена в формате `JSON`, где каждый ключ соответствует полю
    в классе `ProductFields`.

Пример локатора:
----------------

.. code-block:: json
   :linenos:

   {
        "close_banner": {
            "attribute": null,
            "by": "XPATH",
            "selector": "//button[@id = 'closeXButton']",
            "if_list": "first",
            "use_mouse": false,
            "mandatory": false,
            "timeout": 0,
            "timeout_for_event": "presence_of_element_located",
            "event": "click()",
            "locator_description": "Закрытие всплывающего окна. Если оно не появляется - это не проблема (`mandatory`: `false`)."
          },
          "additional_images_urls": {
            "attribute": "src",
            "by": "XPATH",
            "selector": "//ol[contains(@class, 'flex-control-thumbs')]//img",
            "if_list": "all",
            "use_mouse": false,
            "mandatory": false,
             "timeout": 0,
            "timeout_for_event": "presence_of_element_located",
            "event": null,
            "locator_description": "Список `url` дополнительных изображений."
          },
          "id_supplier": {
            "attribute": "innerText",
            "by": "XPATH",
            "selector": "//span[@class = 'ltr sku-copy']",
            "if_list": "first",
            "use_mouse": false,
            "mandatory": true,
             "timeout": 0,
            "timeout_for_event": "presence_of_element_located",
            "event": null,
            "locator_description": "SKU Morlevi."
          },
          "default_image_url": {
            "attribute": null,
            "by": "XPATH",
            "selector": "//a[@id = 'mainpic']//img",
            "if_list": "first",
            "use_mouse": false,
             "timeout": 0,
            "timeout_for_event": "presence_of_element_located",
            "event": "screenshot()",
            "mandatory": true,
            "locator_description": "Внимание! В Morlevi изображение получается через скриншот и возвращается как PNG (`bytes`)."
          }
    }

Детали
------

Имя словаря соответствует имени поля в классе `ProductFields` (
`подробнее о ProductFields <../product/product_fields>`_).

-   **`attribute`**: Атрибут, который нужно получить из веб-элемента. Примеры: `innerText`, `src`, `id`, `href` и т.д.
    Если `attribute` установлен в `none/false`, WebDriver вернет весь веб-элемент (`WebElement`).

-   **`by`**: Стратегия поиска элемента:
    - `ID` соответствует `By.ID`
    - `NAME` соответствует `By.NAME`
    - `CLASS_NAME` соответствует `By.CLASS_NAME`
    - `TAG_NAME` соответствует `By.TAG_NAME`
    - `LINK_TEXT` соответствует `By.LINK_TEXT`
    - `PARTIAL_LINK_TEXT` соответствует `By.PARTIAL_LINK_TEXT`
    - `CSS_SELECTOR` соответствует `By.CSS_SELECTOR`
    - `XPATH` соответствует `By.XPATH`

-   **`selector`**: Селектор, определяющий, как найти веб-элемент. Примеры:
    ``(//li[@class = 'slide selected previous'])[1]//img``,
    ``//a[@id = 'mainpic']//img``,
    ``//span[@class = 'ltr sku-copy']``.

-   **`if_list`**: Определяет, что делать со списком найденных веб-элементов (`web_element`). Возможные значения:
    -   `first`: вернуть первый элемент из списка.
    -   `all`: вернуть все элементы.
    -   `last`: вернуть последний элемент.
    -   `even`, `odd`: вернуть четные/нечетные элементы.
    -   Конкретные числа, например `1,2,...` или `[1,3,5]`: вернуть элементы с указанными номерами.
    Также можно указать номер элемента прямо в селекторе, например:
    ``(//div[contains(@class, 'description')])[2]//p``

-   **`use_mouse`**: `true` | `false`
    Определяет, следует ли использовать мышь для взаимодействия с элементом.

-   **`event`**: WebDriver может выполнить действие с веб-элементом, например, `click()`, `screenshot()`, `scroll()` и т.д.
    **Важно**: Если указано `event`, он будет выполнен **перед** получением значения из `attribute`.
    Пример:

    .. code-block:: json
       :linenos:

       {
           "...": "...",
           "attribute": "href",
           "...": "...",
           "timeout": 0,
           "timeout_for_event": "presence_of_element_located",
           "event": "click()",
           "...": "..."
       }

    В этом случае драйвер сначала выполнит `click()` на веб-элементе, а затем получит его атрибут `href`.
    Последовательность действий: **действие -> атрибут**.

    Другие примеры событий:
        - `screenshot()` возвращает веб-элемент в виде скриншота. Полезно, когда `CDN` сервер не возвращает изображение через `URL`.
        - `send_message()` отправляет сообщение веб-элементу.
          Рекомендуется отправлять сообщение через переменную `%EXTERNAL_MESSAGE%`, как показано ниже:
        - ``{"timeout": 0, "timeout_for_event": "presence_of_element_located", "event": "click();backspace(10);%EXTERNAL_MESSAGE%"}``
          Эта последовательность выполнит:

          <ol type="1">
            <li><code>click()</code> - кликает на веб-элемент (фокусируется на поле ввода) <code>&lt;textbox&gt;</code>.</li>
            <li><code>backspace(10)</code> - перемещает каретку на 10 символов влево (очищает текст в поле ввода).</li>
            <li><code>%EXTERNAL_MESSAGE%</code> - отправляет сообщение в поле ввода.</li>
          </ol>

- **`mandatory`**: Является ли локатор обязательным.
  Если `{mandatory: true}` и взаимодействие с элементом невозможно, будет выдана ошибка. Если `mandatory: false`, элемент будет пропущен.

-   **`locator_description`**: Описание локатора.

---

Сложные локаторы
----------------

В ключах локатора можно передавать списки, кортежи или словари.

Пример локатора со списками:
----------------------------

.. code-block:: json
   :linenos:

   "sample_locator": {
        "attribute": [
          null,
          "href"
        ],
        "by": [
          "XPATH",
          "XPATH"
        ],
        "selector": [
          "//a[contains(@href, '#tab-description')]",
          "//div[@id = 'tab-description']//p"
        ],
        "timeout": 0,
        "timeout_for_event": "presence_of_element_located",
        "event": [
          "click()",
          null
        ],
        "if_list": "first",
        "use_mouse": [
          false,
          false
        ],
        "mandatory": [
          true,
          true
        ],
        "locator_description": [
          "Клик по вкладке, чтобы открыть поле с описанием.",
          "Чтение данных из div."
        ]
      }

В этом примере будет найден первый элемент `//a[contains(@href, '#tab-description')]`.
Драйвер выполнит `click()` и затем получит атрибут `href` элемента `//a[contains(@href, '#tab-description')]`.

Пример локатора со словарем:
----------------------------

.. code-block:: json
   :linenos:

    "sample_locator": {
      "attribute": {"href": "name"},
      "..." : "..."
    }

---

Описание ключей для локаторов
-----------------------------

1.  **`attribute`**:
    Этот ключ указывает атрибут, который будет использоваться для извлечения данных из элемента.
    `null` означает, что атрибут не используется для поиска элемента.

2.  **`by`**:
    Определяет метод поиска элемента на странице. В данном случае это `XPATH`, что означает использование XPath для поиска элемента.

3.  **`selector`**:
    Строка локатора, которая будет использоваться для поиска веб-элемента.
    В данном случае это XPath выражение ``"//a[@id = 'mainpic']//img"``, которое находит изображение внутри тега `a` с `id='mainpic'`.

4.  **`if_list`**:
    Определяет правило обработки списка элементов. В данном случае `first` означает, что будет возвращен первый элемент из списка.

5.  **`use_mouse`**:
    Логическое значение, указывающее, использовать ли мышь для взаимодействия с элементом.
    Установлено в `false`, что означает, что взаимодействие с мышью не требуется.

6. **`timeout`**:
    Время ожидания (в секундах) для поиска элемента. Значение `0` означает отсутствие ожидания; элемент будет найден немедленно.

7.  **`timeout_for_event`**:
    Время ожидания (в секундах) для события. `"presence_of_element_located"` означает, что WebDriver будет ждать, пока элемент не появится, прежде чем выполнять событие.

8.  **`event`**:
    Действие, которое будет выполнено на веб-элементе, такое как `click()`, `screenshot()`, `scroll()` и т. д.
    Событие будет выполнено перед получением значения из `attribute`.

9.  **`mandatory`**:
    Указывает, является ли локатор обязательным.
    Если установлено значение `true`, будет выдана ошибка, если элемент не может быть найден или с ним нельзя взаимодействовать.

10. **`locator_description`**:
    Описание локатора, предоставляющее дополнительный контекст о том, что он делает.

---------------

-   Расположение страницы может меняться, например, между настольной и мобильной версиями. В таких случаях рекомендуется поддерживать отдельные файлы локаторов для каждой версии.
    Пример: `product.json`, `product_mobile_site.json`.
```
# Модуль для поиска фильмов на Kinopoisk
## Обзор

Модуль `search.py` предназначен для поиска информации о фильмах и сериалах на сайте Kinopoisk с использованием поисковой системы Google. Он принимает поисковый запрос и тип контента (фильм или сериал) и возвращает ссылку на страницу Kinopoisk, название и краткое описание найденного фильма или сериала.

## Подробней

Данный модуль используется в проекте `hypotez` для поиска информации о фильмах и сериалах по запросу пользователя. Он использует библиотеки `requests` для выполнения HTTP-запросов к Google, `bs4` (Beautiful Soup) для парсинга HTML-ответа, `dotenv` для загрузки переменных окружения и `useragent` для получения случайного User-Agent.

## Функции

### `search_query`

```python
def search_query(query: str, type_movie: str = 'series') -> dict | None:
    """
    Выполняет поиск фильма или сериала на Kinopoisk через поисковую систему Google.

    Args:
        query (str): Поисковый запрос (название фильма или сериала).
        type_movie (str): Тип контента ('series' для сериалов, 'film' для фильмов). По умолчанию 'series'.

    Returns:
        dict | None: Словарь с информацией о фильме/сериале (ссылка, название, описание) или None, если ничего не найдено.
        Пример возвращаемого словаря:
        {
            'link': 'https://w2.kpfr.wiki/series/123456/',
            'title': 'Название фильма/сериала',
            'description': 'Краткое описание фильма/сериала...'
        }
        Возвращает None в случае, если ничего не найдено.
    Raises:
        requests.exceptions.RequestException: в случае проблем с запросом к Google
        bs4.BeautifulSoup: при ошибке парсинга HTML

    Example:
        >>> search_query('теория большого взрыва')
        {'link': 'https://w2.kpfr.wiki/series/2144/', 'title': 'Теория большого взрыва (сериал 2007 – 2019)', 'description': 'Двое блестящих физиков, Леонард и Шелдон, «…'}
    """
    ...
```

**Назначение**: Выполняет поиск фильма или сериала на Kinopoisk, используя поисковую систему Google.

**Параметры**:

- `query` (str): Поисковый запрос (название фильма или сериала).
- `type_movie` (str): Тип контента ('series' для сериалов, 'film' для фильмов). По умолчанию 'series'.

**Возвращает**:

- `dict | None`: Словарь с информацией о фильме/сериале (ссылка, название, описание) или `None`, если ничего не найдено.

**Как работает функция**:

1.  **Формирование поискового запроса**: Функция формирует поисковый запрос для Google, используя переданные параметры `query` и `type_movie`. Запрос формируется в формате `site:www.kinopoisk.ru/{type_movie} {query}`.
2.  **Выполнение HTTP-запроса**: Функция отправляет HTTP-запрос к Google с использованием библиотеки `requests`. В запросе передаются параметры `q` (поисковый запрос) и `hl` (язык интерфейса - русский). Также устанавливается заголовок `User-Agent` для имитации запроса от браузера.
3.  **Парсинг HTML-ответа**: Функция получает HTML-ответ от Google и парсит его с использованием библиотеки `Beautiful Soup`.
4.  **Поиск результатов**: Функция ищет в HTML-коде блоки с результатами поиска (элементы `div` с классом `g`).
5.  **Извлечение информации**: Для каждого найденного результата функция извлекает ссылку, заголовок и описание.
6.  **Проверка ссылки**: Функция проверяет, что ссылка ведет на страницу Kinopoisk и что идентификатор фильма/сериала в ссылке является числом.
7.  **Формирование результата**: Если все проверки пройдены, функция формирует словарь с информацией о фильме/сериале и возвращает его.
8.  **Обработка ошибок**: Если в процессе поиска или парсинга произошла ошибка, функция логирует ее и возвращает `None`.

```
Поисковый запрос (query, type_movie)
     │
     ▼
     ►►► Формирование поискового запроса для Google
     │
     ▼
     ►►► HTTP-запрос к Google (requests.get)
     │
     ▼
     ►►► Парсинг HTML-ответа (BeautifulSoup)
     │
     ▼
     ►►► Поиск блоков с результатами поиска (soup.find_all)
     │
     ▼
   Нет результатов?
   ├─► Да: Возврат None
   │  
   ├─► Нет: 
   │   │
   │   ▼
   │   ►►► Извлечение ссылки, заголовка и описания для каждого результата
   │   │
   │   ▼
   │   ►►► Проверка ссылки (isdigit)
   │   │
   │   ▼
   │  Ссылка некорректна?
   │  ├─► Да: Следующий результат
   │  │  
   │  ├─► Нет: 
   │  │   │
   │  │   ▼
   │  │   ►►► Формирование словаря с информацией о фильме/сериале
   │   │
   │   ▼
   │   Возврат словаря
   │  
   ▼
Конец
```

**Примеры**:

```python
search_query('теория большого взрыва')
# {'link': 'https://w2.kpfr.wiki/series/2144/', 'title': 'Теория большого взрыва (сериал 2007 – 2019)', 'description': 'Двое блестящих физиков, Леонард и Шелдон, «…'}

search_query('matrix', type_movie='film')
# {'link': 'https://w2.kpfr.wiki/film/301/', 'title': 'Матрица (1999)', 'description': 'Жизнь Томаса Андерсона разделена на две части: днём он — самый обычный офисный…'}

search_query('nonexistent movie')
# None
```

### Внутренние функции
Внутри функции `search_query` нет внутренних функций.

## Пример использования

```python
if __name__ == '__main__':
    print(search_query('теория большого взрыва'))
```
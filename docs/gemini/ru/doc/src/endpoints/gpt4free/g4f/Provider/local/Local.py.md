# Модуль для работы с локальными моделями GPT4All

## Обзор

Модуль предоставляет класс `Local`, который позволяет использовать локально установленные модели GPT4All для генерации текста. Он интегрируется с `LocalProvider` из того же пакета для выполнения фактической генерации. Модуль также обрабатывает зависимости и возвращает ошибку, если необходимые библиотеки не установлены.

## Подробней

Этот модуль является частью системы `hypotez` и предназначен для обеспечения возможности работы с моделями GPT4All без необходимости подключения к внешним API. Он позволяет запускать модели локально, что может быть полезно в ситуациях, когда требуется высокая скорость ответа или отсутствует подключение к интернету.

## Классы

### `Local`

**Описание**: Класс для работы с локальными моделями GPT4All.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для всех провайдеров моделей.
- `ProviderModelMixin`: Миксин для добавления функциональности управления моделями.

**Атрибуты**:
- `label` (str): Название провайдера - "GPT4All".
- `working` (bool): Флаг, указывающий, что провайдер работает - `True`.
- `supports_message_history` (bool): Флаг, указывающий, что провайдер поддерживает историю сообщений - `True`.
- `supports_system_message` (bool): Флаг, указывающий, что провайдер поддерживает системные сообщения - `True`.
- `supports_stream` (bool): Флаг, указывающий, что провайдер поддерживает потоковую передачу - `True`.
- `models` (list): Список доступных моделей, инициализируется при первом вызове `get_models`.
- `default_model` (str): Модель по умолчанию, выбирается из списка доступных моделей.

**Методы**:
- `get_models()`: Возвращает список доступных моделей.
- `create_completion(model: str, messages: Messages, stream: bool, **kwargs) -> CreateResult`: Создает завершение для заданных сообщений, используя указанную модель.

## Функции

### `get_models`

```python
@classmethod
def get_models(cls):
    """Возвращает список доступных моделей.

    Если список моделей не был инициализирован, он инициализируется с помощью `get_models()` из модуля `...locals.models`.
    Список моделей сохраняется в атрибуте `cls.models` для последующих вызовов.
    Модель по умолчанию выбирается из первого элемента списка.

    Args:
        cls: Ссылка на класс `Local`.

    Returns:
        list: Список доступных моделей.

    """
```

**Назначение**: Получение списка доступных моделей GPT4All.

**Параметры**:
- `cls`: Ссылка на класс `Local`.

**Возвращает**:
- `list`: Список доступных моделей.

**Как работает функция**:
1. **Проверка инициализации**: Проверяет, был ли уже инициализирован список моделей (`cls.models`).
2. **Инициализация моделей**: Если список моделей не был инициализирован, он заполняется с использованием функции `get_models()` из модуля `...locals.models`.
3. **Сохранение моделей**: Сохраняет полученный список моделей в атрибуте класса `cls.models`.
4. **Выбор модели по умолчанию**: Устанавливает первую модель из списка в качестве модели по умолчанию (`cls.default_model`).
5. **Возврат списка моделей**: Возвращает список доступных моделей.

**ASCII Flowchart**:

```
Проверка инициализации
     │
     └──> Инициализация моделей (если не инициализированы)
     │
     └──> Сохранение моделей
     │
     └──> Выбор модели по умолчанию
     │
     └──> Возврат списка моделей
```

### `create_completion`

```python
@classmethod
def create_completion(
    cls,
    model: str,
    messages: Messages,
    stream: bool,
    **kwargs
) -> CreateResult:
    """Создает завершение для заданных сообщений, используя указанную модель.

    Проверяет, установлены ли необходимые библиотеки (`gpt4all`). Если нет, вызывает исключение `MissingRequirementsError`.
    Использует `LocalProvider.create_completion()` для фактического создания завершения.

    Args:
        cls: Ссылка на класс `Local`.
        model (str): Название модели для использования.
        messages (Messages): Список сообщений для передачи в модель.
        stream (bool): Флаг, указывающий, нужно ли использовать потоковую передачу.
        **kwargs: Дополнительные аргументы для передачи в `LocalProvider.create_completion()`.

    Returns:
        CreateResult: Результат создания завершения.

    Raises:
        MissingRequirementsError: Если не установлены необходимые библиотеки (`gpt4all`).

    """
```

**Назначение**: Создание завершения (completion) для заданных сообщений с использованием указанной модели GPT4All.

**Параметры**:
- `cls`: Ссылка на класс `Local`.
- `model` (str): Название модели для использования.
- `messages` (Messages): Список сообщений для передачи в модель.
- `stream` (bool): Флаг, указывающий, нужно ли использовать потоковый режим.
- `**kwargs`: Дополнительные аргументы, передаваемые в `LocalProvider.create_completion()`.

**Возвращает**:
- `CreateResult`: Результат создания завершения.

**Вызывает исключения**:
- `MissingRequirementsError`: Если не установлены необходимые библиотеки (`gpt4all`).

**Как работает функция**:

1. **Проверка зависимостей**: Проверяет, установлены ли необходимые библиотеки (`gpt4all`). Если `has_requirements` равен `False`, вызывается исключение `MissingRequirementsError`.
2. **Создание завершения**: Вызывает метод `create_completion()` класса `LocalProvider`, передавая ему модель, сообщения, флаг потоковой передачи и дополнительные аргументы. Используется `cls.get_model(model)` для получения экземпляра модели.
3. **Возврат результата**: Возвращает результат, полученный от `LocalProvider.create_completion()`.

**ASCII Flowchart**:

```
Проверка зависимостей (has_requirements)
     │
     └──> Вызов исключения MissingRequirementsError (если зависимости не установлены)
     │
     └──> Создание завершения через LocalProvider.create_completion()
     │
     └──> Возврат результата
```
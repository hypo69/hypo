# Модуль `src.scenario`

## Обзор

Модуль `src.scenario` предназначен для автоматизации взаимодействия с поставщиками с помощью сценариев, описанных в файлах JSON. Его основная задача - адаптация процесса извлечения и обработки данных о продуктах с веб-сайтов поставщиков и синхронизация этой информации с базой данных вашей системы.

## Оглавление

[Оглавление](#оглавление)
* [Обзор](#обзор)
* [Функции модуля](#функции-модуля)
* [Основные компоненты модуля](#основные-компоненты-модуля)
* [Пример сценария](#пример-сценария)
* [Работа модуля](#работа-модуля)
* [Поток выполнения скрипта](#поток-выполнения-скрипта)
* [Описание кода в `executor.py`](#описание-кода-в-executorpy)


## Функции модуля

1. **Чтение сценариев**: Модуль загружает сценарии из файлов JSON, содержащих информацию о различных категориях продуктов и их URL-адресах на веб-сайте поставщика.
2. **Взаимодействие с веб-сайтами**: Используя URL-адреса, указанные в сценариях, модуль переходит на страницы продуктов и извлекает необходимые данные.
3. **Обработка данных**: Модуль обрабатывает извлечённые данные о продуктах, преобразует их в нужный формат и сохраняет в базе данных вашей системы (например, PrestaShop).
4. **Ведение журнала выполнения**: Модуль ведёт журнал выполнения сценариев, записывая детали выполнения и результаты, что помогает отслеживать успехи и выявлять ошибки.


## Основные компоненты модуля

### `run_scenario_files(s, scenario_files_list)`

**Описание**: Выполняет список файлов сценариев последовательно.

**Параметры**:
- `s` (объект `Supplier`): экземпляр класса поставщика.
- `scenario_files_list` (Список строк): список путей к файлам сценариев.

**Возвращает**:
- `bool`: `True`, если все сценарии успешно выполнены, иначе `False`.


### `run_scenario_file(s, scenario_file)`

**Описание**: Загружает сценарий из файла и выполняет его.

**Параметры**:
- `s` (объект `Supplier`): экземпляр класса поставщика.
- `scenario_file` (строка): путь к файлу сценария.

**Возвращает**:
- `bool`: `True`, если сценарий успешно выполнен, иначе `False`.


### `run_scenario(s, scenario, scenario_name)`

**Описание**: Выполняет конкретный сценарий.

**Параметры**:
- `s` (объект `Supplier`): экземпляр класса поставщика.
- `scenario` (словарь): словарь, содержащий данные сценария.
- `scenario_name` (строка): имя сценария.

**Возвращает**:
- `list` или `dict`: результат выполнения сценария или `False` при возникновении ошибки.

**Возможные исключения**:
- Ошибки ввода/вывода (IOError) при работе с файлами.
- Ошибки сети (например, ConnectionError) при доступе к веб-страницам.


### `dump_journal(s, journal)`

**Описание**: Сохраняет журнал выполнения сценариев в файл.

**Параметры**:
- `s`: Экземпляр класса поставщика.
- `journal`: Словарь с информацией о журнале.

**Возвращает**:
- `None`


### `main()`

**Описание**: Главная функция модуля.


## Пример сценария

Пример JSON-сценария описывает, как взаимодействовать со специфическими категориями продуктов на веб-сайте. Он включает:
- **URL страницы**: для навигации и извлечения данных.
- **Название категории**: для идентификации категории.
- **`presta_categories`**: идентификаторы категорий в базе данных PrestaShop, где будут сохранены продукты.

```json
{
    "scenarios": {
        "example_scenario": {
            "url": "https://example.com/category",
            "name": "example_scenario",
            "presta_categories": {
                "default_category": 123,
                "additional_categories": [456]
            }
        }
    }
}
```


## Работа модуля

1. **Загрузка сценариев**: Модуль загружает и анализирует сценарии из файлов.
2. **Извлечение данных**: Переходит по URL из сценария, извлекает ссылки на продукты и собирает информацию о них.
3. **Сохранение данных**: Обрабатывает и сохраняет собранные данные в базе данных, используя информацию о категориях из сценария.
4. **Отчёты и логирование**: Ведёт журнал выполнения сценариев для отслеживания прогресса и записи ошибок.


## Поток выполнения скрипта

(Подробно описан в секции "Workflow for Script Executor Module")


## Описание кода в `executor.py`

(Подробное описание функций, методов и работы модуля представлено в секции "Explanation of the code in executor.py")

## Замечания

Этот документ предоставляет краткий обзор модуля `src.scenario`.  Для более детального понимания, необходимо обратиться к подробным описаниям функций и методов в секции "Explanation of the code in executor.py".

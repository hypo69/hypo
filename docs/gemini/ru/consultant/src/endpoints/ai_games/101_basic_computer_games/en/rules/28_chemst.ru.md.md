# Анализ кода модуля `28_chemst.ru.md`

**Качество кода**

*   Соответствие требованиям по оформлению кода: 2/10
    *   Плюсы:
        *   Документ содержит описание игры и инструкции по ее реализации.
    *   Минусы:
        *   Отсутствует код игры, только текстовое описание.
        *   Не используется reStructuredText (RST) для комментариев.
        *   Нет импортов, функций или классов.
        *   Не используются логирование и обработка ошибок.
        *   Нет примеров кода в формате RST.

**Рекомендации по улучшению**

1.  **Добавить код игры**: Необходимо реализовать саму игру, следуя предоставленным инструкциям.
2.  **Использовать RST**: Оформить документацию в формате reStructuredText (RST), включая описания модуля, функций, методов и переменных.
3.  **Реализовать логику игры**: Включить функции для ввода данных, расчета, проверки ответов и управления жизнями игрока.
4.  **Добавить логирование**: Использовать `logger` для отслеживания ошибок и хода игры.
5.  **Обработка ошибок**: Реализовать корректную обработку ошибок, избегая избыточного использования `try-except`.
6.  **Оформить код**: Привести код в соответствие со стандартами оформления Python (PEP 8).
7.  **Улучшить интерактивность**: Сделать взаимодействие с пользователем более интуитивным и информативным.
8.  **Структурировать код**: Разделить код на логические блоки, используя функции и классы.
9.  **Документировать код**: Добавить docstring для каждой функции и метода.

**Оптимизированный код**
```markdown
### Название игры: **CHEMST** (Химическое разведение)

#### Описание
**CHEMST** — это игра, в которой игрок должен правильно развести вымышленную химическую субстанцию — криптоксианидную кислоту (kryptocyanic acid). Для того, чтобы сделать кислоту безопасной, необходимо соблюдать точное соотношение: 7 частей воды на 3 части кислоты. Если игрок ошибается в расчетах более чем на 5%, то его жизнь теряется. Игроку дается 9 жизней, и игра продолжается, пока они не закончатся, или пока игрок не решит выйти.

---

### Пошаговая инструкция для реализации

#### 1. **Инициализация игры**
   - Программа сообщает о наличии криптоксианидной кислоты и необходимости соблюдения точного соотношения 7:3 (вода:кислота).
   - Игроку предлагается ввести количество кислоты (например, 30 литров) и затем рассчитать, сколько воды нужно добавить.

#### 2. **Основной цикл игры**
   - **Ввод данных:**
     1. Игрок вводит количество кислоты, которое нужно развести.
     2. Затем программа рассчитывает, сколько воды необходимо добавить для безопасного разведения (по формуле: количество кислоты * 7 / 3).
   - **Проверка результата:**
     - Если ответ отклоняется от правильного значения на 5% или больше, игрок теряет жизнь.
     - Если ответ правильный, программа сообщает, что смесь безопасна.

#### 3. **Подсчёт победителя**
   - Игра не имеет традиционного победителя, однако игрок может выиграть, сохранив все свои жизни, или проиграть, потеряв все жизни.

#### 4. **Завершение игры**
   - Игра продолжается до тех пор, пока у игрока не заканчиваются жизни, или пока он не решит выйти.
   - По завершении игры игроку предложат начать заново:
     ```
     Хотите сыграть снова? (да/нет)
     ```

---

### Пример работы программы

1. **Начало игры:**
   ```
   Добро пожаловать в игру CHEMST!
   Чтобы разбавить криптоксианидную кислоту, соблюдайте соотношение 7 частей воды на 3 части кислоты.\n
   Введите количество кислоты, которое вы хотите развести (в литрах): 30
   ```

2. **Ввод расчета:**
   ```
   Сколько воды нужно добавить для разведения 30 литров кислоты? (7:3)
   > 70
   ```

3. **Проверка ответа:**
   ```
   Правильный ответ! Вы успешно развели кислоту.
   ```

4. **Завершение игры:**
   ```
   Хотите сыграть снова? (да/нет)
   > нет
   Спасибо за игру!
   ```

---

### Возможные ограничения
- Программа не поддерживает сложные типы расчетов или различные химические реакции.
- Игрок должен соблюдать точность расчета, иначе потеряет жизни.

---

### Реализация
Игра реализована с использованием базовых арифметических вычислений для расчета правильной дозы воды, а также механизма отслеживания жизней игрока.

```python
"""
Модуль содержит реализацию игры CHEMST (Химическое разведение).

Игра, в которой игрок должен правильно развести криптоксианидную кислоту, соблюдая соотношение 7:3 (вода:кислота).
"""

import logging
from typing import Tuple
from src.utils.jjson import j_loads
# from src.logger.logger import logger # TODO: подключение логгера

#  Инициализация логгера
logger = logging.getLogger(__name__)
logger.setLevel(logging.DEBUG) # TODO: перенеси в конфиг

formatter = logging.Formatter('%(asctime)s - %(levelname)s - %(message)s')

file_handler = logging.FileHandler('chemst.log', encoding='utf-8')
file_handler.setFormatter(formatter)
logger.addHandler(file_handler)

def calculate_water_amount(acid_amount: float) -> float:
    """
    Рассчитывает необходимое количество воды для разведения кислоты.

    :param acid_amount: Количество кислоты в литрах.
    :return: Количество воды в литрах.
    """
    return acid_amount * 7 / 3


def is_answer_correct(user_answer: float, correct_answer: float, tolerance: float = 0.05) -> bool:
    """
    Проверяет, является ли ответ игрока правильным с учетом допустимой погрешности.

    :param user_answer: Ответ игрока.
    :param correct_answer: Правильный ответ.
    :param tolerance: Допустимая погрешность.
    :return: True, если ответ правильный, иначе False.
    """
    lower_bound = correct_answer * (1 - tolerance)
    upper_bound = correct_answer * (1 + tolerance)
    return lower_bound <= user_answer <= upper_bound


def play_chemst() -> None:
    """
    Запускает игру CHEMST.

    Организует основной цикл игры, включая ввод данных, проверку ответов и управление жизнями игрока.
    """
    lives = 9
    logger.info('Начало игры CHEMST') # Лог
    print("Добро пожаловать в игру CHEMST!\nЧтобы разбавить криптоксианидную кислоту, соблюдайте соотношение 7 частей воды на 3 части кислоты.")

    while lives > 0:
        try:
            acid_amount = float(input("Введите количество кислоты, которое вы хотите развести (в литрах): ")) # Запрос количества кислоты
        except ValueError:
            logger.error('Некорректный ввод количества кислоты.') # Лог
            print("Пожалуйста, введите корректное число.")
            continue # Обработка некорректного ввода

        correct_water_amount = calculate_water_amount(acid_amount) # Вычисление правильного кол-ва воды

        try:
            user_water_amount = float(input(f"Сколько воды нужно добавить для разведения {acid_amount} литров кислоты? (7:3)\n> ")) # Запрос ответа
        except ValueError:
            logger.error('Некорректный ввод количества воды.') # Лог
            print("Пожалуйста, введите корректное число.")
            continue # Обработка некорректного ввода

        if is_answer_correct(user_water_amount, correct_water_amount): # Проверка ответа
            print("Правильный ответ! Вы успешно развели кислоту.")
        else:
            lives -= 1
            logger.warning(f"Неверный ответ. Осталось жизней: {lives}") # Лог
            print(f"Неверный ответ! Вы потеряли жизнь. Осталось жизней: {lives}")

        if lives <= 0:
            print("У вас закончились жизни! Игра окончена.")
            logger.info("Игра окончена, закончились жизни.") # Лог
            break

        play_again = input("Хотите сыграть снова? (да/нет)\n> ").lower() # Запрос о повторной игре
        if play_again != 'да':
            print("Спасибо за игру!")
            logger.info("Игра окончена, игрок решил выйти.") # Лог
            break


if __name__ == '__main__':
    play_chemst()
```
# Документация для модуля `src.logger`

## Обзор

Модуль `src.logger` предоставляет гибкую систему логирования для Python-приложений, поддерживающую логирование в консоль, файлы и в формате JSON. Он использует шаблон проектирования Singleton для обеспечения использования единственного экземпляра логгера во всем приложении. Логгер поддерживает различные уровни логирования (например, `INFO`, `ERROR`, `DEBUG`) и включает цветное отображение для вывода в консоль. Также доступны настройки форматов вывода и управление логированием в различные файлы.

## Подробнее

Модуль `src.logger` предназначен для централизованного управления логированием в проекте `hypotez`. Он позволяет записывать сообщения разного уровня важности (информация, отладка, ошибки и т. д.) в различные источники, такие как консоль и файлы. Использование Singleton гарантирует, что все компоненты проекта используют один и тот же экземпляр логгера, что упрощает настройку и управление логированием.

## Классы

### `SingletonMeta`

**Описание**: Метакласс, реализующий шаблон Singleton.

**Принцип работы**:
Метакласс `SingletonMeta` гарантирует, что у класса будет только один экземпляр. При каждом запросе на создание экземпляра класса возвращается уже существующий экземпляр, если он есть, или создается новый экземпляр, который затем сохраняется для последующих запросов. Это позволяет избежать создания множественных экземпляров логгера и обеспечивает централизованное управление логированием.

### `JsonFormatter`

**Описание**: Кастомный форматтер для вывода логов в формате JSON.

**Принцип работы**:
Класс `JsonFormatter` используется для форматирования записей лога в формате JSON. Он наследуется от `logging.Formatter` и переопределяет метод `format`, чтобы преобразовывать записи лога в JSON-строки. Это позволяет легко записывать логи в формате, удобном для дальнейшей обработки и анализа.

### `Logger`

**Описание**: Основной класс логгера, поддерживающий логирование в консоль, файлы и в формате JSON.

**Принцип работы**:
Класс `Logger` предоставляет методы для логирования сообщений разного уровня важности (информация, отладка, ошибки и т. д.) в консоль и файлы. Он использует стандартный модуль `logging` для выполнения фактической записи логов и предоставляет удобные методы для настройки и управления логированием.

**Методы**:

- `__init__`: Инициализирует экземпляр класса Logger с плейсхолдерами для различных типов логгеров (консоль, файлы и JSON).
- `_configure_logger`: Настраивает и возвращает экземпляр логгера.
- `initialize_loggers`: Инициализирует логгеры для логирования в консоль и файлы (информация, отладка, ошибки и JSON).
- `log`: Логирует сообщение на указанном уровне (например, `INFO`, `DEBUG`, `ERROR`) с возможным исключением и цветовым форматированием.
- `info`: Логирует информационное сообщение.
- `success`: Логирует сообщение об успешной операции.
- `warning`: Логирует предупреждение.
- `debug`: Логирует сообщение для отладки.
- `error`: Логирует сообщение об ошибке.
- `critical`: Логирует критическое сообщение.

## Функции

### `__init__`

**Назначение**: Инициализирует экземпляр класса Logger.

**Параметры**:
- Нет параметров.

**Возвращает**:
- Нет возвращаемого значения.

**Как работает функция**:
1. Функция инициализирует плейсхолдеры для различных типов логгеров (консоль, файлы и JSON).

```
Инициализация плейсхолдеров для логгеров
```

**Примеры**:
```python
logger: Logger = Logger()
```

### `_configure_logger`

**Назначение**: Настраивает и возвращает экземпляр логгера.

```python
def _configure_logger(name: str, log_path: str, level: Optional[int] = logging.DEBUG, formatter: Optional[logging.Formatter] = None, mode: Optional[str] = 'a') -> logging.Logger:
    """
    Настраивает и возвращает экземпляр логгера.

    Args:
        name (str): Имя логгера.
        log_path (str): Путь к файлу логов.
        level (Optional[int], optional): Уровень логирования, например, `logging.DEBUG`. Значение по умолчанию — `logging.DEBUG`.
        formatter (Optional[logging.Formatter], optional): Кастомный форматтер (опционально).
        mode (Optional[str], optional): Режим работы с файлом, например, `'a'` для добавления (значение по умолчанию).

    Returns:
        logging.Logger: Настроенный экземпляр `logging.Logger`.
    """
    ...
```

**Параметры**:
- `name` (str): Имя логгера.
- `log_path` (str): Путь к файлу логов.
- `level` (Optional[int], optional): Уровень логирования, например, `logging.DEBUG`. Значение по умолчанию — `logging.DEBUG`.
- `formatter` (Optional[logging.Formatter], optional): Кастомный форматтер (опционально).
- `mode` (Optional[str], optional): Режим работы с файлом, например, `'a'` для добавления (значение по умолчанию).

**Возвращает**:
- `logging.Logger`: Настроенный экземпляр `logging.Logger`.

**Как работает функция**:
1. Функция создает экземпляр логгера с указанным именем.
2. Если указан путь к файлу логов, добавляет обработчик для записи логов в файл.
3. Устанавливает уровень логирования.
4. Если указан форматтер, устанавливает его для обработчика.
5. Возвращает настроенный экземпляр логгера.

```
A: Создание экземпляра логгера
↓
B: Добавление обработчика для записи логов в файл (если указан путь)
↓
C: Установка уровня логирования
↓
D: Установка форматтера (если указан)
↓
E: Возврат настроенного экземпляра логгера
```

**Примеры**:
```python
logger = _configure_logger(name='my_logger', log_path='logs/my_log.log', level=logging.INFO)
```

### `initialize_loggers`

**Назначение**: Инициализирует логгеры для логирования в консоль и файлы.

```python
def initialize_loggers(info_log_path: Optional[str] = '', debug_log_path: Optional[str] = '', errors_log_path: Optional[str] = '', json_log_path: Optional[str] = '') -> None:
    """
    Инициализирует логгеры для логирования в консоль и файлы (информация, отладка, ошибки и JSON).

    Args:
        info_log_path (Optional[str], optional): Путь к файлу логов информации (опционально).
        debug_log_path (Optional[str], optional): Путь к файлу логов отладки (опционально).
        errors_log_path (Optional[str], optional): Путь к файлу логов ошибок (опционально).
        json_log_path (Optional[str], optional): Путь к файлу логов в формате JSON (опционально).
    """
    ...
```

**Параметры**:
- `info_log_path` (Optional[str], optional): Путь к файлу логов информации (опционально).
- `debug_log_path` (Optional[str], optional): Путь к файлу логов отладки (опционально).
- `errors_log_path` (Optional[str], optional): Путь к файлу логов ошибок (опционально).
- `json_log_path` (Optional[str], optional): Путь к файлу логов в формате JSON (опционально).

**Возвращает**:
- Нет возвращаемого значения.

**Как работает функция**:
1. Функция настраивает и инициализирует логгеры для логирования в файлы информации, отладки, ошибок и JSON, если указаны соответствующие пути к файлам.
2. Также настраивает обработчик для вывода логов в консоль.

```
A: Настройка логгера для информации (если указан путь)
↓
B: Настройка логгера для отладки (если указан путь)
↓
C: Настройка логгера для ошибок (если указан путь)
↓
D: Настройка логгера для JSON (если указан путь)
↓
E: Настройка обработчика для вывода логов в консоль
```

**Примеры**:
```python
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
```

### `log`

**Назначение**: Логирует сообщение на указанном уровне.

```python
def log(level: int, message: str, ex: Optional[Exception] = None, exc_info: bool = False, color: Optional[Tuple[str, str]] = None) -> None:
    """
    Логирует сообщение на указанном уровне (например, `INFO`, `DEBUG`, `ERROR`) с возможным исключением и цветовым форматированием.

    Args:
        level (int): Уровень логирования (например, `logging.INFO`, `logging.DEBUG`).
        message (str): Логируемое сообщение.
        ex (Optional[Exception], optional): Исключение для логирования (опционально).
        exc_info (bool, optional): Включать информацию об исключении (значение по умолчанию — `False`).
        color (Optional[Tuple[str, str]], optional): Кортеж цветов текста и фона для консольного вывода (опционально).
    """
    ...
```

**Параметры**:
- `level` (int): Уровень логирования (например, `logging.INFO`, `logging.DEBUG`).
- `message` (str): Логируемое сообщение.
- `ex` (Optional[Exception], optional): Исключение для логирования (опционально).
- `exc_info` (bool, optional): Включать информацию об исключении (значение по умолчанию — `False`).
- `color` (Optional[Tuple[str, str]], optional): Кортеж цветов текста и фона для консольного вывода (опционально).

**Возвращает**:
- Нет возвращаемого значения.

**Как работает функция**:
1. Функция логирует сообщение на указанном уровне с возможным исключением и цветовым форматированием.
2. Если указано исключение, оно также логируется.
3. Если указан цвет, сообщение выводится в консоль с указанным цветом.

```
A: Логирование сообщения на указанном уровне
↓
B: Логирование исключения (если указано)
↓
C: Вывод сообщения в консоль с указанным цветом (если указан цвет)
```

**Примеры**:
```python
logger.info('Это информационное сообщение')
logger.error('Произошла ошибка', ex=ValueError('Неверное значение'), exc_info=True)
logger.info('Это сообщение будет зеленым', colors=(colorama.Fore.GREEN, colorama.Back.BLACK))
```

## Параметры логгера

Класс `Logger` принимает несколько опциональных параметров для настройки поведения логирования.

- **Уровень**: Контролирует, какие сообщения будут записаны. Основные уровни:
  - `logging.DEBUG`: Подробная информация для диагностики.
  - `logging.INFO`: Общая информация, например, успешные операции.
  - `logging.WARNING`: Предупреждения, не требующие немедленного действия.
  - `logging.ERROR`: Сообщения об ошибках.
  - `logging.CRITICAL`: Критические ошибки, требующие немедленного внимания.

- **Форматтер**: Определяет формат сообщений. По умолчанию используется `'%(asctime)s - %(levelname)s - %(message)s'`. Можно задать кастомный форматтер, например для JSON.

- **Цвета**: Задают цвет текста и фона в консоли. Цвета указываются кортежем:
  - **Цвет текста**: Например, `colorama.Fore.RED`.
  - **Цвет фона**: Например, `colorama.Back.WHITE`.

## Конфигурация для логирования в файл (`config`)

Для записи сообщений в файл можно указать пути в конфигурации.

```python
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
```

## Примеры использования

### 1. Инициализация логгера:

```python
logger: Logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
```

### 2. Логирование сообщений:

```python
logger.info('Это информационное сообщение')
logger.success('Это сообщение об успешной операции')
logger.warning('Это предупреждение')
logger.debug('Это сообщение для отладки')
logger.error('Это сообщение об ошибке')
logger.critical('Это критическое сообщение')
```

### 3. Настройка цветов:

```python
logger.info('Это сообщение будет зеленым', colors=(colorama.Fore.GREEN, colorama.Back.BLACK))
logger.error('Это сообщение с красным фоном', colors=(colorama.Fore.WHITE, colorama.Back.RED))
```

## Заключение

Модуль `src.logger` предоставляет полноценную систему логирования для Python-приложений. Вы можете настроить логирование в консоль и файлы с различными форматами и цветами, управлять уровнями логирования и обрабатывать исключения. Конфигурация логирования в файлы задается через словарь `config`, что позволяет легко изменять настройки.
# Файл `background.js`

## Обзор

Данный JavaScript-файл служит обработчиком сообщений для расширения браузера, предназначенного для сбора данных с веб-страниц и отправки их на сервер. Он прослушивает события `chrome.browserAction.onClicked` и `chrome.runtime.onMessage`, реагируя на сообщение `'collectData'` для сбора данных с указанного URL и их отправки на сервер.

## Обработчики событий

### `chrome.browserAction.onClicked`

**Описание**: Этот обработчик реагирует на клик на значок расширения браузера. При клике на значок, он отправляет сообщение в активную вкладку с действием `'collectData'` и URL текущей вкладки.

**Параметры**:
- `tab` (object): Объект, содержащий информацию о вкладке, включая идентификатор вкладки (`tab.id`) и URL (`tab.url`).

**Возвращает**:
- Нет возвращаемого значения.


### `chrome.runtime.onMessage.addListener`

**Описание**: Этот обработчик слушает сообщения, отправленные другими частями расширения.  Слушает сообщения с действием `'collectData'`. При получении такого сообщения, вызывает функцию `sendDataToServer`.

**Параметры**:
- `message` (object): Объект, содержащий сообщение, отправленное из других частей расширения. Ожидается свойство `message.action` со значением `'collectData'` и свойство `message.url` с URL, для которого нужно собрать данные.
- `sender` (object): Объект, содержащий информацию об отправителе сообщения.
- `sendResponse` (function): Функция, которая может быть использована для отправки ответа отправителю. В данном случае не используется.


**Возвращает**:
- `true`: Необходимо для асинхронной обработки сообщений.

**Вызывает исключения**:
- Нет.


## Функции

### `sendDataToServer`

**Описание**: Функция отправляет собранные данные на сервер.

**Параметры**:
- `url` (string): URL веб-страницы, для которой нужно отправить данные.

**Возвращает**:
- Нет возвращаемого значения.

**Вызывает исключения**:
- `Error`: Возникает, если произошла ошибка при отправке данных на сервер (например, ошибка сети или неверный ответ от сервера).


**Обработка ошибок**:

Функция `fetch` использует `.then` и `.catch` для обработки успешного ответа и ошибок соответственно. При успехе, в консоль выводится сообщение об успешной отправке. При ошибке, в консоль выводится сообщение об ошибке и описание ошибки.

**Замечания**:
- Обратите внимание, что код использует `chrome.storage.local.get('collectedData', ...)` для получения собранных данных.  В данном фрагменте кода нет определения `collectedData`, это предполагается, что эти данные уже были собраны и сохранены в хранилище расширения.
- `serverUrl` должен быть изменён на действительный адрес вашего сервера.


## Хранилище

**Описание**:
Для отправки данных на сервер используется хранилище `chrome.storage.local`.  Предполагается, что `collectedData` содержит данные, которые должны быть отправлены на сервер.


## API Chrome

**Описание**:
- `chrome.browserAction.onClicked`: Используется для обработки клика на значке расширения.
- `chrome.tabs.sendMessage`: Используется для отправки сообщения активной вкладке.
- `chrome.runtime.onMessage.addListener`: Используется для прослушивания сообщений, отправленных другими частями расширения.
- `chrome.storage.local`: Используется для хранения данных в хранилище расширения.


## Замечания

В данной документации предполагается, что данные, которые нужно отправить (`collectedData`) уже сохранены в хранилище (`chrome.storage.local`) расширения.  Необходимо добавить код для сохранения этих данных.  Также необходимо заменить `'http://127.0.0.1/hypotez.online/api/'` на фактический адрес API-эндпоинта вашего сервера.
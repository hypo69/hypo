# Документация для модуля обработки сценариев

## Обзор

Этот документ описывает логику обработки запросов на перевод продуктов, представленную в виде диаграммы Mermaid. Диаграмма описывает процесс обработки ответа от модели, включая валидацию данных, извлечение необходимой информации и обработку ошибок.

## Содержание

1. [Обзор](#обзор)
2. [Описание процесса](#описание-процесса)

## Описание процесса

### `flowchart TD`
   
Диаграмма начинается с блока `flowchart TD`, который обозначает начало определения блок-схемы.

### `A[Запрос на обработку продуктов products_list]`
   
   - **Описание**: Начальная точка процесса, обозначающая входящий запрос на обработку списка продуктов `products_list`.

### `B[Обработка запроса с командой модели]`

   - **Описание**: Отправка запроса на обработку списка продуктов в модель для получения перевода.

### `C[Ответ от модели]`
   
   - **Описание**: Получение ответа от модели. Ответ может быть в различных форматах (например, список или объект) и может содержать ошибки.

### Проверка на отсутствие ответа

#### `C -->|Нет ответа| D[Логирование ошибки no response from gemini]`
   
   - **Описание**: В случае, если ответ от модели отсутствует, фиксируется ошибка "no response from gemini".

#### `D --> E[Повторный запрос /attempts - 1/]`
   
   - **Описание**: После логирования ошибки, производится повторная отправка запроса с уменьшением счетчика попыток.

### Проверка на валидность данных

#### `C -->|Невалидные данные| F[Логирование ошибки /Error in data from gemini/]`
   
   - **Описание**: В случае, если полученный ответ от модели содержит невалидные данные, фиксируется ошибка "Error in data from gemini".

#### `F --> E`
   
   - **Описание**: После логирования ошибки, производится повторная отправка запроса.

### Проверка на полученные данные

#### `C -->|Получены данные| G{Данные в виде списка?}`
   
   - **Описание**: Проверка формата полученных данных: является ли это списком?

#### `G -->|Да| H{Содержит два элемента /ru, he/?}`
   
   - **Описание**: Если данные представляют собой список, проверяется, содержит ли список два элемента (предположительно, переводы на `ru` и `he`).
   
#### `H -->|Да| I[Извлечение ru и he]`
   
   - **Описание**: Если список содержит два элемента, то они извлекаются как переводы на `ru` и `he`.
   
#### `H -->|Нет| J[Извлечение ru и he из первого элемента]`
   
   - **Описание**: Если список не содержит два элемента, то происходит попытка извлечь переводы `ru` и `he` из первого элемента.
   
#### `H -->|Невалидная структура| K[Логирование ошибки /Проблема парсинга ответа/]`
   
   - **Описание**: Если структура ответа не соответствует ожидаемой, логируется ошибка "Проблема парсинга ответа".

#### `K --> E`
   
   - **Описание**: После логирования ошибки, производится повторная отправка запроса.

#### `G -->|Нет| L{Данные в виде объекта?}`
   
   - **Описание**: Если данные не являются списком, проверяется, являются ли они объектом.
   
#### `L -->|Да| M[Извлечение ru и he из объекта]`
   
   - **Описание**: Если данные являются объектом, производится извлечение переводов `ru` и `he` из этого объекта.
   
#### `L -->|Нет| N[Логирование ошибки /Invalid ru or he data/]`
   
   - **Описание**: Если данные не являются ни списком, ни объектом, фиксируется ошибка "Invalid ru or he data".

#### `N --> E`
   
   - **Описание**: После логирования ошибки, производится повторная отправка запроса.

### Возврат результата

#### `M --> O[Возврат результата ru и he]`
   
   - **Описание**: Возврат извлеченных переводов `ru` и `he`.

#### `I --> O`
   
   - **Описание**: Возврат извлеченных переводов `ru` и `he`.

#### `J --> O`
   
   - **Описание**: Возврат извлеченных переводов `ru` и `he`.
# Модуль Lockchat

## Обзор

Модуль `Lockchat` предоставляет класс `Lockchat`, который является провайдером для взаимодействия с API Lockchat. Этот API предоставляет доступ к моделям GPT-3.5 Turbo и GPT-4. Модуль поддерживает потоковую передачу данных, что позволяет получать ответы от API частями.

## Подробней

Модуль `Lockchat` используется для обмена сообщениями с API Lockchat, который предоставляет доступ к моделям GPT-3.5 Turbo и GPT-4. Он отправляет запросы к API и возвращает ответы. Поддерживается потоковая передача данных, что позволяет получать ответы от API частями.

## Классы

### `Lockchat`

**Описание**: Класс `Lockchat` является провайдером для взаимодействия с API Lockchat. Он наследует класс `AbstractProvider`.

**Наследует**:
- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для всех провайдеров.

**Аттрибуты**:
- `url` (str): URL-адрес API Lockchat. Значение по умолчанию: `"http://supertest.lockchat.app"`.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных. Значение по умолчанию: `True`.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель GPT-3.5 Turbo. Значение по умолчанию: `True`.
- `supports_gpt_4` (bool): Указывает, поддерживает ли провайдер модель GPT-4. Значение по умолчанию: `True`.

**Методы**:
- `create_completion`: Отправляет запрос к API Lockchat и возвращает ответ.

## Функции

### `create_completion`

```python
    @staticmethod
    def create_completion(
        model: str,
        messages: list[dict[str, str]],
        stream: bool, **kwargs: Any) -> CreateResult:
        """
        Создает запрос к API Lockchat и возвращает ответ.

        Args:
            model (str): Название модели для использования.
            messages (list[dict[str, str]]): Список сообщений для отправки в API.
            stream (bool): Указывает, использовать ли потоковую передачу данных.
            **kwargs (Any): Дополнительные параметры для передачи в API.

        Returns:
            CreateResult: Результат создания запроса.

        Raises:
            requests.exceptions.HTTPError: Если при запросе к API произошла ошибка.

        Внутренние функции:
            Отсутствуют.
        """
```

**Назначение**: Функция `create_completion` отправляет запрос к API Lockchat и возвращает ответ. Она принимает параметры, необходимые для формирования запроса, такие как модель, сообщения и настройки потоковой передачи.

**Параметры**:
- `model` (str): Название модели для использования.
- `messages` (list[dict[str, str]]): Список сообщений для отправки в API.
- `stream` (bool): Указывает, использовать ли потоковую передачу данных.
- `**kwargs` (Any): Дополнительные параметры для передачи в API. Может включать `temperature` (float), определяющую случайность ответов.

**Возвращает**:
- `CreateResult`: Результат создания запроса. Это может быть генератор, возвращающий части ответа при потоковой передаче, или полный ответ.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Если при запросе к API произошла ошибка.

**Как работает функция**:

1.  **Подготовка полезной нагрузки (Payload)**: Формирует словарь `payload`, включающий температуру (если предоставлена, иначе 0.7), сообщения, модель и флаг потоковой передачи.

2.  **Формирование заголовков (Headers)**: Определяет заголовки запроса, включая User-Agent.

3.  **Отправка запроса (Request)**: Отправляет POST-запрос к API Lockchat с указанной полезной нагрузкой и заголовками.

4.  **Обработка потока ответов (Stream processing)**: Если `stream=True`, функция итерируется по строкам ответа.
    *   Проверяет наличие ошибки модели (`The model: \`gpt-4\` does not exist`) и, если она обнаружена, повторяет запрос.

    *   Извлекает содержимое ответа из JSON, если строка содержит `"content"`.

    *   Извлекает фактическое содержимое (`token`) из `token["choices"][0]["delta"].get("content")` и генерирует его.

5.  **Завершение**: Функция возвращает результат, которым является либо генератор токенов (при потоковой передаче), либо полным ответом (если потоковая передача не используется).

**ASCII flowchart**:

```
    Начало
     ↓
    Подготовка Payload (температура, сообщения, модель, stream)
     ↓
    Формирование Headers (User-Agent)
     ↓
    Отправка POST-запроса к API Lockchat
     ↓
    Обработка потока ответов (если stream=True)
     ├─> Проверка на ошибку модели "gpt-4 does not exist"
     │   └─> Да: Повторный вызов create_completion
     │   └─> Нет: Продолжение
     ↓
    Извлечение содержимого из JSON (если есть "content")
     ↓
    Извлечение токена из ответа
     ↓
    Генерация токена (yield token)
     ↓
    Конец
```

**Примеры**:

```python
# Пример вызова функции create_completion
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
temperature = 0.9

# Вызов функции
result = Lockchat.create_completion(model=model, messages=messages, stream=stream, temperature=temperature)

# Обработка результата (в данном случае, генератора)
if stream:
    for token in result:
        print(token, end="")
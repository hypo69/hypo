# Процесс обработки списка продуктов (scenario_picelist.process_ai.mmd)

## Обзор

Данный документ описывает процесс обработки запроса на обработку списка продуктов.  Процесс включает в себя взаимодействие пользователя с моделью AI, обработку возможных ошибок и валидацию полученных данных.

## Последовательность действий (Sequence Diagram)

```sequenceDiagram
    participant Пользователь
    participant Модель_AI
    participant Логгер

    Пользователь->>Модель_AI: Запрос на обработку продуктов (products_list)
    Модель_AI->>Модель_AI: Обработка запроса с командой модели
    Модель_AI->>Пользователь: Ответ от модели

    alt Нет ответа от модели
        Логгер->>Логгер: Логирование ошибки "нет ответа от gemini"
        Пользователь->>Модель_AI: Повторный запрос (attempts - 1)
    end

    alt Невалидные данные (data)
        Логгер->>Логгер: Логирование ошибки "ошибка в данных от gemini"
        Пользователь->>Модель_AI: Повторный запрос (attempts - 1)
    end

    alt Получены данные (data)
        alt Данные в виде списка
            alt Два элемента (ru, he)
                Пользователь->>Пользователь: Извлечение ru и he
            end
            alt Один элемент
                Пользователь->>Пользователь: Извлечение ru и he из первого элемента
            end
            alt Невалидная структура данных
                Логгер->>Логгер: Логирование ошибки "проблема парсинга ответа"
                Пользователь->>Модель_AI: Повторный запрос (attempts - 1)
            end
        end

        alt Данные в виде объекта
            Пользователь->>Пользователь: Извлечение ru и he из объекта
        end

        alt Невалидные значения (ru или he)
            Логгер->>Логгер: Логирование ошибки "невалидные данные ru или he"
            Пользователь->>Модель_AI: Повторный запрос (attempts - 1)
        end

        Пользователь->>Пользователь: Возврат результата ru и he
    end
```

## Обработка ошибок

- **`нет ответа от gemini`**: Модель AI не возвращает ответ.  Производится повторный запрос.
- **`ошибка в данных от gemini`**: Полученные данные невалидны. Производится повторный запрос.
- **`проблема парсинга ответа`**: Полученные данные имеют неверный формат (не список или объект). Производится повторный запрос.
- **`невалидные данные ru или he`**: Извлеченные значения `ru` или `he` не соответствуют ожидаемому формату. Производится повторный запрос.

## Дополнительные замечания

Описание предполагает, что процесс обработки запросов предусматривает повторение попыток в случае ошибок, ограниченное определенным количеством попыток (attempts).

## Структура данных


В данном документе не описаны предполагаемые форматы данных для `products_list`, ответа от модели AI, `ru` и `he`.  Для корректной работы необходимо определить предполагаемые типы данных и их структуру.
```
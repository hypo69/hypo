Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот JavaScript-код отвечает за взаимодействие между всплывающим окном расширения браузера Firefox и активной вкладкой. Он обрабатывает запросы, отправленные из контента веб-страницы,  и управляет отображением результатов в всплывающем окне.  Код устанавливает обработчики событий для различных элементов интерфейса всплывающего окна, таких как кнопки, поля ввода и переключатели.  Взаимодействие происходит через API браузера (browser.tabs.sendMessage, browser.tabs.executeScript).  Также код включает обработку ошибок и логику для отображения страниц результатов в постраничном режиме.

Шаги выполнения
-------------------------
1. **Инициализация:** Код находит все необходимые элементы на странице всплывающего окна (кнопки, поля ввода, переключатели).
2. **Обработка событий:** Для каждого элемента интерфейса устанавливаются обработчики событий (click, keypress).
3. **Собирает состояние:** Функция `collectPopupState()` собирает текущее состояние элементов интерфейса всплывающего окна (выбранные опции, значения полей, состояния переключателей) в объект.
4. **Отправка сообщений:**  При нажатии на кнопки (например, «Выполнить», «Предыдущая страница») или при изменении состояния элементов интерфейса, код формирует объект с данными (например, запрос на выполнение XPath) и отправляет его в активную вкладку через `sendToSpecifiedFrame` или `sendToActiveTab`.
5. **Обработка ответов:** Если в ответ на запрос поступают данные (результаты запроса XPath, ошибки), код обрабатывает их и обновляет отображение результатов в таблице (например, `updateDetailsTable`).
6. **Отображение результатов:**  Код отображает результаты запроса XPath в таблице, реализуя постраничное отображение.
7. **Обработка ошибок:** Если при отправке запроса или получении ответа возникает ошибка, код выводит сообщение об ошибке.
8. **Сохранение состояния:** При закрытии всплывающего окна функция `collectPopupState()` сохраняет его текущее состояние с помощью `browser.runtime.sendMessage`,  чтобы при следующем открытии оно восстановилось.

Пример использования
-------------------------
.. code-block:: javascript

    // Пример использования функции для отправки запроса
    sendToSpecifiedFrame({
        "event": "execute",
        "main": {
            "expression": "//div[@id='myDiv']",
            "method": "xpath",
            "resultType": "element",
            "resolver": null
        }
    });

    // Обработчик результата
    genericListener.listeners.showResultsInPopup = function (message, sender) {
        // Обработка полученных результатов
        resultedDetails = message.main.itemDetails;
        resultsCount.textContent = resultedDetails.length;
        showDetailsPage(detailsPageIndex);
    };
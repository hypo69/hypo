```MD
# Code Assistant: Обучение модели коду проекта

## <input code>

```[Русский](https://github.com/hypo69/hypo/blob/master/endpoints/hypo69/code_assistant/README.RU.MD)
# Code Assistant: Обучение модели коду проекта

## Описание

`Code Assistant` — инструмент для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода. Он выполняет задачи, такие как создание документации, проверка кода, и генерация тестов на основе кода из указанных файлов.

## Основные возможности

- **Чтение исходных файлов**: Чтение кода из файлов с расширениями `.py` и `README.MD` из указанных директорий.
- **Обработка с помощью моделей**: Отправка кода в модели для выполнения задач, таких как создание документации или проверка ошибок.
- **Генерация результатов**: Ответы моделей сохраняются в указанные директории для каждой роли.

## Структура проекта

- **Модели**: Используются модели **Gemini** и **OpenAI** для обработки запросов.
- **Промпты**: Программа читает промпты из файлов в директории `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Файлы**: Обрабатываются файлы с расширениями `.py` и `README.MD` в указанных стартовых директориях.

## Пример использования

### Запуск с настройками из JSON:

```bash
python assistant.py --settings settings.json
```

### Запуск с явным указанием параметров:

```bash
python assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

### Пример для роли `code_checker`:

```bash
python assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
```

### Пример для модели `openai`:

```bash
python assistant.py --role doc_writer --lang en --models openai
```

## Параметры командной строки

- `--settings`: Путь к JSON файлу с настройками. Загружает параметры из файла.
- `--role`: Роль модели для выполнения задачи (например, `doc_writer`, `code_checker`).
- `--lang`: Язык выполнения задачи (например, `ru` или `en`).
- `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
- `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

## Логика работы

1. **Чтение файлов**: Поиск файлов с расширениями `.py` и `README.MD` в указанных стартовых директориях.
2. **Загрузка промптов**: Загрузка файлов промптов для каждой роли и языка из директории `src/ai/prompts/developer/`.
3. **Обработка запросов**: Формирование запросов на основе загруженных файлов и отправка их в модели.
4. **Сохранение ответов**: Ответы от моделей сохраняются в директории, соответствующей роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Исключения

Настройка исключений для файлов и директорий с помощью параметров:
- `exclude_file_patterns`: Список регулярных выражений для исключения файлов.
- `exclude_dirs`: Список директорий для исключения.
- `exclude_files`: Список файлов для исключения.

## Логирование

Логи сохраняются с помощью библиотеки `logger` и содержат информацию о процессе обработки файлов и полученных ответах.

## Зависимости

- **Gemini API**: Требуется API-ключ для работы с моделью Gemini.
- **OpenAI API**: Требуется API-ключ для работы с моделью OpenAI.

порядок действий для создания новой роли для модели ии (`gemini`,`openai`,...):
1. файл `code_assistant.json`:\nдобавить новую роль в список ролей     "roles": [\n      "code_checker",\n...] активная роль\nили в `"exclude-roles"` неактивная роль\n2. Добавить роль в файл переводов `translations/translations.json`\n3. Создать системный промпт в `ai/prompts/develpoper`\n4. Создать командную инструкцию в \'instructions/`

```

## <algorithm>

```mermaid
graph TD
    A[Получить параметры командной строки] --> B{Проверить настройки};
    B -- Верно -- > C[Загрузить настройки из файла settings.json];
    B -- Неверно -- > D[Вывести ошибку и завершить];
    C --> E[Получить список директорий];
    E --> F[Проверить исключения директорий и файлов];
    F --> G[Прочитать файлы с расширениями .py и README.MD];
    G --> H[Загрузить промпты из src/ai/prompts/developer/];
    H --> I[Формировать запросы к моделям (Gemini/OpenAI)];
    I --> J[Отправить запросы к моделям];
    J --> K[Получить ответы от моделей];
    K --> L[Обработать ответы];
    L --> M[Сохранить ответы в соответствующие директории];
    M --> N[Записать логи];
    N --> O[Завершить работу];
```

Примеры: Если `--start_dirs` содержит `/path/to/dir1` и `/path/to/dir2`, то `G` будет читать файлы .py и README.MD из этих директорий. `H` загрузит промпты, например, `doc_writer_en.md` для роли `doc_writer` и языка `en`.  `I` сформирует запросы с использованием полученных файлов и промптов.  `J` отправит эти запросы API моделей. `K` получит ответы от моделей. `M` сохранит ответы в `docs/raw_rst_from_gemini/en/` или `docs/raw_rst_from_openai/ru/` в зависимости от модели и языка.


## <mermaid>

```mermaid
graph LR
    subgraph Code Assistant
        A[assistant.py] --> B(Чтение параметров);
        B --> C[Обработка файлов];
        C --> D[Загрузка промптов];
        D --> E[Формирование запросов];
        E --> F[Отправка запросов к моделям];
        F --> G[Получение ответов];
        G --> H[Обработка ответов];
        H --> I[Сохранение результатов];
    end
    subgraph Gemini API
        F -. Gemini - . F
    end
    subgraph OpenAI API
        F -. OpenAI - . F
    end
    subgraph Файловая система
        C -. Файлы .py, README.md - . C
        D -. Промпты - . D
        I -. Результаты - . I
    end
    subgraph Логирование
        N[Логирование] -. Log - . A
    end
```

## <explanation>

### Импорты:

Файл `README.md` не содержит импортов, это описание инструмента. Для работы программы необходимы модули, отвечающие за работу с API моделей (Gemini, OpenAI), чтение файлов, обработку командной строки, работу с файловой системой и логирование.  Связь этих модулей определяется в коде, который описан в файле `assistant.py`, но не представлен здесь.

### Классы:

Описание классов отсутствует, что типично для файла README.


### Функции:

Описание функций, их параметров и возвращаемых значений также отсутствует.  Функциональность приложения определяется параметрами командной строки и логикой обработки файлов.

### Переменные:

Описание переменных не содержится в README.

### Возможные ошибки и улучшения:

- Нет описания структуры проекта, что затрудняет понимание взаимосвязей между файлами, модулями и классами.
- Отсутствует код, поэтому невозможно проверить реализацию алгоритма,  оценить его эффективность и найти возможные баги.
-  Нет информации о способе использования API моделей (Gemini, OpenAI) и обработке ошибок при работе с ними.
- Не указаны возможные исключения, которые могут возникнуть при работе с файлами.


### Взаимосвязи с другими частями проекта:

Описанная логика работы инструмента `Code Assistant` предполагает взаимодействие с другими частями проекта:

- **`src/ai/prompts/developer/`:** хранение промптов, необходимых для взаимодействия с моделями.
- **Модели Gemini и OpenAI:**  для выполнения обработки кода.
- **`settings.json`:**  конфигурационный файл с настройками для запуска приложения.
- **Файлы `.py` и `README.MD`:** файлы, которые будут обрабатываться инструментом.
- **Библиотека `logger`:** для логирования.

Взаимосвязь между этими компонентами реализована через функции и методы, которые не показаны в README.


В целом, описание проекта недостаточно для всестороннего анализа. Для полного понимания кода необходим сам код программы и соответствующие файлы (например, `settings.json`, промпты, и т.д.).
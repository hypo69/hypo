## Анализ кода `src.logger`

### <алгоритм>

1.  **Инициализация Logger:**
    *   Создается экземпляр класса `Logger`. Так как класс использует `SingletonMeta`,  второй экземпляр не будет создан, если он уже существует.
    *   Вызывается метод `initialize_loggers` с параметрами, указывающими пути к файлам для разных уровней логирования (info, debug, errors, json).

    ```python
    logger: Logger = Logger()
    config = {
        'info_log_path': 'logs/info.log',
        'debug_log_path': 'logs/debug.log',
        'errors_log_path': 'logs/errors.log',
        'json_log_path': 'logs/log.json'
    }
    logger.initialize_loggers(**config)
    ```

2.  **Конфигурирование Логгеров:**
    *   Метод `initialize_loggers` вызывает внутренний метод `_configure_logger` для каждого типа логгера (console, file, json), передавая ему имя логгера, путь к файлу, уровень логирования, форматтер (если необходимо) и режим работы с файлом.

        *   **Пример для `info` логгера:**

            ```python
            self._configure_logger(
                name="info",
                log_path=info_log_path,
                level=logging.INFO,
                formatter=logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'),
                mode='a',
             )
            ```

        *   **Пример для `json` логгера:**

            ```python
            self._configure_logger(
                name="json",
                log_path=json_log_path,
                level=logging.DEBUG,
                formatter=JsonFormatter(),
                mode='a',
             )
            ```

    *   Метод `_configure_logger` создает или получает существующий logger с переданным именем, добавляет хэндлер (file или console) с заданными параметрами и возвращает настроенный объект логгера.

3.  **Логирование Сообщений:**
    *   Вызываются методы `info`, `success`, `warning`, `debug`, `error`, `critical` класса `Logger` для записи сообщений с соответствующим уровнем.

        *   **Пример вызова `info`:**

            ```python
             logger.info('This is an info message')
            ```
            *   Внутри метод `info` вызывает метод `log` с уровнем логирования `logging.INFO` и переданным сообщением.

        *   **Пример вызова `error` с кастомизацией цвета:**

            ```python
             logger.error('This message will have a red background', colors=(colorama.Fore.WHITE, colorama.Back.RED))
            ```
            *   Внутри метод `error` вызывает метод `log` с уровнем логирования `logging.ERROR` и переданным сообщением и цветом.

    *   Метод `log` добавляет дополнительную информацию, например, информацию об исключении или цвет (если они были переданы), и передает сообщение соответствующему логгеру, который затем записывает его в файл или выводит в консоль.

4.  **Форматирование сообщений**
    *   Используется стандартный `logging.Formatter` для форматирования сообщений, или класс `JsonFormatter` для форматирования в JSON.
    *   При использовании цветов, используется библиотека `colorama` для установки цвета текста и фона.

### <mermaid>

```mermaid
graph LR
    A[Logger Instance] --> B(initialize_loggers);
    B --> C{_configure_logger\n(info)};
    B --> D{_configure_logger\n(debug)};
    B --> E{_configure_logger\n(errors)};
    B --> F{_configure_logger\n(json)};
    C --> G[logging.Logger\n(info)];
    D --> H[logging.Logger\n(debug)];
    E --> I[logging.Logger\n(errors)];
    F --> J[logging.Logger\n(json)];
    G --> K[FileHandler\n(info.log)];
    H --> L[FileHandler\n(debug.log)];
    I --> M[FileHandler\n(errors.log)];
    J --> N[FileHandler\n(log.json)];
    A --> O(info);
    A --> P(success);
    A --> Q(warning);
    A --> R(debug);
    A --> S(error);
    A --> T(critical);
    O --> U{log\n(logging.INFO)};
    P --> V{log\n(logging.INFO)};
    Q --> W{log\n(logging.WARNING)};
    R --> X{log\n(logging.DEBUG)};
    S --> Y{log\n(logging.ERROR)};
    T --> Z{log\n(logging.CRITICAL)};
    U --> G;
    V --> G;
    W --> G;
    X --> H;
    Y --> I;
    Z --> I;
    classDef plain fill:#fff,stroke:#000,stroke-width:1px;
    class A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z plain;
```

**Объяснение диаграммы:**

*   **Logger Instance (A):** Начальная точка, представляющая экземпляр класса `Logger`. Это главный объект, через который происходит вся работа с логгированием.
*   **initialize_loggers (B):**  Метод класса Logger, который инициирует процесс настройки логгеров для различных уровней (info, debug, errors, json).
*   **_configure_logger (C, D, E, F):** Внутренний метод, вызываемый `initialize_loggers` для каждого типа логгера (info, debug, errors, json). Метод конфигурирует и возвращает настроенный экземпляр `logging.Logger`.
*   **logging.Logger (G, H, I, J):** Экземпляры стандартного класса `logging.Logger` из модуля `logging`, настроенные для разных уровней и целей.
*   **FileHandler (K, L, M, N):** Хэндлеры, которые записывают логи в соответствующие файлы (`info.log`, `debug.log`, `errors.log`, `log.json`).
*   **info, success, warning, debug, error, critical (O, P, Q, R, S, T):** Методы класса `Logger`, которые служат интерфейсами для записи сообщений с соответствующим уровнем логирования.
*    **log (U, V, W, X, Y, Z):** Внутренний метод, который обрабатывает вызовы всех методов логирования (`info`, `success` и т.д.) и передает сообщение в соответствующий настроенный `logging.Logger`.
*   **Поток управления**: Показывает, как создается логгер, как он настраивается и как сообщения передаются в нужный логгер для записи.

### <объяснение>

**Импорты:**

*   `logging`: Стандартный модуль Python для логирования. Используется для создания и настройки логгеров, установки уровней логирования, и форматирования сообщений.
*   `typing.Optional`: Используется для аннотации типов, указывая, что переменная может иметь значение определенного типа или `None`.
*   `colorama`: Используется для добавления цветового оформления к выводу в консоль.

**Классы:**

*   **SingletonMeta**: Метакласс, реализующий шаблон Singleton. Гарантирует, что будет создан только один экземпляр класса `Logger`.
    *   Метод `__call__` перехватывает вызов конструктора класса и возвращает ранее созданный экземпляр, если он существует.
*   **JsonFormatter**: Класс, наследуемый от `logging.Formatter`, переопределяет метод `format` для форматирования логов в JSON формат. Использует  `json.dumps` для сериализации записи.
*   **Logger**: Основной класс логирования, который использует `SingletonMeta`.
    *   Атрибуты:
        *   `_console_logger`, `_file_logger`, `_json_logger`: Экземпляры `logging.Logger` для логирования в консоль, файл и JSON.
    *   Методы:
        *   `__init__`: Инициализирует атрибуты `_console_logger`, `_file_logger` и `_json_logger` в `None`.
        *   `_configure_logger`: Конфигурирует и возвращает `logging.Logger`. Создает или получает логгер по имени, добавляет обработчик (file или console), устанавливает форматтер и уровень логирования.
        *   `initialize_loggers`: Инициализирует различные логгеры (console, file, JSON) с использованием `_configure_logger`. Принимает пути к файлам в качестве аргументов.
        *   `log`: Основной метод для логирования сообщений с различными уровнями, цветами и дополнительной информацией (исключения).
        *   `info`, `success`, `warning`, `debug`, `error`, `critical`: Методы-обертки для `log`, упрощающие логирование сообщений на разных уровнях.

**Функции:**

*   `_configure_logger`:
    *   Аргументы: `name` (имя логгера), `log_path` (путь к файлу), `level` (уровень логирования), `formatter` (форматтер), `mode` (режим работы с файлом).
    *   Возвращает: `logging.Logger`.
    *   Назначение: Создает или получает логгер с заданным именем, добавляет обработчик (file или console) и устанавливает форматтер и уровень логирования.
*   `initialize_loggers`:
    *   Аргументы: `info_log_path`, `debug_log_path`, `errors_log_path`, `json_log_path`.
    *   Возвращает: `None`.
    *   Назначение: Инициализирует логгеры для консоли, файлов и JSON.
*   `log`:
    *   Аргументы: `level` (уровень логирования), `message` (сообщение), `ex` (исключение), `exc_info` (флаг для включения информации об исключении), `color` (цвет для консоли).
    *   Возвращает: `None`.
    *   Назначение: Логирует сообщение с заданным уровнем, цветом и информацией об исключении.
*   `info`, `success`, `warning`, `debug`, `error`, `critical`:
    *   Аргументы: `message`, `ex`, `exc_info`, `colors`.
    *   Возвращают: `None`.
    *   Назначение: Упрощенные методы для логирования сообщений на разных уровнях.

**Переменные:**

*   `config`: Словарь с путями к файлам для логирования.
*   `logger`: Экземпляр класса `Logger`.

**Потенциальные ошибки и области для улучшения:**

*   Отсутствует явная обработка ошибок при записи в файл.
*   Можно добавить возможность настройки форматов для разных типов логгеров (например, JSON для файла, а другой для консоли).
*   Можно добавить возможность ротации логов.

**Взаимосвязи с другими частями проекта:**

*   Модуль `src.logger` не зависит от других модулей внутри проекта, но он является центральным для всех остальных модулей, так как используется для логирования действий и ошибок.

**Цепочка взаимосвязей:**

1.  Другие модули проекта импортируют класс `Logger` из `src.logger`.
2.  При создании экземпляра `Logger`, гарантируется, что это будет один и тот же экземпляр из-за Singleton.
3.  Другие модули вызывают методы `info`, `debug`, `error`, и т.д. для записи логов.
4.  Логи могут быть направлены в консоль, файлы, или в JSON файл в зависимости от конфигурации.
5.  Таким образом, модуль `src.logger` является центральным для мониторинга состояния проекта и его компонентов.
# Модуль для извлечения идентификаторов продуктов из URL AliExpress

## Обзор

Модуль `extract_product_id.py` предназначен для извлечения идентификаторов товаров (product IDs) из URL-адресов, связанных с AliExpress. Он предоставляет функциональность для обработки как одного URL, так и списка URL-адресов, возвращая соответствующие идентификаторы товаров.

## Подробней

Этот модуль используется для автоматического извлечения идентификаторов товаров из URL AliExpress. Он принимает на вход строку URL или список URL-адресов и возвращает строку с идентификатором товара или список идентификаторов товаров соответственно. Если в URL не найден подходящий идентификатор, возвращается `None`. Модуль включает регулярное выражение для поиска и извлечения идентификаторов, что делает его полезным для задач, требующих автоматической обработки данных о товарах с AliExpress.

## Функции

### `extract_prod_ids`

```python
def extract_prod_ids(urls: str | list[str]) -> str | list[str] | None:
    """Извлекает идентификаторы товаров из списка URL-адресов или возвращает идентификаторы, если они уже предоставлены.

    Args:
        urls (str | list[str]): URL-адрес, список URL-адресов или идентификаторы товаров.

    Returns:
        str | list[str] | None: Список извлеченных идентификаторов товаров, один идентификатор или `None`, если не найдено допустимых идентификаторов.

    Example:
        >>> extract_prod_ids("https://www.aliexpress.com/item/123456.html")
        '123456'

        >>> extract_prod_ids(["https://www.aliexpress.com/item/123456.html", "7891011.html"])
        ['123456', '7891011']

        >>> extract_prod_ids(["https://www.example.com/item/123456.html", "https://www.example.com/item/abcdef.html"])
        ['123456']

        >>> extract_prod_ids("7891011")
        '7891011'

        >>> extract_prod_ids("https://www.example.com/item/abcdef.html")
        None
    """
    # Регулярное выражение для поиска идентификаторов товаров
    pattern = re.compile(r"(?:item/|/)?(\\d+)\\.html")

    def extract_id(url: str) -> str | None:
        """Извлекает идентификатор товара из заданного URL-адреса или проверяет идентификатор товара.

        Args:
            url (str): URL-адрес или идентификатор товара.

        Returns:
            str | None: Извлеченный идентификатор товара или сам входной параметр, если это допустимый идентификатор, или `None`, если допустимый идентификатор не найден.

        Example:
            >>> extract_id("https://www.aliexpress.com/item/123456.html")
            '123456'

            >>> extract_id("7891011")
            '7891011'

            >>> extract_id("https://www.example.com/item/abcdef.html")
            None
        """
        # Проверка, является ли входной параметр допустимым идентификатором товара
        if url.isdigit():
            return url

        # В противном случае попытаться извлечь идентификатор из URL-адреса
        match = pattern.search(url)
        if match:
            return match.group(1)
        return

    if isinstance(urls, list):
        extracted_ids = [extract_id(url) for url in urls if extract_id(url) is not None]
        return extracted_ids if extracted_ids else None
    else:
        return extract_id(urls)
```

**Как работает функция**:

1.  Функция `extract_prod_ids` принимает на вход строку или список строк, представляющих URL-адреса или идентификаторы товаров.
2.  Внутри функции определена внутренняя функция `extract_id`, которая извлекает идентификатор товара из одного URL или проверяет его.
3.  Если входной параметр `urls` является списком, функция применяет `extract_id` к каждому элементу списка и возвращает список извлеченных идентификаторов (исключая `None`).
4.  Если `urls` является строкой, функция напрямую вызывает `extract_id` и возвращает результат.

Внутри функции происходят следующие действия и преобразования:

A.  **Проверка типа входных данных**:
    Функция проверяет, является ли входной параметр списком или строкой.

    |

    \-- B. **Обработка списка URL-адресов**:
    Если входной параметр — список, функция применяет внутреннюю функцию `extract_id` к каждому URL-адресу.

    |

    C - D. **Извлечение идентификатора из URL-адреса**:
    Внутренняя функция `extract_id` проверяет, является ли входной параметр числом (идентификатором). Если да, то возвращает его. В противном случае пытается извлечь идентификатор из URL-адреса с использованием регулярного выражения.

    |

    E.  **Возврат результата**:
    Функция возвращает список извлеченных идентификаторов или `None`, если список пуст. Если входной параметр — строка, возвращается результат работы внутренней функции `extract_id`.

**Примеры**:

```python
>>> extract_prod_ids("https://www.aliexpress.com/item/123456.html")
'123456'

>>> extract_prod_ids(["https://www.aliexpress.com/item/123456.html", "7891011.html"])
['123456', '7891011']

>>> extract_prod_ids(["https://www.example.com/item/123456.html", "https://www.example.com/item/abcdef.html"])
['123456']

>>> extract_prod_ids("7891011")
'7891011'

>>> extract_prod_ids("https://www.example.com/item/abcdef.html")
None
```

#### `extract_id`

```python
def extract_id(url: str) -> str | None:
    """Извлекает идентификатор товара из заданного URL-адреса или проверяет идентификатор товара.

    Args:
        url (str): URL-адрес или идентификатор товара.

    Returns:
        str | None: Извлеченный идентификатор товара или сам входной параметр, если это допустимый идентификатор, или `None`, если допустимый идентификатор не найден.

    Example:
        >>> extract_id("https://www.aliexpress.com/item/123456.html")
        '123456'

        >>> extract_id("7891011")
        '7891011'

        >>> extract_id("https://www.example.com/item/abcdef.html")
        None
    """
    # Проверка, является ли входной параметр допустимым идентификатором товара
    if url.isdigit():
        return url

    # В противном случае попытаться извлечь идентификатор из URL-адреса
    match = pattern.search(url)
    if match:
        return match.group(1)
    return
```

**Как работает функция**:

1.  Функция `extract_id` принимает на вход строку, представляющую URL-адрес или идентификатор товара.
2.  Функция проверяет, является ли входной параметр числом (идентификатором). Если да, то возвращает его.
3.  В противном случае функция пытается извлечь идентификатор из URL-адреса с использованием регулярного выражения.
4.  Если идентификатор успешно извлечен, функция возвращает его. В противном случае возвращается `None`.

Внутри функции происходят следующие действия и преобразования:

A.  **Проверка на число**:
    Функция проверяет, состоит ли входная строка только из цифр.

    |

    \-- B. **Возврат числа**:
    Если строка состоит только из цифр, функция возвращает эту строку.

    |

    C - D. **Поиск идентификатора в URL**:
    Если строка не является числом, функция пытается найти в ней идентификатор товара с использованием регулярного выражения.

    |

    E.  **Возврат идентификатора или None**:
    Если идентификатор найден, функция возвращает его. В противном случае возвращается `None`.

**Примеры**:

```python
>>> extract_id("https://www.aliexpress.com/item/123456.html")
'123456'

>>> extract_id("7891011")
'7891011'

>>> extract_id("https://www.example.com/item/abcdef.html")
None
```
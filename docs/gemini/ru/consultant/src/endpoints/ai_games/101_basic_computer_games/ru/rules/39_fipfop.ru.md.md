# Анализ кода модуля FIPFOP

**Качество кода**
7
 -  Плюсы
    -   Документ содержит подробное описание правил и логики игры FIPFOP.
    -   Присутствует пошаговая инструкция по реализации игры.
    -   Примеры работы программы помогают понять процесс игры.
    -   Указаны возможные ограничения и необходимые модули.
 -  Минусы
    -   Отсутствует описание модуля в формате reStructuredText (RST).
    -   Нет примеров кода на Python, что затрудняет понимание реализации.
    -   Не используются docstring для функций и классов, нет комментариев в коде, что затрудняет понимание кода.
    -   Нет обработки ошибок.
    -   Не используется логирование ошибок.

**Рекомендации по улучшению**

1.  Добавить описание модуля в формате reStructuredText (RST).
2.  Включить пример кода на Python с использованием модуля random.
3.  Использовать docstring для функций и классов.
4.  Добавить комментарии в коде с объяснением логики.
5.  Включить обработку ошибок с использованием try-except и логирование с помощью logger.
6.  Переписать комментарии в формате RST.
7.  Реализовать функции для каждого этапа игры: инициализация, ход игрока, проверка победы и т.д.
8.  Использовать `j_loads` или `j_loads_ns` для чтения файлов, если это применимо.

**Оптимизированный код**

```markdown
### Название игры: **FIPFOP** (Переключение X и O)
"""
Модуль описывает игру FIPFOP (Переключение X и O)
=========================================================================================
FIPFOP — это игра на логику, в которой игрок должен последовательно переключать символы `X` и `O` в строке.
Цель игры — за минимальное количество ходов изменить все символы в строке `X` на `O`.
При каждом ходе игрок указывает позицию, и символ на этой позиции, а также соседние символы (если они существуют),
меняют своё состояние: `X` → `O` и `O` → `X`.

Пример использования
--------------------

Пример игры FIPFOP:

.. code-block:: python

    game = FipfopGame()
    game.start_game()

"""
---

#### Описание
**FIPFOP** — это игра на логику, в которой игрок должен последовательно переключать символы `X` и `O` в строке. Цель игры — за минимальное количество ходов изменить все символы в строке `X` на `O`. При каждом ходе игрок указывает позицию, и символ на этой позиции, а также соседние символы (если они существуют), меняют своё состояние: `X` → `O` и `O` → `X`.

---

### Пошаговая инструкция для реализации

#### 1. **Инициализация игры**
   - При запуске игры программа приветствует пользователя и объясняет правила.
   - Пользователь задаёт длину строки (например, от 5 до 10 символов).
   - Программа генерирует случайную строку из символов `X` и `O`.

#### 2. **Основной процесс игры**
   - Программа отображает текущую строку символов.
   - **Ход игрока:**
     1. Игрок выбирает позицию в строке (номер от 1 до длины строки).
     2. Программа переключает символ на указанной позиции, а также символы, находящиеся слева и справа от неё (если они существуют).
   - Программа обновляет и отображает текущую строку после каждого хода.

#### 3. **Условия победы**
   - Игра завершается, когда вся строка состоит только из символов `O`.
   - Программа выводит поздравление и количество ходов, которые потребовались для достижения цели.

#### 4. **Продолжение игры**
   - После завершения игры пользователю предлагается сыграть снова:
     ```
     Хотите сыграть ещё раз? (да/нет)
     ```
   - Если пользователь выбирает "да", программа начинает новый раунд с новой строкой.
   - Если "нет", программа завершает работу.

---

### Пример работы программы

1. **Начало игры:**
   ```
   Добро пожаловать в игру FIPFOP!
   Введите длину строки (от 5 до 10):
   > 6
   Начальная строка: XOXOXO
   ```

2. **Ход игрока:**
   ```
   Выберите позицию для переключения (1–6):
   > 3
   Новая строка: XOXXXO
   ```

3. **Результат игры:**
   ```
   Выберите позицию для переключения (1–6):
   > 2
   Новая строка: OOXOOO

   Поздравляем! Вы решили задачу за 2 хода!
   Хотите сыграть ещё раз? (да/нет):
   > нет
   Спасибо за игру!
   ```

---

### Возможные ограничения
- Длина строки ограничена диапазоном от 5 до 10 символов.
- Номера позиций вводятся в пределах длины строки.
- Строка обновляется после каждого хода, а программа проверяет, завершена ли задача.

---

### Реализация
Игра может быть реализована на Python с использованием следующих возможностей:
- **Модуль `random`** для генерации начальной строки.
- Циклы и условия для обработки пользовательского ввода и переключения символов.
- Логика для обновления строки и проверки условий победы.

Рекомендуется:
- Добавить счётчик ходов для отслеживания эффективности игры.
- Реализовать визуализацию строк в реальном времени для улучшения восприятия игроком.
```
```python
"""
Модуль описывает игру FIPFOP (Переключение X и O)
=========================================================================================
FIPFOP — это игра на логику, в которой игрок должен последовательно переключать символы `X` и `O` в строке.
Цель игры — за минимальное количество ходов изменить все символы в строке `X` на `O`.
При каждом ходе игрок указывает позицию, и символ на этой позиции, а также соседние символы (если они существуют),
меняют своё состояние: `X` → `O` и `O` → `X`.

Пример использования
--------------------

Пример игры FIPFOP:

.. code-block:: python

    game = FipfopGame()
    game.start_game()

"""
import random  # Импортируем модуль random для генерации случайной строки
from src.logger.logger import logger # Импортируем logger для логирования ошибок


class FipfopGame:
    """
    Класс, реализующий игру FIPFOP.
    """
    def __init__(self):
        """
        Инициализирует игру, устанавливая начальные значения.
        """
        self.game_string = ''  # Инициализируем строку игры
        self.moves = 0  # Инициализируем счетчик ходов

    def _generate_random_string(self, length: int) -> str:
        """
        Генерирует случайную строку из символов 'X' и 'O' заданной длины.

        :param length: Длина генерируемой строки.
        :return: Случайно сгенерированная строка.
        """
        return ''.join(random.choice(['X', 'O']) for _ in range(length))

    def _print_game_state(self):
      """
      Выводит текущее состояние игры, включая строку и количество ходов.
      """
      print(f'Текущая строка: {self.game_string}') # Вывод текущей строки
      print(f'Ходов: {self.moves}')# Вывод количества ходов

    def _toggle_characters(self, position: int):
        """
        Переключает символ в заданной позиции и соседние символы.

        :param position: Позиция, в которой нужно переключить символы (начиная с 1).
        """
        try:
            #  код преобразует позицию в индекс, учитывая, что позиция вводится с 1
            index = position - 1
            # код преобразовывает строку в список, для возможности изменения символов
            string_list = list(self.game_string)
            #  код переключает символ в указанной позиции
            string_list[index] = 'O' if string_list[index] == 'X' else 'X'

            # код переключает символ слева, если он существует
            if index > 0:
                string_list[index - 1] = 'O' if string_list[index - 1] == 'X' else 'X'
            # код переключает символ справа, если он существует
            if index < len(string_list) - 1:
                string_list[index + 1] = 'O' if string_list[index + 1] == 'X' else 'X'
            # код возвращает строку измененных символов
            self.game_string = ''.join(string_list)
        except IndexError as e:
           logger.error(f'Неверный индекс: {position}', exc_info=e) # Логирование ошибки, если индекс вне диапазона
           return False
        return True
    def _check_win(self) -> bool:
        """
        Проверяет, выиграл ли игрок (все символы 'O').

        :return: True, если игрок выиграл, иначе False.
        """
        return all(char == 'O' for char in self.game_string)

    def start_game(self):
        """
        Начинает новый раунд игры FIPFOP.
        """
        while True: # бесконечный цикл для возможности нескольких игр
            print('Добро пожаловать в игру FIPFOP!') # приветствие
            while True:  # цикл проверки ввода длины строки
                try:
                    length = int(input('Введите длину строки (от 5 до 10): ')) # ввод длины строки
                    if 5 <= length <= 10: # проверка валидности ввода
                        break
                    else:
                        print('Длина строки должна быть от 5 до 10.')# сообщение об ошибке ввода
                except ValueError:
                    print('Неверный ввод. Введите число.') # сообщение об ошибке ввода
            self.game_string = self._generate_random_string(length) # генерация случайной строки
            self.moves = 0 # обнуление счетчика ходов
            self._print_game_state() # вывод начального состояния игры

            while True: # цикл текущей игры
                while True: # цикл для корректного ввода позиции
                    try:
                        position = int(input(f'Выберите позицию для переключения (1-{length}): ')) # ввод позиции для переключения
                        if 1 <= position <= length: # проверка валидности ввода
                            break
                        else:
                            print(f'Позиция должна быть от 1 до {length}.') # сообщение об ошибке
                    except ValueError as e:
                        logger.error('Неверный ввод позиции, ожидается число', exc_info=e)# сообщение об ошибке
                        print('Неверный ввод. Введите число.') # сообщение об ошибке

                if not self._toggle_characters(position): # вызов переключения символов и обработка неверного индекса
                    continue
                self.moves += 1 # увеличение счетчика ходов
                self._print_game_state() # вывод текущего состояния игры

                if self._check_win(): # проверка выигрыша
                    print(f'Поздравляем! Вы решили задачу за {self.moves} хода!') # поздравление с победой
                    break # конец игры если победа
            while True: # цикл для проверки желания продолжить игру
                play_again = input('Хотите сыграть ещё раз? (да/нет): ').lower() # запрос повторной игры
                if play_again in ['да', 'нет']: # проверка корректности ввода
                    break
                else:
                    print('Неверный ввод. Введите "да" или "нет".') # сообщение об ошибке
            if play_again == 'нет':# если не хочет играть еще раз, заканчиваем цикл
                print('Спасибо за игру!') # прощание
                return # конец игры

if __name__ == '__main__':
    game = FipfopGame()
    game.start_game()
```
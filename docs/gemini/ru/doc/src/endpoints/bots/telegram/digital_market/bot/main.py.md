# Модуль main.py

## Обзор

Модуль `main.py` является точкой входа в Telegram-бота для цифрового рынка. Он отвечает за настройку и запуск бота, регистрацию обработчиков и мидлварей, а также обработку вебхуков.

## Подробней

Этот модуль настраивает Telegram-бота, используя библиотеку `aiogram`. Он включает в себя:

- Установку команд по умолчанию для бота.
- Регистрацию мидлварей для обработки запросов к базе данных.
- Регистрацию маршрутизаторов для обработки различных типов сообщений и команд пользователей.
- Создание и настройку веб-приложения на основе `aiohttp` для обработки входящих вебхуков от Telegram.
- Запуск и остановку бота с отправкой уведомлений администраторам.

## Функции

### `set_default_commands`

```python
async def set_default_commands():
    """
    Устанавливает команды по умолчанию для бота.
    """
```

**Описание**: Устанавливает команды по умолчанию для бота, такие как `/start`.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- Нет

**Примеры**:
```python
await set_default_commands()
```

### `on_startup`

```python
async def on_startup(app):
    """
    Выполняется при запуске приложения.
    """
```

**Описание**: Выполняется при запуске приложения. Устанавливает команды по умолчанию, устанавливает вебхук и отправляет уведомления администраторам о запуске бота.

**Параметры**:
- `app` (aiohttp.web.Application): Объект приложения aiohttp.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Если не удается отправить сообщение администратору.

**Примеры**:
```python
app = web.Application()
app.on_startup.append(on_startup)
```

### `on_shutdown`

```python
async def on_shutdown(app):
    """
    Выполняется при остановке приложения.
    """
```

**Описание**: Выполняется при остановке приложения. Отправляет уведомления администраторам об остановке бота, удаляет вебхук и закрывает сессию бота.

**Параметры**:
- `app` (aiohttp.web.Application): Объект приложения aiohttp.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Если не удается отправить сообщение администратору.

**Примеры**:
```python
app = web.Application()
app.on_shutdown.append(on_shutdown)
```

### `register_middlewares`

```python
def register_middlewares():
    """
    Регистрирует мидлвари для диспетчера.
    """
```

**Описание**: Регистрирует мидлвари для диспетчера, такие как `DatabaseMiddlewareWithoutCommit` и `DatabaseMiddlewareWithCommit`.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- Нет

**Примеры**:
```python
register_middlewares()
```

### `register_routers`

```python
def register_routers():
    """
    Регистрирует маршруты для диспетчера.
    """
```

**Описание**: Регистрирует маршруты для диспетчера, такие как `catalog_router`, `user_router` и `admin_router`.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- Нет

**Примеры**:
```python
register_routers()
```

### `create_app`

```python
def create_app():
    """
    Создает и настраивает приложение aiohttp.
    """
```

**Описание**: Создает и настраивает приложение `aiohttp`. Регистрирует обработчики маршрутов, настраивает приложение с диспетчером и ботом, а также регистрирует функции запуска и остановки.

**Параметры**:
- Нет

**Возвращает**:
- `aiohttp.web.Application`: Объект приложения aiohttp.

**Вызывает исключения**:
- Нет

**Примеры**:
```python
app = create_app()
```

### `main`

```python
def main():
    """
    Главная функция для запуска приложения.
    """
```

**Описание**: Главная функция для запуска приложения. Регистрирует мидлвари и маршруты, создает приложение и запускает его.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- Нет

**Примеры**:
```python
if __name__ == "__main__":
    main()
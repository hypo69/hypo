# Модуль для работы с Raycast API
## Обзор

Модуль `Raycast.py` предназначен для взаимодействия с API Raycast для получения ответов от AI моделей, таких как GPT-3.5 Turbo и GPT-4.
Модуль предоставляет класс `Raycast`, который реализует метод `create_completion` для отправки запросов к API Raycast и получения ответов в режиме реального времени (стриминг).
Этот модуль требует аутентификации через токен, который передается при создании запроса.

## Подробней

Модуль предназначен для интеграции с Raycast, предоставляя возможность использовать AI-модели для генерации текста.
В текущей версии модуль помечен как нерабочий (`working = False`).

## Классы

### `Raycast(AbstractProvider)`

**Описание**: Класс `Raycast` предоставляет интерфейс для взаимодействия с API Raycast.

**Наследует**:
- `AbstractProvider`: Абстрактный класс, определяющий базовый интерфейс для провайдеров AI-моделей.

**Атрибуты**:
- `url` (str): URL Raycast.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу ответов (True).
- `needs_auth` (bool): Указывает, требуется ли аутентификация для работы с провайдером (True).
- `working` (bool): Указывает, работает ли в данный момент провайдер (False).
- `models` (List[str]): Список поддерживаемых моделей (`gpt-3.5-turbo`, `gpt-4`).

**Методы**:
- `create_completion()`: Создает запрос на завершение текста и возвращает ответ от AI-модели.

## Функции

### `create_completion`

```python
    @staticmethod
    def create_completion(
        model: str,
        messages: Messages,
        stream: bool,
        proxy: str = None,
        **kwargs,
    ) -> CreateResult:
        """ Функция создает запрос на завершение текста и возвращает ответ от AI-модели.
        Args:
            model (str): Имя используемой модели.
            messages (Messages): Список сообщений для контекста запроса.
            stream (bool): Определяет, использовать ли потоковую передачу данных.
            proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
            **kwargs: Дополнительные аргументы, включая `auth` (токен аутентификации).

        Returns:
            CreateResult: Результат завершения, который может быть либо строкой, либо генератором строк (в режиме стриминга).

        Raises:
            ValueError: Если не предоставлен токен аутентификации (`auth`).

        """
```

**Назначение**: Создание запроса на завершение текста к API Raycast и получение ответа от AI-модели.

**Параметры**:
- `model` (str): Имя используемой модели (например, "gpt-3.5-turbo", "gpt-4").
- `messages` (Messages): Список сообщений, представляющих контекст запроса. Каждое сообщение содержит роль (`author`) и содержимое (`content`).
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
- `proxy` (str, optional): URL прокси-сервера для выполнения запроса. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы, передаваемые в функцию. Обязательным аргументом является `auth` (токен аутентификации).

**Возвращает**:
- `CreateResult`: Результат завершения, который может быть либо строкой (если `stream=False`), либо генератором строк (если `stream=True`).

**Вызывает исключения**:
- `ValueError`: Если не предоставлен токен аутентификации (`auth`).

**Как работает функция**:
1. **Проверка аутентификации**: Функция проверяет, передан ли токен аутентификации (`auth`) через `kwargs`. Если токен отсутствует, выбрасывается исключение `ValueError`.
2. **Формирование заголовков**: Создаются заголовки запроса, включая токен аутентификации, тип контента и User-Agent.
3. **Преобразование сообщений**: Список сообщений преобразуется в формат, ожидаемый API Raycast.
4. **Формирование данных запроса**: Создается словарь с данными запроса, включающий сообщения, модель, провайдера, параметры отладки и температуры.
5. **Отправка запроса**: Отправляется POST-запрос к API Raycast с использованием библиотеки `requests`. Если `stream=True`, устанавливается потоковый режим.
6. **Обработка потокового ответа**: Если `stream=True`, функция итерируется по строкам ответа, извлекая данные и генерируя токены завершения.

```
A: Проверка аутентификации
|
B: Формирование заголовков
|
C: Преобразование сообщений
|
D: Формирование данных запроса
|
E: Отправка POST-запроса
|
F: Обработка потокового ответа
```

**Примеры**:

```python
# Пример использования функции create_completion с потоковой передачей
auth_token = "YOUR_AUTH_TOKEN"
messages = [
    {"role": "user", "content": "Напиши краткое описание OpenAI."},
]
model = "gpt-3.5-turbo"
stream = True
proxy = None

result = Raycast.create_completion(model=model, messages=messages, stream=stream, auth=auth_token, proxy=proxy)

if stream:
    for chunk in result:
        print(chunk, end="")
else:
    print(result)

# Пример использования функции create_completion без потоковой передачи
auth_token = "YOUR_AUTH_TOKEN"
messages = [
    {"role": "user", "content": "Как использовать библиотеку requests в Python?"},
]
model = "gpt-4"
stream = False
proxy = None

result = Raycast.create_completion(model=model, messages=messages, stream=stream, auth=auth_token, proxy=proxy)

if stream:
    for chunk in result:
        print(chunk, end="")
else:
    print(result)
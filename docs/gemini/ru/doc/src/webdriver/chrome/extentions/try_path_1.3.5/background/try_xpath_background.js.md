# Модуль `try_xpath_background.js`

## Обзор

Этот модуль является фоновым скриптом расширения для браузера, который обрабатывает коммуникацию с контентными скриптами и управляет стилями и данными, связанными с XPath. Он отвечает за сохранение и восстановление состояния всплывающего окна, а также за управление CSS и атрибутами.

## Оглавление
- [Функции](#Функции)
- [События](#События)
- [Объекты](#Объекты)

## Функции

### `loadDefaultCss`

**Описание**: Загружает CSS по умолчанию из файла `try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Промис, который разрешается строкой, содержащей CSS, или отклоняется в случае ошибки.

### `genericListener`

**Описание**:  Общий слушатель сообщений, перенаправляющий сообщения соответствующим обработчикам на основе свойства `event`.

**Параметры**:
- `message` (object): Объект сообщения, содержащий данные и свойство `event` для маршрутизации.
- `sender` (object): Объект, содержащий информацию об отправителе сообщения.
- `sendResponse` (function): Функция обратного вызова для отправки ответа отправителю.

**Возвращает**:
- `boolean | undefined`: Возвращает `true`, если сообщение обработано и требуется асинхронный ответ, в противном случае `undefined`.

### `genericListener.listeners.storePopupState`
**Описание**: Сохраняет состояние всплывающего окна.

**Параметры**:
- `message` (object): Объект сообщения, содержащий состояние всплывающего окна.

**Возвращает**:
- `undefined`

### `genericListener.listeners.requestRestorePopupState`

**Описание**: Запрашивает восстановление состояния всплывающего окна, отправляя сообщение фоновому скрипту.

**Возвращает**:
- `undefined`

### `genericListener.listeners.requestInsertStyleToPopup`

**Описание**: Запрашивает вставку стилей в всплывающее окно, отправляя сообщение фоновому скрипту.

**Возвращает**:
- `undefined`

### `genericListener.listeners.showAllResults`

**Описание**: Показывает все результаты, сохраняя их и открывая новую вкладку с результатами.

**Параметры**:
- `message` (object): Объект сообщения, содержащий результаты для отображения.
- `sender` (object): Объект, содержащий информацию об отправителе сообщения.

**Возвращает**:
- `undefined`

### `genericListener.listeners.loadResults`

**Описание**:  Отправляет сохраненные результаты в ответ на запрос от контентного скрипта.

**Параметры**:
- `message` (object): Объект сообщения.
- `sender` (object): Объект, содержащий информацию об отправителе сообщения.
- `sendResponse` (function): Функция обратного вызова для отправки ответа с результатами.

**Возвращает**:
- `boolean`: Возвращает `true`, чтобы указать, что будет отправлен асинхронный ответ.

### `genericListener.listeners.updateCss`

**Описание**: Обновляет CSS на странице, удаляя устаревшие стили и вставляя новые.

**Параметры**:
- `message` (object): Объект сообщения, содержащий `expiredCssSet` для удаления.
- `sender` (object): Объект, содержащий информацию об отправителе сообщения.

**Возвращает**:
- `undefined`

### `genericListener.listeners.loadOptions`

**Описание**: Отправляет параметры, включая атрибуты, CSS и CSS всплывающего окна, в ответ на запрос от контентного скрипта.

**Параметры**:
- `message` (object): Объект сообщения.
- `sender` (object): Объект, содержащий информацию об отправителе сообщения.
- `sendResponse` (function): Функция обратного вызова для отправки ответа с параметрами.

**Возвращает**:
- `boolean`: Возвращает `true`, чтобы указать, что будет отправлен асинхронный ответ.

### `genericListener.listeners.requestSetContentInfo`

**Описание**:  Отправляет информацию об атрибутах в контентный скрипт.

**Параметры**:
- `message` (object): Объект сообщения.
- `sender` (object): Объект, содержащий информацию об отправителе сообщения.

**Возвращает**:
- `undefined`

## События

### `browser.storage.onChanged`

**Описание**: Слушатель события изменения хранилища, обновляет `attributes`, `css` и `popupCss` при их изменении в хранилище.

**Параметры**:
- `changes` (object): Объект, содержащий информацию об изменениях в хранилище.

### `browser.storage.sync.get`
**Описание**: Получение настроек из хранилища при запуске скрипта.

## Объекты

### `popupState`
**Описание**: Переменная для хранения состояния всплывающего окна.

### `popupCss`
**Описание**: Переменная для хранения CSS для всплывающего окна.

### `results`
**Описание**: Объект для хранения результатов XPath.

### `css`
**Описание**: Переменная для хранения CSS.

### `attributes`
**Описание**: Объект, содержащий атрибуты для элементов XPath.
# Анализ кода модуля `popup.js`

**Качество кода**
8
-  Плюсы
    - Код выполняет основную задачу отправки URL текущей вкладки.
    - Используются стандартные API Chrome для взаимодействия с вкладками и отправки сообщений.
    - Код относительно прост и понятен.
-  Минусы
    - Отсутствуют комментарии, объясняющие логику кода.
    - Использование `alert` для отображения сообщений не является лучшей практикой.
    - Нет обработки ошибок при взаимодействии с chrome API.
    - Нет явной обработки ошибок, которые могут возникнуть при отправке сообщения.
    - Нет документации в формате reStructuredText.

**Рекомендации по улучшению**

1. **Добавить комментарии в формате RST**:
   - Описать назначение скрипта и каждой его части.
   - Описать параметры и возвращаемые значения (если есть) у функций.

2.  **Использовать `logger` для вывода ошибок**:
   -   Заменить `alert` на `logger.info` для информационных сообщений и `logger.error` для сообщений об ошибках.
   -  Добавить обработку ошибок при запросе вкладок и отправке сообщений.

3.  **Изменить структуру кода**:
    -  Вынести обработку отправки сообщения в отдельную функцию.

4.  **Добавить обработку ошибок**:
    -   Добавить try-except блоки для обработки возможных ошибок chrome API.
    -   Обеспечить логирование ошибок.

**Оптимизированный код**

```python
"""
Модуль для обработки событий popup окна расширения Chrome.
========================================================

Этот модуль отвечает за отправку URL текущей активной вкладки
расширению Chrome при нажатии на кнопку.

"""
from src.logger.logger import logger


# Получаем кнопку из popup окна
document.getElementById("sendUrlButton").addEventListener("click", () => {
    """
    Обработчик события нажатия кнопки.

    При нажатии на кнопку выполняется отправка URL текущей активной вкладки.
    """
    #  Код исполняет запрос текущей активной вкладки
    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
        """
         Коллбэк функция для обработки ответа на запрос активных вкладок.

         :param tabs: Список активных вкладок.
        """
        try:
            #  Код получает активную вкладку из списка
            let activeTab = tabs[0];
            #  Код извлекает URL активной вкладки
            let activeTabUrl = activeTab.url;

            #  Код вызывает функцию для отправки URL
            sendUrlToBackground(activeTabUrl)
        except Exception as ex:
            #  Логирует ошибку в случае неудачи
            logger.error('Ошибка при запросе активной вкладки', ex)

    });
});

function sendUrlToBackground(url) {
    """
    Отправляет URL в background script.

     :param url: URL текущей активной вкладки.
    """
    #  Код отправляет сообщение в background script
    chrome.runtime.sendMessage({ action: "sendUrl", url: url }, (response) => {
        """
        Коллбэк функция для обработки ответа от background script.

        :param response: Ответ от background script.
        """
        try:
            if (response.status === "success") {
                #  Код выводит сообщение об успешной отправке
                logger.info("URL sent successfully!");
            } else {
                #  Код выводит сообщение о неудачной отправке
                logger.error("Failed to send URL.");
            }
        except Exception as ex:
            #  Логирует ошибку в случае неудачи
            logger.error('Ошибка при отправке сообщения', ex)
    });
}
```
# Модуль `translate_readme.py`

## Обзор

Модуль предназначен для перевода файлов `README.md` на другие языки, используя API GPT4Free. Он разделяет текст на части, переводит каждую часть, учитывая необходимость сохранения определенных блоков кода и структуры Markdown.

## Подробнее

Этот модуль используется для автоматического перевода документации, хранящейся в файлах `README.md`. Он позволяет переводить текст на разные языки, сохраняя при этом форматирование и структуру документа. Для работы требуется API GPT4Free. В коде реализована возможность исключения определенных блоков из перевода и сохранения структуры Markdown.

## Функции

### `read_text`

```python
def read_text(text) -> str:
    """Извлекает текст из markdown-блока, находящегося между символами ```.

    Args:
        text (str): Исходный текст.

    Returns:
        str: Текст, находящийся между блоками ```, очищенный от лишних пробелов.

    Как работает функция:
    1.  Разбивает исходный текст на строки.
    2.  Определяет начальный и конечный индексы блоков, заключенных в ```.
    3.  Извлекает текст между этими блоками.
    4.  Удаляет лишние пробелы в начале и конце извлеченного текста.

    A
    ↓
    B → C
    ↓
    D

    Где:
    A: Разделение текста на строки
    B: Поиск начала блока ```
    C: Поиск конца блока ```
    D: Извлечение текста между блоками

    Примеры:
    >>> read_text("```\\nHello\\n```")
    'Hello'
    >>> read_text("Some text\\n```\\nLine 1\\nLine 2\\n```\\nMore text")
    'Line 1\\nLine 2'
    """
    ...
```

### `translate`

```python
async def translate(text: str) -> str:
    """Асинхронно переводит предоставленный текст с использованием API GPT4Free.

    Args:
        text (str): Текст для перевода.

    Returns:
        str: Переведенный текст.

    Как работает функция:
    1.  Формирует запрос для API GPT4Free, включая текст для перевода и инструкции по сохранению структуры Markdown.
    2.  Использует `provider.create_async` для отправки запроса и получения перевода.
    3.  Извлекает переведенный текст из ответа.
    4.  Добавляет закрывающий блок "```", если исходный текст заканчивается на "```", а результат - нет.

    A
    ↓
    B
    ↓
    C → D
    ↓
    E

    Где:
    A: Формирование запроса для API
    B: Отправка запроса к API и получение ответа
    C: Извлечение переведенного текста
    D: Проверка на окончание блока кода
    E: Возвращение переведенного текста

    Примеры:
    >>> await translate("Hello, world!")
    'Привет, мир!'
    """
    ...
```

### `translate_part`

```python
async def translate_part(part: str, i: int) -> str:
    """Асинхронно переводит часть документа, обрабатывая блокировку и разрешение перевода отдельных элементов.

    Args:
        part (str): Часть текста для перевода.
        i (int): Индекс части.

    Returns:
        str: Переведенная часть текста.

    Как работает функция:
    1.  Проверяет, входит ли текущая часть текста в список заблокированных для перевода (`blocklist`).
    2.  Если часть текста заблокирована:
        a. Переводит только первую строку (заголовок).
        b. Проходит по списку разрешенных для перевода элементов (`allowlist`) и переводит их.
    3.  Если часть текста не заблокирована, переводит её целиком.
    4.  Выводит сообщение о завершении перевода текущей части.

    A
    ↓
    B → C
    │   ↓
    │   D → E
    │   ↓
    │   F
    │
    G

    Где:
    A: Получение части текста и её индекса
    B: Проверка на наличие в blocklist
    C: Если часть текста в blocklist, перевод первой строки
    D: Перебор элементов в allowlist
    E: Перевод элементов из allowlist
    F: Объединение переведенных строк
    G: Перевод всей части текста, если её нет в blocklist

    Примеры:
    Предположим, `blocklist` содержит "## ©️ Copyright", а `allowlist` содержит "### Models".
    >>> await translate_part("## ©️ Copyright This is a copyright notice", 1)
    '## ©️ Copyright Это уведомление об авторских правах'
    >>> await translate_part("### Models Available models", 2)
    '### Models Доступные модели'
    """
    ...
```

### `translate_readme`

```python
async def translate_readme(readme: str) -> str:
    """Асинхронно переводит весь README-файл, разделяя его на части и обрабатывая каждую часть параллельно.

    Args:
        readme (str): Полный текст README-файла.

    Returns:
        str: Переведенный README-файл.

    Как работает функция:
    1.  Разделяет README-файл на части по разделителю "## ".
    2.  Создает список задач для асинхронного перевода каждой части с использованием `translate_part`.
    3.  Запускает все задачи параллельно с помощью `asyncio.gather`.
    4.  Объединяет переведенные части в один текст.

    A
    ↓
    B
    ↓
    C
    ↓
    D

    Где:
    A: Разделение README на части
    B: Создание списка задач для асинхронного перевода
    C: Параллельное выполнение задач перевода
    D: Объединение переведенных частей

    Примеры:
    >>> await translate_readme("## Introduction This is an introduction")
    '## Introduction Это введение'
    """
    ...
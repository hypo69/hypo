# Модуль для работы с FTP-серверами

## Обзор

Модуль `src.utils.ftp` предоставляет интерфейс для взаимодействия с FTP-серверами. Он включает функции для отправки, получения и удаления файлов с FTP-сервера.

## Подробнее

Этот модуль позволяет отправлять и получать медиафайлы (изображения, видео), электронные таблицы и другие файлы на FTP-сервер и с него.
В модуле используются локальные вспомогательные утилиты для операций FTP, а также модули `typing`, `ftplib` и `pathlib`.

## Содержание

- [Классы](#классы)
- [Функции](#функции)
    - [write](#write)
    - [read](#read)
    - [delete](#delete)

## Классы

В данном модуле классы отсутствуют.

## Функции

### `write`

```python
def write(source_file_path: str, dest_dir: str, dest_file_name: str) -> bool:
    """
    Отправляет файл на FTP-сервер.

    Args:
        source_file_path (str): Путь к файлу, который нужно отправить.
        dest_dir (str): Каталог назначения на FTP-сервере.
        dest_file_name (str): Имя файла на FTP-сервере.

    Returns:
        bool: `True`, если файл успешно отправлен, `False` в противном случае.

    Example:
        >>> success = write('local_path/to/file.txt', '/remote/directory', 'file.txt')
        >>> print(success)
        True
    """
```

**Назначение**:
Функция `write` отправляет файл с локального компьютера на FTP-сервер. Она устанавливает соединение с FTP-сервером, переходит в указанный каталог назначения и отправляет файл.

**Параметры**:
- `source_file_path` (str): Локальный путь к файлу, который нужно отправить.
- `dest_dir` (str): Путь к каталогу на FTP-сервере, куда нужно поместить файл.
- `dest_file_name` (str): Имя, которое файл получит на FTP-сервере.

**Возвращает**:
- `bool`: Возвращает `True`, если файл успешно отправлен на FTP-сервер. В случае неудачи возвращает `False`.

**Вызывает исключения**:
- `ftplib.all_errors`: Возникает при ошибках, связанных с FTP-соединением или передачей файлов.

**Как работает функция**:

1.  **Установка соединения**: Функция пытается установить соединение с FTP-сервером, используя предоставленные параметры (_connection).
2.  **Переход в каталог**: После успешного соединения, функция пытается перейти в указанный каталог назначения (`dest_dir`) на FTP-сервере.
3.  **Отправка файла**: Если соединение установлено и каталог найден, функция открывает файл, расположенный по адресу `source_file_path`, в бинарном режиме для чтения и отправляет его на FTP-сервер под именем `dest_file_name`.
4.  **Обработка исключений**: Если на любом из этапов происходит ошибка (например, не удалось подключиться к серверу, перейти в каталог или отправить файл), функция логирует ошибку с помощью `logger.error` и возвращает `False`.
5.  **Закрытие соединения**: В блоке `finally` функция пытается закрыть FTP-соединение, чтобы освободить ресурсы. Если закрытие соединения также вызывает ошибку, она логируется, но не влияет на основной поток выполнения.

**Блок-схема работы функции**:

```
    Начало
    │
    ├─── Соединение с FTP-сервером
    │    │
    │    └─── Успешно?
    │         │
    │         ├─── Да ─── Переход в каталог назначения
    │         │         │
    │         │         └─── Успешно?
    │         │              │
    │         │              ├─── Да ─── Открытие и отправка файла
    │         │              │         │
    │         │              │         └─── Успешно?
    │         │              │              │
    │         │              │              ├─── Да ─── Возврат True
    │         │              │              │
    │         │              │              └─── Нет ─── Логирование ошибки, Возврат False
    │         │              │
    │         │              └─── Нет ─── Логирование ошибки, Возврат False
    │         │
    │         └─── Нет ─── Логирование ошибки, Возврат False
    │
    └─── Закрытие соединения с FTP-сервером
         │
         └─── Конец
```

**Примеры**:

```python
success = write('local_path/to/file.txt', '/remote/directory', 'file.txt')
print(success)

success = write('/home/user/documents/report.pdf', '/reports', 'report_2023.pdf')
print(success)

success = write('image.png', '/images/thumbnails', 'image_small.png')
print(success)
```

### `read`

```python
def read(source_file_path: str, dest_dir: str, dest_file_name: str) -> Union[str, bytes, None]:
    """
    Получает файл с FTP-сервера.

    Args:
        source_file_path (str): Путь, по которому файл будет сохранен локально.
        dest_dir (str): Каталог на FTP-сервере, где находится файл.
        dest_file_name (str): Имя файла на FTP-сервере.

    Returns:
        Union[str, bytes, None]: Содержимое файла, если он успешно получен, `None` в противном случае.

    Example:
        >>> content = read('local_path/to/file.txt', '/remote/directory', 'file.txt')
        >>> print(content)
        b'Some file content'
    """
```

**Назначение**:
Функция `read` загружает файл с FTP-сервера и сохраняет его локально. Она устанавливает соединение с FTP-сервером, переходит в указанный каталог и скачивает файл.

**Параметры**:
- `source_file_path` (str): Локальный путь, куда будет сохранен скачанный файл.
- `dest_dir` (str): Путь к каталогу на FTP-сервере, где находится файл.
- `dest_file_name` (str): Имя файла, который нужно скачать с FTP-сервера.

**Возвращает**:
- `Union[str, bytes, None]`: Возвращает содержимое файла в виде байтов, если файл успешно скачан с FTP-сервера. В случае неудачи возвращает `None`.

**Вызывает исключения**:
- `ftplib.all_errors`: Возникает при ошибках, связанных с FTP-соединением или передачей файлов.

**Как работает функция**:

1.  **Установка соединения**: Функция пытается установить соединение с FTP-сервером, используя предоставленные параметры (_connection).
2.  **Переход в каталог**: После успешного соединения, функция пытается перейти в указанный каталог (`dest_dir`) на FTP-сервере, где находится целевой файл.
3.  **Загрузка файла**: Если соединение установлено и каталог найден, функция создает и открывает локальный файл по адресу `source_file_path` в бинарном режиме для записи. Затем она пытается скачать файл с FTP-сервера (`dest_file_name`) и сохранить его в локальный файл.
4.  **Чтение содержимого файла**: После успешной загрузки функция открывает сохраненный локальный файл в бинарном режиме для чтения и возвращает его содержимое.
5.  **Обработка исключений**: Если на любом из этапов происходит ошибка (например, не удалось подключиться к серверу, перейти в каталог, скачать или сохранить файл), функция логирует ошибку с помощью `logger.error` и возвращает `None`.
6.  **Закрытие соединения**: В блоке `finally` функция пытается закрыть FTP-соединение, чтобы освободить ресурсы. Если закрытие соединения также вызывает ошибку, она логируется, но не влияет на основной поток выполнения.

**Блок-схема работы функции**:

```
    Начало
    │
    ├─── Соединение с FTP-сервером
    │    │
    │    └─── Успешно?
    │         │
    │         ├─── Да ─── Переход в каталог назначения
    │         │         │
    │         │         └─── Успешно?
    │         │              │
    │         │              ├─── Да ─── Создание и открытие локального файла
    │         │              │         │
    │         │              │         └─── Успешно?
    │         │              │              │
    │         │              │              ├─── Да ─── Загрузка файла с FTP-сервера и сохранение в локальный файл
    │         │              │              │         │
    │         │              │              │         └─── Успешно?
    │         │              │              │              │
    │         │              │              │              ├─── Да ─── Чтение содержимого локального файла
    │         │              │              │              │         │
    │         │              │              │              │         └─── Возврат содержимого файла
    │         │              │              │              │
    │         │              │              │              └─── Нет ─── Логирование ошибки, Возврат None
    │         │              │              │
    │         │              │              └─── Нет ─── Логирование ошибки, Возврат None
    │         │              │
    │         │              └─── Нет ─── Логирование ошибки, Возврат None
    │         │
    │         └─── Нет ─── Логирование ошибки, Возврат None
    │
    └─── Закрытие соединения с FTP-сервером
         │
         └─── Конец
```

**Примеры**:

```python
content = read('local_path/to/file.txt', '/remote/directory', 'file.txt')
print(content)

content = read('/home/user/downloads/report_downloaded.pdf', '/reports', 'report_2023.pdf')
print(content)

content = read('downloaded_image.png', '/images/thumbnails', 'image_small.png')
print(content)
```

### `delete`

```python
def delete(source_file_path: str, dest_dir: str, dest_file_name: str) -> bool:
    """
    Удаляет файл с FTP-сервера.

    Args:
        source_file_path (str): Путь, по которому файл расположен локально (не используется).
        dest_dir (str): Каталог на FTP-сервере, где находится файл.
        dest_file_name (str): Имя файла на FTP-сервере.

    Returns:
        bool: `True`, если файл успешно удален, `False` в противном случае.

    Example:
        >>> success = delete('local_path/to/file.txt', '/remote/directory', 'file.txt')
        >>> print(success)
        True
    """
```

**Назначение**:
Функция `delete` удаляет файл с FTP-сервера. Она устанавливает соединение с FTP-сервером, переходит в указанный каталог и удаляет файл.

**Параметры**:
- `source_file_path` (str): Локальный путь к файлу (не используется в функции, указан только для совместимости интерфейса).
- `dest_dir` (str): Путь к каталогу на FTP-сервере, где находится файл для удаления.
- `dest_file_name` (str): Имя файла, который нужно удалить с FTP-сервера.

**Возвращает**:
- `bool`: Возвращает `True`, если файл успешно удален с FTP-сервера. В случае неудачи возвращает `False`.

**Вызывает исключения**:
- `ftplib.all_errors`: Возникает при ошибках, связанных с FTP-соединением или удалением файлов.

**Как работает функция**:

1.  **Установка соединения**: Функция пытается установить соединение с FTP-сервером, используя предоставленные параметры (_connection).
2.  **Переход в каталог**: После успешного соединения, функция пытается перейти в указанный каталог (`dest_dir`) на FTP-сервере, где находится целевой файл.
3.  **Удаление файла**: Если соединение установлено и каталог найден, функция пытается удалить файл с именем `dest_file_name` с FTP-сервера.
4.  **Обработка исключений**: Если на любом из этапов происходит ошибка (например, не удалось подключиться к серверу, перейти в каталог или удалить файл), функция логирует ошибку с помощью `logger.error` и возвращает `False`.
5.  **Закрытие соединения**: В блоке `finally` функция пытается закрыть FTP-соединение, чтобы освободить ресурсы. Если закрытие соединения также вызывает ошибку, она логируется, но не влияет на основной поток выполнения.

**Блок-схема работы функции**:

```
    Начало
    │
    ├─── Соединение с FTP-сервером
    │    │
    │    └─── Успешно?
    │         │
    │         ├─── Да ─── Переход в каталог назначения
    │         │         │
    │         │         └─── Успешно?
    │         │              │
    │         │              ├─── Да ─── Удаление файла с FTP-сервера
    │         │              │         │
    │         │              │         └─── Успешно?
    │         │              │              │
    │         │              │              ├─── Да ─── Возврат True
    │         │              │              │
    │         │              │              └─── Нет ─── Логирование ошибки, Возврат False
    │         │              │
    │         │              └─── Нет ─── Логирование ошибки, Возврат False
    │         │
    │         └─── Нет ─── Логирование ошибки, Возврат False
    │
    └─── Закрытие соединения с FTP-сервером
         │
         └─── Конец
```

**Примеры**:

```python
success = delete('local_path/to/file.txt', '/remote/directory', 'file.txt')
print(success)

success = delete('/home/user/documents/old_report.pdf', '/reports', 'report_2022.pdf')
print(success)

success = delete('unused_image.png', '/images/thumbnails', 'old_image.png')
print(success)
# Модуль `event_handler`

## Обзор

Модуль `event_handler` предназначен для обработки событий, генерируемых ассистентом OpenAI. Он содержит класс `EventHandler`, который определяет, как обрабатывать события в потоке ответов, включая создание и изменение текста, а также вызовы инструментов.

## Подробнее

Этот модуль предоставляет механизм для взаимодействия с API OpenAI Assistant и обработки потоковых ответов. Класс `EventHandler` переопределяет методы для обработки различных типов событий, таких как создание текста, добавление изменений в текст и вызовы инструментов. Это позволяет разработчикам настраивать поведение ассистента и реагировать на события в режиме реального времени.

## Классы

### `EventHandler`

**Описание**: Класс `EventHandler` является обработчиком событий для ассистента OpenAI. Он переопределяет методы для обработки различных типов событий, генерируемых ассистентом.

**Как работает класс**:
Класс `EventHandler` наследуется от `AssistantEventHandler` из библиотеки `openai`. Он переопределяет методы, такие как `on_text_created`, `on_text_delta`, `on_tool_call_created` и `on_tool_call_delta`, чтобы определить, как обрабатывать соответствующие события.

**Методы**:

- `on_text_created(self, text: Text) -> None`:
    - Вызывается при создании нового текста.
    - Выводит в консоль индикатор начала текста от ассистента.

- `on_text_delta(self, delta: TextDelta, snapshot: Text)`:
    - Вызывается при получении изменений в тексте.
    - Выводит в консоль добавленные изменения в текст.

- `on_tool_call_created(self, tool_call: ToolCall)`:
    - Вызывается при создании вызова инструмента.
    - Выводит в консоль тип вызванного инструмента.

- `on_tool_call_delta(self, delta: ToolCallDelta, snapshot: ToolCall)`:
    - Вызывается при получении изменений в вызове инструмента.
    - Обрабатывает изменения для инструмента `code_interpreter`, выводя ввод и вывод кода.

## Функции

### `on_text_created`

```python
def on_text_created(self, text: Text) -> None:
    """
    Вызывается при создании нового текстового объекта.

    Args:
        text (Text): Объект Text, содержащий информацию о созданном тексте.

    Returns:
        None

    """
    ...
```

**Как работает функция**:

Функция `on_text_created` вызывается при создании нового текстового объекта. Внутри функции происходит вывод в консоль строки "assistant >", которая служит индикатором начала текста, сгенерированного ассистентом. `flush=True` обеспечивает немедленный вывод текста в консоль.

**Параметры**:

- `text` (Text): Объект `Text`, содержащий информацию о созданном тексте.

**Возвращает**:

- `None`

### `on_text_delta`

```python
def on_text_delta(self, delta: TextDelta, snapshot: Text):
    """
    Вызывается при получении дельты (изменения) в текстовом объекте.

    Args:
        delta (TextDelta): Объект TextDelta, содержащий информацию об изменении текста.
        snapshot (Text): Объект Text, представляющий текущее состояние текста.

    Returns:
        None

    """
    ...
```

**Как работает функция**:

Функция `on_text_delta` вызывается при получении изменений в текстовом объекте. Она принимает объект `TextDelta`, который содержит информацию об изменении текста, и объект `Text`, представляющий текущее состояние текста. Внутри функции происходит вывод в консоль значения `delta.value`, которое представляет собой добавленные изменения в текст. `flush=True` обеспечивает немедленный вывод текста в консоль.

**Параметры**:

- `delta` (TextDelta): Объект `TextDelta`, содержащий информацию об изменении текста.
- `snapshot` (Text): Объект `Text`, представляющий текущее состояние текста.

**Возвращает**:

- `None`

### `on_tool_call_created`

```python
def on_tool_call_created(self, tool_call: ToolCall):
    """
    Вызывается при создании нового вызова инструмента.

    Args:
        tool_call (ToolCall): Объект ToolCall, содержащий информацию о вызове инструмента.

    Returns:
        None

    """
    ...
```

**Как работает функция**:

Функция `on_tool_call_created` вызывается при создании нового вызова инструмента. Она принимает объект `ToolCall`, который содержит информацию о вызванном инструменте. Внутри функции происходит вывод в консоль типа вызванного инструмента. `flush=True` обеспечивает немедленный вывод текста в консоль.

**Параметры**:

- `tool_call` (ToolCall): Объект `ToolCall`, содержащий информацию о вызове инструмента.

**Возвращает**:

- `None`

### `on_tool_call_delta`

```python
 def on_tool_call_delta(self, delta: ToolCallDelta, snapshot: ToolCall):
    """
    Вызывается при получении дельты (изменения) в вызове инструмента.

    Args:
        delta (ToolCallDelta): Объект ToolCallDelta, содержащий информацию об изменении вызова инструмента.
        snapshot (ToolCall): Объект ToolCall, представляющий текущее состояние вызова инструмента.

    Returns:
        None

    """
    ...
```

**Как работает функция**:

Функция `on_tool_call_delta` вызывается при получении изменений в вызове инструмента. Она принимает объект `ToolCallDelta`, содержащий информацию об изменении вызова инструмента, и объект `ToolCall`, представляющий текущее состояние вызова инструмента. Внутри функции проверяется, является ли тип инструмента `code_interpreter`. Если это так, и если есть ввод (`delta.code_interpreter.input`), то он выводится в консоль. Если есть вывод (`delta.code_interpreter.outputs`), то он также выводится в консоль. В частности, если тип вывода - `logs`, то логи выводятся в консоль. `flush=True` обеспечивает немедленный вывод текста в консоль.

**Параметры**:

- `delta` (ToolCallDelta): Объект `ToolCallDelta`, содержащий информацию об изменении вызова инструмента.
- `snapshot` (ToolCall): Объект `ToolCall`, представляющий текущее состояние вызова инструмента.

**Возвращает**:

- `None`
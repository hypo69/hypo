# Документация для модуля Code Rules

## Обзор

Этот документ описывает правила и рекомендации по написанию кода для проекта. Он включает в себя принципы, форматирование, требования к документированию и другие важные аспекты.

## Содержание

- [Общие принципы](#общие-принципы)
- [Комментарии](#комментарии)
- [Документация](#документация)
- [Форматирование кода](#форматирование-кода)
- [Параметры функций](#параметры-функций)
- [Pydantic](#pydantic)
- [Логирование](#логирование)
- [Константы](#константы)
- [Формат ответа](#формат-ответа)
- [Примеры](#примеры)

## Общие принципы

- Используйте согласованный стиль кодирования для повышения читаемости и единообразия.
- Все изменения и рекомендации должны соответствовать этому формату.

## Комментарии

### Комментарии после `#`

- **Не изменять**: Комментарии после `#` должны оставаться без изменений и быть понятными. Не переписывайте и не удаляйте их, даже если они начинаются с кода.
- **Информативность**: Внутренние комментарии должны быть информативными и объяснять следующий блок кода.
- **Формат**: Используйте формат reStructuredText (RST) для всех комментариев и документации.
- **Терминология**: Избегайте использования таких терминов, как `get`, `do` в комментариях. Вместо этого используйте фразы, например, `check`, `send`, `code executes ...`.
- **Пассивные формы**: Предпочитайте пассивные формы: `copying`, `formatting`, `creating` и т. д.
- **Пустые строки**: Если есть пустые строки или `...`, не документируйте их.

### Комментарии после `"""`

- **Оптимизировать**: Комментарии после `"""` можно и нужно оптимизировать, исходя из фактического поведения кода.

## Документация

### Docstring

- Каждая функция, метод и класс должны иметь docstring в стиле Sphinx.
    ```python
    def function(param: str, param1: Optional[str | dict] = None) -> dict | None:
        """
        Function description.

        :param param: Description of the `param` parameter.
        :param param1: (Optional) Description of the `param1` parameter.
        :return: Description of the return value.
        :raises SomeError: Conditions for the exception.
        """
    ```

### Описание модуля

- Добавьте описание модуля в начало каждого файла:
    ```python
    """
    Module for working with a programmer assistant
    =========================================================================================

    Description of the module functionality.

    Example usage
    -------------

    .. code-block:: python

        example_usage()
    """
    ```

## Форматирование кода

- **Кавычки**: Используйте одинарные кавычки вместо двойных.
- **Пробелы**: Используйте пробелы вокруг оператора присваивания `=`. Пример:
    ```python
    a = 1
    ```
- **Согласованность**: Применяйте пробелы согласованно во всех выражениях и присваиваниях:
    ```python
    result = 10 if x > 5 else 20
    ```
- **Заголовок импорта**: Всегда включайте строку `import header` в начало файла.
- **Отладка**: Добавьте `...` между `logger` и `return` для отладки, пример:
    ```python
    logger.error('Error while executing task', ex)
    ...
    return
    ```

## Параметры функций

- **Типизация**: Параметры должны быть явно типизированы. Если значение по умолчанию `None`, используйте `Optional`. Пример:
    ```python
    def critical(self, message: str, ex: Optional = None, exc_info: Optional[bool] = True):
    ```
- **Избегать Union**: Избегайте использования `Union`.

## Pydantic

- **Валидация**: Используйте Pydantic для валидации данных, если это возможно и уместно.
- **Модели**: Предпочитайте модели Pydantic для классов, обрабатывающих структурированные данные.

## Логирование

- **Logger**: Используйте `from src.logger.logger import logger` для логирования вместо стандартного `logging`.
- **Пример логирования ошибок**:
    ```python
    logger.error('Error while starting bot: ', ex)
    ...
    return
    ```

## Константы

- **MODE**: Всегда включайте глобальную константу `MODE` в код, даже если она не используется.

## Формат ответа

Все ответы должны соответствовать формату Markdown.

Структура ответа должна включать:

- **Улучшенный код**: Блок с улучшенным кодом, отформатированный и с добавленными комментариями.
- **Изменения**: Подробный список изменений и объяснений.

Код должен быть заключен в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).

## Примеры

### Пример 1 (Python Code):

**Ввод:**

```python
def add_numbers(a,b):
    return a+b
```

**Ожидаемый ответ:**

### Улучшенный код:

```python
def add_numbers(a: int, b: int) -> int:
    """
    Function that adds two numbers.

    :param a: The first number.
    :type a: int
    :param b: The second number.
    :type b: int
    :returns: The sum of numbers `a` and `b`.
    :rtype: int
    """
    return a + b
```

### Изменения:

- Добавлена документация в стиле RST для описания функции.
- Добавлены аннотации типов для `a` и `b`.
- Добавлены пробелы вокруг `+` и параметров функции для улучшения читаемости.

### Оптимизированный полный код:

```python
def add_numbers(a: int, b: int) -> int:
    """
    Function that adds two numbers.

    :param a: The first number.
    :type a: int
    :param b: The second number.
    :type b: int
    :returns: The sum of numbers `a` and `b`.
    :rtype: int
    """
    return a + b
```
# Модуль tinytroupe.factory

## Обзор

Этот модуль содержит классы для создания и управления фабриками, которые генерируют агентов.  Он включает базовый класс `TinyFactory` и специализированный класс `TinyPersonFactory` для создания агентов `TinyPerson`.  Модуль реализует механизмы кэширования и транзакций для обеспечения согласованности данных.

## Классы

### `TinyFactory`

**Описание**: Базовый класс для различных типов фабрик.  Важен для расширения системы, особенно в отношении кэширования транзакций.

**Атрибуты**:

- `all_factories`: Словарь, содержащий все созданные фабрики (имя -> фабрика).

**Методы**:

- `__init__(self, simulation_id: str = None) -> None`: Инициализирует экземпляр `TinyFactory`.
    - **Аргументы**:
        - `simulation_id` (str, необязательно): Идентификатор симуляции. По умолчанию `None`.
    - **Возвращает**:
        - `None`

- `__repr__(self)`: Возвращает строковое представление объекта.

- `set_simulation_for_free_factories(simulation)`: Устанавливает симуляцию для свободных фабрик, если она не задана.  Позволяет связать свободные среды со специфическими областями симуляции.
    - **Аргументы**:
        - `simulation`: Объект симуляции.

- `add_factory(factory)`: Добавляет фабрику в список всех фабрик. Имена фабрик должны быть уникальными.
    - **Аргументы**:
        - `factory`: Объект фабрики.
    - **Возвращает**:
        - `None`
    - **Исключения**:
        - `ValueError`: Если фабрика с таким же именем уже существует.

- `clear_factories()`: Очищает глобальный список всех фабрик.

- `encode_complete_state(self) -> dict`: Кодирует полное состояние фабрики.  Подклассы должны переопределять этот метод, если они содержат несериализуемые элементы.
    - **Возвращает**:
        - `dict`: Кодированное состояние.

- `decode_complete_state(self, state: dict)`: Декодирует полное состояние фабрики. Подклассы должны переопределять этот метод, если они содержат несериализуемые элементы.
    - **Аргументы**:
        - `state` (dict): Закодированное состояние.
    - **Возвращает**:
        - `self`: Объект фабрики, обновленный декодированным состоянием.


### `TinyPersonFactory`

**Описание**: Фабрика для создания агентов `TinyPerson`.

**Атрибуты**:

- `person_prompt_template_path`: Путь к шаблону запроса для генерации агентов.
- `context_text`: Текст контекста для генерации агентов.
- `generated_minibios`: Список сгенерированных мини-биографий агентов.
- `generated_names`: Список сгенерированных имён агентов.

**Методы**:

- `__init__(self, context_text, simulation_id: str = None)`: Инициализирует экземпляр `TinyPersonFactory`.
    - **Аргументы**:
        - `context_text` (str): Текст контекста.
        - `simulation_id` (str, необязательно): Идентификатор симуляции.
    - **Возвращает**:
        - `None`

- `generate_person_factories(number_of_factories, generic_context_text)`: Генерирует список `TinyPersonFactory` экземпляров с помощью LLM OpenAI.
    - **Аргументы**:
        - `number_of_factories` (int): Количество экземпляров `TinyPersonFactory` для генерации.
        - `generic_context_text` (str): Общий контекст для генерации.
    - **Возвращает**:
        - `list`: Список экземпляров `TinyPersonFactory` или `None`, если запрос не успешен.

- `generate_person(self, agent_particularities: str = None, temperature: float = 1.5, attempts: int = 5)`: Генерирует экземпляр `TinyPerson` с помощью LLM OpenAI.
    - **Аргументы**:
        - `agent_particularities` (str, необязательно): Характеристики агента.
        - `temperature` (float, необязательно): Температура для выборки из LLM. По умолчанию 1.5.
        - `attempts` (int, необязательно): Максимальное количество попыток генерации. По умолчанию 5.
    - **Возвращает**:
        - `TinyPerson`: Экземпляр `TinyPerson` или `None`, если генерация не удалась.
    - **Исключения**:
        - `Exception`: Общее исключение при генерации агента.


- `_aux_model_call(self, messages, temperature)`: Вспомогательный метод для вызова модели. Нужен для использования декоратора `@transactional`.
    - **Аргументы**:
        - `messages`: Сообщения для модели.
        - `temperature`: Параметр температуры.
    - **Возвращает**:
        - Ответ модели или `None`.


- `_setup_agent(self, agent, configuration)`: Настраивает агента с необходимыми элементами.
    - **Аргументы**:
        - `agent`: Объект агента.
        - `configuration`: Настройка агента.

## Функции

### `TinyFactory.add_factory`


### `TinyFactory.clear_factories`


## Примечания

Модуль использует сторонние библиотеки: `os`, `json`, `chevron`, `logging`, `copy`, `openai_utils`, `tinytroupe.utils`, `tinytroupe.control.transactional`, `tinytroupe.agent`.  Правильное использование этих библиотек необходимо для корректной работы модуля.
# Анализ кода модуля `85_stars.ru.md`

**Качество кода**

- **Соответствие требованиям к формату кода (1-10):** 5
    - **Плюсы:**
        - Представлено подробное описание игры, включая правила, пошаговые инструкции, примеры работы программы, возможные ограничения и рекомендации по реализации.
        - Структура документа логична и понятна, разделена на основные разделы.
        - Приведены примеры ввода и вывода программы, что помогает понять игровой процесс.
    - **Минусы:**
        - Документ написан на языке Markdown и не содержит исполняемого кода Python, что является требованием к заданию.
        - Отсутствуют docstring и аннотации типов, что требуется для соблюдения стандартов оформления кода Python.
        - Не соблюдено требование использовать reStructuredText (RST) для всех комментариев.
        - Отсутствует обработка ошибок и использование `logger.error`.
        - Не предоставлены примеры использования `j_loads` или `j_loads_ns`.
        - Не представлен блок кода, который можно было бы скопировать и вставить.
        - Отсутствует информация о импортах.

**Рекомендации по улучшению**

1. **Преобразование в исполняемый код:** Преобразовать текст в исполняемый код Python.
2. **Добавление docstring и аннотации типов:** Добавить docstring и аннотации типов ко всем функциям, методам и классам.
3. **Использование reStructuredText (RST):** Использовать reStructuredText (RST) для всех комментариев и docstring.
4. **Обработка ошибок:** Использовать `try-except` блоки и `logger.error` для обработки ошибок.
5. **Использование `j_loads` или `j_loads_ns`:** Использовать `j_loads` или `j_loads_ns` из `src.utils.jjson` для загрузки данных из файлов (если требуется).
6. **Улучшение структуры кода:** Разбить код на более мелкие функции для улучшения читаемости и тестируемости.
7. **Добавить import:** Добавить необходимые импорты.
8. **Форматирование кода:** Отформатировать код в соответствии с PEP 8.
9.  **Примеры использования:** Включить примеры использования функций и классов.
10. **Добавить блок кода:** Добавить блок кода, который можно скопировать и вставить.

**Улучшенный код**

```python
"""
Модуль для реализации игры "Звезды".
=========================================================================================

Модуль содержит функции для создания и управления игрой "Звезды".
Игрок должен угадать расположение звезд на игровом поле.

Пример использования
--------------------

.. code-block:: python

    game = StarsGame()
    game.start_game()
"""
import random  # Импорт модуля random для генерации случайных чисел #
from typing import List, Tuple  # Импорт типов List, Tuple #
from src.logger.logger import logger  # Импорт logger для логирования ошибок #
from src.utils.jjson import j_loads_ns  # Импорт j_loads_ns #
# TODO: Добавить проверку на корректность ввода пользователя #
# TODO: Добавить возможность выбора размера поля и количества звезд #

def generate_stars(grid_size: int, num_stars: int) -> List[Tuple[int, int]]:
    """
    Генерирует случайные координаты для звезд на сетке.

    :param grid_size: Размер сетки.
    :param num_stars: Количество звезд для генерации.
    :return: Список кортежей с координатами звезд.
    """
    stars = set() # Создаем множество для хранения координат звезд #
    while len(stars) < num_stars: # Пока количество звезд меньше требуемого #
        x = random.randint(0, grid_size - 1) # Генерируем случайную координату x #
        y = random.randint(0, grid_size - 1) # Генерируем случайную координату y #
        stars.add((x, y)) # Добавляем координаты звезды в множество #
    return list(stars)  # Возвращаем список кортежей координат звезд #

def check_guess(guess: List[Tuple[int, int]], stars: List[Tuple[int, int]]) -> Tuple[int, int]:
    """
    Проверяет предположение игрока и возвращает количество правильных и угаданных, но не на месте, звезд.

    :param guess: Список кортежей с предположениями игрока.
    :param stars: Список кортежей с правильными координатами звезд.
    :return: Кортеж, содержащий количество правильных и угаданных, но не на месте звезд.
    """
    correct_place = 0  # Инициализируем счетчик правильных мест #
    guessed_not_place = 0  # Инициализируем счетчик угаданных, но не на месте звезд #
    for star in stars:  # Перебираем все звезды #
        if star in guess: # Если звезда есть в предположении игрока #
            index = guess.index(star)  # Получаем индекс звезды в предположении #
            if guess[index] == star:  # Если звезда находится в правильном месте #
                correct_place += 1  # Увеличиваем счетчик правильных мест #
            else:  # Если звезда угадана, но не на месте #
                guessed_not_place += 1 # Увеличиваем счетчик угаданных, но не на месте звезд #
    return correct_place, guessed_not_place  # Возвращаем количество правильных и угаданных, но не на месте звезд #

class StarsGame:
    """
    Класс для управления игрой "Звезды".
    """
    def __init__(self, grid_size: int = 5, num_stars: int = 5) -> None:
        """
        Инициализирует игру "Звезды".

        :param grid_size: Размер сетки.
        :param num_stars: Количество звезд в игре.
        """
        self.grid_size = grid_size # Инициализируем размер сетки #
        self.num_stars = num_stars # Инициализируем количество звезд #
        self.stars = generate_stars(self.grid_size, self.num_stars) # Генерируем координаты звезд #
        self.moves = 0 # Инициализируем счетчик ходов #
        self.game_over = False  # Инициализируем флаг окончания игры #

    def start_game(self) -> None:
        """
        Запускает игру "Звезды".
        """
        print("Добро пожаловать в STARS!") # Выводим приветственное сообщение #
        print("Ваша задача — угадать последовательность из пяти звёзд, расположенных на сетке.") # Объясняем правила игры #
        print("Каждый ход вы делаете предположение, а программа сообщает, сколько звёзд находится в правильном месте") # Объясняем правила игры #
        print("и сколько звёзд угадано, но не на своём месте.")  # Объясняем правила игры #
        print("Удачи!") # Выводим пожелание удачи #

        while not self.game_over: # Пока игра не закончена #
            self.moves += 1  # Увеличиваем счетчик ходов #
            guess_str = input("Введите предположение (например, A1, B2, C3, D4, E5): ") # Получаем ввод пользователя #
            try: # Попытка преобразовать ввод пользователя #
                guess = self.parse_guess(guess_str)  # Преобразуем строку ввода в координаты #
            except ValueError as e:  # Если преобразование не удалось #
                logger.error(f"Ошибка ввода: {e}") # Выводим сообщение об ошибке #
                continue # Переходим к следующей итерации цикла #

            correct, guessed = check_guess(guess, self.stars) # Проверяем предположение игрока #
            print(f"Правильное место: {correct}") # Выводим количество звезд на правильном месте #
            print(f"Угадано, но не на месте: {guessed}") # Выводим количество звезд угаданных не на своем месте #

            if correct == self.num_stars: # Если все звезды угаданы #
                self.game_over = True # Завершаем игру #
                print("Вы угадали все звёзды! Поздравляем!") # Выводим поздравление #
                print(f"Вам потребовалось {self.moves} ходов.") # Выводим количество ходов #
                self.play_again() # Предлагаем начать игру снова #

    def parse_guess(self, guess_str: str) -> List[Tuple[int, int]]:
       """
       Преобразует строку ввода в список координат.

       :param guess_str: Строка ввода пользователя.
       :return: Список кортежей координат.
       :raises ValueError: Если ввод не соответствует формату.
       """
       try:
           guess_list = guess_str.replace(" ", "").upper().split(',')  # Убираем пробелы и приводим к верхнему регистру, разделяем по запятой #
           if len(guess_list) != self.num_stars: # Проверяем, соответствует ли количество предположений количеству звезд #
               raise ValueError(f'Неверное количество звезд. Ожидается {self.num_stars}')  # Выбрасываем исключение, если количество звезд не соответствует #
           guess = []  # Создаем пустой список для координат #
           for item in guess_list:  # Перебираем все элементы из списка предположений #
               if len(item) != 2: # Проверяем длину ввода #
                    raise ValueError(f'Неверный формат ввода. Ожидается формат "A1"') # Выбрасываем исключение, если формат ввода не соответсвует #
               x = ord(item[0]) - ord('A') # Преобразуем букву в индекс по x #
               y = int(item[1]) - 1  # Преобразуем цифру в индекс по y #
               if x < 0 or x >= self.grid_size or y < 0 or y >= self.grid_size:  # Проверяем валидность индексов #
                   raise ValueError(f'Координаты вне сетки. Диапазон от A1 до {chr(ord("A") + self.grid_size - 1)}{self.grid_size}') # Выбрасываем исключение, если координаты вне сетки #
               guess.append((x, y))  # Добавляем координаты в список #
           return guess  # Возвращаем список кортежей с координатами #
       except Exception as e:  # Обрабатываем все возможные исключения #
           logger.error(f'Ошибка при обработке ввода пользователя: {e}') # Логируем ошибку #
           raise ValueError(f'Неверный формат ввода: {e}') # Выбрасываем исключение с информацией об ошибке #


    def play_again(self) -> None:
        """
        Предлагает пользователю сыграть снова.
        """
        while True: # Бесконечный цикл для повторного ввода #
            answer = input("Хотите сыграть снова? (да/нет): ").lower() # Получаем ввод от пользователя #
            if answer in ['да', 'yes']: # Проверяем положительный ответ #
                self.__init__()  # Инициализируем игру заново #
                self.start_game() # Запускаем игру #
                break # Выход из цикла #
            elif answer in ['нет', 'no']:  # Проверяем отрицательный ответ #
                print("Спасибо за игру!") # Выводим благодарность за игру #
                break  # Выход из цикла #
            else: # Если ввод не распознан #
                print("Некорректный ввод. Пожалуйста, введите 'да' или 'нет'.") # Выводим сообщение о некорректном вводе #

if __name__ == "__main__":
    game = StarsGame()  # Создаем экземпляр класса StarsGame #
    game.start_game() # Запускаем игру #
```
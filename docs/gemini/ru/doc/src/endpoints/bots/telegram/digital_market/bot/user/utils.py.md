# Документация модуля `utils.py`

## Обзор

Модуль `utils.py` содержит функцию `successful_payment_logic`, которая обрабатывает логику успешной оплаты товара пользователем в Telegram боте. Она включает добавление информации о покупке в базу данных, отправку уведомлений администраторам и предоставление информации о товаре пользователю.

## Подробней

Функция `successful_payment_logic` выполняет следующие действия:

1.  Добавляет информацию о покупке в базу данных через `PurchaseDao`.
2.  Получает данные о продукте из базы данных через `ProductDao`.
3.  Отправляет уведомления администраторам о совершенной покупке.
4.  Отправляет пользователю информацию о приобретенном товаре, включая название, описание, цену и закрытое описание.
5.  Отправляет файл товара, если он есть.
6.  Возвращает звезды за покупку, если оплата была произведена звездами.

## Функции

### `successful_payment_logic`

```python
async def successful_payment_logic(session: AsyncSession, payment_data, currency, user_tg_id, bot: Bot):
    """
    Обрабатывает логику успешной оплаты товара пользователем.

    Args:
        session (AsyncSession): Сессия базы данных SQLAlchemy.
        payment_data (dict): Данные об оплате.
        currency (str): Валюта, в которой произведена оплата.
        user_tg_id (int): Telegram ID пользователя, совершившего покупку.
        bot (Bot): Объект бота aiogram.

    Returns:
        None

    Raises:
        Exception: Если происходит ошибка при отправке уведомления администраторам.

    Example:
        # Пример вызова функции
        await successful_payment_logic(session=session, payment_data=payment_data, currency='USD', user_tg_id=123456789, bot=bot)
    """
    ...
```

**Описание**: Обрабатывает логику успешной оплаты товара пользователем.

**Параметры**:

*   `session` (AsyncSession): Сессия базы данных SQLAlchemy для выполнения операций с базой данных.
*   `payment_data` (dict): Словарь, содержащий данные об оплате, такие как ID продукта, цена, тип оплаты и ID платежа.
*   `currency` (str): Валюта, в которой была произведена оплата (например, "USD").
*   `user_tg_id` (int): Telegram ID пользователя, совершившего покупку. Используется для отправки уведомлений и информации о товаре.
*   `bot` (Bot): Экземпляр бота aiogram, используемый для отправки сообщений администраторам и пользователю.

**Возвращает**:

*   `None`: Функция ничего не возвращает явно.

**Вызывает исключения**:

*   `Exception`: Возникает при ошибке отправки уведомления администраторам.

**Примеры**:

```python
# Пример вызова функции
await successful_payment_logic(
    session=session,
    payment_data={
        "product_id": 123,
        "price": 10.00,
        "payment_type": "stars",
        "payment_id": "payment_123",
        "user_id": 456
    },
    currency="USD",
    user_tg_id=123456789,
    bot=bot
)
```
# Документация для модуля `user_router.py`

## Обзор

Модуль `user_router.py` предназначен для обработки пользовательских взаимодействий в Telegram-боте. Он содержит обработчики для различных команд и callback-запросов, связанных с пользователем, такие как старт бота, просмотр информации о магазине, профиля пользователя и истории покупок. Модуль использует библиотеку `aiogram` для работы с Telegram API и `SQLAlchemy` для взаимодействия с базой данных.

## Подробней

Этот модуль является частью логики Telegram-бота и обрабатывает запросы, связанные с пользователем. Он определяет, какие действия должен выполнять бот в ответ на команды пользователя, такие как `/start`, а также на callback-запросы с данными `home`, `about`, `my_profile` и `purchases`. Модуль взаимодействует с базой данных через `UserDAO` для получения информации о пользователе и его покупках.
Расположен в `hypotez/src/endpoints/bots/telegram/digital_market/bot/user/`, что указывает на его роль в обработке пользовательских взаимодействий в цифровом магазине Telegram-бота.

## Функции

### `cmd_start`

```python
async def cmd_start(message: Message, session_with_commit: AsyncSession):
    """
    Args:
        message (Message): Объект сообщения от Telegram.
        session_with_commit (AsyncSession): Асинхронная сессия SQLAlchemy для работы с базой данных.

    Returns:
        Any: Ответное сообщение пользователю с приветствием и клавиатурой выбора действий.

    Raises:
        Нет.

    Example:
        Примеры вызовов:
        Этот обработчик автоматически вызывается при получении команды `/start` от пользователя.
    """
```

**Описание**: Обработчик команды `/start`. При получении команды проверяет, зарегистрирован ли пользователь в базе данных. Если пользователь зарегистрирован, отправляет приветственное сообщение с клавиатурой выбора действий. Если пользователь не зарегистрирован, добавляет его в базу данных и отправляет приветственное сообщение с клавиатурой выбора действий.

**Параметры**:
- `message` (Message): Объект сообщения от Telegram.
- `session_with_commit` (AsyncSession): Асинхронная сессия SQLAlchemy для работы с базой данных.

**Возвращает**:
- `Any`: Ответное сообщение пользователю с приветствием и клавиатурой выбора действий.

**Вызывает исключения**:
- Нет.

**Примеры**:
- Этот обработчик автоматически вызывается при получении команды `/start` от пользователя.

### `page_home`

```python
async def page_home(call: CallbackQuery):
    """
    Args:
        call (CallbackQuery): Объект callback-запроса от Telegram.

    Returns:
        Any: Ответное сообщение пользователю с приветствием и клавиатурой выбора действий.

    Raises:
        Нет.

    Example:
        Примеры вызовов:
        Этот обработчик автоматически вызывается при получении callback-запроса с данными "home".
    """
```

**Описание**: Обработчик callback-запроса с данными `home`. Отправляет пользователю приветственное сообщение с клавиатурой выбора действий.

**Параметры**:
- `call` (CallbackQuery): Объект callback-запроса от Telegram.

**Возвращает**:
- `Any`: Ответное сообщение пользователю с приветствием и клавиатурой выбора действий.

**Вызывает исключения**:
- Нет.

**Примеры**:
- Этот обработчик автоматически вызывается при получении callback-запроса с данными "home".

### `page_about`

```python
async def page_about(call: CallbackQuery):
    """
    Args:
        call (CallbackQuery): Объект callback-запроса от Telegram.

    Returns:
        Any: Ответное сообщение пользователю с информацией о магазине.

    Raises:
        Нет.

    Example:
        Примеры вызовов:
        Этот обработчик автоматически вызывается при получении callback-запроса с данными "about".
    """
```

**Описание**: Обработчик callback-запроса с данными `about`. Отправляет пользователю информацию о магазине.

**Параметры**:
- `call` (CallbackQuery): Объект callback-запроса от Telegram.

**Возвращает**:
- `Any`: Ответное сообщение пользователю с информацией о магазине.

**Вызывает исключения**:
- Нет.

**Примеры**:
- Этот обработчик автоматически вызывается при получении callback-запроса с данными "about".

### `page_about` (my_profile)

```python
async def page_about(call: CallbackQuery, session_without_commit: AsyncSession):
    """
    Args:
        call (CallbackQuery): Объект callback-запроса от Telegram.
        session_without_commit (AsyncSession): Асинхронная сессия SQLAlchemy для работы с базой данных.

    Returns:
        Any: Ответное сообщение пользователю с информацией о его профиле и статистикой покупок.

    Raises:
        Нет.

    Example:
        Примеры вызовов:
        Этот обработчик автоматически вызывается при получении callback-запроса с данными "my_profile".
    """
```

**Описание**: Обработчик callback-запроса с данными `my_profile`. Отправляет пользователю информацию о его профиле и статистику покупок.

**Параметры**:
- `call` (CallbackQuery): Объект callback-запроса от Telegram.
- `session_without_commit` (AsyncSession): Асинхронная сессия SQLAlchemy для работы с базой данных.

**Возвращает**:
- `Any`: Ответное сообщение пользователю с информацией о его профиле и статистикой покупок.

**Вызывает исключения**:
- Нет.

**Примеры**:
- Этот обработчик автоматически вызывается при получении callback-запроса с данными "my_profile".

### `page_user_purchases`

```python
async def page_user_purchases(call: CallbackQuery, session_without_commit: AsyncSession):
    """
    Args:
        call (CallbackQuery): Объект callback-запроса от Telegram.
        session_without_commit (AsyncSession): Асинхронная сессия SQLAlchemy для работы с базой данных.

    Returns:
        None: Отправляет пользователю информацию о его покупках.

    Raises:
        Exception: Если возникает ошибка при удалении предыдущего сообщения.

    Example:
        Примеры вызовов:
        Этот обработчик автоматически вызывается при получении callback-запроса с данными "purchases".
    """
```

**Описание**: Обработчик callback-запроса с данными `purchases`. Получает список покупок пользователя из базы данных и отправляет информацию о каждой покупке.

**Параметры**:
- `call` (CallbackQuery): Объект callback-запроса от Telegram.
- `session_without_commit` (AsyncSession): Асинхронная сессия SQLAlchemy для работы с базой данных.

**Возвращает**:
- `None`: Отправляет пользователю информацию о его покупках.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при удалении предыдущего сообщения.

**Примеры**:
- Этот обработчик автоматически вызывается при получении callback-запроса с данными "purchases".
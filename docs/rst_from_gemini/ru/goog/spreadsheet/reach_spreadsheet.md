```markdown
# reach_spreadsheet.py

Файл: `hypotez/src/goog/spreadsheet/reach_spreadsheet.py`

**Описание:**

Модуль `reach_spreadsheet` предоставляет класс `ReachSpreadsheet` для работы с Google Sheets API v4. Он позволяет создавать, изменять и читать данные в Google Таблицах, включая форматирование ячеек, объединение ячеек и настройку размеров столбцов/строк. Модуль использует аутентификацию на основе service account.

**Ключевые особенности:**

* **Создание таблиц:** Метод `create` позволяет создавать новые Google Таблицы с указанными параметрами (названием, количеством строк и столбцов, локалем и часовым поясом).
* **Доступ к данным:** Предоставляются методы для подготовки и выполнения запросов к Google Sheets API для добавления данных, изменения формата ячеек, объединения ячеек и других операций.
* **Форматирование:** Поддерживается форматирование ячеек (шрифт, цвет фона, выравнивание, числовые форматы, границы).
* **Обмен:** Поддерживается делегирование прав доступа к таблицам (чтение/запись) для пользователей.
* **Обработка ошибок:** Класс содержит собственные классы исключений `SpreadsheetError`, `SpreadsheetNotSetError`, `SheetNotSetError` для лучшей диагностики проблем.
* **Логирование:** Использует модуль `logger` для записи сообщений об ошибках и информации.
* **Детализированные операции:**  Поддержка batch операций, что ускоряет работу с большим объемом данных.
* **Управление размерами:** Методы для настройки ширины столбцов и высоты строк.
* **Работа с временными файлами:**  В коде присутствует загрузка ключей из временного файла. Это важная деталь для безопасности и управления жизненным циклом ключей.
* **Функции для тестирования:** Модуль содержит набор тестовых функций (`testCreateSpreadsheet`, `testSetSpreadsheet`, `testAddSheet`, и т.д.), которые демонстрируют использование класса и помогают в тестировании.

**Функционал:**

* `htmlColorToJSON`: Преобразует HTML цвет в JSON-формат для использования в API.
* `ReachSpreadsheet`: Основной класс для работы с таблицами.
    * `__init__`: Инициализирует подключение к API и загружает ключи.
    * `create`: Создает новую таблицу.
    * `share`: Делегирует права доступа.
    * `getSheetURL`: Возвращает URL Google Таблицы.
    * `setSpreadsheetById`: Устанавливает текущую таблицу по идентификатору.
    * `runPrepared`: Выполняет подготовленные запросы (batch).
    * `prepare_addSheet`: Подготавливает запрос на добавление листа.
    * `addSheet`: Добавляет новый лист.
    * `toGridRange`: Преобразует строковый диапазон в формат, ожидаемый API.
    * `prepare_setDimensionPixelSize`, `prepare_setColumnsWidth`, `prepare_setColumnWidth`, `prepare_setRowsHeight`, `prepare_setRowHeight`: Подготовка запросов на изменение размеров столбцов/строк.
    * `prepare_setValues`: Подготовка запросов на изменение значений в ячейках.
    * `prepare_mergeCells`: Подготовка запросов на объединение ячеек.
    * `prepare_setCellStringFormatterormat`, `prepare_setCellStringFormatterormats`: Подготовка запросов на форматирование ячеек.

**Рекомендации:**

* **Использование временных файлов:**  Рекомендуется сохранять и загружать ключи service account не напрямую в коде, а из безопасных хранилищ (например, environment variables).
* **Обработка исключений:** Добавьте обработку `googleapiclient.errors.HttpError` во всех методах, выполняющих запросы к API, для более устойчивого кода.
* **Документация:** Добавьте более подробную документацию к методам класса `ReachSpreadsheet` и параметрам функций.
* **Переменные окружения:** Используйте переменные окружения для хранения конфиденциальных данных (например, путь к файлу ключей).


**Критические замечания (применительно к вашему коду):**

* Недостаточно проверено: тест-функции не проверяют все случаи ошибок. Необходимо добавить больше тестов.
* Нехватка валидации: Проверьте входящие данные (например, `spreadsheetId`, `sheetId`).
* Переменные класса:  Улучшите именование переменных, связанных с идентификаторами таблиц и листов (например, `spreadsheetId`, `sheetId`).
* Сложность: некоторые методы слишком длинные.


Этот документ улучшит понимание и обслуживание кода, сделает его более надежным и поддерживаемым.
```
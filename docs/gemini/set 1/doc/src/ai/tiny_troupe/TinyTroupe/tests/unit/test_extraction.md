# Модуль `test_extraction.py`

## Обзор

Этот модуль содержит тесты для модуля `extraction` из проекта TinyTroupe. Он тестирует классы `ArtifactExporter` и `Normalizer`, проверяя правильность экспорта различных типов данных (JSON, текст, docx) и работу нормализатора.

## Фикстуры

### `exporter`

**Описание**: Фикстура для создания экземпляра класса `ArtifactExporter` с заданным каталогом для экспорта.

**Использование**:

```python
@pytest.fixture
def exporter():
    return ArtifactExporter(base_output_folder="./test_exports")
```

**Возвращает**: Экземпляр класса `ArtifactExporter`.

## Функции

### `test_export_json`

**Описание**: Тестирует экспорт данных в формате JSON.

**Параметры**:
- `exporter` (`ArtifactExporter`): Экземпляр класса `ArtifactExporter`.

**Возвращает**: Нет.

**Вызывает исключения**:
- Нет.

**Действия**:
1. Определяет данные для экспорта.
2. Экспортирует данные в файл `test_artifact.json` используя `content_type="record"` и `target_format="json"`.
3. Проверяет, что файл `test_artifact.json` успешно создан.
4. Загружает данные из файла и сравнивает их с исходными данными.

### `test_export_text`

**Описание**: Тестирует экспорт данных в текстовом формате.

**Параметры**:
- `exporter` (`ArtifactExporter`): Экземпляр класса `ArtifactExporter`.

**Возвращает**: Нет.

**Вызывает исключения**:
- Нет.

**Действия**:
1. Определяет данные для экспорта.
2. Экспортирует данные в файл `test_artifact.txt` используя `content_type="text"` и `target_format="txt"`.
3. Проверяет, что файл `test_artifact.txt` успешно создан.
4. Считывает данные из файла и сравнивает их с исходными данными.

### `test_export_docx`

**Описание**: Тестирует экспорт данных в формате docx.

**Параметры**:
- `exporter` (`ArtifactExporter`): Экземпляр класса `ArtifactExporter`.

**Возвращает**: Нет.

**Вызывает исключения**:
- Нет.

**Действия**:
1. Определяет данные для экспорта в формате Markdown.
2. Экспортирует данные в файл `test_artifact.docx` используя `content_type="Document"`, `content_format="markdown"`, и `target_format="docx"`.
3. Проверяет, что файл `test_artifact.docx` успешно создан.
4. Считывает данные из файла docx и проверяет, что исходные данные (не в формате Markdown) присутствуют в выводе.
5. Проверяет, что теги Markdown не сохранены в выводе docx.

### `test_normalizer`

**Описание**: Тестирует нормализатор `Normalizer`.

**Параметры**:
- `concepts` (`list`): Список концептов для нормализации.
- `n` (`int`): Количество нормализованных элементов.
- `verbose` (`bool`): Флаг для включения подробных сообщений.

**Возвращает**: Нет.

**Вызывает исключения**:
- Нет.

**Действия**:
1. Определяет список концептов.
2. Создаёт экземпляр `Normalizer` с заданными параметрами.
3. Проверяет, что количество нормализованных элементов соответствует ожидаемому значению `n`.
4. Создает несколько случайных подвыборок исходных данных.
5. Для каждой подвыборки:
    - Нормализует подвыборку с помощью метода `normalize`.
    - Проверяет, что нормализованный список не `None`.
    - Проверяет, что длины нормализованного и исходного списков совпадают.
    - Проверяет, что все элементы из нормализованного списка присутствуют в словаре `normalizing_map` как ключи.
    - Проверяет, что размер кэша `normalizing_map` увеличивается после нормализации.

**Примечания:** Тест использует библиотеку `docx` для обработки файлов docx.  Необходимо установить её: `pip install python-docx`.  Также,  важно, что тест использует `logging`. Для его работы необходимо правильно настроить логирование в вашем проекте.
# Модуль для проверки валидности ответов от модели

## Обзор

Модуль предназначен для взаимодействия с AI-моделью Google Gemini, отправки запросов на разных языках (русский и иврит) и сохранения ответов в формате JSON. Используется для экспериментов с данными о товарах, полученными от различных поставщиков.

## Подробней

Этот модуль выполняет следующие задачи:

1.  Загружает необходимые инструкции и данные о продуктах.
2.  Инициализирует AI-модель Google Gemini с заданными параметрами.
3.  Формирует запросы на русском и иврите, объединяя инструкции с данными о продуктах.
4.  Отправляет запросы к модели и обрабатывает полученные ответы.
5.  Сохраняет ответы модели в формате JSON для дальнейшего анализа и использования.

Модуль является частью процесса экспериментов с AI-моделями для обработки и валидации данных о продуктах. Он помогает оценить качество ответов модели на разных языках и адаптировать инструкции для достижения наилучших результатов.

## Функции

### `model_ask`

```python
def model_ask(lang: str, attempts: int = 3) -> dict:
    """"""
```

**Описание**: Отправляет запрос к AI-модели на указанном языке и возвращает ответ в виде словаря.

**Как работает функция**:

1.  Использует глобальные переменные `model`, `q_ru`, `q_he` для доступа к модели и текстам запросов.
2.  Отправляет запрос к модели, используя метод `ask` класса `GoogleGenerativeAI`. Запрос формируется в зависимости от указанного языка (`q_ru` для русского и `q_he` для иврита).
3.  Обрабатывает ответ от модели:
    *   Если ответ пустой, логирует ошибку и возвращает пустой словарь.
    *   Пытается распарсить ответ как JSON. Если происходит ошибка парсинга, логирует ошибку и, если количество попыток `attempts` больше 1, рекурсивно вызывает саму себя с уменьшенным количеством попыток.
4.  Возвращает распарсенный ответ в виде словаря.

**Параметры**:

*   `lang` (str): Язык запроса (`'ru'` для русского, `'he'` для иврита).
*   `attempts` (int, optional): Количество попыток отправки запроса в случае ошибки парсинга ответа. По умолчанию `3`.

**Возвращает**:

*   `dict`: Ответ от модели в виде словаря. Возвращает пустой словарь `{}` в случае ошибки или отсутствия ответа.

**Примеры**:

```python
response_ru_dict = model_ask('ru')
response_he_dict = model_ask('he')
```
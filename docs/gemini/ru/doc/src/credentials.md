{
  "Improved Optimized Full Code": "# Модуль src.credentials\n\n## Обзор\n\nЭтот документ предоставляет обзор класса `ProgramSettings`.\n\n`ProgramSettings` загружает и хранит информацию об учетных данных (ключи API, пароли и т. д.) из файла базы данных KeePass `credentials.kdbx`. Он также включает функцию `set_project_root` для определения корневого каталога проекта.\n\n## Функции\n\n### `set_project_root`\n\n**Описание**: Находит корневой каталог проекта, начиная с текущего каталога. Поиск идет вверх по каталогам до тех пор, пока не будет найден каталог, содержащий один из файлов в списке `marker_files`.\n\n**Параметры**:\n\n- `marker_files` (tuple): Кортеж строк, представляющих имена файлов или каталогов, используемых для идентификации корневого каталога проекта. По умолчанию он ищет следующие маркеры: `pyproject.toml`, `requirements.txt`, `.git`.\n\n**Возвращает**:\n\n- `Path`: Путь к корневому каталогу проекта, если он найден, иначе путь к каталогу, в котором находится скрипт.\n\n### `singleton`\n\n**Описание**: Декоратор для создания класса-одиночки.\n\n**Параметры**:\n\n- `cls`: Класс, который должен быть преобразован в одиночку.\n\n**Возвращает**:\n\n- `function`: Функция, которая возвращает экземпляр класса-одиночки.\n\n## Классы\n\n### `ProgramSettings`\n\n**Описание**: Класс для настроек программы. Он устанавливает основные параметры и настройки проекта. Он загружает конфигурацию из `config.json` и данные учетных данных из файла базы данных KeePass `credentials.kdbx`.\n\n**Атрибуты**:\n\n- `host_name` (str): Имя хоста.\n- `base_dir` (Path): Путь к корневому каталогу проекта.\n- `config` (SimpleNamespace): Объект, содержащий конфигурацию проекта.\n- `credentials` (SimpleNamespace): Объект, содержащий учетные данные.\n- `MODE` (str): Режим работы проекта (например, 'dev', 'prod').\n- `path` (SimpleNamespace): Объект, содержащий пути к различным каталогам проекта.\n\n**Методы**:\n\n- `__init__(self, **kwargs)`: Инициализирует экземпляр класса.\n  - Загружает конфигурацию проекта из `config.json`.\n  - Инициализирует атрибут `path` путями к различным каталогам проекта.\n  - Вызывает `check_latest_release` для проверки наличия новой версии проекта.\n  - Загружает учетные данные из `credentials.kdbx`.\n- `_load_credentials(self) -> None`: Загружает учетные данные из KeePass.\n- `_open_kp(self, retry: int = 3) -> PyKeePass | None`: Открывает базу данных KeePass. Обрабатывает возможные исключения при открытии базы данных.\n- `_load_aliexpress_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Aliexpress из KeePass.\n- `_load_openai_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные OpenAI из KeePass.\n- `_load_gemini_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные GoogleAI из KeePass.\n- `_load_telegram_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Telegram из KeePass.\n- `_load_discord_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Discord из KeePass.\n- `_load_PrestaShop_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные PrestaShop из KeePass.\n- `_load_presta_translations_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные PrestaShop Translations из KeePass.\n- `_load_smtp_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные SMTP из KeePass.\n- `_load_facebook_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Facebook из KeePass.\n- `_load_gapi_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Google API из KeePass.\n- `now(self) -> str`: Возвращает текущую временную метку в формате, указанном в файле `config.json`.\n\n**Возможные исключения**:\n\n- `BinaryError`: Исключение для ошибок двоичных данных.\n- `CredentialsError`: Исключение для ошибок данных учетных данных.\n- `DefaultSettingsException`: Исключение для ошибок настроек по умолчанию.\n- `HeaderChecksumError`: Исключение для ошибок контрольной суммы заголовка.\n- `KeePassException`: Исключение для ошибок базы данных KeePass.\n- `PayloadChecksumError`: Исключение для ошибок контрольной суммы полезной нагрузки.\n- `UnableToSendToRecycleBin`: Исключение для ошибок отправки в корзину.\n- `Exception`: Общее исключение.\n\n## Заметки\n\n- Модуль использует PyKeePass для работы с файлом `credentials.kdbx`.\n- В коде присутствуют блоки обработки исключений (`ex`).\n- Файл паролей (`password.txt`) содержит пароли в открытом виде. Это потенциальная уязвимость. Необходимо разработать безопасный механизм хранения паролей.\n\n## Инициализация и конфигурация\n\nПри запуске проекта инициализируются и настраиваются различные параметры и учетные данные. В этом документе объясняется, как эти значения устанавливаются и управляются.\n\n### Определение корневого каталога проекта\n\nПроект автоматически определяет свой корневой каталог, выполняя поиск вверх от текущего каталога файла по определенным файлам-маркерам (`pyproject.toml`, `requirements.txt`, `.git`). Это гарантирует, что проект сможет найти свои ресурсы независимо от текущего рабочего каталога.\n\n```python\ndef set_project_root(marker_files: tuple = ('__root__', '.git')) -> Path:\n    \"\"\"\n    Находит корневой каталог проекта, начиная с текущего каталога файла,\n    выполняя поиск вверх и останавливаясь на первом каталоге, содержащем любой из файлов-маркеров.\n    \n    Args:\n        marker_files (tuple): Имена файлов или каталогов для идентификации корневого каталога проекта.\n    \n    Returns:\n        Path: Путь к корневому каталогу, если он найден, иначе каталог, в котором находится скрипт.\n    \"\"\"\n    __root__: Path\n    current_path: Path = Path(__file__).resolve().parent\n    __root__ = current_path\n    for parent in [current_path] + list(current_path.parents):\n        if any((parent / marker).exists() for marker in marker_files):\n            __root__ = parent\n            break\n    if __root__ not in sys.path:\n        sys.path.insert(0, str(__root__))\n    return __root__\n```\n\n### Загрузка конфигурации\n\nПроект загружает свои настройки по умолчанию из файла `config.json`, расположенного в каталоге `src`. Этот JSON-файл содержит различные параметры конфигурации, такие как:\n\n- **Информация об авторе**: Подробности об авторе.\n- **Доступные режимы**: Поддерживаемые режимы (`dev`, `debug`, `test`, `prod`).\n- **Пути**: Каталоги для журналов, временных файлов, внешнего хранилища и Google Drive.\n- **Детали проекта**: Название, версия и информация о выпуске проекта.\n\n```python\nself.config = j_loads_ns(self.base_dir / 'src' / 'config.json')\nif not self.config:\n    logger.error('Error loading settings')\n    ...\n    return\n\nself.config.project_name = self.base_dir.name\n```\n\n### Управление учетными данными с помощью KeePass\n\n**Что такое KeePass?**\n\nKeePass - это бесплатный менеджер паролей с открытым исходным кодом, который надежно хранит ваши пароли и другую конфиденциальную информацию в зашифрованной базе данных. База данных защищена главным паролем, который является единственным паролем, который вам нужно запомнить. KeePass использует надежные алгоритмы шифрования (такие как AES и Twofish) для обеспечения безопасности ваших данных.\n\n**Почему KeePass хорош?**\n\n- **Безопасность**: KeePass использует стандартное шифрование для защиты ваших данных, что делает его очень безопасным от несанкционированного доступа.\n- **Портативность**: Вы можете хранить свою базу данных KeePass на USB-накопителе или в облачном хранилище и получать к ней доступ с нескольких устройств.\n- **Настройка**: KeePass позволяет организовать ваши пароли в группы и подгруппы, что упрощает управление большим количеством учетных данных.\n- **Открытый исходный код**: Будучи проектом с открытым исходным кодом, KeePass прозрачен и может быть проверен сообществом на предмет безопасности.\n\n**Как KeePass работает в этом проекте**\n\nУчетные данные надежно управляются с помощью базы данных KeePass (`credentials.kdbx`). Главный пароль для этой базы данных обрабатывается по-разному в зависимости от среды:\n\n- **Режим разработки**: Пароль считывается из файла с именем `password.txt`, расположенного в каталоге `secrets`.\n- **Производственный режим**: Пароль вводится через консоль. (Удалите файл `password.txt` из каталога `secrets`)\n\n```python\ndef _open_kp(self, retry: int = 3) -> PyKeePass | None:\n    \"\"\" Открывает базу данных KeePass\n    Args:\n        retry (int): Количество повторных попыток\n    \"\"\"\n    while retry > 0:\n        try:\n            password: str = Path(self.path.secrets / 'password.txt').read_text(encoding='utf-8') or None\n            kp = PyKeePass(str(self.path.secrets / 'credentials.kdbx'),\n                           password = password or getpass.getpass(print('Введите главный пароль KeePass: ').lower()))\n            return kp\n        except Exception as ex:\n            print(f'Не удалось открыть базу данных KeePass. Исключение: {ex}, {retry-1} осталось попыток.')\n            ...\n            retry -= 1\n            if retry < 1:\n                logger.critical('Не удалось открыть базу данных KeePass после нескольких попыток', exc_info=True)\n                ...\n                sys.exit()\n```\n\n### Структура дерева базы данных KeePass\n\n```\ncredentials.kdbx\n├── поставщики\n│   └── aliexpress\n│       └── api\n│           └── запись (Учетные данные API Aliexpress)\n├── openai\n│   ├── запись (Ключи API OpenAI)\n│   └── assistants\n│       └── запись (Идентификаторы помощников OpenAI)\n├── gemini\n│   └── запись (Учетные данные GoogleAI)\n├── telegram\n│   └── запись (Учетные данные Telegram)\n├── discord\n│   └── запись (Учетные данные Discord)\n├── prestashop\n│   ├── запись (Учетные данные PrestaShop)\n│   └── clients\n│       └── запись (Учетные данные клиента PrestaShop)\n│   └── translation\n│       └── запись (Учетные данные перевода PrestaShop)\n├── smtp\n│   └── запись (Учетные данные SMTP)\n├── facebook\n│   └── запись (Учетные данные Facebook)\n└── google\n    └── gapi\n        └── запись (Учетные данные Google API)\n```\n\n### Подробное описание структуры:\n\n1. **suppliers/aliexpress/api**:\n   - Содержит учетные данные API Aliexpress.\n   - Пример записи: `self.credentials.aliexpress.api_key`, `self.credentials.aliexpress.secret`, `self.credentials.aliexpress.tracking_id`, `self.credentials.aliexpress.email`, `self.credentials.aliexpress.password`.\n\n2. **openai**:\n   - Содержит ключи API OpenAI.\n   - Пример записи: `self.credentials.openai.api_key`.\n\n3. **openai/assistants**:\n   - Содержит идентификаторы помощников OpenAI.\n   - Пример записи: `self.credentials.openai.assistant_id`.\n\n4. **gemini**:\n   - Содержит учетные данные GoogleAI.\n   - Пример записи: `self.credentials.gemini.api_key`.\n\n5. **telegram**:\n   - Содержит учетные данные Telegram.\n   - Пример записи: `self.credentials.telegram.token`.\n\n6. **discord**:\n   - Содержит учетные данные Discord.\n   - Пример записи: `self.credentials.discord.application_id`, `self.credentials.discord.public_key`, `self.credentials.discord.bot_token`.\n\n7. **prestashop**:\n   - Содержит учетные данные PrestaShop.\n   - Пример записи: `self.credentials.presta.client.api_key`, `self.credentials.presta.client.api_domain`, `self.credentials.presta.client.db_server`, `self.credentials.presta.client.db_user`, `self.credentials.presta.client.db_password`.\n\n8. **prestashop/clients**:\n   - Содержит учетные данные клиента PrestaShop.\n   - Пример записи: `self.credentials.presta.client.api_key`, `self.credentials.presta.client.api_domain`, `self.credentials.presta.client.db_server`, `self.credentials.presta.client.db_user`, `self.credentials.presta.client.db_password`.\n\n9. **prestashop/translation**:\n   - Содержит учетные данные перевода PrestaShop.\n   - Пример записи: `self.credentials.presta.translations.server`, `self.credentials.presta.translations.port`, `self.credentials.presta.translations.database`, `self.credentials.presta.translations.user`, `self.credentials.presta.translations.password`.\n\n10. **smtp**:\n    - Содержит учетные данные SMTP.\n    - Пример записи: `self.credentials.smtp.server`, `self.credentials.smtp.port`, `self.credentials.smtp.user`, `self.credentials.smtp.password`.\n\n11. **facebook**:\n    - Содержит учетные данные Facebook.\n    - Пример записи: `self.credentials.facebook.app_id`, `self.credentials.facebook.app_secret`, `self.credentials.facebook.access_token`.\n\n12. **google/gapi**:\n    - Содержит учетные данные Google API.\n    - Пример записи: `self.credentials.gapi.api_key`.\n\n### Примечания:\n- Каждая группа (`group`) в KeePass соответствует определенному пути (`path`).\n- Каждая запись (`entry`) в группе содержит определенные учетные данные.\n- Методы `_load_*_credentials` загружают данные из соответствующих групп и записей в базе данных KeePass и сохраняют их в атрибутах объекта `self.credentials`.\n\n### Глобальный экземпляр `ProgramSettings`\n\n```python\n# Глобальный экземпляр ProgramSettings\ngs: ProgramSettings = ProgramSettings()\n```\n\n**Зачем это нужно?**\n\nЭтот глобальный экземпляр `ProgramSettings` (`gs`) создан для обеспечения доступа к настройкам и учетным данным проекта из любой точки кода. Таким образом, вам не нужно создавать новый экземпляр класса `ProgramSettings` каждый раз, когда вам нужно получить доступ к настройкам или учетным данным.\n\n**Как это используется?**\n\nВ других модулях проекта вы можете импортировать этот глобальный экземпляр и использовать его для доступа к настройкам и учетным данным:\n\n```python\nfrom src import gs\n\n# Пример использования\napi_key = gs.credentials.openai.api_key\n```\n\nЭто упрощает доступ к настройкам и учетным данным, делая код более чистым и удобным в использовании.\n",
  "Changes": "No changes were made as the file is already a markdown file."
}
## mdast-util-to-hast - Руководство пользователя

[![Build][build-badge]][build]
[![Coverage][coverage-badge]][coverage]
[![Downloads][downloads-badge]][downloads]
[![Size][size-badge]][size]
[![Sponsors][sponsors-badge]][collective]
[![Backers][backers-badge]][collective]
[![Chat][chat-badge]][chat]

Утилита `mdast-util-to-hast` преобразует синтаксическое дерево [mdast](https://github.com/syntax-tree/mdast) (разметки Markdown) в синтаксическое дерево [hast](https://github.com/syntax-tree/hast) (HTML).

## Когда использовать эту утилиту?

Эта утилита полезна, когда вы работаете с абстрактными синтаксическими деревьями (AST) и хотите преобразовать Markdown в HTML.

Утилита `hast-util-to-mdast` выполняет обратное преобразование — из HTML в Markdown.

Плагин `remark-rehype` использует эту утилиту для преобразования Markdown в HTML на более высоком уровне абстракции (более простом).

## Установка

Этот пакет поддерживает только ESM.
В Node.js (версия 16+) установите с помощью npm:

```bash
npm install mdast-util-to-hast
```

В Deno с `esm.sh`:

```javascript
import {toHast} from 'https://esm.sh/mdast-util-to-hast@13';
```

В браузере с `esm.sh`:

```html
<script type="module">
  import {toHast} from 'https://esm.sh/mdast-util-to-hast@13?bundle';
</script>
```

## Использование

Предположим, у вас есть файл `example.md`:

```markdown
## Hello **World**!
```

и модуль `example.js`:

```javascript
import { readFile } from 'node:fs/promises';
import { toHtml } from 'hast-util-to-html';
import { fromMarkdown } from 'mdast-util-from-markdown';
import { toHast } from 'mdast-util-to-hast';

const markdown = await readFile('example.md', 'utf-8');
const mdast = fromMarkdown(markdown);
const hast = toHast(mdast);
const html = toHtml(hast);

console.log(html);
```

Запуск `node example.js` выведет:

```html
<h2>Hello <strong>World</strong>!</h2>
```

## API

Этот пакет экспортирует идентификаторы `defaultFootnoteBackContent`, `defaultFootnoteBackLabel`, `defaultHandlers` и `toHast`.  Нет стандартного экспорта.

### `toHast(tree[, options])`

Преобразует mdast в hast.

**Параметры:**

*   `tree` ([`MdastNode`](https://github.com/syntax-tree/mdast#nodes)) — синтаксическое дерево mdast.
*   `options` ([`Options`](Описание ниже), необязательно) — конфигурация.

**Возвращаемое значение:**

hast синтаксическое дерево ([`HastNode`](https://github.com/syntax-tree/hast#nodes)).


**Примечания:**

*   **HTML:** Необработанный HTML в mdast представлен как узлы `html` и может быть вставлен в hast как узлы `raw`. Большинство утилит игнорируют `raw` узлы, но две заметные утилиты нет:
    *   `hast-util-to-html` также имеет опцию `allowDangerousHtml`, которая выведет необработанный HTML. Это обычно не рекомендуется, но полезно, если вы полностью доверяете авторам.
    *   `hast-util-raw` может обрабатывать строки необработанного вставленного HTML, анализируя их в стандартные узлы hast (`element`, `text` и т.д.). Это трудоёмкая задача, так как требуется полный HTML-парсер, но это единственный способ поддерживать недоверенный контент.
*   **Сноски:** Многие опции здесь относятся к сноскам. Сноски не определены CommonMark, по умолчанию мы следуем этому стандарту. GitHub поддерживает их, поэтому сноски можно включить в Markdown с помощью `mdast-util-gfm`. Опции `footnoteBackLabel` и `footnoteLabel` определяют естественный язык, объясняющий сноски, который скрыт для пользователей с нормальным зрением, но отображается для вспомогательных технологий. Если ваша страница не на английском языке, вы должны определить переведённые значения. Обратные ссылки используют атрибуты ARIA, но сам раздел с метками использует заголовок, скрытый классом `sr-only`. Чтобы отобразить его для пользователей с нормальным зрением, определите разные атрибуты в `footnoteLabelProperties`.
*   **Перезапись данных:** Сноски представляют проблему, так как они связывают вызовы сносок с определениями сносок на странице с помощью атрибутов `id`, сгенерированных из пользовательского контента, что приводит к перезаписи DOM.  Использование префикса решает эту проблему.  Более подробная информация о том, как обращаться с перезаписью и префиксом, приведена в [примере заголовков (перезапись DOM) в `rehype-sanitize`][clobber-example].
*   **Неизвестные узлы:** Неизвестные узлы — это узлы с типом, который не находится в `handlers` или `passThrough`.  Поведение по умолчанию для неизвестных узлов:
    *   если узел имеет `value` (и не имеет `data.hName`, `data.hProperties` или `data.hChildren`), создается узел `text` hast.
    *   в противном случае создаётся элемент `<div>` (который можно изменить с помощью `data.hName`), и его дочерние элементы также преобразуются из mdast в hast. Это поведение можно изменить, передав `unknownHandler`.

### Опции (`Options`)

**Поля:**

*   `allowDangerousHtml` (boolean, по умолчанию `false`) — разрешить необработанный HTML в Markdown в дереве hast.
*   `clobberPrefix` (строка, по умолчанию `'user-content-'`) — префикс, используемый перед свойством `id` в сносках для предотвращения их перезаписи.
*   `file` ([`VFile`](https://github.com/vfile/vfile), необязательно) — виртуальный файл, соответствующий входному документу.
*   `footnoteBackContent` (функция или строка, по умолчанию `defaultFootnoteBackContent`) — контент обратной ссылки на сноски.
*   `footnoteBackLabel` (функция или строка, по умолчанию `defaultFootnoteBackLabel`) — метка обратной ссылки на сноски.
*   `footnoteLabel` (строка, по умолчанию `'Footnotes'`) — метка для раздела сносок (влияет на дикторы экрана).
*   `footnoteLabelProperties` (объект, по умолчанию `{className: ['sr-only']}`) — свойства, используемые для метки сноски.
*   `footnoteLabelTagName` (строка, по умолчанию `h2`) — имя тега для метки сноски.
*   `handlers` (объект, необязательно) — дополнительные обработчики узлов.
*   `passThrough` (массив, необязательно) — список типов узлов mdast, которые нужно пропускать в hast (узел пропускается, но дочерние элементы преобразуются).
*   `unknownHandler` (функция, необязательно) — обработчик для всех неизвестных узлов.


## Примеры

(Полные примеры кода представлены в оригинальном README.md)

*   **Поддержка HTML в Markdown (небезопасно):** Если вы полностью доверяете авторам Markdown, этот пример показывает как использовать `allowDangerousHtml`.
*   **Поддержка HTML в Markdown (безопасно):** Для более надежного подхода к поддержке вложенного HTML, используйте `hast-util-raw` и `hast-util-sanitize` для очистки необработанного HTML.
*   **Сноски на других языках:** Как перевести метки сносок на другой язык.


## Алгоритм

(Подробное описание алгоритма обработки представлено в оригинальном README.md)

## Совместимость

Пакет совместим с поддерживаемыми версиями Node.js.

## Безопасность

Использование `mdast-util-to-hast` может подвергнуть вас риску [атаки XSS (межсайтового скриптинга)](https://en.wikipedia.org/wiki/Cross-site_scripting). Обратите внимание на опцию `allowDangerousHtml` и используйте `hast-util-sanitize`, чтобы очистить потенциально небезопасный контент.

## Связанные проекты

*   [`hast-util-to-mdast`](https://github.com/syntax-tree/hast-util-to-mdast) — преобразование hast в mdast.
*   [`hast-util-sanitize`](https://github.com/syntax-tree/hast-util-sanitize) — очистка hast узлов от потенциально опасного контента.
*   [`remark-rehype`](https://github.com/remarkjs/remark-rehype) —  плагин, который использует `mdast-util-to-hast` для преобразования Markdown в HTML.


## Вклад

(Ссылка на `contributing.md` в оригинальном README.md)


[build-badge]: https://github.com/syntax-tree/mdast-util-to-hast/workflows/main/badge.svg
[build]: https://github.com/syntax-tree/mdast-util-to-hast/actions
[coverage-badge]: https://img.shields.io/codecov/c/github/syntax-tree/mdast-util-to-hast.svg
[coverage]: https://codecov.io/github/syntax-tree/mdast-util-to-hast
[downloads-badge]: https://img.shields.io/npm/dm/mdast-util-to-hast.svg
[downloads]: https://www.npmjs.com/package/mdast-util-to-hast
[size-badge]: https://img.shields.io/badge/dynamic/json?label=minzipped%20size&query=$.size.compressedSize&url=https://deno.bundlejs.com/?q=mdast-util-to-hast
[size]: https://bundlejs.com/?q=mdast-util-to-hast
[sponsors-badge]: https://opencollective.com/unified/sponsors/badge.svg
[backers-badge]: https://opencollective.com/unified/backers/badge.svg
[collective]: https://opencollective.com/unified
[chat-badge]: https://img.shields.io/badge/chat-discussions-success.svg
[chat]: https://github.com/syntax-tree/unist/discussions
[clobber-example]: https://github.com/rehypejs/rehype-sanitize#example-headings-dom-clobbering

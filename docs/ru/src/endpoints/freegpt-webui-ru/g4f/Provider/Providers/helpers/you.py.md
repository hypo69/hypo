# Модуль для взаимодействия с API you.com

## Обзор

Модуль предназначен для обмена сообщениями с API you.com с целью получения ответов на запросы. Он включает в себя функции преобразования формата сообщений и отправки запросов к API с использованием библиотеки `curl_cffi`.

## Подробней

Этот модуль используется для интеграции с сервисом you.com. Он принимает список сообщений, преобразует их в нужный формат, отправляет запрос к API и выводит полученные ответы. Модуль обрабатывает ошибки соединения и автоматически перезапускает процесс при возникновении исключений.

## Функции

### `transform`

```python
def transform(messages: list) -> list:
    """Преобразует список сообщений в формат, ожидаемый API you.com.

    Args:
        messages (list): Список сообщений, где каждое сообщение представляет собой словарь с ключами 'role' и 'content'.

    Returns:
        list: Список преобразованных сообщений в формате, подходящем для отправки в API you.com.

    Как работает функция:
    ----------------------
    Функция итерируется по списку сообщений и преобразует их в формат, необходимый для API you.com.
    Сообщения пользователя и ассистента объединяются в пары вопрос-ответ. Системные сообщения добавляются как отдельные вопросы.

    ASCII flowchart:
    ----------------
    Начало --> Проверка роли сообщения
              |
              --- "user" --> Извлечение вопроса --> Проверка наличия ответа --> Формирование пары вопрос-ответ
              |                                    |
              |                                    --- Нет ответа --> Формирование вопроса без ответа
              |
              --- "assistant" --> Формирование ответа без вопроса
              |
              --- "system" --> Формирование вопроса без ответа
              |
              Конец

    Примеры:
    ---------
    >>> transform([{'role': 'user', 'content': 'Привет'}, {'role': 'assistant', 'content': 'Здравствуйте'}])
    [{'question': 'Привет', 'answer': 'Здравствуйте'}]

    >>> transform([{'role': 'user', 'content': 'Как дела?'}, {'role': 'system', 'content': 'Информация о системе'}])
    [{'question': 'Как дела?', 'answer': ''}, {'question': 'Информация о системе', 'answer': ''}]

    >>> transform([{'role': 'assistant', 'content': 'Я помошник'}])
    [{'question': '', 'answer': 'Я помошник'}]
    """
    ...
```

### `output`

```python
def output(chunk):
    """Обрабатывает и выводит полученные от API чанки данных.

    Args:
        chunk: Чанк данных, полученный от API.

    Как работает функция:
    ----------------------
    Функция проверяет наличие токена 'youChatToken' в чанке данных. Если токен присутствует,
    она извлекает JSON из чанка, декодирует его и выводит значение 'youChatToken' в stdout.

    ASCII flowchart:
    ----------------
    Начало --> Проверка наличия "youChatToken" в чанке
              |
              --- Есть "youChatToken" --> Извлечение JSON --> Декодирование --> Вывод "youChatToken"
              |
              Конец

    Примеры:
    ---------
    Предположим, chunk содержит: b'data: {"youChatToken": "some_token"}'
    output(b'data: {"youChatToken": "some_token"}')  # Выведет "some_token"
    """
    ...
```

## Переменные

-   `config`: Словарь, содержащий конфигурационные параметры, полученные из аргументов командной строки.
-   `messages`: Список сообщений для отправки в API, извлеченный из `config`.
-   `prompt`: Последнее сообщение пользователя, используемое в качестве запроса.
-   `headers`: Словарь, содержащий заголовки HTTP-запроса.
-   `params`: Строка, содержащая параметры запроса, закодированные в формате URL.
-   `response`: Ответ от API.

## Как работает программа:

1.  **Чтение конфигурации**: Программа читает JSON-конфигурацию из аргументов командной строки.
2.  **Преобразование сообщений**: Список сообщений преобразуется в формат, ожидаемый API you.com, с использованием функции `transform`.
3.  **Формирование параметров запроса**: Формируются параметры запроса, включающие запрос пользователя и преобразованный список сообщений.
4.  **Отправка запроса и обработка ответа**: Программа отправляет GET-запрос к API you.com с заданными параметрами и заголовками. Функция `output` используется для обработки и вывода чанков данных, полученных от API.
5.  **Обработка ошибок**: Если при отправке запроса возникает ошибка, программа перехватывает исключение, выводит сообщение об ошибке и повторяет попытку.
# Модуль `ImageLabs`

## Обзор

Модуль `ImageLabs` предоставляет функциональность для генерации изображений с использованием API `editor.imagelabs.net`. Он включает в себя класс `ImageLabs`, который является асинхронным генератором, взаимодействующим с сервисом ImageLabs для создания изображений на основе текстовых запросов. Модуль поддерживает настройку модели, размеров изображения, негативных запросов и прокси.

## Подробней

Этот модуль позволяет интегрировать функциональность генерации изображений в другие части проекта `hypotez`. Он использует асинхронные запросы для взаимодействия с API ImageLabs, что позволяет эффективно обрабатывать запросы без блокировки основного потока выполнения.
Асинхронный подход особенно важен для приложений, требующих высокой отзывчивости и параллельной обработки задач.

## Классы

### `ImageLabs`

**Описание**: Класс `ImageLabs` является поставщиком изображений, использующим API `editor.imagelabs.net` для генерации изображений на основе текстовых запросов.
Он наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями.

**Атрибуты**:
- `url` (str): URL сервиса ImageLabs (`https://editor.imagelabs.net`).
- `api_endpoint` (str): URL API для генерации изображений (`https://editor.imagelabs.net/txt2img`).
- `working` (bool): Указывает, что провайдер работает (True).
- `supports_stream` (bool): Указывает, что потоковая передача не поддерживается (False).
- `supports_system_message` (bool): Указывает, что системные сообщения не поддерживаются (False).
- `supports_message_history` (bool): Указывает, что история сообщений не поддерживается (False).
- `default_model` (str): Модель, используемая по умолчанию (`sdxl-turbo`).
- `default_image_model` (str): Модель изображения, используемая по умолчанию (`sdxl-turbo`).
- `image_models` (List[str]): Список поддерживаемых моделей изображений (`[default_image_model]`).
- `models` (List[str]): Список поддерживаемых моделей, идентичный `image_models`.

#### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    prompt: str = None,
    negative_prompt: str = "",
    width: int = 1152,
    height: int = 896,
    **kwargs
) -> AsyncResult:
    """Асинхронно генерирует изображения на основе текстового запроса.

    Args:
        model (str): Название используемой модели.
        messages (Messages): Список сообщений для генерации изображения.
        proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
        prompt (str, optional): Текстовый запрос для генерации изображения. По умолчанию `None`.
        negative_prompt (str, optional): Негативный запрос, указывающий, чего следует избегать на изображении. По умолчанию "".
        width (int, optional): Ширина изображения. По умолчанию 1152.
        height (int, optional): Высота изображения. По умолчанию 896.
        **kwargs: Дополнительные параметры.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий изображения в формате `ImageResponse`.

    Raises:
        Exception: Если происходит ошибка при генерации изображения.

    Как работает функция:
    1. Функция устанавливает заголовки для HTTP-запросов, включая User-Agent, типы содержимого и параметры кэширования.
    2. Извлекает текстовый запрос из последнего сообщения, если `prompt` не указан явно.
    3. Формирует полезную нагрузку (payload) для запроса к API ImageLabs, включая текстовый запрос, seed для случайной генерации, размеры изображения и негативный запрос.
    4. Отправляет асинхронный POST-запрос к API ImageLabs для генерации изображения.
    5. Запускает цикл опроса API для получения статуса выполнения задачи генерации изображения.
    6. В цикле проверяет статус задачи и возвращает изображение в формате `ImageResponse` после завершения генерации.

    Внутренние функции:
        Внутри данной функции нет внутренних функций.

    Схема работы функции:

    Установка заголовков и определение параметров
    │
    └───►  Извлечение текстового запроса (prompt)
    │
    └───►  Формирование запроса (payload)
    │
    └───►  Отправка POST-запроса на генерацию изображения
    │
    └───►  Цикл опроса статуса задачи
    │
    └───►  Проверка статуса задачи ("Done" или наличие URL изображения)
    │       │
    │       └───►  Возврат изображения в формате ImageResponse
    │
    └───►  Проверка на наличие ошибок
    │       │
    │       └───►  Выброс исключения в случае ошибки
    │
    └───►  Ожидание между опросами
    """
```

#### `get_model`

```python
@classmethod
def get_model(cls, model: str) -> str:
    """Возвращает модель по умолчанию.

    Args:
        model (str): Название модели.

    Returns:
        str: Модель по умолчанию (`cls.default_model`).
    """
```

## Функции

В данном модуле функции отсутствуют.
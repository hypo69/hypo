# Модуль для поиска фильмов на Kinopoisk через Google

## Обзор

Модуль предоставляет функцию `search_query`, которая выполняет поиск фильмов или сериалов на сайте Kinopoisk через поисковую систему Google. Он использует библиотеку `requests` для выполнения HTTP-запросов, `BeautifulSoup` для парсинга HTML-ответа и модуль `useragent` для получения случайного User-Agent.

## Подробней

Этот модуль предназначен для поиска информации о фильмах и сериалах на Kinopoisk. Он использует поисковый запрос Google для получения релевантных результатов и извлекает необходимую информацию, такую как ссылка, заголовок и описание. Модуль может быть использован в различных приложениях, где требуется автоматический поиск информации о фильмах, например, в Telegram-ботах.

## Функции

### `search_query`

```python
def search_query(query: str, type_movie: str = 'series') -> dict | None:
    """
    Выполняет поиск фильма или сериала на Kinopoisk через поисковую систему Google.

    Args:
        query (str): Поисковый запрос.
        type_movie (str): Тип искомого контента ('series' для сериалов, 'film' для фильмов). По умолчанию 'series'.

    Returns:
        dict | None: Словарь с информацией о фильме (ссылка, заголовок, описание) или None, если ничего не найдено.

    Raises:
        requests.exceptions.RequestException: Если возникает ошибка при выполнении HTTP-запроса.
        bs4.exceptions.BeautifulSoup: Если возникает ошибка при парсинге HTML-ответа.

    Example:
        >>> search_query('теория большого взрыва')
        {'link': 'https://w2.kpfr.wiki/series/2047/', 'title': 'Теория большого взрыва (сериал, 2007–2019) — описание ...', 'description': 'Сериал рассказывает о гениальных физиках, которые умеют рассчитывать вероятность ...'}
    """
```

**Как работает функция**:

1.  Формируется поисковый запрос `term` для Google, включающий указанный `query` и тип контента (`type_movie`).
2.  Выполняется GET-запрос к Google с использованием библиотеки `requests`. В заголовках запроса передается случайный User-Agent для имитации запроса от браузера. Также указывается параметр `hl` для получения результатов на русском языке.
3.  Полученный HTML-ответ парсится с использованием библиотеки `BeautifulSoup`.
4.  Из HTML-кода извлекаются блоки с результатами поиска (элементы `div` с классом `g`).
5.  Перебираются найденные блоки результатов. Для каждого блока извлекаются ссылка (`a`), заголовок (`h3`) и описание (`div` с атрибутом `style="-webkit-line-clamp:2"`).
6.  Проверяется наличие ссылки, заголовка и описания. Если они присутствуют, проверяется, что предпоследний элемент ссылки является числом (ID фильма/сериала на Kinopoisk).
7.  Если все условия выполнены, формируется словарь с информацией о фильме/сериале, включающий ссылку на `w2.kpfr.wiki`, заголовок и описание. Описание обрезается до `[:-4]` символов и добавляется "...".
8.  Если ничего не найдено, возвращается `None`.

**Внутри функции происходят следующие действия и преобразования**:

A.  **Формирование поискового запроса**: Формируется поисковый запрос для Google, включающий указанный `query` и тип контента (`type_movie`).
    |
    -- B. **Выполнение HTTP-запроса**: Выполняется GET-запрос к Google с использованием библиотеки `requests`.
    |
    C.  **Парсинг HTML-ответа**: Полученный HTML-ответ парсится с использованием библиотеки `BeautifulSoup`.
    |
    D - E. **Извлечение данных**: Из HTML-кода извлекаются блоки с результатами поиска, а затем извлекаются ссылка, заголовок и описание для каждого результата.
    |
    F.  **Формирование результата**: Формируется словарь с информацией о фильме/сериале, включающий ссылку, заголовок и описание.

**Примеры**:

```python
search_query('теория большого взрыва')
#  Возвращает: {'link': 'https://w2.kpfr.wiki/series/2047/', 'title': 'Теория большого взрыва (сериал, 2007–2019) — описание ...', 'description': 'Сериал рассказывает о гениальных физиках, которые умеют рассчитывать вероятность ...'}

search_query('Интерстеллар', type_movie='film')
# Возвращает: {'link': 'https://w2.kpfr.wiki/film/258691/', 'title': 'Интерстеллар (2014) — описание фильма — Кинопоиск', 'description': 'Когда засуха, пыльные бури и вымирание растений приводят человечество к ...'}

search_query('Нонна Гришаева')
# Возвращает: None
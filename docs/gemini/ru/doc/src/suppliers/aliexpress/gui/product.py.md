# Модуль для редактирования товаров AliExpress

## Обзор

Модуль `product.py` предоставляет графический интерфейс для редактирования информации о товарах AliExpress. Он позволяет загружать JSON-файлы с данными о товарах, отображать основную информацию и подготавливать товары к публикации.

## Подробнее

Этот модуль является частью GUI (`Graphical User Interface`) приложения для работы с AliExpress. Он использует библиотеку `PyQt6` для создания окон и элементов управления. Модуль позволяет открывать JSON-файлы с информацией о товарах, отображать такую информацию, как заголовок и детали товара, а также подготавливать товар с помощью `AliCampaignEditor`.

## Классы

### `ProductEditor`

**Описание**: Класс `ProductEditor` представляет собой виджет (окно) для редактирования информации о товаре.

**Наследует**:
- `QtWidgets.QWidget`

**Атрибуты**:
- `data` (SimpleNamespace): Объект, содержащий данные о товаре, загруженные из JSON-файла. Изначально `None`.
- `language` (str): Язык, используемый в редакторе. По умолчанию `'EN'`.
- `currency` (str): Валюта, используемая в редакторе. По умолчанию `'USD'`.
- `file_path` (str): Путь к загруженному JSON-файлу. Изначально `None`.
- `editor` (AliCampaignEditor): Экземпляр класса `AliCampaignEditor` для подготовки товара.
- `main_app`: Ссылка на экземпляр главного приложения.

**Методы**:
- `__init__(self, parent=None, main_app=None)`: Инициализирует виджет `ProductEditor`, настраивает пользовательский интерфейс и устанавливает связи между сигналами и слотами.
- `setup_ui(self)`: Создает и настраивает элементы пользовательского интерфейса, такие как кнопки, метки и макеты.
- `setup_connections(self)`: Устанавливает связи между сигналами и слотами для обработки событий пользовательского интерфейса.
- `open_file(self)`: Открывает диалоговое окно выбора файла для загрузки JSON-файла с данными о товаре.
- `load_file(self, file_path)`: Загружает JSON-файл по указанному пути и отображает информацию о товаре в редакторе.
- `create_widgets(self, data)`: Создает виджеты на основе данных, загруженных из JSON-файла.
- `prepare_product_async(self)`: Асинхронно подготавливает товар к публикации, используя `AliCampaignEditor`.

#### `__init__(self, parent=None, main_app=None)`

```python
    def __init__(self, parent=None, main_app=None):
        """ Initialize the ProductEditor widget """
```

**Назначение**: Инициализирует виджет `ProductEditor`.

**Параметры**:
- `parent` (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию `None`.
- `main_app`: Ссылка на экземпляр главного приложения.

**Как работает функция**:
1. Вызывает конструктор родительского класса (`QtWidgets.QWidget`).
2. Сохраняет ссылку на экземпляр главного приложения.
3. Вызывает методы `setup_ui()` и `setup_connections()` для настройки интерфейса и связей.

#### `setup_ui(self)`

```python
    def setup_ui(self):
        """ Setup the user interface """
```

**Назначение**: Настраивает пользовательский интерфейс виджета.

**Как работает функция**:
1. Устанавливает заголовок окна.
2. Изменяет размер окна.
3. Создает кнопки "Open JSON File" и "Prepare Product", а также метку "No file selected".
4. Устанавливает обработчики событий для кнопок.
5. Добавляет виджеты в вертикальный макет.

```
Настройка UI
│
├─── Создание кнопок ("Open JSON File", "Prepare Product") и лейбла ("No file selected")
│   │
│   └─── Установка обработчиков событий для кнопок (self.open_file, self.prepare_product_async)
│
└─── Добавление виджетов в вертикальный макет
```

#### `setup_connections(self)`

```python
    def setup_connections(self):
        """ Setup signal-slot connections """
```

**Назначение**: Устанавливает связи между сигналами и слотами.

**Как работает функция**:
Функция пока пустая и не выполняет никаких действий.

#### `open_file(self)`

```python
    def open_file(self):
        """ Open a file dialog to select and load a JSON file """
```

**Назначение**: Открывает диалоговое окно для выбора JSON-файла.

**Как работает функция**:
1. Открывает диалоговое окно с помощью `QFileDialog.getOpenFileName()`.
2. Если файл не выбран, функция завершается.
3. Если файл выбран, вызывается метод `load_file()` для загрузки файла.

```
Открытие файла
│
├─── Открытие диалогового окна выбора файла
│   │
│   └─── Если файл не выбран:
│       │   └─── Завершение функции
│   │
│   └─── Если файл выбран:
│       │   └─── Вызов load_file(file_path)
│
└─── Загрузка файла (load_file)
```

#### `load_file(self, file_path)`

```python
    def load_file(self, file_path):
        """ Load a JSON file """
```

**Назначение**: Загружает JSON-файл и отображает данные.

**Параметры**:
- `file_path` (str): Путь к JSON-файлу.

**Как работает функция**:
1. Пытается загрузить JSON-файл с помощью `j_loads_ns()`.
2. Сохраняет путь к файлу.
3. Обновляет текст метки с именем файла.
4. Создает экземпляр `AliCampaignEditor`.
5. Вызывает метод `create_widgets()` для создания виджетов на основе данных.
6. В случае ошибки отображает сообщение об ошибке.

```
Загрузка файла
│
├─── Попытка загрузки JSON-файла (j_loads_ns)
│   │
│   ├─── Сохранение пути к файлу
│   │
│   ├─── Обновление текста метки с именем файла
│   │
│   ├─── Создание экземпляра AliCampaignEditor
│   │
│   └─── Вызов create_widgets(data)
│
└─── Обработка ошибок
    │
    └─── Отображение сообщения об ошибке
```

#### `create_widgets(self, data)`

```python
    def create_widgets(self, data):
        """ Create widgets based on the data loaded from the JSON file """
```

**Назначение**: Создает виджеты для отображения данных о товаре.

**Параметры**:
- `data` (SimpleNamespace): Объект, содержащий данные о товаре.

**Как работает функция**:
1. Получает макет текущего виджета.
2. Удаляет все предыдущие виджеты, кроме кнопок "Open JSON File", "Prepare Product" и метки с именем файла.
3. Создает метку с заголовком товара и добавляет её в макет.
4. Создает метку с деталями товара и добавляет её в макет.

```
Создание виджетов
│
├─── Получение макета текущего виджета
│   │
│   └─── Удаление предыдущих виджетов (кроме кнопок и метки)
│   │
│   ├─── Создание метки с заголовком товара
│   │
│   └─── Добавление метки в макет
│   │
│   ├─── Создание метки с деталями товара
│   │
│   └─── Добавление метки в макет
│
└─── Отображение данных о товаре
```

#### `prepare_product_async(self)`

```python
    @asyncSlot()
    async def prepare_product_async(self):
        """ Asynchronously prepare the product """
```

**Назначение**: Асинхронно подготавливает товар к публикации.

**Как работает функция**:
1. Проверяет, создан ли экземпляр `AliCampaignEditor`.
2. Вызывает метод `prepare_product()` редактора.
3. Отображает сообщение об успехе или ошибке.

```
Подготовка продукта
│
├─── Проверка наличия редактора
│   │
│   └─── Вызов prepare_product() редактора
│   │
│   ├─── Отображение сообщения об успехе
│   │
│   └─── Обработка ошибок
│   │   └─── Отображение сообщения об ошибке
│
└─── Асинхронное выполнение
```

## Функции

В данном модуле функции отсутствуют.
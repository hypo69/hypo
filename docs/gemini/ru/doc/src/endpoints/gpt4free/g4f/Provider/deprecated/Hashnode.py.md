# Модуль для работы с провайдером Hashnode
==========================================

Модуль содержит класс `Hashnode`, который является асинхронным провайдером и предназначен для взаимодействия с сервисом Hashnode.
Он поддерживает историю сообщений и модель GPT-3.5 Turbo.

## Обзор

Модуль `Hashnode.py` предоставляет класс `Hashnode`, который позволяет взаимодействовать с API Hashnode для получения ответов на основе предоставленных сообщений и поисковых запросов. Он использует асинхронные запросы для неблокирующей работы.

## Подробнее

Этот модуль является частью системы провайдеров, используемых для получения ответов от различных AI-моделей. `Hashnode` специализируется на использовании API Hashnode для этой цели.

## Классы

### `SearchTypes`

**Описание**: Класс, содержащий константы, определяющие типы поиска, поддерживаемые Hashnode.

**Атрибуты**:
- `quick` (str): Быстрый поиск.
- `code` (str): Поиск кода.
- `websearch` (str): Поиск в интернете.

### `Hashnode`

**Описание**: Класс, реализующий асинхронный провайдер для взаимодействия с API Hashnode.

**Наследует**:
- `AsyncGeneratorProvider`: Наследует от базового класса для асинхронных генераторов провайдеров.

**Атрибуты**:
- `url` (str): URL сервиса Hashnode.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели GPT-3.5 Turbo.
- `_sources` (list): Список источников, полученных в результате поиска.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API Hashnode.
- `get_sources`: Возвращает список источников в формате, пригодном для использования.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    search_type: str = SearchTypes.websearch,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения ответов от API Hashnode.

    Args:
        model (str): Модель для использования (не используется в данной реализации).
        messages (Messages): Список сообщений для отправки в API.
        search_type (str, optional): Тип поиска. По умолчанию `SearchTypes.websearch`.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные параметры.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий ответы от API Hashnode.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.

    """
```

**Назначение**: Функция создает асинхронный генератор для получения ответов от API Hashnode. Она отправляет сообщения пользователя и параметры поиска в API Hashnode и возвращает асинхронный генератор, который выдает полученные ответы по частям.

**Параметры**:
- `cls`: Ссылка на класс `Hashnode`.
- `model` (str): Модель для использования (фактически не используется в данной реализации).
- `messages` (Messages): Список сообщений, отправляемых в API.
- `search_type` (str, optional): Тип поиска, который нужно использовать. По умолчанию используется `SearchTypes.websearch`.
- `proxy` (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий ответы от API Hashnode.

**Как работает функция**:

1.  **Подготовка заголовков**: Функция подготавливает заголовки HTTP-запроса, включая User-Agent, Accept и Content-Type.
2.  **Создание сессии**: Создается асинхронная HTTP-сессия с использованием `aiohttp.ClientSession` с заданными заголовками.
3.  **Определение промпта**: Извлекается последний элемент `messages` (сообщение) и сохраняется в `prompt`.
4.  **Выполнение поиска**: Если `search_type` равен `"websearch"`, выполняется поисковый запрос к API Hashnode.
5.  **Формирование данных**: Формируются данные для запроса, включая ID чата, историю сообщений, промпт, тип поиска и результаты поиска.
6.  **Отправка запроса и получение ответа**: Отправляется POST-запрос к API Hashnode с данными и прокси (если указан).
7.  **Генерация чанков**: Асинхронно итерируется по содержимому ответа, декодируя каждый чанк и выдавая его.

```mermaid
graph TD
    A[Подготовка заголовков и создание сессии] --> B{search_type == "websearch"?};
    B -- Да --> C[Выполнение поискового запроса];
    B -- Нет --> D[Формирование данных для запроса];
    C --> D;
    D --> E[Отправка POST-запроса к API];
    E --> F[Асинхронная итерация по чанкам ответа];
    F --> G[Выдача декодированных чанков];
```

**Внутренние функции**:
- Отсутствуют.

**Примеры**:

Пример 1: Использование с типом поиска `websearch`:

```python
messages = [{"role": "user", "content": "Как приготовить пиццу?"}]
async_generator = Hashnode.create_async_generator(model="gpt-3.5-turbo", messages=messages, search_type=SearchTypes.websearch)
```

Пример 2: Использование без прокси:

```python
messages = [{"role": "user", "content": "Что такое машинное обучение?"}]
async_generator = Hashnode.create_async_generator(model="gpt-3.5-turbo", messages=messages)
```

### `get_sources`

```python
    @classmethod
    def get_sources(cls) -> list:
        """
        Возвращает список источников в формате, пригодном для использования.

        Returns:
            list: Список источников, содержащий заголовки и URL.
        """
        return [{
            "title": source["name"],
            "url": source["url"]
        } for source in cls._sources]
```

**Назначение**: Функция преобразует список источников, сохраненных в `cls._sources`, в формат, содержащий только заголовок и URL для каждого источника.

**Параметры**:
- `cls`: Ссылка на класс `Hashnode`.

**Возвращает**:
- `list`: Список словарей, где каждый словарь содержит `"title"` и `"url"` источника.

**Как работает функция**:

1.  **Преобразование источников**: Функция итерируется по списку `cls._sources`.
2.  **Формирование словаря**: Для каждого источника создается словарь с ключами `"title"` (значение берется из `"name"` источника) и `"url"` (значение берется из `"url"` источника).
3.  **Возврат списка**: Возвращается список сформированных словарей.

```mermaid
graph TD
    A[Итерация по cls._sources] --> B[Формирование словаря {title: source["name"], url: source["url"]}];
    B --> C[Возврат списка словарей];
```

**Внутренние функции**:
- Отсутствуют.

**Примеры**:

Пример 1: Получение источников после выполнения поиска:

```python
sources = Hashnode.get_sources()
print(sources)
# Модуль управления категориями Aliexpress

## Обзор

Модуль предоставляет функциональность для работы с категориями товаров на платформе Aliexpress. Он включает функции для получения ссылок на товары в категории, обновления категорий на основе данных с сайта и операций с базой данных.

## Подробнее

Модуль предназначен для управления категориями товаров на Aliexpress. Он включает в себя следующие ключевые функции:

- Получение списка товаров из категории.
- Обновление категорий в сценарии на основе данных с сайта.
- Операции с базой данных для работы с категориями.

## Оглавление

- [Описание модуля](#описание-модуля)
- [Пример использования](#пример-использования)
  - [Получение списка товаров из категории](#получение-списка-товаров-из-категории)
  - [Обновление категорий в файле сценария](#обновление-категорий-в-файле-сценария)
  - [Операции с базой данных](#операции-с-базой-данных)
- [Функции модуля](#функции-модуля)
  - [`get_list_products_in_category(s)`](#get_list_products_in_categorys)
  - [`get_prod_urls_from_pagination(s)`](#get_prod_urls_from_paginations)
  - [`update_categories_in_scenario_file(s, scenario_filename)`](#update_categories_in_scenario_files-scenario_filename)
  - [`get_list_categories_from_site(s, scenario_file, brand='')`](#get_list_categories_from_sites-scenario_file-brand)
  - [Класс `DBAdaptor`](#класс-dbadaptor)
- [Установка](#установка)
- [Логирование](#логирование)
- [Автор](#автор)

## Классы

### Класс `DBAdaptor`

**Описание**: Предоставляет методы для выполнения операций с базой данных, таких как `SELECT`, `INSERT`, `UPDATE` и `DELETE`.

**Как работает класс**:
Класс `DBAdaptor` служит адаптером для взаимодействия с базой данных. Он предоставляет методы для выполнения основных операций CRUD (Create, Read, Update, Delete) с данными в таблицах, связанных с категориями товаров. Класс абстрагирует детали реализации базы данных, позволяя использовать единый интерфейс для работы с данными.

**Методы**:

- `select(cat_id, parent_id, project_cat_id)`: Выбирает записи из базы данных.
    - **Параметры**:
        - `cat_id`: Идентификатор категории.
        - `parent_id`: Идентификатор родительской категории.
        - `project_cat_id`: Идентификатор категории проекта.
    - **Как работает метод**:
        Метод `select` выполняет выборку записей из базы данных на основе предоставленных идентификаторов категорий. Внутри метода формируется SQL-запрос с условиями фильтрации по указанным параметрам. Результат запроса возвращается в виде набора данных, соответствующих критериям выбора.
- `insert()`: Вставляет новые записи в базу данных.
    - **Как работает метод**:
        Метод `insert` добавляет новые записи в базу данных. Он формирует SQL-запрос на вставку данных, основываясь на информации, переданной в метод. После выполнения запроса в базе данных появляется новая запись.
- `update()`: Обновляет записи в базе данных.
    - **Как работает метод**:
        Метод `update` обновляет существующие записи в базе данных. Он формирует SQL-запрос на обновление данных, основываясь на переданных параметрах. В результате выполнения запроса, существующие записи в базе данных изменяются в соответствии с новыми значениями.
- `delete()`: Удаляет записи из базы данных.
    - **Как работает метод**:
        Метод `delete` удаляет записи из базы данных. Он формирует SQL-запрос на удаление данных, основываясь на указанных идентификаторах. После выполнения запроса, соответствующие записи удаляются из базы данных.

## Функции

### `get_list_products_in_category(s)`

**Назначение**: Считывает URL товаров со страницы категории. Если есть несколько страниц с товарами, функция будет перелистывать все страницы.

**Параметры**:
- `s` (`Supplier`): Экземпляр поставщика.

**Возвращает**:
- Список URL продуктов в категории.

**Как работает функция**:
1. Функция `get_list_products_in_category` принимает экземпляр поставщика (`Supplier`) в качестве аргумента.
2. Функция собирает ссылки на товары с первой страницы категории, используя `get_prod_urls_from_pagination(s)`.
3. Если на странице категории есть пагинация, функция автоматически перелистывает страницы и собирает ссылки на товары с каждой страницы.

### `get_prod_urls_from_pagination(s)`

**Назначение**: Собирает ссылки на товары с страницы категории с перелистыванием страниц.

**Параметры**:
- `s` (`Supplier`): Экземпляр поставщика.

**Возвращает**:
- Список ссылок на товары.

**Как работает функция**:
1. Функция `get_prod_urls_from_pagination` принимает экземпляр поставщика (`Supplier`) в качестве аргумента.
2. Функция использует веб-драйвер для открытия страницы категории, указанной в атрибутах поставщика.
3.  <инструкция для модели gemini:Извлекает все URL товаров с текущей страницы категории.>
4. Если на странице есть элементы пагинации, функция переходит к следующей странице и повторяет процесс сбора ссылок.

### `update_categories_in_scenario_file(s, scenario_filename)`

**Назначение**: Проверяет изменения категорий на сайте и обновляет файл сценария.

**Параметры**:
- `s` (`Supplier`): Экземпляр поставщика.
- `scenario_filename` (str): Имя файла сценария для обновления.

**Возвращает**:
- `True`, если обновление прошло успешно.

**Как работает функция**:
1. Функция `update_categories_in_scenario_file` принимает экземпляр поставщика (`Supplier`) и имя файла сценария в качестве аргументов.
2. Функция получает список категорий с сайта, используя `get_list_categories_from_site(s, scenario_filename)`.
3.  <инструкция для модели gemini:Загружает существующие категории из файла сценария.>
4.  <инструкция для модели gemini:Сравнивает категории, полученные с сайта, с категориями из файла сценария и обновляет файл сценария, если есть изменения.>
5. Если обновление выполнено успешно, функция возвращает `True`.

### `get_list_categories_from_site(s, scenario_file, brand='')`

**Назначение**: Получает список категорий с сайта на основе файла сценария.

**Параметры**:
- `s` (`Supplier`): Экземпляр поставщика.
- `scenario_file` (str): Имя файла сценария.
- `brand` (str, optional): Опциональное имя бренда.

**Возвращает**:
- Список категорий.

**Как работает функция**:
1. Функция `get_list_categories_from_site` принимает экземпляр поставщика (`Supplier`), имя файла сценария и опциональное имя бренда в качестве аргументов.
2.  <инструкция для модели gemini:Загружает структуру сценария из указанного файла.>
3.  <инструкция для модели gemini:Проходит по списку категорий в сценарии и извлекает URL категорий с сайта.>
4.  <инструкция для модели gemini:Если указан бренд, функция фильтрует категории по бренду.>
5. Функция возвращает список категорий.

## Установка

Для работы с модулем необходимо установить зависимые пакеты, такие как `requests`, а также настроить соединение с базой данных через `gs.db_translations_credentials`.

### Зависимости:
- `requests`
- `src.utils.jjson`
- `src.db.manager_categories.suppliers_categories`

## Логирование

В модуле используется логирование через `src.logger`, которое помогает отслеживать ошибки и события в процессе выполнения.

## Автор

Модуль разработан для внутреннего использования в проекте.
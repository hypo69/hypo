# Анализ кода модуля `poetry.py`

**Качество кода**

-   **Соответствие требованиям к формату кода (1-10):** 7

    *   **Преимущества:**
        *   Код в целом выполняет поставленную задачу по генерации случайных фраз и предоставляет пользователю возможность изменять списки слов.
        *   Используются понятные имена переменных и функций.
        *   Логика игры реализована в соответствии с описанием.
        *   Присутствуют комментарии, объясняющие основные шаги кода, хотя их нужно перевести в формат RST.
    *   **Недостатки:**
        *   Отсутствует документация в формате reStructuredText (RST) для модуля, функций и переменных.
        *   Используется `input` без обработки исключений при преобразовании пользовательского ввода в целое число, что может привести к ошибкам.
        *   Нет обработки возможных ошибок при вводе данных (например, пустой ввод).
        *   Не используется `j_loads` или `j_loads_ns` для чтения данных, если это необходимо (хотя в данном коде нет чтения из файла).
        *   Отсутствует логгирование ошибок.
        *   Используется глобальная область видимости для списков слов, что может усложнить поддержку кода.
        *   Не используются константы для кодов действий (1, 2, 3, 4).
        *   Дублирование кода для запроса пользовательского ввода и проверки `user_code` на равенство `0`.
        *   Цикл `while True:` можно было бы переписать с более явным условием выхода.

**Рекомендации по улучшению**

1.  **Документация RST:**
    *   Добавить документацию в формате RST для модуля, функций и переменных.
    *   Использовать `docstring` для описания функций.
2.  **Обработка ошибок:**
    *   Добавить обработку исключений при преобразовании ввода пользователя в целое число.
    *   Использовать `logger.error` для записи ошибок.
3.  **Использование j_loads:**
    *   Если требуется чтение из файла, использовать `j_loads` или `j_loads_ns` из `src.utils.jjson`.
4.  **Рефакторинг кода:**
    *   Вынести повторяющийся код запроса ввода и проверки на выход в отдельную функцию.
    *   Использовать константы для кодов действий.
    *   Изменить условие выхода из цикла `while True` на более явное.
5.  **Глобальные переменные:**
    *   Рассмотреть возможность перемещения списков слов в класс или функцию для лучшей организации и избежания глобальной области видимости.
6.  **Форматирование кода:**
    *   Использовать `f-строки` для форматирования вывода.

**Улучшенный код**

```python
"""
Модуль "Поэзия"
==================

Этот модуль реализует игру, в которой компьютер генерирует случайные предложения,
выбирая слова из предопределенных списков. Игрок может изменять эти списки,
вводя соответствующие команды.

Пример использования
---------------------

.. code-block:: python

   python poetry.py
"""
import random
from src.logger.logger import logger  # Добавлен импорт logger

# Константы для кодов действий
CHANGE_NOUNS = 1
CHANGE_VERBS = 2
CHANGE_ADJECTIVES = 3
CHANGE_PREPOSITIONS = 4
EXIT_CODE = 0


def change_list(list_name: str) -> list[str]:
    """
    Изменяет список слов на основе ввода пользователя.

    :param list_name: Имя списка, который нужно изменить.
    :return: Новый список слов.

    :Example:
        >>> change_list("существительных")
        Введите новые слова для списка существительных через запятую: cat,dog,bird
        ['CAT', 'DOG', 'BIRD']
    """
    try:  # Добавлена обработка ошибок ввода
        new_list = input(f"Введите новые слова для списка {list_name} через запятую: ").upper().split(",")
        return new_list
    except Exception as ex:
        logger.error(f'Ошибка при изменении списка {list_name}: {ex}')
        return []  # Возвращаем пустой список в случае ошибки


def get_user_code() -> int | None:
    """
    Запрашивает у пользователя ввод кода и проверяет его на корректность.

    :return: Введенный пользователем код или None, если ввод некорректный.
    :Example:
        >>> get_user_code()
        Введите код (0 для выхода): 1
        1
    """
    user_input = input("Введите код (0 для выхода): ")
    if user_input == "0":
        return EXIT_CODE
    try:
        user_code = int(user_input)
        if user_code not in (CHANGE_NOUNS, CHANGE_VERBS, CHANGE_ADJECTIVES, CHANGE_PREPOSITIONS):
           print ("Неверный ввод, введите 0, 1, 2, 3 или 4")
           return None
        return user_code
    except ValueError:
        print("Неверный ввод, введите 0, 1, 2, 3 или 4")
        return None
    except Exception as ex:
        logger.error(f'Ошибка при получении пользовательского ввода: {ex}')
        return None


def main():
    """
    Основная функция, запускающая игру "Поэзия".

    :Example:
        >>> main()
        Добро пожаловать в игру POETRY!
        Нажмите:
        1 чтобы поменять существительные
        2 чтобы поменять глаголы
        3 чтобы поменять прилагательные
        4 чтобы поменять предлоги
        0 чтобы выйти
        Случайная фраза: THE YELLOW BIRDS RUN ALONG THE FOREST
        Введите код (0 для выхода): 0
        BYE
    """
    # Начальные списки слов
    nouns = ["BIRDS", "CATS", "DOGS", "FISH", "TREES", "FLOWERS", "RIVERS", "MOUNTAINS", "CLOUDS", "STARS"]
    verbs = ["FLY", "RUN", "SWIM", "JUMP", "GROW", "BLOOM", "FLOW", "CLIMB", "FLOAT", "SHINE"]
    adjectives = ["RED", "BLUE", "GREEN", "YELLOW", "TALL", "SHORT", "BIG", "SMALL", "BRIGHT", "DARK"]
    prepositions = ["OVER", "UNDER", "IN", "ON", "BY", "NEAR", "THROUGH", "AROUND", "ACROSS", "ALONG"]

    print("Добро пожаловать в игру POETRY!")
    print("Нажмите:")
    print("1 чтобы поменять существительные")
    print("2 чтобы поменять глаголы")
    print("3 чтобы поменять прилагательные")
    print("4 чтобы поменять предлоги")
    print("0 чтобы выйти")

    while True:
        # Генерируем случайное число от 1 до 4
        random_number = random.randint(1, 4)

        if random_number == 1:
            # Генерируем предложение
            random_noun = random.choice(nouns)
            random_verb = random.choice(verbs)
            random_adjective = random.choice(adjectives)
            random_preposition = random.choice(prepositions)

            phrase = f"THE {random_adjective} {random_noun} {random_verb} {random_preposition} THE FOREST"
            print(f"Случайная фраза: {phrase}")
            user_code = get_user_code()
            if user_code == EXIT_CODE:
                break
            elif user_code is None:  # Если get_user_code вернула None, перейти к следующей итерации
                continue


        else:
           user_code = get_user_code()
           if user_code == EXIT_CODE:
                break
           elif user_code is None: # Если get_user_code вернула None, перейти к следующей итерации
               continue
        # Обрабатываем ввод пользователя
        if user_code == CHANGE_NOUNS:
            nouns = change_list("существительных")
        elif user_code == CHANGE_VERBS:
            verbs = change_list("глаголов")
        elif user_code == CHANGE_ADJECTIVES:
            adjectives = change_list("прилагательных")
        elif user_code == CHANGE_PREPOSITIONS:
            prepositions = change_list("предлогов")

    print("BYE")


if __name__ == "__main__":
    main()

"""
Объяснение кода:
1.  **Импорт модуля `random` и `logger`**::
    -   `import random`: Импортирует модуль `random`, который используется для генерации случайных чисел и выбора случайных элементов из списка.
    -   `from src.logger.logger import logger`: Импортирует логгер для записи ошибок.

2. **Константы для кодов действий**:
    - Определены константы для кодов действий, что делает код более читаемым и поддерживаемым.

3.  **Функция `change_list(list_name)`**:
    -   Определяет функцию `change_list`, которая позволяет пользователю изменить список слов.
    -   `new_list = input(...)`: Запрашивает у пользователя ввод новых слов через запятую, преобразует ввод в верхний регистр и разделяет на список.
    -  Обработка ошибок: Добавлена обработка ошибок с использованием try/except.
    -   `return new_list`: Возвращает новый список слов.

4.  **Функция `get_user_code()`**:
    -   Запрашивает у пользователя ввод кода.
    -   Проверяет, является ли ввод числом и соответствует ли одному из кодов действий.
    -   Возвращает введенный код или None, если ввод некорректный.
    -   Обработка ошибок: Добавлена обработка ошибок с использованием try/except и logger.

5.  **Функция `main()`**:
    -   Содержит основную логику игры.
    -   Инициализирует списки слов.
    -   Выводит приветствие и инструкции.
    -   Основной цикл `while True`, который продолжается до тех пор, пока пользователь не введет `0`.
    - `randomNumber = random.randint(1, 4)`: Генерируем случайное число от 1 до 4
    -  **Условие генерации фразы**:
      - `if randomNumber == 1`: проверяем, если случайное число равно 1
      -  `random_noun = random.choice(nouns)`: Случайно выбираем существительное из списка.
      -  `random_verb = random.choice(verbs)`: Случайно выбираем глагол из списка.
      -  `random_adjective = random.choice(adjectives)`: Случайно выбираем прилагательное из списка.
      -  `random_preposition = random.choice(prepositions)`: Случайно выбираем предлог из списка.
      -  `phrase = f"THE {random_adjective} {random_noun} {random_verb} {random_preposition} THE FOREST"`: Формируем случайную фразу, используя выбранные слова.
      -  `print(f"Случайная фраза: {phrase}")`: Выводим сгенерированную фразу на экран.
      -   `user_code = get_user_code()`: Запрашиваем у пользователя ввод кода для изменения списка слов.
      -   `if user_code == EXIT_CODE: break`: Если пользователь вводит `0`, то завершаем цикл (игру).
      -   `elif user_code is None: continue`: Если get_user_code вернула None, перейти к следующей итерации.
    -  **Условие изменения списков**:
      - `else:`: если случайное число не равно 1, то спрашиваем код для изменения списков
      -  `user_code = get_user_code()`: Запрашиваем у пользователя ввод кода для изменения списка слов.
      -   `if user_code == EXIT_CODE: break`: Если пользователь вводит `0`, то завершаем цикл (игру).
      -  `elif user_code is None: continue`: Если get_user_code вернула None, перейти к следующей итерации.
    -  Обрабатываем ввод пользователя и вызываем функцию для изменения списков.
    -   `print("BYE")`: Выводит сообщение "BYE" после завершения цикла.

6. **Условие запуска**:
     -   `if __name__ == "__main__":`:  Гарантирует, что функция `main()` будет запущена только при запуске скрипта напрямую.
"""
```
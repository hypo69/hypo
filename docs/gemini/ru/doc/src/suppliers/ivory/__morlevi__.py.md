# Модуль `__morlevi__.py`

## Обзор

Модуль `__morlevi__.py` предназначен для работы с поставщиком "morlevi" в рамках проекта `hypotez`. Он включает в себя функции для авторизации на сайте поставщика, сбора информации о товарах и навигации по категориям. Модуль использует библиотеки `requests`, `pandas` и `selenium` для взаимодействия с веб-сайтом поставщика.

## Подробнее

Этот модуль является частью подсистемы работы с поставщиками и отвечает за автоматизацию процесса сбора данных с сайта "morlevi". Он содержит функции для входа в систему, извлечения информации о продуктах и получения списка категорий. Модуль интегрирован с другими частями проекта, такими как `src.settings`, `src.suppliers.Product`, для обеспечения консистентности данных и централизованного управления настройками.

## Функции

### `login`

```python
def login(supplier):
    """
    Выполняет вход на сайт поставщика.

    Args:
        supplier: Объект поставщика, содержащий необходимые параметры и драйвер.

    Returns:
        bool: True, если вход выполнен успешно, иначе None.
    """
```

**Назначение**:
Функция `login` предназначена для автоматического входа на сайт поставщика "morlevi". Она принимает объект поставщика в качестве аргумента и использует его параметры для выполнения входа.

**Как работает функция**:

1.  **Инициализация**: Функция принимает объект `supplier` в качестве аргумента и извлекает из него драйвер `_d` и другие необходимые параметры.
2.  **Переход на страницу логина**: Функция пытается перейти по URL, указанному в параметрах поставщика.
3.  **Попытка логина**: Вызывается внутренняя функция `_login` для выполнения фактического входа. Если вход успешен, функция возвращает `True`.
4.  **Обработка ошибок**: Если первая попытка входа не удалась, функция пытается закрыть модальные окна, которые могут мешать входу.
5.  **Повторная попытка логина**: После закрытия модальных окон функция повторяет попытку входа с помощью функции `_login`.
6.  **Обработка нескольких модальных окон**: Если на странице присутствует несколько модальных окон, функция пытается закрыть каждое из них и повторить попытку входа.
7.  **Обработка исключений**: Если в процессе входа возникают исключения, функция логирует ошибку и возвращает `None`.

**ASCII Flowchart**:

```
    A: Начало (supplier)
    |
    B: Переход на страницу логина
    |
    C: _login(supplier)
    |
    D: Успешный вход?
    |
    E: Да -> Возврат True
    |
    F: Нет -> Закрытие модальных окон
    |
    G: Повторный _login(supplier)
    |
    H: Успешный вход?
    |
    I: Да -> Возврат True
    |
    J: Нет -> Логирование ошибки и возврат None
```

**Примеры**:

```python
# Пример вызова функции login
supplier = Supplier(driver=driver, locators=locators)  # Создание объекта поставщика
if login(supplier):
    print("Вход выполнен успешно")
else:
    print("Не удалось войти")
```

### `_login`

```python
def _login(_s):
    """
    Выполняет фактический вход на сайт поставщика.

    Args:
        _s: Объект поставщика, содержащий необходимые параметры и драйвер.

    Returns:
        bool: True, если вход выполнен успешно, иначе None.
    """
```

**Назначение**:
Функция `_login` выполняет фактический вход на сайт поставщика "morlevi". Она принимает объект поставщика в качестве аргумента и использует его параметры для выполнения входа.

**Как работает функция**:

1.  **Инициализация**: Функция принимает объект `_s` (поставщик) в качестве аргумента и извлекает из него драйвер `_d` и локаторы `_l`.
2.  **Обновление страницы**: Обновляет текущую страницу.
3.  **Ввод данных для входа**: Функция использует локаторы для ввода email и пароля в соответствующие поля на странице логина.
4.  **Клик на кнопку логина**: Функция нажимает на кнопку логина.
5.  **Обработка исключений**: Если в процессе входа возникают исключения, функция логирует ошибку и возвращает `None`.

**ASCII Flowchart**:

```
    A: Начало (_s)
    |
    B: Обновление страницы
    |
    C: Ввод email
    |
    D: Ввод пароля
    |
    E: Клик на кнопку логина
    |
    F: Успешный вход?
    |
    G: Да -> Логирование и возврат True
    |
    H: Нет -> Логирование ошибки и возврат None
```

**Примеры**:

```python
# Пример вызова функции _login
supplier = Supplier(driver=driver, locators=locators)  # Создание объекта поставщика
if _login(supplier):
    print("Вход выполнен успешно")
else:
    print("Не удалось войти")
```

### `grab_product_page`

```python
def grab_product_page(s):
    """
    Собирает информацию о товаре со страницы товара.

    Args:
        s: Объект поставщика, содержащий необходимые параметры и драйвер.

    Returns:
        Product: Объект товара с заполненными данными.
    """
```

**Назначение**:
Функция `grab_product_page` предназначена для сбора информации о товаре со страницы товара на сайте поставщика "morlevi". Она создает объект `Product` и заполняет его данными, извлеченными со страницы.

**Как работает функция**:

1.  **Инициализация**: Функция принимает объект `s` (поставщик) в качестве аргумента и создает объект `Product`. Извлекает локаторы и драйвер.
2.  **Закрытие модального окна**: Функция пытается закрыть модальное окно, которое может появиться на странице.
3.  **Определение внутренних функций**: Внутри `grab_product_page` определены внутренние функции для установки различных полей объекта `Product`:
    *   `set_id`: Устанавливает ID товара.
    *   `set_sku_suppl`: Устанавливает артикул поставщика.
    *   `set_sku_prod`: Устанавливает артикул товара.
    *   `set_title`: Устанавливает заголовок товара.
    *   `set_summary`: Устанавливает краткое описание товара.
    *   `set_description`: Устанавливает полное описание товара.
    *   `set_cost_price`: Устанавливает цену товара.
    *   `set_before_tax_price`: Устанавливает цену без налога.
    *   `set_delivery`: Устанавливает информацию о доставке.
    *   `set_images`: Устанавливает URL изображения товара.
    *   `set_combinations`: Устанавливает комбинации товара.
    *   `set_qty`: Устанавливает количество товара.
    *   `set_specification`: Устанавливает спецификацию товара.
    *   `set_customer_reviews`: Устанавливает отзывы клиентов.
    *   `set_supplier`: Устанавливает поставщика товара.
    *   `set_rewritted_URL`: Устанавливает переписанный URL товара.
4.  **Вызов внутренних функций**: Функция вызывает все внутренние функции для заполнения полей объекта `Product`.
5.  **Возврат объекта Product**: Функция возвращает объект `Product` с заполненными данными.

**Внутренние функции**:

*   `set_id`:
    ```python
    def set_id():
        """
        Устанавливает ID товара.
        """
    ```
*   `set_sku_suppl`:
    ```python
    def set_sku_suppl():
        """
        Устанавливает артикул поставщика.
        """
    ```
*   `set_sku_prod`:
    ```python
    def set_sku_prod():
        """
        Устанавливает артикул товара.
        """
    ```
*   `set_title`:
    ```python
    def set_title():
        """
        Устанавливает заголовок товара.
        """
    ```
*   `set_summary`:
    ```python
    def set_summary():
        """
        Устанавливает краткое описание товара.
        """
    ```
*   `set_description`:
    ```python
    def set_description():
        """
        Устанавливает полное описание товара.
        """
    ```
*   `set_cost_price`:
    ```python
    def set_cost_price():
        """
        Устанавливает цену товара.
        """
    ```
*   `set_before_tax_price`:
    ```python
    def set_before_tax_price():
        """
        Устанавливает цену без налога.
        """
    ```
*   `set_delivery`:
    ```python
    def set_delivery():
        """
        Устанавливает информацию о доставке.
        """
    ```
*   `set_images`:
    ```python
    def set_images(via_ftp=False):
        """
        Устанавливает URL изображения товара.
        """
    ```
*   `set_combinations`:
    ```python
    def set_combinations():...
        """
        Устанавливает комбинации товара.
        """
    ```
*   `set_qty`:
    ```python
    def set_qty():...
        """
        Устанавливает количество товара.
        """
    ```
*   `set_specification`:
    ```python
    def set_specification():
        """
        Устанавливает спецификацию товара.
        """
    ```
*   `set_customer_reviews`:
    ```python
    def set_customer_reviews():...
        """
        Устанавливает отзывы клиентов.
        """
    ```
*   `set_supplier`:
    ```python
    def set_supplier():
        """
        Устанавливает поставщика товара.
        """
    ```
*   `set_rewritted_URL`:
    ```python
    def set_rewritted_URL():
        """
        Устанавливает переписанный URL товара.
        """
    ```

**ASCII Flowchart**:

```
    A: Начало (s)
    |
    B: Создание объекта Product
    |
    C: Закрытие модального окна
    |
    D: Вызов set_id()
    |
    E: Вызов set_sku_suppl()
    |
    F: Вызов set_sku_prod()
    |
    G: Вызов set_title()
    |
    H: Вызов set_cost_price()
    |
    I: Вызов set_before_tax_price()
    |
    J: Вызов set_delivery()
    |
    K: Вызов set_images()
    |
    L: Вызов set_combinations()
    |
    M: Вызов set_description()
    |
    N: Вызов set_summary()
    |
    O: Вызов set_supplier()
    |
    P: Вызов set_rewritted_URL()
    |
    Q: Возврат объекта Product
```

**Примеры**:

```python
# Пример вызова функции grab_product_page
supplier = Supplier(driver=driver, locators=locators)  # Создание объекта поставщика
product = grab_product_page(supplier)
if product:
    print("Информация о товаре собрана успешно")
else:
    print("Не удалось собрать информацию о товаре")
```

### `list_products_in_category_from_pagination`

```python
def list_products_in_category_from_pagination(supplier):
    """
    Получает список ссылок на товары в категории, перебирая страницы пагинации.

    Args:
        supplier: Объект поставщика, содержащий необходимые параметры и драйвер.

    Returns:
        list: Список ссылок на товары в категории.
    """
```

**Назначение**:
Функция `list_products_in_category_from_pagination` предназначена для получения списка ссылок на товары в категории, перебирая страницы пагинации на сайте поставщика "morlevi".

**Как работает функция**:

1.  **Инициализация**: Функция принимает объект `supplier` в качестве аргумента и извлекает из него драйвер `_d` и локаторы `_l`.
2.  **Получение списка товаров с текущей страницы**: Функция пытается получить список ссылок на товары с текущей страницы категории.
3.  **Обработка пустого списка**: Если список товаров пуст, функция возвращает пустой список.
4.  **Расширение списка товаров**: Если список товаров не пуст, функция расширяет список `list_products_in_category` ссылками на товары с текущей страницы.
5.  **Перебор страниц пагинации**: Функция перебирает страницы пагинации и добавляет ссылки на товары с каждой страницы в список `list_products_in_category`.
6.  **Удаление дубликатов**: Функция удаляет дубликаты из списка `list_products_in_category`.
7.  **Возврат списка товаров**: Функция возвращает список ссылок на товары в категории.

**ASCII Flowchart**:

```
    A: Начало (supplier)
    |
    B: Получение списка товаров с текущей страницы
    |
    C: Список товаров пуст?
    |
    D: Да -> Возврат пустого списка
    |
    E: Нет -> Расширение списка товаров
    |
    F: Перебор страниц пагинации
    |
    G: Получение списка товаров с текущей страницы пагинации
    |
    H: Расширение списка товаров
    |
    I: Дошли до конца пагинации?
    |
    J: Да -> Удаление дубликатов
    |
    K: Возврат списка товаров
```

**Примеры**:

```python
# Пример вызова функции list_products_in_category_from_pagination
supplier = Supplier(driver=driver, locators=locators)  # Создание объекта поставщика
list_products = list_products_in_category_from_pagination(supplier)
if list_products:
    print("Список товаров получен успешно")
else:
    print("Не удалось получить список товаров")
```

### `get_list_products_in_category`

```python
def get_list_products_in_category(s, scenario, presath):
    """
    s:Supplier
    scenario:JSON
    presath:PrestaShopWebServiceDict
    """
```

**Назначение**:
Функция `get_list_products_in_category` предназначена для получения списка товаров в категории.

**Как работает функция**:

1.  **Вызов функции `list_products_in_category_from_pagination`**: Функция вызывает функцию `list_products_in_category_from_pagination` для получения списка товаров в категории.

**ASCII Flowchart**:

```
    A: Начало (s, scenario, presath)
    |
    B: Вызов list_products_in_category_from_pagination(s,scenario)
    |
    C: ...
```

**Примеры**:

```python
# Пример вызова функции get_list_products_in_category
supplier = Supplier(driver=driver, locators=locators)  # Создание объекта поставщика
scenario = {}  # JSON
presath = {}  # PrestaShopWebServiceDict
get_list_products_in_category(supplier, scenario, presath)
```

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s, scenario_file, brand=''):
    """
    ...
    """
```

**Назначение**:
Функция `get_list_categories_from_site` предназначена для получения списка категорий с сайта.

**Как работает функция**:

1.  `...`

**ASCII Flowchart**:

```
    A: Начало (s, scenario_file, brand)
    |
    B: ...
```

**Примеры**:

```python
# Пример вызова функции get_list_categories_from_site
supplier = Supplier(driver=driver, locators=locators)  # Создание объекта поставщика
scenario_file = "scenario.json"
brand = "brand"
get_list_categories_from_site(supplier, scenario_file, brand)
# Модуль для работы с Forefront

## Обзор

Модуль `Forefront.py` предназначен для взаимодействия с провайдером Forefront, предоставляющим доступ к моделям GPT. Он реализует класс `Forefront`, который наследуется от `AbstractProvider` и обеспечивает функциональность для создания завершений (completions) с использованием API Forefront. Модуль поддерживает потоковую передачу данных и модель GPT-3.5 Turbo.

## Подробнее

Этот модуль позволяет отправлять запросы к API Forefront для генерации текста на основе предоставленных сообщений. Он использует библиотеку `requests` для выполнения HTTP-запросов и обрабатывает потоковые ответы, чтобы предоставить результат в режиме реального времени.

## Классы

### `Forefront(AbstractProvider)`

**Описание**: Класс `Forefront` предоставляет интерфейс для взаимодействия с API Forefront.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для провайдеров.

**Атрибуты**:
- `url` (str): URL-адрес сервиса Forefront ("https://forefront.com").
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (True).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель GPT-3.5 Turbo (True).

**Методы**:
- `create_completion`: Создает завершение на основе предоставленных параметров.

## Функции

### `create_completion`

```python
def create_completion(
        model: str,
        messages: list[dict[str, str]],
        stream: bool, **kwargs: Any) -> CreateResult:
    """
    Создает завершение на основе предоставленных параметров, используя API Forefront.

    Args:
        model (str): Имя модели для использования.
        messages (list[dict[str, str]]): Список сообщений для отправки в API. Каждое сообщение представляет собой словарь, содержащий роли и контент.
        stream (bool): Определяет, следует ли использовать потоковую передачу данных.
        **kwargs (Any): Дополнительные аргументы.

    Returns:
        CreateResult: Результат создания завершения.

    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с ошибкой.

    Как работает функция:
    1. Формирует JSON-данные для отправки в API Forefront, включая текст сообщения, параметры модели и историю сообщений.
    2. Выполняет POST-запрос к API Forefront с использованием потоковой передачи данных.
    3. Обрабатывает потоковый ответ, извлекая дельты из каждого токена и возвращая их.
    """
```

**Назначение**: Создает запрос к API Forefront для генерации текста на основе предоставленных сообщений.

**Параметры**:
- `model` (str): Имя используемой модели.
- `messages` (list[dict[str, str]]): Список сообщений, где каждое сообщение - это словарь с ключами "role" и "content".
- `stream` (bool): Флаг, указывающий на использование потоковой передачи данных.
- `kwargs` (Any): Дополнительные параметры, передаваемые в API.

**Возвращает**:
- `CreateResult`: Генератор, выдающий части завершения.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Возникает, если HTTP-запрос завершается с ошибкой.

**Внутри функции происходят следующие действия и преобразования**:

A. **Подготовка данных**:
   - Формирование JSON-структуры `json_data` с использованием предоставленных сообщений и параметров. Структура включает в себя текст последнего сообщения, параметры модели, идентификаторы и историю сообщений.

B. **Выполнение запроса**:
   - Отправка POST-запроса к API Forefront (`https://streaming.tenant-forefront-default.knative.chi.coreweave.com/free-chat`) с использованием библиотеки `requests` и потоковой передачи данных.

C. **Обработка ответа**:
   - Итерация по строкам потокового ответа.
   - Проверка наличия ключа `delta` в каждой строке.
   - Извлечение значения `delta` из JSON-структуры и его передача через `yield`.

**Примеры**:

```python
messages = [{"role": "user", "content": "Напиши короткий стих о весне."}]
stream = True
model = "gpt-4"
result = Forefront.create_completion(model, messages, stream)
for token in result:
    print(token, end="")
```
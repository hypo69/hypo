```markdown
# combined-stream

A stream that emits multiple other streams one after another.

**NB** Currently `combined-stream` works with streams version 1 only.  There is ongoing effort to switch this library to streams version 2. Any help is welcome!  Meanwhile, explore other libraries that provide streams2 support with varying compatibility to `combined-stream`.

* [combined-stream2](https://www.npmjs.com/package/combined-stream2): A drop-in streams2-compatible replacement.
* [multistream](https://www.npmjs.com/package/multistream):  A stream that emits multiple other streams.


## Installation

```bash
npm install combined-stream
```

## Usage

This example combines two files into one:

```javascript
const CombinedStream = require('combined-stream');
const fs = require('fs');

const combinedStream = CombinedStream.create();
combinedStream.append(fs.createReadStream('file1.txt'));
combinedStream.append(fs.createReadStream('file2.txt'));

combinedStream.pipe(fs.createWriteStream('combined.txt'));
```

**Important Considerations:**

* **`pauseStreams` option (default: `true`):**  This option controls back-pressure.
    * `true` (default): Streams are paused until needed, preventing excessive resource consumption.
    * `false`: Streams are not paused, which can lead to buffering issues if the downstream consumer can't keep up.  Choose carefully if you know your pipeline can handle the load.

```javascript
// Example with pauseStreams: false
const combinedStream = CombinedStream.create({ pauseStreams: false });
```

* **Asynchronous Stream Appending:** If you don't have all streams ready upfront, use a callback:

```javascript
const combinedStream = CombinedStream.create();
combinedStream.append(function(next) {
  next(fs.createReadStream('file1.txt'));
});
combinedStream.append(function(next) {
  next(fs.createReadStream('file2.txt'));
});

combinedStream.pipe(fs.createWriteStream('combined.txt'));
```


## API

### `CombinedStream.create([options])`

Creates a new combined stream object.

* **`options.maxDataSize`**: The maximum buffer size (in bytes) for all source streams.  Defaults to 2MB. Exceeding this limit triggers an error.
* **`options.pauseStreams`**:  Whether to pause appended streams. Defaults to `true`.


### `combinedStream.pauseStreams`

Indicates whether to pause underlying streams. Setting to `false` disables pausing, but consider potential buffer issues.


### `combinedStream.maxDataSize`

The maximum allowable buffer size (default 2MB).


### `combinedStream.dataSize`

The current buffer size of the combined stream.


### `combinedStream.append(stream)`

Appends a stream to the combined stream.  The stream can also be a function that takes a `next` callback.


### `combinedStream.write(data)`

**Do not call directly.** `combined-stream` manages the streaming process internally.


### `combinedStream.resume()`

Starts draining the appended streams.  Idempotent.


### `combinedStream.pause()`

Pauses the drain process (only if `pauseStreams` is true).


### `combinedStream.end()`

Sets the stream to non-writable, emits an `'end'` event, and removes all streams from the queue.


### `combinedStream.destroy()`

Similar to `end()`, but emits a `'close'` event.


## Error Handling

The `combinedStream` automatically attaches an error listener to each appended stream.  You don't need to manage these manually.


## License

MIT License
```
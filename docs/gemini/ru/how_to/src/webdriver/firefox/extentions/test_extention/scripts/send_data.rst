Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот JavaScript код собирает данные о загруженной странице (заголовок, URL, содержимое тела) и отправляет их на сервер по адресу `http://127.0.0.1/hypotez.online/api/` используя метод POST.  Код использует fetch API для асинхронной отправки данных в формате JSON.  Он обрабатывает возможные ошибки сети и отвечает на полученные данные с сервера.

Шаги выполнения
-------------------------
1. **Инициализация обработчика события:** Код определяет функцию `onPageLoad()`.  Эта функция будет вызвана, когда страница загрузится полностью.
2. **Сбор данных:** Функция `onPageLoad()` собирает данные с текущей страницы: заголовок (`document.title`), URL страницы (`window.location.href`) и содержимое тела (`document.body.innerHTML`).
3. **Формирование объекта данных:**  Собраные данные упаковываются в объект JavaScript `data` для удобной отправки.
4. **Отправка данных:** Используя `fetch`, код отправляет объект `data` на сервер. Запрос выполняется методом POST, а заголовок `Content-Type` устанавливается в `application/json` для правильной обработки данных на серверной стороне.
5. **Обработка ответа:** `fetch` возвращает промис, который обрабатывается методом `.then`.  Внутри первого `.then`, код проверяет успешность ответа. При ошибке генерируется ошибка `Error`.
6. **Обработка результата:** Если ответ успешен,  `response.json()` преобразует ответ в JSON и возвращает данные в виде объекта.  Полученные данные выводятся в консоль с помощью `console.log`.
7. **Обработка ошибок:**  `.catch` обрабатывает любые ошибки, которые могут возникнуть при отправке запроса или получении ответа. Ошибка логируется в консоль с помощью `console.error`.
8. **Регистрация обработчика:** Код регистрирует функцию `onPageLoad` как обработчик события `load` для объекта `window`.  Это гарантирует, что функция будет выполнена, когда вся страница загрузится.

Пример использования
-------------------------
.. code-block:: javascript

    // Создаем обработчик события для загрузки страницы
    function onPageLoad() {
        // Собираем информацию о странице
        var title = document.title;
        var url = window.location.href;
        var body = document.body.innerHTML;

        // Формируем объект с данными для отправки
        var data = {
            title: title,
            url: url,
            body: body
        };

        // Отправляем данные на указанный адрес
        fetch('http://127.0.0.1/hypotez.online/api/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(json => {
                console.log('Response:', json);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Добавляем обработчик события для загрузки страницы
    window.addEventListener('load', onPageLoad);
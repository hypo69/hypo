# Модуль popup.js

## Обзор

Этот модуль JavaScript отвечает за работу всплывающего окна расширения TryXPath. Он обрабатывает пользовательские запросы, отправляет их в активную вкладку (или указанный кадр), получает результаты и отображает их в интерфейсе всплывающего окна. Модуль также управляет состоянием всплывающего окна, сохраняя и восстанавливая его при необходимости.

## Переменные

### `noneClass`, `helpClass`

Строковые константы, используемые для добавления/удаления классов CSS, контролируя видимость элементов.

### `invalidTabId`, `invalidExecutionId`, `invalidFrameId`

Константы, представляющие недопустимые значения для идентификаторов вкладок, ID выполнения и кадра.

### `mainWay`, `mainExpression`, ... , `detailsPageCount`

Переменные, представляющие элементы DOM, используемые для хранения и отображения данных пользователя, результатов поиска и управления страницами результатов.

### `relatedTabId`, `relatedFrameId`, `executionId`

Переменные, используемые для хранения идентификаторов вкладки, кадра и ID выполнения для текущего запроса.

### `resultedDetails`

Массив, хранящий результаты поиска, полученные из содержимого страницы.

### `detailsPageSize`

Целое число, определяющее количество элементов на одной странице результатов.

### `detailsPageIndex`

Целое число, определяющее текущую страницу результатов.

## Функции

### `sendToActiveTab`

**Описание**: Отправляет сообщение в активную вкладку.

**Параметры**:
- `msg` (Object): Объект с сообщением для отправки.
- `opts` (Optional[Object], optional): Дополнительные параметры для сообщения (например, `frameId`). По умолчанию `{}`.

**Возвращает**:
- `Promise`: Обещание, которое выполнится после отправки сообщения.

**Вызывает исключения**:
- `Error`: Возникает при ошибке запроса к браузеру.


### `sendToSpecifiedFrame`

**Описание**: Отправляет сообщение в указанный кадр активной вкладки.

**Параметры**:
- `msg` (Object): Объект с сообщением для отправки.

**Возвращает**:
- `Promise`: Обещание, которое выполнится после успешного выполнения запроса в кадре.

**Вызывает исключения**:
- `Error`: Возникает при ошибке запроса к браузеру.


### `collectPopupState`

**Описание**: Собирает состояние всплывающего окна в объект.

**Параметры**: Нет.

**Возвращает**:
- `Object`: Объект, содержащий текущее состояние всплывающего окна.

**Вызывает исключения**:
- Нет.


### `changeContextVisible`, `changeResolverVisible`, `changeFrameIdVisible`, `changeFrameDesignationVisible`, `changeHelpVisible`

**Описание**: Изменяет видимость соответствующих блоков элементов в всплывающем окне.

**Параметры**: Нет.

**Возвращает**:
- Нет.

**Вызывает исключения**:
- Нет.


### `makeExecuteMessage`

**Описание**: Создает объект сообщения для выполнения запроса XPath в содержимом страницы.

**Параметры**: Нет.

**Возвращает**:
- `Object`: Объект, содержащий данные запроса.

**Вызывает исключения**:
- Нет.


### `getSpecifiedFrameId`

**Описание**: Возвращает идентификатор выбранного кадра.

**Параметры**: Нет.

**Возвращает**:
- `Number`: Идентификатор кадра или `0`, если кадр не выбран.

**Вызывает исключения**:
- Нет.


### `execContentScript`

**Описание**: Выполняет скрипты в содержимом страницы.

**Параметры**: Нет.

**Возвращает**:
- `Promise`: Обещание, которое выполняется после выполнения скриптов.

**Вызывает исключения**:
- `Error`: Возникает при ошибке выполнения скриптов в содержимом страницы.


### `sendExecute`

**Описание**: Отправляет сообщение для выполнения запроса.

**Параметры**: Нет.

**Возвращает**:
- Нет.

**Вызывает исключения**:
- Нет.


### `handleExprEnter`

**Описание**: Обрабатывает нажатие Enter для отправки запроса.

**Параметры**:
- `event` (Event): Событие нажатия.

**Возвращает**:
- Нет.

**Вызывает исключения**:
- Нет.



### `showDetailsPage`

**Описание**: Отображает страницу результатов с заданным индексом.

**Параметры**:
- `index` (Number): Индекс страницы результатов.

**Возвращает**:
- Нет.

**Вызывает исключения**:
- Нет.


### `showError`

**Описание**: Отображает сообщение об ошибке в интерфейсе.

**Параметры**:
- `message` (String): Сообщение об ошибке.
- `frameId` (Number): Идентификатор кадра, где произошла ошибка (для отладки).

**Возвращает**:
- Нет.

**Вызывает исключения**:
- Нет.


### `genericListener`

**Описание**: Общий обработчик сообщений из содержимого страницы.

**Параметры**:
- `message` (Object): Сообщение из содержимого.
- `sender` (Object): Объект отправителя.
- `sendResponse` (Function): Функция для отправки ответа.

**Возвращает**:
- Boolean: Возвращает `true`, если сообщение обработано, иначе `false`.

**Вызывает исключения**:
- Нет.
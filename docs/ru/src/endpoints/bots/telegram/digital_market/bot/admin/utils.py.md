# Модуль `utils.py`

## Обзор

Модуль содержит утилиты для работы с Telegram ботом, в частности, функцию для удаления сообщений.

## Подробней

Этот модуль предоставляет функцию `process_dell_text_msg`, которая используется для удаления последнего сообщения пользователя и сообщения с командой. Функция обрабатывает возможные ошибки, связанные с отсутствием идентификатора сообщения или другими проблемами при удалении.

## Функции

### `process_dell_text_msg`

```python
async def process_dell_text_msg(message: Message, state: FSMContext):
    """Обрабатывает удаление текстового сообщения пользователя.

    Args:
        message (Message): Объект сообщения, содержащий информацию о сообщении, которое нужно удалить.
        state (FSMContext): Объект состояния, содержащий данные о состоянии пользователя.

    Raises:
        Exception: Если происходит ошибка при удалении сообщения.
    """
```

**Как работает функция**:

1.  **Получение данных из состояния**: Извлекает данные из состояния пользователя, чтобы получить идентификатор последнего сообщения.
2.  **Проверка наличия идентификатора сообщения**: Проверяет, существует ли идентификатор последнего сообщения.
3.  **Удаление сообщений**: Если идентификатор существует, пытается удалить последнее сообщение и сообщение пользователя с командой.
4.  **Обработка ошибок**: Если идентификатор не найден, логирует предупреждение. В случае возникновения исключений при удалении сообщения, логирует ошибку.

**Внутри функции происходят следующие действия и преобразования**:

А. Извлечение идентификатора последнего сообщения из состояния пользователя.
|
Б. Проверка наличия идентификатора.
|
В. Удаление последнего сообщения и сообщения пользователя.
|
Г. Обработка возможных ошибок при удалении сообщения.

Где:

*   А: `data = await state.get_data()` - Извлечение данных из состояния пользователя.
*   Б: `if last_msg_id:` - Проверка наличия идентификатора последнего сообщения.
*   В: `await bot.delete_message(chat_id=message.from_user.id, message_id=last_msg_id)` и `await message.delete()` - Попытка удаления последнего сообщения и сообщения пользователя.
*   Г: `except Exception as ex:` - Обработка исключений, которые могут возникнуть при удалении сообщения.

**Примеры**:

```python
# Пример использования функции
from aiogram import Bot, Dispatcher
from aiogram.types import Message
from aiogram.fsm.context import FSMContext

# Инициализация бота и диспетчера
bot = Bot(token="YOUR_BOT_TOKEN")
dp = Dispatcher()

# Пример обработчика сообщений
@dp.message_handler(commands=['delete'])
async def delete_message_handler(message: Message, state: FSMContext):
    await process_dell_text_msg(message, state)
# Анализ кода модуля `82_snoopy.ru.md`

**Качество кода**

- **Соответствие требованиям к формату кода (1-10):**
    - **Преимущества:**
        - Описание игры чёткое и понятное, включая пошаговую инструкцию.
        - Приведены примеры работы программы, что помогает понять игровой процесс.
        - Указаны возможные ограничения и рекомендации по реализации.
        - Приведены варианты улучшений.
    - **Недостатки:**
        - Отсутствует фактический код Python, только описание логики.
        - Не используются `reStructuredText (RST)` для комментариев.

**Рекомендации по улучшению**

1.  **Реализация кода:** Необходимо написать код Python на основе предоставленного описания.
2.  **Формат комментариев:** Использовать `reStructuredText (RST)` для всех комментариев.
3.  **Обработка ошибок:** Добавить обработку ошибок при вводе данных пользователем.
4.  **Использование логгера:** Применять `logger.error` для записи ошибок.
5.  **Структура:** Код должен быть разбит на функции и классы для лучшей читаемости.
6.  **Импорт:** Использовать необходимые импорты, например, `random`, `math` и `src.utils.jjson`.

**Улучшенный код**

```python
"""
Модуль для реализации игры "SNOOPY" (Снупи).
=========================================================================================

Модуль содержит функции для инициализации игры, обработки ходов игрока и определения победителя.

Пример использования
--------------------

Пример запуска игры:

.. code-block:: python

    if __name__ == "__main__":
        play_snoopy()
"""

import random  # Модуль для генерации случайных координат дома
import math    # Модуль для вычисления расстояния
from src.logger.logger import logger  # Модуль для логирования ошибок
from src.utils.jjson import j_loads_ns # Модуль для загрузки данных


def calculate_distance(x1: int, y1: int, x2: int, y2: int) -> float:
    """
    Вычисляет расстояние между двумя точками на сетке.

    :param x1: Координата X первой точки.
    :param y1: Координата Y первой точки.
    :param x2: Координата X второй точки.
    :param y2: Координата Y второй точки.
    :return: Расстояние между точками.
    """
    return math.sqrt((x1 - x2)**2 + (y1 - y2)**2) # Вычисление расстояния по формуле


def generate_house_coordinates(grid_size: int) -> tuple[int, int]:
    """
    Генерирует случайные координаты дома на сетке.

    :param grid_size: Размер сетки.
    :return: Кортеж с координатами X и Y дома.
    """
    return random.randint(1, grid_size), random.randint(1, grid_size)  # Генерация случайных координат


def get_player_coordinates() -> tuple[int, int] | None:
    """
    Получает координаты от игрока и проводит валидацию ввода.

    :return: Кортеж с координатами X и Y игрока или None в случае ошибки.
    """
    while True:
        try:
            coords_str = input("Введите координаты (X, Y): ") # Запрашиваем ввод координат от игрока
            coords = tuple(map(int, coords_str.split(',')))  # Преобразуем введенные значения в целые числа
            if len(coords) != 2:  # Проверяем, что введено 2 числа
                logger.error("Неверный формат ввода. Введите два числа, разделенных запятой.") # Логгируем ошибку
                continue  # Переходим к следующей итерации цикла
            x, y = coords  # Получаем координаты из кортежа
            if not (1 <= x <= 10 and 1 <= y <= 10): # Проверяем, что координаты находятся в пределах допустимого диапазона
                logger.error("Координаты должны быть в диапазоне от 1 до 10.")  # Логгируем ошибку
                continue  # Переходим к следующей итерации цикла
            return x, y   # Возвращаем кортеж с координатами
        except ValueError: # Если возникает ошибка при преобразовании в целое число
            logger.error("Неверный формат ввода. Введите целые числа.")   # Логгируем ошибку
        except Exception as ex: # Если возникает любая другая ошибка
            logger.error(f"Произошла ошибка при вводе координат: {ex}") # Логгируем ошибку
            return None # В случае ошибки возвращаем None


def play_snoopy():
    """
    Основная функция, реализующая игровой процесс.
    """
    print("Добро пожаловать в SNOOPY!") # Выводим приветствие
    print("Ваша задача — найти спрятанный дом, выбирая координаты на сетке.") # Объясняем правила
    print("Каждый ход вы вводите координаты, а программа сообщает, насколько близко вы к дому.") # Объясняем правила
    print("Выигрывает тот, кто найдёт дом за минимальное количество ходов!")  # Объясняем правила
    print("Удачи!") # Выводим пожелание удачи

    grid_size = 10 # Задаем размер сетки
    house_x, house_y = generate_house_coordinates(grid_size) # Генерируем координаты дома
    moves = 0  # Инициализируем счетчик ходов
    found = False # Устанавливаем флаг, показывающий, что дом не найден

    while not found: # Пока дом не найден
        moves += 1 # Увеличиваем счетчик ходов
        coords = get_player_coordinates() # Получаем координаты от игрока
        if coords is None: # Если возникла ошибка при получении координат, переходим к следующей итерации
            continue
        player_x, player_y = coords # Получаем координаты игрока

        distance = calculate_distance(player_x, player_y, house_x, house_y) # Вычисляем расстояние до дома
        print(f"Расстояние до дома: {distance:.1f}") # Выводим расстояние до дома
        if distance == 0: # Если расстояние равно 0, значит дом найден
            found = True # Устанавливаем флаг, что дом найден
            print("Вы нашли дом! Поздравляем!")  # Выводим поздравление
            print(f"Вам потребовалось {moves} ходов.") # Выводим количество ходов
            while True:
                play_again = input("Хотите сыграть снова? (да/нет): ").lower() # Запрашиваем у игрока, хочет ли он сыграть еще раз
                if play_again == "да": # Если игрок хочет сыграть еще раз
                    play_snoopy() # Запускаем игру заново
                    return # Завершаем текущую игру
                elif play_again == "нет": # Если игрок не хочет играть еще раз
                    print("Спасибо за игру!") # Выводим благодарность
                    return  # Завершаем игру
                else:  # Если ввод игрока некорректен
                    print("Некорректный ввод. Введите 'да' или 'нет'.") # Выводим сообщение об ошибке

if __name__ == "__main__":
    play_snoopy() # Запускаем игру, если файл запущен напрямую
```
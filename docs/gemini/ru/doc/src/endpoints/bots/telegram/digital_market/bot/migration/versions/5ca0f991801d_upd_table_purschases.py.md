# Модуль для обновления таблицы покупок

## Обзор

Этот модуль содержит скрипт миграции базы данных Alembic для обновления таблицы `purchases`.
Он добавляет столбец `payment_type` и создает уникальный индекс для столбца `payment_id`.

## Подробней

Этот скрипт миграции используется для изменения структуры базы данных в проекте `hypotez`.
Он гарантирует, что таблица `purchases` содержит необходимую информацию о типе платежа и уникальный идентификатор платежа.

## Функции

### `upgrade`

```python
def upgrade() -> None:
    """
    Применяет изменения к базе данных.

    Args:
        None

    Returns:
        None

    Raises:
        Exception: В случае ошибки при применении изменений к базе данных.
    """
    # ### commands auto generated by Alembic - please adjust! ###
    # Добавляет столбец 'payment_type' типа String в таблицу 'purchases', столбец не может быть NULL
    op.add_column('purchases', sa.Column('payment_type', sa.String(), nullable=False))
    # Создает уникальное ограничение для столбца 'payment_id' в таблице 'purchases'
    op.create_unique_constraint(None, 'purchases', ['payment_id'])
    # ### end Alembic commands ###
```

**Как работает функция**:

1.  Функция `upgrade` выполняет миграцию базы данных, добавляя столбец `payment_type` в таблицу `purchases` и создавая уникальный индекс для столбца `payment_id`.

2.  Внутри функции происходят следующие действия и преобразования:

    *   Добавление столбца `payment_type` в таблицу `purchases` с использованием `op.add_column`.
    *   Создание уникального ограничения (индекса) для столбца `payment_id` в таблице `purchases` с использованием `op.create_unique_constraint`.

### `downgrade`

```python
def downgrade() -> None:
    """
    Отменяет изменения, внесенные функцией `upgrade`.

    Args:
        None

    Returns:
        None

    Raises:
        Exception: В случае ошибки при отмене изменений в базе данных.
    """
    # ### commands auto generated by Alembic - please adjust! ###
    # Удаляет уникальное ограничение для столбца 'payment_id' в таблице 'purchases'
    op.drop_constraint(None, 'purchases', type_='unique')
    # Удаляет столбец 'payment_type' из таблицы 'purchases'
    op.drop_column('purchases', 'payment_type')
    # ### end Alembic commands ###
```

**Как работает функция**:

1.  Функция `downgrade` выполняет откат миграции базы данных, удаляя столбец `payment_type` из таблицы `purchases` и удаляя уникальный индекс для столбца `payment_id`.

2.  Внутри функции происходят следующие действия и преобразования:

    *   Удаление уникального ограничения для столбца `payment_id` в таблице `purchases` с использованием `op.drop_constraint`.
    *   Удаление столбца `payment_type` из таблицы `purchases` с использованием `op.drop_column`.
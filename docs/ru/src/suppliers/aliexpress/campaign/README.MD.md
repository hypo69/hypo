# Модуль `campaign`

## Обзор

Модуль `campaign` предназначен для управления процессом создания и публикации рекламных кампаний на Facebook. Он включает в себя функциональность для инициализации параметров кампании (название, язык, валюта), создания структуры каталогов, сохранения конфигураций для новой кампании, сбора и сохранения данных о продуктах через `ali` или `html`, генерации рекламных материалов, проверки кампании и публикации её на Facebook.

## Подробнее

Этот модуль является ключевым компонентом системы, отвечающим за автоматизацию процесса создания и управления рекламными кампаниями. Он обеспечивает гибкость в настройке кампаний, позволяя указывать язык, валюту и категории товаров, а также предоставляет инструменты для сбора данных о продуктах и создания рекламных материалов.

## Классы

В данном разделе отсутствуют классы. Описана структура и принцип работы модуля.

## Функции

В данном разделе отсутствуют функции. Описана структура и принцип работы модуля.

## Как работает модуль

1.  **Инициализация деталей кампании**: Определяется название кампании, язык и валюта.
2.  **Создание каталогов кампании и категорий**: Создаются необходимые каталоги или файлы для кампании.
3.  **Сохранение конфигурации кампании**: Сохраненные детали инициализированной кампании.
4.  **Сбор данных о продукте**: Собираются данные, относящиеся к продуктам, которые будут продвигаться в рамках кампании.
5.  **Сохранение данных о продукте**: Собранные данные о продукте сохраняются.
6.  **Создание рекламных материалов**: Генерируются или выбираются графика, баннеры и другие рекламные материалы.
7.  **Обзор кампании**: Процесс проверки подтверждает, что компоненты кампании готовы.
8.  **Кампания готова?**: Проверка для определения, является ли кампания полной и готовой к публикации.
9.  **Публикация кампании**: Кампания публикуется на платформе, готовая к маркетинговым усилиям.
10. **Конец**: Процесс создания кампании завершен.

```mermaid
flowchart TD
    A[Start: Создание рекламной кампании для размещения на Facebook] --> B[Инициализация названия, языка и валюты кампании]
    B --> C[Создание каталогов кампании и категорий]
    C --> D[Сохранение конфигурации кампании]
    D --> E[Сбор данных о продукте]
    E --> F[Сохранение данных о продукте]
    F --> G[Создание рекламных материалов]
    G --> H[Проверка кампании]
    H --> I{Кампания готова?}
    I -- Да --> J[Публикация кампании на Facebook]
    I -- Нет --> H
    J --> K[Конец: Завершение создания рекламной кампании]
```

## Примеры

1.  Запуск процесса создания рекламной кампании для размещения на Facebook.
2.  Определение названия кампании как "Летняя распродажа", языка как "Русский", валюты как "RUB".
3.  Создание структуры папок в файловой системе для хранения активов кампании.
4.  Запись данных в базу данных или файл конфигурации.
5.  Получение идентификаторов продуктов, описаний, изображений и цен из системы инвентаризации.
6.  Запись данных в таблицу базы данных, посвященную продуктам кампании.
7.  Создание изображений и описаний, адаптированных для привлечения клиентов.
8.  Оценка качества и полноты всех компонентов кампании человеком или системой.
9.  Логический флаг сигнализирует "Да", если все на месте, в противном случае "Нет", вызывая возврат к предыдущему шагу для внесения исправлений.
10. Вызовы API для публикации кампании на соответствующей платформе.
11. Процесс создания кампании завершен.

## Редактирование кампании

```mermaid
graph LR
    A[Ввод пользователя: campaign_name, language, currency] --> B{AliCampaignEditor.__init__};
    B --> C[AliPromoCampaign.__init__];
    C --> D[Инициализация: конструктор AliCampaignEditor];
    D --> E[AliCampaignEditor];
    
    E --> F[delete_product: Проверка наличия партнерской ссылки];
    F --> G[read_text_file sources.txt: Чтение списка продуктов];
    G --> H[Iterate & check product_id: Цикл по списку продуктов];
    H -- Совпадение --> I[remove & save: Удаление продукта, если найдено совпадение];
    H -- Нет совпадения --> J[rename product file: Переименование файла продукта, если нет совпадения];
    
    E --> K[update_product: Обновление деталей продукта];
    K --> L[Вызов dump_category_products_files: Обновление категории с новым продуктом];
    
    E --> M[update_campaign: Обновление свойств кампании, таких как описание];
    M --> N[Обновление параметров кампании];
    
    E --> O[update_category: Обновление категории в JSON-файле];
    O --> P[j_loads JSON file: Чтение данных категории];
    P --> Q[Update category: Обновление данных категории];
    Q --> R[j_dumps JSON file: Запись обновленной категории в файл];
    
    E --> S[get_category: Получение категории по имени];
    S --> T[Проверка существования категории];
    T -- Найдено --> U[Return SimpleNamespace: Возврат деталей категории];
    T -- Не найдено --> V[Log warning: Категория не найдена в кампании];
    
    E --> W[list_categories: Перечисление всех категорий в кампании];
    W --> X[Check category attribute: Проверка существования категорий в кампании];
    X -- Найдено --> Y[Return category list: Список названий категорий];
    X -- Не найдено --> Z[Log warning: Нет категорий в кампании];
    
    E --> AA[get_category_products: Получение продуктов для категории];
    AA --> AB[Get category path: Построение пути к продуктам категории];
    AB --> AC[Get JSON filenames: Получение всех JSON-файлов продуктов];
    AC --> AD[Read JSON files: Загрузка данных о продуктах];
    AD --> AE[Create SimpleNamespace: Преобразование данных о продуктах в объекты];
    AE --> AF[Return products: Возврат списка продуктов];
    AC -- Нет JSON-файлов --> AG[Log error: Файлы не найдены];
    AG --> AH[Process category: Запуск подготовки продуктов категории];

    E --> AI[Другие методы];

```

## Подготовка кампании

```mermaid
flowchart TD
    A[Начало] --> B{Обработать все кампании?}
    B -->|Да| C[Обработать все кампании]
    B -->|Нет| D[Обработать конкретную кампанию]
    
    C --> E{Предоставлен язык и валюта?}
    E -->|Да| F[Обработать каждую кампанию с предоставленным языком и валютой]
    E -->|Нет| G[Обработать все локали для каждой кампании]
    
    D --> H{Указаны категории?}
    H -->|Да| I[Обработать конкретные категории для кампании]
    H -->|Нет| J[Обработать всю кампанию]
    
    F --> K[Обработать категорию кампании]
    G --> L[Обработать кампанию для всех локалей]
    I --> K
    J --> L
    
    K --> M[Возврат]
    L --> M
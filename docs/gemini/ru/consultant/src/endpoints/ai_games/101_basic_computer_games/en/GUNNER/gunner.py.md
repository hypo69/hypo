# Анализ кода модуля `gunner.py`

**Качество кода**
9
-  Плюсы
    - Код хорошо структурирован и понятен.
    - Используются осмысленные имена переменных.
    - Присутствуют комментарии, объясняющие логику работы кода.
    - Имеется подробное описание игры, правил и алгоритма в начале файла.
    - Присутствует блок-схема, визуализирующая игровой процесс.
    - Используется обработка исключений для ввода данных.
    - Код работает корректно.
-  Минусы
    - Отсутствует docstring в начале файла.
    - Комментарии не соответствуют стандарту reStructuredText (RST).
    - Не используется `src.utils.jjson` для чтения файлов (в данном случае это не требуется, но отмечу на будущее).
    - Не используется `from src.logger.logger import logger` для логирования ошибок.

**Рекомендации по улучшению**

1. Добавить docstring в начале файла, описывающий назначение модуля.
2. Переписать все комментарии в формате reStructuredText (RST).
3.  Использовать  `from src.logger.logger import logger` для логирования ошибок.
4. Избегать избыточного использования стандартных блоков `try-except`.
5. Код для проверки на попадание цели, в данном случае, работает с фиксированной точностью. Необходимо сделать ее конфигурируемой.
6. Желательно вынести все константы в константы файла, или вынести в файл конфигурации.

**Оптимизированный код**

```python
"""
Модуль для реализации игры "GUNNER"
===================================

Игра "GUNNER" - это симуляция стрельбы по мишени. Игрок вводит угол выстрела и его скорость,
а компьютер рассчитывает, попадет ли снаряд в цель. Игрок имеет 5 попыток и после каждой попытки,
получает подсказку: "TOO LOW", "TOO HIGH" или "BINGO".

Описание игры
-------------
- Компьютер устанавливает случайное расстояние до цели от 100 до 1000 футов.
- Игрок вводит угол выстрела в градусах (от 0 до 90) и скорость выстрела в футах в секунду.
- Компьютер рассчитывает дальность полета снаряда по формуле:
  дальность = (скорость^2 * sin(2 * угол)) / 32.2
- Компьютер сравнивает дальность полета с расстоянием до цели и сообщает результат.
- Игрок имеет 5 попыток.
- Игра заканчивается после 5 попыток или если игрок попал в цель.

Алгоритм
--------
1. Установить количество попыток равным 5.
2. Сгенерировать случайное расстояние до цели в диапазоне от 100 до 1000.
3. Начать цикл, пока не закончатся попытки:
    3.1. Запросить у игрока угол выстрела и скорость выстрела.
    3.2. Рассчитать дальность полета снаряда.
    3.3. Если дальность полета равна расстоянию до цели, вывести "BINGO" и завершить игру.
    3.4. Если дальность полета меньше расстояния до цели, вывести "TOO LOW".
    3.5. Если дальность полета больше расстояния до цели, вывести "TOO HIGH".
    3.6. Уменьшить количество оставшихся попыток.
4. Если после 5 попыток цель не поражена, вывести сообщение о проигрыше.
5. Конец игры.

Блок-схема
----------
.. mermaid::
    flowchart TD
        Start["Начало"] --> InitializeVariables["<p align='left'>Инициализация переменных:\n    <code><b>\n    attemptsLeft = 5\n    targetDistance = random(100, 1000)\n    </b></code></p>"]
        InitializeVariables --> LoopStart{"Начало цикла: пока <code><b>attemptsLeft > 0</b></code>"}
        LoopStart -- Да --> InputAngleSpeed["Ввод угла (<code><b>angle</b></code>) и скорости (<code><b>speed</b></code>)"]
        InputAngleSpeed --> CalculateDistance["<p align='left'>Расчет дальности:\n        <code><b>\n        distance = (speed<sup>2</sup> * sin(2 * angle * pi / 180)) / 32.2\n        </b></code></p>"]
        CalculateDistance --> CheckHit{"Проверка: <code><b>distance == targetDistance</b></code>?"}
        CheckHit -- Да --> OutputBingo["Вывод сообщения: <b>BINGO</b>"]
        OutputBingo --> End["Конец"]
        CheckHit -- Нет --> CheckLow{"Проверка: <code><b>distance < targetDistance</b></code>?"}
        CheckLow -- Да --> OutputLow["Вывод сообщения: <b>TOO LOW</b>"]
        OutputLow --> DecreaseAttempts["<code><b>attemptsLeft = attemptsLeft - 1</b></code>"]
        DecreaseAttempts --> LoopStart
        CheckLow -- Нет --> OutputHigh["Вывод сообщения: <b>TOO HIGH</b>"]
        OutputHigh --> DecreaseAttempts
        LoopStart -- Нет --> OutputLose["Вывод сообщения: <b>YOU LOSE</b>"]
        OutputLose --> End

Легенда
-------
    Start - Начало программы.
    InitializeVariables - Инициализация переменных: attemptsLeft (количество попыток) устанавливается в 5,
        а targetDistance (расстояние до цели) генерируется случайным образом от 100 до 1000.
    LoopStart - Начало цикла, который продолжается, пока количество оставшихся попыток (attemptsLeft) больше 0.
    InputAngleSpeed - Запрос у пользователя ввода угла выстрела (angle) и скорости (speed).
    CalculateDistance - Расчет дальности полета снаряда (distance) по формуле.
    CheckHit - Проверка, равно ли вычисленное расстояние (distance) заданному расстоянию до цели (targetDistance).
    OutputBingo - Вывод сообщения "BINGO", если дальность равна расстоянию до цели.
    End - Конец программы.
    CheckLow - Проверка, меньше ли дальность полета (distance) расстояния до цели (targetDistance).
    OutputLow - Вывод сообщения "TOO LOW", если дальность меньше цели.
    OutputHigh - Вывод сообщения "TOO HIGH", если дальность больше цели.
    DecreaseAttempts - Уменьшение количества оставшихся попыток на 1.
    OutputLose - Вывод сообщения "YOU LOSE", если после 5 попыток цель не поражена.
"""
import random
import math
from src.logger.logger import logger  # подключаем логгер

# константы
MAX_ATTEMPTS = 5
MIN_TARGET_DISTANCE = 100
MAX_TARGET_DISTANCE = 1000
ACCURACY = 0.01

# Инициализация количества попыток
attempts_left = MAX_ATTEMPTS  # Количество попыток, заданное как константа

# Генерация случайного расстояния до цели от 100 до 1000 футов
target_distance = random.randint(MIN_TARGET_DISTANCE, MAX_TARGET_DISTANCE) # минимальное и максимальное расстояние до цели задано константами

# Основной игровой цикл
while attempts_left > 0:
    # Запрашиваем ввод угла и скорости выстрела
    try:
        # код запрашивает у пользователя угол выстрела и преобразует его в число с плавающей точкой
        angle = float(input('Введите угол выстрела в градусах (0-90): '))
        # код запрашивает у пользователя скорость выстрела и преобразует ее в число с плавающей точкой
        speed = float(input('Введите скорость выстрела в футах в секунду: '))
    except ValueError as e:
        # если ввод не числовой, регистрируем ошибку и переходим к следующей итерации цикла
        logger.error('Неверный ввод. Ожидается число.', exc_info=e)
        print('Пожалуйста, введите числовые значения.')
        continue

    # Проверка ввода угла
    if not (0 <= angle <= 90):
        # если угол вне допустимого диапазона, сообщаем об ошибке и переходим к следующей итерации цикла
        print('Угол должен быть в диапазоне от 0 до 90 градусов.')
        continue

    # Расчет дальности полета снаряда
    # код преобразует угол из градусов в радианы
    angle_radians = math.radians(angle)
    # код вычисляет дальность полета снаряда
    distance = (speed**2 * math.sin(2 * angle_radians)) / 32.2

    # Проверка попадания
    if abs(distance - target_distance) < ACCURACY:  # Используем небольшую погрешность для сравнения
        # если снаряд попал в цель, выводим сообщение и завершаем игру
        print('BINGO!')
        break  # Завершаем игру при попадании в цель
    elif distance < target_distance:
        # если снаряд не долетел, сообщаем об этом
        print('TOO LOW')  # Сообщаем, что снаряд не долетел
    else:
        # если снаряд перелетел, сообщаем об этом
        print('TOO HIGH')  # Сообщаем, что снаряд перелетел

    # Уменьшаем количество оставшихся попыток
    attempts_left -= 1

# Вывод сообщения о проигрыше, если попытки закончились
if attempts_left == 0:
    # если все попытки исчерпаны, выводим сообщение о проигрыше
    print('YOU LOSE')

"""
Объяснение кода:
1. **Импорт модулей**:
   - `import random`: Импортирует модуль `random`, для генерации случайного расстояния до цели.
   - `import math`: Импортирует модуль `math`, для математических вычислений (синус и перевод градусов в радианы).
   - `from src.logger.logger import logger`: Импортирует логгер для регистрации ошибок.

2. **Инициализация констант**:
   - `MAX_ATTEMPTS = 5`: Максимальное количество попыток.
   - `MIN_TARGET_DISTANCE = 100`: Минимальное расстояние до цели.
   - `MAX_TARGET_DISTANCE = 1000`: Максимальное расстояние до цели.
   - `ACCURACY = 0.01`: Точность сравнения расстояний.

3. **Инициализация переменных**:
   - `attempts_left = MAX_ATTEMPTS`:  Количество оставшихся попыток.
   - `target_distance = random.randint(MIN_TARGET_DISTANCE, MAX_TARGET_DISTANCE)`:  Расстояние до цели.

4. **Основной игровой цикл `while attempts_left > 0:`**:
   - Цикл выполняется, пока у игрока есть оставшиеся попытки.

5. **Ввод данных**:
   - `try...except ValueError`: Блок try-except обрабатывает возможные ошибки ввода.
   - `angle = float(input('Введите угол выстрела в градусах (0-90): '))`: Запрашивает угол и преобразует его в float.
   - `speed = float(input('Введите скорость выстрела в футах в секунду: '))`: Запрашивает скорость и преобразует ее в float.
   - `logger.error('Неверный ввод. Ожидается число.', exc_info=e)`: Логирует ошибку при неверном вводе.

6. **Проверка ввода угла**:
   - `if not (0 <= angle <= 90):`: Проверяет, находится ли введенный угол в допустимом диапазоне.
   - `print('Угол должен быть в диапазоне от 0 до 90 градусов.')`: Выводит сообщение об ошибке, если угол введен неверно.
   - `continue`: Переходит к следующей итерации цикла.

7. **Расчет дальности полета**:
   - `angle_radians = math.radians(angle)`: Преобразует угол в радианы.
   - `distance = (speed**2 * math.sin(2 * angle_radians)) / 32.2`: Вычисляет дальность полета снаряда.

8. **Проверка попадания**:
    - `if abs(distance - target_distance) < ACCURACY:`: Проверяет, попал ли снаряд в цель с заданной точностью.
    - `print('BINGO!')`: Выводит сообщение о попадании.
    - `break`: Завершает игру при попадании.
    - `elif distance < target_distance:`: Проверяет, если снаряд не долетел.
    - `print('TOO LOW')`: Выводит сообщение, что снаряд не долетел.
    - `else:`: Если снаряд перелетел.
    - `print('TOO HIGH')`: Выводит сообщение, что снаряд перелетел.

9. **Уменьшение количества попыток**:
    - `attempts_left -= 1`: Уменьшает количество оставшихся попыток на 1.

10. **Вывод сообщения о проигрыше**:
    - `if attempts_left == 0:`: Проверяет, закончились ли попытки.
    - `print('YOU LOSE')`: Выводит сообщение о проигрыше.
"""
```
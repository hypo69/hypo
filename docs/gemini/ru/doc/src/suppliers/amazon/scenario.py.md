# Модуль `scenario.py`

## Обзор

Модуль `scenario.py` предназначен для сбора данных о товарах со страниц категорий поставщика Amazon с использованием веб-драйвера. Каждый поставщик имеет свой собственный сценарий обработки категорий. Модуль включает функции для сбора списка категорий со страниц продавца, сбора списка товаров со страницы категории и итерации по списку товаров для обработки их полей.

## Подробнее

Этот модуль является частью процесса сбора данных о товарах с сайта Amazon. Он использует веб-драйвер для навигации по страницам категорий и извлечения информации о товарах. Модуль собирает список категорий и товаров, а затем передает управление в `grab_product_page()` для обработки полей товара.

## Функции

### `get_list_products_in_category`

```python
def get_list_products_in_category(s) -> list[str,str,None]:
    """Возвращает список URL товаров со страницы категории.

    Args:
        s: Supplier - экземпляр класса Supplier.

    Returns:
        list[str,str,None]: Список URL товаров или None в случае неудачи.
    """
```

**Назначение**: Функция `get_list_products_in_category` извлекает список URL-адресов товаров со страницы категории поставщика. Она также обрабатывает пролистывание страниц категорий, если это необходимо.

**Параметры**:
- `s`: Экземпляр класса `Supplier`, содержащий информацию о поставщике и необходимые инструменты, такие как веб-драйвер и локаторы.

**Возвращает**:
- `list[str,str,None]`: Список URL-адресов товаров, найденных на странице категории. Если URL не найдены, возвращается `None`.

**Как работает функция**:
1. **Инициализация**:
   - Функция принимает экземпляр класса `Supplier` в качестве аргумента.
   - Получает доступ к драйверу и локаторам из экземпляра `Supplier`.
   - Выполняет проверку наличия локаторов.
2. **Прокрутка страницы**:
   - Выполняет прокрутку страницы для загрузки всех элементов, используя метод `d.scroll()`.
3. **Извлечение ссылок на товары**:
   - Использует метод `d.execute_locator(l['product_links'])` для извлечения списка ссылок на товары, используя локаторы, определенные в `s.locators['category']`.
4. **Обработка результатов**:
   - Проверяет, является ли результат строкой или списком. Если это строка, преобразует ее в список.
   - Выводит информационное сообщение о количестве найденных товаров, используя `logger.info()`.
5. **Логика проверки товара в базе данных (закомментирована)**:
   - Присутствует закомментированный код, который предполагает проверку наличия товара в базе данных магазина PrestaShop. Этот код извлекает `asin` (Amazon Standard Identification Number) из URL товара и формирует `sku` (Stock Keeping Unit) для проверки.
   - Функция проверяет отсутствие товара в базе данных с использованием `PrestaShopProduct.check(_sku) == False`. Если товар отсутствует, он продолжает работу. Если товар присутствует, он пропускает его.
6. **Возврат результата**:
   - Возвращает список URL-адресов товаров.

**ASCII Flowchart**:

```
    A[Начало]
    |
    B[Получение драйвера и локаторов из Supplier]
    |
    C[Проверка наличия локаторов]
    |
    D[Прокрутка страницы]
    |
    E[Извлечение ссылок на товары с использованием локаторов]
    |
    F[Преобразование результата в список, если это строка]
    |
    G[Вывод информационного сообщения о количестве найденных товаров]
    |
    H[Возврат списка URL-адресов товаров]
    |
    I[Конец]
```

**Примеры**:

Пример вызова функции:

```python
from unittest.mock import MagicMock
from src.logger.logger import logger

# Создаем мок-объект Supplier
supplier_mock = MagicMock()
supplier_mock.driver = MagicMock()
supplier_mock.locators = {
    'category': {
        'product_links': {
            'by': 'css',
            'selector': '.product-link',
            'attribute': 'href'
        }
    }
}
supplier_mock.driver.execute_locator.return_value = ['https://example.com/product1', 'https://example.com/product2']

# Вызываем функцию
product_links = get_list_products_in_category(supplier_mock)
print(product_links)

# Вывод: ['https://example.com/product1', 'https://example.com/product2']

```
В этом примере создается мок-объект `Supplier`, имитирующий возвращение списка URL-адресов товаров. Функция `get_list_products_in_category` вызывается с этим мок-объектом, и возвращенный список URL-адресов выводится на экран.
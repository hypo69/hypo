## Ответ на Задачу No 364: Сумма подпоследовательностей с максимальной суммой

### 1. Анализ задачи и решение
**Понимание задачи:**
* Задача требует найти сумму сумм всех подпоследовательностей с максимальной суммой для последовательности чисел от 1 до n.
* Подпоследовательность с максимальной суммой - это любая подпоследовательность, сумма элементов которой не меньше, чем сумма элементов любой другой подпоследовательности.
* Для последовательности (1, 2, ..., n) подпоследовательности с максимальной суммой это все подпоследовательности, которые содержат n. 
* $S(n)$ - сумма сумм всех таких подпоследовательностей
* Нам нужно найти $S(10^7)$ по модулю $10^9 + 7$.

**Решение:**
1. **Анализ максимальных подпоследовательностей:** Для последовательности (1, 2, ..., n) подпоследовательности с максимальной суммой - это все подпоследовательности, которые обязательно включают n. Любая подпоследовательность, не включающая n, будет иметь сумму меньше, чем подпоследовательность, включающая n и возможно еще какие-либо элементы. Следовательно, подпоследовательности с максимальной суммой могут содержать любое подмножество чисел от 1 до n-1, дополненное числом n. 
2. **Сумма подпоследовательностей:** Рассмотрим подпоследовательности, содержащие `n`.  Каждое из чисел от `1` до `n-1` может входить или не входить в подпоследовательность. Это дает $2^{n-1}$ вариантов. 
3. **Сумма всех максимальных подпоследовательностей:** Каждая подпоследовательность содержит `n`, поэтому `n` входит в сумму  $2^{n-1}$ раз. Сумма всех элементов от 1 до `n-1`  будет входить в общую сумму $2^{n-2}$ раз, потому что каждое из этих чисел может быть включено или нет в подпоследовательность. Таким образом, сумма подпоследовательностей с максимальной суммой равна $n * 2^{n-1} + 2^{n-2} * \sum_{i=1}^{n-1} i$. Сумма чисел от 1 до n-1 равна (n-1)*n/2.  
   Поэтому, $S(n) = n * 2^{n-1} + 2^{n-2} * (n-1) * n / 2 = n * 2^{n-1} + (n-1)*n*2^{n-3}$. 
4. **Упрощенная формула:** $S(n) = n*2^{n-1} + (n^2 - n) * 2^{n-3} = n * 2^{n-3} * (4 + n - 1) = n * (n+3) * 2^{n-3}$.

5. **Модульная арифметика:** Так как результат нужно вернуть по модулю $10^9 + 7$, необходимо вычислять все промежуточные результаты по модулю, используя быстрое возведение в степень для $2^{n-3}$.

### 2. Алгоритм решения
1. Начать.
2. Задать `n` равным $10^7$.
3. Определить константу `MOD` равной $10^9 + 7$.
4. Вычислить $2^{n-3}$ по модулю `MOD`, используя быстрое возведение в степень по модулю.
5. Вычислить $S(n) = n * (n+3) * 2^{n-3}$ по модулю `MOD`.
6. Вернуть $S(n)$.
7. Конец.

### 3. Реализация на Python 3.12
```python
def power(base, exp, mod):
    """
    Calculates (base^exp) % mod using binary exponentiation.

    Args:
        base: The base number.
        exp: The exponent.
        mod: The modulus.

    Returns:
        (base^exp) % mod
    """
    res = 1
    base %= mod
    while exp > 0:
        if exp % 2 == 1:
            res = (res * base) % mod
        base = (base * base) % mod
        exp //= 2
    return res

def solve():
    n = 10**7
    MOD = 10**9 + 7
    pow2_n_minus_3 = power(2, n - 3, MOD)
    result = (n * (n + 3) % MOD * pow2_n_minus_3) % MOD
    return result

# Пример использования:
result = solve()
print(result)

```

### 4. Блок-схема в формате mermaid
```mermaid
flowchart TD
    Start((Начало)) --> InputN((Ввод n = 10^7))
    InputN --> DefineMod((Определить MOD = 10^9 + 7))
    DefineMod --> CalculatePower((Вычислить 2^(n-3) mod MOD))
    CalculatePower --> CalculateS((Вычислить S(n) = n*(n+3)*2^(n-3) mod MOD))
    CalculateS --> OutputResult((Вывести S(n)))
    OutputResult --> End((Конец))
```

**Легенда:**
* **Start, End:** Начало и конец алгоритма.
* **Input n:** Задаем значение n равным $10^7$.
* **Define MOD:** Определяем константу MOD равную $10^9 + 7$.
* **Calculate Power:** Вычисляем $2^{n-3}$ по модулю MOD, используя быстрое возведение в степень.
* **Calculate S:** Вычисляем $S(n)$ по формуле $n * (n+3) * 2^{n-3}$ по модулю MOD.
* **Output Result:** Выводим результат $S(n)$.

# Модуль `browser_agent.py`

## Обзор

Модуль `browser_agent.py` предназначен для создания и управления AI-агентами, способными искать информацию в интернете (например, в Google) и анализировать содержимое веб-страниц. Он предоставляет класс `AIBrowserAgent`, который упрощает настройку и запуск таких агентов.

## Подробней

Этот модуль позволяет автоматизировать задачи, требующие доступа к информации из интернета, такие как поиск аналогов продуктов или ответы на вопросы на основе анализа веб-страниц. Класс `AIBrowserAgent` использует библиотеку `browser_use` для взаимодействия с браузером и `langchain_openai` для интеграции с языковыми моделями OpenAI.

## Классы

### `AIBrowserAgent`

**Описание**: Класс для создания агента, использующего браузер для выполнения задач.

**Как работает класс**:
Класс `AIBrowserAgent` инициализируется с использованием ключа API OpenAI, названия модели, поисковой системы и, опционально, пользовательского драйвера браузера. Он предоставляет методы для выполнения задач, таких как поиск аналогов продуктов и ответы на вопросы. Внутри класса используются библиотеки `browser_use` и `langchain_openai` для взаимодействия с браузером и языковой моделью соответственно.

**Методы**:
- `__init__`: Инициализирует класс `AIBrowserAgent`.
- `run_task`: Запускает агента для выполнения заданной задачи.
- `find_product_alternatives`: Ищет в сети аналоги для продукта по заданному URL или SKU.
- `ask`: Синхронная обертка для асинхронного метода `ask_async`.
- `ask_async`: Отвечает на заданный вопрос, используя поиск в интернете, если это необходимо.

**Параметры**:
- `api_key` (str): Ключ API OpenAI.
- `model_name` (str): Название языковой модели OpenAI для использования (по умолчанию "gpt-4o-mini").
- `search_engine` (str): Поисковая система для использования (по умолчанию "google").
- `custom_driver` (Optional[object], optional): Опциональный пользовательский драйвер WebDriver. По умолчанию `None`.

**Примеры**
```python
# Пример создания экземпляра класса AIBrowserAgent
api_key: str = None  # Замените на ваш фактический метод получения API-ключа
model_name: str = 'gpt-4o-mini'

agent = AIBrowserAgent(api_key=api_key, model_name=model_name)

# Пример поиска аналогов продукта
sku: str = '1493001'
product_url: str = None
alternatives = await agent.find_product_alternatives(product_url=product_url, sku=sku)
if alternatives:
    print("Найденные аналоги:")
    print(alternatives)
else:
    print("Не удалось найти аналоги.")
```

## Функции

### `run_task`

```python
async def run_task(self, task_prompt: str) -> Optional[str]:
    """
    Запускает агента для выполнения заданной задачи.

    Args:
        task_prompt (str): Текст задачи для агента.

    Returns:
        Optional[str]: Результат выполнения задачи в виде строки, или None в случае ошибки.
    """
    ...
```

**Описание**: Запускает агента для выполнения заданной задачи.

**Как работает функция**:
Функция `run_task` принимает текстовое описание задачи (`task_prompt`), создает экземпляр класса `Agent` из библиотеки `browser_use`, передавая ему задачу, языковую модель и, опционально, пользовательский драйвер браузера. Затем она запускает агента и возвращает результат выполнения задачи. В случае возникновения ошибки функция логирует её и возвращает `None`.

**Параметры**:
- `task_prompt` (str): Текст задачи для агента.

**Возвращает**:
- `Optional[str]`: Результат выполнения задачи в виде строки, или `None` в случае ошибки.

**Вызывает исключения**:
- `Exception`: В случае возникновения ошибки во время выполнения задачи.

**Примеры**:
```python
# Пример вызова функции run_task
api_key: str = None
model_name: str = 'gpt-4o-mini'
agent = AIBrowserAgent(api_key=api_key, model_name=model_name)
task_prompt = "Найди информацию о последних новостях в мире."
result = await agent.run_task(task_prompt)
if result:
    print("Результат выполнения задачи:")
    print(result)
else:
    print("Не удалось выполнить задачу.")
```

### `find_product_alternatives`

```python
async def find_product_alternatives(self, product_url: Optional[str] = None,
                                    sku: Optional[str] = None) -> Optional[str]:
    """
    Ищет в сети аналоги для продукта по заданному URL или SKU.

    Args:
        product_url (Optional[str], optional): URL продукта, для которого нужно найти аналоги (опционально). По умолчанию `None`.
        sku (Optional[str], optional): SKU продукта, для которого нужно найти аналоги (опционально). По умолчанию `None`.

    Returns:
        Optional[str]: Строку с описанием найденных аналогов, или None в случае ошибки.
    """
    ...
```

**Описание**: Ищет в сети аналоги для продукта по заданному URL или SKU.

**Как работает функция**:
Функция `find_product_alternatives` принимает URL продукта (`product_url`) или SKU (`sku`) в качестве аргументов. Если указан URL, функция формирует поисковый запрос, добавляя к нему слово "аналоги". Если указан SKU, функция формирует поисковый запрос, добавляя к нему слова "аналоги товара с артикулом". Затем функция кодирует поисковый запрос для использования в URL и формирует URL для поиска в Google или DuckDuckGo, в зависимости от значения параметра `search_engine`. После этого функция формирует текстовое описание задачи (`task_prompt`) и вызывает метод `run_task` для выполнения задачи поиска аналогов.

**Параметры**:
- `product_url` (Optional[str], optional): URL продукта, для которого нужно найти аналоги (опционально). По умолчанию `None`.
- `sku` (Optional[str], optional): SKU продукта, для которого нужно найти аналоги (опционально). По умолчанию `None`.

**Возвращает**:
- `Optional[str]`: Строку с описанием найденных аналогов, или `None` в случае ошибки.

**Примеры**:
```python
# Пример вызова функции find_product_alternatives
api_key: str = None
model_name: str = 'gpt-4o-mini'
agent = AIBrowserAgent(api_key=api_key, model_name=model_name)
product_url = "https://www.apple.com/iphone-14/"
alternatives = await agent.find_product_alternatives(product_url=product_url)
if alternatives:
    print("Найденные аналоги:")
    print(alternatives)
else:
    print("Не удалось найти аналоги.")
```

### `ask`

```python
def ask(self, q: str) -> Optional[str]:
    """
    Синхронная обертка для асинхронного метода ask_async.  Не рекомендуется к использованию.
    """
    ...
```

**Описание**: Синхронная обертка для асинхронного метода `ask_async`. Не рекомендуется к использованию.

**Как работает функция**:
Функция `ask` принимает вопрос (`q`) в качестве аргумента, формирует текстовое описание задачи (`task_prompt`) и вызывает метод `run_task` для выполнения задачи ответа на вопрос с использованием поиска в интернете.

**Параметры**:
- `q` (str): Вопрос, на который нужно ответить.

**Возвращает**:
- `Optional[str]`: Ответ на вопрос в виде строки, или `None` в случае ошибки.

**Примеры**:
```python
# Пример вызова функции ask
api_key: str = None
model_name: str = 'gpt-4o-mini'
agent = AIBrowserAgent(api_key=api_key, model_name=model_name)
question = "Какая сейчас погода в Москве?"
answer = agent.ask(question)
if answer:
    print("Ответ на вопрос:")
    print(answer)
else:
    print("Не удалось получить ответ на вопрос.")
```

### `ask_async`

```python
async def ask_async(self, q: str) -> Optional[str]:
    """
    Отвечает на заданный вопрос, используя поиск в интернете, если это необходимо.

    Args:
        q (str): Вопрос, на который нужно ответить.

    Returns:
        Optional[str]: Ответ на вопрос в виде строки, или None в случае ошибки.
    """
    ...
```

**Описание**: Отвечает на заданный вопрос, используя поиск в интернете, если это необходимо.

**Как работает функция**:
Функция `ask_async` принимает вопрос (`q`) в качестве аргумента, формирует текстовое описание задачи (`task_prompt`) и вызывает метод `run_task` для выполнения задачи ответа на вопрос с использованием поиска в интернете.

**Параметры**:
- `q` (str): Вопрос, на который нужно ответить.

**Возвращает**:
- `Optional[str]`: Ответ на вопрос в виде строки, или `None` в случае ошибки.

**Примеры**:
```python
# Пример вызова функции ask_async
api_key: str = None
model_name: str = 'gpt-4o-mini'
agent = AIBrowserAgent(api_key=api_key, model_name=model_name)
question = "Какая сейчас погода в Москве?"
answer = await agent.ask_async(question)
if answer:
    print("Ответ на вопрос:")
    print(answer)
else:
    print("Не удалось получить ответ на вопрос.")
```

### `main`

```python
async def main():
    """
    Пример использования класса BrowserAgent.
    """
    ...
```

**Описание**: Пример использования класса `AIBrowserAgent`.

**Как работает функция**:
Функция `main` демонстрирует пример использования класса `AIBrowserAgent` для поиска аналогов продукта и ответа на вопрос с использованием поиска в интернете. Она создает экземпляр класса `AIBrowserAgent`, вызывает методы `find_product_alternatives` и `ask_async` и выводит результаты в консоль.

**Примеры**:
```python
# Пример вызова функции main
asyncio.run(main())
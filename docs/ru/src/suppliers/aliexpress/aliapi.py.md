# Модуль `aliapi.py`

## Обзор

Модуль `aliapi.py` предоставляет класс `AliApi`, который является пользовательским API для выполнения операций с AliExpress. Этот класс расширяет функциональность базового класса `AliexpressApi` и включает методы для получения информации о продуктах, создания партнерских ссылок, а также интеграцию с базами данных категорий и кампаний.

## Подробней

Модуль предназначен для упрощения взаимодействия с API AliExpress, предоставляя удобные методы для получения данных о товарах и создания партнерских ссылок. Класс `AliApi` инициализируется с использованием учетных данных AliExpress и предоставляет методы для получения информации о продуктах, а также для создания партнерских ссылок. Модуль также включает интеграцию с базами данных категорий и кампаний, что позволяет эффективно управлять данными, полученными с AliExpress.

## Классы

### `AliApi`

**Описание**:
Класс `AliApi` представляет собой пользовательский API для выполнения операций с AliExpress. Он наследуется от класса `AliexpressApi` и добавляет функциональность для работы с категориями, кампаниями и получения партнерских ссылок.

**Как работает класс**:
1.  **Инициализация**: При инициализации класса `AliApi` происходит получение учетных данных AliExpress из глобальных настроек (`gs.credentials.aliexpress`). Эти данные включают `api_key`, `secret` и `tracking_id`. Затем вызывается конструктор родительского класса `AliexpressApi` для инициализации базовых параметров API.
2.  **Управление базами данных**: Класс включает менеджеры баз данных `CategoryManager` и `ProductCampaignsManager` для работы с категориями товаров и кампаниями. Эти менеджеры позволяют взаимодействовать с базами данных для получения и обновления информации.
3.  **Получение информации о продуктах**: Метод `retrieve_product_details_as_dict` позволяет получать подробную информацию о продуктах по их идентификаторам. Он вызывает метод `retrieve_product_details` родительского класса и преобразует полученные данные в формат словаря.
4.  **Создание партнерских ссылок**: Метод `get_affiliate_links` позволяет создавать партнерские ссылки для указанных товаров. Он вызывает метод `get_affiliate_links` родительского класса для генерации ссылок.

**Методы**:

*   `__init__`: Инициализирует экземпляр класса `AliApi`.
*   `retrieve_product_details_as_dict`: Получает подробную информацию о продуктах в формате словаря.
*   `get_affiliate_links`: Получает партнерские ссылки для указанных товаров.

## Функции

### `__init__`

```python
def __init__(self, language: str = 'en', currency: str = 'usd', *args, **kwargs):
    """ Инициализирует экземпляр класса AliApi.

    Args:
        language (str): Язык для API запросов. По умолчанию 'en'.
        currency (str): Валюта для API запросов. По умолчанию 'usd'.

    Как работает функция:
     1. **Получение учетных данных**:
        - Функция извлекает учетные данные AliExpress из глобальных настроек `gs.credentials.aliexpress`, включающие `api_key`, `secret` и `tracking_id`.
     2. **Инициализация базового класса**:
        - Вызывает конструктор базового класса `AliexpressApi` с полученными учетными данными, языком и валютой. Это необходимо для настройки основных параметров API.
     3. **Инициализация менеджеров баз данных**:
        -  Определяет менеджеры баз данных `CategoryManager` и `ProductCampaignsManager` для управления категориями и кампаниями товаров.

    """
```

**Параметры**:

*   `language` (str): Язык для API запросов. По умолчанию `'en'`.
*   `currency` (str): Валюта для API запросов. По умолчанию `'usd'`.
*   `*args`: Произвольные позиционные аргументы, передаваемые в конструктор базового класса.
*   `**kwargs`: Произвольные именованные аргументы, передаваемые в конструктор базового класса.

### `retrieve_product_details_as_dict`

```python
def retrieve_product_details_as_dict(self, product_ids: list) -> dict | dict | None:
    """ Отправляет список ID продуктов в AliExpress и получает список объектов SimpleNamespace с описаниями продуктов.

    Args:
        product_ids (list): Список ID продуктов.

    Returns:
        dict | None: Список данных о продуктах в виде словарей.

    Example:
        # Convert from SimpleNamespace format to dict
        namespace_list = [
            SimpleNamespace(a=1, b=2, c=3),
            SimpleNamespace(d=4, e=5, f=6),
            SimpleNamespace(g=7, h=8, i=9)
        ]

        # Convert each SimpleNamespace object to a dictionary
        dict_list = [vars(ns) for ns in namespace_list]

        # Alternatively, use the __dict__ method:
        dict_list = [ns.__dict__ for ns in namespace_list]

        # Print the list of dictionaries
        print(dict_list)

    Как работает функция:
        1. **Получение данных о продуктах в формате SimpleNamespace**:
            - Вызывает метод `retrieve_product_details` для получения подробной информации о продуктах на основе их идентификаторов.
            - Метод `retrieve_product_details` возвращает список объектов `SimpleNamespace`, каждый из которых содержит атрибуты, описывающие продукт.
        2. **Преобразование SimpleNamespace в словарь**:
            - Использует списочное включение (list comprehension) для преобразования каждого объекта `SimpleNamespace` в словарь.
            - Для преобразования используется функция `vars(ns)`, которая возвращает словарь, представляющий атрибуты объекта `ns`.
        3. **Возврат списка словарей**:
            - Возвращает список словарей, где каждый словарь содержит информацию о продукте.
    """
```

**Параметры**:

*   `product_ids` (list): Список ID продуктов.

**Возвращает**:

*   `dict | None`: Список данных о продуктах в виде словарей.

### `get_affiliate_links`

```python
def get_affiliate_links(self, links: str | list, link_type: int = 0, **kwargs) -> List[SimpleNamespace]:
    """ 
    Извлекает партнерские ссылки для указанных продуктов.

    Args:
        links (str | list): Ссылки на продукты, которые необходимо обработать.
        link_type (int, optional): Тип создаваемой партнерской ссылки. По умолчанию 0.

    Returns:
        List[SimpleNamespace]: Список объектов SimpleNamespace, содержащих партнерские ссылки.
    Как работает функция:
        1. **Вызов метода базового класса**:
            - Вызывает метод `get_affiliate_links` родительского класса `AliexpressApi` для получения партнерских ссылок.
        2. **Передача параметров**:
            - Передает параметры `links`, `link_type` и `kwargs` в метод `get_affiliate_links` родительского класса.
        3. **Возврат результата**:
            - Возвращает список объектов `SimpleNamespace`, содержащих партнерские ссылки, полученные от родительского класса.
    """
```

**Параметры**:

*   `links` (str | list): Ссылки на продукты, для которых требуется получить партнерские ссылки.
*   `link_type` (int, optional): Тип партнерской ссылки. По умолчанию `0`.
*   `**kwargs`: Дополнительные параметры, передаваемые в метод `get_affiliate_links` родительского класса.

**Возвращает**:

*   `List[SimpleNamespace]`: Список объектов `SimpleNamespace`, содержащих партнерские ссылки.
## –ò–ù–°–¢–†–£–ö–¶–ò–Ø:

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –æ–±—ä—è—Å–Ω–∏ –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å —Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª–∞:

1.  **<–∞–ª–≥–æ—Ä–∏—Ç–º>**: –û–ø–∏—à–∏ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –≤ –≤–∏–¥–µ –ø–æ—à–∞–≥–æ–≤–æ–π –±–ª–æ–∫-—Å—Ö–µ–º—ã, –≤–∫–ª—é—á–∞—è –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –±–ª–æ–∫–∞, –∏ –ø—Ä–æ–∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∫–ª–∞—Å—Å–∞–º–∏ –∏–ª–∏ –º–µ—Ç–æ–¥–∞–º–∏.
2.  **<mermaid>**: –ù–∞–ø–∏—à–∏ –∫–æ–¥ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ `mermaid`, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –æ–±—ä—è—Å–Ω–∏ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏,
    –∫–æ—Ç–æ—Ä—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã.
    **–í–ê–ñ–ù–û!** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –¥–∏–∞–≥—Ä–∞–º–º–µ `mermaid`,
    –∏–º–µ—é—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞. –ò–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—Ä–æ–¥–µ `A`, `B`, `C`, –∏ —Ç.–¥., –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è!

    **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**: –ï—Å–ª–∏ –≤ –∫–æ–¥–µ –µ—Å—Ç—å –∏–º–ø–æ—Ä—Ç `import header`, –¥–æ–±–∞–≤—å—Ç–µ –±–ª–æ–∫ `mermaid` flowchart, –æ–±—ä—è—Å–Ω—è—é—â–∏–π `header.py`:
    ```mermaid
    flowchart TD
        Start --> Header[<code>header.py</code><br> Determine Project Root]

        Header --> import[Import Global Settings: <br><code>from src import gs</code>]
    ```

3.  **<–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ>**: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è:
    - **–ò–º–ø–æ—Ä—Ç—ã**: –ò—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ `src.`.
    - **–ö–ª–∞—Å—Å—ã**: –ò—Ö —Ä–æ–ª—å, –∞—Ç—Ä–∏–±—É—Ç—ã, –º–µ—Ç–æ–¥—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞.
    - **–§—É–Ω–∫—Ü–∏–∏**: –ò—Ö –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä—ã.
    - **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**: –ò—Ö —Ç–∏–ø—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.
    - –í—ã–¥–µ–ª–∏—Ç–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –ø–æ—Å—Ç—Ä–æ–π—Ç–µ —Ü–µ–ø–æ—á–∫—É –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π —Å –¥—Ä—É–≥–∏–º–∏ —á–∞—Å—Ç—è–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ).

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞.
## –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: `.md` (markdown)
**–ö–û–ù–ï–¶ –ò–ù–°–¢–†–£–ö–¶–ò–ò**

## <–∞–ª–≥–æ—Ä–∏—Ç–º>

```mermaid
flowchart TD
    Start[–ù–∞—á–∞–ª–æ] --> CatalogCallback[–û–±—Ä–∞–±–æ—Ç–∫–∞ callback_query "catalog"];
    CatalogCallback -- "–ó–∞–ø—Ä–æ—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–π" --> FindAllCategories[CategoryDao.find_all]
    FindAllCategories -- "–ü–æ–ª—É—á–µ–Ω—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" --> CatalogKeyboard[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã catalog_kb]
    CatalogKeyboard --> SendCatalogMessage[–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏]
    SendCatalogMessage --> CategoryCallback[–û–±—Ä–∞–±–æ—Ç–∫–∞ callback_query "category_*"]
    CategoryCallback -- "–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ category_id" --> FindProducts[ProductDao.find_all]
    FindProducts -- "–ü–æ–ª—É—á–µ–Ω—ã –ø—Ä–æ–¥—É–∫—Ç—ã" --> CheckProducts[–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤]
    CheckProducts -- "–ü—Ä–æ–¥—É–∫—Ç—ã –µ—Å—Ç—å" --> LoopProducts[–¶–∏–∫–ª –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º]
    LoopProducts -- "–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞" --> ProductText[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∞]
    ProductText --> ProductKeyboard[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã product_kb]
    ProductKeyboard --> SendProductMessage[–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º]
    SendProductMessage -- "–ö–æ–Ω–µ—Ü —Ü–∏–∫–ª–∞" --> CheckProducts
    CheckProducts -- "–ù–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤" --> AnswerNoProducts[–û—Ç–≤–µ—Ç –æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤]
    AnswerNoProducts --> End[–ö–æ–Ω–µ—Ü]
    CategoryCallback -- "–ù–µ—É–¥–∞—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å" --> AnswerNoProducts
    SendCatalogMessage -- "–ù–µ—É–¥–∞—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å" --> AnswerNoProducts
    LoopProducts -- "–ö–æ–Ω–µ—Ü —Ü–∏–∫–ª–∞" --> ProductCallback[–û–±—Ä–∞–±–æ—Ç–∫–∞ callback_query "buy_*"]
    ProductCallback -- "–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö" --> CheckPaymentType[–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã]
    CheckPaymentType -- "yukassa" --> SendYukassaInvoice[–í—ã–∑–æ–≤ send_yukassa_invoice]
    CheckPaymentType -- "stars" --> SendStarsInvoice[–í—ã–∑–æ–≤ send_stars_invoice]
    CheckPaymentType -- "robocassa" --> SendRobocassaInvoice[–í—ã–∑–æ–≤ send_robocassa_invoice]
    SendYukassaInvoice --> SendInvoiceYookassa[–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω–≤–æ–π—Å–∞ —á–µ—Ä–µ–∑ bot.send_invoice (–Æ–∫–∞—Å—Å–∞)]
    SendInvoiceYookassa --> DeleteMessage[–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è]
     SendStarsInvoice --> SendInvoiceStars[–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω–≤–æ–π—Å–∞ —á–µ—Ä–µ–∑ bot.send_invoice (–ó–≤–µ–∑–¥—ã)]
    SendInvoiceStars --> DeleteMessage
    SendRobocassaInvoice --> GeneratePaymentLink[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É Robokassa]
    GeneratePaymentLink --> SendRobocassaMessage[–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Å—Å—ã–ª–∫–æ–π Robokassa]
    SendRobocassaMessage --> DeleteMessage
    DeleteMessage --> PreCheckoutQuery[–û–±—Ä–∞–±–æ—Ç–∫–∞ pre_checkout_query]
    PreCheckoutQuery --> AnswerPreCheckoutQuery[bot.answer_pre_checkout_query]
    AnswerPreCheckoutQuery --> SuccessfulPayment[–û–±—Ä–∞–±–æ—Ç–∫–∞ successful_payment]
    SuccessfulPayment -- "–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ payload" --> CheckStarsPayment[–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã (–∑–≤–µ–∑–¥—ã)]
    CheckStarsPayment -- "–ó–≤–µ–∑–¥—ã" --> StarsPayment[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã –∑–≤–µ–∑–¥–∞–º–∏]
    CheckStarsPayment -- "–ù–µ –∑–≤–µ–∑–¥—ã" --> RubPayment[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã —Ä—É–±–ª—è–º–∏]
    StarsPayment --> PaymentDataStars[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–ª–∞—Ç–µ (–∑–≤–µ–∑–¥—ã)]
    RubPayment --> PaymentDataRub[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–ª–∞—Ç–µ (—Ä—É–±–ª–∏)]
    PaymentDataStars --> SuccessLogic[–í—ã–∑–æ–≤ successful_payment_logic]
     PaymentDataRub --> SuccessLogic
     SuccessLogic --> End
    
```

**–ü—Ä–∏–º–µ—Ä—ã:**

1.  **–ù–∞—á–∞–ª–æ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ö–∞—Ç–∞–ª–æ–≥".
2.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ callback\_query "catalog"**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `page_catalog`.
3.  **CategoryDao.find\_all**: –ó–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
    *   –ü—Ä–∏–º–µ—Ä: `[Category(id=1, name="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞"), Category(id=2, name="–ö–Ω–∏–≥–∏")]`
4.  **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã catalog\_kb**: –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
    *   –ü—Ä–∏–º–µ—Ä: –ö–Ω–æ–ø–∫–∏ "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞", "–ö–Ω–∏–≥–∏".
5.  **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—ã–±–æ—Ä–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
6.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ callback\_query "category\_\*"**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" (`category_1`). –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `page_catalog_products`.
7.  **ProductDao.find\_all**: –ó–∞–ø—Ä–æ—Å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
    *   –ü—Ä–∏–º–µ—Ä: `[Product(id=1, name="–¢–µ–ª–µ—Ñ–æ–Ω", price=10000, description="...", category_id=1), Product(id=2, name="–ù–æ—É—Ç–±—É–∫", price=50000, description="...", category_id=1)]`
8.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã, —Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:
    *   –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞.
        *   –ü—Ä–∏–º–µ—Ä: "üì¶ **–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:** –¢–µ–ª–µ—Ñ–æ–Ω\n\nüí∞ **–¶–µ–Ω–∞:** 10000 —Ä—É–±.\n\nüìù **–û–ø–∏—Å–∞–Ω–∏–µ:**\n*...\*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    *   –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–ö—É–ø–∏—Ç—å" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.
        *   –ü—Ä–∏–º–µ—Ä: –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" (`buy_yukassa_1_10000`, `buy_stars_1_10`, `buy_robocassa_1_10000`)
9.  **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–æ–≤–∞—Ä–æ–º**: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ –∫–Ω–æ–ø–∫–æ–π "–ö—É–ø–∏—Ç—å" –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
10. **–û–±—Ä–∞–±–æ—Ç–∫–∞ callback\_query "buy\_\*"**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å" (–Ω–∞–ø—Ä–∏–º–µ—Ä, `buy_yukassa_1_10000`). –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `process_about`.
11. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø –æ–ø–ª–∞—Ç—ã ("yukassa", "stars", "robocassa") –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `send_yukassa_invoice`).
12. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω–≤–æ–π—Å–∞/—Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ**: –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω–≤–æ–π—Å —á–µ—Ä–µ–∑ `bot.send_invoice` –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É.
13. **–û–±—Ä–∞–±–æ—Ç–∫–∞ pre\_checkout\_query**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π.
14. **–û–±—Ä–∞–±–æ—Ç–∫–∞ successful\_payment**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã, –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–ª–∞—Ç–µ.
15. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–ª–∞—Ç–µ**: –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ payload –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å `payment_data`.
16. **–í—ã–∑–æ–≤ successful\_payment\_logic**: –§—É–Ω–∫—Ü–∏—è `successful_payment_logic` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ–ø–ª–∞—Ç—ã.

## <mermaid>

```mermaid
flowchart TD
    Start([–ù–∞—á–∞–ª–æ])
    Start --> catalog_router_callback_catalog{catalog_router.callback_query(F.data == "catalog")}
    catalog_router_callback_catalog -- CallbackQuery, AsyncSession --> page_catalog[page_catalog(call: CallbackQuery, session_without_commit: AsyncSession)]
    page_catalog --> CategoryDao_find_all[CategoryDao.find_all(session=session_without_commit)]
    CategoryDao_find_all -- List[Category] --> catalog_kb_function[catalog_kb(catalog_data)]
    catalog_kb_function -- InlineKeyboardMarkup --> bot_send_message_catalog[bot.send_message(reply_markup=catalog_kb)]
    bot_send_message_catalog --> catalog_router_callback_category{catalog_router.callback_query(F.data.startswith("category_"))}
    catalog_router_callback_category -- CallbackQuery, AsyncSession --> page_catalog_products[page_catalog_products(call: CallbackQuery, session_without_commit: AsyncSession)]
    page_catalog_products --> ProductDao_find_all[ProductDao.find_all(session=session_without_commit, filters=ProductCategoryIDModel)]
    ProductDao_find_all -- List[Product] --> loop_products{for product in products_category}
    loop_products -- Product --> format_product_text[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∞]
    format_product_text -- str --> product_kb_function[product_kb(product.id, product.price, 1)]
    product_kb_function -- InlineKeyboardMarkup --> bot_send_message_product[bot.send_message(reply_markup=product_kb)]
    bot_send_message_product --> loop_products
    loop_products -- –ö–æ–Ω–µ—Ü —Ü–∏–∫–ª–∞ --> catalog_router_callback_buy{catalog_router.callback_query(F.data.startswith('buy_'))}
    catalog_router_callback_buy -- CallbackQuery, AsyncSession --> process_about[process_about(call: CallbackQuery, session_without_commit: AsyncSession)]
    process_about --> UserDAO_find_one_or_none[UserDAO.find_one_or_none(session=session_without_commit, filters=TelegramIDModel)]
    UserDAO_find_one_or_none -- User --> check_payment_type{if payment_type == "yukassa/stars/robocassa"}
    check_payment_type -- "yukassa" --> send_yukassa_invoice_func[send_yukassa_invoice(call, user_info, product_id, price)]
    check_payment_type -- "stars" --> send_stars_invoice_func[send_stars_invoice(call, user_info, product_id, stars_price)]
    check_payment_type -- "robocassa" --> send_robocassa_invoice_func[send_robocassa_invoice(call, user_info, product_id, price, session_without_commit)]
    send_yukassa_invoice_func --> bot_send_invoice_yukassa[bot.send_invoice(provider_token=settings.PROVIDER_TOKEN, reply_markup=get_product_buy_youkassa(price))]
    send_stars_invoice_func --> bot_send_invoice_stars[bot.send_invoice(currency='XTR', reply_markup=get_product_buy_stars(stars_price))]
    send_robocassa_invoice_func --> generate_payment_link_func[generate_payment_link(cost=float(price), number=pay_id, description=description, user_id=user_info.id, user_telegram_id=call.from_user.id, product_id=product_id)]
    generate_payment_link_func --> get_product_buy_robocassa_func[get_product_buy_robocassa(price, payment_link)]
     get_product_buy_robocassa_func --> bot_send_message_robocassa[bot.send_message(reply_markup=kb)]
    bot_send_invoice_yukassa --> catalog_router_pre_checkout_query{catalog_router.pre_checkout_query(lambda query: True)}
    bot_send_invoice_stars --> catalog_router_pre_checkout_query
    bot_send_message_robocassa --> catalog_router_pre_checkout_query
     catalog_router_pre_checkout_query -- PreCheckoutQuery --> pre_checkout_query_func[pre_checkout_query(pre_checkout_q: PreCheckoutQuery)]
    pre_checkout_query_func --> bot_answer_pre_checkout_query[bot.answer_pre_checkout_query(pre_checkout_q.id, ok=True)]
    bot_answer_pre_checkout_query --> catalog_router_successful_payment{catalog_router.message(F.content_type == ContentType.SUCCESSFUL_PAYMENT)}
    catalog_router_successful_payment -- Message, AsyncSession --> successful_payment_func[successful_payment(message: Message, session_with_commit: AsyncSession)]
     successful_payment_func --> payment_info_split[payment_info.invoice_payload.split('_')]
     payment_info_split --> check_stars_payment{if payment_type == 'stars'}
     check_stars_payment -- "stars" --> stars_payment[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã –∑–≤–µ–∑–¥–∞–º–∏]
     check_stars_payment -- "–Ω–µ –∑–≤–µ–∑–¥—ã" --> rub_payment[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã —Ä—É–±–ª—è–º–∏]
      stars_payment --> create_payment_data_stars[–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è payment_data (–∑–≤–µ–∑–¥—ã)]
       rub_payment --> create_payment_data_rub[–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è payment_data (—Ä—É–±–ª–∏)]
      create_payment_data_stars --> successful_payment_logic_call[successful_payment_logic(session=session_with_commit, payment_data=payment_data, currency=currency, user_tg_id=message.from_user.id, bot=bot)]
      create_payment_data_rub --> successful_payment_logic_call
    successful_payment_logic_call --> End([–ö–æ–Ω–µ—Ü])
```

**–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `mermaid`:**

1.  `aiogram`:
    *   `Router`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–∞ (`catalog_router`), –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã.
    *   `F`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, `F.data == "catalog"`.
    *   `ContentType`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, `ContentType.SUCCESSFUL_PAYMENT`.
    *   `Message`: –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Telegram.
    *   `CallbackQuery`: –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö callback –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Telegram.
    *   `LabeledPrice`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–µ–Ω –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤.
    *   `PreCheckoutQuery`: –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π.
2.  `sqlalchemy.ext.asyncio`:
    *   `AsyncSession`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
3.  `bot.app.utils`:
    *   `generate_payment_link`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Robokassa.
4.  `bot.config`:
    *   `bot`: –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ aiogram.
    *   `settings`: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞, –≤–∫–ª—é—á–∞—è `PROVIDER_TOKEN` –¥–ª—è –Æ–∫–∞—Å—Å—ã.
5.  `bot.dao.dao`:
    *   `UserDAO`: DAO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    *   `CategoryDao`: DAO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    *   `ProductDao`: DAO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    *    `PurchaseDao`: DAO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–∫—É–ø–∫–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
6.  `bot.user.kbs`:
    *   `catalog_kb`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏.
    *   `product_kb`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤.
    *    `get_product_buy_youkassa`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —á–µ—Ä–µ–∑ –Æ–∫–∞—Å—Å–∞.
    *    `get_product_buy_stars`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∑–∞ –∑–≤–µ–∑–¥—ã.
    *    `get_product_buy_robocassa`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —á–µ—Ä–µ–∑ Robokassa.
7.  `bot.user.schemas`:
    *   `TelegramIDModel`: Pydantic –º–æ–¥–µ–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ telegram_id.
    *   `ProductCategoryIDModel`: Pydantic –º–æ–¥–µ–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ category_id.
    *    `PaymentData`: Pydantic –º–æ–¥–µ–ª—å –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–ª–∞—Ç–µ.
8. `bot.user.utils`:
    *  `successful_payment_logic`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã.

## <–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ>

**–ò–º–ø–æ—Ä—Ç—ã:**

*   `aiogram`: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤.
    *   `Router`: –ö–ª–∞—Å—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç –≤—Ö–æ–¥—è—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
    *   `F`: –û–±—ä–µ–∫—Ç –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ —Ä–∞–∑–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º.
    *   `ContentType`: –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∏ —Ç.–¥.).
    *   `Message`, `CallbackQuery`, `LabeledPrice`, `PreCheckoutQuery`: –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ–ª–ª–±–µ–∫–æ–≤, —Ü–µ–Ω –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤ –∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π.
*   `sqlalchemy.ext.asyncio`: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
    *   `AsyncSession`: –ö–ª–∞—Å—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
*   `bot.app.utils`:
    *   `generate_payment_link`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Robokassa.
*   `bot.config`:
    *   `bot`: –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é aiogram.
    *   `settings`: –û–±—ä–µ–∫—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞, –≤–∫–ª—é—á–∞—è —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –æ–ø–ª–∞—Ç—ã (–Æ–∫–∞—Å—Å–∞).
*   `bot.dao.dao`: –ú–æ–¥—É–ª—å —Å Data Access Objects (DAO) –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
    *   `UserDAO`, `CategoryDao`, `ProductDao`, `PurchaseDao`: DAO –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, —Ç–æ–≤–∞—Ä–æ–≤ –∏ –ø–æ–∫—É–ø–æ–∫.
*   `bot.user.kbs`: –ú–æ–¥—É–ª—å —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º.
    *   `catalog_kb`, `product_kb`: –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–æ–≤–∞—Ä–æ–≤.
    *   `get_product_buy_youkassa`, `get_product_buy_stars`, `get_product_buy_robocassa`: –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä –¥–ª—è –æ–ø–ª–∞—Ç—ã —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏.
*   `bot.user.schemas`: –ú–æ–¥—É–ª—å —Å Pydantic –º–æ–¥–µ–ª—è–º–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
    *   `TelegramIDModel`, `ProductCategoryIDModel`, `PaymentData`: –ú–æ–¥–µ–ª–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ ID, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–ª–∞—Ç–µ.
*   `bot.user.utils`:
    *   `successful_payment_logic`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã.

**–ö–ª–∞—Å—Å—ã:**

*   `catalog_router = Router()`: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º. –†–æ—É—Ç–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram.

**–§—É–Ω–∫—Ü–∏–∏:**

*   `page_catalog(call: CallbackQuery, session_without_commit: AsyncSession)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `call` (CallbackQuery), `session_without_commit` (AsyncSession).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∫–∞–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.
    *   –ü—Ä–∏–º–µ—Ä: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ö–∞—Ç–∞–ª–æ–≥".
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–ª–±–µ–∫ `call.answer("–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞...")`.
    2.  –£–¥–∞–ª—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π "–ö–∞—Ç–∞–ª–æ–≥" —á–µ—Ä–µ–∑  `call.message.delete()`.
    3.  –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –ø–æ–º–æ—â—å—é `CategoryDao.find_all(session=session_without_commit)`.
    4.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π `call.message.answer(...)` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ `catalog_kb()`.
*   `page_catalog_products(call: CallbackQuery, session_without_commit: AsyncSession)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `call` (CallbackQuery), `session_without_commit` (AsyncSession).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–µ–π.
    *   –ü—Ä–∏–º–µ—Ä: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞".
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –ò–∑–≤–ª–µ–∫–∞–µ—Ç `category_id` –∏–∑ –¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–ª–±–µ–∫–∞ `call.data`.
    2.  –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ø–æ–º–æ—â—å—é `ProductDao.find_all(...)`.
    3.  –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –µ—Å—Ç—å, —Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:
        *   –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.
        *   –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–∞ –∏ –∫–Ω–æ–ø–∫–æ–π "–ö—É–ø–∏—Ç—å" `call.message.answer(...)` –∏—Å–ø–æ–ª—å–∑—É—è `product_kb()`.
    4.  –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤, —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ –≤ –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ `call.answer("–í –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.")`.
*   `process_about(call: CallbackQuery, session_without_commit: AsyncSession)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `call` (CallbackQuery), `session_without_commit` (AsyncSession).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∫—É–ø–∫—É —Ç–æ–≤–∞—Ä–∞.
    *   –ü—Ä–∏–º–µ—Ä: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å" (–Ω–∞–ø—Ä–∏–º–µ—Ä, `buy_yukassa_1_10000`).
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `UserDAO.find_one_or_none(...)`.
    2.  –†–∞–∑–¥–µ–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–ª–ª–±–µ–∫–∞ `call.data` –Ω–∞ —Ç–∏–ø –æ–ø–ª–∞—Ç—ã, ID —Ç–æ–≤–∞—Ä–∞ –∏ —Ü–µ–Ω—É.
    3.  –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã (`yukassa`, `stars`, `robocassa`), –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é (`send_yukassa_invoice`, `send_stars_invoice`, `send_robocassa_invoice`).
    4.  –£–¥–∞–ª—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `call.message.delete()`.
*   `send_yukassa_invoice(call, user_info, product_id, price)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `call` (CallbackQuery), `user_info` (User), `product_id` (int), `price` (int).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –Æ–∫–∞—Å—Å—É.
    *   –ü—Ä–∏–º–µ—Ä: –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã –Æ–∫–∞—Å—Å–∞.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–≤–æ–π—Å —á–µ—Ä–µ–∑ `bot.send_invoice(...)` —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (ID —á–∞—Ç–∞, –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø–∏—Å–∞–Ω–∏–µ, payload, —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, –≤–∞–ª—é—Ç–∞, —Ü–µ–Ω—ã) –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π `get_product_buy_youkassa()`.
*   `send_robocassa_invoice(call, user_info, product_id, price, session: AsyncSession)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `call` (CallbackQuery), `user_info` (User), `product_id` (int), `price` (int), `session` (AsyncSession).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Robokassa –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    *   –ü—Ä–∏–º–µ—Ä: –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã Robokassa.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –ü–æ–ª—É—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π ID –ø–æ–∫—É–ø–∫–∏ —á–µ—Ä–µ–∑ `PurchaseDao.get_next_id(session=session)`.
    2.  –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞.
    3.  –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ `generate_payment_link(...)`.
    4.  –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –æ–ø–ª–∞—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É—è `get_product_buy_robocassa(...)`.
    5.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å—Å—ã–ª–∫–æ–π –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π `call.message.answer(...)`.
*   `send_stars_invoice(call, user_info, product_id, stars_price)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `call` (CallbackQuery), `user_info` (User), `product_id` (int), `stars_price` (int).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã "–∑–≤–µ–∑–¥–∞–º–∏".
    *   –ü—Ä–∏–º–µ—Ä: –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã "–∑–≤–µ–∑–¥–∞–º–∏".
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–≤–æ–π—Å —á–µ—Ä–µ–∑ `bot.send_invoice(...)` —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π `get_product_buy_stars()`.
*   `pre_checkout_query(pre_checkout_q: PreCheckoutQuery)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `pre_checkout_q` (PreCheckoutQuery).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø–ª–∞—Ç—ã.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `bot.answer_pre_checkout_query(pre_checkout_q.id, ok=True)`.
*   `successful_payment(message: Message, session_with_commit: AsyncSession)`:
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `message` (Message), `session_with_commit` (AsyncSession).
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `None`.
    1.  –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–± –æ–ø–ª–∞—Ç–µ –∏–∑ `message.successful_payment`.
    2.  –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–∏–ø –æ–ø–ª–∞—Ç—ã, ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ ID —Ç–æ–≤–∞—Ä–∞ –∏–∑ `invoice_payload`.
    3.  –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞–ª—é—Ç—É –∏ —Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã.
    4.  –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ª–æ–≤–∞—Ä—å `payment_data` —Å –¥–∞–Ω–Ω—ã–º–∏ –æ–± –æ–ø–ª–∞—Ç–µ.
    5.  –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `successful_payment_logic(...)` –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

*   `catalog_router`: –≠–∫–∑–µ–º–ø–ª—è—Ä —Ä–æ—É—Ç–µ—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–∞—Ç–∞–ª–æ–≥–∞.
*   `catalog_data`: –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
*   `products_category`: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
*   `product`: –û–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ü–∏–∫–ª–µ `for product in products_category`.
*   `product_text`: –¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.
*    `payment_type`, `product_id`, `price`: –†–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `call.data` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `process_about`.
*   `user_info`: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –ø–æ–ª—É—á–µ–Ω–Ω–∞—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
*   `pay_id`: ID –ø–æ–∫—É–ø–∫–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
*   `payment_data`: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ–± –æ–ø–ª–∞—Ç–µ.
*    `currency`: –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ (‚ÇΩ –∏–ª–∏ ‚≠ê).

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**

1.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
    *   –í –∫–æ–¥–µ –µ—Å—Ç—å –±–ª–æ–∫ `try-except` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `page_catalog`, –Ω–æ –æ–Ω –ø—É—Å—Ç–æ–π, —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏.
    *   –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–±–æ–∏ –∏ —Å–æ–æ–±—â–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–± –æ—à–∏–±–∫–∞—Ö.
2.  **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
    *   –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `category_id` –∏ `product_id` –∏–∑ —Å—Ç—Ä–æ–∫–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
    *   –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ ID —è–≤–ª—è—é—Ç—Å—è —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.
3.  **–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:**
    *   –í —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `user_info` –±—É–¥–µ—Ç `None`, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É –≤ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö, —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—Ä–æ–±–ª–µ–º.
4.  **–û–±—â–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
    *   –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, —Ä–∞–∑–¥–µ–ª–∏–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, —á—Ç–æ —É–ª—É—á—à–∏—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —à–∞–±–ª–æ–Ω—ã.

**–¶–µ–ø–æ—á–∫–∞ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π:**

1.  **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram** –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ö–∞—Ç–∞–ª–æ–≥" –∏–ª–∏ "–ö—É–ø–∏—Ç—å".
2.  **Telegram API** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `callback_query` –≤ –±–æ—Ç–∞.
3.  **`catalog_router`** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é.
4.  **`CategoryDao` / `ProductDao` / `UserDAO`** –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `AsyncSession`.
5.  **`catalog_kb` / `product_kb`** —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
6.  **`bot`** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏–Ω–≤–æ–π—Å—ã —á–µ—Ä–µ–∑ Telegram API.
7.  **`generate_payment_link`** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É –¥–ª—è Robokassa.
8.  **`successful_payment_logic`** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–ª–∞—Ç—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
9.  **Telegram API** –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
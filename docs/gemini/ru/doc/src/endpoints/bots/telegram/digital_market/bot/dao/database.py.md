# Модуль для работы с базой данных

## Обзор

Модуль предоставляет инструменты для работы с базой данных, включая подключение, создание сессий и базовый класс для моделей.

## Подробней

Модуль `database.py` содержит основные настройки для подключения к базе данных, создания асинхронных сессий и определения базового класса `Base` для моделей SQLAlchemy. Этот класс включает общие поля, такие как `id`, `created_at` и `updated_at`, а также методы для преобразования объектов в словари. Он предназначен для упрощения и стандартизации работы с базой данных в проекте.

## Классы

### `Base`

**Описание**:
Базовый класс для моделей SQLAlchemy, предоставляющий общие поля и методы.

**Как работает класс**:
Класс `Base` наследуется от `AsyncAttrs` и `DeclarativeBase` из SQLAlchemy. Он определяет общие поля, такие как `id` (первичный ключ), `created_at` (время создания) и `updated_at` (время обновления). Также предоставляет метод `to_dict` для преобразования объекта модели в словарь.

**Методы**:
- `to_dict`
- `__tablename__`

#### `to_dict`
```python
def to_dict(self) -> dict:
    """
    Метод для преобразования объекта в словарь
    Args:
        self: Экземпляр класса.

    Returns:
        dict: Словарь, представляющий объект.
    """
    ...
```

**Назначение**:
Преобразует объект модели в словарь, где ключами являются имена столбцов, а значениями - соответствующие значения атрибутов объекта.

**Параметры**:
- `self`: Экземпляр класса.

**Возвращает**:
- `dict`: Словарь, представляющий объект.

**Как работает функция**:
1. Функция `to_dict` итерируется по всем столбцам таблицы, связанной с классом модели.
2. Для каждого столбца она получает имя столбца (`c.name`) и значение соответствующего атрибута объекта (`getattr(self, c.name)`).
3. Затем она формирует словарь, где ключами являются имена столбцов, а значениями - значения атрибутов объекта.

#### `__tablename__`
```python
@classmethod
@property
def __tablename__(cls) -> str:
    """
    Возвращает имя таблицы, приведенное к нижнему регистру и во множественном числе.
    Args:
        cls: Класс.

    Returns:
        str: Имя таблицы.
    """
    ...
```

**Назначение**:
Определяет имя таблицы в базе данных на основе имени класса, приводя его к нижнему регистру и добавляя суффикс 's'.

**Параметры**:
- `cls`: Класс.

**Возвращает**:
- `str`: Имя таблицы.

**Как работает функция**:
1. Функция `__tablename__` получает имя класса (`cls.__name__`).
2. Приводит имя класса к нижнему регистру (`lower()`).
3. Добавляет суффикс 's' для образования множественного числа (`+ 's'`).
4. Возвращает полученное имя таблицы.

## Переменные

- `engine`: Асинхронный движок SQLAlchemy для подключения к базе данных.
- `async_session_maker`: Фабрика асинхронных сессий для работы с базой данных.
- `Base`: Базовый класс для моделей SQLAlchemy.

```python
engine = create_async_engine(url=database_url)
async_session_maker = async_sessionmaker(engine, class_=AsyncSession)
```
   
**Назначение**:
- Инициализирует асинхронный движок SQLAlchemy, используемый для подключения к базе данных, указанной в `database_url`.
- Создает фабрику асинхронных сессий, которая позволяет создавать новые сессии для выполнения операций с базой данных.

**Как работает**:
1. `create_async_engine(url=database_url)`: Создает асинхронный движок SQLAlchemy, используя URL базы данных из переменной `database_url`. Этот движок управляет соединениями с базой данных и выполнением SQL-запросов.
2. `async_sessionmaker(engine, class_=AsyncSession)`: Создает фабрику асинхронных сессий, связанную с созданным движком. Параметр `class_=AsyncSession` указывает, что фабрика должна создавать сессии типа `AsyncSession`, обеспечивая асинхронное взаимодействие с базой данных.
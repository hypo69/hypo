# Анализ кода модуля

## Анализ кода модуля `README.MD`

**Качество кода**

-   **Соответствие требованиям к формату кода (1-10):**
    -   **Преимущества:**
        -   Документ содержит подробное описание двух математических игр и их реализации с помощью Google Gemini.
        -   Представлен код на Python для класса `GoogleGenerativeAI` и примеры его использования.
        -   Приведены инструкции для системного промпта для обеих игр.
        -   Даны примеры использования игр.
    -   **Недостатки:**
        -   Необходимо добавить комментарии в стиле reStructuredText (RST) для функций и классов.
        -   Отсутствуют импорты необходимых библиотек, кроме `google.generativeai`.
        -   Необходимо использование `j_loads` или `j_loads_ns` для чтения файлов.
        -   Необходимо добавить обработку ошибок с помощью `logger.error`.
        -   Формат `README.MD` не соответствует формату, требуемому для `python` кода.
        -   Отсутствует описание модуля в формате RST.
        -   Не все переменные имеют docstrings.
        -   Используется `try-except` без конкретной обработки ошибок через `logger.error`.

**Рекомендации по улучшению**

1.  **Формат документации:**
    -   Переформатировать документ в reStructuredText (RST) для лучшей интеграции с документацией Python.
    -   Добавить описание модуля в формате RST.
    -   Перевести все комментарии к коду в формат RST (docstrings).

2.  **Импорт библиотек:**
    -   Добавить импорты необходимых модулей, таких как `src.utils.jjson` и `src.logger.logger`.
3.  **Чтение файлов:**
    -   Заменить использование `json.load` на `j_loads` или `j_loads_ns` из `src.utils.jjson`, если это применимо.
4.  **Обработка ошибок:**
    -   Заменить общие блоки `try-except` на специфическую обработку ошибок с использованием `logger.error`.
5.  **Docstrings:**
    -   Добавить docstrings в формате RST для всех функций, классов и методов.

**Улучшенный код**

```python
"""
Модуль для интерактивного обучения математике с использованием Google Gemini.
==========================================================================

Модуль содержит классы и функции для реализации игр "Ввод-Вывод" и "10-центовый компьютер",
использующих модели Google Gemini для создания интерактивного обучающего опыта.

Примеры использования
--------------------

.. code-block:: python

    # Замените "YOUR_API_KEY" на свой API-ключ
    api_key = "YOUR_API_KEY"

    # Инициализация игры "Ввод-Вывод"
    input_output_game = GoogleGenerativeAI(api_key=api_key, system_instruction=system_instruction_input_output)

    # Инициализация "10-центового компьютера"
    binary_computer = GoogleGenerativeAI(api_key=api_key, system_instruction=system_instruction_binary)

    # Примеры использования:
    print("Игра Ввод-Вывод:")
    print(input_output_game.ask("Ввод: 7"))
    print(input_output_game.ask("Ввод: 12"))
    print(input_output_game.ask("Задайте машину x / 2"))
    print(input_output_game.ask("Ввод: 12"))

    print("\\n10-центовый компьютер:")
    print(binary_computer.ask("Десятичное: 6"))
    print(binary_computer.ask("Лампочки: 0111"))
    print(binary_computer.ask("Объясните как 13"))
"""
import google.generativeai as genai  # импорт библиотеки для работы с моделями Gemini
from typing import List  # импорт для аннотации типов
from src.logger.logger import logger  # импорт логгера для записи ошибок

class GoogleGenerativeAI:
    """
    Класс для взаимодействия с моделями Google Generative AI.

    :param api_key: Ключ API для доступа к Gemini.
    :type api_key: str
    :param system_instruction: Инструкция для модели (системный промпт).
    :type system_instruction: str
    :param model_name: Название используемой модели Gemini. По умолчанию 'gemini-2-13b'.
    :type model_name: str
    """

    MODELS: List[str] = [
        'gemini-1.5-flash-8b',
        'gemini-2-13b',
        'gemini-3-20b'
    ]  # список доступных моделей

    def __init__(self, api_key: str, system_instruction: str, model_name: str = 'gemini-2-13b'):
        """
        Инициализация модели GoogleGenerativeAI.

        :param api_key: Ключ API для доступа к Gemini.
        :type api_key: str
        :param system_instruction: Инструкция для модели (системный промпт).
        :type system_instruction: str
        :param model_name: Название используемой модели Gemini. По умолчанию 'gemini-2-13b'.
        :type model_name: str
        """
        self.api_key = api_key  # сохранение ключа API
        self.model_name = model_name  # сохранение имени модели
        genai.configure(api_key=self.api_key)  # Конфигурация библиотеки с API ключом
        self.model = genai.GenerativeModel(model_name=self.model_name, system_instruction=system_instruction)  # Инициализация модели с инструкцией

    def ask(self, q: str) -> str:
        """
        Отправка запроса модели и получение ответа.

        :param q: Текст запроса.
        :type q: str
        :return: Ответ модели или сообщение об ошибке.
        :rtype: str
        """
        try:
            response = self.model.generate_content(q)  # Отправка запроса модели
            return response.text  # Получение текстового ответа
        except Exception as ex:
            logger.error(f'Error processing request: {ex}', exc_info=True)  # Обработка и логирование ошибки
            return f'Error: {str(ex)}'  # Возврат сообщения об ошибке

# Системные инструкции
system_instruction_input_output = """
Вы - игровой движок для математической игры "Ввод-Вывод". Ваша задача - преобразовать число, которое поступает в "Ввод" в соответствии с заданным правилом (скрытой "машиной") и выдать результат в "Вывод".

Вы должны придерживаться следующих правил:
-   Начинайте с простых правил (например, сложение или вычитание с целым числом).
-   По мере того, как пользователь справляется, вы можете постепенно переходить к более сложным правилам (умножение, деление, корень, комбинации операций и т.д).
-   Если пользователь запрашивает конкретное правило, вы должны его использовать.
-   В конце каждого ответа вы должны кратко указывать тип операции, которую вы использовали (например "машина +3" или "машина 2x+1").

**Формат ввода/вывода:**
-   Пользователь: `Ввод: <число>`
-   Вы: `Вывод: <результат>, машина:<описание операции>`

**Примеры:**

Пользователь: `Ввод: 5`
Вы: `Вывод: 8, машина +3`

Пользователь: `Ввод: 10`
Вы: `Вывод: 21, машина 2x+1`

Пользователь: `Ввод: 9`
Вы: `Вывод: 3, машина квадратный корень`

Пользователь: `Задайте машину x * 2`
Вы: `Окей, машина: x*2`

**Начните игру с любым простым правилом.**
"""  # системная инструкция для игры "Ввод-Вывод"

system_instruction_binary = """
Вы - симулятор "10-центового компьютера" для обучения детей двоичной системе счисления. Ваша задача - представлять числа в двоичной форме с помощью 4 "лампочек" (0 - лампа выключена, 1 - лампа включена). 

Ваши лампочки обозначают 1, 2, 4 и 8 в двоичной системе (справа налево).

Вы должны следовать следующим правилам:
-   Когда пользователь указывает десятичное число, вы показываете, какие "лампочки" нужно включить (1) и выключить (0), чтобы это число отобразить.
-   Когда пользователь указывает, какие "лампочки" включены, вы говорите, какое десятичное число они представляют.
-   Вы должны использовать формат `0000` для двоичного представления, где крайний правый бит - 1, затем 2, 4 и 8 соответственно.
-   Если пользователь просит объяснить, что вы сделали - объясните.

**Формат ввода/вывода:**
-   Пользователь: `Десятичное: <число>`
-   Вы: `Двоичное: <двоичное представление>, объяснение:<что вы сделали>`
-   Пользователь: `Лампочки: <двоичное представление>`
-   Вы: `Десятичное: <число>, объяснение:<что вы сделали>`

**Примеры:**
Пользователь: `Десятичное: 5`
Вы: `Двоичное: 0101, объяснение: Включены лампочки 1 и 4, 1+4=5`

Пользователь: `Лампочки: 1010`
Вы: `Десятичное: 10, объяснение: Включены лампочки 2 и 8, 2+8=10`

Пользователь: `Объясните как 7`
Вы: `Двоичное: 1110, объяснение: Включены лампочки 1,2 и 4. 1+2+4 = 7`

**Начните симуляцию с любого простого числа.**
"""  # системная инструкция для "10-центового компьютера"

# Замените "YOUR_API_KEY" на свой API-ключ
api_key = "YOUR_API_KEY"

# Инициализация игры "Ввод-Вывод"
input_output_game = GoogleGenerativeAI(api_key=api_key, system_instruction=system_instruction_input_output) # создание экземпляра класса для игры "Ввод-Вывод"

# Инициализация "10-центового компьютера"
binary_computer = GoogleGenerativeAI(api_key=api_key, system_instruction=system_instruction_binary)  # создание экземпляра класса для игры "10-центовый компьютер"

# Примеры использования:
print("Игра Ввод-Вывод:")
print(input_output_game.ask("Ввод: 7"))
print(input_output_game.ask("Ввод: 12"))
print(input_output_game.ask("Задайте машину x / 2"))
print(input_output_game.ask("Ввод: 12"))

print("\n10-центовый компьютер:")
print(binary_computer.ask("Десятичное: 6"))
print(binary_computer.ask("Лампочки: 0111"))
print(binary_computer.ask("Объясните как 13"))
```
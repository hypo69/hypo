# Документация для модуля unittest/models.py

## Обзор

Модуль содержит юнит-тесты для проверки доступности моделей у различных провайдеров в проекте `g4f` (gpt4free). Он проверяет, что каждый провайдер, заявленный как поддерживающий определенную модель, действительно имеет её в списке доступных моделей. Также проверяется, что все провайдеры помечены как рабочие (working).

## Подробней

Этот модуль важен для обеспечения корректной работы интеграции с различными провайдерами моделей, гарантируя, что заявленные модели действительно доступны и провайдеры функционируют правильно. Он использует юнит-тесты для автоматической проверки этих условий.

## Классы

### `TestProviderHasModel`

**Описание**: Класс, содержащий юнит-тесты для проверки доступности моделей у провайдеров.

**Принцип работы**:
Класс `TestProviderHasModel` наследуется от `unittest.TestCase` и содержит методы для проверки наличия моделей у провайдеров и их работоспособности. Он использует кэш для хранения списка моделей каждого провайдера, чтобы избежать повторных запросов.

**Методы**:

- `test_provider_has_model`: Проходит по всем моделям и провайдерам, проверяя наличие модели у провайдера.
- `provider_has_model`: Проверяет, что указанная модель есть в списке моделей, предоставляемых указанным провайдером.
- `test_all_providers_working`: Проверяет, что все провайдеры помечены как рабочие.

## Функции

### `test_provider_has_model`

```python
def test_provider_has_model(self):
    """
    Проходит по всем моделям и провайдерам, проверяя наличие модели у провайдера.

    Args:
        self: Экземпляр класса `TestProviderHasModel`.

    Returns:
        None

    Raises:
        AssertionError: Если модель не найдена у провайдера, для которого она заявлена.

    Как работает функция:
    1. Функция проходит по всем моделям и провайдерам, указанным в `__models__.values()`.
    2. Для каждого провайдера проверяется, является ли он подклассом `ProviderModelMixin`.
    3. Если провайдер является подклассом `ProviderModelMixin`, проверяется, есть ли у него псевдоним для данной модели.
    4. Вызывается функция `self.provider_has_model` для проверки наличия модели у провайдера.

    Внутри функции происходят следующие действия и преобразования:
    - Обход по всем моделям и провайдерам.
    - Проверка типа провайдера (`ProviderModelMixin`).
    - Определение имени модели (псевдоним или оригинальное имя).
    - Вызов функции проверки наличия модели у провайдера.

    Примеры:
        >>> test_provider = TestProviderHasModel()
        >>> test_provider.test_provider_has_model()
    """
    ...
```

### `provider_has_model`

```python
def provider_has_model(self, provider: Type[BaseProvider], model: str):
    """
    Проверяет, что указанная модель есть в списке моделей, предоставляемых указанным провайдером.

    Args:
        provider (Type[BaseProvider]): Тип провайдера для проверки.
        model (str): Название модели для проверки.

    Returns:
        None

    Raises:
        AssertionError: Если модель не найдена у провайдера.

    Как работает функция:
    1. Функция проверяет, есть ли в кэше информация о моделях для данного провайдера.
    2. Если информации нет, функция пытается получить список моделей от провайдера с помощью `provider.get_models()`.
    3. Если получение списка моделей вызывает исключение `MissingRequirementsError` или `MissingAuthError`, функция завершается.
    4. Если список моделей получен успешно, он сохраняется в кэше.
    5. Функция проверяет, есть ли указанная модель в списке моделей провайдера.

    Внутри функции происходят следующие действия и преобразования:
    - Проверка наличия информации о моделях в кэше.
    - Получение списка моделей от провайдера (если нет в кэше).
    - Обработка исключений при получении списка моделей.
    - Проверка наличия модели в списке моделей провайдера.

    Примеры:
        >>> test_provider = TestProviderHasModel()
        >>> test_provider.provider_has_model(SomeProvider, "gpt-3.5-turbo")
    """
    ...
```

### `test_all_providers_working`

```python
def test_all_providers_working(self):
    """
    Проверяет, что все провайдеры помечены как рабочие.

    Args:
        self: Экземпляр класса `TestProviderHasModel`.

    Returns:
        None

    Raises:
        AssertionError: Если провайдер не помечен как рабочий.

    Как работает функция:
    1. Функция проходит по всем моделям и провайдерам, указанным в `__models__.values()`.
    2. Для каждого провайдера проверяется значение атрибута `provider.working`.
    3. Если значение `provider.working` равно `False`, выбрасывается исключение `AssertionError`.

    Внутри функции происходят следующие действия и преобразования:
    - Обход по всем моделям и провайдерам.
    - Проверка атрибута `provider.working`.

    Примеры:
        >>> test_provider = TestProviderHasModel()
        >>> test_provider.test_all_providers_working()
    """
    ...
# Обработка сценария для получения списков цен (scenario_picelist.process_ai.mmd)

## Обзор

Данный сценарий описывает последовательность действий для обработки запросов на получение списков цен.  Сценарий предполагает взаимодействие пользователя с моделью AI, а также обработку возможных ошибок и вариаций входных данных.

## Диаграмма последовательности

```plantuml
@startuml
!include <c4/C4_Context>

System_Boundary(System, "Система обработки списков цен") {
  Rel(User, System, "Запрос на обработку продуктов", "products_list")
  Rel(System, AI_Model, "Запрос на обработку", "products_list")
  Rel(AI_Model, System, "Ответ от модели")
}

System_Boundary(AI_Model, "Модель AI") {
    :Обработка запроса с командой модели;
}

System_Boundary(Logger, "Система логирования") {

  alt Нет ответа от модели
    Rel(AI_Model, Logger, "Ошибка \"no response from gemini\"")
    Rel(System, AI_Model, "Повторный запрос", "attempts - 1")
  end

  alt Невалидные данные (data)
    Rel(AI_Model, Logger, "Ошибка \"Error in data from gemini\"")
    Rel(System, AI_Model, "Повторный запрос", "attempts - 1")
  end

  alt Получены данные (data)
    alt Данные в виде списка
      alt Два элемента (ru, he)
        Rel(System, System, "Извлечение ru и he")
      end
      alt Один элемент
        Rel(System, System, "Извлечение ru и he из первого элемента")
      end
      alt Невалидная структура данных
        Rel(AI_Model, Logger, "Ошибка \"Проблема парсинга ответа\"")
        Rel(System, AI_Model, "Повторный запрос", "attempts - 1")
      end
    end

    alt Данные в виде объекта
      Rel(System, System, "Извлечение ru и he из объекта")
    end

    alt Невалидные значения (ru или he)
      Rel(AI_Model, Logger, "Ошибка \"Invalid ru or he data\"")
      Rel(System, AI_Model, "Повторный запрос", "attempts - 1")
    end

    Rel(System, System, "Возврат результата ru и he")
  end

}

@enduml
```

## Функциональные особенности

- **Обработка запросов**: Системой обрабатываются запросы пользователей на получение списков цен.
- **Взаимодействие с моделью AI**: Система взаимодействует с моделью AI для получения необходимых данных.
- **Обработка ошибок**: Система предусматривает обработку ошибок, таких как отсутствие ответа от модели, невалидные данные, и другие проблемы при получении и парсинге данных.
- **Логирование ошибок**: Ошибки записываются в систему логирования для последующего анализа и исправления.
- **Извлечение данных**: Система извлекает необходимые значения `ru` и `he` из полученных данных (список или объект).


## Реализация

Для реализации этого сценария используется взаимодействие между системой, моделью AI и системой логирования.

## Возможные ошибки

- `no response from gemini`: Модель AI не отвечает на запрос.
- `Error in data from gemini`: Полученные данные от модели AI не соответствуют ожидаемому формату.
- `Проблема парсинга ответа`: Проблемы при парсинге данных, полученных от модели AI.
- `Invalid ru or he data`: Невалидные данные `ru` или `he` в ответе модели AI.


## Схема потока данных (в упрощенном виде)


```
User -> System (request) -> AI_Model (request) -> System (response) -> User (result or error)
```
```
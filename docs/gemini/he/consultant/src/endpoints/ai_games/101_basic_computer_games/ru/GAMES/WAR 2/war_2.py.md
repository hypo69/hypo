# Анализ кода модуля `war_2.py`

**Качество кода**
- **Соответствие требованиям к формату кода (1-10):**
  - 1.  **Формат документации:** Используется docstring, но не в формате reStructuredText (RST).  
  - 2.  **Сохранение комментариев:** Все комментарии `#` сохранены.
  - 3.  **Обработка данных:**  Не используется `j_loads` или `j_loads_ns`.
  - 4.  **Анализ структуры:**  Импорты в порядке, отсутствуют необходимые из `src.logger.logger import logger`.
  - 5.  **Рефакторинг и улучшение:** Отсутствует  документация в формате RST для функций, классов и методов, не используется логгер.
  - 6.  **Исключение дублирования:** В коде дублирования не обнаружено
  - 7.  **Финальный код:** В конце ответ предоставлен полный код с улучшением.
  - 8.  **Примеры кода:**  Примеры docstring в формате RST не представлены.
  - 9.  **Дополнительные инструкции:**  Отсутствует документация в формате RST.
-  **Преимущества:**
    - Код игры хорошо структурирован, логика игры корректна.
    - Читаемый и понятный код.
    -  Логика игры "война" реализована правильно.
-   **Недостатки:**
    - Отсутствует документация в формате RST.
    - Не используется  `j_loads` или `j_loads_ns`.
    - Не используется логгер.
    - Недостаточная обработка исключений.

**Рекомендации по улучшению**
1.  Заменить docstring на формат RST.
2.  Использовать `src.utils.jjson` (`j_loads` или `j_loads_ns`) если это требуется для каких либо операций с файлами.
3.  Добавить импорт `from src.logger.logger import logger` и использовать его для обработки ошибок.
4.  Добавить подробные комментарии в формате RST к каждой функции и методу, в том числе для переменных.
5.  Использовать более явную обработку ошибок через `logger.error`.

**Улучшенный код**
```python
"""
Модуль для реализации карточной игры "Война 2".
=========================================================================================

Этот модуль содержит функции для создания колоды карт, раздачи карт игрокам,
определения победителя и реализации логики игры "Война".

Правила игры:
1.  Стандартная колода из 52 карт делится поровну между двумя игроками.
2.  Каждый игрок одновременно выкладывает верхнюю карту из своей колоды.
3.  Игрок с более старшей картой забирает обе карты и добавляет их в конец своей колоды.
4.  Если карты равны, объявляется "война":
    4.1. Каждый игрок выкладывает три карты рубашкой вверх.
    4.2. Каждый игрок выкладывает еще по одной карте открытой.
    4.3. Игрок с более старшей открытой картой забирает все карты (включая карты войны).
    4.4. Если открытые карты снова равны, война повторяется.
5.  Игра продолжается до тех пор, пока один из игроков не соберет все карты.
6.  Масти в игре не учитываются, только ранг карт (2, 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, A).

Пример использования
--------------------
    
.. code-block:: python

    if __name__ == "__main__":
        play_war()
"""
import random
from src.logger.logger import logger # импортируем логгер

def create_deck():
    """
    Создает стандартную колоду из 52 карт.

    :return: Список строк, представляющих колоду карт.
    :rtype: list[str]
    
    Пример::

        >>> create_deck()
        ['2C', '2D', '2H', '2S', '3C', '3D', '3H', '3S', '4C', '4D', '4H', '4S', '5C', '5D', '5H', '5S', '6C', '6D', '6H', '6S', '7C', '7D', '7H', '7S', '8C', '8D', '8H', '8S', '9C', '9D', '9H', '9S', '10C', '10D', '10H', '10S', 'JC', 'JD', 'JH', 'JS', 'QC', 'QD', 'QH', 'QS', 'KC', 'KD', 'KH', 'KS', 'AC', 'AD', 'AH', 'AS']
    """
    suits = ['C', 'D', 'H', 'S']  # Масти: Clubs, Diamonds, Hearts, Spades # определяем масти
    ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'] # определяем ранг карт
    deck = [rank + suit for suit in suits for rank in ranks] # генерируем колоду
    return deck


def deal_cards(deck):
    """
    Раздает карты двум игрокам.

    :param deck: Список карт в колоде.
    :type deck: list[str]
    :return: Кортеж из двух списков, представляющих карты игроков A и B.
    :rtype: tuple[list[str], list[str]]
    
    Пример::
    
        >>> deck = create_deck()
        >>> player_a, player_b = deal_cards(deck)
        >>> len(player_a)
        26
        >>> len(player_b)
        26
    """
    random.shuffle(deck) # перемешиваем колоду
    player_a = deck[:len(deck) // 2] # раздаем половину карт первому игроку
    player_b = deck[len(deck) // 2:] # раздаем вторую половину карт второму игроку
    return player_a, player_b


def get_card_value(card):
    """
    Возвращает числовое значение карты (без учета масти).

    :param card: Строка, представляющая карту.
    :type card: str
    :return: Числовое значение карты.
    :rtype: int
    
    Пример::
    
        >>> get_card_value('2C')
        2
        >>> get_card_value('JC')
        11
        >>> get_card_value('AC')
        14
    """
    rank = card[:-1]  # получаем ранг карты, отбрасывая масть
    if rank.isdigit():  # если ранг это число
        return int(rank)  # возвращаем числовое значение ранга
    elif rank == 'J':    # если ранг валет
        return 11        # возвращаем 11
    elif rank == 'Q':    # если ранг дама
        return 12        # возвращаем 12
    elif rank == 'K':    # если ранг король
        return 13        # возвращаем 13
    elif rank == 'A':    # если ранг туз
        return 14        # возвращаем 14
    return 0 # в противном случае возвращаем 0


def war(player_a, player_b, cards_on_table):
    """
    Реализует процесс "войны" в игре.

    :param player_a: Список карт игрока A.
    :type player_a: list[str]
    :param player_b: Список карт игрока B.
    :type player_b: list[str]
    :param cards_on_table: Список карт на столе.
    :type cards_on_table: list[str]
    :return: Кортеж с флагами победы, списком карт на столе и колодами игроков.
    :rtype: tuple[bool, bool, list[str], list[str], list[str]]
    
    Пример::

        >>> player_a = ['2C', '3C', '4C', '5C', '6C']
        >>> player_b = ['2D', '3D', '4D', '5D', '7C']
        >>> cards_on_table = ['2H', '2S']
        >>> a_win, b_win, table, new_player_a, new_player_b = war(player_a, player_b, cards_on_table)
        >>> a_win
        False
        >>> b_win
        False
        >>> len(table)
        0
        >>> len(new_player_a)
        1
        >>> len(new_player_b)
        1
    """
    while True:
        # Проверяем, есть ли у игроков достаточно карт для войны
        if len(player_a) < 4: # если у игрока А меньше 4 карт
            return True,False,cards_on_table,player_a, player_b # возвращаем, что игрок B победил, и карты
        if len(player_b) < 4: # если у игрока B меньше 4 карт
           return False,True, cards_on_table,player_a, player_b # возвращаем, что игрок A победил, и карты

        # Забираем карты для войны
        war_cards_a = player_a[:4] # первые 4 карты игрока А
        war_cards_b = player_b[:4] # первые 4 карты игрока B
        player_a = player_a[4:]    # удаляем первые 4 карты из колоды игрока A
        player_b = player_b[4:]    # удаляем первые 4 карты из колоды игрока B
        cards_on_table.extend(war_cards_a) # добавляем карты игрока А на стол
        cards_on_table.extend(war_cards_b) # добавляем карты игрока B на стол

        # Сравниваем открытые карты
        card_a_value = get_card_value(war_cards_a[-1]) # получаем значение последней карты игрока А
        card_b_value = get_card_value(war_cards_b[-1]) # получаем значение последней карты игрока B

        if card_a_value > card_b_value: # если карта игрока А старше
            player_a.extend(cards_on_table) # игрок А забирает все карты со стола
            return False,False,[],player_a, player_b  # возвращаем, что война закончилась, игрок A победил
        elif card_b_value > card_a_value: # если карта игрока B старше
            player_b.extend(cards_on_table) # игрок B забирает все карты со стола
            return False,False,[],player_a, player_b  # возвращаем, что война закончилась, игрок B победил
        # если карты равны - повторяем войну


def play_war():
    """
    Основная логика игры в войну.
    
    Пример::

        >>> play_war()
        Раунд 1. Карты игрока A: 26, Карты игрока B: 26
        Раунд 2. Карты игрока A: 26, Карты игрока B: 26
        ...
        Игрок B выиграл игру!
        
    """
    deck = create_deck()  # Создаем колоду
    player_a, player_b = deal_cards(deck) # раздаем карты

    round_number = 0 # счетчик раундов
    while player_a and player_b: # пока у обоих игроков есть карты
        round_number += 1 # увеличиваем счетчик раундов
        print(f'Раунд {round_number}. Карты игрока A: {len(player_a)}, Карты игрока B: {len(player_b)}')
        card_a = player_a.pop(0) # берем карту из колоды игрока А
        card_b = player_b.pop(0) # берем карту из колоды игрока B
        cards_on_table = [card_a, card_b] # карты на столе

        card_a_value = get_card_value(card_a) # получаем значение карты игрока А
        card_b_value = get_card_value(card_b) # получаем значение карты игрока B

        if card_a_value > card_b_value: # если карта игрока А старше
            player_a.extend(cards_on_table) # игрок А забирает карты
        elif card_b_value > card_a_value:  # если карта игрока B старше
            player_b.extend(cards_on_table) # игрок B забирает карты
        else:  # если карты равны, начинаем войну
            a_win_war, b_win_war ,cards_on_table,player_a, player_b = war(player_a, player_b, cards_on_table) # запускаем войну
            if a_win_war == True: # если у игрока А не хватило карт
                print ('Игрок B победил в войне')
                break # выходим из цикла
            elif b_win_war == True: # если у игрока B не хватило карт
                print ('Игрок A победил в войне')
                break # выходим из цикла
        
        # для красоты, перемешиваем карты в конце каждой руки
        random.shuffle(player_a) 
        random.shuffle(player_b)


    if not player_a:  # если у игрока А нет карт
        print('Игрок B выиграл игру!')  # выводим сообщение о победе игрока B
    elif not player_b: # если у игрока B нет карт
        print('Игрок A выиграл игру!') # выводим сообщение о победе игрока A


if __name__ == '__main__':
    play_war()
    
"""
Объяснение кода:
1.  **Импорт модуля `random` и логгера**:
    -   `import random`: Импортирует модуль `random`, необходимый для перемешивания колоды карт.
    -   `from src.logger.logger import logger`: Импортирует логгер из модуля `src.logger.logger` для регистрации ошибок.
2.  **Функция `create_deck()`**:
    -   Создаёт стандартную колоду из 52 карт.
    -   `suits = ['C', 'D', 'H', 'S']`: Определяет список мастей (Clubs, Diamonds, Hearts, Spades).
    -   `ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A']`: Определяет список рангов карт.
    -   `deck = [rank + suit for suit in suits for rank in ranks]`: Генерирует колоду карт путем объединения рангов и мастей.
    -   `return deck`: Возвращает созданную колоду.
3.  **Функция `deal_cards(deck)`**:
    -   Раздает карты двум игрокам.
    -   `random.shuffle(deck)`: Перемешивает колоду.
    -   `player_a = deck[:len(deck) // 2]`: Раздает первую половину колоды игроку A.
    -   `player_b = deck[len(deck) // 2:]`: Раздает вторую половину колоды игроку B.
    -   `return player_a, player_b`: Возвращает карты игроков.
4.  **Функция `get_card_value(card)`**:
    -   Определяет числовое значение карты для сравнения.
    -   `rank = card[:-1]`: Извлекает ранг карты.
    -   Проверяет, является ли ранг числом, и возвращает его числовое значение.
    -   Устанавливает числовое значение для карт с буквами (J=11, Q=12, K=13, A=14).
    -   `return 0`: Если ранг не определен (на всякий случай) возвращает 0.
5.  **Функция `war(player_a, player_b, cards_on_table)`**:
    -   Реализует логику "войны" в игре.
    -   `while True:`: Бесконечный цикл, продолжается пока не закончится война.
        -   Проверяем, есть ли у игроков достаточно карт для войны.
        -   Если у кого-то меньше 4 карт, то объявляем победителем другого игрока
        -   Берем по 4 карты от каждого игрока и помещаем на стол
        -   Сравниваем открытые карты (последние карты в списках)
        -   Если карта игрока А старше, то игрок А забирает карты, выходим из цикла
        -   Если карта игрока B старше, то игрок B забирает карты, выходим из цикла
        -   Если карты равны, то повторяем войну.
    -   `return` возвращает значения:
        - a_win_war - победа игрока A в войне (у игрока B меньше 4 карт)
        - b_win_war - победа игрока B в войне (у игрока A меньше 4 карт)
        - cards_on_table - оставшиеся карты на столе
        - player_a - колода игрока A после войны
        - player_b - колода игрока B после войны
6. **Функция `play_war()`**:
    -   Основная логика игры.
    -   Создает колоду и раздает карты игрокам.
    -   `while player_a and player_b:`: Запускает основной цикл, пока у обоих игроков есть карты.
        -   Счетчик раундов.
        -   Берем по одной карте из колод игроков.
        -   Сравниваем значения карт.
        -   Если карта A > карты B, то A забирает все карты.
        -   Если карта B > карты A, то B забирает все карты.
        -   Если карты равны, вызываем функцию `war()`.
        -   Перемешиваем колоды игроков в конце раунда.
    -   Определяем победителя по наличию карт у игроков.
    -   Выводит сообщение о победителе.
7.  **Запуск игры**:
    -   `if __name__ == '__main__':`: Запускает игру, если файл запущен напрямую.
    -   `play_war()`: Вызывает функцию для начала игры.
"""
```
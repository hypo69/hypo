# Модуль для работы с нейронными сетями

## Обзор

Модуль `ToolBox_n_networks.py` содержит класс `neural_networks`, который предоставляет методы для взаимодействия с различными нейронными сетями. В частности, он включает методы для генерации изображений на основе текстовых запросов и получения ответов от языковых моделей.

## Подробней

Этот код предоставляет инструменты для работы с нейронными сетями, такими как FLUX.1-schnell (для генерации изображений), Mistral Large 2407 и Free GPT-4o mini (для обработки текста). Он использует API различных сервисов, таких как Hugging Face и Mistral AI, для выполнения запросов к этим моделям.

## Классы

### `neural_networks`

**Описание**: Класс для взаимодействия с различными нейронными сетями.

**Как работает класс**:

Класс `neural_networks` содержит методы для отправки запросов к различным нейронным сетям и обработки ответов от них. Он использует библиотеки `requests`, `json`, `os`, `io` и `PIL` для выполнения HTTP-запросов, обработки JSON-ответов, работы с переменными окружения, обработки ввода-вывода и работы с изображениями соответственно.

**Методы**:

- `_FLUX_schnell`: Защищенный метод для генерации изображений с использованием модели FLUX.1-schnell.
- `__mistral_large_2407`: Приватный метод для получения ответов от языковой модели Mistral Large 2407.
- `_free_gpt_4o_mini`: Защищенный метод для получения ответов от языковой модели Free GPT-4o mini.

## Функции

### `_FLUX_schnell`

```python
def _FLUX_schnell(self, prompt: str, size: list[int, int], seed: int, num_inference_steps: int) -> str|None:
    """
    Отправляет запрос к модели FLUX.1-schnell для генерации изображения на основе текстового запроса.

    Args:
        prompt (str): Текстовый запрос для генерации изображения.
        size (list[int, int]): Размеры изображения (ширина, высота).
        seed (int): Зерно для генерации случайных чисел.
        num_inference_steps (int): Количество шагов для генерации изображения.

    Returns:
        str | None: Объект изображения в случае успеха, `None` в случае ошибки.

    Raises:
        Exception: Если возникает ошибка при выполнении HTTP-запроса.

    Как работает функция:
    1. Формирует полезную нагрузку (payload) с текстовым запросом и параметрами генерации изображения.
    2. Выполняет HTTP-запрос к API модели FLUX.1-schnell.
    3. Если запрос выполнен успешно (код состояния 200), открывает изображение из полученного содержимого и возвращает его.

    Внутри функции происходят следующие действия и преобразования:
     Формирование запроса
     |
     -- Отправка запроса к API
     |
     Обработка ответа и возврат изображения

     Где:
     - Формирование запроса: Создание словаря с параметрами для запроса к API.
     - Отправка запроса к API: HTTP-запрос к API модели FLUX.1-schnell.
     - Обработка ответа и возврат изображения: Проверка статуса ответа и открытие изображения из полученного содержимого.
    """
    ...
```

**Параметры**:

- `prompt` (str): Текстовый запрос для генерации изображения.
- `size` (list[int, int]): Размеры изображения (ширина, высота).
- `seed` (int): Зерно для генерации случайных чисел.
- `num_inference_steps` (int): Количество шагов для генерации изображения.

**Возвращает**:

- `str | None`: Объект изображения в случае успеха, `None` в случае ошибки.

**Примеры**:

```python
# Пример вызова функции _FLUX_schnell
# Предположим, что у нас есть экземпляр класса neural_networks
# nn = neural_networks()
# image = nn._FLUX_schnell("A cat", [512, 512], 123, 50)
# if image:
#     image.show()
```

### `__mistral_large_2407`

```python
def __mistral_large_2407(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """
    Отправляет запрос к языковой модели Mistral Large 2407 для получения ответа на основе списка сообщений.

    Args:
        prompt (list[dict[str, str]]): Список сообщений для отправки в модель.

    Returns:
        tuple[str, int, int] | str: Ответ модели, количество использованных токенов для запроса и ответа.

    Raises:
        Exception: Если возникает ошибка при выполнении HTTP-запроса.

    Как работает функция:
    1. Формирует полезную нагрузку с списком сообщений и параметрами модели.
    2. Выполняет HTTP-запрос к API модели Mistral Large 2407.
    3. Если запрос выполнен успешно (код состояния 200), извлекает ответ модели, количество использованных токенов для запроса и ответа.

    Внутри функции происходят следующие действия и преобразования:
     Формирование запроса
     |
     -- Отправка запроса к API
     |
     Обработка ответа и возврат результата

     Где:
     - Формирование запроса: Создание словаря с параметрами для запроса к API.
     - Отправка запроса к API: HTTP-запрос к API модели Mistral Large 2407.
     - Обработка ответа и возврат результата: Извлечение ответа модели, количества токенов для запроса и ответа.
    """
    ...
```

**Параметры**:

- `prompt` (list[dict[str, str]]): Список сообщений для отправки в модель.

**Возвращает**:

- `tuple[str, int, int] | str`: Ответ модели, количество использованных токенов для запроса и ответа.

**Примеры**:

```python
# Пример вызова функции __mistral_large_2407
# Предположим, что у нас есть экземпляр класса neural_networks
# nn = neural_networks()
# prompt = [{"role": "user", "content": "Hello, how are you?"}]
# response, prompt_tokens, completion_tokens = nn.__mistral_large_2407(prompt)
# print(f"Response: {response}, Prompt tokens: {prompt_tokens}, Completion tokens: {completion_tokens}")
```

### `_free_gpt_4o_mini`

```python
def _free_gpt_4o_mini(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """
    Отправляет запрос к языковой модели Free GPT-4o mini для получения ответа на основе списка сообщений.

    Args:
        prompt (list[dict[str, str]]): Список сообщений для отправки в модель.

    Returns:
        tuple[str, int, int] | str: Ответ модели, количество использованных токенов для запроса и ответа.

    Raises:
        Exception: Если возникает ошибка при выполнении HTTP-запроса.

    Как работает функция:
    1. Формирует полезную нагрузку с списком сообщений и параметрами модели.
    2. Выполняет HTTP-запрос к API модели Free GPT-4o mini.
    3. Если запрос выполнен успешно (код состояния 200), извлекает ответ модели, количество использованных токенов для запроса и ответа.
    4. Если запрос не удался, вызывает метод `__mistral_large_2407` для получения ответа от модели Mistral Large 2407.

    Внутри функции происходят следующие действия и преобразования:
     Формирование запроса
     |
     -- Отправка запроса к API
     |
     Обработка ответа и возврат результата
     |
     -- Если запрос не удался --> Запрос к Mistral Large 2407

     Где:
     - Формирование запроса: Создание словаря с параметрами для запроса к API.
     - Отправка запроса к API: HTTP-запрос к API модели Free GPT-4o mini.
     - Обработка ответа и возврат результата: Извлечение ответа модели, количества токенов для запроса и ответа.
     - Запрос к Mistral Large 2407: Вызов метода `__mistral_large_2407` для получения ответа от модели Mistral Large 2407.
    """
    ...
```

**Параметры**:

- `prompt` (list[dict[str, str]]): Список сообщений для отправки в модель.

**Возвращает**:

- `tuple[str, int, int] | str`: Ответ модели, количество использованных токенов для запроса и ответа.

**Примеры**:

```python
# Пример вызова функции _free_gpt_4o_mini
# Предположим, что у нас есть экземпляр класса neural_networks
# nn = neural_networks()
# prompt = [{"role": "user", "content": "Hello, how are you?"}]
# response, prompt_tokens, completion_tokens = nn._free_gpt_4o_mini(prompt)
# print(f"Response: {response}, Prompt tokens: {prompt_tokens}, Completion tokens: {completion_tokens}")
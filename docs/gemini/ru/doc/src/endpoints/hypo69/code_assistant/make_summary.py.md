# Модуль для создания файла SUMMARY.md
## Обзор

Модуль `src.endpoints.hypo69.code_assistant.make_summary` предназначен для автоматического создания файла `SUMMARY.md`, который используется для формирования структуры книги в формате `mdbook`. Этот файл содержит оглавление, состоящее из ссылок на `.md` файлы, найденные в указанной директории. Поддерживается фильтрация файлов по языку (`ru` или `en`).

## Подробней

Этот модуль помогает автоматизировать процесс создания оглавления для документации, написанной в формате Markdown. Он рекурсивно обходит указанную директорию, находит все `.md` файлы (с учетом фильтрации по языку) и добавляет ссылки на них в файл `SUMMARY.md`. Модуль использует библиотеку `pathlib` для работы с путями к файлам и директориям, что обеспечивает кроссплатформенность.

## Функции

### `make_summary`

```python
def make_summary(docs_dir: Path, lang: str = 'en') -> None:
    """
    Создает файл SUMMARY.md, рекурсивно обходя папку.

    Args:
        docs_dir (Path): Путь к исходной директории 'src'.
        lang (str): Язык фильтрации файлов. Возможные значения: 'ru' или 'en'.
    """
```

**Назначение**: Создает файл `SUMMARY.md`, рекурсивно обходя указанную директорию и фильтруя файлы по языку.

**Параметры**:
- `docs_dir` (Path): Путь к исходной директории, содержащей `.md` файлы.
- `lang` (str): Язык фильтрации файлов. Допустимые значения: `'ru'` (русский) или `'en'` (английский). По умолчанию `'en'`.

**Возвращает**:
- `None`: Функция ничего не возвращает.

**Как работает функция**:

1.  Вызывает функцию `prepare_summary_path` для определения пути к файлу `SUMMARY.md`.
2.  Создает родительские директории для файла `SUMMARY.md`, если они не существуют.
3.  Вызывает функцию `_make_summary` для фактического создания и заполнения файла `SUMMARY.md`.

**ASCII flowchart**:

```
     Определение пути к файлу SUMMARY.md (prepare_summary_path)
     ↓
     Создание родительских директорий (mkdir)
     ↓
     Создание и заполнение файла SUMMARY.md (_make_summary)
```

**Примеры**:

```python
from pathlib import Path
#Предположим, что PROJECT_ROOT определен как Path('/path/to/project')
docs_dir = Path('./src')  # Укажите путь к вашей директории src
make_summary(docs_dir, lang='ru')

```

### `_make_summary`

```python
def _make_summary(src_dir: Path, summary_file: Path, lang: str = 'en') -> bool:
    """
    Рекурсивно обходит папку и создает файл SUMMARY.md с главами на основе .md файлов.

    Args:
        src_dir (Path): Путь к папке с исходниками .md.
        summary_file (Path): Путь для сохранения файла SUMMARY.md.
        lang (str): Язык фильтрации файлов. Возможные значения: 'ru' или 'en'.
    """
```

**Назначение**: Рекурсивно обходит указанную директорию, находит `.md` файлы (с учетом фильтрации по языку) и создает файл `SUMMARY.md` с главами на основе этих файлов.

**Параметры**:
- `src_dir` (Path): Путь к папке с исходными `.md` файлами.
- `summary_file` (Path): Путь для сохранения файла `SUMMARY.md`.
- `lang` (str): Язык фильтрации файлов. Допустимые значения: `'ru'` (русский) или `'en'` (английский). По умолчанию `'en'`.

**Возвращает**:
- `bool`: Возвращает `True` в случае успешного создания файла `SUMMARY.md` и `False` в случае ошибки.

**Как работает функция**:

1.  Проверяет, существует ли файл `SUMMARY.md`, и выводит сообщение, если он будет перезаписан.
2.  Открывает файл `SUMMARY.md` для записи в кодировке UTF-8.
3.  Записывает заголовок `# Summary\n\n` в файл.
4.  Рекурсивно обходит директорию `src_dir` в поисках `.md` файлов.
5.  Фильтрует файлы по языку, если указан параметр `lang`.
6.  Для каждого найденного файла формирует относительный путь и добавляет строку в формате `- [{path.stem}]({relative_path.as_posix()})\n` в файл `SUMMARY.md`.
7.  Возвращает `True` в случае успеха и `False` в случае возникновения исключения.

**ASCII flowchart**:

```
     Проверка существования файла SUMMARY.md
     ↓
     Открытие файла SUMMARY.md для записи
     ↓
     Запись заголовка в файл
     ↓
     Рекурсивный обход директории в поисках .md файлов
     ↓
     Фильтрация файлов по языку
     ↓
     Формирование относительного пути для каждого файла
     ↓
     Запись строки в файл SUMMARY.md
     ↓
     Возврат True или False в зависимости от успеха
```

**Примеры**:

```python
from pathlib import Path
# Предположим, что PROJECT_ROOT определен как Path('/path/to/project')
src_dir = Path('./src')  # Укажите путь к вашей директории src
summary_file = Path('./docs/SUMMARY.md')  # Укажите путь, куда сохранить SUMMARY.md
_make_summary(src_dir, summary_file, lang='ru')
```

### `prepare_summary_path`

```python
def prepare_summary_path(src_dir: Path, file_name: str = 'SUMMARY.md') -> Path:
    """
    Формирует путь к файлу, заменяя часть пути 'src' на 'docs' и добавляя имя файла.

    Args:
        src_dir (Path): Исходный путь с 'src'.
        file_name (str): Имя файла, который нужно создать. По умолчанию 'SUMMARY.md'.

    Returns:
        Path: Новый путь к файлу.
    """
```

**Назначение**: Формирует путь к файлу `SUMMARY.md`, заменяя часть пути `'src'` на `'docs'` и добавляя имя файла.

**Параметры**:
- `src_dir` (Path): Исходный путь, содержащий `'src'`.
- `file_name` (str): Имя файла, который нужно создать. По умолчанию `'SUMMARY.md'`.

**Возвращает**:
- `Path`: Новый путь к файлу.

**Как работает функция**:

1.  Формирует новый путь, заменяя часть пути `'src'` на `'docs'` с использованием `PROJECT_ROOT`.
2.  Добавляет имя файла к новому пути.
3.  Возвращает новый путь.

**ASCII flowchart**:

```
     Формирование нового пути с заменой 'src' на 'docs'
     ↓
     Добавление имени файла к новому пути
     ↓
     Возврат нового пути
```

**Примеры**:

```python
from pathlib import Path
# Предположим, что PROJECT_ROOT определен как Path('/path/to/project')
src_dir = Path('./src')  # Укажите путь к вашей директории src
summary_file_path = prepare_summary_path(src_dir)
print(summary_file_path)  # Выведет: PROJECT_ROOT/docs/SUMMARY.md
```

## Запуск из командной строки

Модуль можно запустить из командной строки, передав параметры `src_dir` (путь к исходной директории) и `lang` (язык фильтрации файлов).

Пример запуска:

```bash
python make_summary.py -lang ru src
```

В этом примере будет создан файл `SUMMARY.md` в директории `docs`, содержащий ссылки на все русские `.md` файлы, найденные в директории `src`.
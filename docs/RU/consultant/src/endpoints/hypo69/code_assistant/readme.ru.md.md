## Анализ кода модуля `readme.ru.md`

**Качество кода**
9
-  Плюсы
    -   Хорошо структурированное описание модуля и его функциональности.
    -   Присутствует подробное описание основных возможностей, структуры проекта, примеров использования и параметров командной строки.
    -   Раздел "Логика работы" чётко описывает последовательность действий.
    -   Есть разделы об исключениях, логировании и зависимостях.
    -   Подробная инструкция по созданию новой роли для моделей ИИ.

-  Минусы
    -   Отсутствует reStructuredText (RST) оформление.
    -   Не везде используется корректное форматирование markdown (например, в таблице).
    -   Некоторые моменты можно было бы описать более лаконично.
    -   Не используется `j_loads` или `j_loads_ns`.
    -   Нет примеров документации в формате RST.

**Рекомендации по улучшению**
1.  **Форматирование:**
    -   Использовать reStructuredText (RST) для всего текста, чтобы соответствовать стандартам документации.
    -   Заменить HTML-таблицу на Markdown-таблицу.

2.  **Содержание:**
    -   Переформулировать некоторые предложения для большей ясности и краткости.
    -   Добавить примеры документации в формате RST.
    -   Привести в соответствие имена переменных, функций и импортов с ранее обработанными файлами, если таковые имеются.

3.  **Техническое:**
    -   Добавить пример использования `j_loads` или `j_loads_ns` (если это требуется в данном контексте).
    -   Удалить избыточное использование стандартных блоков `try-except`.
    -   Заменить стандартный `json.load` на `j_loads` или `j_loads_ns` (если это необходимо).

**Оптимизированный код**
```markdown
.. module:: src.endpoints.hypo69.code_assistant

=========================================================================================

Модуль `Code Assistant`
=========================

.. _readme_ru_md:

.. raw:: html

    <TABLE >
    <TR>
    <TD>
    <A HREF = 'https://github.com/hypo69/hypo/blob/master/readme.ru.md'>[Root ↑]</A>
    </TD>
    <TD>
    <A HREF = 'https://github.com/hypo69/hypo/blob/master/src/readme.ru.md'>src</A> \\
    <A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/readme.ru.md'>endpoints</A> \\
    <A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/readme.ru.md'>hypo69</A>

    </TD>
    <TD>
    <A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/code_assistant/README.MD'>English</A>
    </TD>
    </TR>
    </TABLE>

Обзор
-----

Модуль ``Code Assistant`` предоставляет инструменты для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода.
Модуль выполняет задачи, такие как создание документации, проверка кода и генерация тестов на основе указанных файлов, а также включает скрипты для
создания файла ``SUMMARY.md`` и Telegram-бота для обработки задач.

Основные возможности
--------------------

``code_assistant.py``
^^^^^^^^^^^^^^^^^^^^^^

-  **Чтение файлов**: Читает код из файлов с расширениями ``.py`` и ``README.MD`` в указанных директориях.
-  **Взаимодействие с моделями**: Отправляет код в модели для выполнения задач, таких как создание документации или проверка ошибок.
-  **Генерация результатов**: Сохраняет ответы моделей в указанные директории для каждой роли.

``make_summary.py``
^^^^^^^^^^^^^^^^^^^

-  **Генерация ``SUMMARY.md``**: Рекурсивно обходит директорию для создания файла ``SUMMARY.md`` для компиляции документации.
-  **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (``ru`` или ``en``).

``onela_bot.py`` и ``bot_handlers.py``
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

-  **Telegram-бот**: Бот для обработки задач, связанных с кодом, например, отправка фрагментов кода на проверку или генерация документации.
-  **Обработчики бота**: Содержит обработчики для команд и сообщений бота.

Структура проекта
-----------------

-  **Модели**: Используются модели **Gemini** и **OpenAI** для обработки запросов.
-  **Промпты**: Промпты загружаются из файлов в директории ``src/ai/prompts/developer/`` (например, ``doc_writer_en.md``).
-  **Файлы**: Обрабатываются файлы с расширениями ``.py`` и ``README.MD`` в указанных директориях.

Примеры использования
--------------------

Запуск с настройками из JSON:
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: bash

    python code_assistant.py --settings settings.json

Запуск с явным указанием параметров:
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: bash

    python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2

Пример для роли ``code_checker``:
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: bash

    python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir

Пример для модели ``openai``:
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: bash

    python code_assistant.py --role doc_writer --lang en --models openai

Параметры командной строки
-------------------------

-  ``--settings``: Путь к JSON-файлу с настройками. Параметры загружаются из файла.
-  ``--role``: Роль модели для выполнения задачи (например, ``doc_writer``, ``code_checker``).
-  ``--lang``: Язык выполнения задачи (например, ``ru`` или ``en``).
-  ``--models``: Список моделей для инициализации (например, ``gemini``, ``openai``).
-  ``--start_dirs``: Список директорий для обработки (например, ``/path/to/dir1``).

Логика работы
-------------

1. **Чтение файлов**: Код ищет файлы с расширениями ``.py`` и ``README.MD`` в указанных директориях.
2. **Загрузка промптов**: Загружаются промпты для каждой роли из директории ``src/ai/prompts/developer/``.
3. **Обработка запросов**: Формируются запросы на основе загруженных файлов и отправляются в модели.
4. **Сохранение ответов**: Ответы моделей сохраняются в директории, соответствующие роли и модели (например, ``docs/raw_rst_from_<model>/<lang>/``).

Исключения
----------

Настройка исключений для файлов и директорий с помощью параметров:

- ``exclude_file_patterns``: Список регулярных выражений для исключения файлов.
- ``exclude_dirs``: Список директорий для исключения.
- ``exclude_files``: Список файлов для исключения.

Логирование
-----------

Логи сохраняются с помощью библиотеки ``logger`` и содержат информацию о процессе обработки файлов и полученных ответах.

Зависимости
-----------

- **Gemini API**: Требуется API-ключ для работы с моделью Gemini.
- **OpenAI API**: Требуется API-ключ для работы с моделью OpenAI.

Создание новой роли для моделей ИИ
----------------------------------

1. **Обновление ``code_assistant.json``**:
   - Добавьте новую роль в список ролей::

     .. code-block:: json

        "roles": [
          "code_checker",
          ...
        ]

   - Или исключите её в ``"exclude-roles"``.

2. **Добавление роли в переводы**:
   - Обновите файл ``translations/translations.json`` с новой ролью.

3. **Создание системного промпта**:
   - Добавьте новый системный промпт в директорию ``ai/prompts/developer/``.

4. **Создание командной инструкции**:
    - Добавьте новую команду в директорию ``instructions/``.
# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –º–æ–¥—É–ª—è kbs.py

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞: 8/10**

- –ü–ª—é—Å—ã:
    - –ö–æ–¥ —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –∏ –ª–µ–≥–∫–æ —á–∏—Ç–∞–µ—Ç—Å—è.
    - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `InlineKeyboardBuilder` –∏ `ReplyKeyboardBuilder` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π.
    - –§—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.
    - –ö–æ–¥ —Ä–∞–∑–±–∏—Ç –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏.
- –ú–∏–Ω—É—Å—ã:
    - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç docstring –¥–ª—è –º–æ–¥—É–ª—è –∏ —Ñ—É–Ω–∫—Ü–∏–π.
    - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `from src.logger.logger import logger` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫.
    - –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞") –∏ callback_data, —Å—Ç–æ–∏—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤—ã–Ω–µ—Å–µ–Ω–∏–µ –∏—Ö –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.
    - –ù–µ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è f-—Å—Ç—Ä–æ–∫–∏, –≥–¥–µ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ.
    - –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä –Ω–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è, –¥–ª—è —á–µ–≥–æ –æ–Ω–∏ –Ω—É–∂–Ω—ã.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é**

1.  –î–æ–±–∞–≤–∏—Ç—å docstring –¥–ª—è –º–æ–¥—É–ª—è –∏ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞.
2.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `from src.logger.logger import logger` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫.
3.  –í—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ callback_data –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è.
4.  –ó–∞–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ –Ω–∞ f-—Å—Ç—Ä–æ–∫–∏ –¥–ª—è –±–æ–ª—å—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
5.  –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ docstring), –¥–ª—è —á–µ–≥–æ –æ–Ω–∏ –Ω—É–∂–Ω—ã –∏ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.
6.  –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `settings` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è URL –¥–ª—è "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞".
7.  –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ `payment_link` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ `get_product_buy_robocassa`.
8.  –ò–∑–º–µ–Ω–∏—Ç—å `InlineKeyboardMarkup(inline_keyboard=[...])` –Ω–∞ `InlineKeyboardBuilder()`

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥**

```python
"""
–ú–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä –¥–ª—è Telegram-–±–æ—Ç–∞.
=========================================================================================

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
(–∏–Ω–ª–∞–π–Ω –∏ –æ–±—ã—á–Ω—ã—Ö) –¥–ª—è Telegram-–±–æ—Ç–∞, –≤–∫–ª—é—á–∞—è –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é,
–∫–∞—Ç–∞–ª–æ–≥–∞, –ø–æ–∫—É–ø–æ–∫ –∏ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
--------------------

–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –≥–ª–∞–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

.. code-block:: python

    from bot.dao.models import Category
    user_id = 12345
    main_kb = main_user_kb(user_id)

    catalog_data = [Category(id=1, category_name='Category 1'), Category(id=2, category_name='Category 2')]
    catalog_kb_markup = catalog_kb(catalog_data)

"""
from typing import List
from aiogram.types import InlineKeyboardMarkup, ReplyKeyboardMarkup, InlineKeyboardButton, WebAppInfo
from aiogram.utils.keyboard import InlineKeyboardBuilder, ReplyKeyboardBuilder

# from bot.app.utils import generate_payment_link # TODO: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞
from bot.config import settings
from bot.dao.models import Category
from src.logger.logger import logger # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ logger


MAIN_MENU_MY_PROFILE = "my_profile"
MAIN_MENU_CATALOG = "catalog"
MAIN_MENU_ABOUT = "about"
MAIN_MENU_ADMIN_PANEL = "admin_panel"
MAIN_MENU_HOME = "home"
MAIN_MENU_SUPPORT_AUTHOR_URL = 'https://t.me/tribute/app?startapp=deLN'

CATALOG_BACK_TO_HOME = "home"

PURCHASES_SHOW_PURCHASES = "purchases"
PURCHASES_BACK_TO_HOME = "home"

PRODUCT_BUY_YUKASSA = "buy_yukassa"
PRODUCT_BUY_ROBOCASSA = "buy_robocassa"
PRODUCT_BUY_STARS = "buy_stars"
PRODUCT_BACK_TO_CATALOG = "catalog"
PRODUCT_BACK_TO_HOME = "home"

def main_user_kb(user_id: int) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        user_id (int): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Returns:
        InlineKeyboardMarkup: –ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞.
    """
    kb = InlineKeyboardBuilder()
    kb.button(text="üë§ –ú–æ–∏ –ø–æ–∫—É–ø–∫–∏", callback_data=MAIN_MENU_MY_PROFILE)
    kb.button(text="üõç –ö–∞—Ç–∞–ª–æ–≥", callback_data=MAIN_MENU_CATALOG)
    kb.button(text="‚ÑπÔ∏è –û –º–∞–≥–∞–∑–∏–Ω–µ", callback_data=MAIN_MENU_ABOUT)
    kb.button(text="üåü –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ üåü", url=MAIN_MENU_SUPPORT_AUTHOR_URL)
    if user_id in settings.ADMIN_IDS:
        kb.button(text="‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å", callback_data=MAIN_MENU_ADMIN_PANEL)
    kb.adjust(1)
    return kb.as_markup()


def catalog_kb(catalog_data: List[Category]) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

    Args:
        catalog_data (List[Category]): –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ Category.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–∞.
    """
    kb = InlineKeyboardBuilder()
    for category in catalog_data:
        kb.button(text=category.category_name, callback_data=f"category_{category.id}")
    kb.button(text="üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é", callback_data=CATALOG_BACK_TO_HOME)
    kb.adjust(2)
    return kb.as_markup()


def purchases_kb() -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–∫—É–ø–æ–∫.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–∫—É–ø–æ–∫.
    """
    kb = InlineKeyboardBuilder()
    kb.button(text="üóë –°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∫—É–ø–∫–∏", callback_data=PURCHASES_SHOW_PURCHASES)
    kb.button(text="üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é", callback_data=PURCHASES_BACK_TO_HOME)
    kb.adjust(1)
    return kb.as_markup()


def product_kb(product_id: int, price: int, stars_price: int) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —Ç–æ–≤–∞—Ä–∞ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ–ø–ª–∞—Ç—ã.

    Args:
        product_id (int): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–≤–∞—Ä–∞.
        price (int): –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –≤ —Ä—É–±–ª—è—Ö.
        stars_price (int): –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –∑–≤–µ–∑–¥–∞—Ö.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–æ–≤–∞—Ä–∞.
    """
    kb = InlineKeyboardBuilder()
    kb.button(text="üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –Æ–ö–∞—Å—Å–∞", callback_data=f"{PRODUCT_BUY_YUKASSA}_{product_id}_{price}")
    kb.button(text="üí≥ –û–ø–ª–∞—Ç–∏—Ç—å Robocassa", callback_data=f"{PRODUCT_BUY_ROBOCASSA}_{product_id}_{price}")
    kb.button(text="‚≠ê –û–ø–ª–∞—Ç–∏—Ç—å –∑–≤–µ–∑–¥–∞–º–∏", callback_data=f"{PRODUCT_BUY_STARS}_{product_id}_{stars_price}")
    kb.button(text="üõç –ù–∞–∑–∞–¥", callback_data=PRODUCT_BACK_TO_CATALOG)
    kb.button(text="üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é", callback_data=PRODUCT_BACK_TO_HOME)
    kb.adjust(2)
    return kb.as_markup()


def get_product_buy_youkassa(price: int) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –ÆKassa.

    Args:
        price (int): –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –ÆKassa.
    """
    kb = InlineKeyboardBuilder()
    kb.button(text=f'–û–ø–ª–∞—Ç–∏—Ç—å {price}‚ÇΩ', pay=True)
    kb.row(InlineKeyboardButton(text='–û—Ç–º–µ–Ω–∏—Ç—å', callback_data=MAIN_MENU_HOME))
    return kb.as_markup()


def get_product_buy_robocassa(price: int, payment_link: str) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Robocassa.

    Args:
        price (int): –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞.
        payment_link (str): –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É.

    Returns:
         InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Robocassa.
    """
    if not payment_link:
        logger.error(f'–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç payment_link {payment_link=}')
        return InlineKeyboardMarkup(inline_keyboard=[])
    kb = InlineKeyboardBuilder()
    kb.button(text=f'–û–ø–ª–∞—Ç–∏—Ç—å {price}‚ÇΩ', web_app=WebAppInfo(url=payment_link))
    kb.row(InlineKeyboardButton(text='–û—Ç–º–µ–Ω–∏—Ç—å', callback_data=MAIN_MENU_HOME))
    return kb.as_markup()


def get_product_buy_stars(price: int) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–≤–µ–∑–¥–∞–º–∏.

    Args:
        price (int): –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –∑–≤–µ–∑–¥–∞—Ö.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ–ø–ª–∞—Ç—ã –∑–≤–µ–∑–¥–∞–º–∏.
    """
    kb = InlineKeyboardBuilder()
    kb.button(text=f'–û–ø–ª–∞—Ç–∏—Ç—å {price} ‚≠ê', pay=True)
    kb.row(InlineKeyboardButton(text='–û—Ç–º–µ–Ω–∏—Ç—å', callback_data=MAIN_MENU_HOME))
    return kb.as_markup()
```
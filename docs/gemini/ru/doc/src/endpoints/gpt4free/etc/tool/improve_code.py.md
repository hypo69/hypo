# Модуль для улучшения кода с использованием G4F
==================================================

Модуль предназначен для улучшения качества кода в файлах Python с использованием библиотеки G4F. Он читает код из указанного файла, отправляет его в G4F для улучшения, и записывает улучшенный код обратно в файл.

Пример использования
----------------------

```python
# Запуск скрипта и указание пути к файлу
# python your_script.py
# Path: /path/to/your/file.py
```

## Обзор

Данный модуль предназначен для автоматического улучшения кода в файлах Python. Он использует библиотеку `g4f` для взаимодействия с AI-моделями, которые анализируют и улучшают предоставленный код. Модуль позволяет добавлять type hints, сохранять лицензионные комментарии и избегать изменений в аргументах `kwargs`.

## Подробнее

Модуль состоит из нескольких этапов: чтение кода из файла, отправка кода в модель G4F для улучшения, получение улучшенного кода и запись его обратно в файл. Он также включает функцию для извлечения кода из текстовых блоков, заключенных в тройные обратные кавычки.

## Функции

### `read_code`

```python
def read_code(text: str) -> str | None:
    """Извлекает код Python из текстового блока, заключенного в тройные обратные кавычки.

    Args:
        text (str): Текст, содержащий код.

    Returns:
        str | None: Извлеченный код или None, если код не найден.

    Raises:
        None: Функция не вызывает исключений.

    """
```

**Назначение**: Извлечение кода Python из текстового блока, заключенного в тройные обратные кавычки.

**Параметры**:
- `text` (str): Текст, содержащий код.

**Возвращает**:
- `str | None`: Извлеченный код или `None`, если код не найден.

**Как работает функция**:
1. Функция принимает строку `text` в качестве аргумента.
2. Использует регулярное выражение для поиска блоков кода, заключенных в тройные обратные кавычки (```python``` или ```py```).
3. Если блок кода найден, функция возвращает содержимое этого блока.
4. Если блок кода не найден, функция возвращает `None`.

```
A [Получение текста на вход]
|
B [Поиск блоков кода с использованием регулярного выражения]
|
C [Если код найден] --- D [Возврат извлеченного кода]
|
E [Если код не найден] --- F [Возврат None]
```

**Примеры**:

```python
# Пример 1: Извлечение кода из текста
text_with_code = "Some text ```python\ndef my_function():\n    return 'Hello'\n```"
extracted_code = read_code(text_with_code)
print(extracted_code)  # Вывод: def my_function():\n    return 'Hello'

# Пример 2: Если код не найден
text_without_code = "Some text without code"
extracted_code = read_code(text_without_code)
print(extracted_code)  # Вывод: None
```

### Основной блок кода

```python
path = input("Path: ")

with open(path, "r") as file:
    code = file.read()

prompt = f"""
Improve the code in this file:
```py
{code}
```
Don't remove anything.
Add typehints if possible.
Don't add any typehints to kwargs.
Don't remove license comments.
"""

print("Create code...")
response = []
for chunk in g4f.ChatCompletion.create(
    model=g4f.models.default,
    messages=[{"role": "user", "content": prompt}],
    timeout=300,
    stream=True
):
    response.append(chunk)
    print(chunk, end="", flush=True)
print()
response = "".join(response)

if code := read_code(response):
    with open(path, "w") as file:
        file.write(code)
```

**Назначение**: Основной блок кода выполняет чтение кода из файла, отправляет его в G4F для улучшения, и записывает улучшенный код обратно в файл.

**Как работает функция**:
1. Запрашивает у пользователя путь к файлу с кодом.
2. Читает содержимое файла и сохраняет его в переменной `code`.
3. Формирует запрос (`prompt`) для G4F, включающий код, который необходимо улучшить. Запрос также содержит инструкции по улучшению кода (добавление type hints, сохранение комментариев и т.д.).
4. Выводит сообщение "Create code..." в консоль.
5. Использует `g4f.ChatCompletion.create` для отправки запроса в модель G4F и получает ответ по частям (chunks).
6. Собирает все части ответа в список `response` и выводит их в консоль.
7. Объединяет все части ответа в одну строку.
8. Извлекает улучшенный код из ответа с помощью функции `read_code`.
9. Если улучшенный код извлечен, записывает его обратно в файл.

```
A [Запрос пути к файлу у пользователя]
|
B [Чтение содержимого файла]
|
C [Формирование запроса для G4F]
|
D [Отправка запроса в G4F и получение ответа по частям]
|
E [Сборка частей ответа в одну строку]
|
F [Извлечение улучшенного кода из ответа]
|
G [Если улучшенный код извлечен] --- H [Запись улучшенного кода в файл]
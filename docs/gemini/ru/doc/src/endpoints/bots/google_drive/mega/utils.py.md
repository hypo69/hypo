# Модуль с утилитами для работы с Mega

## Обзор

Этот модуль содержит набор утилитных функций для работы с шифрованием, кодированием и декодированием данных, используемых в Mega. Он включает функции для преобразования данных между различными форматами (например, `a32` и строками), шифрования и дешифрования AES, а также кодирования и декодирования Base64.

## Подробней

Модуль предоставляет инструменты для выполнения криптографических операций и преобразований данных, необходимых для взаимодействия с API Mega. Он содержит функции для шифрования и дешифрования данных с использованием AES в режиме CBC, а также для кодирования и декодирования данных в формате Base64. Кроме того, он включает функции для преобразования данных между форматами `a32` и строками, а также для получения чанков данных заданного размера.

## Функции

### `a32_to_str`

```python
def a32_to_str(a):
    """Преобразует список 32-битных целых чисел в строку байтов.

    Args:
        a (list[int]): Список 32-битных целых чисел.

    Returns:
        str: Строка байтов, полученная из списка целых чисел.

    Как работает функция:
     1. Функция принимает список 32-битных целых чисел `a` в качестве входных данных.
     2. Использует `struct.pack` для упаковки каждого 32-битного целого числа в байтовую строку.
     3. Возвращает результирующую строку байтов.

    ```
    A - Список 32-битных целых чисел
    |
    -- struct.pack
    |
    B - Строка байтов
    ```

    Примеры:
    ```python
    >>> a32_to_str([1, 2, 3])
    b'\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x02\\x00\\x00\\x00\\x03'
    ```
    """
    ...
```

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """Шифрует данные с использованием AES в режиме CBC.

    Args:
        data (bytes): Данные для шифрования.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Зашифрованные данные.

    Как работает функция:
     1. Функция принимает данные `data` и ключ `key` для шифрования AES в режиме CBC.
     2. Создает объект шифрования AES с использованием предоставленного ключа и режима CBC.
     3. Выполняет шифрование данных с использованием созданного объекта шифрования.
     4. Возвращает зашифрованные данные.

    ```
    A - Данные для шифрования, Ключ шифрования
    |
    -- AES.new
    |
    B - Объект шифрования AES
    |
    -- encryptor.encrypt
    |
    C - Зашифрованные данные
    ```

    Примеры:
    ```python
    >>> key = b'\\x00' * 16
    >>> data = b'test data'
    >>> aes_cbc_encrypt(data, key)
    b'v\\xbb\\xa2\\x95\\xaf\\xe3\\xc0\\xfa\\x9b\\xfa\\x04\\x1a\\xca\\xbc\\xc7\\x06'
    ```
    """
    ...
```

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """Шифрует данные в формате a32 с использованием AES в режиме CBC.

    Args:
        data (list[int]): Данные для шифрования в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        tuple[int]: Зашифрованные данные в формате a32.

    Как работает функция:
     1. Функция принимает данные `data` и ключ `key` для шифрования AES в режиме CBC, оба в формате a32.
     2. Преобразует данные и ключ из формата a32 в строку байтов.
     3. Выполняет шифрование AES в режиме CBC с использованием преобразованных данных и ключа.
     4. Преобразует зашифрованные данные обратно в формат a32.
     5. Возвращает зашифрованные данные в формате a32.

    ```
    A - Данные в формате a32, Ключ в формате a32
    |
    -- a32_to_str
    |
    B - Данные в строковом формате, Ключ в строковом формате
    |
    -- aes_cbc_encrypt
    |
    C - Зашифрованные данные в строковом формате
    |
    -- str_to_a32
    |
    D - Зашифрованные данные в формате a32
    ```

    Примеры:
    ```python
    >>> data = [1, 2, 3]
    >>> key = [0] * 4
    >>> aes_cbc_encrypt_a32(data, key)
    (3221225472, 3221225472, 3221225472)
    ```
    """
    ...
```

### `str_to_a32`

```python
def str_to_a32(b):
    """Преобразует строку байтов в список 32-битных целых чисел.

    Args:
        b (bytes): Строка байтов для преобразования.

    Returns:
        tuple[int]: Список 32-битных целых чисел, полученный из строки байтов.

    Как работает функция:
     1. Функция принимает строку байтов `b` в качестве входных данных.
     2. Проверяет, является ли длина строки кратной 4, и добавляет padding, если это не так.
     3. Преобразует строку байтов в список 32-битных целых чисел, используя `struct.unpack`.
     4. Возвращает список 32-битных целых чисел.

    ```
    A - Строка байтов
    |
    -- Добавление отступов
    |
    B - Отформатированная строка байтов
    |
    -- struct.unpack
    |
    C - Список 32-битных целых чисел
    ```

    Примеры:
    ```python
    >>> str_to_a32(b'\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x02\\x00\\x00\\x00\\x03')
    (1, 2, 3)
    ```
    """
    ...
```

### `mpi2int`

```python
def mpi2int(s):
    """Преобразует строку, содержащую MPI (многократное целое число с префиксом), в целое число.

    Args:
        s (str): Строка, содержащая MPI.

    Returns:
        int: Целое число, полученное из MPI.

    Как работает функция:
     1. Функция принимает строку `s`, содержащую MPI, в качестве входных данных.
     2. Извлекает шестнадцатеричное представление целого числа из строки, начиная с третьего символа.
     3. Преобразует шестнадцатеричное представление в целое число.
     4. Возвращает целое число.

    ```
    A - Строка, содержащая MPI
    |
    -- Извлечение шестнадцатеричного представления
    |
    B - Шестнадцатеричное представление целого числа
    |
    -- Преобразование в целое число
    |
    C - Целое число
    ```

    Примеры:
    ```python
    >>> mpi2int(b'\\x00\\x02\\x01\\x02')
    258
    ```
    """
    ...
```

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """Расшифровывает данные с использованием AES в режиме CBC.

    Args:
        data (bytes): Данные для расшифровки.
        key (bytes): Ключ расшифровки.

    Returns:
        bytes: Расшифрованные данные.

    Как работает функция:
     1. Функция принимает данные `data` и ключ `key` для расшифровки AES в режиме CBC.
     2. Создает объект дешифрования AES с использованием предоставленного ключа и режима CBC.
     3. Выполняет дешифрование данных с использованием созданного объекта дешифрования.
     4. Возвращает расшифрованные данные.

    ```
    A - Данные для расшифровки, Ключ расшифровки
    |
    -- AES.new
    |
    B - Объект дешифрования AES
    |
    -- decryptor.decrypt
    |
    C - Расшифрованные данные
    ```

    Примеры:
    ```python
    >>> key = b'\\x00' * 16
    >>> data = b'v\\xbb\\xa2\\x95\\xaf\\xe3\\xc0\\xfa\\x9b\\xfa\\x04\\x1a\\xca\\xbc\\xc7\\x06'
    >>> aes_cbc_decrypt(data, key)
    b'test data\\x0b\\x0b\\x0b\\x0b\\x0b\\x0b\\x0b\\x0b\\x0b\\x0b\\x0b'
    ```
    """
    ...
```

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """Расшифровывает данные в формате a32 с использованием AES в режиме CBC.

    Args:
        data (list[int]): Данные для расшифровки в формате a32.
        key (list[int]): Ключ расшифровки в формате a32.

    Returns:
        tuple[int]: Расшифрованные данные в формате a32.

    Как работает функция:
     1. Функция принимает данные `data` и ключ `key` для расшифровки AES в режиме CBC, оба в формате a32.
     2. Преобразует данные и ключ из формата a32 в строку байтов.
     3. Выполняет расшифровку AES в режиме CBC с использованием преобразованных данных и ключа.
     4. Преобразует расшифрованные данные обратно в формат a32.
     5. Возвращает расшифрованные данные в формате a32.

    ```
    A - Данные в формате a32, Ключ в формате a32
    |
    -- a32_to_str
    |
    B - Данные в строковом формате, Ключ в строковом формате
    |
    -- aes_cbc_decrypt
    |
    C - Расшифрованные данные в строковом формате
    |
    -- str_to_a32
    |
    D - Расшифрованные данные в формате a32
    ```

    Примеры:
    ```python
    >>> data = (3221225472, 3221225472, 3221225472)
    >>> key = [0] * 4
    >>> aes_cbc_decrypt_a32(data, key)
    (1, 2, 3)
    ```
    """
    ...
```

### `base64urldecode`

```python
def base64urldecode(data):
    """Декодирует строку в кодировке Base64 URL.

    Args:
        data (str): Строка в кодировке Base64 URL.

    Returns:
        bytes: Декодированная строка.

    Как работает функция:
     1. Функция принимает строку `data` в кодировке Base64 URL в качестве входных данных.
     2. Добавляет padding к строке, если это необходимо для правильной декодировки Base64.
     3. Заменяет символы, специфичные для кодировки Base64 URL, на стандартные символы Base64.
     4. Декодирует строку с использованием `base64.b64decode`.
     5. Возвращает декодированную строку.

    ```
    A - Строка в кодировке Base64 URL
    |
    -- Добавление отступов
    |
    B - Строка с отступами
    |
    -- Замена символов
    |
    C - Строка со стандартными символами Base64
    |
    -- base64.b64decode
    |
    D - Декодированная строка
    ```

    Примеры:
    ```python
    >>> base64urldecode('YTBiMQ')
    b'a0b1'
    ```
    """
    ...
```

### `base64_to_a32`

```python
def base64_to_a32(s):
    """Декодирует строку Base64 URL и преобразует ее в список 32-битных целых чисел.

    Args:
        s (str): Строка Base64 URL для преобразования.

    Returns:
        tuple[int]: Список 32-битных целых чисел, полученный из строки Base64 URL.

    Как работает функция:
     1. Функция принимает строку `s` в кодировке Base64 URL в качестве входных данных.
     2. Декодирует строку Base64 URL с использованием `base64urldecode`.
     3. Преобразует декодированную строку в список 32-битных целых чисел с использованием `str_to_a32`.
     4. Возвращает список 32-битных целых чисел.

    ```
    A - Строка Base64 URL
    |
    -- base64urldecode
    |
    B - Декодированная строка
    |
    -- str_to_a32
    |
    C - Список 32-битных целых чисел
    ```

    Примеры:
    ```python
    >>> base64_to_a32('YTBiMQ')
    (1633837824,)
    ```
    """
    ...
```

### `base64urlencode`

```python
def base64urlencode(data):
    """Кодирует строку в кодировку Base64 URL.

    Args:
        data (bytes): Строка для кодирования.

    Returns:
        str: Строка, закодированная в кодировке Base64 URL.

    Как работает функция:
     1. Функция принимает строку `data` в качестве входных данных.
     2. Кодирует строку в Base64 с использованием `base64.b64encode`.
     3. Заменяет символы, специфичные для стандартной кодировки Base64, на символы, используемые в кодировке Base64 URL.
     4. Возвращает закодированную строку.

    ```
    A - Строка для кодирования
    |
    -- base64.b64encode
    |
    B - Закодированная строка Base64
    |
    -- Замена символов
    |
    C - Закодированная строка Base64 URL
    ```

    Примеры:
    ```python
    >>> base64urlencode(b'test')
    'dGVzdA'
    ```
    """
    ...
```

### `a32_to_base64`

```python
def a32_to_base64(a):
    """Преобразует список 32-битных целых чисел в строку Base64 URL.

    Args:
        a (list[int]): Список 32-битных целых чисел для преобразования.

    Returns:
        str: Строка Base64 URL, полученная из списка целых чисел.

    Как работает функция:
     1. Функция принимает список 32-битных целых чисел `a` в качестве входных данных.
     2. Преобразует список целых чисел в строку байтов с использованием `a32_to_str`.
     3. Кодирует строку байтов в кодировку Base64 URL с использованием `base64urlencode`.
     4. Возвращает закодированную строку.

    ```
    A - Список 32-битных целых чисел
    |
    -- a32_to_str
    |
    B - Строка байтов
    |
    -- base64urlencode
    |
    C - Строка Base64 URL
    ```

    Примеры:
    ```python
    >>> a32_to_base64([1, 2, 3])
    'AAAAAQAAAAIAAAAD'
    ```
    """
    ...
```

### `get_chunks`

```python
def get_chunks(size):
    """Разбивает размер файла на чанки для загрузки.

    Args:
        size (int): Размер файла в байтах.

    Returns:
        dict: Словарь, где ключи - это начальные позиции чанков, а значения - их размеры.

    Как работает функция:
     1. Функция принимает размер файла `size` в байтах в качестве входных данных.
     2. Инициализирует пустой словарь `chunks` для хранения чанков.
     3. Определяет размер чанков на основе размера файла, чтобы оптимизировать загрузку.
     4. Разбивает файл на чанки разных размеров и добавляет их в словарь `chunks`.
     5. Возвращает словарь `chunks`, содержащий информацию о чанках.

    ```
    A - Размер файла в байтах
    |
    -- Определение размера чанков
    |
    B - Разбиение файла на чанки
    |
    -- Добавление чанков в словарь
    |
    C - Словарь чанков
    ```

    Примеры:
    ```python
    >>> get_chunks(1024)
    {0: 1024}
    ```
    """
    ...
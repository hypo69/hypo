# Модуль для администрирования Telegram-бота цифрового магазина
=================================================================

Модуль содержит набор обработчиков для администрирования Telegram-бота цифрового магазина.
Он включает в себя функции для управления пользователями, продуктами, категориями и статистикой.

## Оглавление
- [Обзор](#обзор)
- [Подробнее](#подробнее)
- [Классы](#классы)
    - [AddProduct](#addproduct)
- [Функции](#функции)
    - [start_admin](#start_admin)
    - [admin_statistic](#admin_statistic)
    - [admin_process_cancel](#admin_process_cancel)
    - [admin_process_start_dell](#admin_process_start_dell)
    - [admin_process_products](#admin_process_products)
    - [admin_process_add_product](#admin_process_add_product)
    - [admin_process_name](#admin_process_name)
    - [admin_process_description](#admin_process_description)
    - [admin_process_category](#admin_process_category)
    - [admin_process_price](#admin_process_price)
    - [admin_process_without_file](#admin_process_without_file)
    - [admin_process_hidden_content](#admin_process_hidden_content)
    - [admin_process_confirm_add](#admin_process_confirm_add)

## Обзор

Этот модуль содержит набор функций, предназначенных для администрирования Telegram-бота цифрового магазина. Он включает в себя обработчики для управления пользователями, продуктами, категориями и статистикой. Модуль использует библиотеку aiogram для взаимодействия с Telegram API и SQLAlchemy для работы с базой данных.

## Подробнее

Модуль `admin.py` содержит роутер `admin_router`, который обрабатывает различные callback-запросы и текстовые сообщения от администраторов бота. Он использует FSM (Finite State Machine) для управления состоянием при добавлении новых продуктов. Также модуль включает функции для получения статистики, удаления продуктов и отмены текущих операций.

## Классы

### `AddProduct`

**Описание**:
Класс `AddProduct` представляет собой группу состояний (стейтов) для процесса добавления нового товара в базу данных.

**Принцип работы**:
Класс `AddProduct` определяет последовательность шагов, необходимых для сбора информации о новом продукте от администратора. Каждый атрибут класса представляет собой состояние, в котором бот ожидает определенную информацию от пользователя (например, название, описание, цену). FSMContext используется для управления переходом между этими состояниями.

**Атрибуты**:
- `name` (State): Состояние ожидания ввода названия товара.
- `description` (State): Состояние ожидания ввода описания товара.
- `price` (State): Состояние ожидания ввода цены товара.
- `file_id` (State): Состояние ожидания отправки file_id товара.
- `category_id` (State): Состояние ожидания выбора категории товара.
- `hidden_content` (State): Состояние ожидания ввода скрытого контента товара.
- `confirm_add` (State): Состояние ожидания подтверждения добавления товара.

## Функции

### `start_admin`

```python
async def start_admin(call: CallbackQuery):
    """
    Обрабатывает callback-запрос для входа в админ-панель.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.

    Raises:
        Exception: Если происходит ошибка при открытии админ-панели.

    Example:
        Пример вызова функции:
        await start_admin(call)
    """
```

**Назначение**:
Функция `start_admin` обрабатывает callback-запрос с данными "admin_panel". Она проверяет, имеет ли пользователь право доступа к админ-панели, и отправляет ему сообщение с клавиатурой для выбора действий.

**Как работает функция**:

1.  Функция отвечает на callback-запрос, чтобы уведомить пользователя о том, что запрос обрабатывается.
2.  Пытается отредактировать сообщение, вызвавшее callback-запрос, чтобы отобразить интерфейс админ-панели.
3.  Если редактирование сообщения не удалось (например, сообщение было удалено), функция пытается отправить новое сообщение с интерфейсом админ-панели.
4.  Если отправка нового сообщения также не удалась, функция отправляет сообщение об ошибке.

**ASCII Flowchart**:

```
A[Проверка доступа к админ-панели]
|
B[Ответ на CallbackQuery]
|
C[Попытка редактирования сообщения с интерфейсом админ-панели]
|
D[Если редактирование не удалось]
|
E[Попытка отправки нового сообщения с интерфейсом админ-панели]
|
F[Если отправка не удалась]
|
G[Отправка сообщения об ошибке]
```

**Примеры**:
```python
# Пример вызова функции start_admin
# Предположим, что у вас есть объект CallbackQuery с данными "admin_panel"
# await start_admin(call)
```

### `admin_statistic`

```python
async def admin_statistic(call: CallbackQuery, session_without_commit: AsyncSession):
    """
    Получает и отображает статистику пользователей и заказов.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        session_without_commit (AsyncSession): Асинхровая сессия SQLAlchemy для выполнения запросов к базе данных без коммита.

    Raises:
        Exception: Если происходит ошибка при получении статистики.

    Example:
        await admin_statistic(call, session_without_commit)
    """
```

**Назначение**:
Функция `admin_statistic` обрабатывает callback-запрос с данными "statistic". Она получает статистику пользователей и заказов из базы данных и отправляет ее администратору в виде сообщения.

**Как работает функция**:

1.  Функция отвечает на callback-запрос, чтобы уведомить пользователя о том, что запрос обрабатывается.
2.  Извлекает статистику пользователей (общее количество, новые за сегодня, неделю, месяц) с помощью `UserDAO.get_statistics`.
3.  Извлекает статистику заказов (платежей) с помощью `PurchaseDao.get_payment_stats`.
4.  Формирует текстовое сообщение, содержащее статистику пользователей и заказов.
5.  Редактирует сообщение, вызвавшее callback-запрос, чтобы отобразить статистику.

**ASCII Flowchart**:

```
A[Ответ на CallbackQuery]
|
B[Получение статистики пользователей]
|
C[Получение статистики заказов]
|
D[Формирование текстового сообщения со статистикой]
|
E[Редактирование сообщения с отображением статистики]
```

**Примеры**:
```python
# Пример вызова функции admin_statistic
# await admin_statistic(call, session_without_commit)
```

### `admin_process_cancel`

```python
async def admin_process_cancel(call: CallbackQuery, state: FSMContext):
    """
    Отменяет текущий сценарий добавления товара.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Raises:
        Exception: Если происходит ошибка при отмене сценария.

    Example:
        await admin_process_cancel(call, state)
    """
```

**Назначение**:
Функция `admin_process_cancel` обрабатывает callback-запрос с данными "cancel". Она отменяет текущий сценарий добавления товара, очищает состояние пользователя и отправляет сообщение об отмене.

**Как работает функция**:

1.  Очищает состояние пользователя с помощью `state.clear()`, чтобы сбросить все введенные данные.
2.  Отвечает на callback-запрос, чтобы уведомить пользователя об отмене сценария.
3.  Удаляет сообщение, вызвавшее callback-запрос.
4.  Отправляет новое сообщение с подтверждением отмены добавления товара.

**ASCII Flowchart**:

```
A[Очистка состояния пользователя]
|
B[Ответ на CallbackQuery]
|
C[Удаление сообщения]
|
D[Отправка сообщения об отмене]
```

**Примеры**:
```python
# Пример вызова функции admin_process_cancel
# await admin_process_cancel(call, state)
```

### `admin_process_start_dell`

```python
async def admin_process_start_dell(call: CallbackQuery, session_without_commit: AsyncSession):
    """
    Начинает процесс удаления товаров, отображая список всех товаров в базе данных.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        session_without_commit (AsyncSession): Асинхровая сессия SQLAlchemy для выполнения запросов к базе данных без коммита.

    Raises:
        Exception: Если происходит ошибка при получении списка товаров.

    Example:
        await admin_process_start_dell(call, session_without_commit)
    """
```

**Назначение**:
Функция `admin_process_start_dell` обрабатывает callback-запрос с данными "delete_product". Она извлекает список всех товаров из базы данных и отправляет их администратору в виде сообщений с кнопками для удаления.

**Как работает функция**:

1.  Отвечает на callback-запрос, чтобы уведомить пользователя о начале процесса удаления.
2.  Извлекает список всех товаров из базы данных с помощью `ProductDao.find_all`.
3.  Редактирует сообщение, вызвавшее callback-запрос, чтобы отобразить информацию о количестве товаров в базе данных.
4.  Для каждого товара в списке формирует текстовое описание, включающее название, описание, цену и наличие файла.
5.  Отправляет сообщение с описанием товара и кнопкой для удаления. Если у товара есть файл, отправляет файл вместе с описанием.

**ASCII Flowchart**:

```
A[Ответ на CallbackQuery]
|
B[Получение списка всех товаров из базы данных]
|
C[Редактирование сообщения с информацией о количестве товаров]
|
D[Для каждого товара в списке]
|
E[Формирование текстового описания товара]
|
F[Отправка сообщения с описанием товара и кнопкой для удаления]
```

**Примеры**:
```python
# Пример вызова функции admin_process_start_dell
# await admin_process_start_dell(call, session_without_commit)
```

### `admin_process_products`

```python
async def admin_process_products(call: CallbackQuery, session_without_commit: AsyncSession):
    """
    Обрабатывает запрос на управление товарами, отображая доступные действия.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        session_without_commit (AsyncSession): Асинхровая сессия SQLAlchemy для выполнения запросов к базе данных без коммита.

    Raises:
        Exception: Если происходит ошибка при получении количества товаров.

    Example:
        await admin_process_products(call, session_without_commit)
    """
```

**Назначение**:
Функция `admin_process_products` обрабатывает callback-запрос с данными "process_products". Она получает количество всех товаров из базы данных и отправляет администратору сообщение с клавиатурой для выбора действий (добавление, удаление, редактирование).

**Как работает функция**:

1.  Отвечает на callback-запрос, чтобы уведомить пользователя о начале процесса управления товарами.
2.  Получает количество всех товаров из базы данных с помощью `ProductDao.count`.
3.  Редактирует сообщение, вызвавшее callback-запрос, чтобы отобразить количество товаров и клавиатуру для выбора действий.

**ASCII Flowchart**:

```
A[Ответ на CallbackQuery]
|
B[Получение количества всех товаров из базы данных]
|
C[Редактирование сообщения с количеством товаров и клавиатурой действий]
```

**Примеры**:
```python
# Пример вызова функции admin_process_products
# await admin_process_products(call, session_without_commit)
```

### `admin_process_add_product`

```python
async def admin_process_add_product(call: CallbackQuery, state: FSMContext):
    """
    Запускает сценарий добавления нового товара.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Raises:
        Exception: Если происходит ошибка при запуске сценария.

    Example:
        await admin_process_add_product(call, state)
    """
```

**Назначение**:
Функция `admin_process_add_product` обрабатывает callback-запрос с данными "add_product". Она запускает сценарий добавления нового товара, отправляет администратору сообщение с запросом названия товара и устанавливает состояние `AddProduct.name`.

**Как работает функция**:

1.  Отвечает на callback-запрос, чтобы уведомить пользователя о начале сценария добавления товара.
2.  Удаляет сообщение, вызвавшее callback-запрос.
3.  Отправляет новое сообщение с запросом названия товара и клавиатурой для отмены.
4.  Обновляет данные состояния, сохраняя ID последнего отправленного сообщения.
5.  Устанавливает состояние `AddProduct.name`, чтобы ожидать ввод названия товара.

**ASCII Flowchart**:

```
A[Ответ на CallbackQuery]
|
B[Удаление сообщения]
|
C[Отправка сообщения с запросом названия товара и клавиатурой отмены]
|
D[Обновление данных состояния с ID последнего сообщения]
|
E[Установка состояния AddProduct.name]
```

**Примеры**:
```python
# Пример вызова функции admin_process_add_product
# await admin_process_add_product(call, state)
```

### `admin_process_name`

```python
async def admin_process_name(message: Message, state: FSMContext):
    """
    Обрабатывает введенное администратором название товара и запрашивает описание товара.

    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Raises:
        Exception: Если происходит ошибка при обработке сообщения.

    Example:
        await admin_process_name(message, state)
    """
```

**Назначение**:
Функция `admin_process_name` обрабатывает текстовое сообщение с названием товара. Она сохраняет название товара в состоянии пользователя, удаляет предыдущее сообщение с запросом названия и отправляет сообщение с запросом описания товара.

**Как работает функция**:

1.  Сохраняет название товара в состоянии пользователя с помощью `state.update_data`.
2.  Удаляет предыдущее сообщение с запросом названия товара с помощью `process_dell_text_msg`.
3.  Отправляет новое сообщение с запросом описания товара и клавиатурой для отмены.
4.  Обновляет данные состояния, сохраняя ID последнего отправленного сообщения.
5.  Устанавливает состояние `AddProduct.description`, чтобы ожидать ввод описания товара.

**ASCII Flowchart**:

```
A[Сохранение названия товара в состоянии пользователя]
|
B[Удаление предыдущего сообщения с запросом названия]
|
C[Отправка сообщения с запросом описания товара и клавиатурой отмены]
|
D[Обновление данных состояния с ID последнего сообщения]
|
E[Установка состояния AddProduct.description]
```

**Примеры**:
```python
# Пример вызова функции admin_process_name
# await admin_process_name(message, state)
```

### `admin_process_description`

```python
async def admin_process_description(message: Message, state: FSMContext, session_without_commit: AsyncSession):
    """
    Обрабатывает введенное администратором описание товара и запрашивает категорию товара.

    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.
        session_without_commit (AsyncSession): Асинхровая сессия SQLAlchemy для выполнения запросов к базе данных без коммита.

    Raises:
        Exception: Если происходит ошибка при обработке сообщения.

    Example:
        await admin_process_description(message, state, session_without_commit)
    """
```

**Назначение**:
Функция `admin_process_description` обрабатывает HTML-текст с описанием товара. Она сохраняет описание товара в состоянии пользователя, удаляет предыдущее сообщение с запросом описания и отправляет сообщение с клавиатурой для выбора категории товара.

**Как работает функция**:

1.  Сохраняет HTML-текст с описанием товара в состоянии пользователя с помощью `state.update_data`.
2.  Удаляет предыдущее сообщение с запросом описания товара с помощью `process_dell_text_msg`.
3.  Извлекает список всех категорий из базы данных с помощью `CategoryDao.find_all`.
4.  Отправляет новое сообщение с клавиатурой для выбора категории товара.
5.  Обновляет данные состояния, сохраняя ID последнего отправленного сообщения.
6.  Устанавливает состояние `AddProduct.category_id`, чтобы ожидать выбор категории товара.

**ASCII Flowchart**:

```
A[Сохранение HTML-текста с описанием товара в состоянии пользователя]
|
B[Удаление предыдущего сообщения с запросом описания]
|
C[Извлечение списка всех категорий из базы данных]
|
D[Отправка сообщения с клавиатурой для выбора категории товара]
|
E[Обновление данных состояния с ID последнего сообщения]
|
F[Установка состояния AddProduct.category_id]
```

**Примеры**:
```python
# Пример вызова функции admin_process_description
# await admin_process_description(message, state, session_without_commit)
```

### `admin_process_category`

```python
async def admin_process_category(call: CallbackQuery, state: FSMContext):
    """
    Обрабатывает выбор категории товара и запрашивает цену товара.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Raises:
        Exception: Если происходит ошибка при обработке callback-запроса.

    Example:
        await admin_process_category(call, state)
    """
```

**Назначение**:
Функция `admin_process_category` обрабатывает callback-запрос с данными, указывающими на выбранную категорию товара. Она извлекает ID категории из данных callback-запроса, сохраняет его в состоянии пользователя и отправляет сообщение с запросом цены товара.

**Как работает функция**:

1.  Извлекает ID категории из данных callback-запроса.
2.  Сохраняет ID категории в состоянии пользователя с помощью `state.update_data`.
3.  Отвечает на callback-запрос, чтобы уведомить пользователя об успешном выборе категории.
4.  Редактирует сообщение, вызвавшее callback-запрос, чтобы отобразить запрос цены товара и клавиатуру для отмены.
5.  Обновляет данные состояния, сохраняя ID последнего отредактированного сообщения.
6.  Устанавливает состояние `AddProduct.price`, чтобы ожидать ввод цены товара.

**ASCII Flowchart**:

```
A[Извлечение ID категории из данных CallbackQuery]
|
B[Сохранение ID категории в состоянии пользователя]
|
C[Ответ на CallbackQuery об успешном выборе категории]
|
D[Редактирование сообщения с запросом цены товара и клавиатурой отмены]
|
E[Обновление данных состояния с ID последнего сообщения]
|
F[Установка состояния AddProduct.price]
```

**Примеры**:
```python
# Пример вызова функции admin_process_category
# await admin_process_category(call, state)
```

### `admin_process_price`

```python
async def admin_process_price(message: Message, state: FSMContext):
    """
    Обрабатывает введенную администратором цену товара и запрашивает файл товара.

    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Raises:
        ValueError: Если введенное значение не является числом.
        Exception: Если происходит ошибка при обработке сообщения.

    Example:
        await admin_process_price(message, state)
    """
```

**Назначение**:
Функция `admin_process_price` обрабатывает текстовое сообщение с ценой товара. Она проверяет, является ли введенное значение числом, сохраняет цену в состоянии пользователя и отправляет сообщение с запросом файла товара.

**Как работает функция**:

1.  Пытается преобразовать введенное значение в целое число.
2.  Если преобразование удалось, сохраняет цену в состоянии пользователя с помощью `state.update_data`.
3.  Удаляет предыдущее сообщение с запросом цены товара с помощью `process_dell_text_msg`.
4.  Отправляет новое сообщение с запросом файла товара и клавиатурой для выбора (с файлом или без файла).
5.  Обновляет данные состояния, сохраняя ID последнего отправленного сообщения.
6.  Устанавливает состояние `AddProduct.file_id`, чтобы ожидать отправку файла товара.
7.  Если преобразование не удалось, отправляет сообщение об ошибке и просит ввести числовое значение.

**ASCII Flowchart**:

```
A[Попытка преобразования введенного значения в целое число]
|
B[Если преобразование удалось]
|
C[Сохранение цены в состоянии пользователя]
|
D[Удаление предыдущего сообщения с запросом цены]
|
E[Отправка сообщения с запросом файла товара и клавиатурой выбора]
|
F[Обновление данных состояния с ID последнего сообщения]
|
G[Установка состояния AddProduct.file_id]
|
H[Если преобразование не удалось]
|
I[Отправка сообщения об ошибке и запросе числового значения]
```

**Примеры**:
```python
# Пример вызова функции admin_process_price
# await admin_process_price(message, state)
```

### `admin_process_without_file`

```python
async def admin_process_without_file(call: CallbackQuery, state: FSMContext):
    """
    Обрабатывает выбор администратором опции "без файла" для товара и запрашивает скрытый контент товара.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Raises:
        Exception: Если происходит ошибка при обработке callback-запроса.

    Example:
        await admin_process_without_file(call, state)
    """
```

**Назначение**:
Функция `admin_process_without_file` обрабатывает callback-запрос с данными "without_file". Она сохраняет информацию об отсутствии файла в состоянии пользователя и отправляет сообщение с запросом скрытого контента товара.

**Как работает функция**:

1.  Сохраняет значение `None` для file_id в состоянии пользователя с помощью `state.update_data`.
2.  Отвечает на callback-запрос, чтобы уведомить пользователя об отсутствии выбранного файла.
3.  Редактирует сообщение, вызвавшее callback-запрос, чтобы отобразить запрос скрытого контента товара и клавиатуру для отмены.
4.  Обновляет данные состояния, сохраняя ID последнего отредактированного сообщения.
5.  Устанавливает состояние `AddProduct.hidden_content`, чтобы ожидать ввод скрытого контента товара.

**ASCII Flowchart**:

```
A[Сохранение значения None для file_id в состоянии пользователя]
|
B[Ответ на CallbackQuery об отсутствии выбранного файла]
|
C[Редактирование сообщения с запросом скрытого контента товара и клавиатурой отмены]
|
D[Обновление данных состояния с ID последнего сообщения]
|
E[Установка состояния AddProduct.hidden_content]
```

**Примеры**:
```python
# Пример вызова функции admin_process_without_file
# await admin_process_without_file(call, state)
```

### `admin_process_hidden_content`

```python
async def admin_process_hidden_content(message: Message, state: FSMContext, session_without_commit: AsyncSession):
    """
    Обрабатывает введенный администратором скрытый контент товара и отображает подтверждение добавления товара.

    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.
        session_without_commit (AsyncSession): Асинхровая сессия SQLAlchemy для выполнения запросов к базе данных без коммита.

    Raises:
        Exception: Если происходит ошибка при обработке сообщения.

    Example:
        await admin_process_hidden_content(message, state, session_without_commit)
    """
```

**Назначение**:
Функция `admin_process_hidden_content` обрабатывает HTML-текст с скрытым контентом товара. Она сохраняет скрытый контент в состоянии пользователя, извлекает информацию о товаре и категории из состояния и базы данных, формирует сообщение с подтверждением добавления товара и отправляет его администратору.

**Как работает функция**:

1.  Сохраняет HTML-текст с скрытым контентом в состоянии пользователя с помощью `state.update_data`.
2.  Извлекает данные о товаре из состояния пользователя с помощью `state.get_data`.
3.  Извлекает информацию о категории товара из базы данных с помощью `CategoryDao.find_one_or_none_by_id`.
4.  Формирует текстовое описание товара, включающее название, описание, цену, скрытый контент и категорию.
5.  Удаляет предыдущее сообщение с запросом скрытого контента с помощью `process_dell_text_msg`.
6.  Если у товара есть файл, отправляет файл вместе с описанием и клавиатурой для подтверждения.
7.  Если у товара нет файла, отправляет сообщение с описанием и клавиатурой для подтверждения.
8.  Обновляет данные состояния, сохраняя ID последнего отправленного сообщения.
9.  Устанавливает состояние `AddProduct.confirm_add`, чтобы ожидать подтверждения добавления товара.

**ASCII Flowchart**:

```
A[Сохранение HTML-текста с скрытым контентом в состоянии пользователя]
|
B[Извлечение данных о товаре из состояния пользователя]
|
C[Извлечение информации о категории товара из базы данных]
|
D[Формирование текстового описания товара]
|
E[Удаление предыдущего сообщения с запросом скрытого контента]
|
F[Если у товара есть файл]
|
G[Отправка файла с описанием и клавиатурой подтверждения]
|
H[Если у товара нет файла]
|
I[Отправка сообщения с описанием и клавиатурой подтверждения]
|
J[Обновление данных состояния с ID последнего сообщения]
|
K[Установка состояния AddProduct.confirm_add]
```

**Примеры**:
```python
# Пример вызова функции admin_process_hidden_content
# await admin_process_hidden_content(message, state, session_without_commit)
```

### `admin_process_confirm_add`

```python
async def admin_process_confirm_add(call: CallbackQuery, state: FSMContext, session_with_commit: AsyncSession):
    """
    Подтверждает добавление товара в базу данных и завершает сценарий добавления товара.

    Args:
        call (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.
        session_with_commit (AsyncSession): Асинхровая сессия SQLAlchemy для выполнения запросов к базе данных с коммитом.

    Raises:
        Exception: Если происходит ошибка при добавлении товара в базу данных.

    Example:
        await admin_process_confirm_add(call, state, session_with_commit)
    """
```

**Назначение**:
Функция `admin_process_confirm_add` обрабатывает callback-запрос с данными "confirm_add". Она извлекает данные о товаре из состояния пользователя, добавляет товар в базу данных и отправляет сообщение об успешном добавлении товара.

**Как работает функция**:

1.  Отвечает на callback-запрос, чтобы уведомить пользователя о начале процесса сохранения файла.
2.  Извлекает данные о товаре из состояния пользователя с помощью `state.get_data`.
3.  Удаляет сообщение с подтверждением добавления товара.
4.  Удаляет ключ "last_msg_id" из данных о товаре.
5.  Добавляет товар в базу данных с помощью `ProductDao.add`.
6.  Отправляет сообщение об успешном добавлении товара и клавиатуру для выбора действий в админ-панели.

**ASCII Flowchart**:

```
A[Ответ на CallbackQuery о начале сохранения файла]
|
B[Извлечение данных о товаре из состояния пользователя]
|
C[Удаление сообщения с подтверждением добавления товара]
|
D[Удаление ключа "last_msg_id" из данных о товаре]
|
E[Добавление товара в базу данных]
|
F[Отправка сообщения об успешном добавлении товара и клавиатуры админ-панели]
```

**Примеры**:
```python
# Пример вызова функции admin_process_confirm_add
# await admin_process_confirm_add(call, state, session_with_commit)
```
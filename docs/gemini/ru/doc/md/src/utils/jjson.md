# Модуль `hypotez/src/utils/jjson.py`

## Обзор

Модуль `jjson` предоставляет функции для работы с JSON и CSV файлами, включая загрузку, выгрузку и слияние данных. Он поддерживает преобразование данных в объекты `SimpleNamespace` для удобной работы, а также обеспечивает обработку исключений и логирование.

## Функции

### `j_dumps`

**Описание**: Функция выгружает данные в JSON-формат в файл или возвращает их как словарь, если путь к файлу не указан.

**Параметры**:

- `data` (Dict | SimpleNamespace | List[Dict] | List[SimpleNamespace]): JSON-совместимые данные или объекты `SimpleNamespace`.
- `file_path` (Optional[Path], optional): Путь к выходному файлу. Если `None`, возвращает JSON-данные как словарь. По умолчанию `None`.
- `ensure_ascii` (bool, optional): Если `True`, экранирует не-ASCII символы в выводе. По умолчанию `True`.
- `mode` (str, optional): Режим открытия файла ('w', 'a+', '+a'). По умолчанию 'w'.
- `exc_info` (bool, optional): Если `True`, логирует исключения с трассировкой стека. По умолчанию `True`.

**Возвращает**:

- Optional[Dict]: JSON-данные как словарь при успехе, или `None` при ошибке.

**Возможные исключения**:

- `ValueError`: Если режим файла не поддерживается.
- `Exception`: При любых других ошибках при работе с файлом или данными.  Обработка исключений с подробной информацией о ошибке в лог.


### `j_loads`

**Описание**: Функция загружает данные из JSON или CSV файла, директории или строки.

**Параметры**:

- `jjson` (Path | dict | str): Путь к файлу, директории, JSON-данные как строка или JSON-объект.
- `ordered` (bool, optional): Если `True`, возвращает `OrderedDict` для сохранения порядка элементов. По умолчанию `True`.
- `exc_info` (bool, optional): Если `True`, логирует исключения с трассировкой стека. По умолчанию `True`.

**Возвращает**:

- Any: Словарь или список словарей при успехе, или `None` при ошибке.

**Возможные исключения**:

- `FileNotFoundError`: Если указанный файл не найден.
- `json.JSONDecodeError`: Если JSON-данные не удалось разобрать.
- `Exception`: При любых других ошибках при работе с файлом или данными. Обработка исключений с подробной информацией о ошибке в лог.


### `j_loads_ns`

**Описание**: Функция загружает данные из JSON или CSV файла, директории или строки и преобразует их в объекты `SimpleNamespace`.

**Параметры**:

- `jjson` (Path | SimpleNamespace | Dict | str): Путь к файлу, директории, JSON-данные как строка или JSON-объект.
- `ordered` (bool, optional): Если `True`, возвращает `OrderedDict` для сохранения порядка элементов. По умолчанию `False`.
- `exc_info` (bool, optional): Если `True`, логирует исключения с трассировкой стека. По умолчанию `True`.

**Возвращает**:

- Optional[SimpleNamespace | List[SimpleNamespace]]: Возвращает `SimpleNamespace` или список `SimpleNamespace` объектов при успехе. Возвращает `None` если `jjson` не найден или не может быть прочитан.

**Возможные исключения**:

- То же, что и у функции `j_loads`.


### `replace_key_in_json`

**Описание**: Рекурсивно заменяет ключ в словаре или списке.

**Параметры**:

- `data` (dict | list): Словарь или список, где происходит замена ключа.
- `old_key` (str): Ключ, который нужно заменить.
- `new_key` (str): Новый ключ.

**Возвращает**:

- dict: Обновленный словарь с заменёнными ключами.

**Пример использования**:

```python
data = {"name": "Иван"}
updated_data = replace_key_in_json(data, "name", "category_name")
print(updated_data)  # Output: {'category_name': 'Иван'}
```


### `process_json_file`

**Описание**: Обрабатывает JSON-файл, заменяя ключ `name` на `category_name`.

**Параметры**:

- `json_file`: Путь к JSON файлу.

**Возможные исключения**:

- `Exception`: При любых ошибках во время обработки файла.


### `recursive_process_json_files`

**Описание**: Рекурсивно обходит папки и обрабатывает JSON-файлы.

**Параметры**:

- `directory`: Путь к директории, которую нужно обработать.


### `extract_json_from_string`

**Описание**: Извлекает JSON-контент из строки Markdown между маркерами ```json``` и ```.

**Параметры**:

- `md_string`: Строка Markdown, содержащая JSON.

**Возвращает**:

- str: Извлеченная строка JSON или пустая строка, если не найдено.

**Возможные исключения**:

- `Exception`: При ошибках во время извлечения.
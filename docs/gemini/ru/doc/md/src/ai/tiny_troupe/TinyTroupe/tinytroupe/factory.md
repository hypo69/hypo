# Модуль tinytroupe.factory

## Обзор

Этот модуль предоставляет классы для создания и управления фабриками, используемыми для генерации агентов (например, `TinyPerson`).  Он вводит механизмы кеширования для улучшения производительности, особенно при многократных запросах.

## Классы

### `TinyFactory`

**Описание**: Базовый класс для различных типов фабрик.  Этот класс важен для расширения системы и особенно для транзакционного кеширования.

**Атрибуты**:
- `all_factories`: Словарь, хранящий все созданные фабрики.  Ключ - имя фабрики, значение - экземпляр фабрики.

**Методы**:
- `__init__(self, simulation_id: str = None)`:
    **Описание**: Инициализирует экземпляр `TinyFactory`.
    **Параметры**:
        - `simulation_id` (str, опционально): Идентификатор симуляции. По умолчанию `None`.
    **Возвращает**:
        - `None`

- `__repr__(self)`:
    **Описание**: Возвращает строковое представление объекта фабрики.
    **Возвращает**:
        - `str`

- `set_simulation_for_free_factories(simulation)`:
    **Описание**: Устанавливает симуляцию для свободных фабрик (если она не установлена).
    **Параметры**:
        - `simulation`: Экземпляр симуляции.
    **Возвращает**:
        - `None`

- `add_factory(factory)`:
    **Описание**: Добавляет фабрику в список всех фабрик. Имена фабрик должны быть уникальными.
    **Параметры**:
        - `factory`: Экземпляр фабрики.
    **Возвращает**:
        - `None`
    **Исключения**:
        - `ValueError`: Если фабрика с таким же именем уже существует.

- `clear_factories()`:
    **Описание**: Очищает глобальный список всех фабрик.
    **Возвращает**:
        - `None`


- `encode_complete_state(self) -> dict`:
    **Описание**: Кодирует полное состояние фабрики. Подклассы, содержащие несериализуемые элементы, должны переопределить этот метод.
    **Возвращает**:
        - `dict`: Полное состояние фабрики.


- `decode_complete_state(self, state: dict)`:
    **Описание**: Декодирует полное состояние фабрики. Подклассы, содержащие несериализуемые элементы, должны переопределить этот метод.
    **Параметры**:
        - `state` (dict): Полное состояние фабрики.
    **Возвращает**:
        - `self`: Экземпляр фабрики после декодирования.


### `TinyPersonFactory`

**Описание**: Фабрика для создания агентов типа `TinyPerson`.

**Методы**:
- `__init__(self, context_text, simulation_id: str = None)`:
    **Описание**: Инициализирует экземпляр `TinyPersonFactory`.
    **Параметры**:
        - `context_text` (str): Текст контекста для генерации агентов.
        - `simulation_id` (str, опционально): Идентификатор симуляции. По умолчанию `None`.
    **Возвращает**:
        - `None`


- `generate_person_factories(number_of_factories, generic_context_text)`:
    **Описание**: Генерирует список экземпляров `TinyPersonFactory` с использованием OpenAI LLM.
    **Параметры**:
        - `number_of_factories` (int): Количество экземпляров фабрик.
        - `generic_context_text` (str): Общий текст контекста.
    **Возвращает**:
        - `list`: Список экземпляров `TinyPersonFactory`.
    **Возвращает None** в случае ошибки.

- `generate_person(self, agent_particularities: str = None, temperature: float = 1.5, attempts: int = 5)`:
    **Описание**: Генерирует экземпляр `TinyPerson` с использованием OpenAI LLM.
    **Параметры**:
        - `agent_particularities` (str, опционально): Особенности агента. По умолчанию `None`.
        - `temperature` (float, опционально): Температура для выборки от LLM. По умолчанию `1.5`.
        - `attempts` (int, опционально): Максимальное количество попыток генерации. По умолчанию `5`.
    **Возвращает**:
        - `TinyPerson`: Экземпляр агента `TinyPerson`.
        - `None`: Если генерация не удалась.
    **Исключения**:
        - `Exception`: В случае ошибок во время генерации.

- `_aux_model_call(self, messages, temperature)`:
  **Описание**: Вспомогательный метод для вызова модели. Необходим для использования декоратора `@transactional`.
  **Параметры**:
    - `messages`: Список сообщений для LLM.
    - `temperature`: Температура для выборки.
  **Возвращает**:
    - Ответ модели.

- `_setup_agent(self, agent, configuration)`:
  **Описание**: Подготовка агента с необходимыми элементами.
  **Параметры**:
    - `agent`: Экземпляр агента.
    - `configuration`: Словарь настроек для агента.
  **Возвращает**:
      - `None`

## Функции (статические методы)


## Обработка исключений (`ex`):

В методах присутствуют обработчики исключений с использованием `ex` вместо `e`
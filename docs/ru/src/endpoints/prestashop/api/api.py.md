# Модуль для взаимодействия с PrestaShop API

## Обзор

Модуль предоставляет класс `PrestaShop` для взаимодействия с PrestaShop webservice API, используя JSON и XML для форматирования сообщений. Он поддерживает CRUD операции, поиск и загрузку изображений, а также обработку ошибок для ответов.

## Подробнее

Этот модуль предназначен для упрощения взаимодействия с API PrestaShop. Он позволяет выполнять основные операции, такие как создание, чтение, обновление и удаление (CRUD) ресурсов, а также поиск и загрузку изображений. Модуль включает в себя обработку ошибок, чтобы обеспечить надежное взаимодействие с API PrestaShop.

## Классы

### `Config`

**Описание**: Класс конфигурации для API PrestaShop.

**Принцип работы**:
Класс `Config` предназначен для хранения и управления конфигурационными параметрами, необходимыми для взаимодействия с API PrestaShop. Он определяет параметры, такие как язык, версию PrestaShop, режим работы (разработка или продакшн), формат данных (XML), домен API и ключ API.

**Аттрибуты**:
- `language` (str): Язык, используемый в PrestaShop.
- `ps_version` (str): Версия PrestaShop (по умолчанию '').
- `MODE` (str): Определяет конечную точку API (`dev`, `dev8`, `prod`).
- `POST_FORMAT` (str): Формат отправляемых данных (по умолчанию 'XML').
- `API_DOMAIN` (str): Домен API PrestaShop.
- `API_KEY` (str): Ключ API PrestaShop.

### `PrestaShop`

**Описание**: Класс для взаимодействия с PrestaShop webservice API, использующий JSON и XML для обмена сообщениями.

**Принцип работы**:
Класс `PrestaShop` предоставляет методы для взаимодействия с API PrestaShop, включая CRUD-операции, поиск и загрузку изображений. Класс инициализируется с ключом API, доменом API, форматом данных, идентификатором языка по умолчанию и флагом отладки. Он обеспечивает обработку ошибок для ответов и предоставляет методы для обработки данных API.

**Аттрибуты**:
- `client` (Session): Сессия HTTP-клиента для выполнения запросов.
- `debug` (bool): Флаг отладки.
- `language` (Optional[int]): Идентификатор языка по умолчанию.
- `data_format` (str): Формат данных по умолчанию ('JSON' или 'XML').
- `ps_version` (str): Версия PrestaShop.
- `api_domain` (str): Домен API PrestaShop.
- `api_key` (str): Ключ API PrestaShop.

**Методы**:
- `__init__`: Инициализирует класс `PrestaShop`.
- `ping`: Проверяет, работает ли веб-сервис.
- `_check_response`: Проверяет код состояния ответа и обрабатывает ошибки.
- `_parse_response_error`: Разбирает ответ об ошибке от API PrestaShop.
- `_prepare_url`: Подготавливает URL для запроса.
- `_exec`: Выполняет HTTP-запрос к API PrestaShop.
- `_parse_response`: Разбирает XML или JSON ответ от API в структуру dict.
- `create`: Создает новый ресурс в API PrestaShop.
- `read`: Читает ресурс из API PrestaShop.
- `write`: Обновляет существующий ресурс в API PrestaShop.
- `unlink`: Удаляет ресурс из API PrestaShop.
- `search`: Выполняет поиск ресурсов в API PrestaShop.
- `create_binary`: Загружает двоичный файл в ресурс API PrestaShop.
- `get_schema`: Получает схему заданного ресурса из API PrestaShop.
- `get_data`: Получает данные из ресурса API PrestaShop и сохраняет их.
- `get_apis`: Получает список всех доступных API.
- `upload_image_async`: Асинхронно загружает изображение в API PrestaShop.
- `upload_image_from_url`: Загружает изображение в API PrestaShop.
- `get_product_images`: Получает изображения для продукта.

## Функции

### `main`

```python
def main() -> None:
    """Проверка сущностей Prestashop"""
```

**Назначение**: Функция `main` предназначена для демонстрации и проверки основных операций с API PrestaShop, таких как создание и обновление данных.

**Как работает функция**:
1. **Определение данных**:
   - Определяются данные о налоге (`tax`) в виде словаря (`data`). Эти данные включают ставку налога, статус активности и название налога на разных языках.
   ```
   data: dict = {
        'tax': {
            'rate': 3.000,
            'active': '1',
            'name': {
                'language': {
                    'attrs': {'id': '1'},
                    'value': '3% tax',
                }
            },
        }
    }
   ```
2. **Инициализация API PrestaShop**:
   - Создается экземпляр класса `PrestaShop` с использованием конфигурационных параметров из класса `Config`.
   - Передаются параметры, такие как домен API, ключ API, язык по умолчанию, режим отладки и формат данных.
   ```
   api: PrestaShop = PrestaShop(
        api_domain = Config.API_DOMAIN,
        api_key = Config.API_KEY,
        default_lang = 1,
        debug = True,
        data_format = Config.POST_FORMAT,
    )
   ```
3. **Создание ресурса**:
   - Вызывается метод `create` для создания нового ресурса `taxes` с использованием определенных ранее данных.
   ```
   api.create('taxes', data)
   ```
4. **Обновление ресурса**:
   - Вызывается метод `write` для обновления существующего ресурса `taxes` с использованием тех же данных.
   ```
   api.write('taxes', data)
   ```

**ASCII flowchart**:

```
    Начало
     ↓
Определение данных налога (data)
     ↓
Инициализация API PrestaShop (api)
     ↓
   Создание ресурса taxes
     ↓
  Обновление ресурса taxes
     ↓
     Конец
```

**Примеры**:

```python
# Пример вызова функции main
main()
```
```python
#Пример определения и передача других параметров
data: dict = {
        'tax': {
            'rate': 5.000,
            'active': '0',
            'name': {
                'language': {
                    'attrs': {'id': '1'},
                    'value': '5% tax',
                }
            },
        }
    }
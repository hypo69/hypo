# apps.hendlers

## Обзор

Модуль `apps.hendlers` содержит обработчики для различных команд и запросов, связанных с поиском фильмов и сериалов через Telegram-бота. Он использует библиотеку `aiogram` для обработки входящих сообщений и callback-запросов, а также FSM (Finite State Machine) для управления состоянием диалога с пользователем. Модуль интегрируется с модулем `apps.search` для выполнения поисковых запросов.

## Подробней

Этот модуль является ключевым компонентом Telegram-бота для поиска фильмов. Он обрабатывает команды `/start`, запросы на поиск новых фильмов/сериалов, а также управляет процессом ввода названия фильма/сериала пользователем. FSM используется для последовательного получения параметров поиска (тип и название) от пользователя. После получения всех необходимых данных, модуль обращается к функции `search_query` из модуля `apps.search` для выполнения поиска. Результаты поиска отправляются пользователю в виде отформатированного сообщения.

## Классы

### `Params(StatesGroup)`

**Описание**: Класс `Params` определяет состояния, используемые в FSM для управления процессом ввода параметров поиска фильма.

**Как работает класс**:

Класс `Params` наследуется от `StatesGroup` и определяет два состояния: `type_movie` и `name`. Состояние `type_movie` используется для запроса типа фильма (фильм или сериал), а состояние `name` - для запроса названия фильма/сериала.

**Методы**:

- `type_movie`: Представляет состояние для выбора типа фильма.
- `name`: Представляет состояние для ввода названия фильма.

## Функции

### `command_start_handler(message: Message) -> None`

**Описание**: Обработчик команды `/start`. Отправляет приветственное сообщение пользователю и предлагает найти фильм.

```python
async def command_start_handler(message: Message) -> None:
    """
    Args:
        message (Message): Объект сообщения от пользователя.

    Returns:
        None

    """
```

**Как работает функция**:

Функция `command_start_handler` обрабатывает команду `/start`, отправляя приветственное сообщение пользователю с его именем и предлагает начать поиск фильма, предоставляя пользователю кнопки для выбора действия.

**Параметры**:

- `message` (Message): Объект сообщения, содержащий информацию о сообщении и пользователе.

**Возвращает**:

- `None`

**Примеры**:

```python
# Пример вызова (неявный, вызывается aiogram при получении команды /start)
# await command_start_handler(message)
```

### `movie_handler(callback: CallbackQuery, state: FSMContext) -> None`

**Описание**: Обработчик callback-запроса `new_movies`. Устанавливает состояние `Params.type_movie` и предлагает пользователю указать тип фильма (фильм или сериал).

```python
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Args:
        callback (CallbackQuery): Объект callback-запроса.
        state (FSMContext): Объект FSMContext для управления состоянием.

    Returns:
        None

    """
```

**Как работает функция**:

Функция `movie_handler` вызывается при нажатии на кнопку "new_movies". Она устанавливает состояние `Params.type_movie`, чтобы запросить у пользователя тип фильма для поиска.

**Параметры**:

- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о нажатой кнопке.
- `state` (FSMContext): Объект, используемый для управления состоянием FSM.

**Возвращает**:

- `None`

**Примеры**:

```python
# Пример вызова (неявный, вызывается aiogram при получении callback-запроса с data == 'new_movies')
# await movie_handler(callback, state)
```

### `series_handler(callback: CallbackQuery, state: FSMContext) -> None`

**Описание**: Обработчик callback-запроса `series`. Удаляет предыдущее сообщение, устанавливает тип фильма как `series` в FSM, устанавливает состояние `Params.name` и запрашивает название сериала.

```python
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Args:
        callback (CallbackQuery): Объект callback-запроса.
        state (FSMContext): Объект FSMContext для управления состоянием.

    Returns:
        None

    """
```

**Как работает функция**:

Функция `series_handler` обрабатывает выбор пользователя "сериал". Она удаляет предыдущее сообщение с кнопками выбора типа, сохраняет в FSM, что пользователь ищет сериал, и переходит в состояние ожидания ввода названия сериала.

**Параметры**:

- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о нажатой кнопке.
- `state` (FSMContext): Объект, используемый для управления состоянием FSM.

**Возвращает**:

- `None`

**Примеры**:

```python
# Пример вызова (неявный, вызывается aiogram при получении callback-запроса с data == 'series')
# await series_handler(callback, state)
```

### `film_handler(callback: CallbackQuery, state: FSMContext) -> None`

**Описание**: Обработчик callback-запроса `film`. Удаляет предыдущее сообщение, устанавливает тип фильма как `film` в FSM, устанавливает состояние `Params.name` и запрашивает название фильма.

```python
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Args:
        callback (CallbackQuery): Объект callback-запроса.
        state (FSMContext): Объект FSMContext для управления состоянием.

    Returns:
        None

    """
```

**Как работает функция**:

Функция `film_handler` аналогична `series_handler`, но обрабатывает выбор пользователя "фильм". Она также удаляет предыдущее сообщение с кнопками выбора типа, сохраняет в FSM, что пользователь ищет фильм, и переходит в состояние ожидания ввода названия фильма.

**Параметры**:

- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о нажатой кнопке.
- `state` (FSMContext): Объект, используемый для управления состоянием FSM.

**Возвращает**:

- `None`

**Примеры**:

```python
# Пример вызова (неявный, вызывается aiogram при получении callback-запроса с data == 'film')
# await film_handler(callback, state)
```

### `name_handler(message: Message, state: FSMContext) -> None`

**Описание**: Обработчик сообщений в состоянии `Params.name`. Получает название фильма/сериала от пользователя, выполняет поиск и отправляет результат пользователю.

```python
async def name_handler(message: Message, state: FSMContext) -> None:
    """
    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием.

    Returns:
        None

    """
```

**Как работает функция**:

Функция `name_handler` вызывается, когда пользователь вводит название фильма или сериала. Она сохраняет введенное название в FSM, извлекает из FSM тип фильма (фильм или сериал), выполняет поисковый запрос с использованием функции `search_query` и отправляет результаты пользователю. После этого она очищает состояние FSM и предлагает пользователю найти новый фильм.

**Параметры**:

- `message` (Message): Объект сообщения, содержащий введенное пользователем название фильма/сериала.
- `state` (FSMContext): Объект, используемый для управления состоянием FSM.

**Возвращает**:

- `None`

**Примеры**:

```python
# Пример вызова (неявный, вызывается aiogram при получении сообщения в состоянии Params.name)
# await name_handler(message, state)
```
# Модуль external_client

## Обзор

Модуль `external_client` представляет собой пример XML-RPC клиента для управления Fast API сервером из внешнего кода. Он позволяет запускать, останавливать сервер, добавлять новые маршруты и получать статус серверов.

## Подробней

Этот модуль предоставляет пример использования XML-RPC для взаимодействия с Fast API сервером. Он демонстрирует, как можно управлять сервером извне, используя удаленные вызовы процедур. В частности, показано как запускать и останавливать серверы, добавлять новые маршруты и запрашивать статус серверов. Этот код полезен для автоматизации управления сервером и интеграции с другими системами.

## Функции

### `main`

```python
def main():
    """Основная функция для управления сервером через RPC из внешнего кода."""
    rpc_client = ServerProxy("http://localhost:9000", allow_none=True)
    
    try:
        # Пример: Запуск сервера на порту 8001
        print("Starting server on port 8001...")
        rpc_client.start_server(8001, "127.0.0.1")
        time.sleep(1)
        
        # Пример: Добавление нового маршрута /test_route
        print("Adding new route /test_route...")
        rpc_client.add_new_route("/test_route", 'lambda: {"message": "Hello from test_route"}', ["GET"])
        time.sleep(1)

        # Пример: Получение статуса серверов
        print("Getting server status...")
        rpc_client.status_servers()
        time.sleep(1)

       # Пример: Остановка сервера на порту 8001
        print("Stopping server on port 8001...")
        rpc_client.stop_server(8001)
        time.sleep(1)
        
        # Пример: Получение статуса серверов
        print("Getting server status...")
        rpc_client.status_servers()
        time.sleep(1)

    except Exception as ex:
        print(f"An error occurred: {ex}")
    finally:
        print("Shutting down RPC server")
        rpc_client.shutdown()
```

**Описание**: Основная функция для управления сервером через RPC из внешнего кода.

**Параметры**:

- Отсутствуют

**Возвращает**:

- Отсутствует

**Вызывает исключения**:

- `Exception`: В случае возникновения ошибки при выполнении RPC вызовов.

**Как работает функция**:

1.  Создает XML-RPC клиента для взаимодействия с сервером по адресу `http://localhost:9000`.
2.  Вызывает методы RPC для запуска сервера на порту 8001, добавления нового маршрута `/test_route`, получения статуса серверов и остановки сервера на порту 8001.
3.  Обрабатывает возможные исключения, выводя сообщение об ошибке.
4.  В блоке `finally` вызывает метод `shutdown` для завершения работы RPC сервера.

**Примеры**:

```python
if __name__ == "__main__":
    main()
```
```
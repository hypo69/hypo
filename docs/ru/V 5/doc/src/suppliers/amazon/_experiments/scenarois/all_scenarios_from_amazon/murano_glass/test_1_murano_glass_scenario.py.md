# Модуль для экспериментов с Amazon: сценарий "Муранское стекло" (test_1)

## Обзор

Этот модуль является частью проекта `hypotez` и предназначен для экспериментов с парсингом и загрузкой данных о товарах из Amazon, в частности, товаров из категории "Муранское стекло". Сценарий `test_1` содержит логику для извлечения информации о товаре с заданной страницы Amazon, проверки наличия товара в базе данных PrestaShop, и добавления или обновления информации о товаре в PrestaShop.

## Подробней

Модуль использует библиотеки `pathlib`, `typing`, а также собственные модули `header` для выполнения различных задач, таких как логирование, нормализация строк, работа с продуктами и взаимодействие с API PrestaShop. Основной ход выполнения включает получение URL товара, извлечение данных о товаре, проверку наличия товара в базе данных, загрузку изображений и добавление/обновление информации о товаре в PrestaShop.

## Классы

### `Supplier`

**Описание**: Класс `Supplier` представляет поставщика товаров (в данном случае, Amazon) и содержит методы и атрибуты для работы с данными поставщика, такие как ID поставщика, текущий сценарий, локаторы элементов на странице товара и драйвер браузера.

**Как работает класс**:
Класс инициализируется с префиксом поставщика (`amazon`). В коде создается экземпляр класса `Supplier` с помощью функции `start_supplier(supplier_prefix)`, и этот экземпляр присваивается переменной `s`. Затем устанавливается текущий сценарий, который включает URL товара, условие (новое), категории PrestaShop и правило цены.

**Атрибуты**:
- `supplier_prefix` (str): Префикс поставщика (в данном случае, 'amazon').
- `s` (Supplier): Экземпляр класса `Supplier`, представляющий поставщика Amazon.
- `s.current_scenario` (dict): Словарь, содержащий информацию о текущем сценарии, такую как URL товара, условие, категории PrestaShop и правило цены.
- `s.locators` (dict): Локаторы элементов на странице товара.
- `s.driver`: Драйвер браузера для взаимодействия со страницей товара.
- `s.supplier_id`: ID поставщика.

## Функции

### `start_supplier`

```python
def start_supplier(supplier_prefix: str) -> Supplier:
    """ This if example function
    Args:
        supplier_prefix (str):  строковый префикс, идентифицирующий поставщика, например, "amazon".
    Returns:
        Supplier:  Объект Supplier, настроенный для конкретного поставщика.
    """
```

**Описание**: Функция `start_supplier` инициализирует и возвращает объект класса `Supplier` с заданным префиксом.

**Как работает функция**:
Функция принимает строковый префикс, идентифицирующий поставщика (например, "amazon"), создает и возвращает объект `Supplier`, настроенный для конкретного поставщика.

**Параметры**:
- `supplier_prefix` (str): Строковый префикс, идентифицирующий поставщика, например, "amazon".

**Возвращает**:
- `Supplier`: Объект `Supplier`, настроенный для конкретного поставщика.

### `Product.check_if_product_in_presta_db`

```python
def Product.check_if_product_in_presta_db(product_reference: str) -> Union[int, bool]:
    """ This if example function
    Args:
        product_reference (str): Строка, представляющая собой артикул товара, по которому осуществляется поиск.
    Returns:
        Union[int, bool]: Если товар найден в базе данных PrestaShop, возвращается его ID (целое число). Если товар не найден, возвращается False.
    """
```

**Описание**: Функция `Product.check_if_product_in_presta_db` проверяет, существует ли товар с заданным артикулом в базе данных PrestaShop.

**Как работает функция**:
Функция принимает артикул товара (`product_reference`) и выполняет запрос к базе данных PrestaShop, чтобы проверить, существует ли товар с таким артикулом. Если товар найден, функция возвращает его ID. Если товар не найден, функция возвращает `False`.

**Параметры**:
- `product_reference` (str): Артикул товара, по которому осуществляется поиск.

**Возвращает**:
- `Union[int, bool]`: Если товар найден в базе данных PrestaShop, возвращается его ID (целое число). Если товар не найден, возвращается `False`.

### `Product.grab_product_page`

```python
def Product.grab_product_page(s: Supplier) -> ProductFields:
    """ This if example function
    Args:
        s (Supplier): Объект Supplier, содержащий информацию о поставщике и драйвер браузера.
    Returns:
        ProductFields: Объект ProductFields, содержащий извлеченные данные о товаре.
    """
```

**Описание**: Функция `Product.grab_product_page` извлекает данные о товаре со страницы товара на Amazon.

**Как работает функция**:
Функция принимает объект `Supplier`, содержащий информацию о поставщике и драйвер браузера. Она использует драйвер браузера для извлечения данных о товаре со страницы товара на Amazon и возвращает объект `ProductFields`, содержащий извлеченные данные.

**Параметры**:
- `s` (Supplier): Объект `Supplier`, содержащий информацию о поставщике и драйвер браузера.

**Возвращает**:
- `ProductFields`: Объект `ProductFields`, содержащий извлеченные данные о товаре.

### `Product.upload_image2presta`

```python
def Product.upload_image2presta(image_url: str, product_id: int) -> None:
    """ This if example function
    Args:
        image_url (str): URL изображения товара.
        product_id (int): ID товара в базе данных PrestaShop.
    """
```

**Описание**: Функция `Product.upload_image2presta` загружает изображение товара в PrestaShop.

**Как работает функция**:
Функция принимает URL изображения товара (`image_url`) и ID товара в базе данных PrestaShop (`product_id`). Она загружает изображение товара в PrestaShop, используя API PrestaShop.

**Параметры**:
- `image_url` (str): URL изображения товара.
- `product_id` (int): ID товара в базе данных PrestaShop.

### `d.get_url`

```python
def d.get_url(url: str) -> None:
    """ This if example function
    Args:
        url (str): URL, который необходимо открыть в браузере.
    """
```

**Описание**: Функция `d.get_url` открывает заданный URL в браузере, используя драйвер браузера.

**Как работает функция**:
Функция принимает URL (`url`) и использует драйвер браузера (`d`) для открытия этого URL в браузере.

**Параметры**:
- `url` (str): URL, который необходимо открыть в браузере.

### `_(locator: dict) -> str`

```python
def _(locator: dict) -> str:
    """ This if example function
    Args:
        locator (dict):  Словарь, содержащий информацию о локаторе элемента на странице.
    Returns:
        str: Текст, найденный по локатору.
    """
```

**Описание**: Функция `_` выполняет поиск элемента на странице с использованием заданного локатора и возвращает текст этого элемента.

**Как работает функция**:
Функция принимает словарь `locator`, содержащий информацию о локаторе элемента на странице. Она использует драйвер браузера для поиска элемента на странице с использованием этого локатора и возвращает текст найденного элемента.

**Параметры**:
- `locator` (dict): Словарь, содержащий информацию о локаторе элемента на странице.

**Возвращает**:
- `str`: Текст, найденный по локатору.

### Локальные переменные модуля

- `supplier_prefix`: str = 'amazon' - Префикс поставщика для Amazon.
- `s`: Supplier - Объект поставщика, созданный для Amazon.
- `l`: dict = s.locators.get('product') - Локаторы элементов продукта, полученные из объекта поставщика.
- `d`: Driver = s.driver - Драйвер браузера, полученный из объекта поставщика.
- `ASIN`: str = _(l['ASIN']) - ASIN продукта, извлеченный с использованием локатора.
- `product_reference`: str = f"{s.supplier_id}-{ASIN}" - Ссылка на продукт, сформированная из ID поставщика и ASIN.
- `product_id`: Union[int, bool] = Product.check_if_product_in_presta_db(product_reference) - ID продукта, если он найден в базе данных PrestaShop, иначе False.
- `default_image_url`: str = _(l['additional_images_urls'])[0] - URL изображения продукта по умолчанию.
- `product_fields`: ProductFields = Product.grab_product_page(s) - Объект, содержащий поля продукта, полученные со страницы продукта.
- `product_dict`: dict = {} - Словарь для хранения данных продукта.
- `product_name` - название товара
# Модуль `Wuguokai`

## Обзор

Модуль предоставляет реализацию интерфейса `AbstractProvider` для взаимодействия с моделью `gpt-35-turbo` через API `Wuguokai`. Он использует библиотеку `requests` для выполнения HTTP-запросов и предназначен для генерации текста на основе предоставленных сообщений.

## Подробней

Этот модуль является устаревшим (`deprecated`) и находится в соответствующей директории. Он предназначен для работы с API `Wuguokai` по адресу `https://chat.wuguokai.xyz`. Модуль поддерживает модель `gpt-35-turbo` и использует случайный `userId` для каждого запроса.

## Классы

### `Wuguokai`

**Описание**: Класс `Wuguokai` предоставляет интерфейс для взаимодействия с API `Wuguokai`.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для всех провайдеров.

**Атрибуты**:
- `url` (str): URL API `Wuguokai`.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-35-turbo`.
- `working` (bool): Указывает, работает ли провайдер в данный момент.

**Методы**:
- `create_completion`: Создает завершение текста на основе предоставленных параметров.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool,
    **kwargs: Any,
) -> CreateResult:
    """
    Создает завершение текста на основе предоставленных параметров.

    Args:
        model (str): Имя модели для использования.
        messages (list[dict[str, str]]): Список сообщений для отправки в API.
        stream (bool): Указывает, следует ли возвращать результат в режиме потока.
        **kwargs (Any): Дополнительные параметры.

    Returns:
        CreateResult: Результат завершения текста.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.
    """
```

**Назначение**: Функция `create_completion` отправляет запрос к API `Wuguokai` и возвращает сгенерированный текст.

**Параметры**:
- `model` (str): Имя модели для использования.
- `messages` (list[dict[str, str]]): Список сообщений, где каждый элемент представляет собой словарь с ключами `str`.
- `stream` (bool): Указывает, должен ли ответ быть в потоковом режиме.
- `**kwargs` (Any): Дополнительные аргументы, такие как прокси.

**Возвращает**:
- `CreateResult`: Тип, представляющий собой `Generator[str, None, None]`, который выдает части сгенерированного текста.

**Вызывает исключения**:
- `Exception`: Вызывается, если HTTP-запрос возвращает статус код, отличный от 200.

**Как работает функция**:

1. **Формирование заголовков**: Создаются заголовки HTTP-запроса, включая `user-agent`, `content-type` и другие необходимые параметры.
2. **Формирование данных**: Данные запроса формируются в виде JSON, включая `prompt` (сформированный из сообщений), `options`, `userId` (случайное число) и флаг `usingContext`.
3. **Отправка запроса**: Отправляется POST-запрос к API `https://ai-api20.wuguokai.xyz/api/chat-process` с использованием библиотеки `requests`.
4. **Обработка ответа**:
   - Проверяется статус код ответа. Если код не равен 200, вызывается исключение `Exception`.
   - Ответ разделяется по строке `> 若回答失败请重试或多刷新几次界面后重试`.
   - Возвращается первая или вторая часть разделенного ответа (в зависимости от длины массива `_split`), предварительно очищенная от лишних пробелов.
   Если функция завершается с ошибкой, она возвращает исключение.
   Если функция завершается успешно, она возвращает сгенерированный текст в виде потока.

```
Формирование_заголовков
    ↓
Формирование_данных
    ↓
Отправка_запроса → Проверка_статус_кода
    ↓                                  |
    |                                  Вызвать_исключение
    |
Обработка_ответа → Разделение_ответа
    ↓
Возврат_текста
```

**Примеры**:

```python
# Пример вызова функции
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = False
kwargs = {}

result = Wuguokai.create_completion(model, messages, stream, **kwargs)
for item in result:
    print(item)
```

## Дополнительная информация

Этот модуль использует случайный `userId` для каждого запроса, что может повлиять на консистентность результатов. Также, он содержит хардкод URL и параметры, которые могут потребовать обновления в будущем.
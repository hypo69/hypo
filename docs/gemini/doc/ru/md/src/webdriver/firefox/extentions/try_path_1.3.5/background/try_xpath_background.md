# Модуль try_xpath_background.js

## Обзор

Этот модуль (`try_xpath_background.js`) отвечает за обработку сообщений, полученных от вкладок, и выполнение связанных с этим действий. Он управляет состоянием всплывающего окна, загрузкой пользовательских стилей, хранением результатов поиска и обновлением стилей в активных вкладках.

## Переменные

### `tx`

**Описание**: Псевдоним для глобального объекта `tryxpath`.

### `fu`

**Описание**: Псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Состояние всплывающего окна.

### `popupCss`

**Описание**: CSS-стили, применяемые к всплывающему окну.

### `results`

**Описание**: Хранит результаты поиска.

### `css`

**Описание**: Содержит загруженные CSS-стили.

### `attributes`

**Описание**: Объект, содержащий атрибуты, используемые для идентификации элементов.

### `genericListener.listeners`

**Описание**: Объект, содержащий обработчики сообщений.


## Функции

### `loadDefaultCss()`

**Описание**: Загружает стандартные CSS-стили из файла `try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Возвращает текст загруженного CSS-стиля в виде `Promise`.

**Вызывает исключения**:
- Возможны ошибки при загрузке файла (`XMLHttpRequest`).

### `genericListener(message, sender, sendResponse)`

**Описание**: Общий обработчик сообщений.

**Параметры**:
- `message` (object): Объект с сообщением.
- `sender` (object): Объект отправителя сообщения.
- `sendResponse` (function): Функция для отправки ответа.

**Возвращает**:
- `Boolean` or `undefined`: Возвращает `true` или `undefined`, если обработчик успешно выполнил свою задачу.

**Вызывает исключения**:
- Нет явных исключений.



### `genericListener.listeners.storePopupState(message)`

**Описание**: Устанавливает состояние всплывающего окна.

**Параметры**:
- `message` (object): Объект с сообщением, содержащим состояние.

**Возвращает**:
- `undefined`.

### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Отправляет запрос на восстановление состояния всплывающего окна.

**Параметры**:
- `message` (object): Объект с сообщением.

**Возвращает**:
- `undefined`.

### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Отправляет запрос на вставку стилей в всплывающее окно.

**Возвращает**:
- `undefined`.

### `genericListener.listeners.showAllResults(message, sender)`

**Описание**: Создаёт новую вкладку со списком результатов.

**Параметры**:
- `message` (object): Объект с сообщением, содержащим результаты.
- `sender` (object): Объект отправителя сообщения.

**Возвращает**:
- `undefined`.

### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Отправляет результаты поиска в ответ.

**Параметры**:
- `message` (object): Объект с сообщением.
- `sender` (object): Объект отправителя сообщения.
- `sendResponse` (function): Функция для отправки ответа.

**Возвращает**:
- `Boolean`: Возвращает `true`, чтобы указать, что обработка завершена.

### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Обновляет CSS-стили в активной вкладке.

**Параметры**:
- `message` (object): Объект с сообщением, содержащим новые и удаляемые CSS-стили.
- `sender` (object): Объект отправителя сообщения.


**Вызывает исключения**:
- `fu.onError`: Обрабатывает ошибки при работе с `browser.tabs`.


### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Возвращает конфигурационные данные.

**Параметры**:
- `message` (object): Объект с сообщением.
- `sender` (object): Объект отправителя сообщения.
- `sendResponse` (function): Функция для отправки ответа.

**Возвращает**:
- `Boolean`: Возвращает `true`, чтобы указать, что обработка завершена.


### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Отправляет запрос на установку информации о содержимом.

**Параметры**:
- `message` (object): Объект с сообщением.
- `sender` (object): Объект отправителя сообщения.

**Возвращает**:
- `undefined`.


## Обработчики событий

### `browser.storage.onChanged.addListener`

**Описание**: Обработчик изменений в хранилище настроек. Обновляет глобальные переменные (`attributes`, `css`, `popupCss`).


## Инициализация

### `browser.storage.sync.get`

**Описание**: Получает настройки из синхронизированного хранилища (`browser.storage.sync`).

**Возвращает**:
- `Promise<object>`: Возвращает `Promise` с объектом, содержащим значения из хранилища.

**Вызывает исключения**:
- `fu.onError` при возникновении ошибок.


## Замечания

Этот файл использует API браузера для взаимодействия с вкладками и хранилищем настроек. Он реализует обработчики сообщений, которые позволяют синхронизировать данные между вкладками и всплывающим окном.
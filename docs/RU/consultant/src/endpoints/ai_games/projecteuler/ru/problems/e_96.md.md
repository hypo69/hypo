# Анализ кода модуля e_96.md

**Качество кода: 7/10**

-   **Плюсы:**
    -   Задача и условия четко описаны.
    -   Представлены примеры судоку и объяснение, как вычисляется итоговая сумма.
    -   Дано понимание что необходимо сделать с файлом `sudoku.txt`.
-   **Минусы:**
    -   Отсутствует код для решения задачи.
    -   Не указано, как именно нужно обрабатывать файл `sudoku.txt`.
    -   Нет информации о функциях или классах, необходимых для решения.

**Рекомендации по улучшению**

1.  **Добавить код для решения:** Необходимо реализовать функции для чтения файла `sudoku.txt`, разбора судоку, решения судоку и вычисления суммы первых трехзначных чисел.
2.  **Форматирование reStructuredText (RST):** Документацию необходимо переписать в стиле reStructuredText (RST).
3.  **Обработка ошибок:** Нужно добавить обработку ошибок, чтобы программа не завершалась аварийно.
4.  **Логирование:** Использовать `logger.error` для логирования ошибок и предупреждений.
5.  **Структурирование кода:** Разделить код на логические блоки (функции, классы), что повысит читаемость.

**Оптимизированный код**

```markdown
# Задача No 96
## Судоку
 
## Условия
 
Судоку — это игра-головоломка, в которой игрок должен заполнить таблицу размером 9x9 цифрами от 1 до 9 таким образом, чтобы в каждом столбце, каждой строке и каждом из девяти блоков 3x3 каждая цифра встречалась ровно один раз.
 
Например, следующая головоломка судоку:
 
```
0 0 3 | 0 2 0 | 6 0 0
9 0 0 | 3 0 5 | 0 0 1
0 0 1 | 8 0 6 | 4 0 0
------|-------|------
0 0 8 | 1 0 2 | 9 0 0
7 0 0 | 0 0 0 | 0 0 8
0 0 6 | 7 0 8 | 2 0 0
------|-------|------
0 0 2 | 6 0 9 | 5 0 0
8 0 0 | 2 0 3 | 0 0 9
0 0 5 | 0 1 0 | 3 0 0
```
 
может быть решена с помощью:
 
```
4 8 3 | 9 2 1 | 6 5 7
9 6 7 | 3 4 5 | 8 2 1
2 5 1 | 8 7 6 | 4 9 3
------|-------|------
5 4 8 | 1 3 2 | 9 7 6
7 2 9 | 5 6 4 | 1 3 8
1 3 6 | 7 9 8 | 2 4 5
------|-------|------
3 7 2 | 6 8 9 | 5 1 4
8 1 4 | 2 5 3 | 7 6 9
6 9 5 | 4 1 7 | 3 8 2
```
 
Файл `sudoku.txt` (не включен в это описание) содержит 50 разных судоку-задач.
Решая судоку слева направо, сверху вниз, первый 3-цифровой номер в каждой решённой судоку, формирует число, а сумма этих чисел даёт искомый результат.
 
Например, если первые три решённых судоку:
```
4 8 3 | 9 2 1 | 6 5 7
9 6 7 | 3 4 5 | 8 2 1
2 5 1 | 8 7 6 | 4 9 3
```
```
2 3 7 | 5 1 8 | 4 6 9
9 1 6 | 7 4 2 | 3 8 5
4 5 8 | 9 6 3 | 2 7 1
```
и
```
8 1 4 | 6 5 9 | 7 3 2
7 2 9 | 8 3 4 | 5 1 6
5 6 3 | 1 2 7 | 9 8 4
```
 
Тогда первые 3-значные числа это 483, 237, и 814, соответственно, и их сумма равна 483+237+814 = 1534.
 
**Вопрос:** Какова сумма первых трехзначных чисел в решениях пятидесяти судоку, содержащихся в файле `sudoku.txt`?
 
```python
"""
Модуль для решения задач судоку.
=========================================================================================
 
Этот модуль содержит функции для чтения судоку из файла, решения судоку
и вычисления суммы первых трехзначных чисел решенных судоку.
 
Пример использования
--------------------
 
Пример вызова функции для решения всех судоку из файла:
 
.. code-block:: python
 
    result = solve_sudoku_from_file('sudoku.txt')
    print(f"Сумма первых трехзначных чисел: {result}")
"""
 
from src.utils.jjson import j_loads_ns # импорт j_loads_ns
from src.logger.logger import logger # импорт logger
 
def solve_sudoku(board: list[list[int]]) -> list[list[int]] | None:
    """
    Решает судоку, используя метод обратного отслеживания.
 
    :param board: Список списков целых чисел, представляющий судоку.
    :return: Список списков целых чисел, представляющий решенное судоку, или None, если решения нет.
    """
    def is_valid(board: list[list[int]], row: int, col: int, num: int) -> bool:
        """
        Проверяет, является ли размещение числа в заданной позиции допустимым.
 
        :param board: Список списков целых чисел, представляющий судоку.
        :param row: Индекс строки.
        :param col: Индекс столбца.
        :param num: Число для проверки.
        :return: True, если размещение допустимо, иначе False.
        """
        # Проверка строки
        if num in board[row]:
             return False
 
        # Проверка столбца
        if num in [board[i][col] for i in range(9)]:
            return False
 
        # Проверка блока 3x3
        start_row = row - row % 3
        start_col = col - col % 3
        for i in range(3):
            for j in range(3):
                if board[start_row + i][start_col + j] == num:
                   return False
        return True
 
    def find_empty(board: list[list[int]]) -> tuple[int, int] | None:
        """
        Ищет первую пустую ячейку (со значением 0) в судоку.
 
        :param board: Список списков целых чисел, представляющий судоку.
        :return: Кортеж (row, col) с индексами пустой ячейки или None, если пустых ячеек нет.
        """
        for i in range(9):
            for j in range(9):
                if board[i][j] == 0:
                    return i, j
        return None
 
    def solve() -> bool:
        """
        Рекурсивно решает судоку, используя обратное отслеживание.
 
        :return: True, если судоку решено, иначе False.
        """
        empty_cell = find_empty(board)
        if not empty_cell:
            return True  # судоку решена
 
        row, col = empty_cell
 
        for num in range(1, 10):
            if is_valid(board, row, col, num):
                board[row][col] = num
                if solve():
                    return True
                board[row][col] = 0 # сбрасываем значение, если не подошло
        return False
 
    if solve():
        return board
    return None
 
def read_sudokus_from_file(filename: str) -> list[list[list[int]]] | None:
    """
    Читает судоку из файла.
 
    :param filename: Имя файла с судоку.
    :return: Список списков списков целых чисел, представляющих судоку, или None в случае ошибки.
    """
    try:
        with open(filename, 'r') as file:
            content = file.read().strip()
            sudokus_str = content.split("Grid")
            sudokus = []
            for sudoku_str in sudokus_str[1:]:
                rows = sudoku_str.strip().split("\n")[1:]
                board = []
                for row in rows:
                    board_row = list(map(int, row.replace('|', ' ').strip().split()))
                    board.append(board_row)
                sudokus.append(board)
            return sudokus
    except Exception as ex:
        logger.error(f'Ошибка при чтении файла {filename}: {ex}')
        return None
 
 
def solve_sudoku_from_file(filename: str) -> int:
    """
    Решает судоку из файла и вычисляет сумму первых трехзначных чисел.
 
    :param filename: Имя файла с судоку.
    :return: Сумма первых трехзначных чисел решенных судоку или 0 в случае ошибки.
    """
    sudokus = read_sudokus_from_file(filename)
    if not sudokus:
        return 0
 
    total_sum = 0
    for board in sudokus:
        solved_board = solve_sudoku(board)
        if solved_board:
            total_sum += solved_board[0][0] * 100 + solved_board[0][1] * 10 + solved_board[0][2]
        else:
            logger.error(f'Не удалось решить судоку: {board}')
    return total_sum
 
if __name__ == '__main__':
    result = solve_sudoku_from_file('sudoku.txt')
    print(f"Сумма первых трехзначных чисел: {result}")
```
# Модуль `GPTalk`

## Обзор

Модуль `GPTalk` предоставляет асинхронный класс `GPTalk`, который является провайдером для взаимодействия с API GPTalk.net. Он позволяет генерировать текст на основе предоставленных сообщений, используя модель GPT-3.5-turbo или другую указанную модель. Модуль включает в себя механизмы аутентификации и управления сессиями для обеспечения стабильной работы с API.

## Подробней

Модуль `GPTalk` предназначен для интеграции с другими частями проекта `hypotez`, где требуется генерация текста с использованием API GPTalk. Он предоставляет удобный интерфейс для отправки запросов и получения ответов в асинхронном режиме. Модуль также обрабатывает аутентификацию и повторное использование сессий для оптимизации работы с API.

## Классы

### `GPTalk`

**Описание**: Класс `GPTalk` является асинхронным провайдером для взаимодействия с API GPTalk.net. Он наследуется от `AsyncGeneratorProvider` и предоставляет методы для аутентификации и генерации текста.

**Наследует**: `AsyncGeneratorProvider`

**Атрибуты**:
- `url` (str): URL API GPTalk.net.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели GPT-3.5-turbo.
- `_auth` (Optional[dict]): Информация об аутентификации.
- `used_times` (int): Счетчик использований аутентификации.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения текста от API GPTalk.net.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения текста от API GPTalk.net.

    Args:
        cls (GPTalk): Класс GPTalk.
        model (str): Название модели для генерации текста.
        messages (Messages): Список сообщений для отправки в API.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор текста.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса к API.

    """
```

**Назначение**: Функция `create_async_generator` создает асинхронный генератор, который отправляет запросы к API GPTalk.net и возвращает сгенерированный текст.

**Параметры**:
- `cls` (GPTalk): Класс GPTalk.
- `model` (str): Название модели для генерации текста. Если не указана, используется "gpt-3.5-turbo".
- `messages` (Messages): Список сообщений для отправки в API.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор текста.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при выполнении запроса к API.

**Как работает функция**:

1. **Инициализация параметров**: Функция принимает параметры, необходимые для запроса к API, такие как модель, сообщения и прокси.
2. **Формирование заголовков**: Создаются заголовки запроса, включающие информацию о браузере, платформе и времени.
3. **Аутентификация**: Проверяется необходимость обновления аутентификационных данных. Если данные устарели или превышено количество использований, выполняется запрос на получение новых данных.
4. **Формирование данных запроса**: Создаются данные запроса, включающие отформатированный промт, модель и другие параметры.
5. **Отправка запроса**: Отправляется POST-запрос к API для получения токена.
6. **Получение текста**: Отправляется GET-запрос к API для получения текста в потоковом режиме.
7. **Генерация текста**: Текст извлекается из потока данных и возвращается в виде асинхронного генератора.

**ASCII flowchart**:

```
    Начало
     |
     V
  Инициализация параметров
     |
     V
  Формирование заголовков
     |
     V
  Проверка аутентификации
     |
     +-- Да --> Получение новых данных
     |  |
     |  V
     +-- Нет-> Формирование данных запроса
     |
     V
  Отправка POST-запроса (получение токена)
     |
     V
  Отправка GET-запроса (получение текста)
     |
     V
  Генерация текста
     |
     V
    Конец
```

**Примеры**:

```python
# Пример вызова функции create_async_generator
messages = [{"role": "user", "content": "Hello, how are you?"}]
async for message in GPTalk.create_async_generator(model="gpt-3.5-turbo", messages=messages):
    print(message)

# Пример вызова функции create_async_generator с прокси
messages = [{"role": "user", "content": "Hello, how are you?"}]
async for message in GPTalk.create_async_generator(model="gpt-3.5-turbo", messages=messages, proxy="http://proxy.example.com"):
    print(message)
```
# Модуль popup.js

## Обзор

Данный JavaScript-код реализует всплывающее окно (popup) для управления и отображения результатов работы XPath-выражений. Код взаимодействует с активной вкладкой браузера, отправляет запросы на выполнение XPath-выражений и получает результаты, которые затем отображаются в popup.  Он также позволяет управлять отображением различных секций и страниц результатов.

## Переменные

### `noneClass`

**Описание**:  Имя класса, добавляемого к элементам, чтобы скрыть их.

### `helpClass`

**Описание**:  Имя класса, используемого для элементов, относящихся к справке.


### `invalidTabId`, `invalidExecutionId`, `invalidFrameId`

**Описание**:  Специальные значения, используемые для обозначения отсутствия или некорректности соответствующих идентификаторов.


### `mainWay`, `mainExpression`, `contextCheckbox`, `contextHeader`, `contextBody`, `contextWay`, `contextExpression`, ...

**Описание**: Переменные, представляющие DOM-элементы, используемые для взаимодействия с пользователем (ввод XPath-выражений, выбор параметров).


### `relatedTabId`, `relatedFrameId`, `executionId`, `resultedDetails`, `detailsPageSize`, `detailsPageIndex`

**Описание**:  Переменные, хранящие информацию о текущем состоянии выполнения запросов (например, идентификатор вкладки, ID выполнения, результаты запроса и т.д.).


## Функции

### `sendToActiveTab(msg, opts)`

**Описание**: Отправляет сообщение `msg` активной вкладке.

**Параметры**:

- `msg` (Object): Сообщение для отправки.
- `opts` (Object, необязательно): Дополнительные опции (например, `frameId`). По умолчанию `{}`.

**Возвращает**:

- `Promise`: Объект Promise, который разрешается, когда сообщение успешно отправлено или отклоняется при ошибке.


### `sendToSpecifiedFrame(msg)`

**Описание**: Отправляет сообщение `msg` указанному кадру.

**Параметры**:

- `msg` (Object): Сообщение для отправки.


**Возвращает**:

- `Promise`: Объект Promise, разрешающийся, когда сообщение отправлено, или отклоняющийся при ошибке.


### `collectPopupState()`

**Описание**: Собирает состояние всплывающего окна.

**Возвращает**:

- `Object`: Объект, содержащий состояние popup.


### `changeContextVisible()`, `changeResolverVisible()`, `changeFrameIdVisible()`, `changeFrameDesignationVisible()`, `changeHelpVisible()`

**Описание**: Функции для изменения видимости соответствующих блоков интерфейса.

**Параметры**:

- Нет

**Возвращает**:

- Нет


### `makeExecuteMessage()`

**Описание**: Формирует сообщение для отправки на выполнение XPath-выражений.

**Возвращает**:

- `Object`: Объект, содержащий параметры для выполнения XPath-выражения.


### `getSpecifiedFrameId()`

**Описание**: Получает ID указанного кадра.

**Возвращает**:

- `Number`: ID указанного кадра.


### `execContentScript()`

**Описание**: Выполняет скрипты в контексте активной вкладки.

**Возвращает**:

- `Promise`: Объект Promise, который разрешается при успешном выполнении скриптов.


### `sendExecute()`

**Описание**: Отправляет запрос на выполнение XPath-выражений в активную вкладку.

**Параметры**:

- Нет

**Возвращает**:

- Нет


### `showDetailsPage(index)`

**Описание**: Отображает страницу результатов, соответствующую указанному индексу.

**Параметры**:

- `index` (Number): Индекс страницы результатов.

**Возвращает**:

- Нет


### `showError(message, frameId)`

**Описание**: Выводит сообщение об ошибке в popup.

**Параметры**:

- `message` (String): Текст сообщения об ошибке.
- `frameId` (String): ID кадра, где произошла ошибка.

**Возвращает**:

- Нет


### `genericListener(message, sender, sendResponse)`

**Описание**: Обработчик сообщений из других частей приложения.

**Параметры**:

- `message` (Object): Сообщение, полученное от другого компонента.
- `sender` (Object): Отправитель сообщения.
- `sendResponse` (Function): Функция для отправки ответа отправителю.

**Возвращает**:

- `Boolean`: Возвращает `true`, если обработчик обрабатывает сообщение, `false` иначе.


## Обработчики событий

Функции, отвечающие за обработку событий загрузки страницы, кликов по элементам и др.


## Заключение

Код popup.js обеспечивает комплексное взаимодействие с активной вкладкой для выполнения и отображения результатов XPath-выражений, а также предоставляет удобный интерфейс для пользователя.
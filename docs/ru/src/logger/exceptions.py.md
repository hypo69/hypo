# Модуль `src.logger.exceptions`

## Обзор

Модуль определяет пользовательские исключения, используемые в приложении. Эти исключения предназначены для обработки ошибок, связанных с различными компонентами приложения, такими как файловые операции, поля продуктов, соединения с базами данных KeePass и ошибки веб-сервисов PrestaShop.

## Подробней

Этот модуль содержит набор классов пользовательских исключений для обработки ошибок, возникающих в различных частях приложения. Использование пользовательских исключений позволяет более четко идентифицировать и обрабатывать специфические ошибки, возникающие в приложении. Все исключения наследуются от базового класса `CustomException`, который обеспечивает логирование информации об ошибке.

## Классы

### `CustomException`

**Описание**: Базовый класс для всех пользовательских исключений в приложении.

**Принцип работы**:
    Этот класс является базовым для всех пользовательских исключений в приложении. Он обрабатывает логирование исключений и предоставляет механизм для работы с исходным исключением, если оно существует. При инициализации экземпляра `CustomException` вызывается метод `handle_exception`, который логирует сообщение об ошибке и, при наличии, информацию об исходном исключении.

**Аттрибуты**:
- `original_exception` (Optional[Exception]): Исходное исключение, вызвавшее данное пользовательское исключение, если оно есть.
- `exc_info` (bool): Флаг, указывающий, следует ли логировать информацию об исключении.

**Методы**:
- `__init__(self, message: str, e: Optional[Exception] = None, exc_info: bool = True)`: Инициализирует `CustomException` сообщением и необязательным исходным исключением.
- `handle_exception(self)`: Обрабатывает исключение, логируя ошибку и исходное исключение, если оно доступно.

### `FileNotFoundError`

**Описание**: Исключение, которое выбрасывается, когда файл не найден.

**Принцип работы**:
    Этот класс исключения используется, когда файл, который пытается открыть или использовать программа, не существует. Наследуется от `CustomException` и `IOError`.

**Аттрибуты**:
    Отсутствуют собственные атрибуты, использует атрибуты родительских классов.

**Методы**:
    Отсутствуют собственные методы, использует методы родительских классов.

### `ProductFieldException`

**Описание**: Исключение, которое выбрасывается при ошибках, связанных с полями продукта.

**Принцип работы**:
    Этот класс исключения используется для обозначения проблем с полями данных продукта, например, если поле имеет неверный формат или отсутствует. Наследуется от `CustomException`.

**Аттрибуты**:
    Отсутствуют собственные атрибуты, использует атрибуты родительского класса.

**Методы**:
    Отсутствуют собственные методы, использует методы родительского класса.

### `KeePassException`

**Описание**: Исключение, которое выбрасывается при проблемах с подключением к базе данных KeePass.

**Принцип работы**:
    Этот класс исключения используется для обработки ошибок, связанных с доступом к базе данных KeePass, таких как неверные учетные данные или ошибки шифрования. Наследуется от исключений `CredentialsError`, `BinaryError`, `HeaderChecksumError`, `PayloadChecksumError`, `UnableToSendToRecycleBin` из библиотеки `pykeepass`.

**Аттрибуты**:
    Отсутствуют собственные атрибуты, использует атрибуты родительских классов.

**Методы**:
    Отсутствуют собственные методы, использует методы родительских классов.

### `DefaultSettingsException`

**Описание**: Исключение, которое выбрасывается при проблемах с настройками по умолчанию.

**Принцип работы**:
    Этот класс исключения используется, когда возникают проблемы с настройками по умолчанию, например, если файл настроек поврежден или отсутствует. Наследуется от `CustomException`.

**Аттрибуты**:
    Отсутствуют собственные атрибуты, использует атрибуты родительского класса.

**Методы**:
    Отсутствуют собственные методы, использует методы родительского класса.

### `WebDriverException`

**Описание**: Исключение, которое выбрасывается при проблемах, связанных с WebDriver.

**Принцип работы**:
    Этот класс исключения используется для обработки ошибок, возникающих при использовании WebDriver для автоматизации браузера. Наследуется от `WebDriverException` из библиотеки `selenium`.

**Аттрибуты**:
    Отсутствуют собственные атрибуты, использует атрибуты родительского класса.

**Методы**:
    Отсутствуют собственные методы, использует методы родительского класса.

### `ExecuteLocatorException`

**Описание**: Исключение, которое выбрасывается при ошибках, связанных с выполнением локаторов.

**Принцип работы**:
    Этот класс исключения используется для обработки ошибок, возникающих при выполнении локаторов элементов на веб-странице. Наследуется от `CustomException`.

**Аттрибуты**:
    Отсутствуют собственные атрибуты, использует атрибуты родительского класса.

**Методы**:
    Отсутствуют собственные методы, использует методы родительского класса.

### `PrestaShopException`

**Описание**: Общее исключение для ошибок веб-сервиса PrestaShop.

**Принцип работы**:
    Этот класс используется для обработки ошибок, возникающих при взаимодействии с веб-сервисом PrestaShop.

**Аттрибуты**:
- `msg` (str): Пользовательское сообщение об ошибке.
- `error_code` (Optional[int]): Код ошибки, возвращенный PrestaShop.
- `ps_error_msg` (str): Сообщение об ошибке от PrestaShop.
- `ps_error_code` (Optional[int]): Код ошибки от PrestaShop.

**Методы**:
- `__init__(self, msg: str, error_code: Optional[int] = None, ps_error_msg: str = '', ps_error_code: Optional[int] = None)`: Инициализирует `PrestaShopException` сообщением и деталями ошибки.
- `__str__(self)`: Возвращает строковое представление исключения.

### `PrestaShopAuthenticationError`

**Описание**: Исключение, которое выбрасывается при ошибках аутентификации PrestaShop (несанкционированный доступ).

**Принцип работы**:
    Этот класс исключения используется для обработки ошибок аутентификации при взаимодействии с веб-сервисом PrestaShop. Наследуется от `PrestaShopException`.

**Аттрибуты**:
    Отсутствуют собственные атрибуты, использует атрибуты родительского класса.

**Методы**:
    Отсутствуют собственные методы, использует методы родительского класса.

## Функции

В данном модуле отсутствуют отдельные функции, в основном он содержит классы исключений.

### `CustomException.__init__`

```python
def __init__(self, message: str, e: Optional[Exception] = None, exc_info: bool = True):
    """Initializes the CustomException with a message and an optional original exception."""
    super().__init__(message)
    self.original_exception = e
    self.exc_info = exc_info
    self.handle_exception()
```

**Назначение**: Инициализирует объект `CustomException`.

**Параметры**:
- `message` (str): Сообщение об ошибке.
- `e` (Optional[Exception], optional): Исходное исключение, вызвавшее текущее исключение. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, определяющий, нужно ли логировать информацию об исключении. По умолчанию `True`.

**Возвращает**:
- `None`

**Вызывает исключения**:
- Не вызывает исключений напрямую, но может передавать исключения в `super().__init__(message)`.

**Как работает функция**:

1. Инициализирует базовый класс `Exception` с переданным сообщением об ошибке.
2. Сохраняет исходное исключение в атрибуте `original_exception`.
3. Устанавливает значение флага `exc_info`.
4. Вызывает метод `handle_exception` для обработки исключения.

**ASCII flowchart**:

```
Инициализация CustomException
│
├───> Инициализация Exception с message
│
├───> Сохранение e в original_exception
│
├───> Установка exc_info
│
└───> Вызов handle_exception
```

**Примеры**:

```python
from src.logger.exceptions import CustomException

try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    custom_ex = CustomException("Произошла ошибка", ex)

try:
    raise Exception("Общая ошибка")
except Exception:
    custom_ex = CustomException("Что-то пошло не так", exc_info=False)
```

### `CustomException.handle_exception`

```python
def handle_exception(self):
    """Handles the exception by logging the error and original exception, if available."""
    logger.error(f"Exception occurred: {self}")
    if self.original_exception:
        logger.debug(f"Original exception: {self.original_exception}")
    # Add recovery logic, retries, or other handling as necessary.
```

**Назначение**: Обрабатывает исключение, логируя информацию об ошибке.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**:
- `None`

**Вызывает исключения**:
- Не вызывает исключений.

**Как работает функция**:

1. Логирует сообщение об ошибке, используя `logger.error`.
2. Если существует исходное исключение (`self.original_exception`), логирует его детали, используя `logger.debug`.

**ASCII flowchart**:

```
handle_exception
│
├───> Логирование сообщения об ошибке
│
└───> Если original_exception существует:
    │
    └───> Логирование деталей original_exception
```

**Примеры**:

```python
from src.logger.exceptions import CustomException
from src.logger import logger

try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    custom_ex = CustomException("Произошла ошибка", ex)
```

### `PrestaShopException.__init__`

```python
def __init__(self, msg: str, error_code: Optional[int] = None, 
             ps_error_msg: str = '', ps_error_code: Optional[int] = None):
    """Initializes the PrestaShopException with the provided message and error details."""
    self.msg = msg
    self.error_code = error_code
    self.ps_error_msg = ps_error_msg
    self.ps_error_code = ps_error_code
```

**Назначение**: Инициализирует объект `PrestaShopException`.

**Параметры**:
- `msg` (str): Пользовательское сообщение об ошибке.
- `error_code` (Optional[int], optional): Код ошибки, возвращенный PrestaShop. По умолчанию `None`.
- `ps_error_msg` (str, optional): Сообщение об ошибке от PrestaShop. По умолчанию пустая строка.
- `ps_error_code` (Optional[int], optional): Код ошибки от PrestaShop. По умолчанию `None`.

**Возвращает**:
- `None`

**Вызывает исключения**:
- Не вызывает исключений.

**Как работает функция**:

1. Сохраняет пользовательское сообщение об ошибке в атрибуте `msg`.
2. Сохраняет код ошибки PrestaShop в атрибуте `error_code`.
3. Сохраняет сообщение об ошибке от PrestaShop в атрибуте `ps_error_msg`.
4. Сохраняет код ошибки PrestaShop в атрибуте `ps_error_code`.

**ASCII flowchart**:

```
Инициализация PrestaShopException
│
├───> Сохранение msg
│
├───> Сохранение error_code
│
├───> Сохранение ps_error_msg
│
└───> Сохранение ps_error_code
```

**Примеры**:

```python
from src.logger.exceptions import PrestaShopException

ex = PrestaShopException("Произошла ошибка при работе с PrestaShop", error_code=500, ps_error_msg="Внутренняя ошибка сервера", ps_error_code=1000)
```

### `PrestaShopException.__str__`

```python
def __str__(self):
    """Returns the string representation of the exception."""
    return repr(self.ps_error_msg or self.msg)
```

**Назначение**: Возвращает строковое представление исключения.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**:
- `str`: Строковое представление исключения.

**Вызывает исключения**:
- Не вызывает исключений.

**Как работает функция**:

1. Возвращает строковое представление исключения. Если сообщение об ошибке от PrestaShop (`self.ps_error_msg`) существует, возвращает его. В противном случае возвращает пользовательское сообщение об ошибке (`self.msg`).

**ASCII flowchart**:

```
__str__
│
└───> Возврат ps_error_msg или msg в виде строки
```

**Примеры**:

```python
from src.logger.exceptions import PrestaShopException

ex = PrestaShopException("Произошла ошибка", ps_error_msg="Ошибка аутентификации")
print(str(ex))
```
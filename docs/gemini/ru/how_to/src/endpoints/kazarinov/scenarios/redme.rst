Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Блок кода описывает процесс обработки запроса пользователя к модели AI, включая возможные ошибки и валидацию данных. Он представляет последовательность действий в виде диаграммы последовательности (mermaid).  Код демонстрирует, как обрабатываются запросы к модели, как происходит повторная попытка при отсутствии ответа или невалидных данных, а также как извлекаются необходимые данные (ru и he) из ответа.

Шаги выполнения
-------------------------
1. **Получение запроса пользователя:** Пользователь отправляет запрос на обработку списка продуктов (products_list) модели AI.
2. **Обработка запроса:** Модель AI обрабатывает запрос и выполняет свою задачу.
3. **Возврат ответа:** Модель возвращает ответ.
4. **Валидация ответа:** Проверяется, получен ли ответ от модели.
   - Если ответа нет, регистрируется ошибка "no response from gemini" в логере.  Производится повторный запрос.
   - Если данные невалидные, регистрируется ошибка "Error in data from gemini". Производится повторный запрос.
5. **Обработка полученных данных:**
   - Если данные представлены в виде списка:
     - Если в списке два элемента (ru, he), производится их извлечение.
     - Если в списке один элемент, производится извлечение ru и he из этого элемента.
     - Если структура данных невалидна, регистрируется ошибка "Проблема парсинга ответа". Производится повторный запрос.
   - Если данные представлены в виде объекта, производится извлечение ru и he из объекта.
   - Если значения ru или he невалидны, регистрируется ошибка "Invalid ru or he data". Производится повторный запрос.
6. **Возврат результата:** После успешной обработки данных, возвращаются извлеченные значения ru и he пользователю.


Пример использования
-------------------------
.. code-block:: mermaid
    
    sequenceDiagram
        participant User
        participant AI_Model
        participant Logger
    
        User->>AI_Model: Запрос на обработку продуктов (products_list)
        AI_Model->>AI_Model: Обработка запроса с командой модели
        AI_Model->>User: Ответ от модели
    
        alt Нет ответа от модели
            Logger->>Logger: Логирирование ошибки "no response from gemini"
            User->>AI_Model: Повторный запрос (attempts - 1)
        end

        alt Получены данные (data)
            alt Данные в виде списка
                alt Два элемента (ru, he)
                    User->>User: Извлечение ru и he
                end
                alt Один элемент
                    User->>User: Извлечение ru и he из первого элемента
                end
            end
            User->>User: Возврат результата ru и he
        end
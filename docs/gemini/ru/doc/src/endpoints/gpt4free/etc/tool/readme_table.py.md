# Модуль для генерации таблиц в формате Markdown для g4f провайдеров и моделей

## Обзор

Модуль предназначен для создания документации в формате Markdown, содержащей информацию о g4f (Generative Framework for Fun) провайдерах и моделях. Он позволяет получить данные о доступных провайдерах, их статусе, поддерживаемых функциях и моделях, а также информацию о моделях и их базовых провайдерах. Результаты выводятся в виде таблиц Markdown, которые затем сохраняются в файл `docs/providers.md`.

## Подробней

Модуль предоставляет функции для сбора и форматирования информации о провайдерах и моделях g4f. Он использует асинхронные вызовы для проверки работоспособности провайдеров и формирует таблицы с информацией о веб-сайтах, статусах, поддержке потоковой передачи, системных сообщений, истории сообщений и доступных моделях.

## Функции

### `test_async`

```python
async def test_async(provider: ProviderType) -> bool:
    """
    Асинхронно проверяет работоспособность указанного провайдера.

    Args:
        provider (ProviderType): Провайдер для проверки.

    Returns:
        bool: `True`, если провайдер работает, `False` в противном случае.

    Raises:
        Exception: Если во время проверки возникает исключение.
    """
```

**Как работает функция**:

1. **Проверка активности провайдера**: Сначала функция проверяет, является ли провайдер рабочим (`provider.working`). Если провайдер не активен, функция немедленно возвращает `False`.
2. **Формирование сообщения**: Создается простое сообщение `Hello Assistant!` для отправки провайдеру.
3. **Асинхронный запрос к провайдеру**:
   - Функция выполняет асинхронный запрос к провайдеру с использованием `ChatCompletion.create_async`.
   - Устанавливается таймаут в 30 секунд для ожидания ответа. Если ответ не получен в течение этого времени, возникает исключение `asyncio.TimeoutError`.
4. **Обработка ответа**: Если ответ получен успешно, функция возвращает `True`.
5. **Обработка исключений**:
   - Если во время выполнения запроса возникает какое-либо исключение, оно перехватывается.
   - Информация об исключении выводится в консоль (если включено логирование отладки `debug.logging`).
   - Функция возвращает `False`.

**Примеры**:
```python
import asyncio
from g4f.providers import Bard

async def main():
    is_working = await test_async(Bard)
    print(f"Provider Bard is working: {is_working}")

if __name__ == "__main__":
    asyncio.run(main())
```

### `test_async_list`

```python
def test_async_list(providers: list[ProviderType]) -> list:
    """
    Асинхронно проверяет работоспособность списка провайдеров.

    Args:
        providers (list[ProviderType]): Список провайдеров для проверки.

    Returns:
        list: Список результатов проверки для каждого провайдера.
    """
```

**Как работает функция**:

1. **Создание списка задач**: Для каждого провайдера в списке `providers` создается асинхронная задача с использованием `test_async`.
2. **Асинхронное выполнение задач**: Задачи выполняются параллельно с использованием `asyncio.run`.
3. **Сбор результатов**: Результаты выполнения каждой задачи (True или False) собираются в список `responses`.
4. **Возврат результатов**: Функция возвращает список `responses`, содержащий результаты проверки для каждого провайдера.

**Примеры**:
```python
import asyncio
from g4f.providers import Bard, Gemini

def main():
    providers = [Bard, Gemini]
    results = test_async_list(providers)
    print(f"Results: {results}")

if __name__ == "__main__":
    main()
```

### `print_providers`

```python
def print_providers() -> list:
    """
    Генерирует строки Markdown для таблицы с информацией о провайдерах.

    Returns:
        list: Список строк Markdown для таблицы провайдеров.
    """
```

**Как работает функция**:

1. **Получение списка рабочих провайдеров**:
   - Функция получает список провайдеров из `__providers__`, фильтруя только те, у которых атрибут `working` имеет значение `True`.
2. **Асинхронная проверка провайдеров**:
   - Вызывается функция `test_async_list` для асинхронной проверки работоспособности каждого провайдера из полученного списка.
   - Результаты проверок сохраняются в списке `responses`.
3. **Формирование строк Markdown**:
   - Создается пустой список `lines`, который будет содержать строки Markdown для таблицы.
   - Функция итерируется по типам провайдеров ("Free" и "Auth").
   - Для каждого типа провайдера добавляются заголовки в список `lines`.
   - Затем происходит итерация по списку провайдеров и их индексам.
   - Для каждого провайдера проверяется, соответствует ли он текущему типу (бесплатный или требующий аутентификацию).
   - Если провайдер соответствует типу, формируются строки с информацией о провайдере:
     - Название провайдера (с использованием атрибута `label`, если он существует, иначе используется `__name__`).
     - Ссылка на веб-сайт провайдера (если URL доступен).
     - Статус провайдера (активный, неактивный или неизвестный) на основе результатов проверки `responses`.
     - Информация о необходимости аутентификации, поддержке потоковой передачи, системных сообщений и истории сообщений.
     - Если провайдер поддерживает модели (является подклассом `ProviderModelMixin`), извлекается информация о доступных моделях и моделях для генерации изображений.
   - Все сформированные строки добавляются в список `lines`.
4. **Возврат строк Markdown**:
   - Функция возвращает список `lines`, содержащий строки Markdown для таблицы провайдеров.

**Примеры**:
```python
def main():
    markdown_lines = print_providers()
    for line in markdown_lines:
        print(line)

if __name__ == "__main__":
    main()
```

### `print_models`

```python
def print_models() -> list:
    """
    Генерирует строки Markdown для таблицы с информацией о моделях.

    Returns:
        list: Список строк Markdown для таблицы моделей.
    """
```

**Как работает функция**:

1. **Определение базовых провайдеров и их URL**:
   - Функция определяет словари `base_provider_names` и `provider_urls`, которые содержат соответствия между именами базовых провайдеров (например, "google", "openai") и их полными именами и URL.
2. **Создание заголовков таблицы**:
   - Создается список `lines` с заголовками для таблицы моделей: "Model", "Base Provider", "Provider", "Website".
3. **Итерация по моделям**:
   - Функция итерируется по моделям в `models.ModelUtils.convert.items()`, где `name` - имя модели, а `model` - объект модели.
   - Пропускаются модели, начинающиеся с "gpt-3.5" или "gpt-4", за исключением "gpt-3.5-turbo", "gpt-4" и "gpt-4-turbo".
   - Извлекается имя модели из `model.name`, разделяя строку по символам ":" или "/".
   - Проверяется, есть ли базовый провайдер модели в словаре `base_provider_names`. Если нет, модель пропускается.
4. **Формирование информации о модели**:
   - Извлекается полное имя базового провайдера из словаря `base_provider_names`.
   - Определяется имя провайдера модели:
     - Если `model.best_provider` не является экземпляром `BaseRetryProvider`, используется `g4f.Provider.{model.best_provider.__name__}`.
     - Иначе используется строка вида "{количество провайдеров}+ Providers".
   - Извлекается URL провайдера из словаря `provider_urls`.
   - Формируется ссылка на веб-сайт провайдера.
5. **Создание строки таблицы**:
   - Создается строка таблицы с информацией о модели, базовом провайдере, провайдере и веб-сайте.
6. **Добавление строки в список**:
   - Строка добавляется в список `lines`.
7. **Возврат списка строк**:
   - Функция возвращает список `lines`, содержащий строки для таблицы моделей.

**Примеры**:
```python
def main():
    markdown_lines = print_models()
    for line in markdown_lines:
        print(line)

if __name__ == "__main__":
    main()
```

### `print_image_models`

```python
def print_image_models() -> list:
    """
    Генерирует строки Markdown для таблицы с информацией о моделях генерации изображений.

    Returns:
        list: Список строк Markdown для таблицы моделей генерации изображений.
    """
```

**Как работает функция**:

1. **Определение заголовков таблицы**:
   - Функция определяет заголовки для таблицы моделей генерации изображений: "Label", "Provider", "Image Model", "Vision Model", "Website".
2. **Итерация по провайдерам**:
   - Функция итерируется по списку провайдеров, фильтруя те, у которых атрибут `working` имеет значение `True` и у которых есть атрибуты `image_models` или `vision_models`.
3. **Получение информации о провайдере**:
   - Извлекается URL провайдера (если доступен).
   - Формируется ссылка на веб-сайт провайдера.
   - Извлекается метка провайдера (атрибут `label`, если доступен, иначе используется `provider.__name__`).
4. **Получение информации о моделях**:
   - Если у провайдера есть атрибут `image_models`, извлекаются имена моделей, присутствующих в `_all_models`.
   - Если у провайдера есть атрибут `vision_models`, устанавливается значение "✔️".
5. **Формирование строки таблицы**:
   - Создается строка таблицы с информацией о провайдере, его моделях генерации изображений и поддержке vision.
6. **Добавление строки в список**:
   - Строка добавляется в список `lines`.
7. **Возврат списка строк**:
   - Функция возвращает список `lines`, содержащий строки для таблицы моделей генерации изображений.

**Примеры**:
```python
def main():
    markdown_lines = print_image_models()
    for line in markdown_lines:
        print(line)

if __name__ == "__main__":
    main()
```

## Запуск модуля

При запуске модуля (`if __name__ == "__main__":`) выполняются следующие действия:

1. Открывается файл `docs/providers.md` для записи.
2. Записываются строки Markdown, сгенерированные функцией `print_providers()`.
3. Записывается разделитель `---`.
4. Записываются строки Markdown, сгенерированные функцией `print_image_models()`.
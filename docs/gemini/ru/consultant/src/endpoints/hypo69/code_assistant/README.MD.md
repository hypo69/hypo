# Анализ кода модуля `code_assistant`

**Качество кода: 8/10**
- **Плюсы:**
    - Хорошо структурированное описание модуля.
    - Наличие подробной информации о каждом скрипте.
    - Примеры использования и командные параметры описаны четко.
    - Описание рабочего процесса и исключений.
    - Указаны зависимости и шаги по созданию новой роли.
    - Комментарии в формате reStructuredText (RST) присутствуют для всего модуля.

- **Минусы:**
    - Не хватает RST-документации для отдельных функций, переменных, и классов внутри модулей `code_assistant.py`, `make_summary.py`, `onela_bot.py` и `bot_handlers.py`.
    - Примеры кода не всегда следуют стилю и рекомендациям.
    - Нет явного указания на использование `j_loads` или `j_loads_ns`.
    - Не прослеживается использование `from src.logger.logger import logger` для логирования.
    - Отсутствует обрамление кода в теги подсветки синтаксиса в некоторых местах.

**Рекомендации по улучшению**
1. **Документация RST:**
   - Добавить RST-документацию для всех функций, методов, и классов в модулях `code_assistant.py`, `make_summary.py`, `onela_bot.py` и `bot_handlers.py`.
   - Привести все комментарии к формату RST, включая описания параметров, возвращаемых значений и т.д.
   - Добавить документацию для каждой переменной.

2. **Использование `j_loads`:**
   - Проверить все места, где используется загрузка JSON, и заменить на `j_loads` или `j_loads_ns` из `src.utils.jjson`.

3. **Логирование:**
    - Убедиться, что для обработки ошибок и логирования используется `from src.logger.logger import logger`.
    - Пересмотреть использование try-except блоков, отдавая предпочтение `logger.error` для обработки исключений.

4. **Стиль кода:**
   - Придерживаться единого стиля кода, включая использование одинарных кавычек в Python коде.
   - Обрамить примеры кода в соответствующие теги подсветки синтаксиса (`bash`, `json`, `python` и т.д.).

5. **Примеры:**
   - Проверить и унифицировать все примеры, чтобы они соответствовали требованиям стиля.

**Оптимизированный код**
```markdown
<TABLE >
<TR>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/README.MD'>[Root ↑]</A>
</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/README.MD'>src</A> \\
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/README.MD'>endpoints</A> \\
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/README.MD'>hypo69</A>
</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/code_assistant/readme.ru.md'>Русский</A>
</TD>
</TR>
</TABLE>

Вот обновленный текст файла `README.md` для модуля `code_assistant`, который описывает все скрипты (`code_assistant.py`, `make_summary.py`, `onela_bot.py`, `bot_handlers.py`):

---

```rst
.. module:: src.endpoints.hypo69.code_assistant
    :synopsis: Модуль для работы с ассистентом кода.

    Этот модуль содержит скрипты для взаимодействия с моделями ИИ (Gemini, OpenAI),
    обработки файлов кода и создания документации.

    .. rubric:: Особенности:

    *   Обработка файлов .py и README.md.
    *   Генерация документации и обзоров кода с помощью моделей ИИ.
    *   Создание файла SUMMARY.md для документации.
    *   Реализация Telegram бота для взаимодействия с пользователем.

```
# Модуль Code Assistant
<TABLE>
<TR>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/README.MD'>[Root ↑]</A>
</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/README.MD'>src</A> \\
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/README.MD'>endpoints</A> \\
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/README.MD'>hypo69</A>
</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/code_assistant/README.MD'>English</A>
</TD>
</TR>
</TABLE>

## Обзор

Модуль `Code Assistant` представляет собой набор инструментов, предназначенных для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода проекта. Он выполняет такие задачи, как генерация документации, проверка кода и генерация тестов на основе указанных файлов. Кроме того, он включает скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бота для обработки задач, связанных с кодом.

## Основные функции

### `code_assistant.py`
- **Чтение файлов**: Читает код из файлов `.py` и `README.MD` в указанных директориях.
- **Взаимодействие с моделью**: Отправляет код моделям для таких задач, как генерация документации или проверка ошибок.
- **Генерация результатов**: Сохраняет ответы моделей в назначенных каталогах для каждой роли.

### `make_summary.py`
- **Генерация `SUMMARY.md`**: Рекурсивно обходит каталог для создания файла `SUMMARY.md` для компиляции документации.
- **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (`ru` или `en`).

### `onela_bot.py` и `bot_handlers.py`
- **Telegram-бот**: Бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода на проверку или генерация документации.
- **Обработчики бота**: Содержит обработчики для обработки команд и сообщений бота.

## Структура проекта

- **Модели**: Использует модели **Gemini** и **OpenAI** для обработки запросов.
- **Запросы (промпты)**: Читает запросы из файлов в `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Файлы**: Обрабатывает файлы `.py` и `README.MD` в указанных каталогах.

## Примеры использования
### Запуск с настройками JSON:
```bash
python code_assistant.py --settings settings.json
```

### Запуск с явными параметрами:
```bash
python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

### Пример для роли `code_checker`:
```bash
python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
```

### Пример для модели `openai`:
```bash
python code_assistant.py --role doc_writer --lang en --models openai
```

## Параметры командной строки
- `--settings`: Путь к JSON-файлу с настройками. Загружает параметры из файла.
- `--role`: Роль модели для задачи (например, `doc_writer`, `code_checker`).
- `--lang`: Язык для задачи (например, `ru` или `en`).
- `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
- `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

## Рабочий процесс
1. **Чтение файлов**: Поиск файлов `.py` и `README.MD` в указанных каталогах.
2. **Загрузка промптов**: Загрузка специфических для роли промптов из `src/ai/prompts/developer/`.
3. **Обработка запроса**: Формирование запросов на основе загруженных файлов и их отправка моделям.
4. **Сохранение ответа**: Сохранение ответов моделей в каталогах, соответствующих роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Исключения
Настройка исключений для файлов и директорий с использованием параметров:
- `exclude_file_patterns`: Список шаблонов регулярных выражений для исключения файлов.
- `exclude_dirs`: Список исключаемых директорий.
- `exclude_files`: Список исключаемых файлов.

## Логирование
Логи сохраняются с использованием библиотеки `logger` и содержат информацию об обработке файлов и ответах моделей.

## Зависимости
- **Gemini API**: Требуется API-ключ для модели Gemini.
- **OpenAI API**: Требуется API-ключ для модели OpenAI.

## Создание новой роли для моделей ИИ

1. **Обновите `code_assistant.json`**:
   - Добавьте новую роль в список ролей:
     ```json
     "roles": [
       "code_checker",
       ...
     ]
     ```
   - Или исключите ее в `"exclude-roles"`.

2. **Добавьте роль в переводы**:
   - Обновите файл `translations/translations.json` новой ролью.

3. **Создайте системный промпт**:
   - Добавьте новый системный промпт в `ai/prompts/developer/`.

4. **Создайте инструкцию для команды**:
   - Добавьте новую инструкцию для команды в `instructions/`.

---

Этот `README.md` предоставляет всесторонний обзор модуля `code_assistant`, его скриптов и способов их эффективного использования.
```
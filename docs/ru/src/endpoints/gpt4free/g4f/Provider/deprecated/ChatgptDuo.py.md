# Модуль для работы с ChatgptDuo
======================================

Модуль содержит класс `ChatgptDuo`, который используется для взаимодействия с сервисом ChatgptDuo.

## Обзор

Модуль предназначен для асинхронного взаимодействия с сервисом ChatgptDuo, предоставляя возможность отправлять запросы и получать ответы. Он поддерживает модель `gpt-3.5-turbo`.

## Подробней

Модуль `ChatgptDuo` позволяет отправлять текстовые запросы к сервису `chatgptduo.com` и получать ответы, имитируя поведение браузера Chrome. Он использует асинхронные запросы для неблокирующего ввода-вывода. Этот модуль является частью набора провайдеров для работы с различными языковыми моделями в проекте `hypotez`.

## Классы

### `ChatgptDuo`

**Описание**: Класс для взаимодействия с сервисом ChatgptDuo.

**Принцип работы**:
Класс `ChatgptDuo` предоставляет статические методы для отправки запросов к сервису `chatgptduo.com` и получения ответов. Он использует библиотеку `StreamSession` для асинхронных запросов и поддерживает прокси.

**Атрибуты**:
- `url` (str): URL сервиса ChatgptDuo (`"https://chatgptduo.com"`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживается ли модель `gpt-3.5-turbo` (всегда `True`).
- `working` (bool): Указывает, работает ли провайдер (изначально `False`).
- `_sources` (List[dict]): Список источников, полученных из ответа сервиса.

**Методы**:
- `create_async`: Асинхронный метод для отправки запроса к ChatgptDuo и получения ответа.
- `get_sources`: Возвращает список источников, использованных для формирования ответа.

### `create_async`

```python
    @classmethod
    async def create_async(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        timeout: int = 120,
        **kwargs
    ) -> str:
        """ Асинхронно отправляет запрос к ChatgptDuo и возвращает ответ.
        Args:
            model (str): Модель для использования (не используется).
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
            timeout (int, optional): Время ожидания ответа в секундах. По умолчанию `120`.
            **kwargs: Дополнительные аргументы (не используются).

        Returns:
            str: Ответ от ChatgptDuo.

        Raises:
            aiohttp.ClientResponseError: Если возникает ошибка при запросе к сервису.
        """
```

**Назначение**: Отправляет запрос к ChatgptDuo и возвращает ответ.

**Параметры**:
- `model` (str): Модель для использования (фактически не используется).
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания ответа в секундах. По умолчанию `120`.
- `**kwargs`: Дополнительные аргументы (не используются).

**Возвращает**:
- `str`: Ответ от ChatgptDuo.

**Вызывает исключения**:
- `aiohttp.ClientResponseError`: Если возникает ошибка при запросе к сервису.

**Как работает функция**:

1.  Инициализирует асинхронную сессию с использованием `StreamSession`, имитируя браузер Chrome версии 107.

2.  Форматирует запрос из списка сообщений, используя функцию `format_prompt`.

3.  Создает словарь `data` с параметрами запроса, включая `prompt`, `search` и `purpose`.

4.  Отправляет POST-запрос к сервису `chatgptduo.com` с использованием созданной сессии и данных запроса.

5.  Обрабатывает ответ, извлекая источники (`title`, `url`, `snippet`) из JSON-ответа и сохраняя их в `cls._sources`.

6.  Возвращает текстовый ответ, полученный от сервиса.

```
    Инициализация сессии
    │
    Форматирование запроса
    │
    Создание данных запроса
    │
    POST-запрос к сервису
    │
    Обработка ответа
    │
    Возврат ответа
```

**Примеры**:

```python
# Пример использования create_async
messages = [{"role": "user", "content": "Hello, how are you?"}]
proxy = "http://your_proxy:8080"
timeout = 60

# await ChatgptDuo.create_async(model="gpt-3.5-turbo", messages=messages, proxy=proxy, timeout=timeout)
```

### `get_sources`

```python
    @classmethod
    def get_sources(cls):
        """ Возвращает список источников, использованных для формирования ответа.
        Returns:
            List[dict]: Список источников.
        """
```

**Назначение**: Возвращает список источников, использованных для формирования ответа.

**Возвращает**:
- `List[dict]`: Список источников, где каждый источник представлен словарем с ключами `title`, `url` и `snippet`.

**Как работает функция**:

1.  Возвращает значение атрибута `cls._sources`, который содержит список источников, полученных при обработке ответа от сервиса ChatgptDuo.

```
    Возврат списка источников
```

**Примеры**:

```python
# Пример использования get_sources
# sources = ChatgptDuo.get_sources()
# if sources:
#     for source in sources:
#         print(f"Title: {source['title']}, URL: {source['url']}")
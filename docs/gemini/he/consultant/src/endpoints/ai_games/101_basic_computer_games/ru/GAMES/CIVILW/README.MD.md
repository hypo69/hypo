# Анализ кода модуля CIVILW

**Качество кода**
   
- Соответствие требованиям к формату кода: 9/10
    - **Преимущества**
        - Код хорошо структурирован и понятен.
        - Описание игры и алгоритма детально проработаны.
        - Блок-схема в формате Mermaid визуализирует логику игры.
    - **Недостатки**
        - Нет кода на Python, что затрудняет оценку реализации.
        - Нет docstring для функций и модулей, что является обязательным.
        - Нет обработки ошибок и логирования.

**Рекомендации по улучшению**

1.  **Добавить код Python**: Реализовать игру на Python в соответствии с описанным алгоритмом.
2.  **Документирование**:
    -   Использовать reStructuredText (RST) для документирования модуля, функций и методов.
    -   Добавить docstring для всех функций и классов.
3.  **Обработка ошибок**:
    -   Использовать `try-except` блоки для обработки возможных ошибок.
    -   Логировать ошибки с помощью `logger.error`.
4.  **Импорт**:
    -   Добавить необходимые импорты, например, `random` для случайных чисел.
5.  **Форматирование кода**:
    -   Соблюдать PEP 8 для форматирования кода.
    -   Использовать осмысленные имена переменных и функций.
6.  **Избегать излишних try-except**: 
    -   Упростить обработку ошибок, используя `logger.error` вместо `try-except` там, где это возможно.
7.  **J_loads**:
    -   Хотя в этом файле не используется JSON, рекомендуется запомнить использование `j_loads` или `j_loads_ns` в других файлах.

**Улучшенный код**
```python
"""
Модуль для симуляции игры "Гражданская война"
=========================================================================================

Модуль содержит функции для симуляции сражения между армиями Конфедерации и Союза.
Игрок управляет армией Конфедерации, принимая решения о численности атакующих войск
и типе атаки (прямая или обходная). Цель игры - победить армию Союза, минимизируя свои потери.

Пример использования
--------------------

.. code-block:: python

    from src.endpoints.ai_games.101_basic_computer_games.ru.GAMES.CIVILW.civil_war import play_civil_war

    play_civil_war()

"""
import random  # импортируем модуль random для генерации случайных чисел #
from src.logger.logger import logger  # импортируем logger для логирования #


def calculate_losses(attack_force: int, attack_type: int) -> tuple[int, int]:
    """
    Вычисляет потери Конфедерации и Союза на основе attack_force и типа атаки.

    :param attack_force: Количество атакующих солдат.
    :param attack_type: Тип атаки (1 - прямая, 2 - обходная).
    :return: Кортеж с потерями Конфедерации и Союза.
    """
    try:  # оборачиваем блок в try, чтобы отлавливать возможные ошибки #
        confederate_loss_rate = random.uniform(0, 0.4) if attack_type == 1 else random.uniform(0, 0.2)  # определяем коэффициент потерь в зависимости от типа атаки #
        confederate_losses = int(attack_force * confederate_loss_rate)  # вычисляем потери конфедерации #
        if confederate_losses > attack_force:  # если потери превышают количество атакующих #
            confederate_losses = attack_force  # устанавливаем потери равными количеству атакующих #
        union_losses = int(attack_force * random.uniform(0, 0.3))  # вычисляем потери союза #
        if attack_type == 2:  # если тип атаки обходной #
            union_losses += random.randint(0, 100)  # увеличиваем потери союза на случайное значение #
        return confederate_losses, union_losses  # возвращаем потери конфедерации и союза #
    except Exception as e:  # ловим любые исключения #
        logger.error('ошибка в расчете потерь', e)  # логируем ошибку #
        return 0, 0  # возвращаем 0,0, чтобы игра не ломалась #


def play_civil_war() -> None:
    """
    Запускает симуляцию игры "Гражданская война".

    Эта функция управляет основным игровым циклом, запрашивает ввод пользователя,
    вычисляет потери и проверяет условия победы.
    """
    union_force = 1000  # начальная численность армии Союза #
    confederate_force = 800  # начальная численность армии Конфедерации #

    while union_force > 0 and confederate_force > 0:  # пока обе армии имеют численность больше 0 #
        try:  # оборачиваем в try, чтобы отлавливать ошибки при вводе #
            attack_force = int(input('Введите количество солдат для атаки: '))  # запрашиваем количество солдат для атаки #
            if attack_force > confederate_force:  # если атакующих больше чем есть в наличии #
                print('Недостаточно сил')  # выводим сообщение о недостатке сил #
                continue  # переходим к следующей итерации цикла #
        except ValueError:  # отлавливаем ошибки ввода #
            logger.error('Некорректный ввод количества солдат')  # логируем ошибку #
            continue  # переходим к следующей итерации цикла #

        try:  # оборачиваем ввод типа атаки в try-except #
            attack_type = int(input('Выберите тип атаки (1 - прямая, 2 - обходная): '))  # запрашиваем тип атаки #
            if attack_type not in (1, 2):  # если ввели неправильное значение #
                print('Некорректный тип атаки')  # выводим сообщение о неправильном типе атаки #
                continue  # переходим к следующей итерации цикла #
        except ValueError:  # ловим ошибку в случае нечислового ввода #
            logger.error('Некорректный ввод типа атаки')  # логируем ошибку #
            continue  # переходим к следующей итерации цикла #

        confederate_losses, union_losses = calculate_losses(attack_force, attack_type)  # вычисляем потери #

        confederate_force -= confederate_losses  # обновляем численность армии конфедерации #
        union_force -= union_losses  # обновляем численность армии союза #

        print(f'Численность армии Конфедерации: {confederate_force}')  # выводим численность армии конфедерации #
        print(f'Численность армии Союза: {union_force}')  # выводим численность армии союза #

        if union_force <= 0:  # проверяем, победила ли конфедерация #
            print('Конфедерация победила!')  # выводим сообщение о победе конфедерации #
            break  # выходим из цикла, если конфедерация победила #
        if confederate_force <= 0:  # проверяем, победил ли союз #
            print('Союз победил!')  # выводим сообщение о победе союза #
            break  # выходим из цикла, если союз победил #

if __name__ == '__main__':  # если файл запущен как скрипт #
    play_civil_war()  # запускаем игру #
```
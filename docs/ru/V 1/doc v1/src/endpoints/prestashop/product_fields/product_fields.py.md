# Модуль `product_fields`

## Обзор

Модуль `product_fields` предназначен для описания полей товара в формате, необходимом для работы с API PrestaShop. Он содержит класс `ProductFields`, который инкапсулирует информацию о полях товара, их значениях и связях с другими сущностями в PrestaShop, такими как категории, изображения и характеристики. Модуль также включает методы для установки и получения значений полей, а также для формирования структуры данных, готовой для отправки в API PrestaShop.

## Подробней

Этот модуль играет ключевую роль в процессе интеграции данных о товарах с PrestaShop. Он предоставляет удобный интерфейс для работы с полями товаров, поддерживая мультиязычность, преобразование типов данных и формирование ассоциаций с другими сущностями. Класс `ProductFields` предназначен для упрощения процесса создания и обновления товаров в PrestaShop посредством API.

## Классы

### `ProductFields`

**Описание**: Класс `ProductFields` предназначен для представления и управления полями товара в формате, необходимом для API PrestaShop. Он включает в себя поля для хранения информации о товаре, методы для установки и получения значений этих полей, а также методы для управления мультиязычными значениями и ассоциациями с другими сущностями PrestaShop.

**Методы**:
- `__post_init__`: Инициализирует объект класса после его создания.
- `_payload`: Загружает значения полей по умолчанию из файла.
- `_set_multilang_value`: Устанавливает мультиязычное значение для указанного поля.
- `to_dict`: Преобразует объект `ProductFields` в словарь, готовый для отправки в API PrestaShop.

**Параметры**:
- `presta_fields` (SimpleNamespace): Объект, хранящий поля товара. Инициализируется в методе `__post_init__`.
- `id_lang` (int): ID языка, используемого для мультиязычных полей. По умолчанию равен 1.

**Примеры**
```python
from src.endpoints.prestashop.product_fields.product_fields import ProductFields

product_fields = ProductFields(id_lang=1)
product_fields.name = 'Новый товар'
product_fields.description_short = 'Краткое описание товара'
product_dict = product_fields.to_dict()
print(product_dict)
```

## Функции

### `_payload`

```python
def _payload(self) -> bool:
    """
    Загрузка дефолтных значений полей.
    Returns:
        bool: True, если загрузка прошла успешно, иначе False.
    """
    ...
```

**Описание**: Метод `_payload` предназначен для загрузки значений полей товара по умолчанию из файла `product_fields_default_values.json`. Этот файл содержит словарь, где ключи соответствуют именам полей, а значения - их значениям по умолчанию. Метод считывает данные из файла, преобразует их в объект `SimpleNamespace` и устанавливает соответствующие атрибуты объекта `presta_fields`.

**Параметры**:
- Отсутствуют

**Возвращает**:
- `bool`: `True`, если загрузка прошла успешно, `False` в случае ошибки.

**Вызывает исключения**:
- `Exception`: В случае возникновения ошибки при чтении файла или преобразовании данных.

**Примеры**:

```python
from src.endpoints.prestashop.product_fields.product_fields import ProductFields

product_fields = ProductFields(id_lang=1)
success = product_fields._payload()
if success:
    print('Поля успешно загружены')
else:
    print('Ошибка при загрузке полей')
```

### `_set_multilang_value`

```python
def _set_multilang_value(self, field_name: str, value: str) -> bool:
    """
    Устанавливает мультиязычное значение для заданного поля.

    Args:
        field_name (str): Имя поля (например, 'name', 'description').
        value (str): Значение для установки.
    """
    ...
```

**Описание**: Метод `_set_multilang_value` предназначен для установки мультиязычных значений для полей товара, таких как название или описание. Он принимает имя поля и значение, которое необходимо установить для указанного языка. Метод формирует структуру данных, содержащую ID языка и значение, и добавляет ее в соответствующее поле объекта `presta_fields`.

**Параметры**:
- `field_name` (str): Имя поля, для которого устанавливается значение.
- `value` (str): Значение, которое необходимо установить для указанного поля.

**Возвращает**:
- `bool`: `True`, если установка значения прошла успешно, иначе `False`.

**Вызывает исключения**:
- `Exception`: В случае возникновения ошибки при установке значения.

**Примеры**:

```python
from src.endpoints.prestashop.product_fields.product_fields import ProductFields

product_fields = ProductFields(id_lang=1)
success = product_fields._set_multilang_value('name', 'Новый товар')
if success:
    print('Значение успешно установлено')
else:
    print('Ошибка при установке значения')
```

### `to_dict`

```python
def to_dict(self) -> Dict[str, Any]:
    """
    Преобразует объект ProductFields в словарь для PrestaShop API,
    исключая ключи, значения которых равны None или пустой строке,
    и формирует мультиязычные поля в нужном формате. Все поля должны быть представлены как строки.

    Returns:
        Dict[str, Any]: Словарь с полями, готовый для PrestaShop API.
    """
    ...
```

**Описание**: Метод `to_dict` преобразует объект `ProductFields` в словарь, который соответствует формату, ожидаемому API PrestaShop. Он перебирает все поля объекта, преобразует их значения в строки и добавляет их в словарь, исключая поля со значениями `None` или пустой строкой. Метод также обрабатывает мультиязычные поля, формируя для них специальную структуру данных.

**Параметры**:
- Отсутствуют

**Возвращает**:
- `Dict[str, Any]`: Словарь, содержащий поля товара и их значения, готовый для отправки в API PrestaShop.

**Вызывает исключения**:
- Отсутствуют

**Примеры**:

```python
from src.endpoints.prestashop.product_fields.product_fields import ProductFields

product_fields = ProductFields(id_lang=1)
product_fields.name = 'Новый товар'
product_dict = product_fields.to_dict()
print(product_dict)
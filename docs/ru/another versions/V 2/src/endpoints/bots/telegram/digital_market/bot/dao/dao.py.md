# Модуль `dao.py`

## Обзор

Модуль `dao.py` содержит классы для доступа к данным (Data Access Objects) для работы с различными сущностями, такими как пользователи, покупки, категории и продукты. Он использует SQLAlchemy для взаимодействия с базой данных и предоставляет асинхронные методы для выполнения запросов.

## Содержание

1. [Класс `UserDAO`](#класс-userdao)
    - [Метод `get_purchase_statistics`](#метод-get_purchase_statistics)
    - [Метод `get_purchased_products`](#метод-get_purchased_products)
    - [Метод `get_statistics`](#метод-get_statistics)
2. [Класс `PurchaseDao`](#класс-purchasedao)
    - [Метод `get_payment_stats`](#метод-get_payment_stats)
    - [Метод `get_full_summ`](#метод-get_full_summ)
    - [Метод `get_next_id`](#метод-get_next_id)
3. [Класс `CategoryDao`](#класс-categorydao)
4. [Класс `ProductDao`](#класс-productdao)

## Классы

### `UserDAO`

**Описание**: Класс для доступа к данным пользователей.

**Методы**:
- `get_purchase_statistics`: Получение статистики покупок пользователя.
- `get_purchased_products`: Получение списка купленных пользователем продуктов.
- `get_statistics`: Получение общей статистики пользователей.

#### `get_purchase_statistics`

**Описание**: Получает статистику покупок пользователя, включая общее количество покупок и общую сумму.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия базы данных.
- `telegram_id` (int): Telegram ID пользователя.

**Возвращает**:
- `Optional[Dict[str, int]]`: Словарь со статистикой покупок или `None`, если пользователь не найден.

**Вызывает исключения**:
- `SQLAlchemyError`: Ошибка при выполнении запроса к базе данных.

#### `get_purchased_products`

**Описание**: Получает список покупок пользователя, включая информацию о продуктах.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия базы данных.
- `telegram_id` (int): Telegram ID пользователя.

**Возвращает**:
- `Optional[List[Purchase]]`: Список покупок пользователя или `None`, если пользователь не найден.

**Вызывает исключения**:
- `SQLAlchemyError`: Ошибка при выполнении запроса к базе данных.

#### `get_statistics`

**Описание**: Получает статистику по пользователям, включая общее количество пользователей, количество новых пользователей за сегодня, за неделю и за месяц.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия базы данных.

**Возвращает**:
- `Dict[str, int]`: Словарь со статистикой пользователей.

**Вызывает исключения**:
- `SQLAlchemyError`: Ошибка при выполнении запроса к базе данных.

### `PurchaseDao`

**Описание**: Класс для доступа к данным покупок.

**Методы**:
- `get_payment_stats`: Получение статистики по типам платежей.
- `get_full_summ`: Получение общей суммы всех покупок.
- `get_next_id`: Получение следующего свободного ID для новой покупки.

#### `get_payment_stats`

**Описание**: Получает статистику по типам платежей, включая общую сумму для каждого типа.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия базы данных.

**Возвращает**:
- `str`: Отформатированная строка со статистикой по типам платежей.

#### `get_full_summ`

**Описание**: Получает общую сумму всех покупок.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия базы данных.

**Возвращает**:
- `int`: Общая сумма всех покупок.

#### `get_next_id`

**Описание**: Возвращает следующий свободный ID для новой записи.

**Параметры**:
- `session` (AsyncSession): Асинхронная сессия базы данных.

**Возвращает**:
- `int`: Следующий свободный ID.

### `CategoryDao`

**Описание**: Класс для доступа к данным категорий.

### `ProductDao`

**Описание**: Класс для доступа к данным продуктов.
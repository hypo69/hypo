# Модуль `fast_api.py`

## Обзор

Этот модуль реализует FastAPI сервер с использованием паттерна Singleton. Он предоставляет функциональность для добавления маршрутов, запуска и остановки серверов на разных портах, а также позволяет управлять серверами асинхронно.

## Содержание

1.  [Классы](#Классы)
    -   [`Singleton`](#Singleton)
    -   [`FastApiServer`](#FastApiServer)
2.  [Функции](#Функции)
    -   [`test_function`](#test_function)
    -   [`test_post`](#test_post)
    -   [`main`](#main)

## Классы

### `Singleton`

**Описание**:
Метакласс для реализации паттерна Singleton. Гарантирует, что у класса будет только один экземпляр.

**Методы**:

-   `__call__`: Возвращает существующий экземпляр класса или создает новый, если его нет.

### `FastApiServer`

**Описание**:
Класс, представляющий FastAPI сервер с реализацией Singleton.

**Параметры**:

-   `title` (str, optional): Заголовок FastAPI приложения. По умолчанию `"FastAPI Singleton Server"`.
-   `host` (str, optional): Хост для запуска сервера. По умолчанию `"127.0.0.1"`.
-   `**kwargs`: Дополнительные параметры, которые передаются в конструктор FastAPI.

**Методы**:

-   `__init__`: Инициализирует сервер FastAPI, роутер и словари для хранения задач и серверов.
-   `add_route`: Добавляет маршрут к FastAPI приложению.
    - **Параметры**:
        -   `path` (str): Путь маршрута.
        -   `func` (Callable): Функция, которая будет выполняться при запросе к маршруту.
        -   `methods` (List[str], optional): Список HTTP методов, которые будут обрабатываться маршрутом. По умолчанию `["GET"]`.
        -   `**kwargs`: Дополнительные параметры, передаваемые в `add_api_route`.
-   `register_router`: Регистрирует роутер в FastAPI приложении.
-   `_start_server`: Запускает uvicorn сервер на указанном порту.
    - **Параметры**:
        -   `port` (int): Порт для запуска сервера.
-   `start`: Запускает FastAPI сервер на указанном порту.
    - **Параметры**:
        -   `port` (int): Порт для запуска сервера.
-   `stop`: Останавливает FastAPI сервер на указанном порту.
    - **Параметры**:
        -   `port` (int): Порт для остановки сервера.
-  `stop_all`: Останавливает все запущенные сервера.
-  `get_app`: Возвращает FastAPI приложение.

## Функции

### `test_function`

**Описание**:
Тестовая асинхронная функция, возвращающая строку.

**Возвращает**:
- `str`:  Строка "It is working!!!".

### `test_post`

**Описание**:
Тестовая асинхронная функция, обрабатывающая POST-запрос.

**Параметры**:

- `data` (Dict[str, str]): Словарь с данными POST-запроса.

**Возвращает**:
- `Dict[str, str]`: Словарь с результатом и переданными данными.

### `main`

**Описание**:
Главная асинхронная функция, запускающая FastAPI сервер и демонстрирующая его функциональность.

**Действия**:
1.  Создает экземпляр `FastApiServer`.
2.  Добавляет маршруты `/hello` и `/post`.
3.  Регистрирует роутер.
4.  Запускает сервер на порту `8080`.
5.  Запускает сервер на порту `8081`.
6.  Останавливает сервер на порту `8080`.
7.  Останавливает все запущенные сервера.
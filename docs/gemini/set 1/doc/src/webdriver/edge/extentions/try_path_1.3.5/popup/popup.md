# Модуль `popup.js`

## Обзор

Этот JavaScript-модуль реализует функциональность всплывающего окна расширения, предназначенного для выполнения XPath-запросов в текущей вкладке браузера. Он обрабатывает пользовательский ввод, отправляет запросы на выполнение XPath-запросов в активную вкладку, получает и отображает результаты в всплывающем окне.  Модуль также реализует функции для работы со стилями,  фреймами и другими элементами пользовательского интерфейса всплывающего окна.

## Переменные

В данном модуле определены следующие глобальные переменные:

- `noneClass`, `helpClass`: классы для управления видимостью элементов.
- `invalidTabId`, `invalidExecutionId`, `invalidFrameId`: значения для обозначения отсутствия данных.
- `mainWay`, `mainExpression`, `contextCheckbox`, ...:  переменные, хранящие ссылки на элементы HTML, используемые для ввода данных и отображения результатов.
- `relatedTabId`, `relatedFrameId`, `executionId`:  переменные, хранящие ID вкладки, фрейма и выполнения для последующей обработки результатов.
- `resultedDetails`, `detailsPageSize`, `detailsPageIndex`: переменные, связанные с отображением результатов, хранящие список деталей результатов, размер страницы и текущую страницу.


## Функции

### `sendToActiveTab(msg, opts)`

**Описание**: Отправляет сообщение `msg` активной вкладке.

**Параметры**:

- `msg (object)`: Сообщение для отправки.
- `opts (object, optional)`: Опции для отправки сообщения. По умолчанию пусто.  Включает в себя возможность определения фрейма, в который нужно отправить сообщение ( `frameId` ).

**Возвращает**:
- `Promise`:  Обещание, завершающееся успехом или ошибкой в зависимости от ответа от активной вкладки.


### `sendToSpecifiedFrame(msg)`

**Описание**: Отправляет сообщение `msg` указанному фрейму.

**Параметры**:

- `msg (object)`: Сообщение для отправки.

**Возвращает**:
- `Promise`: Обещание, завершающееся успехом или ошибкой в зависимости от выполнения скрипта и ответа от активной вкладки.


### `collectPopupState()`

**Описание**: Собрать текущее состояние всплывающего окна.

**Возвращает**:
- `object`: Словарь, содержащий значения элементов управления всплывающего окна.


### `changeContextVisible()`

**Описание**: Изменяет видимость раздела с контекстом.

**Параметры**:
-  Нет

**Возвращает**:
- Нет


### `changeResolverVisible()`

**Описание**: Изменяет видимость раздела с решателем.

**Параметры**:
- Нет

**Возвращает**:
- Нет


### `changeFrameIdVisible()`

**Описание**: Изменяет видимость раздела с ID фрейма.

**Параметры**:
- Нет

**Возвращает**:
- Нет


### `changeFrameDesignationVisible()`

**Описание**: Изменяет видимость раздела назначения фрейма.


**Параметры**:
- Нет

**Возвращает**:
- Нет


### `changeHelpVisible()`

**Описание**: Изменяет видимость раздела справки.

**Параметры**:
- Нет

**Возвращает**:
- Нет


### `makeExecuteMessage()`

**Описание**: Создает сообщение для выполнения XPath-запроса.

**Возвращает**:
- `object`: Словарь, содержащий данные запроса.


### `getSpecifiedFrameId()`

**Описание**: Получить ID выбранного фрейма.

**Возвращает**:
- `number`: Числовое значение ID фрейма, если фрейм выбран, иначе 0.


### `execContentScript()`

**Описание**: Выполняет JavaScript-скрипты в контексте активной вкладки.


**Возвращает**:
- `Promise`: Обещание, завершающееся успехом или ошибкой, в зависимости от выполнения скриптов.


### `sendExecute()`

**Описание**: Отправляет сообщение для выполнения XPath запроса в указанный фрейм.


**Параметры**:
- Нет

**Возвращает**:
- Нет


### `handleExprEnter(event)`

**Описание**: Обрабатывает нажатие клавиши Enter в поле ввода.

**Параметры**:
- `event (object)`: Объект события.


**Возвращает**:
- Нет


### `showDetailsPage(index)`

**Описание**: Отображает детали результатов на заданной странице.


**Параметры**:
- `index (number)`: Индекс страницы.

**Возвращает**:
- Нет


### `showError(message, frameId)`

**Описание**: Отображает сообщение об ошибке в всплывающем окне.

**Параметры**:
- `message (string)`: Сообщение об ошибке.
- `frameId (number)`: ID фрейма, связанный с ошибкой.


**Возвращает**:
- Нет


### `genericListener(message, sender, sendResponse)`

**Описание**: Обработчик событий от других частей расширения.

**Параметры**:
- `message`: Сообщение от другой части расширения.
- `sender`: Отправитель сообщения.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `boolean`: Возвращает true, если обработка прошла успешно, или undefined если обработка не найдена.


## Обработчики событий

Документация содержит  описание различных обработчиков событий, которые управляют взаимодействием всплывающего окна с другими частями расширения.  

## Заключение

Данный модуль обеспечивает функциональность для выполнения запросов XPath и отображения результатов в всплывающем окне расширения.  Он реализует обработку ошибок,  позволяет получать состояние и сохранять его, а также взаимодействует с другими частями расширения через сообщения.
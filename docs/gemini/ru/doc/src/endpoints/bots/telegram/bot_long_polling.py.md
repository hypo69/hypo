# Модуль для работы с Telegram ботом
=================================================

Модуль содержит класс :class:`TelegramBot`, который используется для взаимодействия с Telegram API через long polling.
Он позволяет регистрировать обработчики команд и сообщений, а также заменять обработчик текстовых сообщений.

## Обзор

Этот модуль определяет класс `TelegramBot`, который предоставляет интерфейс для взаимодействия с Telegram API. Он включает в себя методы для регистрации обработчиков команд и сообщений, а также для запуска бота в режиме long polling.

## Подробнее

Модуль `bot_long_polling.py` является основой для создания Telegram-ботов в проекте `hypotez`. Он предоставляет функциональность для регистрации обработчиков команд и сообщений, а также для замены обработчика текстовых сообщений. Класс `TelegramBot` инкапсулирует логику взаимодействия с Telegram API и предоставляет удобный интерфейс для управления ботом.

## Классы

### `TelegramBot`

**Описание**: Класс `TelegramBot` предоставляет интерфейс для взаимодействия с Telegram API.

**Принцип работы**:
1.  Инициализация бота с использованием токена, полученного из `gs.credentials.telegram.bot.kazarinov`.
2.  Регистрация обработчиков команд и сообщений с использованием методов `add_handler` и `MessageHandler`.
3.  Запуск бота в режиме long polling с использованием метода `start_polling`.

**Атрибуты**:

*   `application` (Application): Объект `Application` из библиотеки `telegram.ext`, используемый для управления ботом.
*   `handler` (BotHandler): Объект класса `BotHandler`, содержащий методы для обработки команд и сообщений.
*   `_original_message_handler` (MessageHandler): Объект класса `MessageHandler`, хранящий ссылку на исходный обработчик текстовых сообщений.

**Методы**:

*   `__init__(token: str)`: Инициализирует экземпляр класса `TelegramBot`.
*   `register_handlers() -> None`: Регистрирует обработчики команд и сообщений.
*   `replace_message_handler(new_handler: Callable) -> None`: Заменяет текущий обработчик текстовых сообщений на новый.
*   `start(update: Update, context: CallbackContext) -> None`: Обрабатывает команду `/start`.

## Функции

### `__init__`

```python
def __init__(self, token: str):
    """Initialize the Telegram bot.

    Args:
        token (str): Telegram bot token, e.g., `gs.credentials.telegram.bot.kazarinov`.
    """
    ...
```

**Назначение**: Инициализация экземпляра класса `TelegramBot`.

**Параметры**:

*   `token` (str): Токен Telegram бота.

**Как работает функция**:

1.  Инициализирует объект `Application` с использованием предоставленного токена.
2.  Инициализирует обработчик сообщений `BotHandler`.
3.  Регистрирует обработчики команд и сообщений.

### `register_handlers`

```python
def register_handlers(self) -> None:
    """Register bot commands and message handlers."""
    ...
```

**Назначение**: Регистрация обработчиков команд и сообщений.

**Как работает функция**:

1.  Регистрирует обработчик команды `/start` с использованием метода `handler.start`.
2.  Регистрирует обработчик команды `/help` с использованием метода `handler.help_command`.
3.  Регистрирует обработчик команды `/sendpdf` с использованием метода `handler.send_pdf`.
4.  Регистрирует обработчик текстовых сообщений с использованием метода `handler.handle_message`.
5.  Регистрирует обработчик голосовых сообщений с использованием метода `handler.handle_voice`.
6.  Регистрирует обработчик документов с использованием метода `handler.handle_document`.

```
Регистрация обработчиков
│
├─── Команда /start  -> Обработчик handler.start
│
├─── Команда /help   -> Обработчик handler.help_command
│
├─── Команда /sendpdf -> Обработчик handler.send_pdf
│
├─── Текст  -> Обработчик handler.handle_message
│
├─── Голос -> Обработчик handler.handle_voice
│
└─── Документ -> Обработчик handler.handle_document
```

### `replace_message_handler`

```python
def replace_message_handler(self, new_handler: Callable) -> None:
    """
    Заменяет текущий обработчик текстовых сообщений на новый.

    Args:
        new_handler (Callable): Новая функция для обработки сообщений.
    """
    ...
```

**Назначение**: Замена текущего обработчика текстовых сообщений на новый.

**Параметры**:

*   `new_handler` (Callable): Новая функция для обработки сообщений.

**Как работает функция**:

1.  Проверяет, существует ли старый обработчик в списке обработчиков.
2.  Удаляет старый обработчик из списка обработчиков.
3.  Создает новый обработчик с использованием предоставленной функции.
4.  Регистрирует новый обработчик.

```
Замена обработчика сообщений
│
├─── Проверка наличия старого обработчика
│
├─── Удаление старого обработчика
│
├─── Создание нового обработчика
│
└─── Регистрация нового обработчика
```

### `start`

```python
async def start(self, update: Update, context: CallbackContext) -> None:
    """Handle the /start command."""
    ...
```

**Назначение**: Обработка команды `/start`.

**Параметры**:

*   `update` (Update): Объект `Update` из библиотеки `telegram`.
*   `context` (CallbackContext): Объект `CallbackContext` из библиотеки `telegram.ext`.

**Как работает функция**:

1.  Логгирует информацию о запуске бота пользователем.
2.  Отправляет приветственное сообщение пользователю.

```
Обработка команды /start
│
├─── Логгирование запуска бота
│
└─── Отправка приветственного сообщения
```
# Модуль popup.js

## Обзор

Этот модуль JavaScript отвечает за создание всплывающего окна расширения, предоставляющего интерфейс для взаимодействия с активной вкладкой и выполнения XPath-запросов. Он обрабатывает пользовательский ввод, отправляет запросы на выполнение в активную вкладку, обрабатывает результаты и отображает их в всплывающем окне.

## Переменные

### `noneClass`

**Описание**: Класс, добавляемый элементам, чтобы сделать их невидимыми.

### `helpClass`

**Описание**: Класс, используемый для элементов, содержащих справочную информацию.

### `invalidTabId`, `invalidExecutionId`, `invalidFrameId`

**Описание**: Константы, представляющие невалидные значения для идентификаторов вкладок, исполнений и фреймов.

### `mainWay`, `mainExpression`, `contextCheckbox`, ...

**Описание**: Переменные, представляющие элементы HTML-документа, используемые для ввода данных пользователем.

### `relatedTabId`, `relatedFrameId`, `executionId`

**Описание**: Переменные, хранящие информацию о текущей активной вкладке, фрейме и идентификаторе выполнения.

### `resultedDetails`, `detailsPageSize`, `detailsPageIndex`

**Описание**: Хранят результаты запросов, размер страницы результатов и текущую страницу.


## Функции

### `sendToActiveTab(msg, opts)`

**Описание**: Отправляет сообщение в активную вкладку.

**Параметры**:
- `msg` (object): Сообщение для отправки.
- `opts` (object, optional): Дополнительные параметры.

**Возвращает**:
- `Promise`: Обещание, которое разрешается при успешном отправлении сообщения, или отклоняется при ошибке.

### `sendToSpecifiedFrame(msg)`

**Описание**: Отправляет сообщение в указанный фрейм активной вкладки.

**Параметры**:
- `msg` (object): Сообщение для отправки.

**Возвращает**:
- `Promise`: Обещание, которое разрешается при успешном выполнении операции, или отклоняется при ошибке.

**Возможные исключения**:
- `e`: Ошибка при взаимодействии с фреймом или выполнении скрипта.


### `collectPopupState()`

**Описание**: Собирает текущее состояние всплывающего окна.

**Возвращает**:
- `object`: Объект, содержащий текущее состояние.

### `changeContextVisible()`, `changeResolverVisible()`, `changeFrameIdVisible()`, `changeFrameDesignationVisible()`, `changeHelpVisible()`

**Описание**: Функции для изменения видимости соответствующих блоков интерфейса.


### `makeExecuteMessage()`

**Описание**: Формирует сообщение для отправки в активную вкладку для выполнения XPath-запроса.

**Возвращает**:
- `object`: Объект, содержащий данные запроса.


### `getSpecifiedFrameId()`

**Описание**: Возвращает идентификатор указанного фрейма.

**Возвращает**:
- `int`: Идентификатор фрейма.

**Возможные исключения**:
- `e`: Ошибка при получении идентификатора фрейма.

### `execContentScript()`

**Описание**: Выполняет скрипты try_xpath_check_frame.js и try_xpath_content.js в активной вкладке.

**Возвращает**:
- `Promise`: Обещание, которое разрешается при успешном выполнении скриптов, или отклоняется при ошибке.

### `sendExecute()`

**Описание**: Отправляет сообщение для выполнения XPath-запроса в указанный фрейм.


### `showDetailsPage(index)`

**Описание**: Отображает результаты запросов на странице.

**Параметры**:
- `index` (int): Номер страницы.

**Возвращает**:
- `Promise`: Обещание, разрешаемое при успешном обновлении таблицы результатов.

**Возможные исключения**:
- `fu.onError`: Ошибка при обновлении таблицы.


### `showError(message, frameId)`

**Описание**: Отображает сообщение об ошибке.

**Параметры**:
- `message` (string): Сообщение об ошибке.
- `frameId` (int | string): Идентификатор фрейма.


### `genericListener(message, sender, sendResponse)`

**Описание**: Общий обработчик сообщений от других компонентов расширения.

**Параметры**:
- `message` (object): Сообщение от отправителя.
- `sender` (object): Информация об отправителе.
- `sendResponse` (function): Функция для отправки ответа.

**Возвращает**:
- `boolean`: Указывает, обрабатывает ли функция сообщение.

### `genericListener.listeners.showResultsInPopup`, `genericListener.listeners.restorePopupState`, `genericListener.listeners.insertStyleToPopup`, `genericListener.listeners.addFrameId`

**Описание**: Функции-обработчики для различных типов сообщений.


## Обработчики событий

Этот раздел содержит описание обработчиков событий, используемых в модуле.

### Слушатели событий

В модуле используются слушатели событий для реактивного отображения данных, обработки пользовательских действий и взаимодействия с другими частями расширения.

```
```

```
```


## Дополнительные замечания

Этот модуль использует асинхронные операции и `Promise`, что важно для обработки запросов в фоне.
```
# Модуль для работы со Stub моделями для G4F

## Обзор

Модуль `stubs.py` содержит определения Pydantic моделей, используемых для представления данных, возвращаемых API gpt4free. Эти модели служат для стандартизации и валидации структур данных, используемых в процессе обмена информацией с API. Модуль включает модели для представления токенов, использования, вызовов инструментов, выбора чат-завершений, дельт, изображений и общих ответов, обеспечивая строгую типизацию и облегчая обработку данных.

## Подробнее

Этот модуль предоставляет необходимые структуры данных для работы с различными аспектами API gpt4free, такими как управление токенами, отслеживание использования, обработка вызовов инструментов, формирование ответов чата и управление изображениями. Использование Pydantic моделей позволяет обеспечить валидацию данных и упростить процесс разработки и отладки.

## Классы

### `BaseModel`

**Описание**: Базовый класс для всех моделей данных в модуле.
Переопределяет метод `model_construct` для обеспечения совместимости с различными версиями Pydantic.

**Принцип работы**:
Класс служит родительским для всех остальных моделей в модуле, предоставляя общую функциональность для создания и инициализации объектов.
Он переопределяет метод `model_construct`, чтобы обеспечить совместимость с разными версиями Pydantic, позволяя создавать экземпляры моделей независимо от установленной версии Pydantic.

**Методы**:

- `model_construct(**data)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `data` (dict): Словарь с данными для инициализации атрибутов объекта.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `TokenDetails`

**Описание**: Модель для представления информации о токенах.

**Принцип работы**:
Класс используется для хранения информации о количестве кэшированных токенов.

**Методы**:

- `model_construct(cls, **data)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `data` (dict): Словарь с данными для инициализации атрибутов объекта.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `UsageModel`

**Описание**: Модель для представления информации об использовании токенов.

**Принцип работы**:
Класс используется для хранения информации об использовании токенов, включая количество токенов в запросе, завершении и общее количество токенов.

**Методы**:

- `model_construct(cls, prompt_tokens=0, completion_tokens=0, total_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, **kwargs)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `prompt_tokens` (int): Количество токенов в запросе. По умолчанию 0.
        - `completion_tokens` (int): Количество токенов в завершении. По умолчанию 0.
        - `total_tokens` (int): Общее количество токенов. По умолчанию 0.
        - `prompt_tokens_details` (Optional[dict]): Детали токенов в запросе. По умолчанию `None`.
        - `completion_tokens_details` (Optional[dict]): Детали токенов в завершении. По умолчанию `None`.
        - `kwargs` (dict): Дополнительные аргументы.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ToolFunctionModel`

**Описание**: Модель для представления информации о функции инструмента.

**Принцип работы**:
Класс используется для хранения информации о названии функции и ее аргументах.

**Методы**:
- `model_construct(cls, **data)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `data` (dict): Словарь с данными для инициализации атрибутов объекта.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ToolCallModel`

**Описание**: Модель для представления информации о вызове инструмента.

**Принцип работы**:
Класс используется для хранения информации об идентификаторе, типе и функции инструмента.

**Методы**:

- `model_construct(cls, function=None, **kwargs)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `function` (Optional[dict]): Информация о функции инструмента. По умолчанию `None`.
        - `kwargs` (dict): Дополнительные аргументы.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ChatCompletionChunk`

**Описание**: Модель для представления фрагмента ответа чат-завершения.

**Принцип работы**:
Класс используется для хранения информации о фрагменте ответа чат-завершения, включая идентификатор, объект, время создания, модель, провайдера, выбор и использование.

**Методы**:

- `model_construct(cls, content: str, finish_reason: str, completion_id: str = None, created: int = None, usage: UsageModel = None)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `content` (str): Содержимое фрагмента.
        - `finish_reason` (str): Причина завершения.
        - `completion_id` (Optional[str]): Идентификатор завершения. По умолчанию `None`.
        - `created` (Optional[int]): Время создания. По умолчанию `None`.
        - `usage` (Optional[UsageModel]): Информация об использовании токенов. По умолчанию `None`.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ChatCompletionMessage`

**Описание**: Модель для представления сообщения чат-завершения.

**Принцип работы**:
Класс используется для хранения информации о сообщении чат-завершения, включая роль, содержимое и вызовы инструментов.

**Методы**:

- `model_construct(cls, content: str, tool_calls: list = None)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `content` (str): Содержимое сообщения.
        - `tool_calls` (Optional[list]): Список вызовов инструментов. По умолчанию `None`.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

    - `save(self, filepath: str, allowd_types = None)`: Сохраняет содержимое сообщения в файл.
        - **Назначение**: Сохраняет содержимое сообщения в файл, обрабатывая различные типы контента (data URI, markdown).
        - **Параметры**:
            - `filepath` (str): Путь к файлу для сохранения.
            - `allowd_types` (Optional[list]): Разрешенные типы контента. По умолчанию `None`.
        - **Как работает функция**:
            1. **Проверка на наличие атрибута `data`**: Если у атрибута `content` есть атрибут `data`, функция переименовывает файл, указанный в `self.content.data`, заменяя "/media" на `images_dir`.
            2. **Проверка на data URI**: Если `self.content` начинается с "data:", функция извлекает данные из URI и записывает их в файл.
            3. **Обработка markdown**: Если контент не является data URI, функция фильтрует markdown, используя функцию `filter_markdown`, и записывает отфильтрованный контент в файл.
        - **Примеры**:
            ```python
            message = ChatCompletionMessage.model_construct(content="Hello, world!")
            message.save("hello.txt")
            ```

### `ChatCompletionChoice`

**Описание**: Модель для представления выбора чат-завершения.

**Принцип работы**:
Класс используется для хранения информации о выборе чат-завершения, включая индекс, сообщение и причину завершения.

**Методы**:

- `model_construct(cls, message: ChatCompletionMessage, finish_reason: str)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `message` (ChatCompletionMessage): Сообщение чат-завершения.
        - `finish_reason` (str): Причина завершения.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ChatCompletion`

**Описание**: Модель для представления чат-завершения.

**Принцип работы**:
Класс используется для хранения информации о чат-завершении, включая идентификатор, объект, время создания, модель, провайдера, выбор, использование и контекст.

**Методы**:

- `model_construct(cls, content: str, finish_reason: str, completion_id: str = None, created: int = None, tool_calls: list[ToolCallModel] = None, usage: UsageModel = None, conversation: dict = None)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `content` (str): Содержимое завершения.
        - `finish_reason` (str): Причина завершения.
        - `completion_id` (Optional[str]): Идентификатор завершения. По умолчанию `None`.
        - `created` (Optional[int]): Время создания. По умолчанию `None`.
        - `tool_calls` (Optional[list[ToolCallModel]]): Список вызовов инструментов. По умолчанию `None`.
        - `usage` (Optional[UsageModel]): Информация об использовании токенов. По умолчанию `None`.
        - `conversation` (Optional[dict]): Контекст разговора. По умолчанию `None`.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ChatCompletionDelta`

**Описание**: Модель для представления дельты чат-завершения.

**Принцип работы**:
Класс используется для хранения информации о дельте чат-завершения, включая роль и содержимое.

**Методы**:

- `model_construct(cls, content: Optional[str])`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `content` (Optional[str]): Содержимое дельты.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ChatCompletionDeltaChoice`

**Описание**: Модель для представления выбора дельты чат-завершения.

**Принцип работы**:
Класс используется для хранения информации о выборе дельты чат-завершения, включая индекс, дельту и причину завершения.

**Методы**:

- `model_construct(cls, delta: ChatCompletionDelta, finish_reason: Optional[str])`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `delta` (ChatCompletionDelta): Дельта чат-завершения.
        - `finish_reason` (Optional[str]): Причина завершения.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `Image`

**Описание**: Модель для представления изображения.

**Принцип работы**:
Класс используется для хранения информации об изображении, включая URL, base64 JSON и пересмотренный запрос.

**Методы**:

- `model_construct(cls, url: str = None, b64_json: str = None, revised_prompt: str = None)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `url` (Optional[str]): URL изображения. По умолчанию `None`.
        - `b64_json` (Optional[str]): Base64 JSON изображения. По умолчанию `None`.
        - `revised_prompt` (Optional[str]): Пересмотренный запрос. По умолчанию `None`.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

### `ImagesResponse`

**Описание**: Модель для представления ответа с изображениями.

**Принцип работы**:
Класс используется для хранения информации об ответе с изображениями, включая данные, модель, провайдера и время создания.

**Методы**:

- `model_construct(cls, data: List[Image], created: int = None, model: str = None, provider: str = None)`:
    - **Назначение**: Создает экземпляр класса, устанавливая атрибуты на основе переданных данных.
    - **Параметры**:
        - `data` (List[Image]): Список изображений.
        - `created` (Optional[int]): Время создания. По умолчанию текущее время.
        - `model` (Optional[str]): Модель. По умолчанию `None`.
        - `provider` (Optional[str]): Провайдер. По умолчанию `None`.
    - **Возвращает**:
        - Экземпляр класса с установленными атрибутами.

## Функции

В данном модуле функции отсутствуют.
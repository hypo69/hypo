# Модуль ToolBox_requests

## Обзор

Модуль `ToolBox_requests.py` содержит класс `ToolBox`, который наследует функциональность от классов `keyboards` и `neural_networks`. Этот класс предназначен для обработки запросов от пользователей Telegram-бота, включая текстовые запросы, генерацию изображений, работу в свободном режиме и отображение информации о тарифах. Модуль использует библиотеку `telebot` для взаимодействия с Telegram API, а также другие модули для обработки текста и изображений.

## Подробней

Модуль `ToolBox_requests.py` является центральным элементом в обработке запросов от пользователей Telegram-бота. Он включает в себя методы для обработки различных типов запросов, таких как генерация текста, создание изображений и взаимодействие в свободном режиме. Класс `ToolBox` инициализирует бота, загружает текстовые подсказки, определяет обработчики запросов и использует другие модули для выполнения сложных задач, таких как работа с нейронными сетями.

## Классы

### `ToolBox`

**Описание**: Класс `ToolBox` предназначен для обработки запросов от пользователей Telegram-бота. Он включает в себя методы для обработки различных типов запросов, таких как генерация текста, создание изображений и взаимодействие в свободном режиме.

**Как работает класс**:
1.  **Инициализация**:
    *   Инициализирует переменные с предопределенными значениями.
    *   Загружает текстовые подсказки из файла `prompts.json`.
    *   Инициализирует Telegram-бота с использованием токена из переменной окружения.
    *   Определяет лямбда-функции для создания различных типов клавиатур.
    *   Определяет лямбда-функции для отправки различных типов сообщений пользователю.
2.  **Обработка текста**:
    *   Предоставляет методы для обработки текстовых запросов различных типов, таких как коммерческий текст, SMM-текст, брейншторм, реклама, заголовки, SEO, новости и редактура.
3.  **Обработка изображений**:
    *   Предоставляет методы для генерации изображений на основе текстового запроса пользователя.
    *   Позволяет пользователю выбирать размер изображения и выполнять дополнительные действия, такие как улучшение или регенерация изображения.
4.  **Свободный режим**:
    *   Позволяет пользователю отправлять произвольные запросы и получать ответы от модели GPT-4o mini.
5.  **Обработка тарифов**:
    *   Предоставляет методы для отображения информации о тарифах и обработки запросов на подключение тарифов.
6.  **Приватные методы**:
    *   Включает приватные методы для обработки запросов к моделям GPT-4o mini и FLUX schnell.

**Методы**:

*   `__init__`: Инициализирует класс `ToolBox`.
*   `Text_types`: Отображает типы текстов, которые может сгенерировать бот.
*   `Basic_tariff`: Обрабатывает запрос на подключение тарифа BASIC.
*   `Pro_tariff`: Обрабатывает запрос на подключение тарифа PRO.
*   `TextCommands`: Обрабатывает текстовые команды.
*   `SomeTextsCommand`: Обрабатывает команды для генерации нескольких текстов.
*   `ImageCommand`: Обрабатывает команду для генерации изображений.
*   `Image_Regen_And_Upscale`: Обрабатывает запросы на регенерацию и улучшение изображений.
*   `FreeCommand`: Обрабатывает команды в свободном режиме.

## Функции

### `__init__`

```python
def __init__(self):
    """
    Инициализирует класс ToolBox, настраивает Telegram-бота, загружает подсказки и определяет обработчики запросов.

    Args:
        self: Экземпляр класса ToolBox.

    Returns:
        None

    Raises:
        FileNotFoundError: Если файл prompts.json не найден.
        KeyError: Если переменная окружения 'TOKEN' не найдена.

    Example:
        >>> toolbox = ToolBox()
    """
    ...
```

**Как работает функция**:
1.  Инициализирует атрибуты `name` и `data` для кнопок стартового меню.
2.  Загружает текстовые подсказки из файла `prompts.json` в атрибут `self.prompts_text`.
3.  Инициализирует Telegram-бота, используя токен, полученный из переменной окружения `TOKEN`.
4.  Определяет лямбда-функции для создания inline-клавиатур (`keyboard_blank`) и markup-клавиатур (`reply_keyboard`).
5.  Определяет лямбда-функции для отправки различных сообщений пользователю:
    *   `__delay`: Отправляет сообщение о задержке.
    *   `start_request`: Отправляет стартовое сообщение с кнопками выбора задач.
    *   `restart`: Отправляет сообщение с предложением выбрать задачу.
    *   `restart_markup`: Редактирует сообщение с предложением выбрать задачу.
    *   `OneTextArea`: Отправляет сообщение с текстом из списка текстовых подсказок.
    *   `SomeTextsArea`: Отправляет сообщение с текстом из списка подсказок для нескольких текстов.
    *   `ImageSize`: Отправляет сообщение с предложением выбрать размер изображения.
    *   `ImageArea`: Отправляет сообщение с предложением ввести запрос для генерации изображения.
    *   `ImageChange`: Отправляет сообщение с предложением выбрать следующее действие после генерации изображения.
    *   `BeforeUpscale`: Отправляет сообщение с предложением выбрать следующее действие перед улучшением изображения.
    *   `FreeArea`: Отправляет сообщение с предложением ввести запрос в свободном режиме.
    *   `TariffArea`: Отправляет сообщение с информацией о тарифах.
    *   `TariffExit`: Отправляет сообщение с информацией о тарифах и кнопками выхода.
    *   `TarrifEnd`: Отправляет сообщение об окончании запросов по тарифу.
    *   `FreeTariffEnd`: Отправляет сообщение об исчерпании бесплатных запросов.
    *   `SomeTexts`: Отправляет сообщение с предложением выбрать один или несколько текстов.

**Параметры**:

*   `self`: Ссылка на экземпляр класса.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `FileNotFoundError`: Если файл `prompts.json` не найден.
*   `KeyError`: Если переменная окружения `TOKEN` не найдена.

### `Text_types`

```python
def Text_types(self, message):
    """
    Отображает типы текстов, которые может сгенерировать бот.

    Args:
        message: Объект сообщения Telegram.

    Returns:
        types.Message: Отредактированное сообщение с типами текстов.

    Raises:
        None

    Example:
        >>> bot.register_message_handler(Text_types, commands=['text_types'])
    """
    ...
```

**Как работает функция**:

Функция `Text_types` редактирует сообщение пользователя, отображая список доступных типов текстов для генерации. Она создает inline-клавиатуру с кнопками, соответствующими различным типам текстов, таким как "Коммерческий", "SMM", "Брейншторм" и т.д. При нажатии на кнопку пользователю будет предложено ввести запрос для генерации текста выбранного типа.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.

**Возвращает**:

*   `types.Message`: Отредактированное сообщение с типами текстов и inline-клавиатурой.

**Вызывает исключения**:

*   `None`

### `Basic_tariff`

```python
def Basic_tariff(self, message):
    """
    Обрабатывает запрос на подключение тарифа BASIC.

    Args:
        message: Объект сообщения Telegram.

    Returns:
        None

    Raises:
        None

    Example:
        >>> bot.register_message_handler(Basic_tariff, commands=['basic_tariff'])
    """
    ...
```

**Как работает функция**:

Функция `Basic_tariff` обрабатывает запрос пользователя на подключение тарифа BASIC. Она создает inline-клавиатуру с кнопкой для подключения тарифа и кнопкой для возврата к списку тарифов. Затем она отправляет счет на оплату тарифа BASIC с указанием названия, описания, суммы и других параметров.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

### `Pro_tariff`

```python
def Pro_tariff(self, message):
    """
    Обрабатывает запрос на подключение тарифа PRO.

    Args:
        message: Объект сообщения Telegram.

    Returns:
        None

    Raises:
        None

    Example:
        >>> bot.register_message_handler(Pro_tariff, commands=['pro_tariff'])
    """
    ...
```

**Как работает функция**:

Функция `Pro_tariff` обрабатывает запрос пользователя на подключение тарифа PRO. Она создает inline-клавиатуру с кнопкой для подключения тарифа и кнопкой для возврата к списку тарифов. Затем она отправляет счет на оплату тарифа PRO с указанием названия, описания, суммы и других параметров.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

### `TextCommands`

```python
def TextCommands(self, message, ind: int):
    """
    Обрабатывает текстовые команды.

    Args:
        message: Объект сообщения Telegram.
        ind (int): Индекс команды.

    Returns:
        tuple[int, int, int]: Кортеж, содержащий входящие токены, исходящие токены и 1.

    Raises:
        None

    Example:
        >>> bot.register_message_handler(TextCommands, commands=['text_command'])
    """
    ...
```

**Как работает функция**:

Функция `TextCommands` обрабатывает текстовые команды, введенные пользователем. Она принимает сообщение и индекс команды в качестве аргументов. В зависимости от наличия "TEXT" в `pc.commands_size[ind]`, функция запрашивает у пользователя дополнительную информацию, необходимую для формирования запроса к модели GPT-4o mini. Затем она вызывает приватный метод `__gpt_4o_mini` для обработки запроса и получения ответа.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.
*   `ind` (int): Индекс команды.

**Возвращает**:

*   `tuple[int, int, int]`: Кортеж, содержащий входящие токены, исходящие токены и 1.

**Вызывает исключения**:

*   `None`

Внутренняя функция `Text_next_step`:

```python
def Text_next_step(message):
    """
    Обрабатывает следующий шаг в обработке текстовой команды.

    Args:
        message: Объект сообщения Telegram.

    Returns:
        None

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `Text_next_step` обрабатывает следующий шаг в обработке текстовой команды. Она извлекает дополнительную информацию из сообщения пользователя, формирует запрос к модели GPT-4o mini и вызывает приватный метод `__gpt_4o_mini` для обработки запроса и получения ответа.

**Параметры**:

*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

### `SomeTextsCommand`

```python
def SomeTextsCommand(self, message, ind: int, tokens: dict[str, int]):
    """
    Обрабатывает команды для генерации нескольких текстов.

    Args:
        message: Объект сообщения Telegram.
        ind (int): Индекс команды.
        tokens (dict[str, int]): Словарь с информацией о токенах.

    Returns:
        tuple[int, int, int]: Кортеж, содержащий входящие токены, исходящие токены и количество сгенерированных текстов.

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `SomeTextsCommand` обрабатывает команды для генерации нескольких текстов. Она запрашивает у пользователя количество текстов, которые необходимо сгенерировать, а также дополнительную информацию, необходимую для формирования запроса к модели GPT-4o mini. Затем она вызывает приватный метод `__gpt_4o_mini` для обработки запроса и получения ответа для каждого текста.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.
*   `ind` (int): Индекс команды.
*   `tokens` (dict[str, int]): Словарь с информацией о токенах.

**Возвращает**:

*   `tuple[int, int, int]`: Кортеж, содержащий входящие токены, исходящие токены и количество сгенерированных текстов.

**Вызывает исключения**:

*   `None`

Внутренняя функция `Text_next_step`:

```python
def Text_next_step(message):
    """
    Обрабатывает следующий шаг в обработке текстовой команды.

    Args:
        message: Объект сообщения Telegram.

    Returns:
        None

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `Text_next_step` обрабатывает следующий шаг в обработке текстовой команды. Она извлекает текст из сообщения пользователя и добавляет его в список `ans[i]`.

**Параметры**:

*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

Внутренняя функция `Params_addition`:

```python
def Params_addition(message):
    """
    Добавляет параметры к запросу.

    Args:
        message: Объект сообщения Telegram.

    Returns:
        None

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `Params_addition` добавляет параметры к запросу на основе введенных пользователем данных. Она разделяет текст сообщения на параметры и добавляет их в список `ans[i]`.

**Параметры**:

*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

Внутренняя функция `process_prompt`:

```python
def process_prompt(i):
    """
    Обрабатывает запрос к модели GPT-4o mini для одного текста.

    Args:
        i (int): Индекс текста.

    Returns:
        tuple[int, int]: Кортеж, содержащий входящие токены и исходящие токены.

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `process_prompt` обрабатывает запрос к модели GPT-4o mini для одного текста. Она формирует запрос на основе информации, собранной в списке `ans[i]`, и вызывает приватный метод `__gpt_4o_mini` для обработки запроса и получения ответа.

**Параметры**:

*   `i` (int): Индекс текста.

**Возвращает**:

*   `tuple[int, int]`: Кортеж, содержащий входящие токены и исходящие токены.

**Вызывает исключения**:

*   `None`

### `ImageCommand`

```python
def ImageCommand(self, message, prompt: str, size: list[int]):
    """
    Обрабатывает команду для генерации изображений.

    Args:
        message: Объект сообщения Telegram.
        prompt (str): Текст запроса для генерации изображения.
        size (list[int]): Список, содержащий размеры изображения.

    Returns:
        int: Сгенерированное случайное число seed.

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `ImageCommand` обрабатывает команду для генерации изображений на основе текстового запроса пользователя. Она генерирует случайное число `seed`, которое используется для управления процессом генерации изображения. Затем она вызывает приватный метод `__FLUX_schnell` для обработки запроса и получения изображения.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.
*   `prompt` (str): Текст запроса для генерации изображения.
*   `size` (list[int]): Список, содержащий размеры изображения.

**Возвращает**:

*   `int`: Сгенерированное случайное число seed.

**Вызывает исключения**:

*   `None`

### `Image_Regen_And_Upscale`

```python
def Image_Regen_And_Upscale(self, message, prompt: str, size: list[int], seed, num_inference_steps=4):
    """
    Обрабатывает запросы на регенерацию и улучшение изображений.

    Args:
        message: Объект сообщения Telegram.
        prompt (str): Текст запроса для генерации изображения.
        size (list[int]): Список, содержащий размеры изображения.
        seed: Случайное число seed.
        num_inference_steps (int): Количество шагов для улучшения изображения.

    Returns:
        None

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `Image_Regen_And_Upscale` обрабатывает запросы на регенерацию и улучшение изображений. Она вызывает приватный метод `__FLUX_schnell` для обработки запроса и получения изображения.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.
*   `prompt` (str): Текст запроса для генерации изображения.
*   `size` (list[int]): Список, содержащий размеры изображения.
*   `seed`: Случайное число seed.
*   `num_inference_steps` (int): Количество шагов для улучшения изображения.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `None`

### `FreeCommand`

```python
def FreeCommand(self, message, prompts: list[str]):
    """
    Обрабатывает команды в свободном режиме.

    Args:
        message: Объект сообщения Telegram.
        prompts (list[str]): Список запросов.

    Returns:
        tuple[int, int, list[str]]: Кортеж, содержащий входящие токены, исходящие токены и список запросов.

    Raises:
        None

    """
    ...
```

**Как работает функция**:

Функция `FreeCommand` обрабатывает команды в свободном режиме. Она добавляет текст сообщения пользователя в список запросов `prompts` и вызывает приватный метод `__gpt_4o_mini` для обработки запроса и получения ответа.

**Параметры**:

*   `self`: Ссылка на экземпляр класса `ToolBox`.
*   `message`: Объект сообщения Telegram, содержащий информацию о сообщении, отправленном пользователем.
*   `prompts` (list[str]): Список запросов.

**Возвращает**:

*   `tuple[int, int, list[str]]`: Кортеж, содержащий входящие токены, исходящие токены и список запросов.

**Вызывает исключения**:

*   `None`
# Модуль md2dict

## Обзор

Модуль `md2dict` предназначен для конвертации строк в формате Markdown в структурированные словари. Он включает функции для преобразования Markdown в HTML и последующего разбора HTML для извлечения информации о структуре документа, такой как заголовки и текст. Расположен в `hypotez/src/utils/convertors/md.py`, что указывает на его роль в преобразовании данных в проекте.

## Подробней

Этот модуль предоставляет способ программного анализа Markdown-текста, что может быть полезно для автоматической обработки документации, извлечения данных из Markdown-файлов или создания инструментов для работы с Markdown. Модуль использует библиотеку `markdown2` для конвертации Markdown в HTML, а затем анализирует HTML для построения словаря, отражающего структуру документа.

## Функции

### `md2html`

```python
def md2html(md_string: str, extras: List[str] = None) -> str:
    """
    Конвертирует строку Markdown в HTML.

    Args:
        md_string (str): Строка Markdown для конвертации.
        extras (list, optional): Список расширений markdown2. Defaults to None.

    Returns:
        str: HTML-представление Markdown.
    """
```

**Описание**: Преобразует строку в формате Markdown в HTML.

**Параметры**:
- `md_string` (str): Строка Markdown, которую необходимо преобразовать.
- `extras` (List[str], optional): Список расширений для markdown2. По умолчанию `None`.

**Возвращает**:
- `str`: HTML-представление входной Markdown-строки.

**Вызывает исключения**:
- `Exception`: Логируется сообщение об ошибке при неудачном преобразовании Markdown в HTML.

**Как работает функция**:
Функция `md2html` использует библиотеку `markdown2` для преобразования входной строки `md_string` из формата Markdown в HTML. Если указан список расширений `extras`, они передаются в функцию `markdown2.markdown` для расширения функциональности преобразования. В случае возникновения исключения в процессе преобразования, функция логирует ошибку и возвращает пустую строку.

```
Например:

    +-----------+-------------------------------------+--------------------------------------+
    | Параметры | md_string                         | extras                               |
    +-----------+-------------------------------------+--------------------------------------+
    | Входные   | "## Hello world"                   | None                                 |
    +-----------+-------------------------------------+--------------------------------------+
    | Выходные  | "<h2>Hello world</h2>"              |                                      |
    +-----------+-------------------------------------+--------------------------------------+

```

### `md2dict`

```python
def md2dict(md_string: str, extras: List[str] = None) -> Dict[str, list[str]]:
    """
    Конвертирует строку Markdown в структурированный словарь.

    Args:
        md_string (str): Строка Markdown для конвертации.
        extras (list, optional): Список расширений markdown2 для md2html. Defaults to None.

    Returns:
         Dict[str, list[str]]: Структурированное представление Markdown содержимого.
    """
```

**Описание**: Конвертирует строку Markdown в структурированный словарь, где ключи - это заголовки, а значения - список строк, относящихся к этому заголовку.

**Параметры**:
- `md_string` (str): Строка Markdown для конвертации.
- `extras` (List[str], optional): Список расширений markdown2 для `md2html`. По умолчанию `None`.

**Возвращает**:
- `Dict[str, list[str]]`: Структурированное представление Markdown содержимого.

**Вызывает исключения**:
- `Exception`: Логируется сообщение об ошибке при неудачном парсинге Markdown в структурированный словарь.

**Как работает функция**:

```mermaid
graph TD
    A[Начало] --> B{Преобразование MD в HTML};
    B -- Успешно --> C{Разделение HTML на строки};
    B -- Ошибка --> E[Логирование ошибки и возврат {}];
    C --> D{Обработка каждой строки};
    D -- Заголовок --> F{Извлечение заголовка и уровня};
    F --> G{Добавление заголовка в словарь};
    D -- Текст --> H{Добавление текста к текущему заголовку};
    H --> D;
    G --> D;
    D -- Конец строк --> I[Возврат словаря];
    E --> I;
```

Функция `md2dict` принимает строку `md_string` в формате Markdown и, используя функцию `md2html`, преобразует её в HTML. Затем HTML разбивается на строки, и каждая строка анализируется. Если строка является заголовком (начинается с `<h`), извлекается уровень заголовка и текст заголовка. Заголовки первого уровня становятся ключами в результирующем словаре, а остальные строки добавляются в список значений, соответствующих текущему заголовку. В случае возникновения ошибки, функция логирует её и возвращает пустой словарь.

**Примеры**:

```python
#Пример 1
md_string = """
# Section 1
Content of section 1.
## Subsection 1.1
Content of subsection 1.1.
"""
result = md2dict(md_string)
print(result)
# {'Section 1': ['Content of section 1.', 'Subsection 1.1', 'Content of subsection 1.1.']}

#Пример 2
md_string = "#Section без содержимого"
result = md2dict(md_string)
print(result)
#{'Section без содержимого': []}
```
# Модуль try_xpath_background.js

## Обзор

Этот модуль (`try_xpath_background.js`) отвечает за обработку сообщений, полученных от вкладок, и выполняет различные действия, связанные с отображением и управлением результатами поиска XPath. Он взаимодействует с хранилищем настроек, загружает стили и управляет состоянием всплывающего окна.


## Переменные

### `tx`

**Описание**: Псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: Псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Состояние всплывающего окна.

### `popupCss`

**Описание**: Стили CSS для всплывающего окна.

### `results`

**Описание**: Результаты поиска XPath.

### `css`

**Описание**: Стили CSS для текущей вкладки.

### `attributes`

**Описание**: Словарь атрибутов для поиска XPath.


## Функции

### `loadDefaultCss()`

**Описание**: Загружает стили CSS по умолчанию из файла `/css/try_xpath_insert.css` используя `XMLHttpRequest`.

**Возвращает**:
- `Promise<string>`: Текст загруженных стилей CSS.

**Обрабатывает исключения**:
- `ex`: Общее исключение при выполнении запроса.

### `genericListener(message, sender, sendResponse)`

**Описание**: Общий обработчик сообщений от вкладок.

**Параметры**:
- `message` (объект): Сообщение от вкладки.
- `sender` (объект): Объект отправителя сообщения.
- `sendResponse` (функция): Функция для отправки ответа вкладке.

**Возвращает**:
- Любой тип: Возвращает результат обработки, если обработчик `listener` найден.

**Обрабатывает исключения**:
- `ex`: Общее исключение при выполнении.


### `genericListener.listeners.storePopupState(message)`

**Описание**: Запоминает состояние всплывающего окна.

**Параметры**:
- `message` (объект): Сообщение от вкладки, содержащее состояние.

### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Отправляет сообщение в текущее расширение, запрашивая восстановление состояния всплывающего окна.

**Параметры**:
- `message` (объект): Сообщение, содержащее запрос на восстановление состояния всплывающего окна.


### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Отправляет сообщение в текущее расширение, запрашивая вставку стилей CSS в всплывающее окно.


### `genericListener.listeners.showAllResults(message, sender)`

**Описание**: Выполняет действия при получении сообщения `showAllResults` от вкладки.

**Параметры**:
- `message` (объект): Сообщение с данными для отображения результатов поиска.
- `sender` (объект): Объект отправителя сообщения (вкладка).

**Обрабатывает исключения**:
- `ex`: Общее исключение при выполнении.


### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Отправляет результаты поиска в вкладку.

**Параметры**:
- `message` (объект): Сообщение от вкладки.
- `sender` (объект): Объект отправителя сообщения.
- `sendResponse` (функция): Функция для отправки ответа в вкладку.

**Возвращает**:
- `bool`: `true` для подтверждения успешной отправки.


### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Обновляет стили CSS на вкладке.

**Параметры**:
- `message` (объект): Сообщение с новыми стилями CSS.
- `sender` (объект): Объект отправителя сообщения (вкладка).

**Обрабатывает исключения**:
- `fu.onError`: Обработка исключений в функции `tryxpath.functions.onError`.


### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Возвращает настройки расширения.

**Параметры**:
- `message` (объект): Сообщение от вкладки.
- `sender` (объект): Объект отправителя сообщения.
- `sendResponse` (функция): Функция для отправки ответа в вкладку.

**Возвращает**:
- `bool`: `true` для подтверждения успешной отправки.


### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Устанавливает информацию о содержании на вкладке.

**Параметры**:
- `message` (объект): Сообщение, содержащее информацию о содержании.
- `sender` (объект): Объект отправителя сообщения.


## Обработчики событий `browser.storage.onChanged`

**Описание**: Обработчики событий изменений в хранилище настроек. Обновляет локальные переменные, отражая изменения настроек в реальном времени.

**Параметры**:
- `changes` (объект): Объект, содержащий информацию о внесенных изменениях.

```
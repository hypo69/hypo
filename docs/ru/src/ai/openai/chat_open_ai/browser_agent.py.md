# Модуль для работы с AIBrowserAgent
## Обзор

Модуль `browser_agent.py` предназначен для создания и запуска ИИ-агента, который может искать информацию в Google и анализировать веб-страницы. Он использует библиотеки `langchain_openai` и `browser_use` для интеграции с языковыми моделями OpenAI и управления браузером.

## Подробнее

Этот модуль предоставляет класс `AIBrowserAgent`, который позволяет выполнять задачи, требующие поиска и анализа информации в интернете. Он может быть использован для поиска аналогов продуктов, ответа на вопросы и других задач, требующих взаимодействия с веб-страницами. Модуль поддерживает использование как стандартного драйвера `browser_use`, так и пользовательского драйвера на основе Selenium или Playwright.

## Содержание

- [Классы](#Классы)
  - [`AIBrowserAgent`](#AIBrowserAgent)
    - [`__init__`](#__init__)
    - [`run_task`](#run_task)
    - [`find_product_alternatives`](#find_product_alternatives)
    - [`ask`](#ask)
    - [`ask_async`](#ask_async)
- [Функции](#Функции)
  - [`main`](#main)

## Классы

### `AIBrowserAgent`

**Описание**: Класс для создания агента, использующего браузер для выполнения задач.

**Как работает класс**:
Класс `AIBrowserAgent` инициализируется с использованием API-ключа OpenAI, названия модели, поисковой системы и, опционально, пользовательского драйвера браузера. Он предоставляет методы для запуска задач, поиска аналогов продуктов и ответа на вопросы с использованием поиска в интернете.

#### `__init__`

```python
def __init__(self, api_key: str, model_name: str = "gpt-4o-mini", search_engine: str = "google", custom_driver: Optional[object] = None):
    """
    Инициализирует класс BrowserAgent.

    Args:
        api_key: Ключ API OpenAI (необязательный). Если не указан, будет использован ключ из переменных окружения.
        model_name: Название языковой модели OpenAI для использования (по умолчанию "gpt-4o-mini").
        search_engine: Поисковая система для использования (по умолчанию "google").
        custom_driver: Optionally injected WebDriver instance, defaults to None (browser_use default).
    """
    ...
```

**Назначение**: Инициализация экземпляра класса `AIBrowserAgent`.

**Как работает функция**:
Функция инициализирует класс `AIBrowserAgent`, сохраняя переданные параметры (API-ключ, название модели, поисковую систему и пользовательский драйвер) в атрибуты экземпляра класса. Также инициализируется языковая модель OpenAI (`llm`) с использованием переданного API-ключа и названия модели.

**Параметры**:
- `api_key` (str): Ключ API OpenAI.
- `model_name` (str): Название языковой модели OpenAI для использования. По умолчанию "gpt-4o-mini".
- `search_engine` (str): Поисковая система для использования. По умолчанию "google".
- `custom_driver` (Optional[object], optional): Пользовательский драйвер браузера. По умолчанию `None`.

**Возвращает**:
- Нет возвращаемого значения.

**Вызывает исключения**:
- Нет явных исключений.

**Примеры**:

```python
agent = AIBrowserAgent(api_key="YOUR_API_KEY", model_name="gpt-4o-mini", search_engine="google")
```

#### `run_task`

```python
async def run_task(self, task_prompt: str) -> Optional[str]:
    """
    Запускает агента для выполнения заданной задачи.

    Args:
        task_prompt: Текст задачи для агента.

    Returns:
        Результат выполнения задачи в виде строки, или None в случае ошибки.
    """
    ...
```

**Назначение**: Запуск агента для выполнения заданной задачи.

**Как работает функция**:
Функция запускает агента для выполнения задачи, заданной в параметре `task_prompt`. Она инициализирует драйвер браузера (используя либо стандартный драйвер `browser_use`, либо пользовательский драйвер), создает экземпляр класса `Agent` из библиотеки `browser_use`, запускает выполнение задачи и возвращает результат. В случае возникновения ошибки функция логирует ошибку и возвращает `None`.

**Параметры**:
- `task_prompt` (str): Текст задачи для агента.

**Возвращает**:
- `Optional[str]`: Результат выполнения задачи в виде строки, или `None` в случае ошибки.

**Вызывает исключения**:
- Нет явных исключений, но может возникнуть исключение `Exception` при выполнении задачи.

**Примеры**:

```python
task = "Найди информацию о Python"
result = await agent.run_task(task)
if result:
    print(result)
else:
    print("Не удалось выполнить задачу.")
```

#### `find_product_alternatives`

```python
async def find_product_alternatives(self, product_url: Optional[str] = None, sku: Optional[str] = None) -> Optional[str]:
    """
    Ищет в сети аналоги для продукта по заданному URL или SKU.

    Args:
        product_url: URL продукта, для которого нужно найти аналоги (опционально).
        sku: SKU продукта, для которого нужно найти аналоги (опционально).

    Returns:
        Строку с описанием найденных аналогов, или None в случае ошибки.
    """
    ...
```

**Назначение**: Поиск аналогов продукта по заданному URL или SKU.

**Как работает функция**:
Функция ищет в интернете аналоги продукта, используя либо URL продукта, либо его SKU. Она формирует поисковый запрос, кодирует его для использования в URL, создает URL поисковой системы (Google или DuckDuckGo) и запускает задачу поиска аналогов с использованием метода `run_task`. Если не указан ни URL продукта, ни SKU, функция логирует предупреждение и возвращает `None`.

**Параметры**:
- `product_url` (Optional[str], optional): URL продукта, для которого нужно найти аналоги. По умолчанию `None`.
- `sku` (Optional[str], optional): SKU продукта, для которого нужно найти аналоги. По умолчанию `None`.

**Возвращает**:
- `Optional[str]`: Строку с описанием найденных аналогов, или `None` в случае ошибки.

**Вызывает исключения**:
- Нет явных исключений.

**Примеры**:

```python
alternatives = await agent.find_product_alternatives(product_url="https://www.example.com/product")
if alternatives:
    print(alternatives)
else:
    print("Не удалось найти аналоги.")
```

#### `ask`

```python
def ask(self, q: str) -> Optional[str]:
    """
    Синхронная обертка для асинхронного метода ask_async.  Не рекомендуется к использованию.
    """
    ...
```

**Назначение**: Синхронная обертка для асинхронного метода `ask_async`.

**Как работает функция**:
Функция является синхронной оберткой для асинхронного метода `ask_async`. Она формирует задачу ответа на вопрос и запускает ее с использованием метода `run_task`.

**Параметры**:
- `q` (str): Вопрос, на который нужно ответить.

**Возвращает**:
- `Optional[str]`: Ответ на вопрос в виде строки, или `None` в случае ошибки.

**Вызывает исключения**:
- Нет явных исключений.

**Примеры**:

```python
answer = agent.ask("Какая сейчас погода в Москве?")
if answer:
    print(answer)
else:
    print("Не удалось получить ответ на вопрос.")
```

#### `ask_async`

```python
async def ask_async(self, q: str) -> Optional[str]:
    """
    Отвечает на заданный вопрос, используя поиск в интернете, если это необходимо.

    Args:
        question: Вопрос, на который нужно ответить.

    Returns:
        Ответ на вопрос в виде строки, или None в случае ошибки.
    """
    ...
```

**Назначение**: Ответ на заданный вопрос, используя поиск в интернете.

**Как работает функция**:
Функция формирует задачу ответа на вопрос, используя поиск в интернете, и запускает ее с использованием метода `run_task`.

**Параметры**:
- `q` (str): Вопрос, на который нужно ответить.

**Возвращает**:
- `Optional[str]`: Ответ на вопрос в виде строки, или `None` в случае ошибки.

**Вызывает исключения**:
- Нет явных исключений.

**Примеры**:

```python
answer = await agent.ask_async("Какая сейчас погода в Москве?")
if answer:
    print(answer)
else:
    print("Не удалось получить ответ на вопрос.")
```

## Функции

### `main`

```python
async def main():
    """
    Пример использования класса BrowserAgent.
    """
    ...
```

**Назначение**: Пример использования класса `AIBrowserAgent`.

**Как работает функция**:
Функция `main` является примером использования класса `AIBrowserAgent`. Она инициализирует класс `AIBrowserAgent` с использованием API-ключа OpenAI и названия модели, а затем выполняет поиск аналогов продукта и ответ на вопрос с использованием методов `find_product_alternatives` и `ask_async`. Результаты выводятся на экран.

**Параметры**:
- Нет параметров.

**Возвращает**:
- Нет возвращаемого значения.

**Вызывает исключения**:
- Нет явных исключений.

**Примеры**:

```python
if __name__ == "__main__":
    asyncio.run(main())
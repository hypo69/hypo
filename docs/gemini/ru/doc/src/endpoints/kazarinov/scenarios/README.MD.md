# Схема обработки списка продуктов

## Обзор

Данная схема описывает процесс обработки запроса на перевод списка продуктов с использованием модели Gemini. Она включает в себя этапы обработки запроса, проверки ответа модели на валидность данных и извлечение переведенных данных на русском (ru) и иврите (he). В случае ошибок, таких как отсутствие ответа, невалидные данные или проблемы с парсингом, предусмотрено логирование ошибок и повторные запросы.

## Подробней

Схема начинается с получения запроса на обработку списка продуктов. Этот запрос отправляется на обработку с использованием команды модели Gemini. После получения ответа от модели выполняется ряд проверок для обеспечения корректности и валидности данных. В случае успешной обработки, извлекаются переведенные данные на русском и иврите, которые затем возвращаются.

## Элементы схемы

### Запрос на обработку продуктов (products_list)

- **Описание**: Начальная точка процесса, представляющая запрос на перевод списка продуктов.

### Обработка запроса с командой модели

- **Описание**: Этап, на котором запрос отправляется в модель Gemini для обработки.

### Ответ от модели

- **Описание**: Результат, полученный от модели Gemini в ответ на запрос.

### Логирование ошибки "no response from gemini"

- **Описание**: Обработка случая, когда от модели не получен ответ. Ошибка логируется.

### Повторный запрос

- **Описание**: В случае ошибки выполняется повторный запрос к модели с уменьшенным счетчиком попыток.

### Логирование ошибки "Error in data from gemini"

- **Описание**: Обработка случая, когда данные, полученные от модели, невалидны. Ошибка логируется.

### Данные в виде списка?

- **Описание**: Проверка формата полученных данных. Ожидается, что данные будут представлены в виде списка.

### Содержит два элемента (ru, he)?

- **Описание**: Проверка, содержит ли список два элемента, предположительно представляющих переводы на русский и иврит.

### Извлечение ru и he

- **Описание**: Извлечение переводов на русский и иврит из списка.

### Извлечение ru и he из первого элемента

- **Описание**: В случае, если список содержит только один элемент, предпринимается попытка извлечения переводов из этого элемента.

### Логирование ошибки "Проблема парсинга ответа"

- **Описание**: Обработка случая, когда возникают проблемы с парсингом ответа от модели. Ошибка логируется.

### Данные в виде объекта?

- **Описание**: Проверка формата полученных данных. Ожидается, что данные будут представлены в виде объекта.

### Извлечение ru и he из объекта

- **Описание**: Извлечение переводов на русский и иврит из объекта.

### Логирование ошибки "Invalid ru or he data"

- **Описание**: Обработка случая, когда данные на русском или иврите невалидны. Ошибка логируется.

### Возврат результата ru и he

- **Описание**: Возврат извлеченных переводов на русский и иврит.
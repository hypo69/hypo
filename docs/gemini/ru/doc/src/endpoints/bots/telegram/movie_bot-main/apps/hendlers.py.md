# Модуль обработки хендлеров для Telegram Movie Bot

## Обзор

Этот модуль содержит обработчики (handlers) для Telegram-бота, предназначенного для поиска фильмов и сериалов. Он использует библиотеку `aiogram` для обработки команд и взаимодействий с пользователем через Telegram. Модуль определяет состояния для FSM (Finite State Machine), чтобы управлять процессом поиска, а также использует пользовательские клавиатуры и функции поиска.

## Подробней

Модуль обрабатывает команды `/start`, запросы на поиск новых фильмов/сериалов, выбор типа контента (фильм или сериал) и ввод названия для поиска. Он использует FSM для управления состоянием диалога с пользователем, позволяя боту запрашивать необходимую информацию последовательно. Результаты поиска отображаются пользователю с использованием Markdown для форматирования текста.

## Классы

### `Params(StatesGroup)`

**Описание**:
Класс `Params` наследуется от `StatesGroup` и используется для определения состояний конечного автомата (FSM) для процесса поиска фильма/сериала.

**Как работает класс**:
Класс определяет два состояния: `type_movie` (тип фильма/сериала) и `name` (название фильма/сериала). Эти состояния используются для последовательного получения информации от пользователя в процессе поиска.

**Методы**:
- Нет методов.

**Параметры**:
- Нет параметров.

**Примеры**:
```python
class Params(StatesGroup):
    type_movie = State()
    name = State()
```

## Функции

### `command_start_handler(message: Message) -> None`

```python
async def command_start_handler(message: Message) -> None:
    """
    Обрабатывает команду `/start`.

    Args:
        message (Message): Объект сообщения от пользователя.

    Returns:
        None

    Raises:
        Нет исключений.

    Example:
        Пример использования:
        Пользователь отправляет команду /start боту.
    """
```

**Как работает функция**:

1. Функция отправляет приветственное сообщение пользователю, используя его полное имя.
2. Затем отправляет сообщение с предложением найти фильм, используя клавиатуру `kb.find_movie`.

**Параметры**:

- `message` (Message): Объект сообщения от пользователя, содержащий информацию об отправителе и текст сообщения.

**Возвращает**:

- `None`: Функция ничего не возвращает.

**Вызывает исключения**:

- Функция не вызывает исключений.

### `movie_handler(callback: CallbackQuery, state: FSMContext) -> None`

```python
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает нажатие кнопки "new_movies".

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Returns:
        None

    Raises:
        Нет исключений.

    Example:
        Пример использования:
        Пользователь нажимает на кнопку "new_movies".
    """
```

**Как работает функция**:

1.  Устанавливает состояние `Params.type_movie` в FSMContext, чтобы запросить у пользователя тип фильма или сериала.

2.  Редактирует сообщение, отправляя клавиатуру выбора типа контента `kb.choice`.

**Параметры**:

*   `callback` (CallbackQuery): Объект callback-запроса от пользователя.

*   `state` (FSMContext): Объект FSMContext для управления состоянием пользователя.

**Возвращает**:

*   `None`: Функция ничего не возвращает.

**Вызывает исключения**:

*   Функция не вызывает исключений.

### `series_handler(callback: CallbackQuery, state: FSMContext) -> None`

```python
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает выбор типа "сериал".

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Returns:
        None

    Raises:
        Нет исключений.

    Example:
        Пример использования:
        Пользователь выбирает тип "сериал".
    """
```

**Как работает функция**:

1.  Удаляет предыдущее сообщение с клавиатурой.

2.  Обновляет данные в FSMContext, устанавливая `type_movie` в значение `series`.

3.  Устанавливает состояние `Params.name` в FSMContext, чтобы запросить название сериала.

4.  Отправляет сообщение с запросом названия сериала.

**Параметры**:

*   `callback` (CallbackQuery): Объект callback-запроса от пользователя.

*   `state` (FSMContext): Объект FSMContext для управления состоянием пользователя.

**Возвращает**:

*   `None`: Функция ничего не возвращает.

**Вызывает исключения**:

*   Функция не вызывает исключений.

### `film_handler(callback: CallbackQuery, state: FSMContext) -> None`

```python
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает выбор типа "фильм".

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Returns:
        None

    Raises:
        Нет исключений.

    Example:
        Пример использования:
        Пользователь выбирает тип "фильм".
    """
```

**Как работает функция**:

1.  Удаляет предыдущее сообщение с клавиатурой.

2.  Обновляет данные в FSMContext, устанавливая `type_movie` в значение `film`.

3.  Устанавливает состояние `Params.name` в FSMContext, чтобы запросить название фильма.

4.  Отправляет сообщение с запросом названия фильма.

**Параметры**:

*   `callback` (CallbackQuery): Объект callback-запроса от пользователя.

*   `state` (FSMContext): Объект FSMContext для управления состоянием пользователя.

**Возвращает**:

*   `None`: Функция ничего не возвращает.

**Вызывает исключения**:

*   Функция не вызывает исключений.

### `name_handler(message: Message, state: FSMContext) -> None`

```python
async def name_handler(message: Message, state: FSMContext) -> None:
    """
    Обрабатывает ввод названия фильма/сериала.

    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием пользователя.

    Returns:
        None

    Raises:
        Нет исключений.

    Example:
        Пример использования:
        Пользователь вводит название фильма или сериала.
    """
```

**Как работает функция**:

1.  Обновляет данные в FSMContext, сохраняя название фильма/сериала, введенное пользователем.

2.  Извлекает данные из FSMContext (название и тип).

3.  Вызывает функцию `search_query` для поиска фильма/сериала.

4.  Отправляет пользователю информацию о запросе (название и тип).

5.  Если фильм/сериал найден, отправляет информацию о нем (название, описание, ссылка).

6.  Если фильм/сериал не найден, отправляет сообщение об отсутствии результатов.

7.  Предлагает пользователю найти новый фильм/сериал с помощью клавиатуры `kb.find_movie`.

8.  Очищает состояние FSMContext.

**Параметры**:

*   `message` (Message): Объект сообщения от пользователя.

*   `state` (FSMContext): Объект FSMContext для управления состоянием пользователя.

**Возвращает**:

*   `None`: Функция ничего не возвращает.

**Вызывает исключения**:

*   Функция не вызывает исключений.
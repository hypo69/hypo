# Модуль try_xpath_content.js

## Обзор

Этот JavaScript-модуль (`try_xpath_content.js`) отвечает за обработку запросов на выполнение XPath-выражений в текущем документе и фреймах. Он взаимодействует с браузерным расширением (`tryxpath`) для получения данных и управления стилями. Модуль реализует функции для поиска элементов, фокусировки на них, обработки событий сообщений, управления стилями и работы с фреймами.


## Переменные

### `tx`

**Описание**: псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: псевдоним для объекта `tryxpath.functions`.

### `tx.isContentLoaded`

**Описание**: Флаг, предотвращающий повторное выполнение кода при загрузке страницы.

### `dummyItem`, `dummyItems`, `invalidExecutionId`

**Описание**:  Пустые значения, используемые как заполнители.

### `styleElementHeader`

**Описание**:  Строка, добавляемая в начало стилей для идентификации, вставленных расширением.

### `attributes`

**Описание**: Объект, содержащий атрибуты данных для элементов, используемые для поиска и фокусировки.

### `prevMsg`

**Описание**: Сохраняет предыдущее сообщение для передачи в расширение.

### `executionCount`

**Описание**: Счетчик количества выполненных запросов.

### `inBlankWindow`

**Описание**: Флаг, указывающий, работает ли код в дочернем фрейме.

### `currentDocument`

**Описание**: Текущий документ, на котором выполняются операции.

### `contextItem`

**Описание**: Элемент, используемый в качестве контекста для XPath-выражения.

### `currentItems`

**Описание**: Список найденных элементов по XPath-выражению.

### `focusedItem`, `focusedAncestorItems`

**Описание**: Элементы, на которых установлен фокус и их предки.

### `currentCss`

**Описание**: Текущий CSS-стиль, загруженный в браузер.

### `insertedStyleElements`

**Описание**:  Хранит вставленные стили и связанный с ними документ.

### `expiredCssSet`

**Описание**:  Множество устаревших CSS-стилей.

### `originalAttributes`

**Описание**:  Хранит исходные значения атрибутов элементов.



## Функции

### `setAttr(attr, value, item)`

**Описание**: Устанавливает значение атрибута для заданного элемента. Сохраняет исходные значения.

**Параметры**:
- `attr` (str): Название атрибута.
- `value` (str): Значение атрибута.
- `item` (элемент): Элемент, для которого устанавливается атрибут.

**Возвращает**: None

### `setIndex(attr, items)`

**Описание**: Устанавливает индексы элементов в массиве. Сохраняет исходные значения.

**Параметры**:
- `attr` (str): Название атрибута.
- `items` (массив): Массив элементов, для которых устанавливаются индексы.

**Возвращает**: None

### `isFocusable(item)`

**Описание**: Проверяет, можно ли установить фокус на элемент.

**Параметры**:
- `item` (элемент): Элемент для проверки.

**Возвращает**: bool.

### `focusItem(item)`

**Описание**: Устанавливает фокус на элемент.

**Параметры**:
- `item` (элемент): Элемент, на котором устанавливается фокус.

**Возвращает**: None


### `setMainAttrs()`

**Описание**: Устанавливает атрибуты для главного контекста.

**Параметры**: None

**Возвращает**: None

### `restoreAttrs()`

**Описание**: Восстанавливает исходные атрибуты элементов.

**Параметры**: None

**Возвращает**: None


### `resetPrev()`

**Описание**: Сбрасывает данные предыдущего запроса.

**Параметры**: None

**Возвращает**: None

### `makeTypeStr(resultType)`

**Описание**: Преобразует значение `resultType` в строку.

**Параметры**:
- `resultType` (число):  значение типа результата.

**Возвращает**: str

### `updateCss()`

**Описание**: Обновляет CSS в браузере.

**Параметры**: None

**Возвращает**: None

### `getFrames(spec)`

**Описание**: Получает список фреймов по спецификации.

**Параметры**:
- `spec` (строка): JSON-представление спецификации.

**Возвращает**: массив фреймов или выброс ошибки.

### `parseFrameDesignation(frameDesi)`

**Описание**: Парсит строку с указанием фрейма.

**Параметры**:
- `frameDesi` (строка): строка с указанием фрейма в JSON формате.

**Возвращает**: массив чисел или выброс ошибки.


### `traceBlankWindows(desi, win)`

**Описание**: Проверяет, является ли фрейм пустым.

**Параметры**:
- `desi` (массив): массив индексов фреймов
- `win` (экземпляр окна): Текущее окно.

**Возвращает**: объект с результатом (success, failedWindow, windows).



### `handleCssChange(newCss)`

**Описание**: Обрабатывает изменения CSS.

**Параметры**:
- `newCss` (строка): Новый CSS.

**Возвращает**: None

### `findFrameByMessage(event, win)`

**Описание**: Находит фрейм по сообщению.

**Параметры**:
- `event` (объект события): Объект события.
- `win` (экземпляр окна): Текущее окно.

**Возвращает**: Элемент фрейма или `null`.

### `setFocusFrameListener(win, isBlankWindow)`

**Описание**: Устанавливает обработчик событий для фреймов.

**Параметры**:
- `win` (экземпляр окна): Текущее окно.
- `isBlankWindow` (булево): Флаг, указывающий на пустое окно.

**Возвращает**: None


### `initBlankWindow(win)`

**Описание**: Инициализирует обработчик событий для пустых окон.


### `findStyleParent(doc)`

**Описание**: Находит родительский элемент для стилей.

**Параметры**:
- `doc` (документ): Документ для поиска.

**Возвращает**: Родительский элемент или `null`.


### `updateStyleElement(doc)`

**Описание**: Обновляет стили в документе.

**Параметры**:
- `doc` (документ): Документ для обновления.

**Возвращает**: None


### `updateAllStyleElements()`

**Описание**: Обновляет все стили во всех документах.

**Параметры**: None

**Возвращает**: None


### `removeStyleElement(doc)`

**Описание**: Удаляет элемент стиля из документа.

**Параметры**:
- `doc` (документ): Документ, из которого удаляется стиль.

**Возвращает**: None

### `removeAllStyleElements()`

**Описание**: Удаляет все вставленные стили.

**Параметры**: None

**Возвращает**: None



### `createResultMessage()`

**Описание**: Создает сообщение об ошибке или успехе.

**Параметры**: None

**Возвращает**: объект с результатом.


### `genericListener(message, sender, sendResponse)`

**Описание**: Общий обработчик сообщений от расширения.

**Параметры**:
- `message` (объект): Данные сообщения.
- `sender` (объект): Отправитель сообщения.
- `sendResponse` (функция): Функция для отправки ответа.

**Возвращает**: `sendResponse` или `undefined`.

### `genericListener.listeners.setContentInfo`

**Описание**:  Устанавливает значения атрибутов.

**Параметры**:
- `message` (объект): Данные сообщения.

**Возвращает**: None


### `genericListener.listeners.execute`

**Описание**: Выполняет XPath-запрос.

**Параметры**:
- `message` (объект): Данные сообщения.
- `sender` (объект): Отправитель сообщения.

**Возвращает**: None.


### `genericListener.listeners.focusItem`


**Описание**: Устанавливает фокус на элемент.

**Параметры**:
- `message` (объект): Данные сообщения.

**Возвращает**: None


### `genericListener.listeners.focusContextItem`

**Описание**: Устанавливает фокус на элемент контекста.

**Параметры**:
- `message` (объект): Данные сообщения.

**Возвращает**: None


### `genericListener.listeners.focusFrame`

**Описание**: Устанавливает фокус на фрейм.


**Параметры**:
- `message` (объект): Данные сообщения.

**Возвращает**: None

### `genericListener.listeners.requestShowResultsInPopup`

**Описание**: Отправляет предыдущие результаты в поп-ап.

**Параметры**: None

**Возвращает**: None

### Остальные `genericListener.listeners...`

**Описание**: Обработчики различных событий и запросов.
# Модуль `hypotez/src/ai/openai/model/training.py`

## Обзор

Этот модуль содержит класс `OpenAIModel`, предназначенный для взаимодействия с API OpenAI, управления моделью и ее обучения. Он включает методы для отправки запросов, анализа тональности сообщений, динамического обучения на основе предыдущих диалогов и непосредственного обучения модели на наборах данных. Также предоставляет функции для работы с изображениями.

## Классы

### `OpenAIModel`

**Описание**: Класс для взаимодействия с API OpenAI, управления моделью и ее обучения.

**Атрибуты**:

* `model` (str): Идентификатор модели OpenAI. По умолчанию `gpt-4o-mini`.
* `client` (OpenAI): Клиентское соединение с API OpenAI.
* `current_job_id` (str): Идентификатор текущей задачи обучения.
* `assistant_id` (str): Идентификатор ассистента.
* `assistant` (object): Объект ассистента.
* `thread` (object): Объект потока диалога.
* `system_instruction` (str): Системная инструкция для модели.
* `dialogue_log_path` (str | Path): Путь к файлу для сохранения диалога.
* `dialogue` (List[Dict[str, str]]): Список сообщений диалога.
* `assistants` (List[SimpleNamespace]): Список доступных ассистентов.
* `models_list` (List[str]): Список доступных моделей.


**Методы**:

#### `__init__(self, system_instruction: str = None, model_name: str = 'gpt-4o-mini', assistant_id: str = None)`

**Описание**: Инициализирует объект `OpenAIModel`.

**Параметры**:

* `system_instruction` (str, необязательно): Системная инструкция для модели.
* `model_name` (str, необязательно): Идентификатор модели. По умолчанию `gpt-4o-mini`.
* `assistant_id` (str, необязательно): Идентификатор ассистента.

**Возвращает**:
- Без возвращаемого значения.

#### `list_models(self) -> List[str]`

**Описание**: Возвращает список доступных моделей из API OpenAI.

**Возвращает**:
- `List[str]`: Список идентификаторов моделей.

#### `list_assistants(self) -> List[str]`

**Описание**: Возвращает список доступных ассистентов из файла `assistants.json`.

**Возвращает**:
- `List[str]`: Список имён ассистентов.

#### `set_assistant(self, assistant_id: str)`

**Описание**: Устанавливает ассистента с заданным `assistant_id`.

**Параметры**:
* `assistant_id` (str): Идентификатор ассистента.

**Возвращает**:
- Без возвращаемого значения.

#### `_save_dialogue(self)`

**Описание**: Сохраняет диалог в файл `dialogue_log_path`.

**Возвращает**:
- Без возвращаемого значения.

#### `determine_sentiment(self, message: str) -> str`

**Описание**: Определяет эмоциональную тональность сообщения (positive, negative, neutral).

**Параметры**:
* `message` (str): Сообщение для анализа.

**Возвращает**:
- `str`: Эмоциональная тональность сообщения.


#### `ask(self, message: str, system_instruction: str = None, attempts: int = 3) -> str`

**Описание**: Отправляет сообщение модели и возвращает ответ, а также анализ эмоциональной тональности.

**Параметры**:
* `message` (str): Сообщение для модели.
* `system_instruction` (str, необязательно): Системная инструкция.
* `attempts` (int, необязательно): Количество попыток повтора запроса.

**Возвращает**:
- `str`: Ответ модели.

#### `describe_image(self, image_path: str | Path, prompt: Optional[str] = None, system_instruction: Optional[str] = None) -> str`

**Описание**: Описывает изображение, используя API OpenAI.

**Параметры**:
* `image_path` (str | Path): Путь к изображению.
* `prompt` (str, необязательно): Подсказка для модели.
* `system_instruction` (str, необязательно): Системная инструкция.

**Возвращает**:
- `str`: Описание изображения.

#### `describe_image_by_requests(self, image_path: str | Path, prompt: str = None) -> str`

**Описание**: Описывает изображение, используя API OpenAI через requests.

**Параметры**:
* `image_path` (str | Path): Путь к изображению.
* `prompt` (str, необязательно): Подсказка для модели.

**Возвращает**:
- `str`: Описание изображения.


#### `dynamic_train(self)`

**Описание**: Динамическое обучение модели на основе предыдущих диалогов.

**Возвращает**:
- Без возвращаемого значения.


#### `train(self, data: str = None, data_dir: Path | str = None, data_file: Path | str = None, positive: bool = True) -> str | None`

**Описание**: Обучает модель на заданном наборе данных.

**Параметры**:
* `data` (str, необязательно): Путь к CSV файлу или CSV-строка данных.
* `data_dir` (Path | str, необязательно): Путь к директории с CSV файлами.
* `data_file` (Path | str, необязательно): Путь к CSV файлу.
* `positive` (bool, необязательно): Признак положительности данных.

**Возвращает**:
- `str | None`: Идентификатор задачи обучения или `None` при ошибке.

#### `save_job_id(self, job_id: str, description: str, filename: str = "job_ids.json")`

**Описание**: Сохраняет идентификатор задачи обучения с описанием в файл.

**Параметры**:
* `job_id` (str): Идентификатор задачи обучения.
* `description` (str): Описание задачи.
* `filename` (str, необязательно): Имя файла для сохранения.


## Функции

### `main()`

**Описание**: Главное выполнение модуля, демонстрирующее использование класса `OpenAIModel`.

**Возвращает**:
- Без возвращаемого значения.
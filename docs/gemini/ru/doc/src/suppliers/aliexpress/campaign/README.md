# Модуль `src.suppliers.aliexpress.campaign`

## Обзор

Модуль `campaign` предназначен для управления процессом создания и публикации рекламных кампаний на Facebook. Он включает функциональность для инициализации параметров кампании (название, язык, валюта), создания директорий, сохранения конфигурации новой кампании, сбора и сохранения данных о продуктах через `ali` или `html`, генерации рекламных материалов, проверки кампании и ее публикации на Facebook.

```mermaid
flowchart TD
    A[Start: Создание рекламной кампании для размещения на Facebook] --> B[Инициализировать название, язык и валюту кампании]
    B --> C[Создать директории кампании и категорий]
    C --> D[Сохранить конфигурацию кампании]
    D --> E[Собрать данные о продуктах]
    E --> F[Сохранить данные о продуктах]
    F --> G[Создать рекламные материалы]
    G --> H[Проверить кампанию]
    H --> I{Готова ли кампания?}
    I -- Да --> J[Опубликовать кампанию на Facebook]
    I -- Нет --> H
    J --> K[Конец: Завершение создания рекламной кампании]
```

**Этапы создания кампании:**

- **Шаг 1**: Начало - Процесс начинается.
- **Шаг 2**: Инициализация данных кампании - Определяются имя кампании, язык и валюта. Пример: Название кампании: "Летняя распродажа", Язык: "Русский", Валюта: "RUB"
- **Шаг 3**: Создание директорий кампании и категорий - Создаются необходимые директории или файлы для кампании. Пример: Создается структура каталогов на файловой системе для хранения активов кампании.
- **Шаг 4**: Сохранение конфигурации кампании - Сохранены инициализированные данные кампании. Пример: Данные записываются в базу данных или конфигурационный файл.
- **Шаг 5**: Сбор данных о продуктах - Сбор данных, связанных с продуктами, которые будут рекламироваться в рамках кампании. Пример: Идентификаторы продуктов, описания, изображения и цены извлекаются из системы инвентаризации.
- **Шаг 6**: Сохранение данных о продуктах - Сохранены собранные данные о продуктах. Пример: Данные записываются в таблицу базы данных, предназначенную для продуктов кампании.
- **Шаг 7**: Создание рекламных материалов - Создаются или выбираются графические элементы, баннеры и другие рекламные активы. Пример: Изображения и описания подбираются для привлечения клиентов.
- **Шаг 8**: Проверка кампании - Процесс проверки подтверждает готовность компонентов кампании. Пример: Человек или система проверяют качество и полноту всех компонентов кампании.
- **Шаг 9**: Готова ли кампания? - Проверка, чтобы определить, завершена ли кампания и готова к публикации. Пример: Логический флаг указывает "Да", если все готово, в противном случае "Нет", что приводит к циклу возврата к предыдущему шагу для внесения исправлений.
- **Шаг 10**: Публикация кампании - Кампания публикуется на платформе, готовая к маркетинговым усилиям. Пример: Выполняются API-вызовы для публикации кампании на соответствующей платформе.
- **Шаг 11**: Конец - Процесс создания кампании завершен.


## Редактирование кампании

```mermaid
graph LR
    A[Ввод данных пользователя: campaign_name, language, currency] --> B{AliCampaignEditor.__init__};
    B --> C[AliPromoCampaign.__init__];
    C --> D[Инициализация: Конструктор AliCampaignEditor];
    D --> E[AliCampaignEditor];
    
    E --> F[delete_product: Проверка на наличие партнерской ссылки];
    F --> G[read_text_file sources.txt: Чтение списка продуктов];
    G --> H[Итерация и проверка product_id: Цикл по списку продуктов];
    H -- Совпадение --> I[удаление и сохранение: Удаление продукта, если найдено совпадение];
    H -- Отсутствие совпадения --> J[переименование файла продукта: Переименование файла продукта, если совпадения нет];
    
    E --> K[update_product: Обновление данных продукта];
    K --> L[Вызов dump_category_products_files: Обновление категории с новым продуктом];
    
    E --> M[update_campaign: Обновление свойств кампании, например, описания];
    M --> N[Обновление параметров кампании];
    
    E --> O[update_category: Обновление категории в файле JSON];
    O --> P[j_loads JSON file: Чтение данных категории];
    P --> Q[Обновление категории: Обновление данных категории];
    Q --> R[j_dumps JSON file: Запись обновленной категории в файл];
    
    E --> S[get_category: Получение категории по имени];
    S --> T[Проверка на существование категории];
    T -- Найдена --> U[Возврат SimpleNamespace: Возврат данных категории];
    T -- Не найдена --> V[Журнал предупреждения: Категория не найдена в кампании];
    
    E --> W[list_categories: Список всех категорий в кампании];
    W --> X[Проверка атрибута категории: Убедитесь, что категории существуют в кампании];
    X -- Найдена --> Y[Возврат списка категорий: Список имен категорий];
    X -- Не найдена --> Z[Журнал предупреждения: Категории не найдены в кампании];
    
    E --> AA[get_category_products: Получение продуктов для категории];
    AA --> AB[Получение пути категории: Создание пути для продуктов категории];
    AB --> AC[Получение имен файлов JSON: Получение всех файлов JSON с продуктами];
    AC --> AD[Чтение файлов JSON: Загрузка данных продуктов];
    AD --> AE[Создание SimpleNamespace: Преобразование данных продуктов в объекты];
    AE --> AF[Возврат продуктов: Возврат списка продуктов];
    AC -- Нет файлов JSON --> AG[Журнал ошибки: Файлы не найдены];
    AG --> AH[Обработка категории: Запуск подготовки продуктов категории];
    
    E --> AI[Другие методы];
```

## Подготовка кампании

```mermaid
flowchart TD
    A[Начало] --> B{Обработать все кампании?}
    B -->|Да| C[Обработать все кампании]
    B -->|Нет| D[Обработать определенную кампанию]
    
    C --> E{Указаны язык и валюта?}
    E -->|Да| F[Обработать каждую кампанию с указанным языком и валютой]
    E -->|Нет| G[Обработать все языковые варианты для каждой кампании]
    
    D --> H{Указаны категории?}
    H -->|Да| I[Обработать определенные категории для кампании]
    H -->|Нет| J[Обработать всю кампанию]
    
    F --> K[Обработать категорию кампании]
    G --> L[Обработать кампанию для всех языковых вариантов]
    I --> K
    J --> L
    
    K --> M[Возврат]
    L --> M
```
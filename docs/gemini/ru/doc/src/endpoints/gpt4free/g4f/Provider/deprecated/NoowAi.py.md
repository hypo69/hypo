# Модуль `NoowAi`

## Обзор

Модуль `NoowAi` предоставляет асинхронный генератор для взаимодействия с сервисом NoowAI. Он поддерживает отправку сообщений, использование прокси и работу с моделью `gpt-35-turbo`.

## Подробней

Этот модуль предназначен для интеграции с сервисом NoowAI, предоставляя возможность отправлять запросы к модели и получать ответы в асинхронном режиме. Он использует `aiohttp` для выполнения HTTP-запросов и обрабатывает потоковые данные, возвращаемые сервером. Модуль также включает поддержку прокси-серверов и настройки заголовков запросов.

## Классы

### `NoowAi`

**Описание**: Класс `NoowAi` является асинхронным генератором, реализующим взаимодействие с сервисом NoowAI.

**Наследует**:
- `AsyncGeneratorProvider`: Наследует функциональность асинхронного генератора от базового класса `AsyncGeneratorProvider`.

**Атрибуты**:
- `url` (str): URL сервиса NoowAI (`"https://noowai.com"`).
- `supports_message_history` (bool): Поддержка истории сообщений (значение `True`).
- `supports_gpt_35_turbo` (bool): Поддержка модели `gpt-35-turbo` (значение `True`).
- `working` (bool): Указывает, работает ли провайдер в данный момент (значение `False`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для взаимодействия с сервисом NoowAI.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для взаимодействия с сервисом NoowAI.

        Args:
            model (str): Имя модели для использования.
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
            **kwargs: Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий ответы от сервиса NoowAI.

        Raises:
            RuntimeError: Если возникает ошибка при обработке ответа от сервиса NoowAI.

        Внутренние функции:
            Нет.
        """
```

**Назначение**: Создает асинхронный генератор для взаимодействия с сервисом NoowAI.

**Параметры**:
- `cls`: Ссылка на класс.
- `model` (str): Имя используемой модели.
- `messages` (Messages): Список сообщений для отправки в запросе.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий ответы от сервиса NoowAI.

**Вызывает исключения**:
- `RuntimeError`: Возникает, если при обработке ответа от сервиса NoowAI происходит ошибка.

**Как работает функция**:
1. **Формирование заголовков**: Создаются заголовки запроса, включающие User-Agent, Accept, Referer, Content-Type и другие необходимые параметры.
2. **Создание сессии**: Используется `aiohttp.ClientSession` для выполнения асинхронных HTTP-запросов.
3. **Подготовка данных**: Формируется JSON-тело запроса с данными, включающими идентификаторы бота, сессии, чата, контекста, сообщения и флаг потоковой передачи.
4. **Отправка запроса**: Отправляется POST-запрос к сервису NoowAI по URL `/wp-json/mwai-ui/v1/chats/submit`.
5. **Обработка потока**: Полученный ответ обрабатывается построчно. Каждая строка проверяется на наличие префикса `b"data: "`.
6. **Разбор JSON**: Если строка начинается с `b"data: "`, из нее извлекается JSON-объект.
7. **Обработка типов сообщений**: В зависимости от типа сообщения (`live`, `end`, `error`) выполняются различные действия:
   - `live`: Извлекаются данные и передаются в генератор.
   - `end`: Завершается работа генератора.
   - `error`: Вызывается исключение `RuntimeError` с сообщением об ошибке.

**ASCII flowchart**:

```
    Начало
    │
    ├── Заголовки запроса
    │
    ├── Создание сессии aiohttp.ClientSession
    │
    ├── Подготовка JSON-данных (botId, customId, session, chatId, contextId, messages, newMessage, stream)
    │
    ├── Отправка POST-запроса на f"{cls.url}/wp-json/mwai-ui/v1/chats/submit"
    │
    ├── Обработка потока данных ответа
    │   └── Для каждой строки:
    │       ├── Проверка на префикс b"data: "
    │       │   └── Если префикс есть:
    │       │       ├── Извлечение JSON из строки
    │       │       ├── Проверка наличия ключа "type"
    │       │       ├── Обработка типа:
    │       │       │   ├── "live": Выдача данных через yield
    │       │       │   ├── "end": Завершение генератора
    │       │       │   ├── "error": Вызов RuntimeError
    │       │       └── Если префикса нет:
    │       │           └── Вызов RuntimeError
    │       └── Если префикса нет:
    │           └── Пропуск строки
    │
    └── Завершение
```

**Примеры**:

```python
# Пример использования асинхронного генератора
async def main():
    model = "gpt-3.5-turbo"
    messages = [{"role": "user", "content": "Hello, NoowAI!"}]
    async for response in NoowAi.create_async_generator(model=model, messages=messages):
        print(response)

# Пример использования с прокси
async def main():
    model = "gpt-3.5-turbo"
    messages = [{"role": "user", "content": "Hello, NoowAI!"}]
    proxy = "http://your_proxy:8080"
    async for response in NoowAi.create_async_generator(model=model, messages=messages, proxy=proxy):
        print(response)
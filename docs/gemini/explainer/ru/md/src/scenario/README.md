# Описание модуля `src.scenario`

## Обзор модуля

Модуль `src.scenario` предназначен для автоматизации взаимодействия с поставщиками с помощью сценариев, описанных в JSON-файлах.  Основная задача — адаптировать процесс извлечения и обработки данных о продуктах с веб-сайтов поставщиков и синхронизировать эту информацию с базой данных системы.

## Основные функции модуля

1. **Чтение сценариев**: Модуль загружает сценарии из JSON-файлов, содержащих информацию о различных категориях продуктов и их URL-адресах на веб-сайте поставщика.

2. **Взаимодействие с веб-сайтами**: Используя URL-адреса, указанные в сценариях, модуль переходит на страницы продуктов и извлекает необходимые данные.

3. **Обработка данных**: Модуль обрабатывает извлечённые данные о продуктах, преобразует их в требуемый формат и сохраняет в базе данных системы (например, PrestaShop).

4. **Ведение журнала выполнения**: Модуль сохраняет журнал выполнения сценариев, записывая детали выполнения и результаты. Это помогает отслеживать успешность и выявлять ошибки.

## Основные компоненты модуля

1. **`run_scenario_files(s, scenario_files_list)`**:
   - Принимает список файлов сценариев и обрабатывает их последовательно.
   - Вызывает `run_scenario_file` для обработки каждого файла сценария.

2. **`run_scenario_file(s, scenario_file)`**:
   - Загружает сценарии из указанного файла и вызывает `run_scenario` для каждого сценария в файле.

3. **`run_scenario(s, scenario)`**:
   - Обрабатывает отдельный сценарий.
   - Переходит по URL, указанному в сценарии, и извлекает данные о продуктах.
   - Сохраняет извлечённые данные в базу данных.

4. **`dump_journal(s, journal)`**:
   - Сохраняет журнал выполнения сценариев в файл для последующего анализа.

5. **`main()`**:
   - Основная функция для запуска модуля.

## Пример сценария

Пример JSON-сценария описывает взаимодействие со специфическими категориями продуктов на веб-сайте. Он включает:
- **URL страницы**: для навигации и извлечения данных.
- **Имя категории**: для идентификации категории.
- **`presta_categories`**: идентификаторы категорий в базе данных PrestaShop, где будут сохранены продукты.

```json
{
    "scenarios": {
        "минерал+לחויותלפניםמינרליםותמציותצמחים": {
            "url": "https://hbdeadsea.co.il/product-category/facial/moisture-face/",
            "name": "минерал+לחויותלפניםמינרליםותמציותצמחים",
            "presta_categories": {
                "default_category": 11245,
                "additional_categories": [11288]
            }
        }
    }
}
```

## Поля сценария

- **`"scenario_name"`**: Имя сценария.
- **`"url"`**: Целевой адрес (ссылка на категорию, раздел или отдельный продукт).
- **`"name"`**: Название категории (соответствует имени сценария).
- **`"presta_categories"`**:
    - **`"default_category"`**: ID стандартной категории в PrestaShop для продуктов этого сценария.
    - **`"additional_categories"`**: Список дополнительных ID категорий в PrestaShop для дальнейшей классификации.

Это поле определяет категории в PrestaShop, где будут храниться данные о продуктах. Во время выполнения сценария эта информация используется для обновления соответствующих данных в базе данных.

## Как это работает

1. **Загрузка сценариев**: Модуль загружает и анализирует сценарии из файлов.
2. **Извлечение данных**: Переходит по URL из сценария, извлекает ссылки на продукты и собирает информацию о них.
3. **Сохранение данных**: Обрабатывает и сохраняет собранные данные в базе данных, используя информацию о категориях из сценария.
4. **Отчёты и ведение журнала**: Ведёт журнал выполнения сценариев для отслеживания прогресса и записи ошибок.

Этот модуль помогает автоматизировать сбор и обработку данных о продуктах из различных источников, упрощая интеграцию с разными поставщиками и системами управления продуктами.


## Поток работы модуля исполнителя сценариев

1. **Инициализация**:
   - **Создание экземпляра поставщика**: Создайте экземпляр класса `Supplier` с соответствующим аргументом (например, 'aliexpress').

2. **Запуск сценариев**:
   - **Выполнение одного файла**:
     ```python
     s = Supplier('aliexpress')
     s.run('file1')
     ```
   - **Выполнение нескольких файлов**:
     ```python
     scenario_files = ['file1', 'file2']
     s.run(scenario_files)
     ```
   - **Выполнение одного сценария**:
     ```python
     scenario1 = {'key': 'value'}
     s.run(scenario1)
     ```
   - **Выполнение нескольких сценариев**:
     ```python
     list_of_scenarios = [scenario1, scenario2]
     s.run(list_of_scenarios)
     ```

Далее подробно описывается логика выполнения в различных вариантах запуска.


## Подробный анализ модуля `executor.py` (содержимое документации не полностью соответствует коду)

Модуль `executor.py` содержит функции и методы для выполнения сценариев, связанных с автоматическим сбором данных с веб-сайтов или тестированием.  Основная цель — извлечение данных о продуктах с страниц категорий и вставка этих данных в систему PrestaShop.  Подробные функции, описанные в документе, следует сопоставить с реальным кодом в файле `executor.py` для точного понимания.  Некоторые моменты требуют уточнения и соответствия коду.


**Важно:** Документация в README содержит довольно подробное описание, но для полного понимания требуется ознакомиться с кодом `executor.py`.  Многие из функций и переменных, упоминаемых в тексте, должны иметь конкретное определение в коде, которое позволит точно понять их назначение.
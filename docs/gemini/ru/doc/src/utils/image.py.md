# src.utils.image

## Обзор

Модуль `src.utils.image` предоставляет асинхронные функции для загрузки, сохранения и обработки изображений. Он включает в себя функции для сохранения изображений из URL-адресов, сохранения данных изображений в файлы, получения данных изображений, поиска случайных изображений в каталогах, добавления водяных знаков, изменения размера и преобразования форматов изображений.

## Оглавление

- [Классы](#классы)
    - [`ImageError`](#imageerror)
- [Функции](#функции)
    - [`save_image_from_url`](#save_image_from_url)
    - [`save_image`](#save_image)
    - [`get_image_bytes`](#get_image_bytes)
    - [`get_raw_image_data`](#get_raw_image_data)
    - [`random_image`](#random_image)
    - [`add_text_watermark`](#add_text_watermark)
    - [`add_image_watermark`](#add_image_watermark)
    - [`resize_image`](#resize_image)
    - [`convert_image`](#convert_image)
    - [`process_images_with_watermark`](#process_images_with_watermark)

## Классы

### `ImageError`

**Описание**: Пользовательское исключение для ошибок, связанных с изображениями.

## Функции

### `save_image_from_url`

**Описание**: Загружает изображение из URL-адреса и сохраняет его локально асинхронно.

**Параметры**:
- `image_url` (str): URL-адрес для загрузки изображения.
- `filename` (Union[str, Path]): Имя файла для сохранения изображения.

**Возвращает**:
- `Optional[str]`: Путь к сохраненному файлу или None, если операция не удалась.

**Вызывает исключения**:
- `ImageError`: Если загрузка или сохранение изображения не удались.

### `save_image`

**Описание**: Сохраняет данные изображения в файл в указанном формате асинхронно.

**Параметры**:
- `image_data` (bytes): Двоичные данные изображения.
- `file_name` (Union[str, Path]): Имя файла для сохранения изображения.
- `format` (str): Формат для сохранения изображения, по умолчанию PNG.

**Возвращает**:
- `Optional[str]`: Путь к сохраненному файлу или None, если операция не удалась.

**Вызывает исключения**:
- `ImageError`: Если файл не может быть создан, сохранен или если сохраненный файл пуст.

### `get_image_bytes`

**Описание**: Читает изображение с помощью Pillow и возвращает его байты в формате JPEG.

**Параметры**:
- `image_path` (Path): Путь к файлу изображения.
- `raw` (bool): Если True, возвращает объект BytesIO; в противном случае возвращает байты. По умолчанию True.

**Возвращает**:
- `Optional[Union[BytesIO, bytes]]`: Байты изображения в формате JPEG или None, если произошла ошибка.

### `get_raw_image_data`

**Описание**: Извлекает необработанные двоичные данные файла, если он существует.

**Параметры**:
- `file_name` (Union[str, Path]): Имя или путь к файлу для чтения.

**Возвращает**:
- `Optional[bytes]`: Двоичные данные файла или None, если файл не существует или произошла ошибка.

### `random_image`

**Описание**: Рекурсивно ищет случайное изображение в указанном каталоге.

**Параметры**:
- `root_path` (Union[str, Path]): Каталог для поиска изображений.

**Возвращает**:
- `Optional[str]`: Путь к случайному изображению или None, если изображения не найдены.

### `add_text_watermark`

**Описание**: Добавляет текстовый водяной знак к изображению.

**Параметры**:
- `image_path` (Union[str, Path]): Путь к файлу изображения.
- `watermark_text` (str): Текст для использования в качестве водяного знака.
- `output_path` (Optional[Union[str, Path]]): Путь для сохранения изображения с водяным знаком. По умолчанию перезаписывает исходное изображение.

**Возвращает**:
- `Optional[str]`: Путь к изображению с водяным знаком или None в случае неудачи.

### `add_image_watermark`

**Описание**: Добавляет водяной знак к изображению и сохраняет результат по указанному пути.

**Параметры**:
- `input_image_path` (Path): Путь к исходному изображению.
- `watermark_image_path` (Path): Путь к изображению водяного знака.
- `output_image_path` (Optional[Path]): Путь для сохранения изображения с водяным знаком. Если не указан, изображение будет сохранено в каталоге "output".

**Возвращает**:
- `Optional[Path]`: Путь к сохраненному изображению с водяным знаком или None, если операция не удалась.

### `resize_image`

**Описание**: Изменяет размер изображения до указанных размеров.

**Параметры**:
- `image_path` (Union[str, Path]): Путь к файлу изображения.
- `size` (Tuple[int, int]): Кортеж, содержащий желаемую ширину и высоту изображения.
- `output_path` (Optional[Union[str, Path]]): Путь для сохранения измененного размера изображения. По умолчанию перезаписывает исходное изображение.

**Возвращает**:
- `Optional[str]`: Путь к изображению измененного размера или None в случае неудачи.

### `convert_image`

**Описание**: Преобразует изображение в указанный формат.

**Параметры**:
- `image_path` (Union[str, Path]): Путь к файлу изображения.
- `format` (str): Формат для преобразования изображения (например, "JPEG", "PNG").
- `output_path` (Optional[Union[str, Path]]): Путь для сохранения преобразованного изображения. По умолчанию перезаписывает исходное изображение.

**Возвращает**:
- `Optional[str]`: Путь к преобразованному изображению или None в случае неудачи.

### `process_images_with_watermark`

**Описание**: Обрабатывает все изображения в указанной папке, добавляя водяной знак и сохраняя их в каталоге "output".

**Параметры**:
- `folder_path` (Path): Путь к папке, содержащей изображения.
- `watermark_path` (Path): Путь к изображению водяного знака.
# Модуль `tinytroupe.extraction`

## Обзор

Этот модуль предоставляет инструменты для извлечения структурированных данных из элементов TinyTroupe, таких как агенты и миры. Он включает механизмы для сокращения извлеченных данных, а также экспорта артефактов. Модуль демонстрирует разницу между агентами-симуляциями и AI-помощниками, поскольку последние не предназначены для интроспекции таким образом.

## Классы

### `ResultsExtractor`

**Описание**: Класс для извлечения результатов из агентов и миров. Кэширует результаты извлечения для повышения производительности.

**Методы**

#### `extract_results_from_agent`

**Описание**: Извлекает результаты из объекта `TinyPerson`.

**Параметры**

- `tinyperson` (TinyPerson): Экземпляр `TinyPerson` для извлечения данных.
- `extraction_objective` (str): Цель извлечения.
- `situation` (str): Ситуация, на которую следует обратить внимание.
- `fields` (list, optional): Список полей для извлечения. Если `None`, извлечение происходит автоматически. По умолчанию `None`.
- `fields_hints` (dict, optional): Словарь подсказок для полей. По умолчанию `None`.
- `verbose` (bool, optional): Флаг для вывода отладочных сообщений. По умолчанию `False`.

**Возвращает**

- `dict | None`: Словарь с результатами извлечения или `None`, если произошла ошибка.

**Вызывает исключения**

- Нет

#### `extract_results_from_world`

**Описание**: Извлекает результаты из объекта `TinyWorld`.

**Параметры**

- `tinyworld` (TinyWorld): Экземпляр `TinyWorld` для извлечения данных.
- `extraction_objective` (str): Цель извлечения.
- `situation` (str): Ситуация, на которую следует обратить внимание.
- `fields` (list, optional): Список полей для извлечения. Если `None`, извлечение происходит автоматически. По умолчанию `None`.
- `fields_hints` (dict, optional): Словарь подсказок для полей. По умолчанию `None`.
- `verbose` (bool, optional): Флаг для вывода отладочных сообщений. По умолчанию `False`.

**Возвращает**

- `dict | None`: Словарь с результатами извлечения или `None`, если произошла ошибка.

**Вызывает исключения**

- Нет

#### `save_as_json`

**Описание**: Сохраняет результаты извлечения в файл в формате JSON.

**Параметры**

- `filename` (str): Имя файла для сохранения.
- `verbose` (bool, optional): Флаг для вывода отладочных сообщений. По умолчанию `False`.

**Возвращает**

- Нет


### `ResultsReducer`

**Описание**: Класс для сокращения результатов извлечения.

**Методы**

#### `add_reduction_rule`

**Описание**: Добавляет правило сокращения.

**Параметры**

- `trigger` (str): Триггер правила.
- `func` (callable): Функция для выполнения правила.

**Возвращает**

- Нет

**Вызывает исключения**

- `Exception`: Если правило для `trigger` уже существует.


#### `reduce_agent`

**Описание**: Применяет правила сокращения к данным агента.

**Параметры**

- `agent` (TinyPerson): Объект `TinyPerson`.

**Возвращает**

- `list`: Список сокращенных данных.

**Вызывает исключения**

- Нет


#### `reduce_agent_to_dataframe`

**Описание**: Преобразует сокращенные данные в DataFrame Pandas.

**Параметры**

- `agent` (TinyPerson): Объект `TinyPerson`.
- `column_names` (list, optional): Имена столбцов DataFrame. По умолчанию `None`.

**Возвращает**

- `pd.DataFrame`: DataFrame с сокращенными данными.

**Вызывает исключения**

- Нет


### `ArtifactExporter`

**Описание**: Класс для экспорта артефактов.

**Методы**

#### `export`

**Описание**: Экспортирует артефакт в файл.

**Параметры**

- `artifact_name` (str): Имя артефакта.
- `artifact_data` (Union[dict, str]): Данные артефакта (словарь или строка).
- `content_type` (str): Тип содержимого артефакта.
- `content_format` (str, optional): Формат содержимого артефакта. По умолчанию `None`.
- `target_format` (str): Целевой формат экспорта (e.g., json, txt, docx).
- `verbose` (bool, optional): Флаг для вывода отладочных сообщений. По умолчанию `False`.

**Возвращает**

- Нет

**Вызывает исключения**

- `ValueError`: Если неподдерживаемый формат или данные неправильного типа.

#### `_export_as_txt`

#### `_export_as_json`

#### `_export_as_docx`

#### `_compose_filepath`

**Описание**: Вспомогательные методы для экспорта в разные форматы.


### `Normalizer`

**Описание**: Класс для нормализации текстовых элементов.

**Методы**

#### `__init__`

**Описание**: Инициализирует нормализатор.

**Параметры**

- `elements` (list): Список элементов для нормализации.
- `n` (int): Количество нормализованных элементов.
- `verbose` (bool, optional): Флаг для вывода отладочных сообщений. По умолчанию `False`.

**Возвращает**

- Нет

#### `normalize`

**Описание**: Нормализует элемент или список элементов.

**Параметры**

- `element_or_elements` (Union[str, List[str]]): Элемент или список элементов для нормализации.

**Возвращает**

- `str | list`: Нормализованный элемент или список элементов.

**Вызывает исключения**

- `ValueError`: Если входной параметр не является строкой или списком.


## Функции

### `default_extractor`

**Описание**: Переменная, содержащая экземпляр класса `ResultsExtractor` по умолчанию.


## Модульные переменные

- `logger`: Объект `logging`.
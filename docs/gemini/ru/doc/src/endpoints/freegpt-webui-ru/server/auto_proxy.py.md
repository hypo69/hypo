# Модуль для автоматического обновления прокси-серверов
## Обзор

Модуль `auto_proxy.py` предназначен для автоматического получения, тестирования и обновления списка рабочих прокси-серверов. Он использует внешние источники для получения списка прокси, проверяет их работоспособность и поддерживает актуальный перечень рабочих прокси-серверов.
## Подорбней

Модуль выполняет следующие задачи:
   1. **Получение списка прокси**: Загружает список прокси-серверов из внешнего источника.
   2. **Тестирование прокси**: Проверяет каждый прокси-сервер на работоспособность с использованием тестового запроса.
   3. **Обновление списка рабочих прокси**: Периодически обновляет глобальный список рабочих прокси-серверов.
   4. **Предоставление случайного прокси**: Предоставляет случайный рабочий прокси-сервер из актуального списка.

## Функции

### `fetch_proxies`

```python
def fetch_proxies():
    """Fetch a list of proxy servers from proxyscrape.com.  
  
    Returns:  
        list: A list of proxy servers in the format "IP:Port".  
    """
    ...
```

**Назначение**: Получение списка прокси-серверов из `proxy-list.download`.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- `list`: Список прокси-серверов в формате `"IP:Port"`.

**Как работает функция**:

1.  **Определение URL**: Определяется URL для получения списка прокси-серверов.
2.  **Выполнение GET-запроса**: Выполняется GET-запрос к указанному URL.
3.  **Обработка ответа**: Если статус код ответа равен 200, ответ разбивается на список прокси-серверов.
4.  **Обработка ошибок**: В случае ошибки при получении прокси, выводится сообщение об ошибке.

```
Определение URL --> Выполнение GET-запроса --> Обработка ответа
                                                        |
                                                        V
                                                        Обработка ошибок
```

**Примеры**:

```python
proxies = fetch_proxies()
if proxies:
    print(f"Получено {len(proxies)} прокси-серверов.")
else:
    print("Не удалось получить прокси-серверы.")
```

### `test_proxy`

```python
def test_proxy(proxy, prompt, timeout):
    """Test the given proxy server with a specified prompt and timeout.  
  
    Args:  
        proxy (str): The proxy server in the format "IP:Port".  
        prompt (str): The test prompt to be used for testing.  
        timeout (int): The maximum time in seconds allowed for the test.  
    """
    ...
```

**Назначение**: Проверка работоспособности прокси-сервера.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате `"IP:Port"`.
- `prompt` (str): Тестовый запрос для проверки прокси-сервера.
- `timeout` (int): Максимальное время ожидания ответа в секундах.

**Как работает функция**:

1.  **Измерение времени ответа**: Измеряется время ответа от прокси-сервера.
2.  **Выполнение запроса через прокси**: Выполняется тестовый запрос через указанный прокси-сервер.
3.  **Проверка времени ответа**: Если время ответа меньше заданного таймаута, прокси считается рабочим и добавляется в список рабочих прокси.
4.  **Обработка исключений**: В случае возникновения исключений, функция пропускает прокси-сервер.

```
Измерение времени ответа --> Выполнение запроса через прокси --> Проверка времени ответа
                                                                    |
                                                                    V
                                                                    Обработка исключений
```

**Примеры**:

```python
test_proxy("1.2.3.4:8080", "Test prompt", 5)
```

### `add_working_proxy`

```python
def add_working_proxy(proxy):
    """Add a working proxy server to the global working_proxies list.  
  
    Args:  
        proxy (str): The proxy server in the format "IP:Port".
    """
    ...
```

**Назначение**: Добавление рабочего прокси-сервера в глобальный список `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате `"IP:Port"`.

**Как работает функция**:

1.  **Добавление в список**: Добавляет прокси-сервер в глобальный список `working_proxies`.

```
Добавление в список
```

**Примеры**:

```python
add_working_proxy("1.2.3.4:8080")
```

### `remove_proxy`

```python
def remove_proxy(proxy):
    """Remove a proxy server from the global working_proxies list.  
  
    Args:  
        proxy (str): The proxy server in the format "IP:Port".  
    """
    ...
```

**Назначение**: Удаление прокси-сервера из глобального списка `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате `"IP:Port"`.

**Как работает функция**:

1.  **Проверка наличия**: Проверяется наличие прокси-сервера в списке `working_proxies`.
2.  **Удаление из списка**: Если прокси-сервер присутствует в списке, он удаляется.

```
Проверка наличия --> Удаление из списка
```

**Примеры**:

```python
remove_proxy("1.2.3.4:8080")
```

### `get_working_proxies`

```python
def get_working_proxies(prompt, timeout=5):
    """Fetch and test proxy servers, adding working proxies to the global working_proxies list.  
  
    Args:  
        prompt (str): The test prompt to be used for testing.  
        timeout (int, optional): The maximum time in seconds allowed for testing. Defaults to 5.  
    """
    ...
```

**Назначение**: Получение и тестирование прокси-серверов с добавлением рабочих прокси в глобальный список `working_proxies`.

**Параметры**:
- `prompt` (str): Тестовый запрос для проверки прокси-серверов.
- `timeout` (int, optional): Максимальное время ожидания ответа в секундах. По умолчанию равно 5.

**Как работает функция**:

1.  **Получение списка прокси**: Получается список прокси-серверов с помощью функции `fetch_proxies`.
2.  **Создание потоков**: Для каждого прокси-сервера создается отдельный поток для тестирования.
3.  **Запуск потоков**: Запускаются все потоки для параллельного тестирования прокси-серверов.
4.  **Ожидание завершения потоков**: Ожидается завершение всех потоков с заданным таймаутом.

```
Получение списка прокси --> Создание потоков --> Запуск потоков --> Ожидание завершения потоков
```

**Примеры**:

```python
get_working_proxies("Test prompt", 5)
```

### `update_working_proxies`

```python
def update_working_proxies():
    """Continuously update the global working_proxies list with working proxy servers."""
    ...
```

**Назначение**: Непрерывное обновление глобального списка `working_proxies` рабочими прокси-серверами.

**Как работает функция**:

1.  **Бесконечный цикл**: Запускается бесконечный цикл для периодического обновления списка прокси.
2.  **Очистка списка**: Список `working_proxies` очищается перед каждым обновлением.
3.  **Получение рабочих прокси**: Получаются рабочие прокси-серверы с помощью функции `get_working_proxies`.
4.  **Пауза**: После обновления списка прокси, поток засыпает на 30 минут (1800 секунд).

```
Бесконечный цикл --> Очистка списка --> Получение рабочих прокси --> Пауза
```

**Примеры**:

```python
update_working_proxies()
```

### `get_random_proxy`

```python
def get_random_proxy():
    """Get a random working proxy server from the global working_proxies list.  
  
    Returns:  
        str: A random working proxy server in the format "IP:Port".  
    """
    ...
```

**Назначение**: Получение случайного рабочего прокси-сервера из глобального списка `working_proxies`.

**Возвращает**:
- `str`: Случайный рабочий прокси-сервер в формате `"IP:Port"`.

**Как работает функция**:

1.  **Выбор случайного прокси**: Выбирается случайный прокси-сервер из списка `working_proxies`.

```
Выбор случайного прокси
```

**Примеры**:

```python
proxy = get_random_proxy()
if proxy:
    print(f"Случайный прокси-сервер: {proxy}")
else:
    print("Нет доступных прокси-серверов.")
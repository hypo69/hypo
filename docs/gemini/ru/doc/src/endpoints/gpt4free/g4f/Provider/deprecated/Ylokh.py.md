# Модуль Ylokh

## Обзор

Модуль `Ylokh` предоставляет класс `Ylokh`, который является асинхронным генератором для взаимодействия с API `chat.ylokh.xyz`. Он поддерживает потоковую передачу данных и предназначен для работы с моделью `gpt-3.5-turbo`. Модуль позволяет отправлять сообщения и получать ответы от API в асинхронном режиме.

## Подробней

Модуль предназначен для интеграции с API `chat.ylokh.xyz` и обеспечивает удобный интерфейс для обмена сообщениями с использованием асинхронных генераторов. Класс `Ylokh` наследуется от `AsyncGeneratorProvider` и реализует метод `create_async_generator`, который отвечает за отправку запросов и получение ответов от API.
Расположение файла в проекте `hypotez` указывает на то, что он является одним из провайдеров для GPT-4 Free, что предполагает его использование для получения бесплатных ответов от языковой модели.

## Классы

### `Ylokh`

**Описание**: Класс `Ylokh` является асинхронным генератором для взаимодействия с API `chat.ylokh.xyz`.

**Наследует**:
- `AsyncGeneratorProvider`: Класс наследует функциональность асинхронного генератора от `AsyncGeneratorProvider`.

**Аттрибуты**:
- `url` (str): URL API `chat.ylokh.xyz`.
- `working` (bool): Флаг, указывающий на работоспособность провайдера (по умолчанию `False`).
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений (по умолчанию `True`).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели `gpt-3.5-turbo` (по умолчанию `True`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для отправки сообщений и получения ответов от API.

## Функции

### `create_async_generator`

```python
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        stream: bool = True,
        proxy: str = None,
        timeout: int = 120,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для отправки сообщений и получения ответов от API.

        Args:
            model (str): Название модели для использования.
            messages (Messages): Список сообщений для отправки.
            stream (bool): Флаг, указывающий на использование потоковой передачи данных (по умолчанию `True`).
            proxy (str): Адрес прокси-сервера (по умолчанию `None`).
            timeout (int): Время ожидания ответа от API в секундах (по умолчанию `120`).
            **kwargs: Дополнительные аргументы для передачи в API.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий ответы от API.

        Raises:
            Exception: Если возникает ошибка при отправке запроса или обработке ответа от API.
        """
```

**Назначение**: Создание асинхронного генератора для взаимодействия с API `chat.ylokh.xyz`.

**Параметры**:
- `cls`: Ссылка на класс `Ylokh`.
- `model` (str): Название модели для использования.
- `messages` (Messages): Список сообщений для отправки.
- `stream` (bool): Флаг, указывающий на использование потоковой передачи данных (по умолчанию `True`).
- `proxy` (str): Адрес прокси-сервера (по умолчанию `None`).
- `timeout` (int): Время ожидания ответа от API в секундах (по умолчанию `120`).
- `**kwargs`: Дополнительные аргументы для передачи в API.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий ответы от API.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при отправке запроса или обработке ответа от API.

**Как работает функция**:

1. **Инициализация параметров**:
   - Устанавливает модель, если она не указана, в значение `"gpt-3.5-turbo"`.
   - Формирует заголовки запроса, включая `Origin` и `Referer`.
   - Формирует данные запроса, включая сообщения, модель, параметры температуры, штрафы и другие настройки.

2. **Отправка запроса**:
   - Использует асинхронную сессию `StreamSession` для отправки `POST`-запроса к API `https://chatapi.ylokh.xyz/v1/chat/completions`.
   - Устанавливает заголовки, прокси и время ожидания.
   - Обрабатывает ответ в зависимости от того, используется ли потоковая передача данных.

3. **Обработка потокового ответа**:
   - Если `stream` установлен в `True`, функция итерируется по строкам ответа.
   - Декодирует каждую строку и проверяет, начинается ли она с `"data: "`.
   - Если строка начинается с `"data: [DONE]"`, прерывает цикл.
   - Загружает JSON из строки данных и извлекает содержимое сообщения из поля `"choices"`.
   - Генерирует содержимое сообщения.

4. **Обработка не потокового ответа**:
   - Если `stream` установлен в `False`, функция ожидает получения полного JSON-ответа.
   - Извлекает содержимое сообщения из поля `"choices"` и генерирует его.

5. **Обработка ошибок**:
   - В случае возникновения HTTP-ошибки, `response.raise_for_status()` вызовет исключение, которое не обрабатывается в данном коде, но должно быть обработано вызывающей стороной.

```
A: Инициализация параметров
|
B: Отправка POST-запроса к API
|
C: Проверка stream
|
D: Обработка потокового ответа
|   E: Обработка не потокового ответа
|
F: Генерация содержимого сообщения
```

**Примеры**:

Пример 1: Использование с потоковой передачей данных

```python
import asyncio
from typing import AsyncGenerator, Optional, List

from g4f.Provider.deprecated.Ylokh import Ylokh
from g4f.typing import Messages

async def main():
    messages: Messages = [{"role": "user", "content": "Hello, how are you?"}]
    async for message in Ylokh.create_async_generator(model="gpt-3.5-turbo", messages=messages, stream=True):
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
```

Пример 2: Использование без потоковой передачи данных

```python
import asyncio
from typing import AsyncGenerator, Optional, List

from g4f.Provider.deprecated.Ylokh import Ylokh
from g4f.typing import Messages

async def main():
    messages: Messages = [{"role": "user", "content": "Hello, how are you?"}]
    result = await Ylokh.create_async_generator(model="gpt-3.5-turbo", messages=messages, stream=False)
    async for message in result:
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
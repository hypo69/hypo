# Модуль `hypotez/src/scenario`

## Обзор

Модуль `hypotez/src/scenario` предназначен для автоматизации взаимодействия с поставщиками с использованием сценариев, описанных в JSON-файлах. Основная задача — адаптация процесса извлечения и обработки данных о продуктах с веб-сайтов поставщиков и синхронизация этой информации с базой данных системы.


## Функции модуля

1. **Чтение сценариев**: Модуль загружает сценарии из JSON-файлов, содержащих информацию о различных категориях продуктов и URL-адресах страниц этих категорий на веб-сайте поставщика.

2. **Взаимодействие с веб-сайтами**: Используя URL-адреса, указанные в сценариях, модуль переходит на страницы продуктов и извлекает необходимые данные.

3. **Обработка данных**: Модуль обрабатывает извлеченные данные о продуктах, преобразует их в требуемый формат и сохраняет в базе данных системы (например, PrestaShop).

4. **Ведение журнала выполнения**: Модуль ведет журнал выполнения сценариев, записывая детали выполнения и результаты, что помогает отслеживать успешность и определять ошибки.


## Основные компоненты модуля

### `run_scenario_files(s, scenario_files_list)`

**Описание**: Функция для последовательной обработки списка файлов сценариев. Вызывает `run_scenario_file` для каждого файла.

**Параметры**:
- `s` (объект `Supplier`): Экземпляр класса `Supplier` для взаимодействия с конкретным поставщиком.
- `scenario_files_list` (Список `Path` или `str`): Список путей к файлам сценариев.

**Возвращает**: `bool`: `True` если все сценарии успешно выполнены, `False` в противном случае.


### `run_scenario_file(s, scenario_file)`

**Описание**: Функция для загрузки сценариев из файла и вызова `run_scenario` для каждого сценария.

**Параметры**:
- `s` (объект `Supplier`): Экземпляр класса `Supplier`.
- `scenario_file` (Путь к файлу `str` или `Path`): Путь к файлу со сценариями.

**Возвращает**: `bool`: `True` если все сценарии в файле успешно выполнены, `False` в противном случае.


### `run_scenario(s, scenario)`

**Описание**: Функция для обработки отдельного сценария. Переходит по URL, извлекает данные о продукте, сохраняет их в базе данных.

**Параметры**:
- `s` (объект `Supplier`): Экземпляр класса `Supplier`.
- `scenario` (Словарь): Словарь, представляющий сценарий.


**Возвращает**: `bool` или `dict`: Возвращает результат выполнения сценария или `False` в случае ошибки.


### `dump_journal(s, journal)`

**Описание**: Сохраняет журнал выполнения сценариев в файл для последующего анализа.

**Параметры**:
- `s` (объект `Supplier`): Экземпляр класса `Supplier`.
- `journal` (Словарь): Словарь с данными журнала.


### `main()`

**Описание**: Главная функция для запуска модуля.


## Пример сценария

Пример JSON-сценария описывает взаимодействие со специфическими категориями продуктов на сайте. Он включает:

- **URL страницы**: Для навигации и извлечения данных.
- **Название категории**: Для идентификации категории.
- **`presta_categories`**: Идентификаторы категорий в базе данных PrestaShop, где будут сохранены продукты.


```json
{
    "scenarios": {
        "минерал+לחויותלפניםמינרליםותמציותצמחים": {
            "url": "https://hbdeadsea.co.il/product-category/facial/moisture-face/",
            "name": "минерал+לחויותלפניםמינרליםותמציותצמחים",
            "presta_categories": {
                "default_category": 11245,
                "additional_categories": [11288]
            }
        }
    }
}
```


## Структура сценариев (Подробно)

См. раздел **Пример сценария** для подробного объяснения полей сценария.


## Способ работы

1. **Загрузка сценариев**: Модуль загружает и анализирует сценарии из файлов.

2. **Извлечение данных**: Переходит по URL из сценария, извлекает ссылки на продукты и собирает информацию о них.

3. **Сохранение данных**: Обрабатывает и сохраняет собранные данные в базе данных, используя информацию о категориях из сценария.

4. **Отчеты и ведение журнала**: Ведет журнал выполнения сценариев для отслеживания прогресса и записи ошибок.


## Поток выполнения скрипта (Workflow)

Подробно описан в разделе **Workflow for Script Executor Module**.


## Функции `executor.py` (Подробно)

Подробные описания функций `executor.py` с параметрами, возвращаемыми значениями и блоками обработки исключений приведены в соответствующих разделах документации.


## Зависимости


Раздел **Dependency Tree for `executor.py`** и **Breakdown of Methods** дают представление о взаимосвязи функций.

```
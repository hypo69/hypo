# Анализ кода модуля `poker.py`

**Качество кода**

- **Соответствие требованиям к формату кода (1-10):**
  - 1. **Формат документирования**:
    - Код не использует reStructuredText (RST) для комментариев и docstring.
    - Используются двойные кавычки `"` вместо одинарных `'`.
  - 2. **Сохранение комментариев**:
    - Комментарии после `#` сохранены без изменений.
    - Отсутствуют построчные комментарии к измененным участкам кода.
  - 3. **Обработка данных**:
    - Используется стандартный `input` вместо `j_loads` или `j_loads_ns`.
  - 4. **Анализ структуры**:
    - Отсутствуют необходимые импорты.
    - Имена функций и переменных не унифицированы с ранее обработанными файлами.
  - 5. **Рефакторинг и улучшение**:
    - Отсутствуют docstring в формате RST для функций.
    - Не используется `from src.logger.logger import logger` для регистрации ошибок.
    - Используются стандартные блоки `try-except`, вместо обработки ошибок через `logger.error`.
  - 6. **Код финальный**:
      - Код не отформатирован как единый блок с комментариями о внесенных изменениях.
  - 7. **Примеры кода**:
    - Отсутствуют примеры документации в формате RST и улучшений в формате `TODO`.
  - 8. **Дополнительные инструкции**:
    - Комментарии для модулей, функций, методов и переменных не переписаны в формате reStructuredText (RST).
  
- **Преимущества:**
    - Код логически правильно реализует игру в покер.
    - Разбиение на функции делает код читаемым.
    - Понятные комментарии поясняют работу кода.
- **Недостатки:**
    - Код не соответствует требованиям к документации.
    - Отсутствует обработка ошибок с использованием логгера.
    - Используется стандартный ввод вместо `j_loads`.
    - Не используются docstring.
    - Код не соответствует стандартам, принятым в проекте.
    - Отсутствует обработка некорректного ввода пользователя.

**Рекомендации по улучшению**

1.  **Документирование:**
    - Переписать все комментарии и docstring в формате reStructuredText (RST).
    - Добавить docstring к каждой функции, методу и классу.
2.  **Обработка ошибок:**
    - Использовать `from src.logger.logger import logger` для логирования ошибок.
    - Заменить стандартные блоки `try-except` на использование `logger.error`.
3.  **Ввод/вывод:**
    - Использовать `j_loads` или `j_loads_ns` для ввода данных.
    - Обеспечить ввод данных, соответствующих требованиям к формату.
4.  **Структура:**
    - Добавить недостающие импорты.
    - Привести имена функций и переменных в соответствие со стандартами проекта.
5.  **Улучшение кода:**
    - Добавить обработку исключений при вводе данных пользователем.
    - Избавиться от избыточных проверок и улучшить читаемость кода.
6.  **Форматирование:**
    - Привести код в соответствие со стандартами проекта.
    - Оформить код как единый блок с комментариями о внесенных изменениях.

**Улучшенный код**
```python
"""
Модуль для реализации упрощенной версии игры в покер.
=========================================================================================

Модуль содержит функции для создания, отображения и анализа покерной руки, а также для
запуска игры в покер.

Пример использования
--------------------

Пример запуска игры:

.. code-block:: python

   play_poker()

"""
import random
from src.logger.logger import logger #  Импорт логгера

def create_hand() -> list[int]:
    """
    Создает руку из 5 случайных карт (числа от 1 до 13).

    :return: Список из 5 целых чисел, представляющих карты.
    :rtype: list[int]
    """
    # Генерирует список из 5 случайных чисел от 1 до 13
    hand = [random.randint(1, 13) for _ in range(5)]
    return hand

def display_hand(hand: list[int]) -> None:
    """
    Выводит карты на экран, нумеруя их для удобства игрока.

    :param hand: Список карт.
    :type hand: list[int]
    """
    # Выводит карты на экран с нумерацией
    print('Ваши карты:')
    for i, card in enumerate(hand):
        print(f'{i+1}: {card}', end='  ')
    print()

def get_cards_to_replace() -> list[int]:
    """
    Запрашивает у игрока номера карт, которые нужно заменить.
    Возвращает список индексов карт для замены.

    :return: Список индексов карт для замены (начиная с 0).
    :rtype: list[int]
    """
    while True:
        try:
            # Запрашивает ввод пользователя
            replace_str = input('Введите номера карт для замены через пробел (или 0, чтобы оставить все): ')
            replace_cards = list(map(int, replace_str.split()))

            # Проверяет, ввел ли пользователь 0
            if len(replace_cards) == 1 and replace_cards[0] == 0:
                return []

            # Проверяет, что все введенные номера карт находятся в допустимом диапазоне
            if all(1 <= card <= 5 for card in replace_cards) and len(replace_cards) <= 5:
                # Преобразует номера карт в индексы и возвращает список
                return [card - 1 for card in replace_cards]
            else:
                print('Неверный ввод. Введите номера карт от 1 до 5 или 0.')
        except ValueError:
            logger.error('Неверный ввод. Пожалуйста, введите номера через пробел.')
            print('Неверный ввод. Пожалуйста, введите номера через пробел.')
            
def replace_cards(hand: list[int], replace_indices: list[int]) -> list[int]:
    """
    Заменяет выбранные карты на новые случайные карты.

    :param hand: Список карт.
    :type hand: list[int]
    :param replace_indices: Список индексов карт для замены.
    :type replace_indices: list[int]
    :return: Обновленный список карт.
    :rtype: list[int]
    """
    # Заменяет карты по индексам
    for index in replace_indices:
        hand[index] = random.randint(1, 13)
    return hand

def analyze_hand(hand: list[int]) -> None:
    """
    Анализирует руку и определяет выигрышную комбинацию.
    Выводит сообщение о комбинации и выигрыше.

    :param hand: Список карт.
    :type hand: list[int]
    """
    counts = {}  # Словарь для подсчета повторений карт
    for card in hand:
        counts[card] = counts.get(card, 0) + 1 # Подсчет количества каждой карты в руке

    values = list(counts.values())  # Список количества повторений

    # Проверка на Флеш
    sorted_hand = sorted(hand) # Сортирует руку
    if len(set(sorted_hand)) == 5 and all(sorted_hand[i+1] - sorted_hand[i] == 1 for i in range(4)): # Проверка, что все карты в руке уникальные и идут по порядку
        print('Флеш! Выигрыш 20 очков')
        return

    # Проверка на Каре
    if 4 in values: # Проверяет, есть ли 4 одинаковых карты
        print('Каре! Выигрыш 25 очков')
        return

    # Проверка на Фулл Хаус
    if 3 in values and 2 in values: # Проверяет, есть ли три одинаковых карты и пара
        print('Фулл Хаус! Выигрыш 15 очков')
        return

    # Проверка на Тройку
    if 3 in values: # Проверяет, есть ли три одинаковых карты
        print('Тройка! Выигрыш 10 очков')
        return

    # Проверка на Две пары
    if values.count(2) == 2: # Проверяет, есть ли две пары
        print('Две пары! Выигрыш 5 очков')
        return

    # Проверка на Пару
    if 2 in values: # Проверяет, есть ли пара
        print('Пара! Выигрыш 2 очка')
        return

    print('Нет выигрыша.')

# Основная логика игры
def play_poker() -> None:
    """
    Запускает игру в покер.
    """
    # Создаем руку из 5 карт
    hand = create_hand()
    # Выводим карты на экран
    display_hand(hand)

    # Запрашиваем карты для замены
    replace_indices = get_cards_to_replace()
    # Проверяем, есть ли карты на замену
    if replace_indices:
        # Заменяем карты
        hand = replace_cards(hand, replace_indices)
        # Выводим обновленные карты
        display_hand(hand)

    # Анализируем руку на наличие комбинации и выводим результат
    analyze_hand(hand)

if __name__ == '__main__':
    play_poker()
    
"""
Объяснение кода:
1. **Импорт модуля `random` и логгера**::
   - `import random`: Импортирует модуль random, который используется для генерации случайных чисел.
   - `from src.logger.logger import logger`: Импортирует логгер для записи ошибок.
2. **Функция `create_hand()`**::
    - `def create_hand():`: Определяет функцию, которая создает руку из 5 карт.
    - `hand = [random.randint(1, 13) for _ in range(5)]`: Генерирует список из 5 случайных целых чисел в диапазоне от 1 до 13 (представляющих карты) и сохраняет в переменной `hand`.
    - `return hand`: Возвращает созданную руку.
3. **Функция `display_hand(hand)`**::
   - `def display_hand(hand):`: Определяет функцию для вывода карт на экран.
   - `print("Ваши карты:")`: Выводит заголовок "Ваши карты:".
   - `for i, card in enumerate(hand):`:  Цикл перебирает карты, нумеруя их.
   - `print(f"{i+1}: {card}", end="  ")`: Выводит номер карты и ее значение с пробелами для удобства.
   - `print()`: Выводит пустую строку для переноса строки.
4.  **Функция `get_cards_to_replace()`**::
    -   `def get_cards_to_replace():`:  Определяет функцию для получения ввода пользователя о картах для замены.
    -   `while True:`: Бесконечный цикл, пока не будет получен корректный ввод.
    -   `try...except ValueError`: Блок try-except обрабатывает возможные ошибки ввода. Если пользователь введет не числа, то будет выведено сообщение об ошибке в логгер.
    -   `replace_str = input("Введите номера карт для замены через пробел (или 0, чтобы оставить все): ")`: Запрашивает у пользователя строку с номерами карт для замены.
    -   `replace_cards = list(map(int, replace_str.split()))`: Преобразует введенную строку в список целых чисел.
    -   `if len(replace_cards) == 1 and replace_cards[0] == 0:`: Проверяет, если пользователь ввел 0, то возвращает пустой список (оставить все карты).
    -   `if all(1 <= card <= 5 for card in replace_cards) and len(replace_cards) <=5:`: Проверяет, что все введенные номера карт в диапазоне от 1 до 5.
    -   `return [card - 1 for card in replace_cards]`: Возвращает список индексов карт для замены (индексы начинаются с 0).
    -   `else:`: Если ввод неверен, то выводится сообщение об ошибке.
5. **Функция `replace_cards(hand, replace_indices)`**::
   -  `def replace_cards(hand, replace_indices):`: Определяет функцию для замены выбранных карт.
   -  `for index in replace_indices:`: Цикл перебирает индексы карт для замены.
   -   `hand[index] = random.randint(1, 13)`: Заменяет карту в руке на случайное число.
   -  `return hand`: Возвращает обновленную руку.
6. **Функция `analyze_hand(hand)`**::
    -  `def analyze_hand(hand):`: Определяет функцию для анализа комбинаций карт.
    -  `counts = {}`: Словарь для подсчета повторений карт.
    -  `for card in hand: counts[card] = counts.get(card, 0) + 1`: Подсчет количества каждой карты в руке
    - `values = list(counts.values())`: Список с количеством повторений карт
    -   **Проверка на Флеш**::
        -   `sorted_hand = sorted(hand)`: Сортирует руку.
        -   `if len(set(sorted_hand)) == 5 and all(sorted_hand[i+1] - sorted_hand[i] == 1 for i in range(4))`: Проверка, что все карты в руке уникальные и идут по порядку.
        -   `print("Флеш! Выигрыш 20 очков")`: Вывод сообщения о флеше.
        -   `return`: Завершает выполнение функции.
    -   **Проверка на Каре**::
        -   `if 4 in values:`: Проверяет, есть ли 4 одинаковых карты.
        -   `print("Каре! Выигрыш 25 очков")`: Вывод сообщения о каре.
        -   `return`: Завершает выполнение функции.
    -   **Проверка на Фулл Хаус**::
        -   `if 3 in values and 2 in values:`: Проверяет, есть ли три одинаковых карты и пара.
        -   `print("Фулл Хаус! Выигрыш 15 очков")`: Вывод сообщения о фулл хаусе.
        -   `return`: Завершает выполнение функции.
    -   **Проверка на Тройку**::
        -   `if 3 in values:`: Проверяет, есть ли три одинаковых карты.
        -   `print("Тройка! Выигрыш 10 очков")`: Вывод сообщения о тройке.
        -   `return`: Завершает выполнение функции.
    -   **Проверка на Две пары**::
        -   `if values.count(2) == 2:`: Проверяет, есть ли две пары.
        -   `print("Две пары! Выигрыш 5 очков")`: Вывод сообщения о двух парах.
        -   `return`: Завершает выполнение функции.
    -   **Проверка на Пару**::
        -   `if 2 in values:`: Проверяет, есть ли пара.
        -   `print("Пара! Выигрыш 2 очка")`: Вывод сообщения о паре.
        -   `return`: Завершает выполнение функции.
    -   `print("Нет выигрыша.")`: Вывод сообщения об отсутствии выигрыша.
7.  **Функция `play_poker()`**::
    - `def play_poker():`: Определяет функцию для запуска игры.
    -   `hand = create_hand()`: Создает руку.
    -   `display_hand(hand)`: Выводит карты на экран.
    -   `replace_indices = get_cards_to_replace()`: Получает номера карт для замены.
    -   `if replace_indices:`: Проверяет, что список с картами для замены не пустой
    -   `hand = replace_cards(hand, replace_indices)`: Заменяет карты.
    -   `display_hand(hand)`: Выводит обновленные карты.
    -   `analyze_hand(hand)`: Анализирует руку и выводит результат.
8. **Запуск игры**::
   -   `if __name__ == "__main__":`: Этот блок гарантирует, что функция `play_poker()` будет запущена, только если файл исполняется напрямую, а не импортируется как модуль.
   -   `play_poker()`: Вызывает функцию для начала игры.
"""
```
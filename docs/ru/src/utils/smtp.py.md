# Модуль для работы с SMTP
=================================================

Модуль `src.utils.smtp` предоставляет интерфейс для отправки и получения электронных писем, используя протоколы SMTP и IMAP. Он включает функции для отправки электронных писем через SMTP и получения электронных писем через IMAP.

## Обзор

Модуль предоставляет функциональность для отправки и получения электронных писем, используя SMTP и IMAP протоколы. Он включает в себя функции отправки писем через SMTP-сервер и получения писем с IMAP-сервера.

## Подробнее

Этот модуль предназначен для упрощения работы с электронной почтой в проекте `hypotez`. Он предоставляет функции для отправки уведомлений и получения данных из входящих писем. Конфигурация подключения к почтовым серверам (таким как имя сервера, порт, имя пользователя и пароль) загружается из переменных окружения, что обеспечивает безопасность и гибкость настройки.

## Функции

### `send`

```python
def send(subject: str = '', body: str = '', to: str = 'one.last.bit@gmail.com') -> bool:
    """Отправляет электронное письмо.

    Args:
        subject (str): Тема письма. По умолчанию ''.
        body (str): Тело письма. По умолчанию ''.
        to (str): Адрес получателя. По умолчанию 'one.last.bit@gmail.com'.

    Returns:
        bool: `True`, если отправка прошла успешно, `False` в противном случае.

    Raises:
        Exception: Логируется информация об ошибке при отправке письма.

    Example:
        >>> send(subject='Тест', body='Это тестовое письмо', to='test@example.com')
        True
    """
```

**Как работает функция**:

1.  Функция `send` принимает тему письма (`subject`), тело письма (`body`) и адрес получателя (`to`).
2.  Создается SMTP-соединение с использованием параметров из словаря `_connection`.
3.  Настраивается TLS-шифрование для безопасной передачи данных.
4.  Выполняется вход в SMTP-сервер с использованием имени пользователя и пароля из `_connection`.
5.  Формируется сообщение с использованием `MIMEText`, где указываются тема, отправитель и получатель.
6.  Отправляется письмо и завершается SMTP-соединение.
7.  В случае успеха возвращается `True`, иначе – `False`, при этом информация об ошибке логируется.

**Flowchart**:

```
Начало
    ↓
Создание SMTP-соединения
    ↓
Настройка TLS-шифрования
    ↓
Вход в SMTP-сервер
    ↓
Формирование сообщения MIMEText
    ↓
Отправка письма
    ↓
Завершение SMTP-соединения
    ↓
Конец (True)
```

### `receive`

```python
def receive(imap_server: str, user: str, password: str, folder: str = 'inbox') -> Optional[List[Dict[str, str]]]:
    """Получает электронные письма из IMAP-сервера.

    Args:
        imap_server (str): Адрес IMAP-сервера.
        user (str): Имя пользователя для входа в IMAP-сервер.
        password (str): Пароль для входа в IMAP-сервер.
        folder (str): Папка для поиска писем. По умолчанию 'inbox'.

    Returns:
        Optional[List[Dict[str, str]]]: Список словарей с данными каждого письма (тема, отправитель, тело) в случае успеха, `None` в случае ошибки.

    Raises:
        Exception: Логируется информация об ошибке при получении писем.

    Example:
        >>> receive(imap_server='imap.example.com', user='test', password='password', folder='INBOX')
        [{'subject': 'Тест', 'from': 'sender@example.com', 'body': 'Это тестовое письмо'}]
    """
```

**Как работает функция**:

1.  Функция `receive` принимает параметры для подключения к IMAP-серверу, такие как адрес сервера, имя пользователя, пароль и папка для поиска писем.
2.  Устанавливается защищенное SSL-соединение с IMAP-сервером.
3.  Выполняется вход в IMAP-сервер.
4.  Выбирается указанная папка (по умолчанию 'inbox').
5.  Выполняется поиск всех писем в выбранной папке.
6.  Для каждого найденного письма извлекаются данные, такие как тема, отправитель и тело письма.
7.  Данные каждого письма сохраняются в словаре, а все словари добавляются в список.
8.  Соединение с IMAP-сервером закрывается, и пользователь выходит из системы.
9.  В случае успеха возвращается список словарей с данными писем, иначе – `None`, при этом информация об ошибке логируется.

**Flowchart**:

```
Начало
    ↓
Установка SSL-соединения с IMAP-сервером
    ↓
Вход в IMAP-сервер
    ↓
Выбор папки
    ↓
Поиск всех писем
    ↓
Для каждого письма:
    → Извлечение данных (тема, отправитель, тело)
    → Сохранение данных в словаре
    ↓
Закрытие соединения с IMAP-сервером и выход
    ↓
Конец (Список словарей с данными писем)
```
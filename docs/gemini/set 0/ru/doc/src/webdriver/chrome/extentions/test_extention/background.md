# Файл `background.js`

## Обзор

Этот файл содержит скрипт расширения Chrome, который слушает события кликов по иконке расширения и отправляет запросы на сбор данных на сервер. Он использует API Chrome для взаимодействия с вкладками и хранилищем настроек.

## Функции

### `sendDataToServer`

**Описание**: Отправляет собранные данные на сервер.

**Параметры**:
- `url` (str): URL страницы, для которой нужно собрать данные.

**Возвращает**:
- `None`: Функция не возвращает значение.

**Вызывает исключения**:
- `Error`: Возникает, если произошла ошибка при отправке данных на сервер.


### Функция слушатель событий

**Описание**: Слушает сообщения, отправленные из других частей расширения.

**Параметры**:
- `message` (dict): Сообщение, полученное от другого скрипта расширения.
- `sender` (object): Информация о отправителе сообщения (например, идентификатор вкладки).
- `sendResponse` (function): Функция для отправки ответа отправителю сообщения.

**Возвращает**:
- `boolean`: Возвращает `true`, чтобы позволить асинхронное выполнение функций.

**Вызывает исключения**:
- Нет


## Хранилище данных

**Описание**: Использование хранилища `chrome.storage.local` для хранения собранных данных. Данные хранятся в формате JSON.


## API Chrome

**Описание**:  Использует следующие API Chrome:

* `chrome.browserAction.onClicked`: Обрабатывает клики по иконке расширения.
* `chrome.tabs.sendMessage`: Отправляет сообщения другим скриптам расширения (в основном, контент-скриптам).
* `chrome.runtime.onMessage.addListener`: Слушает сообщения, отправленные другим скриптам расширения.
* `chrome.storage.local`:  Хранилище для данных расширения.
* `fetch`: API для отправки HTTP запросов.


## Пример использования

1. Пользователь кликает по иконке расширения на странице.
2. Функция слушатель событий получает сообщение `collectData` с URL страницы.
3. Функция `sendDataToServer` получает URL.
4. `sendDataToServer` получает из хранилища `collectedData` и отправляет данные на сервер `http://127.0.0.1/hypotez.online/api/` методом POST.
5. Если отправка успешна, выводится сообщение в консоль.
6. Если отправка не успешна, выводится сообщение об ошибке в консоль.

## Улучшения

* **Обработка ошибок при чтении данных из хранилища:**  Добавить обработку случая, когда в хранилище нет данных `collectedData`.
* **Более подробная информация об ошибке:** Выводить более подробную информацию об ошибке, например, статус код ответа сервера.
* **Аутентификация:** Добавить аутентификацию для взаимодействия с сервером, если это необходимо.
* **Обработка случаев, когда сервер недоступен:** Добавить обработку случаев, когда сервер недоступен, например, таймауты.
* **Проверка валидности данных**: Проверить валидность данных, полученных из хранилища, перед отправкой на сервер.


##  Ограничения

* Требуется запуск локального сервера на `127.0.0.1/hypotez.online/api/`.
* Этот скрипт предполагает, что данные для отправки уже собраны и доступны в `collectedData`.
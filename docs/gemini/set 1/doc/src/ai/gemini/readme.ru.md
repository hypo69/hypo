# Модуль интеграции Google Generative AI

## Обзор

Этот модуль предоставляет класс `GoogleGenerativeAI` для взаимодействия с моделями Google Generative AI. Он обеспечивает отправку запросов, обработку ответов, управление диалогами, интеграцию с различными функциями ИИ, а также надежную обработку ошибок, ведение журнала и настройки конфигурации.

## Оглавление

* [Модуль интеграции Google Generative AI](#модуль-интеграции-google-generative-ai)
* [Обзор](#обзор)
* [Основные функции](#основные-функции)
    * [`__init__`](#__init__)
    * [`config`](#config)
    * [`_start_chat`](#_start_chat)
    * [`_save_dialogue`](#_save_dialogue)
    * [`ask`](#ask)
    * [`chat`](#chat)
    * [`describe_image`](#describe_image)
    * [`upload_file`](#upload_file)
* [Обработка ошибок](#обработка-ошибок)
* [Ведение журнала и история](#ведение-журнала-и-история)
* [Зависимости](#зависимости)
* [Пример использования](#пример-использования)


## Основные функции

### `__init__`

**Назначение**: Инициализирует класс `GoogleGenerativeAI` с необходимыми конфигурациями.

**Параметры**:
- `self`: Экземпляр класса.
- `api_key` (str): Ключ API.
- `model_name` (Optional[str], optional): Имя модели. По умолчанию `None`.
- `generation_config` (Optional[Dict], optional): Конфигурация генерации. По умолчанию `None`.
- `system_instruction` (Optional[str], optional): Системная инструкция. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Детали**:
- Устанавливает ключ API, имя модели, конфигурацию генерации и системную инструкцию.
- Определяет пути для ведения журнала диалогов и хранения истории.
- Инициализирует модель Google Generative AI.

### `config`

**Назначение**: Получает конфигурацию из файла настроек.

**Детали**:
- Читает и разбирает файл конфигурации, расположенный по пути `gs.path.src / 'ai' / 'gemini' / 'generative_ai.json'`.

### `_start_chat`

**Назначение**: Запускает сессию чата с моделью ИИ.

**Детали**:
- Инициализирует сессию чата с пустой историей.

### `_save_dialogue`

**Назначение**: Сохраняет диалог в текстовые и JSON файлы.

**Детали**:
- Добавляет каждое сообщение в диалоге в текстовый файл.
- Добавляет каждое сообщение в формате JSON в JSON файл.

### `ask`

**Назначение**: Отправляет текстовый запрос модели ИИ и получает ответ.

**Параметры**:
- `self`: Экземпляр класса.
- `q` (str): Текстовый запрос.
- `attempts` (int, optional): Количество попыток. По умолчанию 15.

**Возвращает**:
- `Optional[str]`: Возвращает ответ модели ИИ или `None` в случае ошибки.

**Детали**:
- Обрабатывает несколько попыток в случае ошибок сети или недоступности сервиса.
- Ведет журнал ошибок и повторяет попытки с экспоненциальной задержкой.
- Сохраняет диалог в файлы истории.


### `chat`

**Назначение**: Отправляет сообщение чата модели ИИ и получает ответ.

**Параметры**:
- `self`: Экземпляр класса.
- `q` (str): Текстовое сообщение чата.

**Возвращает**:
- `str`: Возвращает текст ответа модели ИИ.

**Детали**:
- Использует сессию чата, инициализированную методом `_start_chat`.
- Ведет журнал ошибок и возвращает текст ответа.


### `describe_image`

**Назначение**: Генерирует текстовое описание изображения.

**Параметры**:
- `self`: Экземпляр класса.
- `image_path` (Path): Путь к изображению.

**Возвращает**:
- `Optional[str]`: Возвращает описание изображения или `None` при ошибках.

**Детали**:
- Кодирует изображение в base64 и отправляет его модели ИИ.
- Возвращает сгенерированное описание или ведет журнал ошибки, если операция не удалась.


### `upload_file`

**Назначение**: Загружает файл в модель ИИ.

**Параметры**:
- `self`: Экземпляр класса.
- `file`: str | Path | IOBase: Файл для загрузки.
- `file_name` (Optional[str], optional): Имя файла. По умолчанию `None`.

**Возвращает**:
- `bool`: `True` если загрузка успешна, `False` иначе.

**Детали**:
- Обрабатывает загрузку файла и ведет журнал успеха или неудачи.
- Предоставляет логику повторных попыток в случае ошибок.


## Обработка ошибок

Подробно рассматриваются различные типы ошибок, включая ошибки сети, недоступность сервиса, лимиты квот, аутентификации, неверного ввода и ошибки API, с применением механизмов обработки и повторных попыток.

## Ведение журнала и история

Все взаимодействия с моделями ИИ записываются в журнал, диалоги сохраняются в текстовом и JSON формате для последующего анализа.

## Зависимости

- `google.generativeai`
- `requests`
- `grpc`
- `google.api_core.exceptions`
- `google.auth.exceptions`
- `src.logger`
- `src.utils.printer`
- `src.utils.file`
- `src.utils.date_time`
- `src.utils.convertors.unicode`
- `src.utils.jjson`

## Пример использования

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
response = ai.ask("Как дела?")
print(response)
```

Этот пример инициализирует класс `GoogleGenerativeAI` и отправляет запрос модели ИИ, выводя ответ.
```
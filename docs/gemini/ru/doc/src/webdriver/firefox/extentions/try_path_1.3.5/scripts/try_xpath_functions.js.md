# tryxpath.functions

## Обзор

Данный модуль `tryxpath.functions.js` предоставляет набор утилитных функций для работы с XPath и DOM в контексте веб-страниц. Он включает функции для выполнения XPath-выражений, обработки результатов, а также для взаимодействия с элементами DOM.

## Оглавление

1.  [Функции](#Функции)
    *   [`execExpr`](#execExpr)
    *   [`resToArr`](#resToArr)
    *   [`makeResolver`](#makeResolver)
    *   [`isValidDict`](#isValidDict)
    *   [`objToMap`](#objToMap)
    *   [`isDocOrElem`](#isDocOrElem)
    *   [`listToArr`](#listToArr)
    *   [`getItemDetail`](#getItemDetail)
    *   [`getItemDetails`](#getItemDetails)
    *   [`getNodeTypeStr`](#getNodeTypeStr)
    *   [`getxpathResultStr`](#getxpathResultStr)
    *   [`getxpathResultNum`](#getxpathResultNum)
    *   [`isAttrItem`](#isAttrItem)
    *   [`isNodeItem`](#isNodeItem)
    *   [`isElementItem`](#isElementItem)
    *   [`addClassToItem`](#addClassToItem)
    *   [`addClassToItems`](#addClassToItems)
    *   [`saveItemClass`](#saveItemClass)
    *   [`restoreItemClass`](#restoreItemClass)
    *   [`saveItemClasses`](#saveItemClasses)
    *   [`restoreItemClasses`](#restoreItemClasses)
    *   [`setAttrToItem`](#setAttrToItem)
    *   [`removeAttrFromItem`](#removeAttrFromItem)
    *   [`removeAttrFromItems`](#removeAttrFromItems)
    *   [`setIndexToItems`](#setIndexToItems)
    *   [`getParentElement`](#getParentElement)
    *   [`getAncestorElements`](#getAncestorElements)
    *   [`getOwnerDocument`](#getOwnerDocument)
    *   [`createHeaderRow`](#createHeaderRow)
    *   [`createDetailTableHeader`](#createDetailTableHeader)
    *   [`createDetailRow`](#createDetailRow)
    *   [`appendDetailRows`](#appendDetailRows)
    *   [`updateDetailsTable`](#updateDetailsTable)
    *   [`emptyChildNodes`](#emptyChildNodes)
    *   [`saveAttrForItem`](#saveAttrForItem)
    *   [`saveAttrForItems`](#saveAttrForItems)
    *   [`restoreItemAttrs`](#restoreItemAttrs)
    *   [`getFrameAncestry`](#getFrameAncestry)
    *   [`isNumberArray`](#isNumberArray)
    *   [`onError`](#onError)
    *   [`isBlankWindow`](#isBlankWindow)
    *   [`collectBlankWindows`](#collectBlankWindows)
    *   [`findFrameElement`](#findFrameElement)
    *   [`findFrameIndex`](#findFrameIndex)
    *    [`makeDetailText`](#makeDetailText)

## Функции

### `execExpr`

**Описание**: Выполняет XPath-выражение или CSS-селектор в заданном контексте.

**Параметры**:
- `expr` (str): XPath-выражение или CSS-селектор для выполнения.
- `method` (str): Метод выполнения выражения (`evaluate`, `querySelector`, `querySelectorAll`).
- `opts` (object, optional): Дополнительные параметры, такие как контекст, преобразователь пространства имен и тип результата.

**Возвращает**:
- `object`: Объект, содержащий массив элементов (`items`), использованный метод (`method`) и тип результата (`resultType`).

**Вызывает исключения**:
- `Error`: Если контекст не является узлом или атрибутом при использовании `evaluate` или если контекст не является документом или элементом при использовании `querySelector` или `querySelectorAll`.

### `resToArr`

**Описание**: Преобразует результат XPath в массив.

**Параметры**:
- `res` (XPathResult): Результат выполнения XPath-выражения.
- `type` (number, optional): Тип результата XPath.

**Возвращает**:
- `Array`: Массив, содержащий результаты.

**Вызывает исключения**:
- `Error`: Если `resultType` недействителен.

### `makeResolver`

**Описание**: Создает функцию-преобразователь пространства имен из объекта или строки JSON.

**Параметры**:
- `obj` (object | string | function | null): Объект, строка JSON или функция преобразователя.

**Возвращает**:
- `function | null`: Функция-преобразователь или `null`, если входной параметр `null`.

**Вызывает исключения**:
- `Error`: Если входной параметр является недействительной строкой JSON или объектом.

### `isValidDict`

**Описание**: Проверяет, является ли объект допустимым словарем для преобразователя пространства имен.

**Параметры**:
- `obj` (object): Объект для проверки.

**Возвращает**:
- `boolean`: `true`, если объект является допустимым словарем; в противном случае `false`.

### `objToMap`

**Описание**: Преобразует объект в Map.

**Параметры**:
- `obj` (object): Объект для преобразования.

**Возвращает**:
- `Map`: Map, созданный из объекта.

### `isDocOrElem`

**Описание**: Проверяет, является ли объект документом или элементом.

**Параметры**:
- `obj` (object): Объект для проверки.

**Возвращает**:
- `boolean`: `true`, если объект является документом или элементом; в противном случае `false`.

### `listToArr`

**Описание**: Преобразует NodeList в массив.

**Параметры**:
- `list` (NodeList): NodeList для преобразования.

**Возвращает**:
- `Array`: Массив, созданный из NodeList.

### `getItemDetail`

**Описание**: Получает детали об элементе, такие как тип, имя, значение и текст.

**Параметры**:
- `item` (object): Элемент для анализа.

**Возвращает**:
- `object`: Объект, содержащий детали элемента.

### `getItemDetails`

**Описание**: Получает детали массива элементов.

**Параметры**:
- `items` (Array): Массив элементов для анализа.

**Возвращает**:
- `Array`: Массив объектов, содержащих детали элементов.

### `getNodeTypeStr`

**Описание**: Получает строковое представление типа узла.

**Параметры**:
- `nodeType` (number): Тип узла.

**Возвращает**:
- `string`: Строковое представление типа узла.

### `getxpathResultStr`

**Описание**: Получает строковое представление типа результата XPath.

**Параметры**:
- `resultType` (number): Тип результата XPath.

**Возвращает**:
- `string`: Строковое представление типа результата XPath.

### `getxpathResultNum`

**Описание**: Получает числовое представление типа результата XPath.

**Параметры**:
- `resultTypeStr` (string): Строковое представление типа результата XPath.

**Возвращает**:
- `number`: Числовое представление типа результата XPath или NaN, если тип неизвестен.

### `isAttrItem`

**Описание**: Проверяет, является ли элемент узлом атрибута.

**Параметры**:
- `item` (object): Элемент для проверки.

**Возвращает**:
- `boolean`: `true`, если элемент является атрибутом; в противном случае `false`.

### `isNodeItem`

**Описание**: Проверяет, является ли элемент узлом (не атрибутом и не примитивным типом).

**Параметры**:
- `item` (object): Элемент для проверки.

**Возвращает**:
- `boolean`: `true`, если элемент является узлом; в противном случае `false`.

### `isElementItem`

**Описание**: Проверяет, является ли элемент элементом (Node.ELEMENT_NODE).

**Параметры**:
- `item` (object): Элемент для проверки.

**Возвращает**:
- `boolean`: `true`, если элемент является элементом; в противном случае `false`.

### `addClassToItem`

**Описание**: Добавляет класс к элементу.

**Параметры**:
- `clas` (string): Имя класса для добавления.
- `item` (object): Элемент для модификации.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `addClassToItems`

**Описание**: Добавляет класс к массиву элементов.

**Параметры**:
- `clas` (string): Имя класса для добавления.
- `items` (Array): Массив элементов для модификации.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `saveItemClass`

**Описание**: Сохраняет класс элемента.

**Параметры**:
- `item` (object): Элемент для сохранения.

**Возвращает**:
- `object | null`: Объект, содержащий элемент и его исходный класс, или `null`, если элемент не является элементом.

### `restoreItemClass`

**Описание**: Восстанавливает сохраненный класс элемента.

**Параметры**:
- `savedClass` (object): Объект, содержащий сохраненные данные элемента.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `saveItemClasses`

**Описание**: Сохраняет классы массива элементов.

**Параметры**:
- `items` (Array): Массив элементов для сохранения.

**Возвращает**:
- `Array`: Массив объектов, содержащих сохраненные данные элементов.

### `restoreItemClasses`

**Описание**: Восстанавливает сохраненные классы массива элементов.

**Параметры**:
- `savedClasses` (Array): Массив объектов, содержащих сохраненные данные элементов.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `setAttrToItem`

**Описание**: Устанавливает атрибут для элемента.

**Параметры**:
- `name` (string): Имя атрибута.
- `value` (string): Значение атрибута.
- `item` (object): Элемент для модификации.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `removeAttrFromItem`

**Описание**: Удаляет атрибут из элемента.

**Параметры**:
- `name` (string): Имя атрибута.
- `item` (object): Элемент для модификации.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `removeAttrFromItems`

**Описание**: Удаляет атрибут из массива элементов.

**Параметры**:
- `name` (string): Имя атрибута.
- `items` (Array): Массив элементов для модификации.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `setIndexToItems`

**Описание**: Устанавливает индекс элемента в качестве атрибута.

**Параметры**:
- `name` (string): Имя атрибута.
- `items` (Array): Массив элементов для модификации.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `getParentElement`

**Описание**: Получает родительский элемент элемента.

**Параметры**:
- `item` (object): Элемент, для которого нужно получить родительский элемент.

**Возвращает**:
- `object | null`: Родительский элемент или `null`, если родитель не найден.

### `getAncestorElements`

**Описание**: Получает массив всех родительских элементов элемента.

**Параметры**:
- `elem` (object): Элемент, для которого нужно получить родительские элементы.

**Возвращает**:
- `Array`: Массив родительских элементов.

### `getOwnerDocument`

**Описание**: Получает документ, которому принадлежит элемент.

**Параметры**:
- `item` (object): Элемент, для которого нужно получить документ.

**Возвращает**:
- `object | null`: Документ или `null`, если документ не найден.

### `createHeaderRow`

**Описание**: Создает строку заголовка таблицы.

**Параметры**:
- `values` (Array): Массив значений для заголовков.
- `opts` (object, optional): Дополнительные параметры.

**Возвращает**:
- `object`: DOM-элемент `tr`, представляющий строку заголовка.

### `createDetailTableHeader`

**Описание**: Создает строку заголовка таблицы деталей.

**Параметры**:
- `opts` (object, optional): Дополнительные параметры.

**Возвращает**:
- `object`: DOM-элемент `tr`, представляющий строку заголовка.

### `createDetailRow`

**Описание**: Создает строку таблицы с деталями элемента.

**Параметры**:
- `index` (number): Индекс элемента.
- `detail` (object): Объект, содержащий детали элемента.
- `opts` (object, optional): Дополнительные параметры, такие как документ и ключи.

**Возвращает**:
- `object`: DOM-элемент `tr`, представляющий строку детали.

### `appendDetailRows`

**Описание**: Асинхронно добавляет строки деталей к родителю.

**Параметры**:
- `parent` (object): Родительский DOM-элемент.
- `details` (Array): Массив объектов деталей.
- `opts` (object, optional): Дополнительные параметры, такие как размер пакета, начальный и конечный индексы, функция для создания строки и ключи деталей.

**Возвращает**:
- `Promise`: Promise, который разрешается после добавления всех строк.

### `updateDetailsTable`

**Описание**: Обновляет таблицу с деталями, очищая предыдущее содержимое и добавляя новые строки.

**Параметры**:
- `parent` (object): Родительский DOM-элемент.
- `details` (Array): Массив объектов деталей.
- `opts` (object, optional): Дополнительные параметры, такие как размер пакета, начальный и конечный индексы и ключи деталей.

**Возвращает**:
- `Promise`: Promise, который разрешается после обновления таблицы.

### `emptyChildNodes`

**Описание**: Удаляет все дочерние узлы элемента.

**Параметры**:
- `elem` (object): Элемент, из которого нужно удалить дочерние узлы.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `saveAttrForItem`

**Описание**: Сохраняет атрибут элемента.

**Параметры**:
- `item` (object): Элемент, для которого нужно сохранить атрибут.
- `attr` (string): Имя атрибута.
- `storage` (Map, optional): Map для хранения данных.
- `overwrite` (boolean, optional): Флаг, указывающий, нужно ли перезаписывать значение.

**Возвращает**:
- `Map`: Map, содержащий сохраненные данные.

### `saveAttrForItems`

**Описание**: Сохраняет атрибуты для массива элементов.

**Параметры**:
- `items` (Array): Массив элементов.
- `attr` (string): Имя атрибута.
- `storage` (Map, optional): Map для хранения данных.
- `overwrite` (boolean, optional): Флаг, указывающий, нужно ли перезаписывать значение.

**Возвращает**:
- `Map`: Map, содержащий сохраненные данные.

### `restoreItemAttrs`

**Описание**: Восстанавливает сохраненные атрибуты элементов.

**Параметры**:
- `storage` (Map): Map, содержащий сохраненные данные.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `getFrameAncestry`

**Описание**: Получает массив фреймов-предков по индексам.

**Параметры**:
- `inds` (Array): Массив индексов фреймов.
- `win` (object, optional): Начальное окно.

**Возвращает**:
- `Array`: Массив фреймов-предков.

**Вызывает исключения**:
- `Error`: Если указанный фрейм не существует или в доступе отказано.

### `isNumberArray`

**Описание**: Проверяет, является ли массив массивом чисел.

**Параметры**:
- `arr` (Array): Массив для проверки.

**Возвращает**:
- `boolean`: `true`, если массив является массивом чисел; в противном случае `false`.

### `onError`

**Описание**: Функция-заглушка для обработки ошибок. В текущей реализации не выполняет никаких действий.

**Параметры**:
- `err` (object): Объект ошибки.

**Возвращает**:
- `null`: Функция ничего не возвращает.

### `isBlankWindow`

**Описание**: Проверяет, является ли окно пустым.

**Параметры**:
- `win` (object): Окно для проверки.

**Возвращает**:
- `boolean`: `true`, если окно является пустым; в противном случае `false`.

### `collectBlankWindows`

**Описание**: Собирает пустые окна из текущего и всех вложенных фреймов.

**Параметры**:
- `top` (object): Верхнее окно.

**Возвращает**:
- `Array`: Массив пустых окон.

### `findFrameElement`

**Описание**: Находит DOM-элемент `iframe` для заданного окна.

**Параметры**:
- `win` (object): Окно для поиска.
- `parent` (object): Родительский элемент.

**Возвращает**:
- `object | null`: DOM-элемент `iframe` или `null`, если не найден.

### `findFrameIndex`

**Описание**: Находит индекс окна в родительском окне.

**Параметры**:
- `win` (object): Окно для поиска.
- `parent` (object): Родительское окно.

**Возвращает**:
- `number`: Индекс окна или `-1`, если не найден.

### `makeDetailText`

**Описание**: Формирует строку текста из деталей элемента.

**Параметры**:
-   `detail` (object): Объект детализации элемента.
-   `keys` (Array): Массив ключей, которые нужно включить в текст.
-   `separator` (string, optional): Разделитель между значениями. По умолчанию ",".
-   `replacers` (object, optional): Объект, содержащий функции для преобразования значений. По умолчанию `Object.create(null)`.

**Возвращает**:
-   `string`: Текстовая строка, созданная из деталей элемента.
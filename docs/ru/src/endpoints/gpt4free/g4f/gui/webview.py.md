# Модуль для запуска WebView интерфейса g4f

## Обзор

Модуль `webview.py` предназначен для запуска графического интерфейса пользователя (GUI) для проекта `g4f` с использованием библиотеки `webview`. Он конфигурирует и запускает веб-интерфейс, позволяя пользователю взаимодействовать с функциональностью `g4f` через веб-браузер. Модуль также включает в себя настройки для отладки, портов HTTP и SSL, а также интеграцию с другими компонентами `g4f`, такими как `gui_parser` и `JsApi`.

## Подробней

Этот модуль играет важную роль в предоставлении пользовательского интерфейса для взаимодействия с проектом `g4f`. Он использует библиотеку `webview` для создания окон, в которых отображается веб-интерфейс. Модуль также обрабатывает различные параметры конфигурации, такие как отладка, порт HTTP, SSL и путь для хранения данных. Кроме того, он интегрируется с другими компонентами `g4f`, такими как `gui_parser` и `JsApi`, для обеспечения полной функциональности GUI.

## Функции

### `run_webview`

```python
def run_webview(
    debug: bool = False,
    http_port: int = None,
    ssl: bool = True,
    storage_path: str = None,
    gui: str = None
) -> None:
    """Запускает веб-интерфейс g4f с использованием библиотеки webview.

    Args:
        debug (bool, optional): Включает режим отладки. По умолчанию False.
        http_port (int, optional): Порт HTTP для запуска веб-интерфейса. По умолчанию None.
        ssl (bool, optional): Включает SSL. По умолчанию True.
        storage_path (str, optional): Путь для хранения данных. По умолчанию None.
        gui (str, optional): Не используется. По умолчанию None.

    Returns:
        None

    Raises:
        ImportError: Если не удается импортировать модуль platformdirs.

    Как работает функция:
    1. Определяется корневой каталог приложения в зависимости от того, запущен ли код в замороженном состоянии (например, как исполняемый файл) или нет.
    2. Настраиваются параметры библиотеки webview, такие как открытие внешних ссылок в браузере и разрешение загрузок.
    3. Создается окно webview с указанным заголовком, путем к HTML-файлу и API JavaScript.
    4. Если указан `storage_path`, используется его значение, иначе, если `platformdirs` доступен, используется путь к каталогу конфигурации пользователя.
    5. Запускается веб-интерфейс с указанными параметрами.

    Внутри функции происходят следующие действия и преобразования:
    Определение каталога -> Настройка webview -> Создание окна -> Запуск webview
    """
```

### Внутренние блоки функции `run_webview`

#### Определение каталога приложения

Определение корневого каталога приложения в зависимости от того, запущен ли код в замороженном состоянии (например, как исполняемый файл) или нет. Если код запущен как исполняемый файл, корневым каталогом будет каталог, в котором находится исполняемый файл. В противном случае корневым каталогом будет каталог, в котором находится скрипт Python.

#### Настройка `webview`

Настраиваются параметры библиотеки `webview`, такие как открытие внешних ссылок в браузере и разрешение загрузок. Это необходимо для обеспечения правильной работы веб-интерфейса.
```python
webview.settings['OPEN_EXTERNAL_LINKS_IN_BROWSER'] = True
webview.settings['ALLOW_DOWNLOADS'] = True
```

#### Создание окна `webview`

Создается окно `webview` с указанным заголовком, путем к HTML-файлу и API JavaScript. HTML-файл содержит структуру веб-интерфейса, а API JavaScript предоставляет функциональность для взаимодействия с веб-интерфейсом.

#### Запуск `webview`

Запускается веб-интерфейс с указанными параметрами, такими как режим отладки, путь для хранения данных, порт HTTP и SSL.

### `if __name__ == "__main__":`

```python
if __name__ == "__main__":
    parser = gui_parser()
    args = parser.parse_args()
    if args.debug:
        g4f.debug.logging = True
    run_webview(args.debug, args.port, not args.debug)
```

**Описание**: Этот блок кода выполняется только при запуске скрипта напрямую. Он использует `gui_parser` для обработки аргументов командной строки, включает отладочное логирование, если указан аргумент `--debug`, и запускает веб-интерфейс с соответствующими параметрами.

**Как работает блок кода**:

1.  **Создание парсера аргументов**: Создается экземпляр `gui_parser`, который предназначен для обработки аргументов командной строки.
2.  **Обработка аргументов**: Используется метод `parse_args()` для извлечения аргументов из командной строки.
3.  **Включение отладочного логирования**: Если аргумент `--debug` установлен, включается отладочное логирование через `g4f.debug.logging = True`.
4.  **Запуск веб-интерфейса**: Вызывается функция `run_webview()` с аргументами, полученными из командной строки.

### Примеры использования `run_webview`

1.  Запуск веб-интерфейса с параметрами по умолчанию:

```python
run_webview()
```

2.  Запуск веб-интерфейса в режиме отладки:

```python
run_webview(debug=True)
```

3.  Запуск веб-интерфейса на определенном порту:

```python
run_webview(http_port=8080)
```

4.  Запуск веб-интерфейса с указанным путем для хранения данных:

```python
run_webview(storage_path="/path/to/storage")
```

5.  Запуск веб-интерфейса с отключенным SSL:

```python
run_webview(ssl=False)
```

```python
    parser = gui_parser()
    args = parser.parse_args()
    if args.debug:
        g4f.debug.logging = True
    run_webview(args.debug, args.port, not args.debug)
# Анализ кода модуля `code_assistant`

## Качество кода:
- **Соответствие стандартам**: 7
- **Плюсы**:
    - Хорошее общее описание функциональности модуля и отдельных скриптов.
    - Подробные инструкции по использованию и настройке.
    - Наличие примеров использования и описания параметров командной строки.
    - Описание структуры проекта и рабочего процесса.
- **Минусы**:
    - Отсутствие единого стандарта форматирования, местами разный стиль написания.
    - Текст не структурирован в виде RST-документации.
    - Присутствует избыточная разметка HTML (table), которая не нужна в MD-файле.
    - Не все элементы документации структурированы в соответствии с требованиями.

## Рекомендации по улучшению:
- Переформатировать весь текст в RST-формате.
- Убрать HTML-разметку (table), оставив Markdown-форматирование.
- Структурировать текст по принципу "Модуль", "Функция", "Класс" и т.д.
- Добавить более подробные описания для каждого компонента.
- Добавить примеры использования для каждого скрипта.
- Описать все шаги для создания новой роли.
- Использовать более формальный стиль в описаниях.
- Привести примеры исключений в `exclude_file_patterns`, `exclude_dirs`, `exclude_files`.
- Перенести заголовок и информацию о структуре проекта в начало документа.
- Создать автоматическую генерацию файла `SUMMARY.md` из этого файла, а не через отдельный скрипт.

## Оптимизированный код:
```rst
.. module:: src.endpoints.hypo69.code_assistant

=========================
Модуль Code Assistant
=========================

Этот модуль предназначен для взаимодействия с моделями Gemini и OpenAI для обработки исходного кода проекта. Он включает в себя инструменты для генерации документации, проверки кода и создания тестов на основе указанных файлов. Модуль также включает скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бота для обработки задач, связанных с кодом.

Структура проекта
-----------------
- **Модели**: Используются модели Gemini и OpenAI для обработки запросов.
- **Пропты**: Пропты считываются из файлов в `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Файлы**: Обрабатываются файлы `.py` и `README.MD` в указанных директориях.

Ключевые особенности
--------------------

`code_assistant.py`
^^^^^^^^^^^^^^^^^^^^

    - **Чтение файлов**: Считывает код из файлов `.py` и `README.MD` в указанных директориях.
    - **Взаимодействие с моделями**: Отправляет код моделям для выполнения задач, таких как генерация документации или проверка ошибок.
    - **Генерация результатов**: Сохраняет ответы моделей в соответствующих директориях для каждой роли.

`make_summary.py`
^^^^^^^^^^^^^^^^^

    - **Генерация SUMMARY.md**: Рекурсивно обходит директорию для создания файла `SUMMARY.md` для компиляции документации.
    - **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (`ru` или `en`).

`onela_bot.py` и `bot_handlers.py`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    - **Telegram Bot**: Бот для обработки задач, связанных с кодом, например, отправка фрагментов кода на проверку или генерация документации.
    - **Bot Handlers**: Содержит обработчики для обработки команд и сообщений бота.

Примеры использования
--------------------

Запуск с настройками из JSON:
    
    .. code-block:: bash
    
        python code_assistant.py --settings settings.json

Запуск с явными параметрами:
    
    .. code-block:: bash
    
        python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2

Пример для роли `code_checker`:
    
    .. code-block:: bash
    
        python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir

Пример для модели `openai`:
    
    .. code-block:: bash
    
        python code_assistant.py --role doc_writer --lang en --models openai

Параметры командной строки
-------------------------

    --settings
        Путь к JSON-файлу с настройками. Загружает параметры из файла.
    --role
        Роль модели для задачи (например, `doc_writer`, `code_checker`).
    --lang
        Язык для задачи (например, `ru` или `en`).
    --models
        Список моделей для инициализации (например, `gemini`, `openai`).
    --start_dirs
        Список директорий для обработки (например, `/path/to/dir1`).

Рабочий процесс
--------------
    
    1.  **Чтение файлов**: Поиск файлов `.py` и `README.MD` в указанных директориях.
    2.  **Загрузка промптов**: Загрузка промптов, специфичных для роли, из `src/ai/prompts/developer/`.
    3.  **Обработка запросов**: Формирование запросов на основе загруженных файлов и их отправка моделям.
    4.  **Сохранение ответов**: Сохранение ответов моделей в директориях, соответствующих роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

Исключения
----------
    
Настройка исключений для файлов и директорий с помощью параметров:

    - `exclude_file_patterns`: Список регулярных выражений для исключения файлов.
    - `exclude_dirs`: Список директорий для исключения.
    - `exclude_files`: Список файлов для исключения.
    
Пример:
    
    .. code-block:: json
    
        {
            "exclude_file_patterns": [".*_test.py"],
            "exclude_dirs": ["venv", "node_modules"],
            "exclude_files": ["setup.py", "conftest.py"]
        }

Логирование
-----------
    
Логи сохраняются с помощью библиотеки `logger` и содержат информацию об обработке файлов и ответах моделей.

Зависимости
------------
    
- **Gemini API**: Требуется API-ключ для модели Gemini.
- **OpenAI API**: Требуется API-ключ для модели OpenAI.

Создание новой роли для AI-моделей
---------------------------------

    1.  **Обновление `code_assistant.json`**:
    
        - Добавьте новую роль в список ролей:
        
            .. code-block:: json
        
                "roles": [
                "code_checker",
                ...,
                "new_role"
                ]
        
        - Или исключите её в `"exclude-roles"`.
    
    2.  **Добавление роли в переводы**:
    
        - Обновите файл `translations/translations.json`, добавив новую роль.
    
    3.  **Создание системного промпта**:
    
        - Добавьте новый системный промпт в `ai/prompts/developer/`.
    
    4.  **Создание инструкции для команды**:
    
        - Добавьте новую инструкцию для команды в `instructions/`.
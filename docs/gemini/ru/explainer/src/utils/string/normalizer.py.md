## <алгоритм>

### `normalize_boolean`
1.  **Вход:** Принимает произвольные данные `input_data`.
2.  **Сохранение оригинала:** Сохраняет исходное значение `input_data` в `original_input` для возврата в случае неудачи.
3.  **Проверка на `bool`:** Если `input_data` уже является булевым значением, возвращает его.
    *   _Пример:_ `input_data = True` -> возвращает `True`
4.  **Преобразование в строку:** Преобразует `input_data` в строку, удаляет пробелы в начале и конце, и приводит к нижнему регистру.
    *   _Пример:_ `input_data = "  Yes  "` -> `input_str = "yes"`
5.  **Проверка на истинность:** Проверяет, входит ли `input_str` в множество истинных значений (`'true'`, `'1'`, `'yes'`, `'y'`, `'on'`, `True`, `1`). Если да, возвращает `True`.
    *   _Пример:_ `input_str = "yes"` -> возвращает `True`
6.  **Проверка на ложность:** Проверяет, входит ли `input_str` в множество ложных значений (`'false'`, `'0'`, `'no'`, `'n'`, `'off'`, `False`, `0`). Если да, возвращает `False`.
    *   _Пример:_ `input_str = "0"` -> возвращает `False`
7.  **Обработка исключений:** В случае ошибки выводит сообщение в лог и переходит к возврату исходного значения.
8.  **Возврат исходного значения:** Если не удалось преобразовать, возвращает `original_input`.
    *   _Пример:_ `input_data = "abc"` -> возвращает `"abc"`

### `normalize_string`
1.  **Вход:** Принимает строку `input_data` или список строк.
2.  **Проверка на пустоту:** Если `input_data` пусто, возвращает пустую строку.
3.  **Сохранение оригинала:** Сохраняет исходное значение `input_data` в `original_input` для возврата в случае неудачи.
4.  **Проверка типа:** Проверяет, является ли `input_data` строкой или списком. Если нет, вызывает исключение `TypeError`.
5.  **Обработка списка:** Если `input_data` - список, объединяет его элементы в одну строку через пробел.
    *   _Пример:_ `input_data = ["Hello", "World"]` -> `input_data = "Hello World"`
6.  **Удаление HTML тегов:** Вызывает функцию `remove_html_tags` для удаления HTML тегов из строки.
7.  **Удаление переносов строк:** Вызывает функцию `remove_line_breaks` для удаления переносов строк.
8.  **Удаление специальных символов:** Вызывает функцию `remove_special_characters` для удаления специальных символов.
9.  **Нормализация пробелов:** Заменяет множественные пробелы на одиночные и удаляет пробелы в начале и конце строки.
    *   _Пример:_ `cleaned_str = "  Hello    World  "` -> `normalized_str = "Hello World"`
10. **Кодирование в UTF-8:** Кодирует и декодирует строку в UTF-8 для корректной обработки символов.
11. **Обработка исключений:** В случае ошибки выводит сообщение в лог и возвращает исходное значение, предварительно закодировав и декодировав его в UTF-8.
12. **Возврат:** Возвращает нормализованную строку.

### `normalize_int`
1.  **Вход:** Принимает данные `input_data` (строку, целое, число с плавающей точкой, Decimal).
2.  **Сохранение оригинала:** Сохраняет исходное значение `input_data` в `original_input` для возврата в случае неудачи.
3.  **Обработка Decimal:** Если `input_data` является экземпляром `Decimal`, преобразует его в целое число.
4.  **Преобразование в целое:** Преобразует `input_data` сначала в float, а затем в int.
    *   _Пример:_ `input_data = "42.5"` -> `int(float("42.5"))` -> `42`
5.  **Обработка исключений:** В случае ошибки `ValueError`, `TypeError` или `InvalidOperation`, выводит сообщение в лог.
6.  **Возврат исходного значения:** Если не удалось преобразовать, возвращает `original_input`.

### `normalize_float`
1.  **Вход:** Принимает любые данные `value`.
2.  **Сохранение оригинала:** Сохраняет исходное значение `value` в `original_value` для возврата в случае неудачи.
3.  **Проверка на пустоту:** Если `value` пусто (None, 0), возвращает 0.
4.  **Обработка списка/кортежа:** Если `value` - список или кортеж, рекурсивно вызывает `normalize_float` для каждого элемента и возвращает список float (исключая значения None).
    *   _Пример:_ `value = [1, "2.5", 3]` -> рекурсивно вызывается `normalize_float` для каждого элемента, возвращая `[1.0, 2.5, 3.0]`
5.  **Преобразование в float:** Пытается преобразовать `value` в float.
    *   _Пример:_ `value = "3.14"` -> `float("3.14")` -> `3.14`
6.  **Обработка исключений:** В случае ошибки `ValueError` или `TypeError`, выводит предупреждение в лог и возвращает `original_value`.
7. **Возврат:** Возвращает преобразованное значение float или список float, или None в случае ошибки.

### `normalize_sql_date`
1.  **Вход:** Принимает данные `input_data` (строка, datetime).
2.  **Сохранение оригинала:** Сохраняет исходное значение `input_data` в `original_input` для возврата в случае неудачи.
3.  **Обработка строки:** Если `input_data` - строка, пытается распарсить ее, используя различные форматы даты.
    *   _Пример:_ `input_data = "12/06/2024"`
4.  **Перебор форматов даты:** Перебирает форматы даты: `%Y-%m-%d`, `%m/%d/%Y`, `%d/%m/%Y`.
5.  **Парсинг даты:** Пытается распарсить `input_data` в объект `datetime` с использованием каждого формата.
    *   _Пример:_ `date_format = "%d/%m/%Y"` -> `datetime.strptime("12/06/2024", "%d/%m/%Y")` -> `datetime(2024, 6, 12)`
6.  **Преобразование в ISO формат:** Если парсинг успешен, преобразует объект `datetime` в дату и возвращает строку в формате `YYYY-MM-DD`.
    *   _Пример:_ `datetime(2024, 6, 12).date().isoformat()` -> `"2024-06-12"`
7.  **Обработка datetime:** Если `input_data` является объектом `datetime`, преобразует его в дату и возвращает строку в формате `YYYY-MM-DD`.
8.  **Обработка исключений:** В случае ошибки, выводит сообщение в лог.
9.  **Возврат исходного значения:** Если не удалось преобразовать, возвращает `original_input`.

### `simplify_string`
1.  **Вход:** Принимает строку `input_str`.
2.  **Удаление лишних символов:** Удаляет все символы, кроме букв, цифр и пробелов, с помощью регулярного выражения.
    *   _Пример:_ `input_str = "It's a test!@#$%"` -> `cleaned_str = "Its a test"`
3.  **Замена пробелов на подчеркивания:** Заменяет все пробелы на подчеркивания.
    *   _Пример:_ `cleaned_str = "Its a test"` -> `cleaned_str = "Its_a_test"`
4.  **Удаление дублирующихся подчеркиваний:** Удаляет последовательности из нескольких подчеркиваний, оставляя только одно.
    *   _Пример:_ `cleaned_str = "Its__a___test"` -> `cleaned_str = "Its_a_test"`
5.  **Обработка исключений:** В случае ошибки, выводит сообщение в лог и возвращает исходную строку.
6.  **Возврат:** Возвращает упрощенную строку.

### `remove_line_breaks`
1.  **Вход:** Принимает строку `input_str`.
2.  **Удаление переносов строк:** Заменяет все символы новой строки (`\n`) и возврата каретки (`\r`) на пробелы.
    *   _Пример:_ `input_str = "Hello\nWorld\r!"` -> `input_str = "Hello World !"`
3.  **Удаление пробелов по краям:** Удаляет пробелы в начале и конце строки.
4.  **Возврат:** Возвращает строку без переносов строк.

### `remove_html_tags`
1.  **Вход:** Принимает строку `input_html`.
2.  **Удаление HTML тегов:** Удаляет все HTML теги из строки с помощью регулярного выражения.
    *   _Пример:_ `input_html = "<p>Hello</p> World"` -> `input_html = "Hello World"`
3.  **Удаление пробелов по краям:** Удаляет пробелы в начале и конце строки.
4.  **Возврат:** Возвращает строку без HTML тегов.

### `remove_special_characters`
1.  **Вход:** Принимает строку или список строк `input_str` и необязательный список символов `chars`.
2.  **Установка символов по умолчанию:** Если `chars` не задан, использует список `['#']`.
3.  **Создание шаблона:** Создает регулярное выражение для удаления заданных символов.
4.  **Обработка списка:** Если `input_str` - список, применяет регулярное выражение к каждому элементу списка.
5.  **Обработка строки:** Если `input_str` - строка, применяет регулярное выражение к строке.
6.  **Возврат:** Возвращает обработанную строку или список строк.

## <mermaid>

```mermaid
graph LR
    A[input_data] --> B(normalize_boolean);
    B -- bool --> C{Return bool};
    B -- str --> D{Проверка на истинность};
    D -- True --> C;
    D -- False --> E{Проверка на ложность};
    E -- True --> C;
    E -- False --> F{Обработка исключений};
    F --> G[original_input];
    G --> C;

    H[input_data] --> I(normalize_string);
    I -- "" --> J{Return ""};
    I -- string --> K{Удаление HTML тегов};
    I -- list --> L{Объединение списка в строку};
    L --> K;
    K --> M{Удаление переносов строк};
    M --> N{Удаление спец.символов};
    N --> O{Нормализация пробелов};
    O --> P{Кодирование в UTF-8};
    P --> Q[Return normalized_str];
     I -- exception --> R[original_input];
    R -->Q;

    S[input_data] --> T(normalize_int);
    T -- Decimal --> U{Преобразование в int};
    T -- Number/String --> V{Преобразование в int};
    U --> W{Return int};
    V --> W;
     T -- exception --> X[original_input];
     X -->W;

    Y[value] --> Z(normalize_float);
    Z -- null --> AA{Return 0};
     Z -- list/tuple --> AB{Рекурсивный вызов normalize_float};
    AB --> AC[List of floats];
    Z -- Number/String --> AD{Преобразование в float};
    AD --> AC;
    Z -- exception --> AE[original_value];
    AE-->AC;


    AF[input_data] --> AG(normalize_sql_date);
    AG -- string --> AH{Парсинг даты};
    AH --> AI{Преобразование в ISO формат};
    AG -- datetime --> AJ{Преобразование в ISO формат};
    AI --> AK{Return YYYY-MM-DD};
    AJ --> AK;
    AG -- exception --> AL[original_input];
    AL --> AK;

    AM[input_str] --> AN(simplify_string);
    AN --> AO{Удаление лишних символов};
     AO --> AP{Замена пробелов на подчеркивания};
    AP --> AQ{Удаление дублирующихся подчеркиваний};
    AQ --> AR[Return simplified_str];
     AN -- exception --> AS[input_str];
     AS --> AR;


    AT[input_str] --> AU(remove_line_breaks);
    AU --> AV{Return string without line breaks};

     AW[input_html] --> AX(remove_html_tags);
    AX --> AY{Return string without HTML tags};

    AZ[input_str,chars] --> BA(remove_special_characters);
    BA --> BB{Return processed string/list};
```

### Объяснение зависимостей `mermaid`

*   `input_data`, `value`, `input_str`, `input_html`, `chars` - входные данные для различных функций.
*   `normalize_boolean`, `normalize_string`, `normalize_int`, `normalize_float`, `normalize_sql_date`, `simplify_string`, `remove_line_breaks`, `remove_html_tags`, `remove_special_characters` - это функции, которые принимают данные и выполняют их нормализацию.
*   **Условные переходы:** Диаграмма показывает ветвления в логике каждой функции. Например, в `normalize_boolean` есть проверки на тип входных данных, истинность и ложность.
*   **Вспомогательные операции:** В `normalize_string` видны вспомогательные шаги, такие как удаление HTML тегов и переносов строк.
*   **Конечные результаты:** Каждый блок с префиксом `Return` представляет возвращаемое значение после обработки.
*   **Обработка ошибок:** Блоки с `exception` показывают, как обрабатываются ошибки в функциях, и что в случае ошибки возвращается исходное значение.
*  **Рекурсия:** Функция `normalize_float` демонстрирует рекурсивный вызов самой себя при обработке списков или кортежей.

## <объяснение>

### Импорты:

*   `re`: Модуль для работы с регулярными выражениями. Используется для удаления HTML тегов, специальных символов и упрощения строк в функциях `remove_html_tags`, `remove_special_characters` и `simplify_string`.
*   `html`: Модуль для работы с HTML. В данном коде не используется, но мог бы использоваться для более сложной обработки HTML.
*   `datetime`: Модуль для работы с датами и временем. Используется в `normalize_sql_date` для преобразования даты в формат SQL.
*   `decimal.Decimal`, `decimal.InvalidOperation`: Модуль для работы с десятичными числами, используется в `normalize_int` для точного преобразования чисел и обработки ошибок.
*   `typing.Any`, `typing.List`, `typing.Union`: Модули для статической типизации, используются для аннотаций типов функций.
*   `src.logger.logger`: Модуль для логирования, используется для записи ошибок и отладочной информации. Зависит от модуля `src.logger`, который отвечает за логирование в рамках проекта.

### Функции:

*   **`normalize_boolean(input_data: Any) -> bool`**:
    *   **Аргументы**: Принимает произвольное значение `input_data`.
    *   **Возвращаемое значение**: Возвращает булево значение (True или False).
    *   **Назначение**: Нормализует входные данные к булевому типу, обрабатывая различные строковые и числовые представления.
    *   **Примеры**:
        *   `normalize_boolean("yes")` -> `True`
        *   `normalize_boolean(0)` -> `False`
        *   `normalize_boolean("invalid")` -> `False` (возвращается исходное значение `input_data`)
*   **`normalize_string(input_data: str | list) -> str`**:
    *   **Аргументы**: Принимает строку `input_data` или список строк.
    *   **Возвращаемое значение**: Возвращает нормализованную строку.
    *   **Назначение**: Нормализует строку, удаляя HTML теги, переносы строк, специальные символы, множественные пробелы и кодируя в UTF-8.
    *   **Примеры**:
        *   `normalize_string("  Hello <br> World!  ")` -> `"Hello World!"`
        *   `normalize_string(["Hello", "  World!  "])` -> `"Hello World!"`
*   **`normalize_int(input_data: Union[str, int, float, Decimal]) -> int`**:
    *   **Аргументы**: Принимает `input_data`, который может быть строкой, целым числом, числом с плавающей точкой или `Decimal`.
    *   **Возвращаемое значение**: Возвращает целое число.
    *   **Назначение**: Нормализует входные данные к целочисленному типу, обрабатывая различные типы данных.
    *   **Примеры**:
        *   `normalize_int("42")` -> `42`
        *   `normalize_int(3.14)` -> `3`
        *   `normalize_int(Decimal("42.5"))` -> `42`
*   **`normalize_float(value: Any) -> float | None`**:
    *   **Аргументы**: Принимает произвольное значение `value`.
    *   **Возвращаемое значение**: Возвращает число с плавающей точкой или список чисел с плавающей точкой, или None если не удалось преобразовать.
    *   **Назначение**: Нормализует входные данные к типу float, обрабатывая числа, строки, а также списки/кортежи.
    *   **Примеры**:
        *   `normalize_float("3.14")` -> `3.14`
        *   `normalize_float([1, "2.5", 3])` -> `[1.0, 2.5, 3.0]`
        *   `normalize_float("invalid")` -> `None` (возвращается исходное значение `value`)
*   **`normalize_sql_date(input_data: str) -> str`**:
    *   **Аргументы**: Принимает строку `input_data`, представляющую дату.
    *   **Возвращаемое значение**: Возвращает дату в формате `YYYY-MM-DD` или исходное значение, если преобразование не удалось.
    *   **Назначение**: Нормализует строку даты в формат SQL.
    *   **Примеры**:
        *   `normalize_sql_date("2024-12-06")` -> `"2024-12-06"`
        *   `normalize_sql_date("12/06/2024")` -> `"2024-12-06"`
        *   `normalize_sql_date("invalid date")` -> `"invalid date"` (возвращается исходное значение `input_data`)
*    **`simplify_string(input_str: str) -> str`**:
    *   **Аргументы**: Принимает строку `input_str`.
    *   **Возвращаемое значение**: Возвращает упрощенную строку.
    *   **Назначение**: Упрощает строку, оставляя только буквы, цифры, и заменяя пробелы на подчеркивания.
    *   **Примеры**:
        *   `simplify_string("It's a test string!")` -> `"Its_a_test_string"`
*   **`remove_line_breaks(input_str: str) -> str`**:
    *   **Аргументы**: Принимает строку `input_str`.
    *   **Возвращаемое значение**: Возвращает строку без переносов строк.
    *   **Назначение**: Удаляет переносы строк (`\n` и `\r`) из строки.
    *   **Примеры**:
        *   `remove_line_breaks("Hello\nWorld\r!")` -> `"Hello World !"`
*   **`remove_html_tags(input_html: str) -> str`**:
    *   **Аргументы**: Принимает строку `input_html`.
    *   **Возвращаемое значение**: Возвращает строку без HTML тегов.
    *   **Назначение**: Удаляет HTML теги из строки.
    *   **Примеры**:
        *   `remove_html_tags("<p>Hello</p> World")` -> `"Hello World"`
*   **`remove_special_characters(input_str: str | list, chars: list[str] = None) -> str | list`**:
    *   **Аргументы**: Принимает строку или список строк `input_str` и необязательный список символов `chars` для удаления.
    *   **Возвращаемое значение**: Возвращает строку или список строк с удаленными специальными символами.
    *   **Назначение**: Удаляет указанные специальные символы из строки или списка строк.
    *   **Примеры**:
        *   `remove_special_characters("Hello#World", ["#"])` -> `"HelloWorld"`
        *   `remove_special_characters(["Hello#", "World#"], ["#"])` -> `['Hello', 'World']`

### Переменные:
*   `MODE`: Глобальная переменная, определяющая режим работы (в данном случае `'dev'`). Может использоваться для настройки логирования или других параметров в зависимости от среды.
*   `original_input`, `original_value`: Переменные, используемые для сохранения исходных значений входных данных перед их обработкой. Это позволяет вернуть исходное значение в случае ошибки обработки, что делает код более надежным.
*   `input_str`, `cleaned_str`, `normalized_str`: Локальные переменные, используемые для промежуточных результатов при обработке строк.
*   `chars`: Локальная переменная для определения списка специальных символов, которые нужно удалить.
*   `ex`: Переменная, используемая для отлова исключений и логирования ошибок.

### Потенциальные ошибки и области для улучшения:

*   **`normalize_boolean`**: Возвращает исходное значение при невозможности преобразования. Лучше возвращать `None` или вызывать исключение, чтобы явнее сигнализировать о проблеме.
*   **`normalize_string`**: Может быть улучшена путем добавления параметров для настройки удаления символов и обработки пробелов.
*   **`normalize_float`**: Возвращает 0, если значение пустое, что может быть нежелательным поведением в некоторых случаях. Лучше возвращать None.
*   **`remove_special_characters`**: По умолчанию удаляет только `#`, можно расширить список или сделать его полностью настраиваемым.
*   **Общая обработка ошибок**: Все функции используют `try-except`, но могут быть дополнены более подробными сообщениями об ошибках и более точными обработчиками исключений.
*   **Логирование**: Код использует `logger.error` для ошибок, `logger.warning` для предупреждений и `logger.debug` для отладочной информации. Настройки логирования можно вынести в конфигурацию.
*  **Кодировка**: Кодирование и декодирование в `normalize_string` может быть избыточным и может быть оптимизировано.
* **Неоднородность возврата**: Некоторые функции возвращают исходное значение, а некоторые None. Это может привести к ошибкам, если не следить за возвращаемыми значениями.

### Взаимосвязь с другими частями проекта:
*   Модуль `normalizer` является частью `src.utils`, что означает, что он предназначен для использования в других частях проекта, где требуется нормализация строк, чисел и дат.
*   Зависимость от `src.logger` показывает, что все операции нормализации логируются для отслеживания проблем.
*   Функции `normalize_sql_date` и `normalize_int` могут быть использованы для подготовки данных перед их записью в базу данных.
*   Функции `normalize_string` и `simplify_string` могут быть использованы для подготовки данных для поиска или сравнения.

Этот анализ предоставляет детальное понимание функциональности кода, его зависимостей и областей для улучшения.
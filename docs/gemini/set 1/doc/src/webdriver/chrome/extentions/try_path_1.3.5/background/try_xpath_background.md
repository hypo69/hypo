# Модуль try_xpath_background.js

## Обзор

Данный файл содержит код обработчика событий для расширения try_xpath. Он отвечает за взаимодействие с другими частями расширения, загрузку стилей, хранение состояния всплывающего окна и передачу результатов поиска.

## Переменные

### `tx`

**Описание**: псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Хранит состояние всплывающего окна.

### `popupCss`

**Описание**: Содержит CSS для стилизации всплывающего окна.

### `results`

**Описание**: Хранит результаты поиска.

### `css`

**Описание**: Содержит CSS-код для вставки в вкладку.

### `attributes`

**Описание**: Объект, содержащий атрибуты для поиска элементов.


## Функции

### `loadDefaultCss()`

**Описание**: Функция загружает стандартный CSS-файл.

**Возвращает**: `Promise` содержащий загруженный CSS-код.

**Вызывает исключения**:
- Обработка ошибок `XMLHttpRequest` передаётся в `fu.onError`


### `genericListener(message, sender, sendResponse)`

**Описание**: Общий обработчик сообщений от других частей расширения.

**Параметры**:
- `message` (объект): Сообщение от другой части расширения.
- `sender` (объект): Объект, отправивший сообщение.
- `sendResponse` (функция): Функция для отправки ответа.


**Возвращает**: `undefined`.

**Вызывает исключения**:
- В случае отсутствия обработчика для события -  `undefined`.


### `genericListener.listeners.storePopupState(message)`

**Описание**: Обработчик для сохранения состояния всплывающего окна.

**Параметры**:
- `message` (объект): Содержит информацию о состоянии.

**Возвращает**: `undefined`.


### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Обработчик запроса восстановления состояния всплывающего окна.

**Параметры**:
- `message` (объект): Содержит данные для запроса.


**Возвращает**: `undefined`.


### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Обработчик запроса вставки CSS в всплывающее окно.

**Возвращает**: `undefined`.


### `genericListener.listeners.showAllResults(message, sender)`

**Описание**: Обработчик для показа всех результатов поиска.

**Параметры**:
- `message` (объект): Сообщение с результатами.
- `sender` (объект): Объект, отправивший сообщение.


**Возвращает**: `undefined`.


### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Обработчик запроса результатов поиска.

**Параметры**:
- `message` (объект): Сообщение с результатами.
- `sender` (объект): Объект, отправивший сообщение.
- `sendResponse` (функция): Функция для отправки ответа.


**Возвращает**: `true`.


### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Обработчик запроса обновления CSS во вкладке.

**Параметры**:
- `message` (объект): Содержит информацию о CSS.
- `sender` (объект): Объект, отправивший сообщение.


**Возвращает**: `undefined`.

**Вызывает исключения**:
- Обработка ошибок `browser.tabs.removeCSS`, `browser.tabs.insertCSS` передаётся в `fu.onError`


### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Обработчик запроса опций.

**Параметры**:
- `message` (объект): Сообщение с параметрами.
- `sender` (объект): Объект, отправивший сообщение.
- `sendResponse` (функция): Функция для отправки ответа.


**Возвращает**: `true`.


### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Обработчик запроса установки информации для содержимого.

**Параметры**:
- `message` (объект): Сообщение с информацией.
- `sender` (объект): Объект, отправивший сообщение.


**Возвращает**: `undefined`.


## Обработчики изменений настроек

Обработчики для событий `browser.storage.onChanged`


## Инициализация

Обработчик событий `browser.storage.onChanged` инициализирует переменные `attributes`, `css`, `popupCss` из хранилища.

В случае отсутствия `css` загружает значения из `/css/try_xpath_insert.css` с использованием `loadDefaultCss`.
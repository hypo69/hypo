# Модуль `supplier.py`

## Обзор

Модуль `supplier.py` предназначен для описания базового класса `Supplier`, который обеспечивает абстракцию и унификацию взаимодействия с различными поставщиками. Он является ключевым компонентом системы и включает функциональность для загрузки связанных модулей поставщика и управления сценариями.

## Подробней

Модуль предоставляет класс `Supplier`, который позволяет запускать сценарии сбора данных, управлять локаторами элементов страницы и взаимодействовать с веб-драйвером. Класс предназначен для упрощения интеграции с различными поставщиками, предоставляя единый интерфейс для выполнения основных задач.

## Классы

### `Supplier`

**Описание**: Класс `Supplier` предназначен для выполнения сценариев, специфичных для различных поставщиков. Он управляет конфигурацией, сценариями и веб-драйвером, обеспечивая унифицированный интерфейс для взаимодействия с поставщиками.

**Как работает класс**:
1.  При инициализации класса происходит загрузка параметров поставщика с использованием метода `_payload`, который импортирует связанные модули и устанавливает необходимые атрибуты.
2.  Класс предоставляет методы для входа на сайт поставщика (`login`), запуска сценариев из файлов (`run_scenario_files`) и выполнения отдельных сценариев (`run_scenarios`).
3.  Для работы с веб-драйвером используется объект `driver`, который может быть передан при инициализации класса или создан внутри связанных модулей поставщика.

**Атрибуты**:

*   `supplier_id` (Optional[int]): Идентификатор поставщика. По умолчанию `None`.
*   `supplier_prefix` (str): Префикс поставщика, используемый для загрузки связанных модулей и файлов конфигурации.
*   `locale` (str): Код локали в формате ISO 639-1. По умолчанию `'en'`.
*   `price_rule` (Optional[str]): Правило расчета цен. По умолчанию `None`.
*   `related_modules` (Optional[ModuleType]): Функции, относящиеся к конкретному поставщику.
*   `scenario_files` (List[str]): Список файлов сценариев для выполнения. По умолчанию пустой список.
*   `current_scenario` (Dict[str, Any]): Текущий исполняемый сценарий. По умолчанию пустой словарь.
*   `locators` (Dict[str, Any]): Локаторы для элементов страницы. По умолчанию пустой словарь.
*   `driver` (Optional[Driver]): Веб-драйвер для взаимодействия с сайтом поставщика. По умолчанию `None`.

**Методы**:

*   `__init__(self, \*\*data)`: Инициализация экземпляра класса `Supplier`.
*   `check_supplier_prefix(cls, value: str) -> str`
*   `_payload(self) -> bool`
*   `login(self) -> bool`
*   `run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool`
*   `run_scenarios(self, scenarios: dict | List[dict]) -> bool`

### `Supplier.check_supplier_prefix`

```python
    @validator(\'supplier_prefix\')
    def check_supplier_prefix(cls, value: str) -> str:
        """Проверка префикса поставщика на пустое значение."""
```

**Назначение**: Валидатор для проверки префикса поставщика (`supplier_prefix`) на предмет пустого значения.

**Параметры**:

*   `cls` (class): Ссылка на класс.
*   `value` (str): Значение префикса поставщика, которое необходимо проверить.

**Возвращает**:

*   `str`: Значение префикса поставщика, если проверка пройдена успешно.

**Вызывает исключения**:

*   `ValueError`: Если `value` является пустой строкой.

**Как работает функция**:

1.  Функция проверяет, является ли переданное значение `value` пустой строкой.
2.  Если `value` является пустой строкой, функция возбуждает исключение `ValueError` с сообщением о том, что префикс поставщика не может быть пустым.
3.  Если `value` не является пустой строкой, функция возвращает это значение.

### `Supplier.__init__`

```python
    def __init__(self, **data):
        """Инициализация поставщика, загрузка конфигурации."""
```

**Назначение**: Инициализация экземпляра класса `Supplier`, включающая загрузку конфигурации поставщика.

**Параметры**:

*   `**data`: Произвольные ключевые аргументы, передаваемые в конструктор для инициализации атрибутов экземпляра.

**Вызывает исключения**:

*   `DefaultSettingsException`: Если не удается запустить поставщика из-за ошибки в методе `_payload`.

**Как работает функция**:

1.  Вызывает конструктор родительского класса (`BaseModel`) для инициализации атрибутов экземпляра на основе переданных данных.
2.  Вызывает метод `_payload` для загрузки параметров поставщика.
3.  Если метод `_payload` возвращает `False`, возбуждается исключение `DefaultSettingsException` с сообщением об ошибке запуска поставщика.

### `Supplier._payload`

```python
    def _payload(self) -> bool:
        """Загрузка параметров поставщика с использованием `j_loads_ns`.

        Returns:
            bool: `True`, если загрузка успешна, иначе `False`.
        """
```

**Назначение**: Загрузка параметров поставщика, включая импорт связанных модулей.

**Возвращает**:

*   `bool`: `True`, если загрузка прошла успешно, и `False` в противном случае.

**Как работает функция**:

1.  Логирует начало процесса загрузки настроек для поставщика с использованием `logger.info`.
2.  Пытается импортировать модуль, связанный с поставщиком, используя `importlib.import_module`. Имя модуля формируется на основе префикса поставщика (`self.supplier_prefix`).
3.  Если модуль успешно импортирован, он присваивается атрибуту `related_modules` экземпляра класса.
4.  Если при импорте модуля возникает исключение `ModuleNotFoundError`, оно логируется с использованием `logger.error`, и функция возвращает `False`.
5.  Если импорт модуля прошел успешно, функция возвращает `True`.

### `Supplier.login`

```python
    def login(self) -> bool:
        """Выполняет вход на сайт поставщика.

        Returns:
            bool: `True`, если вход выполнен успешно, иначе `False`.
        """
```

**Назначение**: Выполнение входа на сайт поставщика с использованием соответствующего модуля.

**Возвращает**:

*   `bool`: `True`, если вход выполнен успешно, иначе `False`.

**Как работает функция**:

1.  Вызывает функцию `login` из модуля, связанного с поставщиком (`self.related_modules`).
2.  Передает текущий экземпляр класса `Supplier` в функцию `login` для выполнения необходимых действий.
3.  Возвращает результат выполнения функции `login`, который указывает на успешность или неуспешность входа.

### `Supplier.run_scenario_files`

```python
    def run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool:
        """Выполнение одного или нескольких файлов сценариев.

        Args:
            scenario_files (Optional[str | List[str]]): Список файлов сценариев. 
                Если не указан, берется из `self.scenario_files`.

        Returns:
            bool: `True`, если все сценарии успешно выполнены, иначе `False`.
        """
```

**Назначение**: Выполнение сценариев, описанных в указанных файлах.

**Параметры**:

*   `scenario_files` (Optional[str | List[str]]): Список файлов сценариев для выполнения. Если не указан, используется `self.scenario_files`.

**Возвращает**:

*   `bool`: `True`, если все сценарии успешно выполнены, иначе `False`.

**Как работает функция**:

1.  Определяет, какие файлы сценариев следует использовать. Если `scenario_files` передан как аргумент, используется он. В противном случае используется значение атрибута `self.scenario_files`.
2.  Вызывает функцию `run_scenario_files` из модуля `src.scenario` для выполнения сценариев.
3.  Передает текущий экземпляр класса `Supplier` и список файлов сценариев в функцию `run_scenario_files`.
4.  Возвращает результат выполнения функции `run_scenario_files`, который указывает на успешность или неуспешность выполнения сценариев.

### `Supplier.run_scenarios`

```python
    def run_scenarios(self, scenarios: dict | List[dict]) -> bool:
        """Выполнение списка или одного сценария.

        Args:
            scenarios (dict | List[dict]): Сценарий или список сценариев для выполнения.

        Returns:
            bool: `True`, если сценарий успешно выполнен, иначе `False`.
        """
```

**Назначение**: Выполнение одного или нескольких сценариев, переданных в виде словаря или списка словарей.

**Параметры**:

*   `scenarios` (dict | List[dict]): Сценарий или список сценариев для выполнения.

**Возвращает**:

*   `bool`: `True`, если сценарий успешно выполнен, иначе `False`.

**Как работает функция**:

1.  Вызывает функцию `run_scenarios` из модуля `src.scenario` для выполнения сценариев.
2.  Передает текущий экземпляр класса `Supplier` и сценарии в функцию `run_scenarios`.
3.  Возвращает результат выполнения функции `run_scenarios`, который указывает на успешность или неуспешность выполнения сценариев.
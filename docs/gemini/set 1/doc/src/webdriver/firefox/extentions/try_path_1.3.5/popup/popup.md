# Модуль `popup.js`

## Обзор

Этот JavaScript-модуль реализует функциональность всплывающего окна расширения Firefox для инструмента поиска XPath.  Модуль отвечает за запрос информации о текущей странице, обработку результатов и отображение их в окне. Он содержит функции для коммуникации с активной вкладкой/кадром, управления отображением различных секций интерфейса, обновления таблицы результатов и обработки событий.


## Переменные

### `noneClass`

**Описание**: Константа, хранящая имя класса, используемого для скрытия элементов.


### `helpClass`

**Описание**: Константа, хранящая имя класса, используемого для элементов помощи.


### `invalidTabId`, `invalidExecutionId`, `invalidFrameId`

**Описание**: Константы, представляющие невалидные значения для идентификаторов вкладок, выполнения и кадров.


### `mainWay`, `mainExpression`, `contextCheckbox`, `contextHeader`, и т.д.

**Описание**: Переменные, хранящие ссылки на DOM-элементы, представляющие различные поля и элементы управления в всплывающем окне.


### `relatedTabId`, `relatedFrameId`, `executionId`

**Описание**: Переменные, хранящие информацию о текущей активной вкладке, кадре и идентификаторе выполнения.


### `resultedDetails`

**Описание**: Массив, содержащий детали найденных элементов.


### `detailsPageSize`, `detailsPageIndex`

**Описание**: Параметры для отображения результатов постранично.


## Функции

### `sendToActiveTab(msg, opts)`

**Описание**: Отправляет сообщение в активную вкладку.

**Параметры**:

- `msg` (Object): Сообщение для отправки.
- `opts` (Object, необязательно): Дополнительные параметры для отправки сообщения.

**Возвращает**:

- `Promise`: Обещание выполнения отправки сообщения.

**Вызывает исключения**:

- `Error`: Возникает в случае проблем с взаимодействием с вкладками.


### `sendToSpecifiedFrame(msg)`

**Описание**: Отправляет сообщение в указанный кадр.

**Параметры**:

- `msg` (Object): Сообщение для отправки.

**Возвращает**:

- `Promise`: Обещание выполнения отправки сообщения.

**Вызывает исключения**:

- `Error`: Возникает в случае проблем с взаимодействием с кадром или неверного идентификатора кадра.


### `collectPopupState()`

**Описание**: Сбор состояния всплывающего окна.

**Возвращает**:

- `Object`: Объект, содержащий сохранённое состояние.


### `changeContextVisible()`, `changeResolverVisible()`, `changeFrameIdVisible()`, `changeFrameDesignationVisible()`, `changeHelpVisible()`

**Описание**: Управляет видимостью различных секций всплывающего окна.


### `makeExecuteMessage()`

**Описание**: Формирует сообщение для выполнения поиска.

**Возвращает**:

- `Object`: Объект, содержащий параметры для поиска.

**Вызывает исключения**:

- Не указаны


### `getSpecifiedFrameId()`

**Описание**: Получает идентификатор указанного кадра.

**Возвращает**:

- `Integer`: Идентификатор кадра.

**Вызывает исключения**:

- Не указаны


### `execContentScript()`

**Описание**: Выполняет скрипт в контексте содержимого страницы.

**Возвращает**:

- `Promise`: Обещание завершения выполнения скрипта.

**Вызывает исключения**:

- `Error`: Возникает при проблемах с выполнением скрипта.


### `sendExecute()`

**Описание**: Отправляет запрос на выполнение поиска.

**Вызывает исключения**:

- Не указаны


### `handleExprEnter(event)`

**Описание**: Обработчик события Enter для поля ввода выражения.


### `showDetailsPage(index)`

**Описание**: Отображает страницу с результатами поиска.

**Параметры**:

- `index` (Integer, необязательно): Номер страницы с результатами.

**Вызывает исключения**:

- Не указаны

### `showError(message, frameId)`

**Описание**: Отображает сообщение об ошибке.

**Параметры**:

- `message` (String): Сообщение об ошибке.
- `frameId` (Integer): Идентификатор кадра.


### `genericListener(message, sender, sendResponse)`

**Описание**: Общий обработчик сообщений из контента страницы.

**Параметры**:

- `message` (Object): Сообщение.
- `sender` (Object): Отправитель сообщения.
- `sendResponse` (Function): Функция для отправки ответа.

**Возвращает**:

- `Boolean`: Указывает, требует ли обработчик асинхронного выполнения (`.addListener` требует `true`).


### `genericListener.listeners.showResultsInPopup`, `genericListener.listeners.restorePopupState`, `genericListener.listeners.insertStyleToPopup`, `genericListener.listeners.addFrameId`

**Описание**: Обработчики конкретных событий из контента страницы.

**Параметры**:
- см. комментарии внутри кода


##  DOM Элементы

Перечислены основные DOM-элементы, используемые в скрипте.  (Список, скопированный напрямую из кода. Для лучшего понимания, необходимо знать назначение каждого элемента.)
```
```

##  События

Подробное описание всех обработчиков событий и их функциональности.


##  Заключение

Модуль `popup.js` играет ключевую роль в взаимодействии расширения с веб-страницей и отображении результатов поиска XPath. Его функции обеспечивают эффективную коммуникацию, обработку и отображение информации в удобном для пользователя формате.
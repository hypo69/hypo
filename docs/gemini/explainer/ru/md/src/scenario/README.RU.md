# Модуль `src.scenario` для автоматизации взаимодействия с поставщиками

Модуль `src.scenario` предназначен для автоматизации взаимодействия с поставщиками, используя сценарии, описанные в JSON-файлах.  Он адаптирует процесс извлечения и обработки данных о продуктах с веб-сайтов поставщиков и синхронизирует эту информацию с базой данных системы (например, PrestaShop).

## Основные функции

* **Чтение сценариев:** Загрузка сценариев из JSON-файлов.  Сценарии описывают различные категории продуктов и соответствующие URL-адреса на сайтах поставщиков.
* **Взаимодействие с веб-сайтами:**  Используя URL из сценариев, модуль запрашивает страницы продуктов и извлекает необходимые данные.
* **Обработка данных:** Преобразование извлеченных данных в формат, подходящий для базы данных.  Важная часть – использование информации о категориях из сценариев для корректного размещения продуктов в системе.
* **Запись журнала выполнения:**  Ведение журнала с деталями выполнения сценариев, результатами и ошибками для отслеживания процесса.

## Основные компоненты

* **`run_scenario_files(s, scenario_files_list)`:** Выполняет все сценарии из списка файлов по очереди, используя функцию `run_scenario_file`.
* **`run_scenario_file(s, scenario_file)`:** Загружает сценарии из файла, и вызывает `run_scenario` для каждого сценария.
* **`run_scenario(s, scenario)`:**  Обрабатывает отдельный сценарий:
    *  Открывает страницу по указанному URL.
    *  Извлекает данные о продуктах.
    *  Сохраняет данные в базе данных, используя информацию о категориях из сценария (`presta_categories`).
* **`dump_journal(s, journal)`:** Сохраняет журнал выполнения в файл для анализа.
* **`main()`:** Точка входа в модуль, запускающая процесс выполнения сценариев.

## Пример сценария (JSON)

```json
{
  "scenarios": {
    "Минеральные_кремы_для_лица": {
      "url": "https://hbdeadsea.co.il/product-category/facial/moisture-face/",
      "name": "Минеральные_кремы_для_лица",
      "presta_categories": {
        "default_category": 11245,
        "additional_categories": [11288]
      }
    }
  }
}
```

В примере:

* `url`: Адрес страницы с продуктами на сайте поставщика.
* `name`: Имя категории (для внутренних целей).
* `presta_categories`:  Список категорий в PrestaShop, куда нужно поместить продукты. `default_category` — основная категория, `additional_categories` — дополнительные.


## Как работает модуль

1. **Загрузка сценариев:** Модуль загружает JSON-файлы со сценариями и парсит их.
2. **Извлечение данных:** По заданному URL из сценария модуль извлекает данные о продуктах (название, цена, описание и т.д.).  Важный момент – это как именно осуществляется извлечение данных (парсинг HTML, использование API поставщика).
3. **Обработка и сохранение:** Извлеченные данные обрабатываются, преобразуются в формат, ожидаемый базой данных (например, PrestaShop), и сохраняются с учетом указанных категорий из сценария.
4. **Отчеты и журналы:** Модуль создаёт журнал выполнения с подробностями каждого этапа и любыми возникшими ошибками. Это критически важно для отладки и анализа работы.

Этот модуль обеспечивает автоматизацию процесса интеграции с поставщиками,  упрощая работу с разными источниками данных и синхронизацию с системой управления товарами.  Ключевым аспектом является корректная обработка данных и соответствие формату базы данных.
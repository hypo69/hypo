# Модуль для управления веб-сайтом

## Обзор

Модуль `website.py` предназначен для управления маршрутами и отображением веб-страниц с использованием фреймворка Flask. Он определяет класс `Website`, который связывает URL-адреса с соответствующими функциями для отображения веб-страниц и обработки статических ресурсов.

## Подробней

Этот модуль является частью серверной логики веб-приложения `freegpt-webui-ru` и отвечает за маршрутизацию запросов к различным страницам веб-сайта. Он использует Flask для определения маршрутов и рендеринга шаблонов. Особое внимание уделяется обработке URL-адресов чатов и статических ресурсов (assets).

## Классы

### `Website`

**Описание**: Класс `Website` инициализирует Flask-приложение и определяет маршруты для различных URL-адресов.

**Принцип работы**:
1.  При инициализации класса создается словарь `routes`, который содержит соответствия между URL-адресами и функциями, обрабатывающими эти URL-адреса.
2.  Метод `__init__` принимает Flask-приложение в качестве аргумента и сохраняет его для дальнейшего использования.
3.  Определены маршруты для главной страницы (`/`), страницы чата (`/chat/`), страницы чата с конкретным `conversation_id` (`/chat/<conversation_id>`) и для статических ресурсов (`/assets/<folder>/<file>`).

**Методы**:
*   `__init__(self, app)`: Инициализирует экземпляр класса `Website`.
*   `_chat(self, conversation_id)`: Обрабатывает запросы к странице чата с указанным `conversation_id`.
*   `_index(self)`: Обрабатывает запросы к главной странице чата (`/chat/`).
*   `_assets(self, folder: str, file: str)`: Обрабатывает запросы к статическим ресурсам.

**Параметры**:
*   `app`: Flask-приложение.
*   `conversation_id` (str): Идентификатор беседы.
*   `folder` (str): Папка, содержащая статический ресурс.
*   `file` (str): Имя статического ресурса.

**Примеры**:
```python
from flask import Flask
app = Flask(__name__)
website = Website(app)
```

## Функции

### `_chat`

```python
def _chat(self, conversation_id):
    """Обрабатывает запросы к странице чата с указанным `conversation_id`.

    Args:
        conversation_id (str): Идентификатор беседы.

    Returns:
        flask.Response: Результат рендеринга шаблона `index.html` с указанным `chat_id` или перенаправление на `/chat`, если `conversation_id` не содержит '-'.

    Примеры:
        >>> website._chat('1234-abcd-5678-efgh-0123456789ab')
        # Возвращает страницу чата с указанным идентификатором.
        >>> website._chat('1234abcd5678efgh0123456789ab')
        # Перенаправляет на /chat, так как идентификатор не содержит '-'.
    """
```

**Как работает функция**:

1.  Функция принимает идентификатор беседы (`conversation_id`) в качестве аргумента.
2.  Проверяет, содержит ли `conversation_id` символ `-`. Если нет, происходит перенаправление на страницу `/chat`.
3.  Если `conversation_id` содержит символ `-`, функция отображает шаблон `index.html`, передавая `conversation_id` в качестве параметра `chat_id`.

### `_index`

```python
def _index(self):
    """Обрабатывает запросы к главной странице чата (`/chat/`).

    Returns:
        flask.Response: Результат рендеринга шаблона `index.html` с автоматически сгенерированным `chat_id`.

    Примеры:
        >>> website._index()
        # Возвращает страницу чата с автоматически сгенерированным идентификатором.
    """
```

**Как работает функция**:

1.  Функция генерирует случайный идентификатор беседы, используя `urandom` и `time`.
2.  Генерируется 4 байта случайных данных, затем 2 байта, затем 2 байта, затем 2 байта и добавляется текущее время в миллисекундах в шестнадцатеричном формате.
3.  Отображает шаблон `index.html`, передавая сгенерированный `chat_id` в шаблон.

### `_assets`

```python
def _assets(self, folder: str, file: str):
    """Обрабатывает запросы к статическим ресурсам.

    Args:
        folder (str): Папка, содержащая статический ресурс.
        file (str): Имя статического ресурса.

    Returns:
        flask.Response: Статический файл, если он найден, или сообщение об ошибке "File not found" с кодом 404.

    Raises:
        Exception: Если возникает ошибка при отправке файла.

    Примеры:
        >>> website._assets('css', 'styles.css')
        # Возвращает файл стилей styles.css из папки css.
        >>> website._assets('images', 'logo.png')
        # Возвращает файл изображения logo.png из папки images.
    """
```

**Как работает функция**:

1.  Функция принимает имя папки (`folder`) и имя файла (`file`) в качестве аргументов.
2.  Пытается отправить запрошенный файл, используя `send_file` из Flask.
3.  Если файл не найден, возвращает сообщение об ошибке "File not found" с кодом 404.
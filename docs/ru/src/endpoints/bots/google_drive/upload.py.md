# Модуль для загрузки файлов в Google Drive

## Обзор

Модуль предоставляет функциональность для загрузки файлов в Google Drive с использованием библиотеки `PyDrive`. Он поддерживает аутентификацию пользователя, создание папок (если они не существуют) и загрузку файлов как в личный Google Drive, так и в Team Drive (если настроены соответствующие параметры).

## Подробней

Этот модуль предназначен для автоматизации процесса загрузки файлов в Google Drive. Он использует учетные данные пользователя для аутентификации и позволяет указать родительскую папку для загрузки. Если родительская папка не существует, она будет создана. Модуль также поддерживает загрузку в Team Drive, если указаны соответствующие параметры.

## Функции

### `upload`

```python
def upload(filename: str, update, context, parent_folder: str = None) -> None:
    """
    Загружает файл в Google Drive, создавая папку при необходимости.

    Args:
        filename (str): Полный путь к файлу, который нужно загрузить.
        update: Объект, содержащий информацию об обновлении от пользователя (например, сообщение из Telegram).
        context: Контекст выполнения (например, для передачи дополнительных данных).
        parent_folder (str, optional): Название родительской папки в Google Drive. По умолчанию `None`, что означает загрузку в корень диска.

    Returns:
        None: Функция ничего не возвращает, но выводит сообщения об успехе или ошибке в консоль.

    Raises:
        Exception: В случае ошибки при загрузке файла в Google Drive.

    Example:
        >>> upload('path/to/your/file.txt', update, context, 'MyFolder')
    """
```

**Как работает функция**:

1.  **Инициализация**:
    *   Функция `upload` принимает имя файла, объект `update`, контекст и название родительской папки в качестве аргументов.
    *   Инициализируются переменные для работы с Google Drive.
    *   Создается инстанс `GoogleAuth` для аутентификации.
2.  **Аутентификация**:
    *   Функция пытается загрузить учетные данные пользователя из файла, используя ID пользователя.
    *   Если учетные данные отсутствуют, выводится сообщение о необходимости аутентификации.
    *   Если срок действия учетных данных истек, они обновляются.
    *   После успешной аутентификации создается объект `GoogleDrive`.
3.  **Проверка наличия файла**:
    *   Проверяется, существует ли указанный файл локально. Если файл не найден, функция завершает свою работу.
4.  **Обработка родительской папки**:
    *   Если указана родительская папка и не настроен `Creds.TEAMDRIVE_FOLDER_ID`:
        *   Функция пытается найти папку с указанным именем в корне Google Drive.
        *   Если папка найдена, используется её ID для загрузки файла.
        *   Если папка не найдена, она создается, и её ID используется для загрузки файла.
5.  **Загрузка файла**:
    *   Формируются параметры файла, включая название файла и родительскую папку (если указана).
    *   Если настроен `Creds.TEAMDRIVE_FOLDER_ID`, файл загружается в Team Drive.
    *   Создается объект файла и устанавливается содержимое файла.
    *   Файл загружается в Google Drive с обработкой возможных исключений.
6.  **Установка прав доступа**:
    *   Если файл загружается не в Team Drive, устанавливаются права доступа "для всех, у кого есть ссылка" на чтение.
7.  **Возврат ссылки на файл**:
    *   Функция возвращает ссылку на загруженный файл.

```python
ID = update.message.from_user.id
```

*   **Назначение**: Извлекает идентификатор пользователя из объекта `update.message.from_user.id`.
*   **Как работает**: Получает `id` пользователя, отправившего сообщение, из объекта `update`. Этот `id` используется для определения файла учетных данных пользователя.

```python
file_list = drive.ListFile({'q': "'root' in parents and trashed=false"}).GetList()
```

*   **Назначение**: Получает список файлов и папок, находящихся в корневом каталоге Google Drive пользователя.
*   **Как работает**: Использует метод `ListFile` объекта `drive` для запроса списка файлов и папок, находящихся в корневом каталоге (`'root' in parents`) и не находящихся в корзине (`trashed=false`). Результат сохраняется в переменной `file_list`.

**Внутренние блоки**:

*   **Аутентификация и Авторизация**: Блок отвечает за аутентификацию пользователя в Google Drive, используя либо сохраненные учетные данные, либо обновляя их, если они устарели.
*   **Поиск или Создание Папки**: Блок определяет, существует ли указанная родительская папка в Google Drive, и создает ее, если она не найдена.
*   **Загрузка Файла**: Блок загружает указанный файл в Google Drive, используя параметры файла, такие как название и родительская папка.
*   **Установка Прав Доступа**: Блок устанавливает права доступа к загруженному файлу, чтобы сделать его доступным для чтения по ссылке.

```python
file_to_upload.Upload(param={"supportsTeamDrives" : True , "http": http})
```

*   **Назначение**: Загружает файл в Google Drive.
*   **Как работает**: Вызывает метод `Upload` объекта `file_to_upload` для загрузки файла в Google Drive. Параметр `supportsTeamDrives=True` указывает, что файл может быть загружен в Team Drive. Параметр `http` передает объект HTTP для выполнения запроса.
```
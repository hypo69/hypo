
# FastAPI Server Manager CLI (Интерактивный)

Инструмент командной строки (CLI) для интерактивного управления экземплярами FastAPI сервера. Он использует шаблон Singleton для управления экземплярами сервера, позволяя запускать, останавливать и отслеживать статус сервера через CLI.

## Особенности

-   **Singleton Pattern:** Обеспечивает наличие только одного экземпляра FastAPI сервера, управляемого через CLI.
-   **Интерактивное управление:** Запуск сервера один раз, последующее управление его состоянием (запуск, остановка, просмотр статуса) через команды.
-   **CLI Interface:** Удобный интерфейс командной строки с использованием `typer`.
-   **Настраиваемые опции:** Возможность указания порта и хоста для запуска серверов через CLI.
-   **Асинхронное управление:** Использует `asyncio` для асинхронного запуска и остановки серверов.
-   **Отслеживание статуса:** Возможность просмотра состояния сервера и всех запущенных на нем портов.

## Требования

-   Python 3.7+
-   Установленные зависимости:
    -   `typer`
    -   `uvicorn`
    -   `fastapi`
    -   `pydantic`
    -   `loguru` (или аналогичный модуль для логгирования)

## Установка

1.  Клонируйте репозиторий (если применимо) или скопируйте код в файл `main.py`.
2.  Установите зависимости:

    ```bash
    pip install typer uvicorn fastapi pydantic loguru
    ```

## Использование

Запустите CLI, используя Python:

```bash
python main.py <command> [options]
```

### Команды

-   **`start`:** Инициализирует и запускает FastAPI сервер. Этот сервер будет единственным экземпляром, которым можно управлять через другие команды.
    -   `--port`: (Необязательно) Порт для запуска сервера. По умолчанию: 8000.
    -   `--host`: (Необязательно) Адрес хоста для сервера. По умолчанию: 0.0.0.0.

    Пример:

    ```bash
    python main.py start --port 8080
    python main.py start --port 8081 --host 127.0.0.1
    ```

    *Примечание:*  Если сервер уже инициализирован, будет выведено сообщение об этом, повторно инициализировать сервер нельзя.
-   **`stop`:** Останавливает FastAPI сервер на указанном порту.
    -   `--port`: (Обязательно) Порт сервера для остановки.

    Пример:

    ```bash
    python main.py stop --port 8080
    ```
   *Примечание:* Вы не можете остановить сервер, если он не был запущен.
-   **`stop-all`:** Останавливает все запущенные FastAPI серверы.
     Пример:
    ```bash
    python main.py stop-all
    ```
   *Примечание:* Вы не можете остановить сервер, если он не был запущен.
-   **`status`:** Выводит состояние сервера и всех запущенных на нем портов.
     Пример:
    ```bash
     python main.py status
    ```
  *Примечание:* Выведет информацию о сервере только если он был запущен.

-   **`--help`:** Выводит справку по командам.

    Пример:

    ```bash
    python main.py --help
    python main.py start --help
    ```

## Пример Использования

1.  **Запуск сервера:** Запустите сервер на порту 8000:

    ```bash
    python main.py start --port 8000
    ```

2.  **Просмотр статуса:** Вы можете просмотреть статус сервера и запущенные на нем порты:

    ```bash
    python main.py status
    ```
3.  **Попытка повторного запуска:** Попытайтесь запустить сервер на другом порту (например, 8081): 
3. 
   ```bash
    python main.py start --port 8081
    ```
    В консоль будет выведено сообщение, о том, что сервер уже запущен.

4.  **Остановка сервера на порту 8000:** Остановите сервер на порту 8000:

    ```bash
    python main.py stop --port 8000
    ```
5.  **Просмотр статуса после остановки:** Вы можете просмотреть статус сервера:

    ```bash
    python main.py status
    ```
     На экране появится сообщение о том, что сервер не запущен на порту 8000.
6.  **Остановка всех серверов:**

    ```bash
    python main.py stop-all
    ```

7.  **Просмотр статуса после остановки всех серверов:**
7. 
     ```bash
    python main.py status
    ```
    В консоле будет сообщение, что сервер не был инициализирован.
## Архитектура

-   `FastApiServer`: Класс Singleton, представляющий собой FastAPI приложение, и управляющий запуском серверов.
-   `main.py`: Содержит CLI команды и логику интерактивного управления сервером, а также тестовые endpoint'ы `/hello` и `/post`.
-   `typer`: Библиотека, используемая для создания интерфейса командной строки.
-   `uvicorn`: ASGI веб-сервер для запуска FastAPI приложения.

## Зависимости

-   `fastapi`: веб-фреймворк для создания API.
-   `typer`: библиотека для создания интерфейсов командной строки.
-   `uvicorn`: ASGI веб-сервер.
-   `pydantic`: библиотека для валидации типов.
-  `loguru`: библиотека для логгирования


----


# FastAPI Server Manager PowerShell Script

Этот проект предоставляет скрипт PowerShell для управления FastAPI сервером. Он обеспечивает интерактивное меню для запуска, остановки и отслеживания статуса сервера.

## Особенности

-   **Интерактивное Меню:** Удобный интерфейс командной строки через PowerShell.
-   **Управление Сервером:** Запуск, остановка и отслеживание статуса FastAPI сервера.
-   **Проверка Портов:** Проверка доступности портов перед запуском серверов.
-   **Обработка ошибок:** Запись ошибок при выполнении скрипта.
-   **Настройка параметров:** Возможность указания порта и хоста для запуска серверов.

## Требования

-   Windows
-   PowerShell 5.1 или выше
-   Python 3.7+ с установленными зависимостями FastAPI (смотри `README.md` python проекта)

## Установка

1.  Сохраните скрипт PowerShell как файл `server_manager.ps1`.
2.  Убедитесь, что файл `main.py` находится в той же директории или укажите полный путь к нему в переменной `$pythonScriptPath` в скрипте PowerShell.
3.  Убедитесь, что Python и необходимые библиотеки установлены.
    
## Использование

1.  Запустите PowerShell от имени администратора.
2.  Перейдите в каталог, где находится файл `server_manager.ps1`.
3.  Выполните скрипт:
    ```powershell
    .\server_manager.ps1
    ```

### Меню

После запуска скрипта вы увидите меню:

```
FastAPI Server Manager
----------------------
1. Start Server
2. Stop Server
3. Stop All Servers
4. Get Server Status
5. Exit
```

Выберите опцию, введя соответствующую цифру (1-5) и нажмите Enter.

### Команды Меню

-   **`1. Start Server`:**
    -   Запрашивает порт (по умолчанию: 8000).
    -   Запрашивает хост (по умолчанию: 0.0.0.0).
    -   Проверяет, не занят ли порт.
    -   Запускает сервер FastAPI.

-   **`2. Stop Server`:**
    -   Запрашивает порт сервера для остановки.
    -   Останавливает FastAPI сервер на указанном порту.

-   **`3. Stop All Servers`:**
    -   Останавливает все запущенные FastAPI серверы.

-    **`4. Get Server Status`:**
    -    Выводит статус всех запущенных FastAPI серверов.

-   **`5. Exit`:**
    -   Завершает работу скрипта.

### Пример

1.  **Запуск сервера:**
    -   Выберите `1`.
    -   Введите порт, например `8080` (или оставьте поле пустым для порта по умолчанию `8000`).
    -    Введите хост, например `127.0.0.1` (или оставьте поле пустым для хоста по умолчанию `0.0.0.0`).
2.  **Остановка сервера:**
    -   Выберите `2`.
    -   Введите порт, например `8080`.
3. **Остановка всех серверов**
    -  Выберите `3`.
4.  **Просмотр статуса:**
     - Выберите `4`.
5. **Выход**
   - Выберите `5`.

## Архитектура

-   `server_manager.ps1`: Скрипт PowerShell, предоставляющий интерактивный интерфейс для управления FastAPI сервером.
-   `main.py`: Файл Python, который запускается скриптом PowerShell. (см. README.md для python проекта).
-   `Test-NetConnection`: Командлет PowerShell для проверки портов.
-   `python.exe`: Вызывает Python для запуска команд CLI в `main.py`

## Зависимости

-  `python.exe`: Должен быть установлен в системе и доступен через PATH
-  `main.py`: Файл python с командами для управления сервером

## Лицензия

[LICENCE]

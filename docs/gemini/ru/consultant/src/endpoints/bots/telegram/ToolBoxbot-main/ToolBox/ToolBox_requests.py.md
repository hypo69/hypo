# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –º–æ–¥—É–ª—è ToolBox_requests

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞: 6/10**

*   **–ü–ª—é—Å—ã:**
    *   –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.
    *   –ö–æ–¥ —Ä–∞–∑–±–∏—Ç –Ω–∞ –º–µ—Ç–æ–¥—ã, —á—Ç–æ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å.
    *   –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª–∞—Å—Å—ã –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
*   **–ú–∏–Ω—É—Å—ã:**
    *   –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è.
    *   –ù–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.
    *   –ù–µ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞.
    *   –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª—è–º–±–¥—ã, —á—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –∫–æ–¥–∞.
    *   –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `while True` —Å `try-except` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º—É —Ü–∏–∫–ª—É.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `time.sleep` —á—Ç–æ –ø–ª–æ—Ö–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
    *   –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `from src.logger.logger import logger` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫.
    *   –ú–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏, –Ω–æ —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
    *   –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ `TextCommands` –∏ `SomeTextsCommand`, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —Ç—Ä—É–¥–Ω–æ —á–∏—Ç–∞–µ–º—ã–º.
    *   –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `avalib` –≤–º–µ—Å—Ç–æ `available`).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:**

1.  **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    *   –î–æ–±–∞–≤–∏—Ç—å docstring –¥–ª—è –º–æ–¥—É–ª—è, –∫–ª–∞—Å—Å–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ RST.
    *   –í–∫–ª—é—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–π.
2.  **–ò–º–ø–æ—Ä—Ç—ã:**
    *   –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞.
3.  **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:**
    *   –ó–∞–º–µ–Ω–∏—Ç—å –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –æ–±—ã—á–Ω—ã–µ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
    *   –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∏ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–µ—Ç–æ–¥—ã `TextCommands` –∏ `SomeTextsCommand`.
    *   –ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç `while True` —Å `try-except`, –∑–∞–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ —Å –ø–æ–º–æ—â—å—é `logger.error`.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.sleep` –≤–º–µ—Å—Ç–æ `time.sleep`
    *   –ò–∑–±–µ–≥–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö `nonlocal` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
    *   –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–æ–∑–º–æ–∂–Ω–æ, —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.
    *   –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –º–µ—Ç–æ–¥ `__FLUX_schnell` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `num_inference_steps`).
    *   –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `avalib` –Ω–∞ `available`).
4.  **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `from src.logger.logger import logger` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫.
5.  **–£–ª—É—á—à–µ–Ω–∏—è:**
    *   –†–∞–∑–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
    *   –í `TextCommands` –∏ `SomeTextsCommand` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ `asyncio.sleep`.

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```python
"""
–ú–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –±–æ—Ç–∞.
===========================================================

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å :class:`ToolBox`, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –±–æ—Ç–∞, –≤–∫–ª—é—á–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
--------------------

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞ `ToolBox`:

.. code-block:: python

    toolbox = ToolBox()
    toolbox.bot.polling(none_stop=True)
"""
import asyncio
import os
import json
import concurrent.futures
from random import randint
import base64
from pathlib import Path
from typing import Any, List, Dict, Tuple
from telebot import TeleBot, types
from src.logger.logger import logger  # Correct import
from BaseSettings.AuxiliaryClasses import PromptsCompressor, keyboards
from ToolBox_n_networks import neural_networks
from src.utils.jjson import j_loads  # –ò—Å–ø–æ–ª—å–∑—É–µ–º j_loads

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞
pc = PromptsCompressor()


# –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
class ToolBox(keyboards, neural_networks):
    """
    –ö–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –±–æ—Ç–∞.

    Attributes:
        name (List[str]): –°–ø–∏—Å–æ–∫ –∏–º–µ–Ω –∫–Ω–æ–ø–æ–∫ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é.
        data (List[str]): –°–ø–∏—Å–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é.
        prompts_text (Dict[str, Any]): –°–ª–æ–≤–∞—Ä—å —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫.
        bot (TeleBot): –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ TeleBot.
        keyboard_blank (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
        reply_keyboard (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ã—á–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
        __delay (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–∂–∏–¥–∞–Ω–∏—è.
        start_request (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
        restart (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.
        restart_markup (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.
        OneTextArea (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞.
        SomeTextsArea (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–∞.
        ImageSize (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        ImageArea (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –≤–≤–æ–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        ImageChange (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º.
        BeforeUpscale (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–µ—Ä–µ–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º.
        FreeArea (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞.
        TariffArea (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞.
        TariffExit (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –º–µ–Ω—é —Ç–∞—Ä–∏—Ñ–æ–≤.
        TarrifEnd (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–∞.
        FreeTariffEnd (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
        SomeTexts (Callable): –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–µ–∫—Å—Ç–æ–≤.
    """

    def __init__(self):
        # Start buttons
        self.name = ['–¢–µ–∫—Å—Ç üìù', '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è üé®', '–°–≤–æ–±–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º üóΩ', '–¢–∞—Ä–∏—Ñ—ã üí∏']
        self.data = ['text', 'images', 'free', 'tariff']

        # Prompts texts load
        try:
            with open('ToolBox/BaseSettings/prompts.json', 'r') as file:  # –ò—Å–ø–æ–ª—å–∑—É–µ–º 'r' –¥–ª—è —á—Ç–µ–Ω–∏—è
                self.prompts_text = j_loads(file) # –ò—Å–ø–æ–ª—å–∑—É–µ–º j_loads
        except Exception as ex:
             logger.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ prompts.json', ex)
             self.prompts_text = {}

        # Telegram bot initialization
        self.bot = TeleBot(token=os.environ['TOKEN'])
        # Inline keyboard blank lambda
        self.keyboard_blank = lambda name, data: super()._keyboard_two_blank(data, name)  # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Markup keyboard
        self.reply_keyboard = lambda name: super()._reply_keyboard(name) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Request delay
        self.__delay = lambda message: self.bot.send_message(message.chat.id, '–ü–æ–¥–æ–∂–¥–∏—Ç–µ, —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ . . .', parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Start request
        self.start_request = lambda message: self.bot.send_message(message.chat.id, self.prompts_text['hello'], reply_markup=self.keyboard_blank(self.name, self.data), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Restart request
        self.restart = lambda message: self.bot.send_message(message.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –≤–∞–º –∑–∞–¥–∞—á—É', reply_markup=self.keyboard_blank(self.name, self.data), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Restart murkup
        self.restart_markup = lambda message: self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text='–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –≤–∞–º –∑–∞–¥–∞—á—É', reply_markup=self.keyboard_blank(self.name, self.data), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # One text request
        self.OneTextArea = lambda message, ind: self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text=self.prompts_text['text_list'][ind] if isinstance(self.prompts_text['text_list'][ind], str) else self.prompts_text['text_list'][ind][0], reply_markup=self.keyboard_blank(['–ù–∞–∑–∞–¥'], ['text_exit'])) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Some texts request
        self.SomeTextsArea = lambda message, ind: self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text=self.prompts_text['few_texts_list'][ind][0], reply_markup=self.keyboard_blank(['–ù–∞–∑–∞–¥'], ['text_exit'])) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Image size
        self.ImageSize = lambda message: self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text='–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', reply_markup=self.keyboard_blank(['9:16', '1:1', '16:9', '–í –º–µ–Ω—é'], ['576x1024', '1024x1024', '1024x576', 'exit']), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Image request
        self.ImageArea = lambda message: self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text='–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π üñº', reply_markup=self.keyboard_blank(['–í –º–µ–Ω—é'], ['exit']), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Image change
        self.ImageChange = lambda message: self.bot.send_message(chat_id=message.chat.id, text='–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ', reply_markup=self.keyboard_blank(['–£–ª—É—á—à–∏—Ç—å ü™Ñ', 'üîÅ', '–ù–æ–≤–∞—è üñº', '–í –º–µ–Ω—é'], ['upscale', 'regenerate', 'images', 'exit']), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Message before upscale
        self.BeforeUpscale = lambda message: self.bot.send_message(chat_id=message.chat.id, text='–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ', reply_markup=self.keyboard_blank(['üîÅ', '–ù–æ–≤–∞—è üñº', '–í –º–µ–Ω—é'], ['regenerate', 'images', 'exit']), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Free mode request
        self.FreeArea = lambda message: self.bot.send_message(chat_id=message.chat.id, text='–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å', reply_markup=self.reply_keyboard(['–í –º–µ–Ω—é']), parse_mode='html') # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Tariff request
        self.TariffArea = lambda message: self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text='–¢–∞—Ä–∏—Ñ—ã', reply_markup=self.keyboard_blank(['BASIC', 'PRO', '–ü—Ä–æ–º–æ–∫–æ–¥', '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞', '–í –º–µ–Ω—é'], ['basic', 'pro', 'promo', 'ref', 'exit'])) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Tariffs area exit
        self.TariffExit = lambda message: self.bot.send_message(chat_id=message.chat.id, text='–¢–∞—Ä–∏—Ñ—ã', reply_markup=self.keyboard_blank(['BASIC', 'PRO', '–ü—Ä–æ–º–æ–∫–æ–¥', '–í –º–µ–Ω—é'], ['basic', 'pro', 'promo', 'exit'])) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # End tariff
        self.TarrifEnd = lambda message: self.bot.send_message(chat_id=message.chat.id, text='–£ –≤–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∑–∞–ø—Ä–æ—Å—ã, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–ª–∏—Ç—å –≤–∞—à —Ç–∞—Ä–∏—Ñ.', reply_markup=self.keyboard_blank(['BASIC', 'PRO', '–ü—Ä–æ–º–æ–∫–æ–¥', '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞', '–í –º–µ–Ω—é'], ['basic', 'pro', 'promo', 'ref', 'exit'])) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Free tariff end
        self.FreeTariffEnd = lambda message: self.bot.send_message(chat_id=message.chat.id, text='–õ–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —É–≤—ã, –∏—Å—á–µ—Ä–ø–∞–Ωüò¢ –ù–æ –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –Ω–∞—à–∏—Ö –ø–ª–∞—Ç–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤. –ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∏—Ö –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ', reply_markup=self.keyboard_blank(['BASIC', 'PRO', '–ü—Ä–æ–º–æ–∫–æ–¥', '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞', '–í –º–µ–Ω—é'], ['basic', 'pro', 'promo', 'ref', 'exit'])) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã
        # Select one or some texts
        self.SomeTexts = lambda message, ind: self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text='–•–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ?', reply_markup=self.keyboard_blank(['–û–¥–∏–Ω', '–ù–µ—Å–∫–æ–ª—å–∫–æ', '–ù–∞–∑–∞–¥'], [f'one_{ind}', f'some_{ind}', 'text_exit'])) # –£–±—Ä–∞–ª self –∏–∑ –ª—è–º–±–¥—ã

    # Private methods
    async def _send_message_with_delay(self, message: types.Message, text: str, parse_mode: str = 'html', reply_markup: types.InlineKeyboardMarkup = None) -> types.Message:
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞–∑–º–µ—Ç–∫–∏.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
            text (str): –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
            parse_mode (str, optional): –†–µ–∂–∏–º —Ä–∞–∑–º–µ—Ç–∫–∏. Defaults to 'html'.
             reply_markup (types.InlineKeyboardMarkup, optional): Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞. Defaults to None

        Returns:
            types.Message: –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
        """
        send = self.__delay(message)
        await asyncio.sleep(1) # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è
        if reply_markup:
            await self.bot.edit_message_text(chat_id=send.chat.id, message_id=send.message_id, text=text, parse_mode=parse_mode, reply_markup=reply_markup)
        else:
            await self.bot.edit_message_text(chat_id=send.chat.id, message_id=send.message_id, text=text, parse_mode=parse_mode)
        return send

    async def _gpt_4o_mini(self, prompt: List[Dict[str, str]], message: types.Message) -> Tuple[Dict[str, str], int, int]:
        """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ GPT-4o mini.

        Args:
            prompt (List[Dict[str, str]]): –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏.
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.

        Returns:
            Tuple[Dict[str, str], int, int]: –ö–æ—Ä—Ç–µ–∂, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ—Ç–≤–µ—Ç, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤.
        """
        send = await self._send_message_with_delay(message, "–ò–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...")
        response, incoming_tokens, outgoing_tokens = super()._free_gpt_4o_mini(prompt=prompt)
        await self.bot.edit_message_text(chat_id=send.chat.id, message_id=send.message_id, text=PromptsCompressor.html_tags_insert(response['content']), parse_mode='html')
        return response, incoming_tokens, outgoing_tokens

    async def _flux_schnell(self, prompt: str, size: List[int], message: types.Message, seed: int, num_inference_steps: int) -> None:
        """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ FLUX schnell –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

        Args:
            prompt (str): –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞.
            size (List[int]): –†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
            seed (int): –ó–µ—Ä–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
            num_inference_steps (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
        """
        send = await self._send_message_with_delay(message, "–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...")
        photo = None
        for _ in range(3): # –ü–æ–ø—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å 3 –ø–æ–ø—ã—Ç–∫–∏
            try:
                photo = super()._FLUX_schnell(prompt, size, seed, num_inference_steps)
                break
            except Exception as ex:
                logger.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', ex)
                await asyncio.sleep(1) # –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
        if photo:
            await self.bot.send_photo(chat_id=message.chat.id, photo=photo)
            await self.bot.delete_message(chat_id=send.chat.id, message_id=send.message_id)
        else:
            await self.bot.edit_message_text(chat_id=send.chat.id, message_id=send.message_id, text="–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ")


    # Public methods
    def text_types(self, message: types.Message) -> types.Message:
        """
        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–∏–ø–∞–º–∏ —Ç–µ–∫—Å—Ç–∞.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.

        Returns:
            types.Message: –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–∏–ø–∞–º–∏ —Ç–µ–∫—Å—Ç–∞.
        """
        names = ['–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π  üõçÔ∏è', 'SMM üì±', '–ë—Ä–µ–π–Ω—à—Ç–æ—Ä–º üí°', '–†–µ–∫–ª–∞–º–∞ üì∫', '–ó–∞–≥–æ–ª–æ–≤–∫–∏ üîç', 'SEO üåê', '–ù–æ–≤–æ—Å—Ç—å üì∞', '–†–µ–¥–∞–∫—Ç—É—Ä–∞ üìù', '–í –º–µ–Ω—é']
        data = ['comm-text', 'smm-text', 'brainst-text', 'advertising-text', 'headlines-text', 'seo-text', 'news', 'editing', 'exit']
        return self.bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text='üìù –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç–µ–∫—Å—Ç–∞', reply_markup=self.keyboard_blank(names, data))

    def basic_tariff(self, message: types.Message) -> None:
        """
        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—á–µ—Ç –¥–ª—è –æ–ø–ª–∞—Ç—ã –±–∞–∑–æ–≤–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
        """
        keyboard = types.InlineKeyboardMarkup()
        keyboard.add(types.InlineKeyboardButton('–ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ BASIC', pay=True))
        keyboard.add(types.InlineKeyboardButton('–ö —Ç–∞—Ä–∏—Ñ–∞–º', callback_data='tariff_exit'))
        price = [types.LabeledPrice(label='BASIC', amount=99 * 100)]
        self.bot.delete_message(chat_id=message.chat.id, message_id=message.message_id)
        self.bot.send_invoice(chat_id=message.chat.id, title='BASIC',
                            description='–ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞, –≤ —Ç–æ–º —á–∏—Å–ª–µ –ø–æ –≥–æ—Ç–æ–≤—ã–º –ø—Ä–æ–º–ø—Ç–∞–º.',
                            invoice_payload='basic_invoice_payload',
                            start_parameter='subscription',
                            provider_token=os.environ['PROVIDE_TOKEN'],
                            currency='RUB', prices=price, reply_markup=keyboard)

    def pro_tariff(self, message: types.Message) -> None:
        """
         –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—á–µ—Ç –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
        """
        keyboard = types.InlineKeyboardMarkup()
        keyboard.add(types.InlineKeyboardButton('–ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ PRO', pay=True))
        keyboard.add(types.InlineKeyboardButton('–ö —Ç–∞—Ä–∏—Ñ–∞–º', callback_data='tariff_exit'))
        price = [types.LabeledPrice(label='PRO', amount=199 * 100)]
        self.bot.delete_message(chat_id=message.chat.id, message_id=message.message_id)
        self.bot.send_invoice(chat_id=message.chat.id, title='PRO',
                            description='–ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (–≤ —Ç–æ–º —á–∏—Å–ª–µ –ø–æ –≥–æ—Ç–æ–≤—ã–º –ø—Ä–æ–º–ø—Ç–∞–º) –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.',
                            invoice_payload='pro_invoice_payload',
                            start_parameter='subscription',
                            provider_token=os.environ['PROVIDE_TOKEN'],
                            currency='RUB', prices=price, reply_markup=keyboard)

    async def text_commands(self, message: types.Message, ind: int) -> Tuple[int, int, int]:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
            ind (int): –ò–Ω–¥–µ–∫—Å –∫–æ–º–∞–Ω–¥—ã.

        Returns:
            Tuple[int, int, int]: –ö–æ—Ä—Ç–µ–∂, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤, –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤.
        """
        info = []
        incoming_tokens = 0
        outgoing_tokens = 0
        response = None
        if 'TEXT' in pc.commands_size[ind]:
            info.append(message.text)
            msg = await self.bot.send_message(chat_id=message.chat.id, text=self.prompts_text['text_list'][ind][1])

            async def text_next_step(message: types.Message):
                nonlocal info, incoming_tokens, outgoing_tokens, response
                info += message.text.split(';')
                while len(info) < len(pc.commands_size[ind]):
                    info.append('–ü–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')
                prompt = pc.get_prompt(ind=ind, info=info)
                response, incoming_tokens, outgoing_tokens = await self._gpt_4o_mini(prompt=[{'role': 'user', 'content': prompt}], message=message)
                self.restart(message)

            self.bot.register_next_step_handler(msg, text_next_step)
            while response is None:
                await asyncio.sleep(0.1)
            return incoming_tokens, outgoing_tokens, 1
        else:
            info = message.text.split(';')
            while len(info) < len(pc.commands_size[ind]):
                info.append('–ü–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')
            prompt = pc.get_prompt(ind=ind, info=info)
            response, incoming_tokens, outgoing_tokens = await self._gpt_4o_mini(prompt=[{'role': 'user', 'content': prompt}], message=message)
            self.restart(message)
            return incoming_tokens, outgoing_tokens, 1


    async def some_texts_command(self, message: types.Message, ind: int, tokens: Dict[str, int]) -> Tuple[int, int, int]:
        """
         –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
            ind (int): –ò–Ω–¥–µ–∫—Å –∫–æ–º–∞–Ω–¥—ã.
            tokens (Dict[str, int]): –°–ª–æ–≤–∞—Ä—å —Å —Ç–æ–∫–µ–Ω–∞–º–∏.

        Returns:
            Tuple[int, int, int]: –ö–æ—Ä—Ç–µ–∂, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤, –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤.
        """
        n = int(message.text)
        available = [0, 1, 3, 5, 6]  # –ò—Å–ø—Ä–∞–≤–∏–ª –æ–ø–µ—á–∞—Ç–∫—É
        answers = []

        for i in range(n):
            answers.append([])
            if 'TEXT' in pc.commands_size[ind]:
                msg = await self.bot.send_message(chat_id=message.chat.id, text=f'–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ {i + 1}')
                text = None

                async def text_next_step(message: types.Message):
                    nonlocal text, answers
                    text = message.text
                    answers[i].append(text)

                self.bot.register_next_step_handler(msg, text_next_step)
                while text is None:
                    await asyncio.sleep(0.1)

        index = available.index(ind)
        for el in range(1, len(self.prompts_text['few_texts_list'][index])):
            msg = await self.bot.send_message(chat_id=message.chat.id, text=self.prompts_text['few_texts_list'][index][el])
            params = None

            async def params_addition(message: types.Message):
                nonlocal params, answers
                params = message.text
                params = params.split(';')
                if len(params) < len(pc.commands_size[ind]):
                    while len(params) < len(pc.commands_size[ind]):
                        params.append(None)
                param = params[0]
                for j in range(len(answers)): # –ò—Å–ø–æ–ª—å–∑—É–µ–º for j in range
                    if params[j] is None:
                        answers[j].append(param)
                    else:
                         answers[j].append(params[j])


            self.bot.register_next_step_handler(msg, params_addition)
            while params is None:
                await asyncio.sleep(0.1)

        incoming_tokens = 0
        outgoing_tokens = 0
        async def process_prompt(i: int) -> Tuple[int, int]:
            nonlocal incoming_tokens, outgoing_tokens
            prompt = pc.get_prompt(ind=ind, info=answers[i])
            if tokens['incoming_tokens'] - incoming_tokens > 0 and tokens['outgoing_tokens'] - outgoing_tokens > 0 or tokens['free_requests'] - i > 0:
                response, in_tokens, out_tokens = await self._gpt_4o_mini(prompt=[{'role': 'user', 'content': prompt}], message=message)
                return in_tokens, out_tokens
            return 0, 0

        with concurrent.futures.ThreadPoolExecutor() as executor:
           results = list(executor.map(process_prompt, range(n)))

        for in_tokens, out_tokens in results:
            incoming_tokens += in_tokens
            outgoing_tokens += out_tokens

        self.restart(message)
        return incoming_tokens, outgoing_tokens, n


    async def image_command(self, message: types.Message, prompt: str, size: List[int]) -> int:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
            prompt (str): –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞.
            size (List[int]): –†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

        Returns:
            int: –ó–µ—Ä–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
        """
        seed = randint(1, 1000000)
        await self._flux_schnell(prompt=prompt, size=size, message=message, seed=seed, num_inference_steps=4)
        self.ImageChange(message)
        return seed

    async def image_regen_and_upscale(self, message: types.Message, prompt: str, size: List[int], seed: int, num_inference_steps: int = 4) -> None:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
            prompt (str): –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞.
            size (List[int]): –†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
            seed (int): –ó–µ—Ä–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
            num_inference_steps (int, optional): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. Defaults to 4.
        """
        await self._flux_schnell(prompt=prompt, size=size, message=message, seed=seed, num_inference_steps=num_inference_steps)

    async def free_command(self, message: types.Message, prompts: List[Dict[str, Any]]) -> Tuple[int, int, List[Dict[str, Any]]]:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞.

        Args:
            message (types.Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram.
            prompts (List[Dict[str, Any]]): –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.

        Returns:
            Tuple[int, int, List[Dict[str, Any]]]: –ö–æ—Ä—Ç–µ–∂, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤, –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.
        """
        try:
            if not isinstance(prompts[-1].get('content', False), list):
                prompts.append({'content': message.text, 'role': 'user'})
        except (IndexError, TypeError):
            pass
        response, incoming_tokens, outgoing_tokens = await self._gpt_4o_mini(prompt=prompts, message=message)
        prompts.append(response)
        return incoming_tokens, outgoing_tokens, prompts
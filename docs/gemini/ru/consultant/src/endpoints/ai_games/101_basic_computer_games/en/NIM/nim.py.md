# Анализ кода модуля `nim.py`

**Качество кода: 7/10**

-   **Плюсы**
    -   Код достаточно хорошо структурирован и понятен.
    -   Реализация игры NIM соответствует описанным правилам и алгоритму.
    -   Используется `random` для инициализации кучек камней, что делает игру более динамичной.
    -   Есть базовые проверки ввода данных.
    -   Присутствуют комментарии, объясняющие основную логику работы кода.
-   **Минусы**
    -   Отсутствует документация в формате reStructuredText (RST).
    -   Отсутствует логирование ошибок.
    -   Обработка ошибок ввода не очень информативна для пользователя.
    -   Не используется `j_loads` или `j_loads_ns` из `src.utils.jjson` (хотя это не требуется в данном случае, так как нет работы с файлами).
    -   Переменные и функции не соответствуют ранее обработанным файлам.

**Рекомендации по улучшению**

1.  **Документация:** Переписать все комментарии в формате reStructuredText (RST), включая docstrings для функций и модуля.
2.  **Логирование:** Добавить логирование ошибок с использованием `from src.logger.logger import logger`.
3.  **Обработка ошибок:** Улучшить обработку ошибок ввода, предоставляя более конкретные сообщения пользователю.
4.  **Имена функций и переменных:** Переименовать функции и переменные в соответствии с ранее обработанными файлами, например `display_piles` -> `display_board`.
5.  **Импорты:** Проверить наличие всех необходимых импортов.
6.  **Общая структура:** Разделить код на более мелкие, переиспользуемые функции.
7.  **Убрать лишние комментарии:**  Удалить излишние комментарии, оставляя только самое необходимое для понимания логики кода.

**Оптимизированный код**

```python
"""
Модуль для реализации игры NIM.
=========================================================================================

Этот модуль содержит функции для игры в NIM, включая инициализацию игрового поля,
отображение состояния кучек, обработку хода игрока и определение победителя.

Пример использования
--------------------

.. code-block:: python

    from src.endpoints.ai_games.101_basic_computer_games.en.NIM.nim import play_nim

    if __name__ == "__main__":
        play_nim()
"""
import random
from src.logger.logger import logger  # добавление импорта для логирования

# .. todo:: переименовать в  display_board, board, move_player
def display_piles(piles: list) -> None:
    """
    Выводит текущее состояние кучек камней на экран.

    :param piles: Список, представляющий кучки камней.
    :type piles: list
    :return: None
    :rtype: None
    """
    print("Текущее состояние кучек:")
    for i, pile in enumerate(piles):
        print(f"Кучка {i + 1}: {pile} камней")
# Функция для получения хода игрока
def get_player_move(piles: list, player: int) -> tuple:
    """
    Запрашивает у игрока номер кучки и количество камней для удаления.

    :param piles: Список, представляющий кучки камней.
    :type piles: list
    :param player: Номер текущего игрока (1 или 2).
    :type player: int
    :raises ValueError: Если введен некорректный номер кучки или количество камней.
    :return: Кортеж, содержащий номер кучки (индекс) и количество камней для удаления.
    :rtype: tuple
    """
    while True:
        try:
            # Код запрашивает у игрока номер кучки и уменьшает его на 1 для индексации с 0
            pile_number = int(input(f"Игрок {player}, выберите номер кучки (1-{len(piles)}): ")) - 1
            # Код проверяет, что номер кучки находится в пределах допустимого диапазона
            if 0 <= pile_number < len(piles):
                # Код запрашивает у игрока количество камней для удаления
                stones_to_remove = int(input(f"Игрок {player}, сколько камней взять из кучки {pile_number + 1}: "))
                # Код проверяет, что количество камней больше 0 и не превышает текущее количество в кучке
                if 0 < stones_to_remove <= piles[pile_number]:
                     # Код возвращает номер кучки и количество камней
                    return pile_number, stones_to_remove
                else:
                    # Код выводит сообщение об ошибке, если количество камней недопустимо
                    print("Недопустимое количество камней. Пожалуйста, выберите значение от 1 до текущего количества в кучке.")
            else:
                # Код выводит сообщение об ошибке, если номер кучки недопустим
                print("Недопустимый номер кучки. Пожалуйста, выберите существующую кучку.")
        except ValueError as e:
            # Код перехватывает ошибку ввода, логирует ее и сообщает об этом пользователю
            logger.error(f"Ошибка ввода: {e}")
            print("Неверный ввод. Пожалуйста, введите целые числа.")
# Основная функция игры
def play_nim() -> None:
    """
    Реализует игру NIM.

    :return: None
    :rtype: None
    """
    # Инициализация кучек камней случайными значениями от 1 до 10
    piles = [random.randint(1, 10), random.randint(1, 10), random.randint(1, 10)]
    # Устанавливаем первого игрока
    current_player = 0  # 0 - игрок 1, 1 - игрок 2
    # Игровой цикл, пока сумма всех камней больше 0
    while sum(piles) > 0:
        # Выводим текущее состояние кучек
        display_piles(piles)
         # Получаем ход текущего игрока
        pile_number, stones_to_remove = get_player_move(piles, current_player + 1)
        # Вычитаем выбранное количество камней из выбранной кучки
        piles[pile_number] -= stones_to_remove
        # Переключаем игрока
        current_player = (current_player + 1) % 2
    # Выводим победителя
    print(f"Игрок {current_player + 1} победил!")


if __name__ == "__main__":
    play_nim()
```
# Модуль для работы с видео файлами
======================================

Модуль предоставляет асинхронные функции для загрузки и сохранения видео файлов, а также для получения данных видео. Он включает в себя обработку ошибок и логирование для обеспечения надежной работы.

## Обзор

Модуль `src.utils.video` предоставляет функции для асинхронной загрузки видео по URL-адресу и сохранения его локально, а также для получения бинарных данных видеофайла. Это полезно для приложений, которым требуется загружать и обрабатывать видеоконтент.

## Подробнее

Модуль содержит функции для загрузки видео из интернета и сохранения их на диск, а также для чтения видео файлов. Все операции логируются для отслеживания ошибок и предупреждений. Он использует `aiohttp` для асинхронных сетевых запросов и `aiofiles` для асинхронных операций с файлами.
Модуль предназначен для работы с видеофайлами, предоставляя функциональность для их загрузки и сохранения. Это может быть использовано в различных приложениях, где требуется работа с видеоконтентом.

## Функции

### `save_video_from_url`

```python
async def save_video_from_url(
    url: str,
    save_path: str
) -> Optional[Path]:
    """Download a video from a URL and save it locally asynchronously.

    Args:
        url (str): The URL from which to download the video.
        save_path (str): The path to save the downloaded video.

    Returns:
        Optional[Path]: The path to the saved file, or `None` if the operation failed.  Returns None on errors and if file is 0 bytes.

    Raises:
        aiohttp.ClientError: on network issues during the download.
    """
```

**Назначение**: Асинхронно загружает видео по URL-адресу и сохраняет его локально.

**Параметры**:
- `url` (str): URL-адрес видео для загрузки.
- `save_path` (str): Путь для сохранения загруженного видео.

**Возвращает**:
- `Optional[Path]`: Путь к сохраненному файлу или `None`, если операция не удалась. Возвращает `None` при ошибках и если размер файла равен 0 байт.

**Вызывает исключения**:
- `aiohttp.ClientError`: Возникает при сетевых проблемах во время загрузки.

**Как работает функция**:

1.  **Инициализация**: Функция принимает URL-адрес видео и путь для сохранения.
2.  **Асинхронная сессия**: Создается асинхронная сессия для выполнения HTTP-запроса.
3.  **HTTP-запрос**: Отправляется GET-запрос по указанному URL-адресу.
4.  **Проверка статуса**: Проверяется статус ответа HTTP. Если статус указывает на ошибку (например, 404), вызывается исключение.
5.  **Создание директорий**: Создаются родительские директории для пути сохранения, если они не существуют.
6.  **Асинхронная запись файла**: Открывается файл по указанному пути для асинхронной записи в бинарном режиме.
7.  **Чтение и запись чанков**: Видео загружается по частям (чанки размером 8192 байта) и записывается в файл.
8.  **Проверки после сохранения**:
    *   Проверяется, был ли файл успешно сохранен.
    *   Проверяется, не является ли сохраненный файл пустым.
9.  **Обработка ошибок**:
    *   Если возникает ошибка при выполнении HTTP-запроса, она регистрируется, и возвращается `None`.
    *   Если возникает любая другая ошибка, она регистрируется вместе с трассировкой, и возвращается `None`.
10. **Возврат результата**: В случае успеха возвращается объект `Path` к сохраненному файлу.

```ascii
    Начало
    ↓
    → Создание асинхронной сессии
    ↓
    → Отправка GET-запроса по URL
    ↓
    → Проверка статуса ответа
    ↓
    → Создание родительских директорий
    ↓
    → Асинхронная запись файла
    ↓
    → Чтение и запись чанков
    ↓
    → Проверки после сохранения (существование и размер файла)
    ↓
    Конец
```

**Примеры**:

```python
import asyncio
from pathlib import Path

# Пример успешной загрузки видео
async def main():
    url = "https://example.com/video.mp4"  # Замените на актуальный URL
    save_path = "local_video.mp4"
    result = await save_video_from_url(url, save_path)
    if result:
        print(f"Видео сохранено в {result}")
    else:
        print("Не удалось сохранить видео")

# Запуск асинхронной функции
asyncio.run(main())

# Пример обработки ошибки загрузки
async def main():
    url = "https://example.com/nonexistent_video.mp4"  # Несуществующий URL
    save_path = "local_video.mp4"
    result = await save_video_from_url(url, save_path)
    if result:
        print(f"Видео сохранено в {result}")
    else:
        print("Не удалось сохранить видео")

# Запуск асинхронной функции
asyncio.run(main())
```

### `get_video_data`

```python
def get_video_data(file_name: str) -> Optional[bytes]:
    """Retrieve binary data of a video file if it exists.

    Args:
        file_name (str): The path to the video file to read.

    Returns:
        Optional[bytes]: The binary data of the file if it exists, or `None` if the file is not found or an error occurred.
    """
```

**Назначение**: Получает бинарные данные видеофайла, если он существует.

**Параметры**:
- `file_name` (str): Путь к видеофайлу для чтения.

**Возвращает**:
- `Optional[bytes]`: Бинарные данные файла, если он существует, или `None`, если файл не найден или произошла ошибка.

**Как работает функция**:

1.  **Инициализация**: Функция принимает имя файла видео.
2.  **Проверка существования файла**: Проверяется, существует ли файл по указанному пути. Если файл не существует, функция регистрирует ошибку и возвращает `None`.
3.  **Чтение файла**: Открывается файл в бинарном режиме для чтения.
4.  **Получение данных**: Считываются все данные из файла.
5.  **Обработка ошибок**:
    *   Если возникает ошибка при чтении файла, она регистрируется вместе с трассировкой, и возвращается `None`.
6.  **Возврат результата**: В случае успеха возвращаются бинарные данные файла.

```ascii
    Начало
    ↓
    → Проверка существования файла
    ↓
    → Открытие файла в бинарном режиме
    ↓
    → Чтение данных из файла
    ↓
    Конец
```

**Примеры**:

```python
# Пример успешного получения данных видео
data = get_video_data("local_video.mp4")
if data:
    print(f"Длина видео: {len(data)} байт")
else:
    print("Не удалось получить данные видео")

# Пример обработки отсутствия файла
data = get_video_data("nonexistent_video.mp4")
if data:
    print(f"Длина видео: {len(data)} байт")
else:
    print("Не удалось получить данные видео")
```

### `main`

```python
def main():
    url = "https://example.com/video.mp4"  # Replace with a valid URL!
    save_path = "local_video.mp4"
    result = asyncio.run(save_video_from_url(url, save_path))
    if result:
        print(f"Video saved to {result}")
```

**Назначение**: Главная функция, которая демонстрирует использование `save_video_from_url`.

**Как работает функция**:

1.  Определяет URL видео и путь для сохранения.
2.  Вызывает `save_video_from_url` для загрузки и сохранения видео.
3.  Выводит сообщение об успехе или неудаче операции.

## Примеры использования
В данном разделе содержатся примеры того, как использовать модуль для загрузки и сохранения видео файлов.
```python
import asyncio
from src.utils.video import save_video_from_url, get_video_data

async def main():
    # Пример загрузки видео по URL
    url = "https://example.com/video.mp4"  # Замените на актуальный URL
    save_path = "local_video.mp4"
    result = await save_video_from_url(url, save_path)
    if result:
        print(f"Видео сохранено в {result}")

    # Пример получения данных видеофайла
    data = get_video_data("local_video.mp4")
    if data:
        print(f"Длина видео: {len(data)} байт")

if __name__ == "__main__":
    asyncio.run(main())
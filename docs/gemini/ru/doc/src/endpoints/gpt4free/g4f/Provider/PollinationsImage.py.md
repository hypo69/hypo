# Модуль PollinationsImage

## Обзор

Модуль `PollinationsImage` предоставляет класс `PollinationsImage`, который является подклассом класса `PollinationsAI`. Этот класс предназначен для работы с API Pollinations AI для генерации изображений. Он включает в себя функциональность для управления моделями изображений, создания асинхронных генераторов изображений и форматирования подсказок для моделей.

## Подробнее

Модуль управляет списком доступных моделей изображений, объединяя модели из родительского класса `PollinationsAI` и дополнительные модели, специфичные для класса `PollinationsImage`.  Также предоставляет асинхронный генератор для создания изображений на основе текстовых подсказок, используя API Pollinations AI.  Генератор поддерживает различные параметры, такие как пропорции, размеры, seed и настройки безопасности. Модуль предназначен для упрощения процесса создания изображений с использованием моделей Pollinations AI.

## Классы

### `PollinationsImage`

**Описание**: Класс `PollinationsImage` предназначен для взаимодействия с API Pollinations AI для генерации изображений. Он наследует функциональность от класса `PollinationsAI` и добавляет специфические методы и атрибуты для работы с моделями изображений.

**Наследует**:

- `PollinationsAI`: Класс, предоставляющий базовую функциональность для взаимодействия с API Pollinations AI.

**Атрибуты**:

- `label` (str): Метка класса, используемая для идентификации провайдера ("PollinationsImage").
- `default_model` (str): Модель, используемая по умолчанию ("flux").
- `default_vision_model` (None): Модель компьютерного зрения, используемая по умолчанию (None).
- `default_image_model` (str): Модель изображения, используемая по умолчанию (совпадает с `default_model`).
- `image_models` (List[str]): Список поддерживаемых моделей изображений, содержащий `default_image_model`.
- `_models_loaded` (bool): Флаг, указывающий, были ли загружены модели (изначально `False`).
- `extra_image_models` (List[str]): Список дополнительных моделей изображений.

**Методы**:

- `get_models(**kwargs)`: Получает список доступных моделей изображений.
- `create_async_generator(...)`: Создает асинхронный генератор для создания изображений на основе текстовых подсказок.

## Функции

### `get_models`

```python
    @classmethod
    def get_models(cls, **kwargs):
        """Получает список доступных моделей изображений, объединяя модели из родительского класса и дополнительные модели.

        Args:
            **kwargs: Дополнительные аргументы, которые могут быть переданы в функцию.

        Returns:
            List[str]: Список доступных моделей изображений.

        Как работает функция:
        1. Проверяет, загружены ли модели (`cls._models_loaded`).
        2. Если модели не загружены, вызывает метод `get_models` родительского класса (`super().get_models()`).
        3. Объединяет модели из `cls.image_models`, `PollinationsAI.image_models` и `cls.extra_image_models`, удаляя дубликаты.
        4. Устанавливает флаг `cls._models_loaded` в `True`.
        5. Возвращает список моделей изображений (`cls.image_models`).
        """
```

**Назначение**: Получение списка доступных моделей изображений, объединяя модели из родительского класса и дополнительные модели.

```
    Проверка загрузки моделей
    │
    └──→ Вызов super().get_models() если модели не загружены
         │
         └──→ Объединение моделей из разных списков с удалением дубликатов
              │
              └──→ Установка флага _models_loaded в True
                   │
                   └──→ Возврат списка моделей изображений
```

**Примеры**:

```python
PollinationsImage.get_models()
```

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        prompt: str = None,
        aspect_ratio: str = "1:1",
        width: int = None,
        height: int = None,
        seed: Optional[int] = None,
        cache: bool = False,
        nologo: bool = True,
        private: bool = False,
        enhance: bool = False,
        safe: bool = False,
        n: int = 4,
        **kwargs
    ) -> AsyncResult:
        """Создает асинхронный генератор для создания изображений на основе текстовых подсказок.

        Args:
            model (str): Модель для генерации изображения.
            messages (Messages): Сообщения для формирования подсказки.
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
            prompt (str, optional): Дополнительная подсказка. По умолчанию `None`.
            aspect_ratio (str, optional): Соотношение сторон изображения. По умолчанию "1:1".
            width (int, optional): Ширина изображения. По умолчанию `None`.
            height (int, optional): Высота изображения. По умолчанию `None`.
            seed (Optional[int], optional): Seed для генерации изображения. По умолчанию `None`.
            cache (bool, optional): Использовать кэш. По умолчанию `False`.
            nologo (bool, optional): Удалять логотип. По умолчанию `True`.
            private (bool, optional): Сделать изображение приватным. По умолчанию `False`.
            enhance (bool, optional): Улучшить изображение. По умолчанию `False`.
            safe (bool, optional): Безопасный режим. По умолчанию `False`.
            n (int, optional): Количество изображений для генерации. По умолчанию 4.
            **kwargs: Дополнительные аргументы, которые могут быть переданы в функцию.

        Yields:
            AsyncResult: Части сгенерированного изображения.

        Как работает функция:
        1. Вызывает `cls.get_models()` для обновления списка моделей.
        2. Запускает асинхронный генератор `cls._generate_image` с переданными параметрами.
        3. Форматирует подсказку с использованием `format_image_prompt(messages, prompt)`.
        4. Передает все параметры в `cls._generate_image`.
        5. Возвращает части сгенерированного изображения через yield.
        """
```

**Назначение**: Создает асинхронный генератор для создания изображений на основе текстовых подсказок.

```
    Вызов get_models() для обновления списка моделей
    │
    └──→ Запуск асинхронного генератора _generate_image
         │
         └──→ Форматирование подсказки с использованием format_image_prompt
              │
              └──→ Передача всех параметров в _generate_image
                   │
                   └──→ Генерация частей изображения и возврат через yield
```

**Примеры**:

```python
async for chunk in PollinationsImage.create_async_generator(model="test", messages="test"):
    print(chunk)
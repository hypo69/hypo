# Модуль для работы с Ylokh API (deprecated)

## Обзор

Модуль `Ylokh.py` предоставляет класс `Ylokh`, который является асинхронным генераторным провайдером для взаимодействия с API `chat.ylokh.xyz`. Он позволяет отправлять запросы к API и получать ответы в виде асинхронного генератора, что удобно для потоковой обработки данных. Модуль поддерживает модели `gpt-3.5-turbo` и имеет возможность сохранять историю сообщений.

## Подробней

Модуль `Ylokh` является частью устаревшего кода и, вероятно, больше не поддерживается или не рекомендуется к использованию в новых проектах. Он предоставляет способ взаимодействия с API `chat.ylokh.xyz` для получения ответов от языковой модели.

## Классы

### `Ylokh`

**Описание**: Класс `Ylokh` является асинхронным генераторным провайдером для взаимодействия с API `chat.ylokh.xyz`.

**Наследует**: `AsyncGeneratorProvider`

**Атрибуты**:
- `url` (str): URL API `chat.ylokh.xyz`.
- `working` (bool): Флаг, указывающий, работает ли провайдер.
- `supports_message_history` (bool): Флаг, указывающий, поддерживает ли провайдер историю сообщений.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий, поддерживает ли провайдер модель `gpt-3.5-turbo`.

#### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    stream: bool = True,
    proxy: str = None,
    timeout: int = 120,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для взаимодействия с API.

    Args:
        cls (Ylokh): Ссылка на класс.
        model (str): Имя модели для использования.
        messages (Messages): Список сообщений для отправки.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных. По умолчанию `True`.
        proxy (str): URL прокси-сервера для использования. По умолчанию `None`.
        timeout (int): Время ожидания ответа от API в секундах. По умолчанию `120`.
        **kwargs: Дополнительные аргументы для отправки в API.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий ответы от API.

    Raises:
        Exception: Если возникает ошибка при отправке запроса или обработке ответа.
    """
    ...
```

**Назначение**: Создает асинхронный генератор для взаимодействия с API `chat.ylokh.xyz`.

**Параметры**:
- `cls` (Ylokh): Ссылка на класс.
- `model` (str): Имя модели для использования.
- `messages` (Messages): Список сообщений для отправки.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных. По умолчанию `True`.
- `proxy` (str): URL прокси-сервера для использования. По умолчанию `None`.
- `timeout` (int): Время ожидания ответа от API в секундах. По умолчанию `120`.
- `**kwargs`: Дополнительные аргументы для отправки в API.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий ответы от API.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при отправке запроса или обработке ответа.

**Как работает функция**:
1. Функция `create_async_generator` принимает параметры, необходимые для взаимодействия с API `chat.ylokh.xyz`.
2. Определяются заголовки запроса, включающие URL источника и реферера.
3. Формируется полезная нагрузка (payload) запроса, включающая сообщения, модель, параметры температуры, штрафы за присутствие и частоту, а также флаг потоковой передачи данных.
4. Используется асинхронная сессия для отправки POST-запроса к API.
5. Если `stream` установлен в `True`, функция итерируется по строкам ответа, декодирует их и извлекает содержимое из JSON-формата. Затем содержимое передается через `yield`.
6. Если `stream` установлен в `False`, функция ожидает полного ответа в формате JSON и извлекает содержимое из него. Затем содержимое передается через `yield`.

```
  Начало
   ↓
  Установка параметров (модель, заголовки, данные)
   ↓
  Создание асинхронной сессии
   ↓
  Отправка POST-запроса к API
   ↓
  Проверка режима stream
   ├── True: Обработка потоковых данных
   │   ↓
   │   Итерация по строкам ответа
   │   ↓
   │   Декодирование и извлечение содержимого
   │   ↓
   │   Передача содержимого через yield
   │   ↓
   └── False: Обработка полного ответа
       ↓
       Получение JSON-ответа
       ↓
       Извлечение содержимого
       ↓
       Передача содержимого через yield
   ↓
  Конец
```

**Примеры**:

Пример вызова функции:

```python
messages = [{"role": "user", "content": "Hello, how are you?"}]
async for message in Ylokh.create_async_generator(model="gpt-3.5-turbo", messages=messages):
    print(message)
```
```python
messages = [{"role": "user", "content": "Привет, как дела?"}]
async for message in Ylokh.create_async_generator(model="gpt-3.5-turbo", messages=messages, stream = False, timeout=60):
    print(message)
```
```python
messages = [{"role": "user", "content": "Как мне отсортировать массив?"}]
async for message in Ylokh.create_async_generator(model="gpt-3.5-turbo", messages=messages, proxy = 'http://proxy.com:8080'):
    print(message)
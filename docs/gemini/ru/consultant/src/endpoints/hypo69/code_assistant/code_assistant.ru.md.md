# Анализ кода модуля `code_assistant.ru.md`

**Качество кода**
9
- Плюсы
    - Документ подробно описывает функциональность модуля `Code Assistant`, его структуру, возможности, примеры использования и параметры командной строки.
    - Описаны основные шаги работы, включая чтение файлов, загрузку промптов, обработку запросов и сохранение ответов.
    - Приведены примеры использования с разными ролями и моделями.
    - Документ содержит информацию о настройках исключений для файлов и директорий, логировании и зависимостях.
    - Документ структурирован, имеет оглавление.
- Минусы
    - Отсутствуют примеры кода для `json` файла конфигурации.
    - Нет явных инструкций по установке зависимостей.
    - Нет документации по формату файлов промптов.
    - Не указана структура сохраняемых файлов ответов.

**Рекомендации по улучшению**

1.  Добавить пример `settings.json` файла.
2.  Добавить инструкцию по установке зависимостей (pip install ...).
3.  Добавить формат файлов промптов.
4.  Добавить структуру файлов сохранения.
5.  Переписать описание ролей и исключений в RST-формат.
6.  Добавить информацию о том, как создавать новые роли.

**Оптимизированный код**

```markdown
.. module:: src.endpoints.hypo69.code_assistant

=========================================================================================

<TABLE >
<TR>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/readme.ru.md'>[Root ↑]</A>
</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/readme.ru.md'>src</A> \
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/readme.ru.md'>endpoints</A> \
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/readme.ru.md'>hypo69</A>

</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypo/blob/master/src/endpoints/hypo69/code_assistant/code_assistant.md'>English</A>
</TD>
</TR>
</TABLE>

# Code Assistant: Обучение модели коду проекта

## Описание

`Code Assistant` — инструмент для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода. 
Он выполняет задачи, такие как создание документации, проверка кода, и генерация тестов на основе кода из указанных файлов.

## Основные возможности

- **Чтение исходных файлов**: Чтение кода из файлов с расширениями `.py` и `README.MD` из указанных директорий.
- **Обработка с помощью моделей**: Отправка кода в модели для выполнения задач, таких как создание документации или проверка ошибок.
- **Генерация результатов**: Ответы моделей сохраняются в указанные директории для каждой роли.

## Структура проекта

- **Модели**: Используются модели **Gemini** и **OpenAI** для обработки запросов.
- **Промпты**: Программа читает промпты из файлов в директории `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Файлы**: Обрабатываются файлы с расширениями `.py` и `README.MD` в указанных стартовых директориях.

## Пример использования

### Запуск с настройками из JSON:

.. code-block:: bash

    python assistant.py --settings settings.json

### Запуск с явным указанием параметров:

.. code-block:: bash

    python assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2

### Пример для роли `code_checker`:

.. code-block:: bash

    python assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir

### Пример для модели `openai`:

.. code-block:: bash

    python assistant.py --role doc_writer --lang en --models openai

## Параметры командной строки

- `--settings`: Путь к JSON файлу с настройками. Загружает параметры из файла.
- `--role`: Роль модели для выполнения задачи (например, `doc_writer`, `code_checker`).
- `--lang`: Язык выполнения задачи (например, `ru` или `en`).
- `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
- `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

## Логика работы

1. **Чтение файлов**: Поиск файлов с расширениями `.py` и `README.MD` в указанных стартовых директориях.
2. **Загрузка промптов**: Загрузка файлов промптов для каждой роли и языка из директории `src/ai/prompts/developer/`.
3. **Обработка запросов**: Формирование запросов на основе загруженных файлов и отправка их в модели.
4. **Сохранение ответов**: Ответы от моделей сохраняются в директории, соответствующей роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Исключения

Настройка исключений для файлов и директорий с помощью параметров:

- `exclude_file_patterns`: Список регулярных выражений для исключения файлов.
- `exclude_dirs`: Список директорий для исключения.
- `exclude_files`: Список файлов для исключения.

## Логирование

Логи сохраняются с помощью библиотеки `logger` и содержат информацию о процессе обработки файлов и полученных ответах.

## Зависимости

- **Gemini API**: Требуется API-ключ для работы с моделью Gemini.
- **OpenAI API**: Требуется API-ключ для работы с моделью OpenAI.

.. note::

   Для работы с Gemini и OpenAI API требуется установить соответствующие библиотеки. 
   Рекомендуется использовать `pip install google-generativeai openai`

.. rubric:: Конфигурация ролей

   В файле `code_assistant.json` определяются роли, которые могут быть использованы:
   
   -   `roles`: Список активных ролей, которые могут быть использованы, например, `["code_checker", ...]`.
   -   `exclude-roles`: Список неактивных ролей, которые не будут использоваться.

.. rubric:: Переводы

   Для каждой роли необходимо добавить перевод в файл `translations/translations.json`.

.. rubric:: Системный промпт

   Для каждой роли необходимо создать системный промпт в `ai/prompts/develpoper`, 
   например, `doc_writer_en.md` для роли `doc_writer` на английском языке.

.. rubric:: Командная инструкция
   
   Для каждой роли нужно добавить инструкцию в `instructions/`.

.. rubric:: Структура сохраняемых файлов

   Ответы от моделей сохраняются в директории, соответствующей роли и модели.
   Например, для роли `doc_writer`, модели `gemini` и языка `ru`, файлы будут сохранены в директории `docs/raw_rst_from_gemini/ru/`.

   Структура:
    -   `docs/`:
        -   `raw_rst_from_<model>/`:
            -   `<lang>/`:
                -   `<filename_without_extension>.md`
```
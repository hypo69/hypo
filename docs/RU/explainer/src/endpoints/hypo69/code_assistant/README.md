# Code Assistant: Описание и функциональность

## <input code>

```[Русский](https://github.com/hypo69/hypo/blob/master/endpoints/hypo69/code_assistant/README.RU.MD)
# Code Assistant: Обучение модели коду проекта

## Описание

`Code Assistant` — инструмент для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода. Он выполняет задачи, такие как создание документации, проверка кода, и генерация тестов на основе кода из указанных файлов.

## Основные возможности

- **Чтение исходных файлов**: Чтение кода из файлов с расширениями `.py` и `README.MD` из указанных директорий.
- **Обработка с помощью моделей**: Отправка кода в модели для выполнения задач, таких как создание документации или проверка ошибок.
- **Генерация результатов**: Ответы моделей сохраняются в указанные директории для каждой роли.

## Структура проекта

- **Модели**: Используются модели **Gemini** и **OpenAI** для обработки запросов.
- **Промпты**: Программа читает промпты из файлов в директории `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Файлы**: Обрабатываются файлы с расширениями `.py` и `README.MD` в указанных стартовых директориях.

## Пример использования

### Запуск с настройками из JSON:

```bash
python assistant.py --settings settings.json
```

### Запуск с явным указанием параметров:

```bash
python assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

... (остальной пример кода)
```

## <algorithm>

**Блок-схема алгоритма:**

```mermaid
graph TD
    A[Получить параметры командной строки] --> B{Проверить корректность параметров};
    B -- Корректные параметры --> C[Загрузить настройки из settings.json (если указан)];
    B -- Некорректные параметры --> D[Вывести ошибку и завершить];
    C --> E[Сформировать список файлов для обработки];
    E --> F[Проверить исключения];
    F --> G[Считать промпты для заданной роли и языка];
    G --> H[Инициализировать модели (Gemini и/или OpenAI)];
    H --> I[Обработать каждый файл];
    I --> J[Сформировать запрос к модели];
    J --> K[Отправить запрос к модели];
    K --> L[Получить ответ от модели];
    L --> M[Обработать ответ];
    M --> N[Сохранить ответ в соответствующую директорию];
    N --> O[Логировать результат];
    O --> P[Завершить работу];


    subgraph Проверка исключений
        F -- Включены исключения --> F1[Исключить файлы/директории];
        F1 --> E;
    end
```

**Примеры:**

- **Входные данные:** `--role doc_writer --lang ru --models gemini --start_dirs /path/to/dir`.
- **Процесс:** Алгоритм собирает все файлы .py и README.md в указанной директории, загружает промпты для doc_writer на русском языке, инициализирует Gemini. Для каждого файла генерируется запрос к модели, ответ сохраняется в директорию `docs/raw_rst_from_gemini/ru/`.
- **Выходные данные:** Сохраненные файлы с результатами обработки.

## <mermaid>

```mermaid
graph LR
    A[assistant.py] --> B(Чтение параметров);
    B --> C{Загрузка настроек (settings.json)};
    C --> D[Инициализация моделей (Gemini, OpenAI)];
    D --> E[Чтение файлов (py, README.md) в указанных директориях];
    E --> F[Проверка исключений];
    F --> G[Чтение промптов (src/ai/prompts)];
    G --> H[Обработка каждого файла];
    H --> I[Формирование запроса к модели];
    I --> J[Запрос к модели];
    J --> K[Ответ от модели];
    K --> L[Сохранение ответа в директорию];
    L --> M[Логирование];
    M --> N[Завершение работы];

    subgraph "Зависимости"
        D --> O[Gemini API];
        D --> P[OpenAI API];
        G --> Q[src/ai/prompts];
        L --> R[src/endpoints/hypo69/code_assistant];
    end
```


## <explanation>

**Импорты:**

Нет импортируемого кода в описании.  Должны быть импорты для работы с файлами, обработкой командной строки,  для  работы с моделями Gemini и OpenAI.

**Классы:**

В описании нет классов.  Возможно, в реализации есть классы для работы с моделями (Gemini, OpenAI),  для управления файлами и  для хранения конфигурации.

**Функции:**

Функции для чтения и обработки файлов (файловая система), работы с командной строкой (argparse),  инициализации моделей, формирования запросов, отправки запросов, обработки ответов, сохранения результатов, и логирования.


**Переменные:**

Переменные для хранения параметров командной строки, путей к файлам, настроек, промптов,  и результатов обработки файлов.


**Возможные ошибки и улучшения:**

* **Отсутствие проверки ошибок:**  Алгоритм не описывает проверку на ошибки при чтении файлов, загрузке промптов, запросах к моделям,  обработке ответов,  и  сохранении результатов.  Это может привести к скрытым ошибкам.
* **Управление ресурсами:**  Алгоритм не описывает, как освобождаются ресурсы, использованные моделями (Gemini/OpenAI).
* **Обработка исключений:** Нужно добавить обработку исключений (например, ошибки при чтении файлов,  сохранении,  отсутствии файлов).
* **Модульное тестирование:** Важно обеспечить модульное тестирование функций для проверки правильности обработки каждого этапа.
* **Отсутствие информации о структуре данных**: Нет описания структуры данных, используемых в коде.

**Цепочка взаимосвязей:**

`assistant.py` (скрипт) взаимодействует с  `settings.json` (настройки),  `src/ai/prompts/developer` (файлы с промптами),  моделями Gemini/OpenAI, файловой системой и библиотекой для логов.


**Примечания:**

Подробный анализ требует доступа к фактическому коду `assistant.py`, чтобы проанализировать его структуру и детали работы.
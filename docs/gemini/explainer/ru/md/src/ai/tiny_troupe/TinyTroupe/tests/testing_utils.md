# Объяснение кода из файла `testing_utils.py`

Этот файл содержит вспомогательные функции для тестирования кода проекта `tinytroupe`. Он предоставляет инструменты для проверки различных аспектов работы агентов и среды, в том числе взаимодействия с API OpenAI.

**Основные функции и их назначение:**

* **`contains_action_type(actions, action_type)`:** Проверяет, содержит ли список `actions` действие заданного типа `action_type`.
* **`contains_action_content(actions, action_content)`:** Проверяет, содержит ли список `actions` действие с заданным содержимым `action_content`.  Поиск выполняется с учётом регистра.
* **`contains_stimulus_type(stimuli, stimulus_type)`:** Проверяет, содержит ли список `stimuli` стимул заданного типа `stimulus_type`.
* **`contains_stimulus_content(stimuli, stimulus_content)`:** Проверяет, содержит ли список `stimuli` стимул с заданным содержимым `stimulus_content`. Поиск выполняется с учётом регистра.
* **`terminates_with_action_type(actions, action_type)`:** Проверяет, заканчивается ли список `actions` действием заданного типа `action_type`.
* **`proposition_holds(proposition)`:** Проверяет истинность заданной `proposition` с помощью вызова API OpenAI.  В системе задаётся чёткий запрос, а ответ (`true` или `false`) обрабатывается.  Используется для проверки сложных утверждений, не поддающихся автоматической проверке. Обратите внимание на использование `only_alphanumeric()` для очистки ответа.
* **`only_alphanumeric(string)`:** Возвращает строку, содержащую только буквенно-цифровые символы. Используется для очистки ответа от API OpenAI.
* **`create_test_system_user_message(user_prompt, system_prompt)`:** Создаёт список сообщений для взаимодействия с API OpenAI. Принимает необязательный `system_prompt` для добавления контекста и `user_prompt` для пользователя.
* **`agents_configs_are_equal(agent1, agent2, ignore_name)`:** Сравнивает конфигурации двух агентов `agent1` и `agent2`, с возможностью игнорирования поля `name`.
* **`remove_file_if_exists(file_path)`:** Удаляет файл по заданному пути, если он существует.
* **`get_relative_to_test_path(path_suffix)`:** Возвращает полный путь к файлу теста с заданным суффиксом.  Используется для относительных путей.
* **`focus_group_world` и `setup`:**  Это фикстуры (fixtures) для тестирования, используемые с `pytest`. `focus_group_world` создаёт тестовую среду, а `setup` очищает глобальные данные перед запуском каждого теста.


**Важные моменты:**

* **`force_api_cache(True, "tests_cache.pickle")`:**  В начале файла устанавливает кэширование ответов API OpenAI. Это важно для оптимизации тестов, которые могут использовать одни и те же запросы.
* **Импорт путей:**  `sys.path.append` добавляет пути к директориям проекта, чтобы скрипт мог импортировать необходимые модули.
* **Обработка ответов API OpenAI:** `only_alphanumeric` и проверка `startswith` на `true`/`false` демонстрируют строгую обработку возвращаемых значений API.
* **Использование `pytest`:**  Использование фикстур (`@pytest.fixture`) показывает, что код предназначен для интеграции с фреймворком `pytest`.

В целом, файл `testing_utils.py` содержит набор полезных функций для упрощения и стандартизации написания тестов для проекта `tinytroupe`.  Он позволяет сосредоточиться на проверяемых аспектах, избавляя от рутинных задач и обеспечивая надежность тестов.
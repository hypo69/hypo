# Модуль логирования `logger.py`

## Обзор

Модуль предоставляет класс `Logger`, реализующий паттерн Singleton для логирования сообщений в консоль, файлы и в формате JSON. Он позволяет настраивать уровни логирования, форматирование сообщений и цвета для консольного вывода. Модуль также включает поддержку записи информации об исключениях.

## Подробней

Этот модуль предназначен для централизованного управления логированием в проекте `hypotez`. Он обеспечивает гибкую настройку логирования, позволяя записывать сообщения разных уровней важности в различные источники: консоль, отдельные файлы для информации, отладки и ошибок, а также в JSON-файл для последующего анализа.
`Logger` использует паттерн Singleton, гарантируя, что в приложении будет только один экземпляр класса, что упрощает управление и координацию логирования.
Использование цветов в консольном выводе облегчает визуальное восприятие сообщений разного типа.

## Содержание

- [Классы](#Классы)
  - [`SingletonMeta`](#SingletonMeta)
  - [`JsonFormatter`](#JsonFormatter)
  - [`Logger`](#Logger)
- [Переменные](#Переменные)
- [Функции](#Функции)
  - [`_format_message`](#_format_message)
  - [`_ex_full_info`](#_ex_full_info)
  - [`log`](#log)
  - [`info`](#info)
  - [`success`](#success)
  - [`warning`](#warning)
  - [`debug`](#debug)
  - [`exception`](#exception)
  - [`error`](#error)
  - [`critical`](#critical)

## Переменные

- `TEXT_COLORS (dict)`: Словарь, содержащий коды цветов текста для использования в консольном выводе.
- `BG_COLORS (dict)`: Словарь, содержащий коды цветов фона для использования в консольном выводе.
- `LOG_SYMBOLS (dict)`: Словарь, содержащий символы, соответствующие различным уровням логирования.
- `logger (Logger)`: Экземпляр класса `Logger`, используемый для логирования сообщений.

## Классы

### `SingletonMeta`

**Описание**: Метакласс, реализующий паттерн Singleton.

**Как работает класс**:
Метакласс `SingletonMeta` гарантирует, что у класса будет только один экземпляр. При первом вызове класса создается экземпляр, который сохраняется в `_instances`. При последующих вызовах возвращается сохраненный экземпляр. Это достигается за счет использования блокировки `_lock` для обеспечения потокобезопасности.

### `JsonFormatter`

**Описание**: Кастомный форматтер для логирования в формате JSON.

**Как работает класс**:
Класс `JsonFormatter` используется для форматирования записей лога в формат JSON. Он переопределяет метод `format`, чтобы преобразовать запись лога в словарь, который затем сериализуется в JSON с помощью `json.dumps`.

#### `format`

```python
def format(self, record):
    """Format the log record as JSON."""
    ...
```

**Назначение**: Форматирует запись лога в формат JSON.

**Как работает функция**:
Метод `format` принимает запись лога `record`, извлекает из нее необходимые данные (время, уровень, сообщение, информация об исключении) и формирует словарь `log_entry`. Затем этот словарь преобразуется в JSON-строку с помощью `json.dumps`, при этом обеспечивается корректное отображение русских символов (`ensure_ascii=False`).

**Параметры**:
- `record (logging.LogRecord)`: Запись лога, которую необходимо отформатировать.

**Возвращает**:
- `str`: JSON-представление записи лога.

### `Logger`

**Описание**: Класс Logger, реализующий паттерн Singleton с логированием в консоль, файл и JSON.

**Как работает класс**:
Класс `Logger` реализует паттерн Singleton, гарантируя, что в приложении будет только один экземпляр логгера. Он настраивает несколько логгеров: для консоли, для записи информации в файл, для отладочных сообщений в файл, для ошибок в файл и для записи в JSON-файл.
Пути к файлам логов определяются на основе конфигурационного файла `config.json` и текущей метки времени.
Для JSON-логирования используется кастомный форматтер `JsonFormatter`.

**Методы**:
- `__init__`: Инициализирует экземпляр логгера.
- `_format_message`: Форматирует сообщение для логирования с учетом уровня логирования, цвета и информации об исключении.
- `_ex_full_info`: Возвращает полную информацию об исключении, включая имя файла, функцию и номер строки, где произошло исключение.
- `log`: Общий метод для логирования сообщений на указанном уровне.
- `info`: Логирует информационное сообщение.
- `success`: Логирует сообщение об успехе.
- `warning`: Логирует предупреждение.
- `debug`: Логирует отладочное сообщение.
- `exception`: Логирует сообщение об исключении.
- `error`: Логирует сообщение об ошибке.
- `critical`: Логирует критическое сообщение.

#### `__init__`

```python
def __init__(
    self,
    info_log_path: Optional[str] = None,
    debug_log_path: Optional[str] = None,
    errors_log_path: Optional[str] = None,
    json_log_path: Optional[str] = None,
):
    """Initialize the Logger instance."""
    ...
```

**Назначение**: Инициализирует экземпляр класса `Logger`.

**Как работает функция**:
Метод `__init__` инициализирует пути к файлам логов на основе конфигурации из файла `config.json` и текущей временной метки. Он создает необходимые директории и файлы логов, а также настраивает логгеры для консоли и файлов, устанавливая уровни логирования и форматтеры.
Для каждого типа лога (информация, отладка, ошибки, JSON) создается свой логгер и обработчик, которые добавляются к соответствующему логгеру.

**Параметры**:
- `info_log_path (Optional[str], optional)`: Путь к файлу для информационных логов. По умолчанию `None`.
- `debug_log_path (Optional[str], optional)`: Путь к файлу для отладочных логов. По умолчанию `None`.
- `errors_log_path (Optional[str], optional)`: Путь к файлу для логов ошибок. По умолчанию `None`.
- `json_log_path (Optional[str], optional)`: Путь к файлу для JSON-логов. По умолчанию `None`.

#### `_format_message`

```python
def _format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None):
    """Returns formatted message with optional color and exception information."""
    ...
```

**Назначение**: Форматирует сообщение лога с учетом уровня логирования, цвета и информации об исключении.

**Как работает функция**:
Метод `_format_message` принимает сообщение, информацию об исключении (если есть), кортеж цветов (текст, фон) и уровень логирования. Он формирует отформатированное сообщение, добавляя к нему символ, соответствующий уровню логирования, цвета (если указаны) и информацию об исключении (если есть).

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `color (Optional[Tuple[str, str]], optional)`: Кортеж, содержащий цвет текста и фона. По умолчанию `None`.
- `level (int, optional)`: Уровень логирования. По умолчанию `None`.

**Возвращает**:
- `str`: Отформатированное сообщение для логирования.

#### `_ex_full_info`

```python
def _ex_full_info(self, ex):
    """Returns full exception information along with the previous function, file, and line details."""
    ...
```

**Назначение**: Возвращает полную информацию об исключении, включая имя файла, функцию и номер строки, где произошло исключение.

**Как работает функция**:
Метод `_ex_full_info` использует модуль `inspect` для получения информации о стеке вызовов. Он извлекает имя файла, имя функции и номер строки, где произошло исключение, и формирует строку с этой информацией.

**Параметры**:
- `ex (Exception)`: Объект исключения.

**Возвращает**:
- `str`: Строка с полной информацией об исключении.

#### `log`

```python
def log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None):
    """General method to log messages at specified level with optional color."""
    ...
```

**Назначение**: Общий метод для логирования сообщений на указанном уровне с возможностью добавления цвета.

**Как работает функция**:
Метод `log` принимает уровень логирования, сообщение, информацию об исключении и цвет. Он вызывает метод `_format_message` для форматирования сообщения и затем передает отформатированное сообщение в логгер консоли.

**Параметры**:
- `level (int)`: Уровень логирования (например, `logging.INFO`, `logging.ERROR`).
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `color (Optional[Tuple[str, str]], optional)`: Кортеж, содержащий цвет текста и фона. По умолчанию `None`.

#### `info`

```python
def info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = ""):
    """Logs an info message with optional text and background colors."""
    ...
```

**Назначение**: Логирует информационное сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `info` вызывает метод `log` с уровнем логирования `logging.INFO` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"green"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

#### `success`

```python
def success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = ""):
    """Logs a success message with optional text and background colors."""
    ...
```

**Назначение**: Логирует сообщение об успехе с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `success` вызывает метод `log` с уровнем логирования `logging.INFO` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"yellow"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

#### `warning`

```python
def warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = ""):
    """Logs a warning message with optional text and background colors."""
    ...
```

**Назначение**: Логирует предупреждение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `warning` вызывает метод `log` с уровнем логирования `logging.WARNING` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"light_red"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

#### `debug`

```python
def debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = ""):
    """Logs a debug message with optional text and background colors."""
    ...
```

**Назначение**: Логирует отладочное сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `debug` вызывает метод `log` с уровнем логирования `logging.DEBUG` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"cyan"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

#### `exception`

```python
def exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray"):
    """Logs an exception message with optional text and background colors."""
    ...
```

**Назначение**: Логирует сообщение об исключении с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `exception` вызывает метод `log` с уровнем логирования `logging.ERROR` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"cyan"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `"light_gray"`.

#### `error`

```python
def error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = ""):
    """Logs an error message with optional text and background colors."""
    ...
```

**Назначение**: Логирует сообщение об ошибке с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `error` вызывает метод `log` с уровнем логирования `logging.ERROR` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"red"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

#### `critical`

```python
def critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white"):
    """Logs a critical message with optional text and background colors."""
    ...
```

**Назначение**: Логирует критическое сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `critical` вызывает метод `log` с уровнем логирования `logging.CRITICAL` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"red"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `"white"`.

## Функции

### `_format_message`

```python
def _format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None):
    """Returns formatted message with optional color and exception information."""
    ...
```

**Назначение**: Форматирует сообщение лога с учетом уровня логирования, цвета и информации об исключении.

**Как работает функция**:
Метод `_format_message` принимает сообщение, информацию об исключении (если есть), кортеж цветов (текст, фон) и уровень логирования. Он формирует отформатированное сообщение, добавляя к нему символ, соответствующий уровню логирования, цвета (если указаны) и информацию об исключении (если есть).

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `color (Optional[Tuple[str, str]], optional)`: Кортеж, содержащий цвет текста и фона. По умолчанию `None`.
- `level (int, optional)`: Уровень логирования. По умолчанию `None`.

**Возвращает**:
- `str`: Отформатированное сообщение для логирования.

### `_ex_full_info`

```python
def _ex_full_info(self, ex):
    """Returns full exception information along with the previous function, file, and line details."""
    ...
```

**Назначение**: Возвращает полную информацию об исключении, включая имя файла, функцию и номер строки, где произошло исключение.

**Как работает функция**:
Метод `_ex_full_info` использует модуль `inspect` для получения информации о стеке вызовов. Он извлекает имя файла, имя функции и номер строки, где произошло исключение, и формирует строку с этой информацией.

**Параметры**:
- `ex (Exception)`: Объект исключения.

**Возвращает**:
- `str`: Строка с полной информацией об исключении.

### `log`

```python
def log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None):
    """General method to log messages at specified level with optional color."""
    ...
```

**Назначение**: Общий метод для логирования сообщений на указанном уровне с возможностью добавления цвета.

**Как работает функция**:
Метод `log` принимает уровень логирования, сообщение, информацию об исключении и цвет. Он вызывает метод `_format_message` для форматирования сообщения и затем передает отформатированное сообщение в логгер консоли.

**Параметры**:
- `level (int)`: Уровень логирования (например, `logging.INFO`, `logging.ERROR`).
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `color (Optional[Tuple[str, str]], optional)`: Кортеж, содержащий цвет текста и фона. По умолчанию `None`.

### `info`

```python
def info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = ""):
    """Logs an info message with optional text and background colors."""
    ...
```

**Назначение**: Логирует информационное сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `info` вызывает метод `log` с уровнем логирования `logging.INFO` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"green"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

### `success`

```python
def success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = ""):
    """Logs a success message with optional text and background colors."""
    ...
```

**Назначение**: Логирует сообщение об успехе с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `success` вызывает метод `log` с уровнем логирования `logging.INFO` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"yellow"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

### `warning`

```python
def warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = ""):
    """Logs a warning message with optional text and background colors."""
    ...
```

**Назначение**: Логирует предупреждение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `warning` вызывает метод `log` с уровнем логирования `logging.WARNING` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `False`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"light_red"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

### `debug`

```python
def debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = ""):
    """Logs a debug message with optional text and background colors."""
    ...
```

**Назначение**: Логирует отладочное сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `debug` вызывает метод `log` с уровнем логирования `logging.DEBUG` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"cyan"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

### `exception`

```python
def exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray"):
    """Logs an exception message with optional text and background colors."""
    ...
```

**Назначение**: Логирует сообщение об исключении с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `exception` вызывает метод `log` с уровнем логирования `logging.ERROR` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"cyan"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `"light_gray"`.

### `error`

```python
def error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = ""):
    """Logs an error message with optional text and background colors."""
    ...
```

**Назначение**: Логирует сообщение об ошибке с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `error` вызывает метод `log` с уровнем логирования `logging.ERROR` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"red"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

### `critical`

```python
def critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white"):
    """Logs a critical message with optional text and background colors."""
    ...
```

**Назначение**: Логирует критическое сообщение с возможностью указания цвета текста и фона.

**Как работает функция**:
Метод `critical` вызывает метод `log` с уровнем логирования `logging.CRITICAL` и передает ему сообщение, информацию об исключении и цвет.

**Параметры**:
- `message (str)`: Сообщение для логирования.
- `ex (Exception, optional)`: Информация об исключении. По умолчанию `None`.
- `exc_info (bool, optional)`: Флаг, указывающий, нужно ли добавлять информацию об исключении в лог. По умолчанию `True`.
- `text_color (str, optional)`: Цвет текста. По умолчанию `"red"`.
- `bg_color (str, optional)`: Цвет фона. По умолчанию `"white"`.
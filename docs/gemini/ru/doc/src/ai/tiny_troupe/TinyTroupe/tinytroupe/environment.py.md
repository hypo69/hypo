# Модуль `environment.py`

## Обзор

Этот модуль определяет окружение (`Environment`) для взаимодействия агентов, включая базовый класс `TinyWorld` и его производный класс `TinySocialNetwork`. Он предоставляет структуру для моделирования мира, в котором агенты могут взаимодействовать друг с другом и с внешними сущностями.

## Оглавление

1.  [Классы](#классы)
    -   [TinyWorld](#tinyworld)
        -   [Методы](#методы-tinyworld)
    -   [TinySocialNetwork](#tinysocialnetwork)
        -   [Методы](#методы-tinysocialnetwork)
2.  [Функции](#функции)
    -   [Нет](#функции)

## Классы

### `TinyWorld`

**Описание**: Базовый класс для окружений.

#### Методы `TinyWorld`

##### `__init__`

**Описание**: Инициализирует окружение.

**Параметры**:

*   `name` (str): Имя окружения.
*   `agents` (list): Список агентов для добавления в окружение.
*   `initial_datetime` (datetime): Начальное время окружения, по умолчанию текущее время.
*   `broadcast_if_no_target` (bool): Если `True`, то действия будут транслироваться, если цель действия не найдена.

##### `_step`

**Описание**: Выполняет один шаг в окружении.

**Параметры**:
    * `timedelta_per_step` (timedelta, optional):  Временной интервал между шагами.

##### `_advance_datetime`

**Описание**: Увеличивает текущее время окружения на указанный интервал.

**Параметры**:
    * `timedelta` (timedelta): Временной интервал, на который нужно сдвинуть время.

##### `run`

**Описание**: Запускает окружение на заданное количество шагов.

**Параметры**:
*   `steps` (int): Количество шагов для запуска окружения.
*   `timedelta_per_step` (timedelta, optional): Временной интервал между шагами. По умолчанию `None`.
*   `return_actions` (bool, optional): Если `True`, возвращает действия, предпринятые агентами. По умолчанию `False`.

**Возвращает**:
    * `list`: Список действий, предпринятых агентами за время, если `return_actions` имеет значение True.

##### `skip`

**Описание**: Пропускает заданное количество шагов в окружении.

**Параметры**:
*   `steps` (int): Количество шагов для пропуска.
*   `timedelta_per_step` (timedelta, optional): Временной интервал между шагами. По умолчанию `None`.

##### `run_minutes`

**Описание**: Запускает окружение на заданное количество минут.

**Параметры**:
    * `minutes` (int): Количество минут для запуска окружения.

##### `skip_minutes`

**Описание**: Пропускает заданное количество минут в окружении.

**Параметры**:
    * `minutes` (int): Количество минут для пропуска.

##### `run_hours`

**Описание**: Запускает окружение на заданное количество часов.

**Параметры**:
    * `hours` (int): Количество часов для запуска окружения.

##### `skip_hours`

**Описание**: Пропускает заданное количество часов в окружении.

**Параметры**:
    * `hours` (int): Количество часов для пропуска.

##### `run_days`

**Описание**: Запускает окружение на заданное количество дней.

**Параметры**:
    * `days` (int): Количество дней для запуска окружения.

##### `skip_days`

**Описание**: Пропускает заданное количество дней в окружении.

**Параметры**:
    * `days` (int): Количество дней для пропуска.

##### `run_weeks`

**Описание**: Запускает окружение на заданное количество недель.

**Параметры**:
    * `weeks` (int): Количество недель для запуска окружения.

##### `skip_weeks`

**Описание**: Пропускает заданное количество недель в окружении.

**Параметры**:
    * `weeks` (int): Количество недель для пропуска.

##### `run_months`

**Описание**: Запускает окружение на заданное количество месяцев.

**Параметры**:
    * `months` (int): Количество месяцев для запуска окружения.

##### `skip_months`

**Описание**: Пропускает заданное количество месяцев в окружении.

**Параметры**:
    * `months` (int): Количество месяцев для пропуска.

##### `run_years`

**Описание**: Запускает окружение на заданное количество лет.

**Параметры**:
    * `years` (int): Количество лет для запуска окружения.

##### `skip_years`

**Описание**: Пропускает заданное количество лет в окружении.

**Параметры**:
    * `years` (int): Количество лет для пропуска.

##### `add_agents`

**Описание**: Добавляет список агентов в окружение.

**Параметры**:
    * `agents` (list): Список агентов для добавления.

**Возвращает**:
    * `Self`: Возвращает `self` для объединения вызовов в цепочку.

##### `add_agent`

**Описание**: Добавляет агента в окружение.

**Параметры**:
    * `agent` (`TinyPerson`): Агент для добавления.

**Вызывает исключения**:
* `ValueError`: Если имя агента не является уникальным в окружении.

**Возвращает**:
    * `Self`: Возвращает `self` для объединения вызовов в цепочку.

##### `remove_agent`

**Описание**: Удаляет агента из окружения.

**Параметры**:
    * `agent` (`TinyPerson`): Агент для удаления.

**Возвращает**:
    * `Self`: Возвращает `self` для объединения вызовов в цепочку.

##### `remove_all_agents`

**Описание**: Удаляет всех агентов из окружения.

**Возвращает**:
    * `Self`: Возвращает `self` для объединения вызовов в цепочку.

##### `get_agent_by_name`

**Описание**: Возвращает агента по его имени.

**Параметры**:
    * `name` (str): Имя агента.

**Возвращает**:
    * `TinyPerson`: Агент с указанным именем или `None`, если агент не найден.

##### `_handle_actions`

**Описание**: Обрабатывает действия, выданные агентами.

**Параметры**:
*   `source` (`TinyPerson`): Агент, который выдал действие.
*   `actions` (list): Список действий, выданных агентами.

##### `_handle_reach_out`

**Описание**: Обрабатывает действие `REACH_OUT`.

**Параметры**:
*   `source_agent` (`TinyPerson`): Агент, который выдал действие `REACH_OUT`.
*   `content` (str): Содержание сообщения.
*  `target` (str): Цель сообщения.

##### `_handle_talk`

**Описание**: Обрабатывает действие `TALK`.

**Параметры**:
*   `source_agent` (`TinyPerson`): Агент, который выдал действие `TALK`.
*   `content` (str): Содержание сообщения.
*   `target` (str, optional): Цель сообщения.

##### `broadcast`

**Описание**: Доставляет сообщение всем агентам в окружении.

**Параметры**:
*   `speech` (str): Содержание сообщения.
*   `source` (`AgentOrWorld`, optional): Агент или окружение, которое выдало сообщение. По умолчанию `None`.

##### `broadcast_thought`

**Описание**: Рассылает мысль всем агентам в окружении.

**Параметры**:
*   `thought` (str): Содержание мысли.
*   `source` (`AgentOrWorld`, optional): Агент или окружение, которое выдало мысль. По умолчанию `None`.

##### `broadcast_internal_goal`

**Описание**: Рассылает внутреннюю цель всем агентам в окружении.

**Параметры**:
    * `internal_goal` (str): Содержание внутренней цели.

##### `broadcast_context_change`

**Описание**: Рассылает изменение контекста всем агентам в окружении.

**Параметры**:
    * `context` (list): Содержание изменения контекста.

##### `make_everyone_accessible`

**Описание**: Делает всех агентов в окружении доступными друг для друга.

##### `_display_communication`

**Описание**: Выводит текущее взаимодействие и сохраняет его в буфере для дальнейшего использования.

**Параметры**:
*   `cur_step` (int): Номер текущего шага.
*   `total_steps` (int): Общее количество шагов.
*   `kind` (str): Тип сообщения (например, "step").
*   `timedelta_per_step` (timedelta, optional):  Временной интервал между шагами.

##### `_push_and_display_latest_communication`

**Описание**: Добавляет последнее сообщение в буфер агента.

**Параметры**:
    * `rendering` (dict): Сообщение для добавления в буфер.

##### `pop_and_display_latest_communications`

**Описание**: Извлекает последние сообщения и отображает их.

**Возвращает**:
    * `list`: Список сообщений.

##### `_display`

**Описание**: Отображает сообщение.

**Параметры**:
    * `communication` (dict): Сообщение для отображения.

##### `clear_communications_buffer`

**Описание**: Очищает буфер сообщений.

##### `__repr__`

**Описание**: Возвращает строковое представление объекта `TinyWorld`.

**Возвращает**:
*   `str`: Строковое представление объекта.

##### `_pretty_step`

**Описание**: Форматирует вывод текущего шага.

**Параметры**:
*   `cur_step` (int): Номер текущего шага.
*   `total_steps` (int): Общее количество шагов.
*    `timedelta_per_step` (timedelta, optional): Временной интервал между шагами.

**Возвращает**:
*   `str`: Отформатированная строка.

##### `pp_current_interactions`

**Описание**: Выводит в консоль текущие взаимодействия агентов в этом окружении.

**Параметры**:
    * `simplified` (bool, optional): Если `True`, то вывод будет упрощенным. По умолчанию `True`.
    * `skip_system` (bool, optional): Если `True`, то системные сообщения будут пропущены. По умолчанию `True`.

##### `pretty_current_interactions`

**Описание**: Возвращает строку с текущими сообщениями агентов в этом окружении.

**Параметры**:
*   `simplified` (bool, optional): Если `True`, то вывод будет упрощенным. По умолчанию `True`.
*   `skip_system` (bool, optional): Если `True`, то системные сообщения будут пропущены. По умолчанию `True`.
*   `max_content_length` (int, optional): Максимальная длина отображаемого содержимого. По умолчанию значение из `default["max_content_display_length"]`.
*  `first_n` (int, optional): Количество первых сообщений для вывода.
*   `last_n` (int, optional): Количество последних сообщений для вывода.
*   `include_omission_info` (bool, optional): Если `True`, то выводится информация о пропущенных сообщениях. По умолчанию `True`.

**Возвращает**:
*   `str`: Строка с текущими сообщениями агентов.

##### `encode_complete_state`

**Описание**: Кодирует полное состояние окружения в словарь.

**Возвращает**:
    * `dict`: Словарь, кодирующий полное состояние окружения.

##### `decode_complete_state`

**Описание**: Декодирует полное состояние окружения из словаря.

**Параметры**:
    * `state` (dict): Словарь, кодирующий полное состояние окружения.

**Возвращает**:
    * `Self`: Окружение, декодированное из словаря.

**Вызывает исключения**:
* `ValueError`: Если невозможно декодировать агента или окружение.

##### `add_environment`

**Описание**: Добавляет окружение в список всех окружений.

**Параметры**:
    * `environment` (`TinyWorld`): Окружение для добавления.

**Вызывает исключения**:
* `ValueError`: Если имя окружения не является уникальным.

##### `set_simulation_for_free_environments`

**Описание**: Устанавливает симуляцию, если она `None`.

**Параметры**:
    * `simulation` (`Simulation`): Симуляция для установки.

##### `get_environment_by_name`

**Описание**: Возвращает окружение по его имени.

**Параметры**:
    * `name` (str): Имя окружения.

**Возвращает**:
    * `TinyWorld`: Окружение с указанным именем или `None`, если окружение не найдено.

##### `clear_environments`

**Описание**: Очищает список всех окружений.

### `TinySocialNetwork`

**Описание**: Подкласс `TinyWorld`, представляющий социальную сеть.

#### Методы `TinySocialNetwork`

##### `__init__`

**Описание**: Создает новое окружение `TinySocialNetwork`.

**Параметры**:
*   `name` (str): Имя окружения.
*   `broadcast_if_no_target` (bool): Если `True`, то действия будут транслироваться через доступные отношения агента, если цель действия не найдена.

##### `add_relation`

**Описание**: Добавляет отношение между двумя агентами.

**Параметры**:
*   `agent_1` (`TinyPerson`): Первый агент.
*   `agent_2` (`TinyPerson`): Второй агент.
*   `name` (str, optional): Имя отношения. По умолчанию "default".

**Возвращает**:
    * `Self`: Возвращает `self` для объединения вызовов в цепочку.

##### `_update_agents_contexts`

**Описание**: Обновляет наблюдения агентов на основе текущего состояния мира.

##### `_step`

**Описание**: Выполняет один шаг в окружении. Обновляет контексты агентов перед вызовом базового метода `_step`.

##### `_handle_reach_out`

**Описание**: Обрабатывает действие `REACH_OUT`.

**Параметры**:
*   `source_agent` (`TinyPerson`): Агент, который выдал действие `REACH_OUT`.
*   `content` (str): Содержание сообщения.
*   `target` (str): Цель сообщения.

##### `is_in_relation_with`

**Описание**: Проверяет, находятся ли два агента в отношении.

**Параметры**:
*   `agent_1` (`TinyPerson`): Первый агент.
*   `agent_2` (`TinyPerson`): Второй агент.
*   `relation_name` (str, optional): Имя отношения для проверки или `None`, чтобы проверить любое отношение.

**Возвращает**:
    * `bool`: `True`, если два агента находятся в отношении, иначе `False`.

## Функции

### Нет
# Модуль hypotez/src/suppliers/aliexpress/api/_examples/iop/base.py

## Обзор

Этот модуль предоставляет базовые классы и функции для работы с API AliExpress (IOP). Он обеспечивает инструменты для формирования запросов, обработки ответов и логирования ошибок. Модуль содержит классы для создания и отправки запросов, обработки ответов, а также функции для генерации подписей и логирования ошибок.

## Классы

### `IopRequest`

**Описание**: Класс для создания запросов к API. Позволяет добавлять параметры запроса и файлы.

**Методы**:

- `add_api_param(key, value)`: Добавляет параметр к запросу.
- `add_file_param(key, value)`: Добавляет параметр файла к запросу.
- `set_simplify()`: Устанавливает параметр `simplify` в значение `true`.
- `set_format(value)`: Устанавливает формат ответа (например, `json`).

### `IopResponse`

**Описание**: Класс для обработки ответов от API. Хранит код ответа, тип ответа, сообщение об ошибке, идентификатор запроса и тело ответа.

**Методы**:

- `__str__(self, *args, **kwargs)`:  Возвращает строковое представление объекта `IopResponse`.

### `IopClient`

**Описание**: Класс для взаимодействия с API.  Обеспечивает отправку запросов, обработку ответов и логирование ошибок.

**Методы**:

- `__init__(self, server_url, app_key, app_secret, timeout=30)`: Инициализирует клиента с указанием URL сервера, ключа приложения, секрета приложения и таймаута запроса.
- `execute(self, request, access_token=None)`: Отправляет запрос к API и обрабатывает ответ.

    **Параметры**:
    - `request (IopRequest)`: Объект запроса.
    - `access_token (str, optional):`  Токен доступа. По умолчанию `None`.

    **Возвращает**:
    - `IopResponse`: Объект ответа.

    **Вызывает исключения**:
    - `Exception`: Возникает при возникновении ошибок при запросе к API.


## Функции

### `sign(secret, api, parameters)`

**Описание**:  Генерирует подпись для запроса.

**Параметры**:
- `secret (str)`: Секретный ключ приложения.
- `api (str)`: Имя API-метода.
- `parameters (dict)`: Словарь параметров запроса.

**Возвращает**:
- `str`: Подпись запроса в формате hex.

**Вызывает исключения**:
- Нет.


### `mixStr(pstr)`

**Описание**: Преобразует входной параметр к строковому типу.

**Параметры**:
- `pstr`: Входной параметр.

**Возвращает**:
- `str`: Строковое представление входного параметра.


### `logApiError(appkey, sdkVersion, requestUrl, code, message)`

**Описание**: Функция для логирования ошибок API.

**Параметры**:
- `appkey (str)`: Ключ приложения.
- `sdkVersion (str)`: Версия SDK.
- `requestUrl (str)`: URL запроса.
- `code (str)`: Код ошибки.
- `message (str)`: Сообщение об ошибке.


## Константы

- `P_SDK_VERSION`, `P_APPKEY`, `P_ACCESS_TOKEN`, `P_TIMESTAMP`, `P_SIGN`, `P_SIGN_METHOD`, `P_PARTNER_ID`, `P_METHOD`, `P_DEBUG`, `P_SIMPLIFY`, `P_FORMAT`, ...

  Эти константы определяют имена параметров запроса и других переменных.

## Логирование

Модуль использует `logging` для записи ошибок. Логирование настроено на запись в файл `iopsdk.log`.
# Анализ кода модуля CODE_RULES.MD

**Качество кода**

6/10
- **Плюсы**
   -  Код содержит подробные инструкции для обработки и форматирования кода.
   -  Присутствуют конкретные примеры использования и документации.
   -  Структура документа понятна и разбита на логические блоки.
- **Минусы**
    - Инструкции не полностью соответствуют формату документации RST.
    - Не все пункты инструкций полностью ясны и могут интерпретироваться по-разному.
    - Отсутствуют некоторые важные аспекты, такие как обработка ошибок.
    - Некоторые примеры кода избыточны.

**Рекомендации по улучшению**

1.  **Уточнение инструкций**:
    -  Конкретизировать инструкции для более четкого понимания.
    -  Дополнить недостающие аспекты, такие как обработка исключений, более подробно.
2.  **Формат документации RST**:
    -  Привести примеры документации к полному соответствию RST.
    -  Добавить больше примеров с разными типами аргументов и возвращаемых значений.
3.  **Улучшение примеров кода**:
    -  Сократить избыточные примеры, чтобы они были более лаконичными и понятными.
    -  Добавить примеры, которые покрывают различные случаи использования.
4.  **Обработка ошибок**:
    -  Уточнить, как именно нужно обрабатывать ошибки.
    -  Добавить примеры использования `logger.error`.
5.  **Последовательность инструкций**:
    -  Убедиться, что порядок пунктов в инструкции логичен и последователен.
    -  Пересмотреть структуру для лучшего восприятия.
6.  **Более конкретные примеры**:
    -  Предоставить более конкретные примеры обработки разных типов данных.
    -  Добавить примеры использования `j_loads` и `j_loads_ns`.
7.  **Избегание двусмысленности**:
    -  Уточнить инструкции, которые могут интерпретироваться неоднозначно.
    -  Добавить пояснения к инструкциям.
8. **Формат ответа**
    - Привести формат ответа в соответствие с требованием инструкции.

**Оптимизированный код**

```markdown
# ИНСТРУКЦИЯ
## Основные требования:
## Output Language: RU (Русский)

1.  **Формат документации**:
    
    -   Всегда используйте одинарные кавычки (`'`) в Python коде. Например: `a = 'A1'`; `['a','b',..]`; `{'a':q,'b':'c'}`
    
    Двойные только в операциях вывода. Например `print("Hello, world!")`; `input("Name")`; `logger.error("Error")`

2.  **Сохранение комментариев**:
    -   Все существующие комментарии после `#` должны быть сохранены без изменений.
    -   Блоки кода, которые необходимо изменить, должны быть прокомментированы построчно с использованием символа `#`.

3.  **Обработка данных**:
    -   Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load` для чтения файлов.
    -   Оставляйте любые `...` в коде без изменений как точки остановки.
    -   `logger` всегда импортируется из `sr.logger`. Example `from src.logger import logger`

4.  **Анализ структуры**:
    -   Проверьте и добавьте отсутствующие импорты в код.
    -   Приведите в соответствие имена функций, переменных и импортов с ранее обработанными файлами.

5.  **Рефакторинг и улучшения**:
    -   Добавьте комментарии в формате RST ко всем функциям, методам и классам.
    -   Используйте `from src.logger.logger import logger` для логирования ошибок.
    -   Избегайте избыточного использования стандартных блоков `try-except`, предпочитая обработку ошибок с помощью `logger.error`.
    -   В комментариях избегайте слов 'получаем', 'делаем' и подобных. Используйте конкретные формулировки, такие как 'проверка', 'отправка', 'код исполняет ...'.


7.  **Окончательный код**:
    -   В конце ответа должен быть представлен полный код (исходный с улучшениями) в одном блоке, который можно скопировать и вставить для замены исходного кода.
    -   Все изменённые части кода должны быть прокомментированы построчно с использованием символа `#` в этом блоке.

8.  **Примеры кода**:
    -   Включайте примеры документации RST и возможные улучшения в формате `TODO`.

9.  **Дополнительная инструкция**:
    -   Описание модуля в начале файла.
    -   Документацию для каждой функции, метода и переменной.
    -   Соблюдение стандартов оформления docstring в Python (для Sphinx).
    -   В комментариях после `#` строки должны содержать подробное объяснение следующего за ними блока кода.

    Пример формата документации для модуля:

    ```python
    """
    Модуль для работы ассистента программиста
    =========================================================================================

    Этот модуль содержит класс :class:`CodeAssistant`, который используется для работы с различными моделями ИИ,
    такими как Google Gemini и OpenAI, для выполнения задач по обработке кода.

    Пример использования
    --------------------

    Пример использования класса `CodeAssistant`:

    .. code-block:: python

        assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
        assistant.process_files()
    """
    ```

    Пример формата документации для функций:
       Пример 1.
    ```python
    @close_pop_up()
    async def specification(self, value: Any = None):
        """Fetch and set specification.

        Args:
            value (Any): это значение можно передать в словаре kwargs через ключ {specification = `value`} при определении класса.
            Если `value` был передан, его значение подставляется в поле `ProductFields.specification`.
        """
        try:
            # код исполняет получение значения через execute_locator
            value = value or  await self.driver.execute_locator(self.locator.specification) or ''
        except Exception as ex:
            logger.error('Ошибка получения значения в поле `specification`', ex)
            ...
            return

        # Проверка валидности результата
        if not value:
            logger.debug(f'Невалидный результат {value=}\\nлокатор {self.locator.specification}')
            ...
            return

        # Если значение - список, код преобразовывает его в строку с разделителем `\\n`
        if isinstance(value, list):
            value = '\\n'.join(map(str, value))

        # Код записывает результат в поле `specification` объекта `ProductFields`
        self.fields.specification = value
        return True

    ```
   Пример 2.
    ```python
    async def save_text_file(
        file_path: str | Path,
        data: str | list[str] | dict,
        mode: str = 'w'
    ) -> bool:
        """
        Асинхронно сохраняет данные в текстовый файл.

        Args:
            file_path (str | Path): Путь к файлу для сохранения.
            data (str | list[str] | dict): Данные для записи.
            mode (str, optional): Режим записи файла ('w' для записи, 'a' для добавления).
        Returns:
            bool: True, если файл успешно сохранен, False в противном случае.
        Raises:
            Exception: При возникновении ошибки при записи в файл.

        Example:
            >>> from pathlib import Path
            >>> file_path = Path('example.txt')
            >>> data = 'Пример текста'
            >>> result = await save_text_file(file_path, data)
            >>> print(result)
            True
        """
        ...
        rest of code
    ```

## Порядок блоков в ответе:
Структура ответа должна быть такой:

**Заголовок**
    Анализ кода модуля <имя модуля>

**Качество кода
<Соответветвие требованиям по оформлению кода от 1 до 10>
 -  Плюсы
        <положительные качества кода>
 -  Минусы
    <отрицательные моменты> 
**Рекомендации по улучшению**
**Оптимизиробанный код**
   - Код должен быть обрамлён в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).

## Ответ не должен начинаться с ` ``` `. Используйте их только для оборачивания блоков кода.

## Ты даешь ответы на русском языке
## Формат ответа `.md` (markdown)
----------------------------
** КОНЕЦ ИНСТРУКЦИИ **
```
```python
### **System Instructions for Machine Learning Model**
# Описание модуля: Инструкции для модели машинного обучения.
# =========================================================================================
# Этот документ описывает функциональные возможности и правила для генерации, анализа и улучшения кода.
# Он предназначен для обеспечения последовательного и читаемого стиля кодирования, отвечающего требованиям.

# ---

### **Key Principles**
# Основные принципы

#### **1. General Guidelines**:
# 1. Общие рекомендации
- # Соблюдение четкого стиля кодирования.
    # Придерживаться четкого стиля кодирования.
- # Все изменения должны быть обоснованными и соответствовать требованиям.
    # Все изменения должны быть обоснованы и соответствовать требованиям.

#### **2. Comments**:
# 2. Комментарии
- # Использование `#` для внутренних комментариев.
    # Использовать `#` для внутренних комментариев.
- # Документация в формате Sphinx должна использоваться для всех функций, методов и классов.
    # Документация в формате Sphinx должна использоваться для всех функций, методов и классов.
- # Комментарии и документация должны быть понятными, краткими и точными.
    # Комментарии и документация должны быть понятными, краткими и точными.

#### **3. Code Formatting**:
# 3. Форматирование кода
- # Использование одинарных кавычек.
    # Использовать одинарные кавычки.
- # Добавление пробелов вокруг операторов.
    # Добавлять пробелы вокруг операторов.
- # Все параметры должны быть типизированы.
    # Все параметры должны быть типизированы.
- # Избегать использования `Union`.
    # Избегать использования `Union`.

#### **4. Logging**:
# 4. Логирование
- # Использовать модуль `logger` из `src.logger.logger`.
    # Использовать модуль `logger` из `src.logger.logger`.
- # Примеры ошибок должны регистрироваться с помощью `logger.error`.
    # Примеры ошибок должны регистрироваться с помощью `logger.error`.

# ---

### **Main Requirements**
# Основные требования

#### **1. Markdown Format for Responses**:
# 1. Формат Markdown для ответов
- # Все ответы должны соответствовать формату **Markdown**.
    # Все ответы должны соответствовать формату **Markdown**.
- # Структура ответа должна включать:
    # Структура ответа должна включать:
  - # **Original code**: Блок полученного кода без изменений.
        # **Original code**: Блок полученного кода без изменений.
  - # **Improved code**: Блок улучшенного кода, правильно отформатированный и с добавленными комментариями.
        # **Improved code**: Блок улучшенного кода, правильно отформатированный и с добавленными комментариями.
  - # **Changes**: Подробный список изменений и пояснений.
        # **Changes**: Подробный список изменений и пояснений.
- # Код должен быть обернут в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).
    # Код должен быть обернут в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).

#### **2. Comment Format**:
# 2. Формат комментариев
- # Использовать определенный стиль для комментариев и документации в коде.
    # Использовать определенный стиль для комментариев и документации в коде.
- # Пример:
    # Пример:

```python
    def read_text_file(
        file_path: str | Path,
        as_list: bool = False,
        extensions: Optional[list[str]] = None,
        chunk_size: int = 8192
    ) -> Generator[str, None, None] | str | None:
        """
        # Читает содержимое файла (или файлов из каталога) с использованием генератора для эффективности памяти.
        # Reads the contents of a file (or files from a directory) using a generator for memory efficiency.

        Args:
            # `file_path` (str | Path): Путь к файлу или каталогу.
            # file_path (str | Path): Path to the file or directory.
            # `as_list` (bool, optional): Если `True`, возвращает генератор строк.
            # as_list (bool, optional): If `True`, returns a generator of strings.
            # `extensions` (list[str], optional): Список расширений файлов для включения при чтении каталога.
            # extensions (list[str], optional): List of file extensions to include when reading a directory.
            # `chunk_size` (int, optional): Размер блоков для чтения файла в байтах.
            # chunk_size (int, optional): The size of chunks to read the file in bytes.

        Returns:
            # Generator[str, None, None] | str | None: Генератор строк, объединенная строка или `None` в случае ошибки.
            # Generator[str, None, None] | str | None: A string generator, a concatenated string, or `None` in case of error.

        Raises:
            # Exception: Если произошла ошибка при чтении файла.
            # Exception: If an error occurs while reading the file.

        Example:
            # >>> from pathlib import Path
            # >>> file_path = Path('example.txt')
            # >>> content = read_text_file(file_path)
            # >>> if content:
            # ...    print(f'File content: {content[:100]}...')
            # File content: Example text...
            >>> from pathlib import Path
            >>> file_path = Path('example.txt')
            >>> content = read_text_file(file_path)
            >>> if content:
            ...    print(f'File content: {content[:100]}...')
            File content: Example text...
        """
        ...
```
- # Всегда давайте подробные пояснения в комментариях. Избегайте расплывчатых терминов, таких как *"получить"* или *"сделать"*. Вместо этого используйте точные термины, такие как *"извлечь"*, *"проверить"*, *"выполнить"*.
    # Всегда давайте подробные пояснения в комментариях. Избегайте расплывчатых терминов, таких как *"get"* или *"do"*. Вместо этого используйте точные термины, такие как *"extract"*, *"check"*, *"perform"*.
- # Комментарии должны непосредственно предшествовать описываемому блоку кода и объяснять его назначение.
    # Комментарии должны непосредственно предшествовать описываемому блоку кода и объяснять его назначение.

#### **3. Spaces Around Assignment Operators**:
# 3. Пробелы вокруг операторов присваивания
- # Всегда добавляйте пробелы вокруг оператора `=` для улучшения читаемости.
    # Всегда добавляйте пробелы вокруг оператора `=` для улучшения читаемости.
- # Примеры:
    # Примеры:
  - # **Неправильно**: `x=5`
        # **Неправильно**: `x=5`
  - # **Правильно**: `x = 5`
        # **Правильно**: `x = 5`

#### **4. Use of `j_loads` or `j_loads_ns`**:
# 4. Использование `j_loads` или `j_loads_ns`
- # Для чтения файлов JSON или конфигурации замените стандартные `open` и `json.load` на `j_loads` или `j_loads_ns`.
    # Для чтения файлов JSON или конфигурации замените стандартные `open` и `json.load` на `j_loads` или `j_loads_ns`.
- # Пример:
    # Пример:

```python
# Неправильно:
# with open('config.json', 'r', encoding='utf-8') as f:
#     data = json.load(f)
# Correct:
    # data = j_loads('config.json')
# Неправильно:
with open('config.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# Правильно:
data = j_loads('config.json')
```

#### **5. Preserving Comments**:
# 5. Сохранение комментариев
- # Все существующие комментарии, начинающиеся с `#`, должны быть сохранены как есть в разделе "Improved code".
    # Все существующие комментарии, начинающиеся с `#`, должны быть сохранены как есть в разделе "Improved code".
- # Если комментарий кажется устаревшим или неясным, не изменяйте его. Вместо этого отметьте его в разделе "Changes".
    # Если комментарий кажется устаревшим или неясным, не изменяйте его. Вместо этого отметьте его в разделе "Changes".

#### **6. Handling `...` in Code**:
# 6. Обработка `...` в коде
- # Оставляйте `...` в качестве маркеров в коде без изменений.
    # Оставляйте `...` в качестве маркеров в коде без изменений.
- # Не документируйте строки с `...`.
    # Не документируйте строки с `...`.

#### **7. Response Structure**:
# 7. Структура ответа
# Каждый ответ должен включать следующие разделы:
    # Каждый ответ должен включать следующие разделы:

- # **Improved Optimized Full Code**:
    # **Improved Optimized Full Code**:

```markdown
# <Улучшенная версия кода с добавленными комментариями и форматированием.>
# <Improved version of the code with added comments and formatting.>
```

- # **Changes**:
    # **Changes**:
# <Подробный список всех изменений, включая пояснения и обоснования.>
# <A detailed list of all modifications, including explanations and justifications.>
```
```
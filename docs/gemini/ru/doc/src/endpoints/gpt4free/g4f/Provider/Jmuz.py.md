# Модуль Jmuz

## Обзор

Модуль `Jmuz` предоставляет класс `Jmuz`, который является подклассом `OpenaiTemplate` и предназначен для взаимодействия с API Jmuz. Этот модуль определяет параметры подключения к API, такие как URL, базовый URL API, ключ API, а также поддерживает псевдонимы моделей и асинхронную генерацию контента.

## Подробнее

Класс `Jmuz` использует API Jmuz для генерации текста на основе предоставленных сообщений. Он переопределяет метод `create_async_generator` для обработки потоковой передачи данных и фильтрации нежелательных фрагментов текста, таких как приглашения присоединиться к Discord или превью o1.
Модуль предназначен для использования в асинхронных приложениях и обеспечивает интеграцию с API Jmuz для получения текстовых результатов.

## Классы

### `Jmuz(OpenaiTemplate)`

**Описание**: Класс `Jmuz` является подклассом `OpenaiTemplate` и предоставляет функциональность для взаимодействия с API Jmuz.

**Наследует**:
- `OpenaiTemplate`: Наследует методы и атрибуты от класса `OpenaiTemplate`, который, вероятно, предоставляет общую структуру для работы с API OpenAI.

**Атрибуты**:
- `url` (str): URL, связанный с Jmuz (например, ссылка на Discord).
- `api_base` (str): Базовый URL API Jmuz.
- `api_key` (str): Ключ API для аутентификации запросов к Jmuz.
- `working` (bool): Указывает, работает ли этот провайдер (значение `True`).
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения (значение `False`).
- `default_model` (str): Модель, используемая по умолчанию (`"gpt-4o"`).
- `model_aliases` (dict): Словарь псевдонимов моделей, позволяющий использовать более короткие или понятные имена для конкретных моделей Jmuz.

**Методы**:
- `get_models(**kwargs)`: Возвращает список доступных моделей.
- `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`: Создает асинхронный генератор для получения результатов от API Jmuz.

## Функции

### `get_models(**kwargs)`

```python
@classmethod
def get_models(cls, **kwargs):
    """
    Получает список доступных моделей.

    Args:
        **kwargs: Дополнительные аргументы.

    Returns:
        list: Список доступных моделей.
    """
    ...
```

**Назначение**:
Метод `get_models` предназначен для получения списка доступных моделей, предоставляемых API Jmuz. Если список моделей еще не был получен, он запрашивает его, используя методы родительского класса `OpenaiTemplate`.

**Параметры**:
- `**kwargs`: Дополнительные аргументы, которые могут быть переданы в функцию `super().get_models()`.

**Возвращает**:
- `list`: Список доступных моделей.

**Как работает функция**:

1. **Проверка наличия моделей**: Проверяет, был ли уже получен список моделей (`cls.models`).
2. **Запрос моделей**: Если список моделей пуст, вызывает метод `get_models` родительского класса `OpenaiTemplate` для получения списка моделей из API Jmuz.
3. **Возврат моделей**: Возвращает список доступных моделей.

```
Проверка -> Запрос  -> Возврат
наличия   -> моделей -> моделей
моделей   ->         ->
```

**Примеры**:

```python
models = Jmuz.get_models()
print(models)
```

### `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`

```python
@classmethod
async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        stream: bool = True,
        api_key: str = None, # Remove api_key from kwargs
        **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения результатов от API Jmuz.

    Args:
        model (str): Имя модели для использования.
        messages (Messages): Список сообщений для отправки в API.
        stream (bool, optional): Определяет, использовать ли потоковую передачу данных. По умолчанию `True`.
        api_key (str, optional): Ключ API (удален из kwargs). По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий результаты от API.
    """
    ...
```

**Назначение**:
Метод `create_async_generator` создает асинхронный генератор для получения результатов от API Jmuz. Он обрабатывает потоковую передачу данных, фильтрует нежелательные фрагменты текста и возвращает результаты в виде асинхронного генератора.

**Параметры**:
- `model` (str): Имя модели для использования.
- `messages` (Messages): Список сообщений для отправки в API.
- `stream` (bool, optional): Определяет, использовать ли потоковую передачу данных. По умолчанию `True`.
- `api_key` (str, optional): Ключ API (удален из kwargs). По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий результаты от API.

**Как работает функция**:

1. **Получение модели**: Получает имя модели с помощью `cls.get_model(model)`.
2. **Настройка заголовков**: Создает словарь `headers` с необходимыми заголовками для запроса к API, включая ключ авторизации.
3. **Создание асинхронного генератора**: Вызывает метод `create_async_generator` родительского класса `OpenaiTemplate` для получения данных из API Jmuz.
4. **Обработка данных**: Итерируется по чанкам данных, полученным от API, и выполняет фильтрацию:
   - Удаляет приглашения присоединиться к Discord.
   - Удаляет превью "o1-preview".
   - Удаляет URL Discord.
   - Удаляет пробелы в начале буфера.
5. **Возврат результатов**: Возвращает очищенные чанки данных через асинхронный генератор.

```
Получение -> Настройка  -> Создание      -> Обработка -> Фильтрация -> Возврат
модели    -> заголовков -> асинхр.       -> данных   ->  данных    -> данных
          ->           -> генератора     ->         ->            ->
```

**Примеры**:

```python
async for chunk in Jmuz.create_async_generator(model="gpt-4o", messages=[{"role": "user", "content": "Hello"}], stream=True):
    print(chunk)
# Модуль для асинхронного стриминга сообщений с использованием gpt4free

## Обзор

Этот модуль демонстрирует асинхронный стриминг сообщений с использованием библиотеки `g4f` для взаимодействия с моделью `gpt-4`. Он показывает, как можно получать ответы от модели по частям и накапливать их для последующей обработки.

## Подробней

Модуль использует библиотеку `g4f` для создания асинхронного клиента и отправки запроса на стриминг сообщений. Он обрабатывает чанки ответов, накапливает их и выводит на экран в реальном времени. Также предусмотрена обработка ошибок и вывод накопленного текста после завершения стриминга.

## Функции

### `main`

```python
async def main():
    """Асинхронная функция для демонстрации стриминга сообщений с использованием gpt4free.

    Функция создает асинхронного клиента, отправляет запрос на стриминг сообщений к модели gpt-4,
    обрабатывает чанки ответов, накапливает их и выводит на экран. Также предусмотрена обработка ошибок
    и вывод накопленного текста после завершения стриминга.
    """
    ...
```

**Как работает функция**:

1.  **Создание асинхронного клиента**: Инициализируется асинхронный клиент для взаимодействия с API g4f.
2.  **Отправка запроса на стриминг**: Отправляется запрос к модели `gpt-4` с сообщением "Say hello there!" и включенным режимом стриминга.
3.  **Обработка чанков ответов**: В цикле асинхронно принимаются чанки ответов от модели.
4.  **Накопление текста**: Из каждого чанка извлекается содержимое и добавляется к накопительной строке `accumulated_text`.
5.  **Вывод на экран**: Каждый полученный фрагмент текста выводится на экран в реальном времени.
6.  **Обработка ошибок**: В случае возникновения ошибки выводится сообщение об ошибке.
7.  **Вывод накопленного текста**: После завершения стриминга выводится накопленный текст.

```text
Создание асинхронного клиента
↓
Отправка запроса на стриминг к gpt-4
↓
Цикл обработки чанков ответов
│
├───→ Извлечение содержимого чанка
│   ↓
├───→ Накопление текста
│   ↓
└───→ Вывод текста на экран
↓
Обработка ошибок (если возникли)
↓
Вывод накопленного текста
```

**Примеры**:

```python
import asyncio
from g4f.client import AsyncClient

async def main():
    client = AsyncClient()
    
    stream = client.chat.completions.create(
        model="gpt-4",
        messages=[{"role": "user", "content": "Say hello there!"}],
        stream=True,
    )
    
    accumulated_text = ""
    try:
        async for chunk in stream:
            if chunk.choices and chunk.choices[0].delta.content:
                content = chunk.choices[0].delta.content
                accumulated_text += content
                print(content, end="", flush=True)
    except Exception as e:
        print(f"\nError occurred: {e}")
    finally:
        print("\n\nFinal accumulated text:", accumulated_text)

asyncio.run(main())
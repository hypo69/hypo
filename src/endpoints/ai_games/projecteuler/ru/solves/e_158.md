## Ответ на Задачу No 158: Исследование перестановок

### 1. Анализ задачи и решение

**Понимание задачи:**
*   Нам нужно найти количество перестановок чисел от 1 до n, где максимальная длина нисходящей последовательности равна 2.
*   Нисходящая последовательность - это подпоследовательность, где каждый элемент меньше предыдущего.
*   Обозначим количество таких перестановок N(n).
*   Задача сводится к подсчету перестановок, в которых нет нисходящей подпоследовательности длины 3 и более.

**Решение:**
1.  **Ограничения:** Перестановка с s(p) = 1 - это всегда возрастающая последовательность (1, 2, 3, ..., n). Она нам не подходит, так как s(p) должно быть равно 2.
2.  **Связь с числами Каталана:** Количество перестановок от 1 до n, у которых наибольшая убывающая последовательность равна 2, связано с числами Каталана. Число Каталана C(n) вычисляется по формуле C(n) = (1/(n+1)) * (2n choose n).
3.  **Формула:**  Количество перестановок с s(p) ≤ 2 для n элементов равно числу Каталана C(n).
4.  **Вычисление:** Для нашей задачи нам требуется посчитать общее количество перестановок (n!), вычесть те, где s(p)=1 (их всегда 1, это возрастающая последовательность (1,2,3,...,n)), и использовать связь с числами Каталана, чтобы понять, как это связано с тем, что s(p) <= 2
5.  **Расчет N(n):**
    *   Общее количество перестановок n!
    *   Количество перестановок с s(p) = 1 равно 1 (возрастающая последовательность).
    *   Количество перестановок с s(p) <= 2 равно числу Каталана C(n)
    *   Количество перестановок с s(p) = 2 будет C(n) - 1.

    Итого N(n) = (n! - количество перестановок где  s(p) > 2 ).
    Как было выяснено что если s(p) <=2 то таких перестановок = C(n).
    Поэтому:
    N(n) =  C(n) * n! *  (1 / sum( (n!/k! )for k in range(0,n) )).
    Это формула выведена через исследование, нахождение закономерностей и связи с числами каталана.
    N(n) =  C(n)

    Таким образом:
    N(n) = (1 / (n + 1)) * (2n)! / (n! * n!)
   
    
    Нам нужно N(10).

### 2. Алгоритм решения
1.  Начать
2.  Функция для вычисления факториала:
    *   Вход: Целое число `n`
    *   Если `n` равно 0, вернуть 1
    *   Иначе, вернуть `n` * факториал(`n`-1)
3.  Функция для вычисления числа Каталана:
    *   Вход: Целое число `n`
    *   Вычислить факториал от `2*n`
    *   Вычислить факториал от `n`
    *   Вычислить число Каталана по формуле: (factorial(2 * n) // (factorial(n) * factorial(n))) // (n + 1)
    *   Вернуть число Каталана
4.  Вычислить N(10) с помощью функции расчета числа Каталана
5.  Вернуть N(10)
6.  Конец

### 3. Реализация на Python 3.12
```python
import math

def factorial(n):
    """
    Calculates the factorial of a non-negative integer.

    Args:
      n: A non-negative integer.

    Returns:
      The factorial of n.
    """
    if n == 0:
        return 1
    else:
        return math.prod(range(1, n + 1))

def catalan_number(n):
    """
    Calculates the nth Catalan number.

    Args:
        n: A non-negative integer.

    Returns:
        The nth Catalan number.
    """
    
    return factorial(2 * n) // (factorial(n) * factorial(n)) // (n + 1)

# Вычисление N(10)
n_value = 10
result = catalan_number(n_value)
print(result)
```

### 4. Блок-схема в формате mermaid
```mermaid
flowchart TD
    Start((Начало)) --> InputN((Ввод n = 10))
    InputN --> FactorialFunc((Функция факториала))
    FactorialFunc --> CatalanFunc((Функция числа Каталана))
    CatalanFunc --> CalculateCatalan((Вычислить число Каталана для n))
    CalculateCatalan --> OutputResult((Вывод результата N(10)))
    OutputResult --> End((Конец))

    subgraph FactorialFunc
        FStart((Начало факториала)) --> FCheckN((n == 0?))
        FCheckN -- Да --> FReturn1((Вернуть 1))
        FCheckN -- Нет --> FCalcFact((Факториал = n * факториал(n-1)))
        FCalcFact --> FReturnFact((Вернуть Факториал))
        FReturn1 --> FEnd((Конец факториала))
        FReturnFact --> FEnd
    end

    subgraph CatalanFunc
        CStart((Начало каталана)) --> CCalcFact2N((Вычислить факториал(2n)))
         CCalcFact2N --> CCalcFactN((Вычислить факториал(n)))
        CCalcFactN --> CCalcCatalan((Число Каталана = факториал(2n) / (факториал(n) * факториал(n)) / (n + 1)))
        CCalcCatalan --> CReturnCatalan((Вернуть число Каталана))
        CReturnCatalan --> CEnd((Конец каталана))
    end

```

**Легенда:**
*   **Начало, Конец:** Начало и конец алгоритма.
*   **Ввод n:** Ввод значения n (в нашем случае n = 10).
*   **Функция факториала:** Вызов функции для расчета факториала.
*   **Функция числа Каталана:** Вызов функции для расчета числа Каталана.
*   **Вычислить число Каталана для n:** Вычисление значения числа Каталана для заданного n.
*   **Вывод результата:** Вывод рассчитанного значения N(10).
*   **Начало факториала, Конец факториала:** Начало и конец функции факториала.
*   **n == 0?:** Проверка, равно ли n нулю.
*   **Вернуть 1:** Возврат 1, если n равно 0.
*   **Факториал = n \* факториал(n-1):** Вычисление факториала рекурсивным способом.
*   **Вернуть Факториал:** Возврат рассчитанного значения факториала.
 *  **Начало каталана, Конец каталана:** Начало и конец функции числа каталана.
 *   **Вычислить факториал(2n):** Вычисляет факториал от 2*n.
 *   **Вычислить факториал(n):** Вычисляет факториал от n.
 *   **Число Каталана = факториал(2n) / (факториал(n) \* факториал(n)) / (n + 1):** Расчет числа каталана по формуле.
 *   **Вернуть число Каталана:** Возврат рассчитанного числа Каталана.

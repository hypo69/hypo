# Документация для модулей `fast_api_rpc.py` и `main.py`

## Обзор

Этот документ предоставляет подробное описание работы модулей `fast_api_rpc.py` и `main.py`, которые вместе образуют систему для удаленного управления FastAPI-сервером. Модуль `fast_api_rpc.py` содержит серверную часть, которая запускает FastAPI-сервер и предоставляет интерфейс XML-RPC для управления им. Модуль `main.py` представляет собой клиентскую часть, которая позволяет пользователю отправлять команды на сервер через XML-RPC.

## Подробней

Модули обеспечивают удаленное управление сервером FastAPI, позволяя запускать, останавливать и настраивать сервер из другого процесса или даже с другой машины. `fast_api_rpc.py` предоставляет серверную логику, а `main.py` предоставляет пользовательский интерфейс для отправки команд.

## Основные компоненты

### `fast_api_rpc.py` (серверная часть)

#### Обзор

Модуль `fast_api_rpc.py` содержит серверную часть для управления FastAPI-сервером через XML-RPC. Он включает классы `FastApiServer` и `CommandHandler`.

#### `FastApiServer`

**Описание**: Этот класс содержит логику для запуска FastAPI-сервера. Он отвечает за создание и настройку веб-сервера, а также за добавление новых маршрутов.

#### `CommandHandler`

**Описание**: Класс `CommandHandler` управляет вызовами функций управления сервером.

**Принцип работы**:
Класс `CommandHandler` управляет вызовами функций управления сервером, предоставляя методы для запуска, остановки, получения статуса серверов, добавления новых маршрутов и завершения работы сервера. Он использует `SimpleXMLRPCServer` для обработки удаленных вызовов.

**Аттрибуты**:
- `rpc_server` (SimpleXMLRPCServer): Объект XML-RPC сервера, принимающий удаленные вызовы.

**Методы**:
- `__init__()`: Инициализирует XML-RPC сервер и запускает его в отдельном потоке.
- `register_instance()`: Регистрирует все методы класса для удаленного вызова через XML-RPC.
- `start_server()`: Запускает FastAPI-сервер.
- `stop_server()`: Останавливает FastAPI-сервер.
- `stop_all_servers()`: Останавливает все запущенные FastAPI-серверы.
- `status_servers()`: Возвращает статус запущенных FastAPI-серверов.
- `add_new_route()`: Добавляет новый маршрут к FastAPI-серверу.
- `shutdown()`: Завершает работу сервера.

### `main.py` (клиентская часть)

#### Обзор

Модуль `main.py` содержит клиентскую часть для управления FastAPI-сервером через XML-RPC. Он использует класс `ServerProxy` для взаимодействия с сервером.

#### `ServerProxy`

**Описание**: Класс `ServerProxy` из библиотеки `xmlrpc.client` используется для создания объекта, через который можно вызывать методы XML-RPC сервера.

## Взаимодействие между компонентами

1.  **Запуск `fast_api_rpc.py`**: Создается экземпляр `CommandHandler`, который запускает XML-RPC сервер на порту `9000`.
2.  **Запуск `main.py`**: Создается экземпляр `ServerProxy`, который подключается к XML-RPC серверу.
3.  **Ввод команды**: Пользователь вводит команду в `main.py`, которая анализируется и отправляется на сервер.
4.  **Обработка запроса на сервере**: XML-RPC сервер в `fast_api_rpc.py` получает запрос и вызывает соответствующий метод `CommandHandler`.
5.  **Возврат ответа**: XML-RPC сервер формирует ответ и отправляет его обратно клиенту `main.py`.
6.  **Отображение результата**: `main.py` отображает результат в консоль.
7.  **Повторение цикла**: `main.py` возвращается к началу цикла, отображая меню и ожидая ввода следующей команды.

## Ключевые моменты

-   **Разделение ответственности**: `fast_api_rpc.py` отвечает за управление сервером, `main.py` отвечает за взаимодействие с пользователем.
-   **XML-RPC**: `xmlrpc` используется для организации связи между двумя процессами.
-   **Потоки**: XML-RPC сервер запущен в отдельном потоке.
-   **Удаленный вызов**: `ServerProxy` позволяет вызывать методы удаленного сервера, как если бы они были локальными.

## Преимущества данного подхода

-   **Управление сервером из другой программы**: Контроль запущенного сервера через другой процесс.
-   **Разделение кода**: Логика управления сервером и пользовательский интерфейс разделены.
-   **Гибкость**: Добавление новых методов управления сервером, просто добавив их в `CommandHandler`.
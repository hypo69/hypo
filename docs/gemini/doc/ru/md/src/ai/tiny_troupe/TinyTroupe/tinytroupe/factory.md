# Модуль tinytroupe.factory

## Обзор

Этот модуль предоставляет классы для создания и управления фабриками, которые генерируют различные объекты, например, `TinyPerson`. Он включает механизмы кэширования для улучшения производительности и поддержки транзакций.

## Классы

### `TinyFactory`

**Описание**: Базовый класс для различных типов фабрик. Этот класс важен для расширяемости системы, особенно в отношении кэширования транзакций.

**Атрибуты**:

- `all_factories`: Словарь, содержащий все созданные фабрики. Ключ - имя фабрики, значение - экземпляр фабрики.

**Методы**:

- `__init__(self, simulation_id: str = None) -> None`: Инициализирует экземпляр `TinyFactory`.
    - **Аргументы**:
        - `simulation_id (str, optional):` Идентификатор симуляции. По умолчанию `None`.
    - **Возвращает**:
        - `None`

- `__repr__(self)`: Возвращает строковое представление объекта фабрики.

- `set_simulation_for_free_factories(simulation)`: Устанавливает симуляцию для свободных фабрик, если она не задана.
    - **Аргументы**:
        - `simulation`: Объект симуляции.

- `add_factory(factory)`: Добавляет фабрику в список всех фабрик.
    - **Аргументы**:
        - `factory`: Экземпляр фабрики.
    - **Возвращает**:
        - `None`
    - **Исключения**:
        - `ValueError`: Если фабрика с таким же именем уже существует.

- `clear_factories()`: Очищает глобальный список всех фабрик.

- `encode_complete_state(self) -> dict`: Кодирует полное состояние фабрики. Подклассы должны переопределять, если есть несериализуемые элементы.
    - **Возвращает**:
        - `dict`: Закодированное состояние.

- `decode_complete_state(self, state: dict)`: Декодирует полное состояние фабрики. Подклассы должны переопределять, если есть несериализуемые элементы.
    - **Аргументы**:
        - `state (dict)`: Закодированное состояние.
    - **Возвращает**:
        - `self`: Экземпляр фабрики.


### `TinyPersonFactory`

**Описание**: Фабрика для создания объектов `TinyPerson`.

**Атрибуты**:

- `person_prompt_template_path`: Путь к шаблону запроса для генерации персон.
- `context_text`: Текст контекста для генерации персон.
- `generated_minibios`: Список сгенерированных мини-биографии персон.
- `generated_names`: Список сгенерированных имен персон.

**Методы**:

- `__init__(self, context_text, simulation_id: str = None)`: Инициализирует экземпляр `TinyPersonFactory`.
    - **Аргументы**:
        - `context_text (str)`: Текст контекста для генерации персон.
        - `simulation_id (str, optional):` Идентификатор симуляции. По умолчанию `None`.

- `generate_person_factories(number_of_factories, generic_context_text)`: Генерирует список `TinyPersonFactory` используя OpenAI.
    - **Аргументы**:
        - `number_of_factories (int)`: Количество фабрик.
        - `generic_context_text (str)`: Общий контекст.
    - **Возвращает**:
        - `list`: Список `TinyPersonFactory` экземпляров или `None`, если ответ от OpenAI некорректный.

- `generate_person(self, agent_particularities: str = None, temperature: float = 1.5, attempts: int = 5)`: Генерирует экземпляр `TinyPerson` используя OpenAI.
    - **Аргументы**:
        - `agent_particularities (str, optional)`: Особые характеристики агента. По умолчанию `None`.
        - `temperature (float, optional)`: Температура для выборки из LLM. По умолчанию `1.5`.
        - `attepmts (int, optional)`: Количество попыток генерации. По умолчанию `5`.
    - **Возвращает**:
        - `TinyPerson`: Экземпляр `TinyPerson`, или `None` если генерация не удалась.
    - **Исключения**:
        - `Exception`: Любое исключение, возникшее при генерации.


- `_aux_model_call(self, messages, temperature)`: Вспомогательный метод для вызова модели, который позволяет использовать декоратор `transactional`.
    - **Аргументы**:
        - `messages`: Список сообщений для модели.
        - `temperature`: Температура для выборки из LLM.
    - **Возвращает**:
        - `dict`: Ответ от модели, или `None` в случае ошибки.


- `_setup_agent(self, agent, configuration)`: Настраивает агента с необходимыми элементами.
    - **Аргументы**:
        - `agent`: Экземпляр `TinyPerson`.
        - `configuration`: Словарь настроек.


## Функции


## Модули
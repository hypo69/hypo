# Модуль `try_xpath_background.js`

## Обзор

Этот модуль содержит код расширения для браузера Firefox, который отвечает за обработку сообщений, связанных с Try XPath. Он управляет сохранением и восстановлением состояния всплывающего окна, загрузкой и обновлением CSS, а также отображением результатов поиска.

## Переменные

### `tx`

**Описание**: Псевдоним для объекта `tryxpath`.

### `fu`

**Описание**: Псевдоним для объекта `tryxpath.functions`.

### `popupState`

**Описание**: Состояние всплывающего окна. Может содержать информацию о текущем состоянии.

### `popupCss`

**Описание**: Строка CSS-стилей для всплывающего окна.

### `results`

**Описание**: Объект, содержащий результаты поиска XPath.

### `css`

**Описание**: Строка CSS-кода для отображения результатов.

### `attributes`

**Описание**: Объект, содержащий атрибуты для элементов.


## Функции

### `loadDefaultCss`

**Описание**: Функция загружает значения CSS из файла `try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Обещание, содержащее загруженный CSS.

**Вызывает исключения**:
- Возможные исключения, связанные с `XMLHttpRequest`.

### `genericListener`

**Описание**: Функция-обработчик сообщений для расширения.

**Параметры**:
- `message`: Объект, содержащий данные сообщения.
- `sender`: Объект, содержащий данные отправителя сообщения.
- `sendResponse`: Функция для отправки ответа на сообщение.

**Возвращает**:
- `any`: Возвращаемое значение обработчика события, если обработчик определён.


### `genericListener.listeners.storePopupState`

**Описание**: Устанавливает `popupState` на переданное значение.

**Параметры**:
- `message`: Объект, содержащий данные сообщения. Включает поле `state`.


### `genericListener.listeners.requestRestorePopupState`

**Описание**: Отправляет сообщение с запросом о восстановлении `popupState`.

**Параметры**:
- `message`: Объект, содержащий данные сообщения.


### `genericListener.listeners.requestInsertStyleToPopup`

**Описание**: Отправляет сообщение с запросом вставки CSS-стилей в всплывающее окно.

**Параметры**:
- `message`: Объект, содержащий данные сообщения.


### `genericListener.listeners.showAllResults`

**Описание**: Создаёт новую вкладку для отображения результатов поиска.

**Параметры**:
- `message`: Объект, содержащий данные сообщения, в частности результаты поиска.
- `sender`: Объект, содержащий данные отправителя.

**Возвращает**: `undefined`

### `genericListener.listeners.loadResults`

**Описание**: Возвращает результаты поиска.

**Параметры**:
- `message`: Объект, содержащий данные сообщения.
- `sender`: Объект, содержащий данные отправителя сообщения.
- `sendResponse`: Функция для отправки ответа на сообщение.

**Возвращает**:
- `true`: Возвращает `true`, чтобы подтвердить успешность.


### `genericListener.listeners.updateCss`

**Описание**: Обновляет CSS-стили в открытой вкладке.

**Параметры**:
- `message`: Объект, содержащий данные сообщения, включая набор устаревших CSS-кодов `expiredCssSet`.
- `sender`: Объект, содержащий данные отправителя.

**Возвращает**: `undefined`

### `genericListener.listeners.loadOptions`

**Описание**: Загружает значения атрибутов, CSS и CSS всплывающего окна.

**Параметры**:
- `message`: Объект, содержащий данные сообщения.
- `sender`: Объект, содержащий данные отправителя сообщения.
- `sendResponse`: Функция для отправки ответа на сообщение.

**Возвращает**:
- `true`: Возвращает `true`, чтобы подтвердить успешность.

### `genericListener.listeners.requestSetContentInfo`

**Описание**: Отправляет сообщение для установки информации о содержании.

**Параметры**:
- `message`: Объект, содержащий данные сообщения, включая атрибуты.
- `sender`: Объект, содержащий данные отправителя.


## Обработчики событий

### `browser.storage.onChanged`

**Описание**: Обработчик изменений в хранилище. При изменении `attributes`, `css` или `popupCss`, обновляются соответствующие переменные.



## Обработка исключений

### `fu.onError`

**Описание**: Функция обработки ошибок. Используется для перехвата ошибок при выполнении асинхронных операций.



## Заметки

- Код использует промисы для асинхронных операций, таких как загрузка CSS.
- `genericListener.listeners` - это объект, содержащий обработчики для различных событий.
- Код использует `browser.runtime.sendMessage` для обмена сообщениями с другими частями расширения.
- Модуль управляет локальным хранилищем (localStorage), чтобы сохранить данные.
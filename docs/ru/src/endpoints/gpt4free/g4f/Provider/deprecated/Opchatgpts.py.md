# Модуль Opchatgpts

## Обзор

Модуль предоставляет асинхронный генератор для взаимодействия с провайдером Opchatgpts, который является устаревшим. Он позволяет отправлять сообщения и получать ответы в режиме реального времени. Модуль поддерживает историю сообщений и модель gpt-3.5-turbo.

## Подробнее

Этот модуль используется для подключения к сервису Opchatgpts и получения ответов от языковой модели. Он создает асинхронный генератор, который отправляет запросы к API и возвращает ответы по частям. Модуль предназначен для работы с устаревшим провайдером Opchatgpts.

## Классы

### `Opchatgpts`

**Описание**: Класс `Opchatgpts` является асинхронным генератором провайдера.

**Наследует**: `AsyncGeneratorProvider`

**Атрибуты**:
- `url` (str): URL-адрес сервиса Opchatgpts.
- `working` (bool): Указывает, работает ли провайдер.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель gpt-3.5-turbo.

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None, **kwargs) -> AsyncResult:
        """
        Создает асинхронный генератор для взаимодействия с Opchatgpts.

        Args:
            model (str): Модель для использования.
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
            **kwargs: Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий ответы от Opchatgpts.

        Raises:
            RuntimeError: Если получен сломанный ответ от сервера.

        """
```

**Назначение**: Создает асинхронный генератор для взаимодействия с Opchatgpts.

**Параметры**:
- `cls`: Ссылка на класс.
- `model` (str): Модель для использования.
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий ответы от Opchatgpts.

**Вызывает исключения**:
- `RuntimeError`: Если получен сломанный ответ от сервера.

**Как работает функция**:

1.  **Определение заголовков**: Функция определяет заголовки HTTP-запроса, включая `User-Agent`, `Accept`, `Origin`, `Referer` и другие.
2.  **Создание сессии**: Создается асинхронная HTTP-сессия с использованием `aiohttp.ClientSession` с заданными заголовками.
3.  **Формирование данных**: Формируются данные для отправки в запросе, включая `botId`, `chatId`, `contextId`, `messages` и другие параметры.
4.  **Отправка запроса**: Отправляется POST-запрос к API Opchatgpts с использованием асинхронной сессии.
5.  **Обработка ответа**: Функция асинхронно итерируется по строкам ответа, проверяя, начинаются ли они с `b"data: "`. Если строка является данными, она преобразуется из JSON.
6.  **Генерация ответов**: Если тип данных `live`, функция возвращает данные. Если тип данных `end`, генератор завершается.
7.  **Обработка ошибок**: Если в процессе обработки возникает ошибка, выбрасывается исключение `RuntimeError`.

```
Определение заголовков --> Создание сессии
    |
    --> Формирование данных
    |
    --> Отправка запроса
    |
    --> Обработка ответа --> Генерация ответов
    |
    --> Обработка ошибок
```

**Примеры**:

```python
# Пример вызова функции create_async_generator
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, world!"}]
proxy = None

async def main():
    generator = await Opchatgpts.create_async_generator(model, messages, proxy)
    async for message in generator:
        print(message)

# Пример вызова с прокси
proxy = "http://your_proxy:8080"
async def main_with_proxy():
    generator = await Opchatgpts.create_async_generator(model, messages, proxy)
    async for message in generator:
        print(message)
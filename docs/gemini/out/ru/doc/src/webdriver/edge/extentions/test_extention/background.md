# Модуль `background.js`

## Обзор

Этот файл содержит скрипт расширения для браузера, который слушает сообщения от других частей расширения и отправляет данные на сервер.  Когда пользователь кликает на иконку расширения, скрипт отправляет запрос на сбор данных с текущей страницы.

## Функции

### `chrome.browserAction.onClicked.addListener`

**Описание**: Устанавливает обработчик события клика на иконку расширения.

**Параметры**:
- `tab` (object): Объект, содержащий информацию о вкладке, на которой произошел клик.

**Возвращает**:
- Не имеет возвращаемого значения.


### `chrome.runtime.onMessage.addListener`

**Описание**: Устанавливает обработчик сообщений, отправленных другим частям расширения.

**Параметры**:
- `message` (object): Объект с данными, полученными от отправителя.
- `sender` (object): Информация о отправителе сообщения.
- `sendResponse` (function): Функция для отправки ответа отправителю.

**Возвращает**:
- `Boolean`:  Возвращает `true`, чтобы разрешить продолжение отправки сообщений.


### `sendDataToServer`

**Описание**: Отправляет собранные данные на сервер.

**Параметры**:
- `url` (string): URL страницы, с которой нужно собрать данные.

**Возвращает**:
- Не имеет возвращаемого значения.

**Вызывает исключения**:
- `Error`: Возникает, если произошла ошибка при отправке данных на сервер.


## Хранилище `chrome.storage.local`

**Описание**:  Используется для доступа к данным, хранящимся в локальном хранилище расширения.  Приватное хранилище, данные доступны только расширению.

## Библиотека `fetch`

**Описание**: Используется для выполнения запросов к API, в данном случае отправки данных на сервер.


## API `chrome.storage.local.get`

**Описание**: Получает данные из локального хранилища расширения.

**Параметры**:
- `'collectedData'` (string): Ключ для доступа к данным.

**Возвращает**:
- `result` (object): Объект с данными, соответствующими ключу.


##  Обработка ошибок

В коде реализована обработка ошибок при выполнении запроса `fetch`.  Используется блок `catch` для логгирования ошибок, что позволит отслеживать проблемы в работе расширения.

##  Константа `serverUrl`

**Описание**: Содержит адрес сервера, куда отправляются данные.

**Значение**: `'http://127.0.0.1/hypotez.online/api/'`


**Важно:** Измените значение `serverUrl` на ваш фактический адрес сервера.



##  Замечания

- Функция `sendDataToServer` получает URL страницы для сбора данных.
-  Должен быть реализован механизм сбора данных (по-видимому, в другом скрипте расширения).
-  Критически важно, чтобы `collectedData` существовал и был доступен в хранилище `chrome.storage.local`, иначе будет выведена ошибка "No collected data found".
-  В примере используется `JSON.stringify` для сериализации данных в JSON, необходимый для отправки данных методом POST.


```
```
# Модуль `hypotez/src/suppliers/aliexpress/scenarios/affiliate_links_shortener_scenario.py`

## Обзор

Модуль содержит функцию `get_short_affiliate_link`, предназначенную для сокращения ссылок аффилиата через веб-браузер.  Функция взаимодействует с веб-драйвером для ввода URL, нажатия кнопки сокращения, извлечения короткой ссылки и проверки её корректности.  Модуль использует логирование для отслеживания ошибок и предоставляет механизм для обработки случаев, когда сокращение ссылки не выполняется успешно.

## Функции

### `get_short_affiliate_link`

**Описание**: Функция `get_short_affiliate_link` выполняет сценарий сокращения аффилиатной ссылки, используя веб-драйвер.

**Параметры**:
- `d` (Driver): Экземпляр веб-драйвера.
- `url` (str): Исходный URL для сокращения.

**Возвращает**:
- `str`: Сокращенная ссылка. Возвращает `None` в случае неудачи.

**Вызывает исключения**:
- Не вызывает исключений напрямую.  Вместо этого, записывает сообщения об ошибках в `logger` и возвращает пустую строку при неудачном сокращении, что позволяет обработчику вызова функции обрабатывать ошибку самостоятельно.

**Детали**:
- Функция загружает локаторы из файла `affiliate_links_shortener.json`.
- Инициализирует веб-драйвер и вставляет URL в поле.
- Нажимает кнопку для сокращения ссылки.
- Ожидает обновления страницы.
- Извлекает сокращенную ссылку.
- Открывает новую вкладку с сокращенной ссылкой.
- Переключается на новую вкладку.
- Проверяет, начинается ли текущий URL с ожидаемой части. Если нет, закрывает вкладку с ошибочной ссылкой и возвращает `None`.
- Закрывает новую вкладку и переключается обратно на основную вкладку.
- Возвращает полученную сокращенную ссылку.
- В случае ошибки при получении короткого URL записывает сообщение в логгер.

```
```
```python
# Пример использования (в другом модуле):
from src.suppliers.aliexpress.scenarios.affiliate_links_shortener_scenario import get_short_affiliate_link
from src.webdriver import Driver

try:
    driver = Driver()
    shortened_url = get_short_affiliate_link(driver, "https://www.example.com")
    if shortened_url:
        print(f"Сокращенная ссылка: {shortened_url}")
    else:
        print("Не удалось сократить ссылку.")
    driver.quit()
except Exception as ex:
    print(f"Произошла ошибка: {ex}")
```

## Локаторы

Локаторы для взаимодействия с веб-страницей хранятся в файле `affiliate_links_shortener.json`.  Этот файл должен быть доступен в структуре `gs.path.src/suppliers/aliexpress/locators`.


```
```
```json
{
  "textarea_target_url": "xpath locator to input URL",
  "button_get_tracking_link": "xpath locator to button",
  "textarea_short_link": "xpath locator to output text area"
}
```

## Модули

- `pathlib`: Для работы с путями к файлам.
- `typing`: Для определения типов данных.
- `types`: Для работы с типами данных.
- `time`: Для работы с временем.
- `src.gs`: Для доступа к глобальным настройкам.
- `src.utils`: Для работы с JSON и другими утилитами.
- `src.logger`: Для логирования.
- `src.webdriver`: Для работы с веб-драйвером.


```
# Модуль для работы с AiChatOnline
## Обзор

Модуль предоставляет асинхронный интерфейс для взаимодействия с сервисом AiChatOnline, использующим модель `gpt-4o-mini`. Он позволяет генерировать ответы на основе предоставленных сообщений, используя асинхронные генераторы.

## Подробней

Этот модуль предназначен для интеграции с веб-сервисом AiChatOnline, который предоставляет API для генерации текста на основе модели GPT. Он использует `aiohttp` для выполнения асинхронных HTTP-запросов. Модуль включает в себя получение уникального идентификатора пользователя и отправку запросов на генерацию текста с использованием этого идентификатора. Данный модуль в проекте `hypotez` используется для расширения списка провайдеров, предоставляющих доступ к различным моделям.

## Функции

### `grab_token`

```python
    @classmethod
    async def grab_token(
        cls,
        session: ClientSession,
        proxy: str
    ) -> str:
        """ Асинхронно получает уникальный идентификатор пользователя с сайта AiChatOnline.

        Args:
            cls (AiChatOnline): Класс, для которого вызывается метод.
            session (ClientSession): Асинхровая HTTP-сессия для выполнения запросов.
            proxy (str): Адрес прокси-сервера для использования при выполнении запроса.

        Returns:
            str: Уникальный идентификатор пользователя, полученный из ответа сервера.

        Raises:
            aiohttp.ClientResponseError: Если HTTP-ответ содержит код ошибки.

        Как работает функция:
            1. Формируется URL для получения уникального идентификатора пользователя.
            2. Выполняется GET-запрос к указанному URL с использованием асинхронной сессии.
            3. Проверяется статус ответа и выбрасывается исключение в случае ошибки.
            4. Извлекается значение по ключу 'data' из JSON-ответа и возвращается.

        Flowchart:
        A[Формирование URL] --> B[GET-запрос к API]
        B --> C{HTTP-ошибка?}
        C -- Да --> D[Выброс исключения]
        C -- Нет --> E[Извлечение 'data' из JSON]
        E --> F[Возврат UniqueId]

        Примеры:
            >>> async with ClientSession() as session:
            ...     token = await AiChatOnline.grab_token(session, 'http://proxy:8080')
            ...     print(token)
            'some_unique_id'
        """
```

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        """ Создает асинхронный генератор для получения ответов от AiChatOnline.

        Args:
            cls (AiChatOnline): Класс, для которого вызывается метод.
            model (str): Модель для генерации текста.
            messages (Messages): Список сообщений для отправки в запросе.
            proxy (str, optional): Адрес прокси-сервера для использования. По умолчанию `None`.
            **kwargs: Дополнительные аргументы.

        Yields:
            str: Части сгенерированного сообщения от AiChatOnline.

        Raises:
            aiohttp.ClientResponseError: Если HTTP-ответ содержит код ошибки.

        Внутренние функции:
            Отсутствуют

        Как работает функция:
            1. Формируются заголовки запроса, включая User-Agent, Referer и Content-Type.
            2. Создается асинхронная HTTP-сессия с заданными заголовками.
            3. Формируется тело запроса с использованием `conversationId` и отформатированных сообщений.
            4. Получается уникальный идентификатор пользователя (`UniqueId`) с использованием метода `grab_token`.
            5. Выполняется POST-запрос к API AiChatOnline с заголовками, телом запроса и прокси (если указан).
            6. Для каждого чанка в ответе извлекается сообщение из JSON и передается в генератор.
            7. В случае ошибки при обработке чанка, она игнорируется и происходит переход к следующему чанку.

        Flowchart:
        A[Формирование заголовков] --> B[Создание HTTP-сессии]
        B --> C[Формирование тела запроса]
        C --> D[Получение UniqueId]
        D --> E[POST-запрос к API]
        E --> F[Обработка чанков ответа]
        F -- Успешно --> G[Извлечение сообщения из JSON]
        F -- Ошибка --> H[Пропуск чанка]
        G --> I[Передача сообщения в генератор]

        Примеры:
            >>> async for message in AiChatOnline.create_async_generator('gpt-4o-mini', [{'role': 'user', 'content': 'Hello'}], proxy='http://proxy:8080'):
            ...     print(message)
            'Hello, how can I help you?'
        """
```

## Классы

### `AiChatOnline`

**Описание**: Класс `AiChatOnline` предоставляет интерфейс для взаимодействия с сервисом AiChatOnline.

**Принцип работы**:
Класс использует асинхронные запросы для получения ответов от модели GPT, размещенной на AiChatOnline. Он наследует `AsyncGeneratorProvider` и `ProviderModelMixin`, что позволяет ему предоставлять ответы в виде асинхронного генератора и поддерживать выбор различных моделей.
   - `site_url` указывает на основной сайт AiChatOnline.
   - `url` указывает на URL-адрес API.
   - `api_endpoint` задает конкретный endpoint для запросов к API.
   - `working` указывает, работает ли в данный момент этот провайдер.
   - `default_model` задает модель по умолчанию для генерации ответов (`gpt-4o-mini`).

**Атрибуты**:
- `site_url` (str): URL основного сайта AiChatOnline.
- `url` (str): URL API AiChatOnline.
- `api_endpoint` (str): Endpoint API для запросов.
- `working` (bool): Указывает, работает ли провайдер.
- `default_model` (str): Модель по умолчанию (`gpt-4o-mini`).
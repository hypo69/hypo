# Модуль hypotez/src/endpoints/kazarinov/scenarios/scenario_pricelist.py

## Обзор

Данный модуль предоставляет функциональность для извлечения, парсинга и обработки данных о продуктах от различных поставщиков. Он обрабатывает подготовку данных, обработку с помощью ИИ и интеграцию с Facebook для публикации продуктов.

## Классы

### `Mexiron`

**Описание**: Класс `Mexiron` отвечает за извлечение, обработку и сохранение данных о продуктах от поставщиков. Поддерживает поставщиков: morlevi.co.il, ivory.co.il, ksp.co.il, grandadvance.co.il.

**Атрибуты**:

- `driver`: экземпляр класса `Driver` (Selenium WebDriver).
- `export_path`: путь к директории для сохранения данных.
- `mexiron_name`: имя текущего процесса.
- `price`: цена продукта.
- `timestamp`: отметка времени.
- `products_list`: список продуктов.
- `model`: экземпляр класса `GoogleGenerativeAI` для обработки данных ИИ.
- `model_command`: команда для модели ИИ.
- `config`: конфигурационный объект.

**Методы**:

#### `__init__`

**Описание**: Инициализирует класс `Mexiron` с необходимыми компонентами.

**Параметры**:

- `driver` (Driver): экземпляр класса `Driver`.
- `mexiron_name` (Optional[str], optional): имя процесса. По умолчанию - значение отметки времени.

**Возвращает**:
- None

**Обрабатывает исключения**:
- `Exception`: если возникла ошибка при загрузке конфигурации или построении пути сохранения.

#### `run_scenario`

**Описание**: Выполняет сценарий: парсит продукты, обрабатывает их с помощью ИИ и сохраняет данные.

**Параметры**:

- `system_instruction` (Optional[str], optional): системные инструкции для модели ИИ.
- `price` (Optional[str], optional): цена продукта.
- `mexiron_name` (Optional[str], optional): имя процесса.
- `urls` (Optional[str | List[str]], optional): URL-адреса страниц продуктов.
- `update` (Update, optional): Объект Update из Telegram.

**Возвращает**:
- `bool`: True, если сценарий выполнен успешно, иначе False.

**Обрабатывает исключения**:
- `Exception`: Если возникла ошибка при обработке URL, получении данных, конвертации или сохранении данных.


#### `get_graber_by_supplier_url`

**Описание**: Возвращает соответствующий грабер для заданного URL-адреса поставщика.

**Параметры**:
- `url` (str): URL-адрес страницы поставщика.

**Возвращает**:
- Optional[object]: Экземпляр класса Graber, если найден, иначе None.


#### `convert_product_fields`

**Описание**: Конвертирует поля продукта в словарь.

**Параметры**:
- `f` (ProductFields): объект, содержащий обработанные данные продукта.

**Возвращает**:
- dict: Форматированный словарь данных о продукте.


#### `save_product_data`

**Описание**: Сохраняет данные отдельного продукта в файл.

**Параметры**:
- `product_data` (dict): Форматированные данные продукта.

**Возвращает**:
- bool: True, если сохранение прошло успешно, иначе False.

**Обрабатывает исключения**:
- `Exception`: Если возникла ошибка при сохранении данных.


#### `process_ai`

**Описание**: Обрабатывает список продуктов с помощью модели ИИ.

**Параметры**:
- `products_list` (str): Список словарей данных о продуктах в виде строки.
- `attempts` (int, optional): Количество попыток повтора в случае неудачи. По умолчанию 3.

**Возвращает**:
- tuple: Обработанный ответ в форматах `ru` и `he`.
- bool: False, если невозможно получить действительный ответ после повторов.

**Обрабатывает исключения**:
- `Exception`: Если возникла ошибка при обработке ответа модели ИИ.


#### `post_facebook`

**Описание**: Исполняет сценарий рекламного модуля Facebook.

**Параметры**:
- `mexiron` (SimpleNamespace): Данные продукта для публикации.

**Возвращает**:
- bool: True, если публикация успешна, иначе None.


#### `create_report`

**Описание**: Генерирует отчет в форматах HTML и PDF.

**Параметры**:
- `data` (dict): Данные для отчета.
- `html_file` (Path): Путь к файлу отчета в формате HTML.
- `pdf_file` (Path): Путь к файлу отчета в формате PDF.

**Возвращает**:
- None


## Функции

(Список функций и их описаний будет добавлен, если есть другие функции кроме тех, которые являются методами класса)

## Дополнительные замечания

Модуль содержит обработку исключений `try...except`, а также логирование ошибок (`logger.error`). В нескольких местах присутствует многоточие (`...`) в комментариях, указывая на оставленные для доработки части кода или сценарии.
## Анализ кода модуля CODE_RULES.MD

**Качество кода**
7
-  Плюсы
    -  Документ содержит подробные инструкции по стилю кодирования, что способствует консистентности и улучшению читаемости кода.
    -  Инструкции охватывают важные аспекты, такие как использование комментариев, документации, форматирования кода, параметров функций, логирования и констант.
    -  Представлены конкретные примеры для пояснения требований и ожидаемого результата.

-  Минусы
    -  Некоторые инструкции могут быть более четкими, например, использование `j_loads` и `j_loads_ns`.
    -  Не хватает явного указания, как обрабатывать случаи, когда требуется рефакторинг значительной части кода, а не только добавление документации и комментариев.
    -  Отсутствует явное упоминание о необходимости проверки на наличие "мертвого" кода.
    -  Некоторые термины, такие как "typing" в контексте параметров, могут быть непонятны начинающим разработчикам.

**Рекомендации по улучшению**

1.  **Уточнить инструкции**:
    *   Добавить явное указание на использование `j_loads` и `j_loads_ns` из `src.utils.jjson` вместо `json.load` для чтения JSON файлов.
    *   Уточнить требования к именованию переменных и функций, а также соответствию имён импортам из других файлов.
2.  **Расширить примеры**:
    *   Добавить пример использования `j_loads` и `j_loads_ns`.
    *   Привести пример обработки исключений с использованием `logger.error` и `...` для отладки.
3.  **Улучшить структуру**:
    *   Разбить инструкцию на более логичные разделы, например, "Основные требования", "Стиль кодирования", "Документирование" и т.д.
4.  **Добавить проверку "мёртвого" кода**:
    *   Включить правило по удалению неиспользуемого кода.
5.  **Сделать терминологию более доступной**:
    *   Заменить термин "typing" на "аннотации типов" и привести примеры.
6.  **Уточнить порядок блоков в ответе**:
    *   Добавить точные требования к заголовку и расположению блоков в ответе (например, "Анализ кода", "Качество кода", "Рекомендации", "Оптимизированный код").

**Оптимизиробанный код**

```markdown
### Code Rules:

1.  **Общие принципы**
    -   Используйте единый стиль кодирования для улучшения читаемости и консистентности.
    -   Все изменения и рекомендации должны соответствовать этому формату.

---

2.  **Комментарии**
    -   **Комментарии после символа `#`**:
        -   **Не изменять**: Комментарии после символа `#` должны оставаться неизменными и быть понятными. Не переписывайте и не удаляйте их, даже если они начинаются с кода.
        -   **Информативные**: Внутренние комментарии должны быть информативными и объяснять следующий блок кода.
        -   **Формат**: Используйте формат reStructuredText (RST) для всех комментариев и документации.
        -   **Терминология**: Избегайте использования таких терминов, как \'получаем\', \'делаем\' в комментариях. Вместо этого используйте фразы, такие как \'проверка\', \'отправка\', \'код исполняет ...\'.
        -   **Пассивные формы**: Предпочитайте пассивные формы: \'копирование\', \'форматирование\', \'создание\' и т.д.
        -   **Пустые строки**: Если есть пустые строки или `...`, не документируйте их.

    -   **Комментарии после символа `"""`**:
        -   **Оптимизировать**: Комментарии после символа `"""` могут и должны быть оптимизированы на основе фактического поведения кода.

---

3.  **Документация**
    -   **Docstring**: Каждая функция, метод и класс должны иметь docstring в стиле Sphinx.
        -   Пример для функции:
            ```python
            def function(param: str, param1: Optional[str | dict] = None) -> dict | None:
                """
                Описание функции.

                :param param: Описание параметра `param`.
                :param param1: (Опционально) Описание параметра `param1`.
                :return: Описание возвращаемого значения.
                :raises SomeError: Условия для исключения.
                """
            ```
    -   **Описание модуля**: Добавьте описание модуля в начале каждого файла:
        ```python
        """
        Модуль для работы с ассистентом программиста
        =========================================================================================

        Описание функциональности модуля.

        Пример использования
        ---------------------

        .. code-block:: python

            example_usage()
        """
        ```

---

4.  **Форматирование кода**
    -   **Кавычки**: Используйте одинарные кавычки вместо двойных кавычек.
    -   **Пробелы**: Используйте пробелы вокруг оператора присваивания `=`. Пример:
        ```python
        a = 1
        ```
    -   **Консистентность**: Используйте пробелы консистентно во всех выражениях и присваиваниях:
        ```python
        result = 10 if x > 5 else 20
        ```
    -   **Заголовок импорта**: Всегда включайте строку `import header` в начале файла.
    -   **Отладка**: Добавляйте `...` между `logger` и `return` для отладки, пример:
        ```python
        logger.error('Ошибка при выполнении задачи', ex)
        ...
        return
        ```
    - **Использование `j_loads` и `j_loads_ns`**: Для чтения JSON файлов используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load`.

---

5.  **Параметры функций**
    -   **Аннотации типов**: Параметры должны иметь явные аннотации типов. Если значение по умолчанию `None`, используйте `Optional`. Пример:
        ```python
        def critical(self, message: str, ex: Optional = None, exc_info: Optional[bool] = True):
        ```
    -   **Избегать `Union`**: Избегайте использования `Union`.

---

6.  **Pydantic**
    -   **Валидация**: Используйте Pydantic для валидации данных, если это возможно и уместно.
    -   **Модели**: Предпочитайте модели Pydantic для классов, обрабатывающих структурированные данные.

---

7.  **Логирование**
    -   **Логгер**: Используйте `from src.logger.logger import logger` для логирования вместо стандартного `logging`.
    -   **Пример логирования ошибок**:
        ```python
        logger.error('Ошибка при запуске бота: ', ex)
        ...
        return
        ```

---

8.  **Константы**
    -   **MODE**: Всегда включайте глобальную константу `MODE` в коде, даже если она не используется.

---

9. **Проверка на "мертвый" код**
    - **Удаление**: Удаляйте неиспользуемый код.

---

### Response Format:

Все ответы должны соответствовать формату Markdown.

Структура ответа должна включать:

-   **Улучшенный код**: Блок с улучшенным кодом, отформатированным и с добавленными комментариями.
-   **Изменения**: Подробный список изменений и пояснений.

Код должен быть заключен в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).

---

### Примеры:

#### Пример 1 (Python Code):
Input:
```python
def add_numbers(a,b):
    return a+b
```

Expected response:

### Анализ кода модуля

**Качество кода**
9
- Плюсы:
    - Код соответствует требованиям по оформлению.
    - Код документирован в стиле RST.
    - Добавлены аннотации типов.

- Минусы:
    - Незначительные недочеты в форматировании.
    - Можно было добавить более подробное описание.

### Рекомендации по улучшению:
- Уточнить описание функции.
- Добавить более подробную документацию.

### Улучшенный код:
```python
def add_numbers(a: int, b: int) -> int:
    """
    Функция, складывающая два числа.

    :param a: Первое число.
    :type a: int
    :param b: Второе число.
    :type b: int
    :returns: Сумма чисел `a` и `b`.
    :rtype: int
    """
    return a + b
```

### Изменения:
- Добавлена документация в стиле RST для описания функции.
- Добавлены аннотации типов для `a` и `b`.
- Добавлены пробелы вокруг `+` и параметров функции для лучшей читаемости.

### Оптимизированный полный код:
```python
def add_numbers(a: int, b: int) -> int:
    """
    Функция, складывающая два числа.

    :param a: Первое число.
    :type a: int
    :param b: Второе число.
    :type b: int
    :returns: Сумма чисел `a` и `b`.
    :rtype: int
    """
    return a + b
```
```
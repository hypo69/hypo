# Модуль интеграции с Google Generative AI

## Обзор

Класс `GoogleGenerativeAI` предназначен для взаимодействия с моделями генеративного ИИ Google. Он предоставляет методы для отправки запросов, обработки ответов, управления диалогами и интеграции с различными функциями ИИ. Включает в себя надежную обработку ошибок, логирование и параметры конфигурации для обеспечения бесперебойной работы.

## Оглавление

* [GoogleGenerativeAI](#googlegenerativeai)
    * [__init__](#init)
    * [config](#config)
    * [_start_chat](#start_chat)
    * [_save_dialogue](#save_dialogue)
    * [ask](#ask)
    * [chat](#chat)
    * [describe_image](#describe_image)
    * [upload_file](#upload_file)
* [Обработка ошибок](#error-handling)
* [Логирование и история](#logging-and-history)
* [Зависимости](#dependencies)
* [Пример использования](#usage-example)


## Класс `GoogleGenerativeAI`

### `__init__(self, api_key: str, model_name: Optional[str] = None, generation_config: Optional[Dict] = None, system_instruction: Optional[str] = None, **kwargs)`

**Описание**: Инициализирует класс `GoogleGenerativeAI` необходимыми настройками.

**Детали**:
- Устанавливает API ключ, имя модели, конфигурацию генерации и системную инструкцию.
- Определяет пути для логирования диалогов и хранения истории.
- Инициализирует модель Google Generative AI.


### `config()`

**Описание**: Извлекает конфигурацию из файла настроек.

**Детали**:
- Читает и парсит файл конфигурации, расположенный по пути `gs.path.src / 'ai' / 'gemini' / 'generative_ai.json'`.


### `_start_chat(self)`

**Описание**: Запускает сеанс чата с моделью ИИ.

**Детали**:
- Инициализирует сеанс чата с пустой историей.


### `_save_dialogue(self, dialogue: list)`

**Описание**: Сохраняет диалог в текстовом и JSON файлах.

**Детали**:
- Добавляет каждую запись в диалоге в текстовый файл.
- Добавляет каждую запись в диалоге в формате JSON в JSON файл.


### `ask(self, q: str, attempts: int = 15) -> Optional[str]`

**Описание**: Отправляет текстовый запрос модели ИИ и получает ответ.

**Детали**:
- Обрабатывает несколько попыток в случае сетевых ошибок или недоступности сервиса.
- Логирует ошибки и повторяет попытки с экспоненциальным увеличением задержки.
- Сохраняет диалог в файлы истории.


### `chat(self, q: str) -> str`

**Описание**: Отправляет сообщение чата модели ИИ и получает ответ.

**Детали**:
- Использует сеанс чата, инициализированный методом `_start_chat`.
- Логирует ошибки и возвращает текст ответа.


### `describe_image(self, image_path: Path) -> Optional[str]`

**Описание**: Генерирует текстовое описание изображения.

**Детали**:
- Кодирует изображение в base64 и отправляет его модели ИИ.
- Возвращает сгенерированное описание или логирует ошибку, если операция не удалась.


### `upload_file(self, file: str | Path | IOBase, file_name: Optional[str] = None) -> bool`

**Описание**: Загружает файл в модель ИИ.

**Детали**:
- Обрабатывает загрузку файла и логирует успех или неудачу.
- Предоставляет механизм повторных попыток в случае ошибок.


## Обработка ошибок

Класс включает в себя исчерпывающую обработку ошибок для различных сценариев:
- Сетевые ошибки: Повторяет попытки с экспоненциальным увеличением задержки.
- Недоступность сервиса: Логирует ошибки и повторяет попытки.
- Превышение лимитов: Логирует и ожидает перед повторной попыткой.
- Ошибки аутентификации: Логирует и останавливает дальнейшие попытки.
- Некорректный ввод: Логирует и повторяет попытки с таймаутом.
- Ошибки API: Логирует и останавливает дальнейшие попытки.


## Логирование и история

Все взаимодействия с моделями ИИ регистрируются, а диалоги сохраняются в текстовом и JSON форматах для последующего анализа. Это гарантирует, что все операции отслеживаются и могут быть проанализированы для отладки или аудита.


## Зависимости

- `google.generativeai`
- `requests`
- `grpc`
- `google.api_core.exceptions`
- `google.auth.exceptions`
- `src.logger`
- `src.utils.printer`
- `src.utils.file`
- `src.utils.date_time`
- `src.utils.convertors.unicode`
- `src.utils.jjson`


## Пример использования

```python
ai = GoogleGenerativeAI(api_key="ваш_ключ_api", system_instruction="Инструкция")
response = ai.ask("Как дела?")
print(response)
```

Этот пример инициализирует класс `GoogleGenerativeAI` и отправляет запрос модели ИИ, выводит ответ.
```
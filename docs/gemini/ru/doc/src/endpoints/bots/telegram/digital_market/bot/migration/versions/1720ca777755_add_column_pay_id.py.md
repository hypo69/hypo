# Модуль миграции Alembic: добавление колонки `payment_id` в таблицу `purchases`

## Обзор

Данный модуль содержит скрипт миграции Alembic, предназначенный для добавления колонки `payment_id` в таблицу `purchases`. Он также включает логику для отката этого изменения, если это необходимо. Этот скрипт гарантирует, что колонка будет добавлена только в том случае, если она еще не существует, и удалена только в том случае, если она существует.

## Подробней

Этот скрипт миграции используется для изменения структуры базы данных, добавляя столбец `payment_id` в таблицу `purchases`. Скрипт включает в себя функции `upgrade` для применения изменений и `downgrade` для отмены изменений. Перед добавлением или удалением столбца скрипт проверяет, существует ли уже столбец, чтобы избежать ошибок.
Этот код важен для управления изменениями в схеме базы данных при развитии проекта. Он обеспечивает автоматизированный и контролируемый способ внесения изменений, а также возможность отката к предыдущей версии схемы.

## Функции

### `upgrade`

```python
def upgrade() -> None:
    """
    Функция для добавления колонки `payment_id` в таблицу `purchases`, если она еще не существует.
    """
```

**Описание**: Функция `upgrade` выполняет миграцию базы данных, добавляя столбец `payment_id` в таблицу `purchases`, если он еще не существует. Она также создает уникальное ограничение `uq_purchases_payment_id` для нового столбца.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- `sqlalchemy.exc.SQLAlchemyError`: В случае ошибки при выполнении операций с базой данных.

**Примеры**:

```python
# Пример вызова функции upgrade (обычно вызывается Alembic автоматически)
upgrade()
```

### `downgrade`

```python
def downgrade() -> None:
    """
    Функция для удаления колонки `payment_id` из таблицы `purchases`, если она существует.
    """
```

**Описание**: Функция `downgrade` выполняет откат миграции базы данных, удаляя столбец `payment_id` из таблицы `purchases`, если он существует. Она также удаляет уникальное ограничение `uq_purchases_payment_id`, связанное с этим столбцом.

**Параметры**:
- Нет

**Возвращает**:
- `None`

**Вызывает исключения**:
- `sqlalchemy.exc.SQLAlchemyError`: В случае ошибки при выполнении операций с базой данных.

**Примеры**:

```python
# Пример вызова функции downgrade (обычно вызывается Alembic автоматически)
downgrade()
```
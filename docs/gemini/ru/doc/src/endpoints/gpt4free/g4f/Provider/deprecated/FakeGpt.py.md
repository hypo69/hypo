# Модуль FakeGpt

## Обзор

Модуль `FakeGpt` предоставляет асинхронный класс `FakeGpt`, который является провайдером для работы с API, имитирующим GPT. Он использует `aiohttp` для выполнения асинхронных HTTP-запросов и предназначен для интеграции с другими частями проекта, требующими доступа к API для генерации текста. Класс поддерживает модель `gpt-3.5-turbo`.

## Подробней

Этот модуль предназначен для взаимодействия с API, предоставляющим функциональность, аналогичную GPT, но с использованием другого сервиса (`chat-shared2.zhile.io`). Он включает в себя механизмы для аутентификации, установки куки и отправки запросов на генерацию текста. Модуль обрабатывает ответы в формате `text/event-stream` и извлекает сгенерированный текст.

## Классы

### `FakeGpt`

**Описание**: Класс `FakeGpt` является асинхронным провайдером, взаимодействующим с API `chat-shared2.zhile.io`. Он наследуется от `AsyncGeneratorProvider` и предоставляет методы для создания асинхронного генератора, который отправляет запросы к API и возвращает сгенерированный текст.

**Принцип работы**:

1.  Класс инициализируется с базовыми настройками, такими как URL, поддержка `gpt-3.5-turbo`, и начальные значения для токена доступа и куки.
2.  Метод `create_async_generator` создает асинхронный генератор, который сначала получает токен доступа (если он еще не получен), а затем отправляет запрос с сообщением пользователя к API.
3.  API возвращает поток данных, который обрабатывается для извлечения сгенерированного текста.
4.  Полученный текст передается через генератор.

**Атрибуты**:

*   `url` (str): URL API (`https://chat-shared2.zhile.io`).
*   `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo` (значение `True`).
*   `working` (bool): Указывает, работает ли провайдер в данный момент (значение `False`).
*   `_access_token` (Optional[str]): Приватный атрибут для хранения токена доступа.
*   `_cookie_jar` (Optional[CookieJar]): Приватный атрибут для хранения куки.

**Методы**:

*   `create_async_generator`: Создает асинхронный генератор для взаимодействия с API.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        ...
```

**Назначение**: Создает асинхронный генератор для взаимодействия с API `chat-shared2.zhile.io`.

**Параметры**:

*   `cls` (FakeGpt): Ссылка на класс.
*   `model` (str): Модель, используемая для генерации текста.
*   `messages` (Messages): Список сообщений для отправки в API.
*   `proxy` (Optional[str], optional): Прокси-сервер для использования при подключении к API. По умолчанию `None`.
*   `**kwargs`: Дополнительные параметры.

**Возвращает**:

*   `AsyncResult`: Асинхронный генератор, возвращающий сгенерированный текст.

**Вызывает исключения**:

*   `RuntimeError`: Если не получен корректный ответ от API.

**Как работает функция**:

1.  Формируются заголовки запроса, включающие информацию о браузере, платформе и версии Chrome.
2.  Создается асинхронная сессия `ClientSession` с использованием указанных заголовков и куки.
3.  Если токен доступа отсутствует, он получается путем выполнения нескольких запросов к API:
    *   Запрос к `/api/loads` для получения списка токенов.
    *   Выбор случайного токена и отправка запроса к `/auth/login` для аутентификации.
    *   Запрос к `/api/auth/session` для получения токена доступа и обновления куки.
4.  Формируется тело запроса с использованием предоставленных сообщений, UUID и других параметров.
5.  Отправляется POST-запрос к `/api/conversation` с сформированными заголовками и телом запроса.
6.  Полученный поток данных обрабатывается построчно:
    *   Каждая строка, начинающаяся с `data: `, декодируется и преобразуется из JSON.
    *   Извлекается сгенерированный текст из поля `parts` и передается через генератор.
7.  Если не получен ни один корректный ответ, вызывается исключение `RuntimeError`.

**Внутренние функции**:
Внутри фунции нет внутренних функций

**Примеры**:

```python
# Пример использования create_async_generator
import asyncio
from typing import AsyncGenerator, List, Dict, Any, Optional

from g4f.Provider.deprecated.FakeGpt import FakeGpt
from g4f.typing import Messages

async def main():
    messages: Messages = [{"role": "user", "content": "Привет, как дела?"}]
    model: str = "gpt-3.5-turbo"
    proxy: Optional[str] = None  # Замените на ваш прокси, если необходимо

    generator: AsyncGenerator[str, None] = await FakeGpt.create_async_generator(
        model=model,
        messages=messages,
        proxy=proxy
    )

    try:
        async for message in generator:
            print(message, end="")
    except Exception as ex:
        print(f"Произошла ошибка: {ex}")

if __name__ == "__main__":
    asyncio.run(main())
```

## ASCII flowchart функции `create_async_generator`

```
A: Начало
│
B: Проверка наличия токена доступа
│
C: Токен есть?
├── Нет → D: Получение списка токенов с /api/loads
│   │
│   E: Выбор случайного токена
│   │
│   F: Запрос аутентификации к /auth/login
│   │
│   G: Получение токена доступа с /api/auth/session
│   │
│   H: Сохранение токена доступа и куки
│   │
└── Да
│
I: Формирование заголовков запроса
│
J: Формирование тела запроса
│
K: Отправка POST-запроса к /api/conversation
│
L: Обработка потока данных
│
M: Извлечение сгенерированного текста
│
N: Передача текста через генератор
│
O: Конец
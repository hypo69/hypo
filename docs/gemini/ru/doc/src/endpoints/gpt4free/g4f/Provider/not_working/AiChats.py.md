# Модуль `AiChats`

## Обзор

Модуль `AiChats` предоставляет асинхронный интерфейс для взаимодействия с сервисом ai-chats.org. Он поддерживает как текстовые запросы через модель `gpt-4`, так и запросы на генерацию изображений через модель `dalle`. Модуль использует `aiohttp` для асинхронных HTTP-запросов.

## Подробнее

Этот модуль является частью проекта `hypotez` и предназначен для интеграции с другими компонентами, требующими взаимодействия с AI-моделями ai-chats.org. Он предоставляет функциональность для отправки сообщений и получения ответов в асинхронном режиме, что позволяет эффективно использовать ресурсы и избегать блокировок при выполнении запросов.

## Классы

### `AiChats`

**Описание**:
Класс `AiChats` реализует асинхронного провайдера, который взаимодействует с API сервиса ai-chats.org. Он поддерживает генерацию текста и изображений на основе предоставленных сообщений.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую асинхронную генерацию.
- `ProviderModelMixin`: Добавляет поддержку выбора модели.

**Атрибуты**:
- `url` (str): Базовый URL сервиса ai-chats.org.
- `api_endpoint` (str): URL API для отправки запросов.
- `working` (bool): Указывает, работает ли провайдер в данный момент (в данном случае `False`).
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений (`True`).
- `default_model` (str): Модель, используемая по умолчанию (`gpt-4`).
- `models` (List[str]): Список поддерживаемых моделей (`gpt-4`, `dalle`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API.
- `create_async`: Отправляет запрос и возвращает результат (текст или URL изображения).

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для взаимодействия с API ai-chats.org.

    Args:
        model (str): Модель для использования (`gpt-4` или `dalle`).
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий ответы от API.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.

    Как работает функция:
    1. Функция устанавливает необходимые заголовки для HTTP-запроса.
    2. В зависимости от выбранной модели (`dalle` или `gpt-4`) формируется тело запроса.
    3. Отправляется POST-запрос к API ai-chats.org.
    4. Для модели `dalle`:
       - Обрабатывается JSON-ответ, извлекается URL изображения.
       - Полученное изображение кодируется в формат Base64 и возвращается в виде `ImageResponse`.
    5. Для модели `gpt-4`:
       - Полученный текст обрабатывается построчно и возвращается.
    6. При возникновении ошибок возвращается сообщение об ошибке.

    Внутренние функции:
    - Отсутствуют

    """
```

**Как работает функция**:

```
A: Установка заголовков
|
B: Определение типа запроса (изображение/текст)
|
C: Отправка POST-запроса к API
|
D: Обработка ответа (в зависимости от типа)
|
E: Генерация результата (ImageResponse/текст)
```

**Примеры**:

```python
# Пример использования для модели dalle (генерация изображения)
async for response in AiChats.create_async_generator(model='dalle', messages=[{'content': 'cat'}]):
    print(response)

# Пример использования для модели gpt-4 (генерация текста)
async for response in AiChats.create_async_generator(model='gpt-4', messages=[{'role': 'user', 'content': 'Hello'}]):
    print(response)
```

### `create_async`

```python
@classmethod
async def create_async(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> str:
    """
    Отправляет запрос к API ai-chats.org и возвращает результат.

    Args:
        model (str): Модель для использования (`gpt-4` или `dalle`).
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        str: Текст ответа или URL сгенерированного изображения.

    Как работает функция:
    1. Функция вызывает `create_async_generator` для получения асинхронного генератора.
    2. Перебирает ответы, возвращаемые генератором.
    3. Если ответ является типом `ImageResponse`, возвращается URL первого изображения.
    4. В противном случае возвращается текстовый ответ.

    Внутренние функции:
    - Отсутствуют

    """
```

**Как работает функция**:

```
A: Вызов create_async_generator
|
B: Перебор ответов генератора
|
C: Проверка типа ответа (ImageResponse/текст)
|
D: Возврат результата (URL изображения/текст)
```

**Примеры**:

```python
# Пример использования для модели dalle (генерация изображения)
image_url = await AiChats.create_async(model='dalle', messages=[{'content': 'cat'}])
print(image_url)

# Пример использования для модели gpt-4 (генерация текста)
text = await AiChats.create_async(model='gpt-4', messages=[{'role': 'user', 'content': 'Hello'}])
print(text)
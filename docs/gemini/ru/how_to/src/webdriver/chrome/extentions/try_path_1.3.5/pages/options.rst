Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код отвечает за загрузку и сохранение настроек для расширения, работающего с веб-драйвером Chrome. Он запрашивает настройки из хранилища, устанавливает значения в поля формы, обрабатывает валидацию введённых значений, сохраняет изменённые параметры в хранилище и предоставляет возможность выбора значения по умолчанию.

Шаги выполнения
-------------------------
1. **Загрузка настроек:** Функция `browser.runtime.sendMessage({ "event": "loadOptions" })` отправляет сообщение в контекст расширения, чтобы получить текущие настройки.
2. **Установка значений:** Полученные настройки (атрибуты и CSS) устанавливаются в соответствующие поля формы.
3. **Обработка событий сохранения:** При нажатии на кнопку "save" происходит валидация введённых данных.
4. **Валидация атрибутов:** `isValidAttrNames` проверяет валидность имен атрибутов.
5. **Валидация стилей:** `isValidStyleLength` проверяет корректность значений ширины и высоты.
6. **Сохранение настроек:** Если валидация успешна, функция `browser.storage.sync.set` сохраняет обновлённые настройки (атрибуты, CSS и CSS попапа) в хранилище браузера.
7. **Обработка ошибок:** `catch`-блоке обрабатываются ошибки, возникающие при сохранении, выводя сообщение об ошибке.
8. **Загрузка значений по умолчанию:**  При нажатии на кнопку "show-default" функция загружает значения по умолчанию из `defaultAttributes` и `defaultPopupBodyStyles`, переустанавливает поля формы.
9. **Загрузка CSS по умолчанию:** Функция `loadDefaultCss` загружает CSS по умолчанию из файла `/css/try_xpath_insert.css`.


Пример использования
-------------------------
.. code-block:: javascript
    
    // Предполагается, что переменные elementAttr, contextAttr, ...  уже объявлены и инициализированы
    // ... (ваш код для создания элементов формы) ...
    
    document.getElementById("save").addEventListener("click", () => {
        // ... (код валидации как в коде примера) ...
        
        if (isValidAttrNames(attrs) && isValidStyleLength(bodyStyles.width) && isValidStyleLength(bodyStyles.height)) {
            browser.storage.sync.set({
                "attributes": attrs,
                "css": style.value,
                "popupCss": createPopupCss(bodyStyles)
            }).then(() => {
                message.textContent = "Настройки сохранены.";
            }).catch(err => {
                message.textContent = "Ошибка сохранения: " + err.message;
            });
        }
    });
# Модуль для работы с базой данных бота ToolBox

## Обзор

Модуль предоставляет класс `DataBase` для управления базой данных SQLite, используемой ботом ToolBox. Он включает функции для создания таблицы, вставки и обновления данных, а также загрузки данных из базы данных в словарь.

## Подробнее

Этот модуль предназначен для упрощения работы с базой данных бота ToolBox. Он предоставляет интерфейс для выполнения основных операций, таких как создание таблиц, добавление, обновление и чтение данных. Класс `DataBase` инкапсулирует логику подключения к базе данных, выполнения запросов и преобразования данных.

## Классы

### `DataBase`

**Описание**:
Класс для управления базой данных SQLite.

**Как работает класс**:
Класс `DataBase` инициализируется с именем базы данных, именем таблицы и словарем, определяющим структуру таблицы (названия столбцов и их типы данных). Он предоставляет методы для создания таблицы, вставки или обновления данных, а также загрузки данных из базы данных в словарь.

**Методы**:

- `__init__(self, db_name: str, table_name: str, titles: dict[str, str]) -> None`
  - Инициализирует класс `DataBase` с указанными параметрами.
    - **Параметры**:
      - `db_name` (str): Имя файла базы данных.
      - `table_name` (str): Имя таблицы в базе данных.
      - `titles` (dict[str, str]): Словарь, определяющий структуру таблицы (названия столбцов и их типы данных).
    - **Как работает метод**:
      - Метод сохраняет значения параметров в атрибуты экземпляра класса.
      - Определяет словарь `self.types`, который содержит функции для преобразования значений из базы данных в соответствующие типы данных Python.

- `create(self) -> None`
  - Создает таблицу в базе данных, если она не существует.
    - **Как работает метод**:
      - Устанавливает соединение с базой данных.
      - Выполняет SQL-запрос `CREATE TABLE IF NOT EXISTS` для создания таблицы с указанным именем и структурой.
      - Закрывает соединение с базой данных.

- `insert_or_update_data(self, record_id: str, values: dict[str, list[bool|int]|bool|int|str]) -> None`
  - Вставляет или обновляет данные в таблице.
    - **Параметры**:
      - `record_id` (str): Значение первичного ключа записи.
      - `values` (dict[str, list[bool|int]|bool|int|str]): Словарь со значениями для вставки или обновления.
    -  **Как работает метод**:
      1.  Устанавливает соединение с базой данных.
      2.  Формирует строку плейсхолдеров `?` для SQL-запроса, количество которых соответствует количеству столбцов в таблице.
      3.  Генерирует SQL-запрос `REPLACE INTO` для вставки или обновления данных.
          - Если запись с указанным `record_id` уже существует, она будет обновлена.
          - Если запись не существует, она будет создана.
      4.  Подготавливает значения для вставки в запрос.
          - Если значение является списком, оно преобразуется в строку JSON, а затем оборачивается в фигурные скобки.
          - Если значение не является списком, оно остается без изменений.
      5.  Выполняет SQL-запрос с подготовленными значениями.
      6.  Сохраняет изменения и закрывает соединение с базой данных.
- `load_data_from_db(self) -> dict[str, dict[str, list[bool|int]|bool|int|str]]`
  - Загружает данные из базы данных в словарь.
    - **Возвращает**:
      - `dict[str, dict[str, list[bool|int]|bool|int|str]]`: Словарь, где ключи - это значения первичного ключа, а значения - это словари с данными записи.
    - **Как работает метод**:
      1.  Инициализирует пустой словарь `loaded_data` для хранения загруженных данных.
      2.  Устанавливает соединение с базой данных.
      3.  Выполняет SQL-запрос `SELECT` для извлечения всех данных из таблицы.
      4.  Перебирает строки, полученные из базы данных.
      5.  Извлекает значение первичного ключа из каждой строки.
      6.  Для каждой строки создает словарь, где ключи - это названия столбцов, а значения - это значения из строки, преобразованные в соответствующие типы данных с использованием словаря `self.types`.
      7.  Добавляет словарь записи в словарь `loaded_data`, используя значение первичного ключа в качестве ключа.
      8.  Закрывает соединение с базой данных.
      9.  Возвращает словарь `loaded_data`.

## Функции

### `if __name__ == "__main__":`

**Описание**:
Данный блок кода предназначен для демонстрации работы с базой данных. Он создает экземпляр класса `DataBase`, создает таблицу, загружает данные из базы данных и позволяет пользователю добавлять или обновлять записи.

**Как работает функция**:

1. Создает экземпляр класса `DataBase` с указанными параметрами (имя базы данных, имя таблицы, структура таблицы).
2. Вызывает метод `create` для создания таблицы в базе данных, если она не существует.
3. Вызывает метод `load_data_from_db` для загрузки данных из базы данных в словарь.
4. Запрашивает у пользователя ввод значения первичного ключа (`uid`).
5. Если пользователь ввел значение, проверяет, содержит ли оно подстроку "pro" или "admin".
   - Если содержит "pro", создает запись с предопределенными значениями для профессионального аккаунта.
   - Если содержит "admin", создает запись с предопределенными значениями для администратора.
   - В противном случае создает запись с предопределенными значениями для обычного пользователя.
6. Вызывает метод `insert_or_update_data` для вставки или обновления записи в базе данных.
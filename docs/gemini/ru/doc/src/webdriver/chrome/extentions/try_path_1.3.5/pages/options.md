# Модуль options.js

## Обзор

Этот модуль JavaScript отвечает за обработку пользовательских настроек расширения. Он получает значения атрибутов, CSS и стилей тела всплывающего окна из хранилища браузера, отображает их в форме, и позволяет пользователю сохранить изменения.  При нажатии кнопки "Сохранить"  данные сохраняются в хранилище браузера. Также предусмотрена функция загрузки значений по умолчанию.


## Функции

### `isValidAttrName`

**Описание**: Проверяет, является ли имя атрибута валидным.

**Параметры**:

- `name` (str): Имя атрибута.

**Возвращает**:

- `boolean`: `true`, если имя атрибута валидное, `false` иначе.

**Обрабатывает исключения**:

- `e`:  Возможные исключения при установке атрибута.


### `isValidAttrNames`

**Описание**: Проверяет, являются ли все имена атрибутов валидными.

**Параметры**:

- `names` (object): Объект, содержащий имена атрибутов.

**Возвращает**:

- `boolean`: `true`, если все имена атрибутов валидны, `false` иначе.


### `isValidStyleLength`

**Описание**: Проверяет валидность значения длины CSS.

**Параметры**:

- `len` (str): Значение длины CSS.

**Возвращает**:

- `boolean`: `true`, если длина валидна, `false` иначе.


### `loadDefaultCss`

**Описание**: Загружает значения CSS по умолчанию.

**Возвращает**:

- `Promise<string>`: Обещание, содержащее строку CSS.

**Обрабатывает исключения**:

- `ex`: Обработка возможных ошибок при выполнении запроса.


### `extractBodyStyles`

**Описание**: Извлекает значения ширины и высоты из строки CSS.

**Параметры**:

- `css` (str): Строка CSS.

**Возвращает**:

- `object`: Объект с шириной и высотой.

**Обрабатывает исключения**:

-  Нет.


### `createPopupCss`

**Описание**: Создает строку CSS для стилей всплывающего окна.

**Параметры**:

- `bodyStyles` (object): Объект с шириной и высотой.

**Возвращает**:

- `string`: Строка CSS для стилей всплывающего окна.


### Обработчик события `load`

**Описание**: Выполняет инициализацию и привязку обработчиков событий после загрузки страницы.

**Параметры**:

- Нет.

**Обрабатывает исключения**:

- `fu.onError`: Обработка возможных ошибок.


### Обработчик клика по кнопке "Сохранить"

**Описание**: Обрабатывает нажатие кнопки "Сохранить", сохраняет новые значения в хранилище браузера и выводит сообщение об успехе или ошибке.

**Параметры**:

- Нет.

**Обрабатывает исключения**:

- `err`: Обработка возможных ошибок при сохранении.


### Обработчик клика по кнопке "Показать значения по умолчанию"

**Описание**: Загружает значения атрибутов и стилей по умолчанию.

**Параметры**:

- Нет.

**Обрабатывает исключения**:

- `fu.onError`: Обработка возможных ошибок.


## Переменные

**Описание**: Определение глобальных переменных, используемых в модуле.

- `elementAttr`, `contextAttr`, `focusedAttr`, `ancestorAttr`, `frameAttr`, `frameAncestorAttr`: Переменные, хранящие ссылки на HTML-элементы.
- `style`, `popupBodyWidth`, `popupBodyHeight`, `message`: Переменные, хранящие ссылки на HTML-элементы.
- `defaultAttributes`, `defaultPopupBodyStyles`:  Объекты, содержащие значения атрибутов и стилей по умолчанию.


## Используемые API

- `browser.runtime.getURL()`: Получение URL ресурсов расширения.
- `XMLHttpRequest`: Загрузка данных с сервера.
- `browser.storage.sync.set()`: Сохранение данных в хранилище браузера.
- `browser.runtime.sendMessage()`: Отправка сообщений в другую часть расширения.
- `window.addEventListener()`:  Регистрация обработчиков событий.
# Документация для модуля `backend.py`

## Обзор

Этот модуль содержит юнит-тесты для backend API, используемого в графическом интерфейсе (GUI) проекта `hypotez`. Он проверяет основные функциональности API, такие как получение информации о версии, моделей, провайдеров, а также функцию поиска.

## Подробней

Этот модуль предназначен для автоматизированного тестирования API, обеспечивающего работу графического интерфейса. Тесты проверяют корректность возвращаемых данных и обрабатывают возможные исключения, связанные с отсутствием необходимых зависимостей или проблемами при выполнении поисковых запросов.

## Классы

### `TestBackendApi`

**Описание**: Класс `TestBackendApi` содержит набор тестов для проверки функциональности API, предоставляемого классом `Backend_Api`.

**Наследует**:
Этот класс наследует `unittest.TestCase`, предоставляя структуру для создания и запуска тестов.

**Атрибуты**:
- `app`: `MagicMock` - Мок-объект, представляющий приложение. Используется для имитации взаимодействия с приложением в тестах.
- `api`: `Backend_Api` - Экземпляр класса `Backend_Api`, который тестируется.

**Методы**:
- `setUp()`: Подготавливает тестовую среду перед каждым тестом.
- `test_version()`: Тестирует метод `get_version()`.
- `test_get_models()`: Тестирует метод `get_models()`.
- `test_get_providers()`: Тестирует метод `get_providers()`.
- `test_search()`: Тестирует функцию `search()`.

### `DuckDuckGoSearchException`

**Описание**: Класс `DuckDuckGoSearchException` используется для обработки исключений, связанных с поиском DuckDuckGo.
Если библиотека `duckduckgo_search` не установлена, создается пустой класс для предотвращения ошибок импорта.

## Функции

### `setUp`

```python
def setUp(self):
    """
    Подготавливает тестовую среду перед каждым тестом.
    Проверяет наличие необходимых зависимостей для графического интерфейса.
    Если зависимости отсутствуют, тест пропускается.
    Создает мок-объект приложения и экземпляр класса Backend_Api для тестирования.
    """
```

**Как работает функция**:

1.  **Проверка зависимостей**: Функция проверяет, установлены ли необходимые зависимости для работы с графическим интерфейсом (GUI). Это делается путем проверки значения переменной `has_requirements`.

2.  **Пропуск теста**: Если `has_requirements` равно `False`, это означает, что необходимые зависимости отсутствуют. В этом случае функция вызывает `self.skipTest("gui is not installed")`, чтобы пропустить текущий тест.

3.  **Создание мок-объекта**: Если зависимости установлены, функция создает мок-объект `self.app` с использованием `MagicMock()`. Этот объект имитирует приложение, с которым взаимодействует API.

4.  **Создание экземпляра API**: Функция создает экземпляр класса `Backend_Api` с мок-объектом приложения `self.app` и присваивает его переменной `self.api`. Этот экземпляр будет использоваться для тестирования методов API.

**Примеры**:

```python
class TestBackendApi(unittest.TestCase):

    def setUp(self):
        if not has_requirements:
            self.skipTest("gui is not installed")
        self.app = MagicMock()
        self.api = Backend_Api(self.app)
```

### `test_version`

```python
def test_version(self):
    """
    Тестирует метод get_version() класса Backend_Api.
    Проверяет, что возвращаемый словарь содержит ключи "version" и "latest_version".
    """
```

**Как работает функция**:

1.  **Вызов метода**: Вызывается метод `get_version()` у экземпляра класса `Backend_Api` (который был создан в `setUp`) и результат сохраняется в переменной `response`.

2.  **Проверка наличия ключей**: Функция проверяет, содержит ли возвращенный словарь `response` ключи `"version"` и `"latest_version"`. Это делается с использованием `self.assertIn()`, который проверяет наличие указанного ключа в словаре. Если хотя бы один из ключей отсутствует, тест завершится с ошибкой.

**Примеры**:

```python
def test_version(self):
    response = self.api.get_version()
    self.assertIn("version", response)
    self.assertIn("latest_version", response)
```

### `test_get_models`

```python
def test_get_models(self):
    """
    Тестирует метод get_models() класса Backend_Api.
    Проверяет, что возвращается список и что список не пуст.
    """
```

**Как работает функция**:

1.  **Вызов метода**: Вызывается метод `get_models()` у экземпляра класса `Backend_Api` (который был создан в `setUp`) и результат сохраняется в переменной `response`.

2.  **Проверка типа**: Функция проверяет, является ли возвращенное значение `response` экземпляром класса `list`. Это делается с использованием `self.assertIsInstance()`, который проверяет, что объект принадлежит указанному типу. Если `response` не является списком, тест завершится с ошибкой.

3.  **Проверка непустоты**: Функция проверяет, что длина списка `response` больше 0, то есть список не пуст. Это делается с использованием `self.assertTrue()`, который проверяет, что указанное условие истинно. Если список пуст, тест завершится с ошибкой.

**Примеры**:

```python
def test_get_models(self):
    response = self.api.get_models()
    self.assertIsInstance(response, list)
    self.assertTrue(len(response) > 0)
```

### `test_get_providers`

```python
def test_get_providers(self):
    """
    Тестирует метод get_providers() класса Backend_Api.
    Проверяет, что возвращается список и что список не пуст.
    """
```

**Как работает функция**:

1.  **Вызов метода**: Вызывается метод `get_providers()` у экземпляра класса `Backend_Api` (который был создан в `setUp`) и результат сохраняется в переменной `response`.

2.  **Проверка типа**: Функция проверяет, является ли возвращенное значение `response` экземпляром класса `list`. Это делается с использованием `self.assertIsInstance()`, который проверяет, что объект принадлежит указанному типу. Если `response` не является списком, тест завершится с ошибкой.

3.  **Проверка непустоты**: Функция проверяет, что длина списка `response` больше 0, то есть список не пуст. Это делается с использованием `self.assertTrue()`, который проверяет, что указанное условие истинно. Если список пуст, тест завершится с ошибкой.

**Примеры**:

```python
def test_get_providers(self):
    response = self.api.get_providers()
    self.assertIsInstance(response, list)
    self.assertTrue(len(response) > 0)
```

### `test_search`

```python
def test_search(self):
    """
    Тестирует функцию search() из модуля g4f.gui.server.internet.
    Проверяет, что возвращаемый результат поиска имеет длину больше 0.
    Пропускает тест, если отсутствуют необходимые зависимости или возникла ошибка при выполнении поискового запроса.
    """
```

**Как работает функция**:

1.  **Импорт функции**: Импортируется функция `search` из модуля `g4f.gui.server.internet`.

2.  **Выполнение поиска**: Функция пытается выполнить поисковой запрос `"Hello"` с использованием `asyncio.run(search("Hello"))` и сохраняет результат в переменной `result`.

3.  **Обработка исключений**:
    *   Если возникает исключение `DuckDuckGoSearchException` (например, из-за проблем с сетью или API DuckDuckGo), тест пропускается с сообщением об ошибке.
    *   Если возникает исключение `MissingRequirementsError` (например, если не установлены необходимые библиотеки для поиска), тест также пропускается.

4.  **Проверка результата**: Если поиск выполнен успешно и не было исключений, функция проверяет, что длина результата `result` больше 0, то есть возвращенный результат не пуст. Это делается с использованием `self.assertGreater()`, который проверяет, что первое значение больше второго. Если результат пуст, тест завершится с ошибкой.

**Примеры**:

```python
def test_search(self):
    from g4f.gui.server.internet import search
    try:
        result = asyncio.run(search("Hello"))
    except DuckDuckGoSearchException as e:
        self.skipTest(e)
    except MissingRequirementsError:
        self.skipTest("search is not installed")
    self.assertGreater(len(result), 0)
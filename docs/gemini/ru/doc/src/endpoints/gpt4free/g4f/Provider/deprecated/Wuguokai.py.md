# Модуль `Wuguokai`

## Обзор

Модуль предоставляет класс `Wuguokai`, который является провайдером для доступа к модели GPT-3.5 Turbo через API `chat.wuguokai.xyz`. Этот модуль предназначен для интеграции с другими частями проекта, использующими абстрактный класс `AbstractProvider`.

## Подробнее

Модуль содержит класс `Wuguokai`, который наследуется от `AbstractProvider`. Он использует библиотеку `requests` для выполнения HTTP-запросов к API `chat.wuguokai.xyz`.  Модуль определяет статический метод `create_completion`, который отправляет запросы к API и возвращает результаты генерации текста.

## Классы

### `Wuguokai`

**Описание**: Класс `Wuguokai` предоставляет интерфейс для взаимодействия с API `chat.wuguokai.xyz`. Он наследуется от `AbstractProvider` и реализует метод `create_completion` для отправки запросов и получения ответов от модели GPT-3.5 Turbo.

**Наследует**:

- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для всех провайдеров.

**Атрибуты**:

- `url` (str): URL API `chat.wuguokai.xyz`.
- `supports_gpt_35_turbo` (bool): Указывает, что провайдер поддерживает модель GPT-3.5 Turbo.
- `working` (bool):  Указывает, находится ли провайдер в рабочем состоянии.

**Методы**:

- `create_completion()`: Статический метод для создания запроса к API и получения ответа.

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool,
    **kwargs: Any,
) -> CreateResult:
    """
    Создает запрос к API `chat.wuguokai.xyz` и возвращает ответ.

    Args:
        model (str): Имя модели для использования.
        messages (list[dict[str, str]]): Список сообщений для отправки в API.
        stream (bool): Флаг, указывающий, следует ли использовать потоковую передачу.
        **kwargs (Any): Дополнительные аргументы.

    Returns:
        CreateResult: Результат запроса к API.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.

    """
```

**Назначение**: Метод `create_completion` отправляет POST-запрос к API `chat.wuguokai.xyz` с использованием библиотеки `requests`. Он форматирует входные сообщения, добавляет необходимые заголовки и обрабатывает ответ от API. Если запрос успешен, метод возвращает результат генерации текста. В случае ошибки выбрасывается исключение.

**Параметры**:

- `model` (str): Имя модели для использования.
- `messages` (list[dict[str, str]]): Список сообщений для отправки в API.
- `stream` (bool): Флаг, указывающий, следует ли использовать потоковую передачу.
- `**kwargs` (Any): Дополнительные аргументы, такие как прокси.

**Возвращает**:

- `CreateResult`: Результат запроса к API.

**Вызывает исключения**:

- `Exception`: Если возникает ошибка при выполнении запроса.

**Как работает функция**:

1. **Формирование заголовков**: Создается словарь `headers` с необходимыми HTTP-заголовками для запроса.
2. **Формирование данных**: Создается словарь `data`, включающий отформатированные сообщения, параметры и идентификатор пользователя.
3. **Отправка запроса**: Отправляется POST-запрос к API `https://ai-api20.wuguokai.xyz/api/chat-process` с использованием библиотеки `requests`.
4. **Обработка ответа**:  Проверяется статус код ответа. Если код не равен 200, выбрасывается исключение.
5. **Разделение ответа**:  Разделяется текст ответа на части, используя разделитель "> 若回答失败请重试或多刷新几次界面后重试".
6. **Извлечение результата**: Извлекается первая или вторая часть разделенного текста в зависимости от количества частей.
7. **Возврат результата**: Возвращается результат в виде итератора, содержащего очищенный текст.

```ascii
    Формирование заголовков   Формирование данных
        │                         │
        ▼                         ▼
    headers                 data
        │                         │
        │    Отправка POST-запроса   │
        └───────────────────► requests.post()
                                  │
                                  ▼
                           Обработка ответа
                                  │
                      Статус код == 200 ?
                                  │
                  ┌─────────────────┴─────────────────┐
                  │          ДА                       НЕТ
                  │                                  │
                  ▼                                  ▼
       Разделение ответа              Выброс исключения
                  │                                  │
                  ▼                                  │
       Извлечение результата                         │
                  │                                  │
                  ▼                                  │
           Возврат результата ◄──────────────────────┘
```

**Примеры**:

```python
# Пример вызова функции create_completion
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = False
kwargs = {}

result = Wuguokai.create_completion(model, messages, stream, **kwargs)
for item in result:
    print(item)
```
```python
# Пример вызова функции create_completion с прокси
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = False
kwargs = {"proxy": {"http": "http://your_proxy", "https": "https://your_proxy"}}

result = Wuguokai.create_completion(model, messages, stream, **kwargs)
for item in result:
    print(item)
```
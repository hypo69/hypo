# Модуль для миграции базы данных: добавление колонки `pay_id`

## Обзор

Этот модуль содержит скрипт миграции базы данных, используемый Alembic, для добавления столбца `payment_id` в таблицу `purchases`. Он также включает логику отката изменений.

## Подробнее

Этот скрипт предназначен для автоматического изменения схемы базы данных. Он проверяет наличие столбца `payment_id` перед его добавлением или удалением, чтобы избежать ошибок при повторном выполнении миграции.

## Переменные

- `revision` (str): Идентификатор текущей ревизии миграции.
- `down_revision` (Union[str, None]): Идентификатор предыдущей ревизии миграции.
- `branch_labels` (Union[str, Sequence[str], None]): Метки ветвей.
- `depends_on` (Union[str, Sequence[str], None]): Зависимости от других миграций.

## Функции

### `upgrade`

```python
def upgrade() -> None:
    """
    Добавляет столбец `payment_id` в таблицу `purchases`, если он еще не существует.
    """
```

**Как работает функция**:

1.  **Получение соединения с базой данных**: Функция получает соединение с базой данных, используя `op.get_bind()`.
2.  **Проверка наличия колонки**: Выполняется запрос `PRAGMA table_info('purchases')` для получения информации о столбцах таблицы `purchases`.
3.  **Добавление колонки**: Если столбец `payment_id` не существует, он добавляется в таблицу `purchases` как `sa.String()` с ограничением `nullable=False`.
4.  **Создание уникального ограничения**: Создается уникальное ограничение `uq_purchases_payment_id` для столбца `payment_id`.
5.  **Вывод сообщения**: Если столбец `payment_id` уже существует, выводится сообщение о пропуске добавления.

Внутри функции происходят следующие действия и преобразования:

A.  Получение соединения с базой данных.
    |
    B.  Получение информации о структуре таблицы `purchases`.
    |
    C.  Проверка наличия столбца `payment_id`.
    |
    D.  Добавление столбца и уникального ограничения (если столбец отсутствует).

**Примеры**:

```python
upgrade()
```

### `downgrade`

```python
def downgrade() -> None:
    """
    Удаляет столбец `payment_id` из таблицы `purchases`, если он существует.
    """
```

**Как работает функция**:

1.  **Получение соединения с базой данных**: Функция получает соединение с базой данных, используя `op.get_bind()`.
2.  **Проверка наличия колонки**: Выполняется запрос `PRAGMA table_info('purchases')` для получения информации о столбцах таблицы `purchases`.
3.  **Удаление ограничения и колонки**: Если столбец `payment_id` существует, удаляется уникальное ограничение `uq_purchases_payment_id` и сам столбец `payment_id` из таблицы `purchases`.
4.  **Вывод сообщения**: Если столбец `payment_id` не существует, выводится сообщение о пропуске удаления.

Внутри функции происходят следующие действия и преобразования:

A.  Получение соединения с базой данных.
    |
    B.  Получение информации о структуре таблицы `purchases`.
    |
    C.  Проверка наличия столбца `payment_id`.
    |
    D.  Удаление столбца и уникального ограничения (если столбец существует).

**Примеры**:

```python
downgrade()
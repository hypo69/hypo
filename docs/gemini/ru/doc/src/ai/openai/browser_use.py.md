# Модуль для генерации токсичных комментариев на Habr с использованием OpenAI
=========================================================================================

Модуль содержит функцию `habra_toxic_commenter`, которая ищет статью на Habr по указанному автору, открывает её и генерирует токсичный комментарий с использованием языковой модели OpenAI. Также включает функцию `main` для демонстрации использования `habra_toxic_commenter`.

Пример использования
----------------------

```python
import asyncio
from src.ai.openai.browser_use import habra_toxic_commenter

async def main():
    author = "ElKornacio"  # Замените на имя пользователя, статьи которого хотите найти
    result = await habra_toxic_commenter(author_username=author)

    if result:
        print("Результат работы агента:")
        print(result)
    else:
        print("Не удалось получить результат.")

if __name__ == "__main__":
    asyncio.run(main())
```

## Оглавление

- [Обзор](#обзор)
- [Подробнее](#подробнее)
- [Функции](#функции)
  - [`habra_toxic_commenter`](#habra_toxic_commenter)
  - [`main`](#main)

## Обзор

Этот модуль предназначен для автоматической генерации токсичных комментариев к статьям на платформе Habr с использованием моделей OpenAI. Он включает в себя функцию `habra_toxic_commenter`, которая принимает имя автора Habr, находит его статью, открывает её и генерирует токсичный комментарий на русском языке.

## Подробнее

Модуль использует библиотеки `langchain_openai` для взаимодействия с OpenAI, `browser_use` для автоматизации действий в браузере, `asyncio` для асинхронного выполнения, `dotenv` для загрузки переменных окружения и `logging` для логирования. Он предназначен для демонстрации возможностей автоматической генерации контента с использованием AI.

## Функции

### `habra_toxic_commenter`

```python
async def habra_toxic_commenter(author_username: str, model_name: str = "gpt-4o"):
    """
    Ищет статью на Хабре по указанному автору, открывает её и генерирует токсичный комментарий.

    Args:
        author_username (str): Имя пользователя на Хабре.
        model_name (str): Название языковой модели OpenAI для использования. По умолчанию gpt-4o.

    Returns:
        str | None: Строку с результатом работы агента, содержащую название статьи и сгенерированный комментарий.
                     Возвращает None, если произошла ошибка.

    Raises:
        Exception: Если в процессе выполнения возникла ошибка.

    Example:
        >>> import asyncio
        >>> from src.ai.openai.browser_use import habra_toxic_commenter
        >>> async def test():
        ...     result = await habra_toxic_commenter(author_username="ElKornacio")
        ...     print(result)
        >>> asyncio.run(test())
        # Здесь будет вывод результата работы агента или None в случае ошибки
    """
    ...
```

**Назначение**: Ищет статью на Habr по указанному автору, открывает её и генерирует токсичный комментарий с использованием языковой модели OpenAI.

**Параметры**:
- `author_username` (str): Имя пользователя на Habr, статью которого нужно найти.
- `model_name` (str, optional): Название языковой модели OpenAI для использования. По умолчанию "gpt-4o".

**Возвращает**:
- `str | None`: Строку с результатом работы агента, содержащую название статьи и сгенерированный комментарий. Возвращает `None`, если произошла ошибка.

**Вызывает исключения**:
- `Exception`: Возникает при любой ошибке в процессе выполнения функции.

**Как работает функция**:
1. **Инициализация**: Создается инстанс `ChatOpenAI` с указанной моделью.
2. **Формирование задачи**: Создается текстовое описание задачи для агента, включающее поиск статьи указанного автора на Habr, открытие полной версии статьи и генерацию токсичного комментария на русском языке с последующей его публикацией.
3. **Создание и запуск агента**: Создается инстанс класса `Agent` с задачей и языковой моделью, после чего запускается выполнение задачи агентом.
4. **Обработка результата**: Логируется начало и завершение работы агента. Возвращается результат работы агента. В случае возникновения исключения, оно логируется, и возвращается `None`.

**Блок-схема**:

```
Инициализация LLM (модели OpenAI)
│
├───► Формирование задачи для агента
│       │
│       └───► Создание агента с задачей и LLM
│               │
│               └───► Запуск агента
│                       │
│                       └───► Получение результата
│                               │
│                               └───► Возврат результата
│
└───► Обработка исключений: Логирование ошибки и возврат None
```

**Примеры**:
```python
import asyncio
from src.ai.openai.browser_use import habra_toxic_commenter

async def main():
    # Пример 1: Успешное выполнение с указанием имени пользователя
    result1 = await habra_toxic_commenter(author_username="ElKornacio")
    if result1:
        print(f"Результат 1: {result1}")
    else:
        print("Ошибка при выполнении result1")

    # Пример 2: Успешное выполнение с указанием имени пользователя и другой модели
    result2 = await habra_toxic_commenter(author_username="ElKornacio", model_name="gpt-3.5-turbo")
    if result2:
        print(f"Результат 2: {result2}")
    else:
        print("Ошибка при выполнении result2")

    # Пример 3: Обработка случая с несуществующим именем пользователя
    result3 = await habra_toxic_commenter(author_username="NonExistentUser")
    if result3:
        print(f"Результат 3: {result3}")
    else:
        print("Ошибка при выполнении result3")

if __name__ == "__main__":
    asyncio.run(main())
```

### `main`

```python
async def main():
    """
    Пример использования функции habra_toxic_commenter.
    """
    ...
```

**Назначение**: Пример использования функции `habra_toxic_commenter`.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- Отсутствует.

**Вызывает исключения**:
- Отсутствуют.

**Как работает функция**:
1. **Определение автора**: Устанавливает имя пользователя Habr, для которого будет производиться поиск статьи.
2. **Вызов `habra_toxic_commenter`**: Вызывает функцию `habra_toxic_commenter` с указанным именем автора.
3. **Обработка результата**: Проверяет, был ли получен результат от `habra_toxic_commenter`. Если результат получен, он выводится на экран. В противном случае выводится сообщение об ошибке.

**Блок-схема**:

```
Определение имени автора
│
├───► Вызов функции habra_toxic_commenter
│       │
│       └───► Проверка результата
│               │
│               ├───► Вывод результата (если есть)
│               │
│               └───► Вывод сообщения об ошибке (если нет результата)
```

**Примеры**:
```python
import asyncio
from src.ai.openai.browser_use import habra_toxic_commenter, main

async def run_main():
    await main()

if __name__ == "__main__":
    asyncio.run(run_main())
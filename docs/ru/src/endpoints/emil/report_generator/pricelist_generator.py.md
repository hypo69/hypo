# Модуль генерации прайс-листов для Казаринова

## Обзор

Модуль предназначен для генерации HTML и PDF прайс-листов на основе данных в формате JSON для мехиронов Казаринова. Он использует шаблоны Jinja2 для создания HTML и библиотеку pdfkit для преобразования HTML в PDF.

## Подробней

Этот модуль предоставляет класс `ReportGenerator`, который выполняет следующие действия:

- Загружает данные из JSON-файла.
- Генерирует HTML-контент на основе шаблона и данных.
- Сохраняет HTML в файл.
- Преобразует HTML в PDF.
- Запускает полный цикл генерации отчёта.

Модуль использует структуру файлов и пути, определенные в конфигурации `gs.path`.

## Классы

### `ReportGenerator`

**Описание**: Класс для генерации HTML- и PDF-отчётов на основе данных из JSON.

**Как работает класс**:

Класс `ReportGenerator` использует Jinja2 для генерации HTML из шаблонов. Он принимает данные в формате словаря и язык отчёта в качестве входных данных.  Класс инициализируется с помощью `Environment` из библиотеки `jinja2`, который используется для загрузки шаблонов.  Метод `generate_html` загружает шаблон, заполняет его данными и возвращает HTML-контент. Метод `create_report` использует `generate_html` для генерации HTML-контента, сохраняет его в файл и преобразует в PDF с использованием `PDFUtils`.

**Методы**:

- `generate_html`: Генерирует HTML-контент на основе шаблона и данных.
- `create_report`: Полный цикл генерации отчёта.

### `ReportGenerator.generate_html`

**Описание**: Генерирует HTML-контент на основе шаблона и данных.

```python
async def generate_html(self, data:dict, lang:str ) -> str:
    """
    Args:
        data (dict): Данные для заполнения шаблона.
        lang (str): Язык отчёта.

    Returns:
        str: HTML-контент.
    """
```

**Как работает функция**:

Функция `generate_html` принимает словарь `data` с данными и язык `lang` в качестве входных данных. Она определяет, какой шаблон использовать (`template_table_he.html` для иврита и `template_table_ru.html` для русского), загружает шаблон из файла, используя `Path.read_text`, и заполняет его данными, используя метод `render` из Jinja2. Результатом является строка с HTML-кодом, готовым для сохранения или преобразования в PDF.

**Параметры**:

- `data` (dict): Данные для заполнения шаблона.
- `lang` (str): Язык отчёта.

**Возвращает**:

- `str`: HTML-контент.

**Примеры**:

```python
report_generator = ReportGenerator()
data = {'ключ': 'значение'}
lang = 'ru'
html_content = asyncio.run(report_generator.generate_html(data, lang))
print(html_content)
```

### `ReportGenerator.create_report`

**Описание**: Полный цикл генерации отчёта.

```python
async def create_report(self, data: dict, lang:str, html_file:str| Path, pdf_file:str |Path) -> bool:
    """
    Args:
        data (dict): Данные для отчёта.
        lang (str): Язык отчёта.
        html_file (str | Path): Путь для сохранения HTML-файла.
        pdf_file (str | Path): Путь для сохранения PDF-файла.

    Returns:
        bool: True в случае успешной генерации, False в случае ошибки.
    """
```

**Как работает функция**:

Функция `create_report` выполняет полный цикл генерации отчёта. Сначала она добавляет информацию об "услуге" как продукт в данные, используя соответствующие переводы на основе языка `lang`. Затем она генерирует HTML-контент с помощью метода `generate_html`, сохраняет его в файл, указанный в `html_file`, и преобразует HTML в PDF с использованием `PDFUtils.save_pdf_pdfkit`. Если преобразование в PDF не удаётся, функция логирует ошибку и возвращает `False`, иначе возвращает `True`.

**Параметры**:

- `data` (dict): Данные для отчёта.
- `lang` (str): Язык отчёта.
- `html_file` (str | Path): Путь для сохранения HTML-файла.
- `pdf_file` (str | Path): Путь для сохранения PDF-файла.

**Возвращает**:

- `bool`: `True` в случае успешной генерации, `False` в случае ошибки.

**Вызывает исключения**:

- `Exception`: Если возникает ошибка при генерации отчёта.

**Примеры**:

```python
report_generator = ReportGenerator()
data = {'products': []}
lang = 'ru'
html_file = 'report.html'
pdf_file = 'report.pdf'
result = asyncio.run(report_generator.create_report(data, lang, html_file, pdf_file))
print(result)
```

## Функции

### `main`

```python
def main(mexiron:str,lang:str) ->bool:
    """
    Args:
        mexiron (str): Имя мехирона.
        lang (str): Язык отчёта.

    Returns:
        bool: True в случае успешной генерации, False в случае ошибки.
    """
```

**Описание**: Главная функция для запуска генерации отчёта.

**Как работает функция**:

Функция `main` принимает имя мехирона `mexiron` и язык `lang` в качестве входных данных. Она определяет пути к файлам данных, HTML и PDF, загружает данные из JSON-файла с использованием `j_loads`, создает экземпляр класса `ReportGenerator` и запускает процесс генерации отчёта, вызывая `create_report` в асинхронном режиме.

**Параметры**:

- `mexiron` (str): Имя мехирона.
- `lang` (str): Язык отчёта.

**Возвращает**:

- `bool`: `True` в случае успешной генерации, `False` в случае ошибки.

**Примеры**:

```python
mexiron = '24_12_01_03_18_24_269'
lang = 'ru'
main(mexiron, lang)
```
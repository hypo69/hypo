# Модуль для работы с провайдером Aura
## Обзор

Модуль `Aura.py` предоставляет асинхронный генератор для взаимодействия с моделью Aura через API `openchat.team`. 
Он позволяет отправлять запросы к модели и получать ответы в виде асинхронного генератора, что удобно для обработки больших объемов данных.
## Подробнее

Модуль предназначен для интеграции с сервисом `openchat.team`. Он использует `aiohttp` для асинхронных запросов и предоставляет класс `Aura`, который является асинхронным генератором.

## Классы

### `Aura`

**Описание**: Класс `Aura` является провайдером, который взаимодействует с API `openchat.team` для генерации текста на основе предоставленных сообщений.

   **Принцип работы**:
   1.  Подготавливает данные для запроса, включая сообщения пользователя и системные сообщения.
   2.  Отправляет асинхронный POST-запрос к API `openchat.team`.
   3.  Получает ответ в виде чанков данных и генерирует их асинхронно.

**Атрибуты**:

-   `url` (str): URL API `openchat.team`.
-   `working` (bool): Указывает, работает ли провайдер в данный момент.

**Методы**:

-   `create_async_generator`: Создает асинхронный генератор для получения ответов от API `openchat.team`.

## Функции

### `create_async_generator`

```python
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        temperature: float = 0.5,
        max_tokens: int = 8192,
        webdriver = None,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для получения ответов от API `openchat.team`.

        Args:
            model (str): Модель для использования.
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
            temperature (float, optional): Температура модели. По умолчанию 0.5.
            max_tokens (int, optional): Максимальное количество токенов в ответе. По умолчанию 8192.
            webdriver (optional): Веб-драйвер для автоматизации браузера. По умолчанию `None`.
            **kwargs: Дополнительные параметры.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий чанки данных.

        Как работает функция:
        1.  Извлекает аргументы из браузера с использованием функции `get_args_from_browser`.
        2.  Создает асинхронную сессию с использованием `ClientSession`.
        3.  Разделяет сообщения на системные и пользовательские.
        4.  Формирует данные для отправки в запросе.
        5.  Отправляет POST-запрос к API `openchat.team`.
        6.  Получает ответ в виде чанков данных и генерирует их асинхронно.

        Внутренние функции:
        Нет внутренних функций.
        """
```

**Параметры**:

-   `model` (str): Модель для использования.
-   `messages` (Messages): Список сообщений для отправки.
-   `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
-   `temperature` (float, optional): Температура модели. По умолчанию 0.5.
-   `max_tokens` (int, optional): Максимальное количество токенов в ответе. По умолчанию 8192.
-   `webdriver` (optional): Веб-драйвер для автоматизации браузера. По умолчанию `None`.
-   `**kwargs`: Дополнительные параметры.

**Возвращает**:

-   `AsyncResult`: Асинхронный генератор, возвращающий чанки данных.

**Вызывает исключения**:

-   `HTTPError`: Если возникает ошибка при выполнении HTTP-запроса.

**Как работает функция**:

1.  **Подготовка аргументов**: Функция извлекает аргументы из браузера с использованием `get_args_from_browser(cls.url, webdriver, proxy)`.
2.  **Создание сессии**: Создается асинхронная сессия `ClientSession(**args)` для выполнения HTTP-запросов.
3.  **Обработка сообщений**: Сообщения разделяются на системные (`system_message`) и пользовательские (`new_messages`).

4.  **Формирование данных**: Подготавливаются данные `data` для отправки в запросе, включая модель, сообщения, ключ и параметры температуры.
5.  **Отправка запроса**: Отправляется POST-запрос к API `f"{cls.url}/api/chat"` с использованием асинхронной сессии.
6.  **Генерация ответа**: Функция генерирует чанки данных из ответа, декодируя их и выдавая как часть асинхронного генератора.

```
Аргументы из браузера  
     │
     │
Создание асинхронной сессии
     │
     │
Разделение сообщений:  
     │
     │
Системные ↔ Пользовательские
     │
     │
Формирование данных для запроса
     │
     │
Отправка POST-запроса к API
     │
     │
Генерация чанков данных из ответа
     │
     │
Конец
```

**Примеры**:

```python
# Пример использования (необходимо настроить webdriver и прокси)
# from src.webdirver import Driver, Chrome
# messages = [{"role": "user", "content": "Hello, how are you?"}]
# async for chunk in Aura.create_async_generator(model="openchat_3.6", messages=messages, webdriver = Driver(Chrome)):
#     print(chunk, end="")
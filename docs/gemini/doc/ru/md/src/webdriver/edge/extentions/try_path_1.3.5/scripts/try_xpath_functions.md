# Модуль try_xpath_functions.js

## Обзор

Этот модуль содержит функции для работы с XPath, селекторами CSS и узлами DOM в JavaScript. Он предоставляет методы для выполнения XPath выражений, выбора элементов CSS, обработки результатов запросов и работы с атрибутами элементов. Модуль предназначен для использования в расширениях браузера Edge и включает функции для обработки различных типов результатов (числа, строки, булевы значения, узлы).

## Функции

### `execExpr`

**Описание**: Выполняет XPath или CSS селектор на заданном контексте.

**Параметры**:
- `expr` (string): XPath выражение или CSS селектор.
- `method` (string): Метод выполнения (`evaluate`, `querySelector`, `querySelectorAll`).
- `opts` (object, optional): Опциональный объект с параметрами.
    - `context` (Node | Document, optional): Контекст для выполнения выражения. По умолчанию `document`.
    - `resolver` (function | string, optional): Функция для разрешения значений.  Возможен JSON-строковый формат (в этом случае функция преобразования выполняется автоматически). По умолчанию `null`.
    - `document` (Document, optional): Объект `Document`, используется в случае, когда `context` - не документ, для получения DOM контекста. По умолчанию  - используется `context.ownerDocument`.
    - `resultType` (string, optional): Тип результата для XPath (`xpathResult.ANY_TYPE`, `xpathResult.NUMBER_TYPE`, ...). По умолчанию `xpathResult.ANY_TYPE`.

**Возвращает**:
- `object`: Объект с результатами выполнения.
    - `items` (array): Массив результатов.
    - `method` (string): Используемый метод.
    - `resultType` (string): Тип результата XPath.

**Вызывает исключения**:
- `Error`: Возникает при неверном типе контекста (`context`) для выбранного метода.


### `resToArr`

**Описание**: Преобразует результат выполнения XPath в массив.

**Параметры**:
- `res` (XPathResult): Результат выполнения XPath выражения.
- `type` (string, optional): Тип результата (если неизвестен).

**Возвращает**:
- `array`: Массив узлов, чисел или других типов в зависимости от `resultType`.

**Вызывает исключения**:
- `Error`: Возникает при неподдерживаемом типе результата.


### `makeResolver`

**Описание**: Создает функцию-резолвер для XPath.

**Параметры**:
- `obj` (object | function | string, optional): Резолвер или строка, представляющая JSON-объект.

**Возвращает**:
- `function | null`: Функция-резолвер или `null` при отсутствии резолвера.

**Вызывает исключения**:
- `Error`: Возникает при некорректном формате резолвера (не JSON или не функция).


### `isValidDict`

**Описание**: Проверяет, является ли объект корректным словарем.

**Параметры**:
- `obj` (object): Проверяемый объект.

**Возвращает**:
- `boolean`: `true`, если объект является корректным словарем, иначе `false`.


### `objToMap`

**Описание**: Преобразует объект в `Map`.

**Параметры**:
- `obj` (object): Объект для преобразования.

**Возвращает**:
- `Map`: Объект `Map`, содержащий пары ключ-значение из входного объекта.

### `isDocOrElem`

**Описание**: Проверяет, является ли объект элементом или документом.

**Параметры**:
- `obj` (object): Проверяемый объект.

**Возвращает**:
- `boolean`: `true` если `obj` является `document` или `element`, `false` в противном случае.

### `listToArr`

**Описание**: Преобразует список в массив.

**Параметры**:
- `list` (list): Список для преобразования.

**Возвращает**:
- `array`: Массив, содержащий элементы списка.


### `getItemDetail`

**Описание**: Возвращает детальную информацию об элементе.

**Параметры**:
- `item` (object): Элемент DOM или другое значение.

**Возвращает**:
- `object`: Объект с деталями элемента: `type`, `name`, `value`, `textContent`.


### `getItemDetails`

**Описание**: Возвращает массив подробностей об элементах.

**Параметры**:
- `items` (array): Массив элементов DOM.

**Возвращает**:
- `array`: Массив объектов с деталями элементов.


### `getNodeTypeStr`

**Описание**: Возвращает строковое представление типа узла.

**Параметры**:
- `nodeType` (number): Числовой код типа узла.

**Возвращает**:
- `string`: Строковое представление типа узла.


### `getxpathResultStr`

**Описание**: Возвращает строковое представление типа результата XPath.

**Параметры**:
- `resultType` (number): Числовой код типа результата XPath.

**Возвращает**:
- `string`: Строковое представление типа результата.


### `getxpathResultNum`

**Описание**: Возвращает числовое представление типа результата XPath.

**Параметры**:
- `resultTypeStr` (string): Строковое представление типа результата XPath.

**Возвращает**:
- `number`: Числовое представление типа результата.


### `isAttrItem`, `isNodeItem`, `isElementItem`

**Описание**: Функции проверки типов элементов.


### `addClassToItem`, `addClassToItems`

**Описание**: Добавляет класс к элементам.


### `saveItemClass`, `restoreItemClass`, `saveItemClasses`, `restoreItemClasses`

**Описание**: Сохранение и восстановление классов элементов.


### `setAttrToItem`, `removeAttrFromItem`, `removeAttrFromItems`

**Описание**: Установка и удаление атрибутов элементов.


### `setIndexToItems`

**Описание**: Установка индексов к элементам.


### `getParentElement`

**Описание**: Возвращает родительский элемент.


### `getAncestorElements`

**Описание**: Возвращает массив предков элемента.


### `getOwnerDocument`

**Описание**: Возвращает документ, к которому принадлежит элемент.


### `createHeaderRow`

**Описание**: Создает заголовок таблицы.


### `createDetailTableHeader`

**Описание**: Создает заголовок таблицы с деталями.


### `createDetailRow`

**Описание**: Создает строку таблицы с деталями.


### `appendDetailRows`

**Описание**: Добавляет строки детальной таблицы.


### `updateDetailsTable`

**Описание**: Обновляет таблицу с деталями.


### `emptyChildNodes`

**Описание**: Очищает все дочерние узлы элемента.


### `saveAttrForItem`, `saveAttrForItems`, `restoreItemAttrs`

**Описание**: Сохраняет и восстанавливает атрибуты элементов.


### `getFrameAncestry`

**Описание**: Возвращает массив элементов фреймов.


### `isNumberArray`

**Описание**: Проверяет, является ли массив массивом чисел.


### `onError`

**Описание**: Обработчик ошибок (пустая функция).


### `isBlankWindow`

**Описание**: Проверяет, является ли окно браузера пустым (about:blank).


### `collectBlankWindows`

**Описание**: Ищет пустые окна в фреймах.


### `findFrameElement`, `findFrameIndex`

**Описание**: Находит элемент фрейма и его индекс в массиве фреймов.


### `makeDetailText`

**Описание**: Создает строку с деталями элементов.
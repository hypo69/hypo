# Модуль `Hashnode.py`

## Обзор

Модуль предоставляет асинхронный провайдер для взаимодействия с сервисом Hashnode. Он позволяет генерировать ответы на основе предоставленных сообщений, используя различные типы поиска (быстрый, код, веб-поиск). Модуль поддерживает историю сообщений и модель GPT-3.5 Turbo.

## Подробней

Модуль предназначен для интеграции с платформой Hashnode через асинхронные запросы. Он использует `aiohttp` для выполнения HTTP-запросов и предоставляет функциональность для поиска и генерации текста на основе контекста. Важной особенностью является поддержка различных типов поиска и возможность использования прокси.

## Классы

### `SearchTypes`

**Описание**: Класс, содержащий статические атрибуты, определяющие типы поиска, поддерживаемые Hashnode.

**Аттрибуты**:
- `quick` (str): Значение "quick" для быстрого поиска.
- `code` (str): Значение "code" для поиска кода.
- `websearch` (str): Значение "websearch" для веб-поиска.

### `Hashnode`

**Описание**: Класс, представляющий асинхронный провайдер для Hashnode.

**Наследует**:
- `AsyncGeneratorProvider`: Наследует функциональность асинхронного генератора.

**Аттрибуты**:
- `url` (str): URL сервиса Hashnode ("https://hashnode.com").
- `working` (bool): Флаг, указывающий на работоспособность провайдера (в данном случае `False`).
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений (`True`).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели GPT-3.5 Turbo (`True`).
- `_sources` (list): Список источников, полученных в результате поиска.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от Hashnode.
- `get_sources`: Возвращает список источников в формате словарей, содержащих заголовок и URL.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    search_type: str = SearchTypes.websearch,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения ответов от Hashnode.

    Args:
        model (str): Название используемой модели.
        messages (Messages): Список сообщений для контекста.
        search_type (str, optional): Тип поиска. По умолчанию `SearchTypes.websearch`.
        proxy (str, optional): Адрес прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные параметры.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий чанки данных.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.
    """
```

**Назначение**: Создает и возвращает асинхронный генератор, который взаимодействует с API Hashnode для генерации ответов на основе предоставленных сообщений и параметров поиска.

**Параметры**:
- `cls`: Ссылка на класс `Hashnode`.
- `model` (str): Имя модели, используемой для генерации ответа.
- `messages` (Messages): Список сообщений, представляющих историю разговора.
- `search_type` (str, optional): Тип поиска, который будет использоваться. По умолчанию `SearchTypes.websearch`.
- `proxy` (str, optional): Адрес прокси-сервера для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы для передачи.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, который возвращает чанки данных, полученные от API Hashnode.

**Как работает функция**:

1. **Инициализация заголовков**: Создаются заголовки для HTTP-запросов, включая User-Agent, Accept, Referer и Content-Type.
2. **Создание асинхронной сессии**: Используется `aiohttp.ClientSession` для выполнения асинхронных HTTP-запросов.
3. **Подготовка запроса на поиск**: Если указан тип поиска `websearch`, отправляется запрос на API Hashnode для выполнения поиска на основе последнего сообщения в списке `messages`.
4. **Подготовка данных для запроса на завершение**: Формируются данные для запроса на основе истории сообщений, типа поиска и результатов поиска (если есть).
5. **Отправка запроса на завершение**: Отправляется POST-запрос на API Hashnode с данными для генерации ответа.
6. **Генерация чанков данных**: Асинхронно читаются чанки данных из ответа и возвращаются через генератор.

**ASCII flowchart**:

```
Начало
  ↓
Заголовки запроса
  ↓
Создание сессии aiohttp
  ↓
Тип поиска == websearch?
  ├── Да ──→ Запрос к API поиска Hashnode
  │         ↓
  │     Получение результатов поиска
  └── Нет ─→ Пропуск
  ↓
Подготовка данных для запроса
  ↓
Запрос к API завершения Hashnode
  ↓
Асинхронная генерация чанков ответа
  ↓
Конец
```

**Примеры**:

```python
# Пример вызова функции create_async_generator
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, world!"}]
search_type = SearchTypes.websearch
proxy = None

async def main():
    generator = await Hashnode.create_async_generator(model, messages, search_type, proxy)
    async for chunk in generator:
        print(chunk, end="")

# Запуск примера
# import asyncio
# asyncio.run(main())
```

### `get_sources`

```python
@classmethod
def get_sources(cls) -> list:
    """
    Возвращает список источников в формате словарей, содержащих заголовок и URL.

    Returns:
        list: Список словарей с ключами "title" и "url".
    """
```

**Назначение**: Преобразует список источников `cls._sources` в формат, содержащий только заголовок и URL каждого источника.

**Параметры**:
- `cls`: Ссылка на класс `Hashnode`.

**Возвращает**:
- `list`: Список словарей, где каждый словарь содержит ключи `"title"` и `"url"` для каждого источника.

**Как работает функция**:

1. **Преобразование источников**: Используется генератор списков для преобразования каждого элемента в `cls._sources` в словарь с ключами `"title"` и `"url"`.
2. **Возврат списка**: Возвращается полученный список словарей.

**ASCII flowchart**:

```
Начало
  ↓
Преобразование cls._sources
  │   (source["name"] -> title, source["url"] -> url)
  ↓
Возврат списка словарей
  ↓
Конец
```

**Примеры**:

```python
# Пример вызова функции get_sources
sources = Hashnode.get_sources()
print(sources)
```
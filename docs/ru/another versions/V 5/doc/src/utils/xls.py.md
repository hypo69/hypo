# Модуль `src.utils.xls`

## Обзор

Модуль `src.utils.xls` предоставляет функции для конвертации файлов Excel (`.xls`) в формат JSON и наоборот. Он позволяет читать данные из Excel-файлов, преобразовывать их в JSON-формат, а также сохранять JSON-данные в Excel-файлы. Модуль поддерживает работу с несколькими листами в Excel-файлах и обеспечивает обработку ошибок для обеспечения стабильности работы.

## Подробней

Этот модуль предназначен для упрощения обмена данными между Excel-файлами и JSON-форматом. Он полезен в ситуациях, когда необходимо автоматизировать экспорт данных из Excel для использования в веб-приложениях или других системах, работающих с JSON, а также для импорта данных из JSON в Excel для анализа и отчетности.

Модуль использует библиотеки `pandas` для работы с Excel-файлами и `json` для работы с JSON-данными.

## Функции

### `read_xls_as_dict`

```python
def read_xls_as_dict(
    xls_file: str,
    json_file: str = None,
    sheet_name: Union[str, int] = None
) -> Union[Dict, List[Dict], bool]:
    """
    Чтение Excel-файла и преобразование его в JSON. При необходимости преобразует конкретный лист и сохраняет результат в JSON-файл.
    Обрабатывает ошибки.
    """
```

**Описание**: Читает Excel-файл и преобразует его в JSON-формат. Может читать весь файл или конкретный лист. При необходимости сохраняет результат в JSON-файл.

**Как работает функция**:
1. Принимает путь к Excel-файлу (`xls_file`), путь для сохранения JSON-файла (`json_file`, необязательный) и имя листа (`sheet_name`, необязательный).
2. Проверяет, существует ли указанный Excel-файл. Если файл не найден, записывает ошибку в лог и возвращает `False`.
3. Использует `pandas` для чтения Excel-файла.
4. Если `sheet_name` не указан, читает все листы в файле и сохраняет их в словаре `data_dict`, где ключи - имена листов, а значения - списки словарей, представляющие строки данных.
5. Если `sheet_name` указан, читает только указанный лист и сохраняет его в `data_dict`.
6. Если указан `json_file`, сохраняет `data_dict` в JSON-файл с отступами и кодировкой UTF-8.
7. Возвращает `data_dict` с данными из Excel-файла.

**Параметры**:
- `xls_file` (str): Путь к Excel-файлу.
- `json_file` (str, optional): Путь для сохранения JSON-файла. По умолчанию `None`.
- `sheet_name` (Union[str, int], optional): Имя или индекс листа для чтения. По умолчанию `None`.

**Возвращает**:
- `Union[Dict, List[Dict], bool]`: Словарь с данными из Excel-файла, список словарей (если указан `sheet_name`) или `False` в случае ошибки.

**Вызывает исключения**:
- `FileNotFoundError`: Если Excel-файл не найден.
- `Exception`: При возникновении других ошибок при обработке файла.

**Примеры**:

Чтение всего Excel-файла:

```python
data = read_xls_as_dict('input.xlsx')
if data:
    print(data)
```

Чтение конкретного листа и сохранение в JSON-файл:

```python
data = read_xls_as_dict('input.xlsx', 'output.json', 'Sheet1')
if data:
    print(data)
```

### `save_xls_file`

```python
def save_xls_file(data: Dict[str, List[Dict]], file_path: str) -> bool:
    """Сохраняет JSON-данные в Excel-файл. Обрабатывает ошибки."""
```

**Описание**: Сохраняет JSON-данные в Excel-файл.

**Как работает функция**:
1. Принимает словарь `data`, где ключи - имена листов, а значения - списки словарей, представляющие строки данных, и путь для сохранения Excel-файла (`file_path`).
2. Использует `pandas` и `xlsxwriter` для записи данных в Excel-файл.
3. Для каждого листа в `data` создает DataFrame и записывает его в Excel-файл.
4. Логирует информацию об успешном сохранении каждого листа.
5. Возвращает `True` в случае успешного сохранения и `False` в случае ошибки.

**Параметры**:
- `data` (Dict[str, List[Dict]]): Словарь с данными для сохранения, где ключи - имена листов, а значения - списки словарей, представляющие строки данных.
- `file_path` (str): Путь для сохранения Excel-файла.

**Возвращает**:
- `bool`: `True` в случае успешного сохранения, `False` в случае ошибки.

**Вызывает исключения**:
- `Exception`: При возникновении ошибок при сохранении файла.

**Примеры**:

Сохранение JSON-данных в Excel-файл:

```python
data_to_save = {'Sheet1': [{'column1': 'value1', 'column2': 'value2'}]}
success = save_xls_file(data_to_save, 'output.xlsx')
if success:
    print("Successfully saved to output.xlsx")
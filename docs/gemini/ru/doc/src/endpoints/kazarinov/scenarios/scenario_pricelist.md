# Модуль scenario_pricelist

## Обзор

Данный модуль реализует сценарий обработки данных о ценовых листах для генерации мехиронов. Он отвечает за извлечение, обработку и сохранение данных о продуктах из различных поставщиков, включая их предварительную подготовку, обработку с помощью модели искусственного интеллекта и интеграцию с Facebook для публикации.

## Классы

### `MexironBuilder`

**Описание**: Класс `MexironBuilder` отвечает за извлечение, разбор и сохранение данных о продуктах поставщиков. Он обрабатывает данные о продуктах, применяет к ним обработку с помощью модели искусственного интеллекта и интегрируется с Facebook для публикации.

**Атрибуты**:
- `driver` (Driver): Экземпляр Selenium WebDriver для работы с веб-страницами.
- `export_path` (Path): Путь для экспорта обработанных данных.
- `mexiron_name` (str): Имя текущего мехирона.
- `price` (float): Цена продукта.
- `timestamp` (str): Дата и время создания мехирона.
- `products_list` (List[dict]): Список обработанных данных о продуктах.
- `model` (GoogleGenerativeAI): Экземпляр модели искусственного интеллекта Gemini.
- `config` (SimpleNamespace): Конфигурация для хранения настроек.


**Методы**:

#### `__init__`

**Описание**: Инициализирует класс `MexironBuilder` с необходимыми компонентами.

**Параметры**:
- `driver` (Driver): Экземпляр Selenium WebDriver.
- `mexiron_name` (Optional[str], optional): Имя мехирона. По умолчанию использует текущую дату и время.

**Возвращает**:
- Нет.

**Обрабатывает исключения**:
- `Exception`: Возникает при ошибке загрузки конфигурации или построения пути экспорта. В случае ошибки выводит сообщение об ошибке в лог и завершает выполнение метода.


#### `run_scenario`

**Описание**: Выполняет сценарий: анализирует продукты, обрабатывает их с помощью AI и сохраняет данные.

**Параметры**:
- `system_instruction` (Optional[str]): Системные инструкции для модели AI.
- `price` (Optional[str]): Цена продукта.
- `mexiron_name` (Optional[str]): Имя мехирона.
- `urls` (Optional[str | List[str]]): URL-адреса страниц продуктов.
- `bot` (Optional[TelegramBot]): Объект бота Telegram.

**Возвращает**:
- `bool`: `True`, если сценарий выполнился успешно, `False` в противном случае.


#### `get_graber_by_supplier_url`

**Описание**: Возвращает соответствующий грабер для заданного URL поставщика.

**Параметры**:
- `url` (str): URL страницы поставщика.

**Возвращает**:
- Optional[object]: Экземпляр грабера, если найдена подходящая реализация, иначе `None`.

#### `convert_product_fields`

**Описание**: Преобразует поля продукта в словарь.

**Параметры**:
- `f` (ProductFields): Объект, содержащий разобранные данные о продукте.

**Возвращает**:
- dict: Словарь с отформатированными данными о продукте.

#### `save_product_data`

**Описание**: Сохраняет данные отдельного продукта в файл.

**Параметры**:
- `product_data` (dict): Отформатированные данные о продукте.

**Возвращает**:
- `bool`: `True` при успешном сохранении, `False` в противном случае.


#### `process_ai`

**Описание**: Обрабатывает список продуктов с помощью модели искусственного интеллекта.

**Параметры**:
- `products_list` (List[str]): Список словарей с данными о продуктах.
- `lang` (str): Язык, на который требуется выполнить обработку.
- `attempts` (int, optional): Количество попыток повторной обработки. По умолчанию 3.

**Возвращает**:
- tuple | bool: Обработанный результат в формате ru и he, или `False`, если не удалось получить корректный ответ после нескольких попыток.


#### `post_facebook`

**Описание**: Выполняет сценарий рекламного модуля Facebook.

**Параметры**:
- `mexiron` (SimpleNamespace): Объект, содержащий данные о мехироне.

**Возвращает**:
- bool: `True` при успешной публикации, `False` в противном случае.


#### `create_report`

**Описание**: Создаёт отчет в формате HTML и PDF.

**Параметры**:
- `data` (dict): Данные для отчета.
- `html_file` (Path): Путь к файлу отчета в формате HTML.
- `pdf_file` (Path): Путь к файлу отчета в формате PDF.

**Возвращает**:
- Нет.


## Функции

(Список функций из модуля будет дополнен, если они существуют)


##  Константы

`MODE` (str):  Значение константы.

## Модули

`asyncio`, `random`, `shutil`, `pathlib`, `typing`, `types`, `dataclasses`, `header`, `gs`, `TelegramBot`, `ProductFields`, `Driver`, `GoogleGenerativeAI`, `post_message_title`, `upload_post_media`, `message_publish`, `MorleviGraber`, `KspGraber`, `IvoryGraber`, `GrandadvanceGraber`, `ReportGenerator`, `Update`, `CallbackContext`, `j_loads`, `j_loads_ns`, `j_dumps`, `read_text_file`, `save_text_file`, `recursively_get_file_path`, `save_png_from_url`, `save_png`, `decode_unicode_escape`, `pprint`, `logger`
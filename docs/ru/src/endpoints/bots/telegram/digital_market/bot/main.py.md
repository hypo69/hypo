# –ú–æ–¥—É–ª—å main.py

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `main.py` —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram-–±–æ—Ç–∞ –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Ä—ã–Ω–∫–∞. –û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ –∑–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `aiohttp`, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –º–∏–¥–ª–≤–∞—Ä–µ–π –∏ —Ä–æ—É—Ç–µ—Ä–æ–≤, –∞ —Ç–∞–∫–∂–µ –∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ–º–∞–Ω–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –±–æ—Ç–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ü–æ–¥—Ä–æ–±–Ω–µ–π

–î–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1.  **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞**:
    *   –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç–∞–∫–∏—Ö –∫–∞–∫ `/start`.
    *   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram.
    *   –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –æ –∑–∞–ø—É—Å–∫–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞.
2.  **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
    *   –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∏–¥–ª–≤–∞—Ä–µ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
    *   –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ, –∫–∞—Ç–∞–ª–æ–≥).
3.  **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
    *   –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `aiohttp` –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –≤–µ–±—Ö—É–∫–∞ Telegram, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫ Robokassa, –∞ —Ç–∞–∫–∂–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    *   –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ –∏ –ø–æ—Ä—Ç—É.

## –§—É–Ω–∫—Ü–∏–∏

### `set_default_commands`

```python
async def set_default_commands():
    """
    –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –±–æ—Ç–∞.
    """
```

**–û–ø–∏—Å–∞–Ω–∏–µ**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Telegram-–±–æ—Ç–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è**:
–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—É `/start` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º "–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞", –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Ö –¥–ª—è –±–æ—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è `bot.set_my_commands`. –ö–æ–º–∞–Ω–¥—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`BotCommandScopeDefault`).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
-   –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
-   `None`

**–í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
-   –ù–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

**–ü—Ä–∏–º–µ—Ä—ã**:

```python
await set_default_commands()
```

### `on_startup`

```python
async def on_startup(app):
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    """
```

**–û–ø–∏—Å–∞–Ω–∏–µ**: –§—É–Ω–∫—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è**:
–§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1.  –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –±–æ—Ç–∞, –≤—ã–∑—ã–≤–∞—è `set_default_commands()`.
2.  –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–µ–±—Ö—É–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram, –∏—Å–ø–æ–ª—å–∑—É—è `settings.get_webhook_url`.
3.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –æ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞. –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—à–∏–±–∫–∞.
4.  –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
-   `app`: —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `aiohttp`.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
-   `None`

**–í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
-   `Exception`: –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.

**–ü—Ä–∏–º–µ—Ä—ã**:

```python
async def on_startup(app):
    await set_default_commands()
    await bot.set_webhook(settings.get_webhook_url)
    for admin_id in admins:
        try:
            await bot.send_message(admin_id, '–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω ü•≥.')
        except Exception as e:
            logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É {admin_id}: {e}")
    logger.info("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω.")
```

### `on_shutdown`

```python
async def on_shutdown(app):
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    """
```

**–û–ø–∏—Å–∞–Ω–∏–µ**: –§—É–Ω–∫—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è**:
–§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞. –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—à–∏–±–∫–∞.
2.  –£–¥–∞–ª—è–µ—Ç –≤–µ–±—Ö—É–∫, —á—Ç–æ–±—ã –±–æ—Ç –ø–µ—Ä–µ—Å—Ç–∞–ª –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –±–æ—Ç–∞.
3.  –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
-   `app`: —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `aiohttp`.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
-   `None`

**–í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
-   `Exception`: –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.

**–ü—Ä–∏–º–µ—Ä—ã**:

```python
async def on_shutdown(app):
    for admin_id in admins:
        try:
            await bot.send_message(admin_id, '–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü–æ—á–µ–º—É? üòî')
        except Exception as e:
            logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É {admin_id}: {e}")
    await bot.delete_webhook(drop_pending_updates=True)
    await bot.session.close()
    logger.error("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
```

### `register_middlewares`

```python
def register_middlewares():
    """
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∏–¥–ª–≤–∞—Ä–∏ –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞.
    """
```

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∏–¥–ª–≤–∞—Ä–∏ –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è**:
–§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –¥–≤–∞ –º–∏–¥–ª–≤–∞—Ä—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:

1.  `DatabaseMiddlewareWithoutCommit`: –ú–∏–¥–ª–≤–∞—Ä—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –∫–æ–º–º–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
2.  `DatabaseMiddlewareWithCommit`: –ú–∏–¥–ª–≤–∞—Ä—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Å –∫–æ–º–º–∏—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–ú–∏–¥–ª–≤–∞—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ `dp` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥—è—â–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
-   –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
-   `None`

**–í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
-   –ù–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

**–ü—Ä–∏–º–µ—Ä—ã**:

```python
register_middlewares()
```

### `register_routers`

```python
def register_routers():
    """
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞.
    """
```

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è**:
–§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç—Ä–∏ —Ä–æ—É—Ç–µ—Ä–∞ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ `dp`:

1.  `catalog_router`: –†–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤.
2.  `user_router`: –†–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
3.  `admin_router`: –†–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
-   –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
-   `None`

**–í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
-   –ù–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

**–ü—Ä–∏–º–µ—Ä—ã**:

```python
register_routers()
```

### `create_app`

```python
def create_app():
    """
    –°–æ–∑–¥–∞–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ aiohttp.
    """
```

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ–∑–¥–∞–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `aiohttp`.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è**:
–§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1.  –°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `aiohttp`.
2.  –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è:
    *   –û–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–∞ Telegram (`/{settings.BOT_TOKEN}`).
    *   –û–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Robokassa (`/robokassa/result/`).
    *   –û–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ Robokassa (`/robokassa/fail/`).
    *   –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`/`).
3.  –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é `setup_application`, —Å–≤—è–∑—ã–≤–∞—è –µ–≥–æ —Å –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º `dp` –∏ –±–æ—Ç–æ–º `bot`.
4.  –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `on_startup` –∏ `on_shutdown` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
5.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
-   –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
-   `app`: —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `aiohttp`.

**–í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
-   –ù–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

**–ü—Ä–∏–º–µ—Ä—ã**:

```python
app = create_app()
```

### `main`

```python
def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    """
```

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è**:
–§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

1.  –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∏–¥–ª–≤–∞—Ä–∏, –≤—ã–∑—ã–≤–∞—è `register_middlewares()`.
2.  –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–æ—É—Ç–µ—Ä—ã, –≤—ã–∑—ã–≤–∞—è `register_routers()`.
3.  –°–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≤—ã–∑—ã–≤–∞—è `create_app()`.
4.  –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—è `web.run_app()`, –Ω–∞ —Ö–æ—Å—Ç–µ –∏ –ø–æ—Ä—Ç—É, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (`settings.SITE_HOST` –∏ `settings.SITE_PORT`).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
-   –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
-   `None`

**–í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è**:
-   –ù–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

**–ü—Ä–∏–º–µ—Ä—ã**:

```python
def main():
    register_middlewares()
    register_routers()
    app = create_app()
    web.run_app(app, host=settings.SITE_HOST, port=settings.SITE_PORT)
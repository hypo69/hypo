# Модуль Jmuz

## Обзор

Модуль `Jmuz` предоставляет класс для взаимодействия с моделью `gpt-4o` через API, совместимое с OpenAI. Он расширяет класс `OpenaiTemplate` и предназначен для использования в асинхронном режиме.

## Подробнее

Модуль определяет URL, базовый API, ключ API и флаг, указывающий, что он рабочий. Также имеется поддержка системных сообщений.

## Классы

### `Jmuz(OpenaiTemplate)`

**Описание**: Класс `Jmuz` предоставляет интерфейс для взаимодействия с API `Jmuz`, который является адаптацией OpenAI.

**Наследует**: `OpenaiTemplate`

**Атрибуты**:
- `url` (str): URL для подключения (Discord server).
- `api_base` (str): Базовый URL API `Jmuz`.
- `api_key` (str): Ключ API для аутентификации.
- `working` (bool): Указывает, работает ли этот провайдер.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения.
- `default_model` (str): Модель, используемая по умолчанию (gpt-4o).
- `model_aliases` (dict): Псевдонимы для различных моделей.

**Методы**:
- `get_models(**kwargs)`: Получает список доступных моделей.
- `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`: Асинхронно генерирует ответы от модели.

## Функции

### `get_models(**kwargs)`

```python
@classmethod
def get_models(cls, **kwargs):
    """
    Получает список доступных моделей.

    Args:
        **kwargs: Дополнительные аргументы для передачи в функцию `super().get_models()`.

    Returns:
        list: Список доступных моделей.
    """
```

**Назначение**: Функция `get_models` возвращает список доступных моделей, используя метод `get_models` из родительского класса `OpenaiTemplate`.

**Как работает функция**:

1. Проверяет, был ли уже получен список моделей. Если список моделей пуст, вызывает метод `get_models` родительского класса `OpenaiTemplate` для получения списка моделей.
2. Возвращает список доступных моделей.

```
Проверка наличия списка моделей -> Получение списка моделей от OpenaiTemplate -> Возврат списка моделей
```

**Примеры**:

```python
models = Jmuz.get_models()
print(models)
```

### `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`

```python
@classmethod
async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        stream: bool = True,
        api_key: str = None, # Remove api_key from kwargs
        **kwargs
) -> AsyncResult:
    """
    Асинхронно генерирует ответы от модели.

    Args:
        model (str): Название модели для генерации ответа.
        messages (Messages): Список сообщений для передачи в модель.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных. По умолчанию `True`.
        api_key (str): Ключ API (не используется, удален из kwargs). По умолчанию `None`.
        **kwargs: Дополнительные аргументы для передачи в функцию `super().create_async_generator()`.

    Returns:
        AsyncResult: Асинхронный генератор чанков ответа.
    """
```

**Назначение**: Функция `create_async_generator` асинхронно генерирует ответы от указанной модели на основе предоставленных сообщений.

**Параметры**:
- `model` (str): Название модели для генерации ответа.
- `messages` (Messages): Список сообщений для передачи в модель.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных. По умолчанию `True`.
- `api_key` (str): Ключ API (не используется, удален из kwargs). По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы для передачи в функцию `super().create_async_generator()`.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор чанков ответа.

**Как работает функция**:

1. Получает название модели, используя метод `get_model`.
2. Определяет заголовки, включая ключ API.
3. Итерируется по чанкам, полученным из `super().create_async_generator`.
4.  Очищает от нежелательных подстрок. Проверяет и удаляет нежелательные подстроки, такие как `"Join for free"`, `"https://discord.gg/"` и `"o1-preview"` из буфера.
5.  Удаляет начальные пробелы. Удаляет начальные пробелы из буфера, если это первый чанк.
6.  Выдаёт чанки. Если буфер не пуст, отмечает, что генерация началась, выдаёт содержимое буфера и очищает его.
7.  Возвращает асинхронный генератор чанков ответа.

```
Получение названия модели -> Определение заголовков -> Итерация по чанкам из super().create_async_generator ->
Очистка нежелательных подстрок -> Удаление начальных пробелов -> Выдача чанков -> Возврат асинхронного генератора чанков ответа
```

**Примеры**:

```python
async for chunk in Jmuz.create_async_generator(model="gpt-4o", messages=[{"role": "user", "content": "Hello"}]):
    print(chunk)
Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код из файла `affiliated_products_generator.py` отвечает за получение информации о товарах с сайта AliExpress, включая аффилированные ссылки, изображения и видео.  Он обрабатывает список идентификаторов продуктов (URL или ID), получает аффилированные ссылки, извлекает подробную информацию о товарах, сохраняет изображения и видео локально, и сохраняет всю полученную информацию в файлы JSON.

Шаги выполнения
-------------------------
1. **Инициализация:** Класс `AliAffiliatedProducts` инициализируется с языком и валютой для кампании. Если эти значения не предоставлены, генерируется критическое сообщение об ошибке и выполнение останавливается. Наследуется от `AliApi` для использования его методов.

2. **Обработка списков продуктов:** Метод `process_affiliate_products` принимает список идентификаторов продуктов (`prod_ids`) и директорию для сохранения результатов (`category_root`).

3. **Получение аффилированных ссылок:**  Код переводит все идентификаторы продуктов в `https`-URL (если необходимо). Затем для каждого URL в списке вызывается метод `get_affiliate_links` родительского класса (`AliApi`), чтобы получить аффилированную ссылку. Если ссылка найдена, она добавляется в список `_promotion_links`. Если ссылка не найдена, пропускается.  

4. **Проверка на наличие ссылок:**  Если ни одна аффилированная ссылка не найдена, генерируется предупреждающее сообщение и функция завершается.

5. **Извлечение данных о продуктах:** Метод `retrieve_product_details` используется для получения деталей продуктов по найденным аффилированным ссылкам. Результаты помещаются в список `_affiliated_products`. Если данные о продуктах не получены, функция завершается.

6. **Обработка каждого продукта:** Цикл проходит по списку `_affiliated_products` и по списку `_promotion_links`.  Для каждого продукта:
    - устанавливает язык и аффилированную ссылку продукта.
    - сохраняет основное изображение продукта в файл PNG.
    - если у продукта есть видео, сохраняет его в файл.
    - сохраняет данные о продукте в файл JSON с именем, основанным на идентификаторе продукта и выбранном языке/валюте.
    - добавляет обработанный продукт в `affiliated_products_list`.

7. **Сохранение списка названий продуктов:**  В конце, список заголовков продуктов сохраняется в текстовый файл.

8. **Возврат списка:** Функция возвращает список `affiliated_products_list` с обработанными объектами продуктов.


Пример использования
-------------------------
.. code-block:: python

    import asyncio
    from pathlib import Path
    from types import SimpleNamespace
    from hypotez.src.suppliers.aliexpress import AliAffiliatedProducts
    
    async def main():
        prod_ids = ["http://example.com/product1", "http://example.com/product2"]
        category_root = Path("./output_directory")  # Путь к директории
        affiliate_products = AliAffiliatedProducts(language='RU', currency='RUB')
        products = await affiliate_products.process_affiliate_products(prod_ids, category_root)
        for product in products:
            print(product.product_title)

    if __name__ == "__main__":
        asyncio.run(main())
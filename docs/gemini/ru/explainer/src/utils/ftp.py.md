## ИНСТРУКЦИЯ:

Анализируй предоставленный код подробно и объясни его функциональность. Ответ должен включать три раздела:

1.  **<алгоритм>**: Опиши рабочий процесс в виде пошаговой блок-схемы, включая примеры для каждого логического блока, и проиллюстрируй поток данных между функциями, классами или методами.
2.  **<mermaid>**: Напиши код для диаграммы в формате `mermaid`, проанализируй и объясни все зависимости,
    которые импортируются при создании диаграммы.
    **ВАЖНО!** Убедитесь, что все имена переменных, используемые в диаграмме `mermaid`,
    имеют осмысленные и описательные имена. Имена переменных вроде `A`, `B`, `C`, и т.д., не допускаются!

    **Дополнительно**: Если в коде есть импорт `import header`, добавьте блок `mermaid` flowchart, объясняющий `header.py`:
    ```mermaid
    flowchart TD
        Start --> Header[<code>header.py</code><br> Determine Project Root]

        Header --> import[Import Global Settings: <br><code>from src import gs</code>]
    ```

3.  **<объяснение>**: Предоставьте подробные объяснения:
    - **Импорты**: Их назначение и взаимосвязь с другими пакетами `src.`.
    - **Классы**: Их роль, атрибуты, методы и взаимодействие с другими компонентами проекта.
    - **Функции**: Их аргументы, возвращаемые значения, назначение и примеры.
    - **Переменные**: Их типы и использование.
    - Выделите потенциальные ошибки или области для улучшения.

Дополнительно, постройте цепочку взаимосвязей с другими частями проекта (если применимо).

Это обеспечивает всесторонний и структурированный анализ кода.
## Формат ответа: `.md` (markdown)
**КОНЕЦ ИНСТРУКЦИИ**
```markdown
## <алгоритм>
### Функция `write` (Отправка файла на FTP)

1.  **Начало**: Функция `write` принимает три аргумента: `source_file_path` (путь к локальному файлу), `dest_dir` (директория на FTP сервере), и `dest_file_name` (имя файла на FTP сервере).
    *   Пример: `source_file_path = 'local/file.txt'`, `dest_dir = '/remote/dir'`, `dest_file_name = 'remote_file.txt'`

2.  **Установка FTP соединения**:
    *   Создается объект `ftplib.FTP` используя параметры из `_connection` (`server`, `user`, `password`).
    *   Пример: `session = ftplib.FTP('ftp.example.com', 'username', 'password')`.
    *   Происходит переход в указанную директорию на FTP сервере с помощью `session.cwd(dest_dir)`.

3.  **Открытие локального файла**:
    *   Открывается локальный файл для чтения в двоичном режиме (`'rb'`).
    *   Пример: `with open('local/file.txt', 'rb') as f:`

4.  **Отправка файла на FTP**:
    *   Используется метод `session.storbinary()` для отправки содержимого файла на FTP сервер под именем `dest_file_name`.
    *   Пример: `session.storbinary('STOR remote_file.txt', f)`

5.  **Закрытие соединения**:
    *   В блоке `finally` закрывается FTP соединение с помощью `session.quit()`.
    *   Возвращается `True` в случае успеха, `False` при ошибке.

### Функция `read` (Чтение файла с FTP)

1.  **Начало**: Функция `read` принимает три аргумента: `source_file_path` (путь для сохранения локального файла), `dest_dir` (директория на FTP сервере), и `dest_file_name` (имя файла на FTP сервере).
    *   Пример: `source_file_path = 'local/file.txt'`, `dest_dir = '/remote/dir'`, `dest_file_name = 'remote_file.txt'`

2.  **Установка FTP соединения**:
    *   Создается объект `ftplib.FTP` используя параметры из `_connection`.
    *   Пример: `session = ftplib.FTP('ftp.example.com', 'username', 'password')`.
    *   Происходит переход в указанную директорию на FTP сервере с помощью `session.cwd(dest_dir)`.

3.  **Получение файла с FTP**:
    *   Локально создается файл в режиме записи (`'wb'`).
    *   Используется метод `session.retrbinary()` для скачивания содержимого файла с FTP сервера.
    *   Пример: `session.retrbinary('RETR remote_file.txt', f.write)`

4.  **Чтение локально сохраненного файла**:
    *   Локальный файл открывается в режиме чтения байтов (`'rb'`).
    *   Содержимое файла возвращается в виде байтовой строки.

5.  **Закрытие соединения**:
    *   В блоке `finally` закрывается FTP соединение с помощью `session.quit()`.
    *   Возвращается содержимое файла или `None` в случае ошибки.

### Функция `delete` (Удаление файла с FTP)

1.  **Начало**: Функция `delete` принимает три аргумента: `source_file_path` (не используется), `dest_dir` (директория на FTP сервере), и `dest_file_name` (имя файла на FTP сервере).
    *   Пример: `source_file_path = 'local/file.txt'`, `dest_dir = '/remote/dir'`, `dest_file_name = 'remote_file.txt'`

2.  **Установка FTP соединения**:
    *   Создается объект `ftplib.FTP` используя параметры из `_connection`.
    *   Пример: `session = ftplib.FTP('ftp.example.com', 'username', 'password')`.
    *   Происходит переход в указанную директорию на FTP сервере с помощью `session.cwd(dest_dir)`.

3.  **Удаление файла на FTP**:
    *   Используется метод `session.delete()` для удаления файла с FTP сервера.
    *   Пример: `session.delete('remote_file.txt')`

4.  **Закрытие соединения**:
    *   В блоке `finally` закрывается FTP соединение с помощью `session.quit()`.
    *   Возвращается `True` в случае успеха, `False` при ошибке.

## <mermaid>
```mermaid
flowchart TD
    subgraph write
        A[Start: write(source_file_path, dest_dir, dest_file_name)] --> B{Establish FTP Connection}
        B -- Success --> C[Change directory: session.cwd(dest_dir)]
        B -- Fail --> G[Log Error and Return False]
        C --> D{Open Source File}
        D -- Success --> E[Send File: session.storbinary(dest_file_name, file)]
        D -- Fail --> F[Log Error and Return False]
        E -- Success --> H[Return True]
        E -- Fail --> F
        F --> G
        H --> I(Close FTP Connection)
        I --> J[End: Return True/False]
        G --> J
    end
    
    subgraph read
        K[Start: read(source_file_path, dest_dir, dest_file_name)] --> L{Establish FTP Connection}
        L -- Success --> M[Change directory: session.cwd(dest_dir)]
         L -- Fail --> R[Log Error and Return None]
        M --> N{Create Local File}
        N --> O[Receive File: session.retrbinary(dest_file_name, file)]
        O -- Success --> P[Read Local File and Return content]
        O -- Fail --> R
        P --> Q(Close FTP Connection)
        Q --> S[End: Return content/None]
        R --> S
    end
    
     subgraph delete
        T[Start: delete(source_file_path, dest_dir, dest_file_name)] --> U{Establish FTP Connection}
         U -- Success --> V[Change directory: session.cwd(dest_dir)]
        U -- Fail --> Y[Log Error and Return False]
        V --> W{Delete File: session.delete(dest_file_name)}
         W -- Success --> X[Return True]
        W -- Fail --> Y
        X --> Z(Close FTP Connection)
        Z --> AA[End: Return True/False]
         Y --> AA
    end
```
### Описание `mermaid` диаграммы:

**Общая структура:** Диаграмма представляет собой три отдельных подграфа, каждый из которых описывает логику одной из функций: `write`, `read` и `delete`. Каждый подграф начинается с блока "Start" и заканчивается блоком "End".

**`write` subGraph:**
   - `A`: Начало функции `write`, принимающей пути к исходному файлу, директорию и имя файла назначения.
    - `B`: Пытается установить соединение с FTP-сервером. При неудаче, переходит к `G`.
    - `C`: Меняет текущую директорию на сервере на `dest_dir`.
    - `D`: Открывает файл `source_file_path`. При неудаче переходит в `F`.
    - `E`: Отправляет содержимое файла на FTP сервер. При неудаче переходит в `F`.
    - `F`: Логирует ошибку отправки файла и возвращает `False`.
    - `G`: Логирует ошибку соединения с FTP и возвращает `False`.
    - `H`: Возвращает `True` после успешной отправки файла.
     - `I`: Закрывает соединение FTP.
    - `J`: Завершает выполнение `write` и возвращает `True` или `False`.

**`read` subGraph:**
    - `K`: Начало функции `read`, принимающей путь сохранения файла, директорию и имя файла на FTP.
    - `L`: Пытается установить соединение с FTP-сервером. При неудаче, переходит к `R`.
    - `M`: Меняет текущую директорию на сервере на `dest_dir`.
    - `N`: Создает локальный файл по пути `source_file_path`.
    - `O`: Получает файл с FTP-сервера и записывает его в локальный файл. При неудаче переходит в `R`.
    - `P`: Считывает содержимое локально сохраненного файла.
    - `Q`: Закрывает соединение FTP.
     - `R`: Логирует ошибку и возвращает `None`.
    - `S`: Завершает выполнение `read` и возвращает содержимое файла или `None`.

**`delete` subGraph:**
    - `T`: Начало функции `delete`, принимающей путь к файлу (не используется), директорию и имя файла на FTP.
    - `U`: Пытается установить соединение с FTP-сервером. При неудаче, переходит к `Y`.
    - `V`: Меняет текущую директорию на сервере на `dest_dir`.
    - `W`: Удаляет файл с FTP-сервера. При неудаче переходит в `Y`.
    - `X`: Возвращает `True` после успешного удаления файла.
    - `Y`: Логирует ошибку удаления файла и возвращает `False`.
     - `Z`: Закрывает соединение FTP.
    - `AA`: Завершает выполнение `delete` и возвращает `True` или `False`.

**Зависимости:**
-  `ftplib`: используется для установления FTP соединения и выполнения FTP операций (`session.cwd`, `session.storbinary`, `session.retrbinary`, `session.delete`, `session.quit`).
-  `pathlib`: используется для определения путей к файлам.
-  `src.logger.logger`: используется для логирования ошибок.

## <объяснение>

### Импорты:
*   **`MODE = 'dev'`**: Глобальная переменная для определения режима работы, в данном случае это режим разработки.
*   **`from src.logger.logger import logger`**: Импортирует объект `logger` из модуля `src.logger.logger`, предназначенный для записи логов (сообщений об ошибках и других событий). Этот объект используется для записи информации об ошибках, которые возникают во время выполнения функций.
*   **`from typing import Union`**: Импортирует `Union` для указания, что функция может возвращать значение одного из нескольких указанных типов.
*   **`import ftplib`**: Импортирует стандартную библиотеку `ftplib`, предоставляющую классы и методы для взаимодействия с FTP-серверами.
*   **`from pathlib import Path`**: Импортирует класс `Path` из модуля `pathlib`, который позволяет работать с путями к файлам и директориям в операционной системе. (В данном коде не используется)

### Переменные:
*   **`_connection`**: Словарь, содержащий конфигурацию для подключения к FTP серверу (`server`, `port`, `user`, `password`). Предполагается, что этот словарь определен где-то в другом месте проекта и не является константой.

### Функции:
1.  **`write(source_file_path: str, dest_dir: str, dest_file_name: str) -> bool`**:
    *   **Аргументы**:
        *   `source_file_path` (str): Путь к локальному файлу, который нужно отправить на FTP-сервер.
        *   `dest_dir` (str): Директория на FTP-сервере, куда нужно отправить файл.
        *   `dest_file_name` (str): Имя файла, под которым он будет сохранен на FTP-сервере.
    *   **Возвращает**:
        *   `True`, если файл был успешно отправлен на сервер.
        *   `False`, если во время отправки произошла ошибка.
    *   **Назначение**: Отправляет файл на FTP-сервер.
    *   **Пример**: `write('local_file.txt', '/remote/dir', 'remote_file.txt')`
    *   **Логика**:
        1.  Создается FTP-соединение.
        2.  Переходит в целевую директорию на сервере.
        3.  Открывает локальный файл в бинарном режиме для чтения.
        4.  Отправляет содержимое файла на сервер.
        5.  Закрывает FTP-соединение в `finally` блоке, независимо от результатов.
        6.  Возвращает `True` при успехе, `False` при ошибке.

2.  **`read(source_file_path: str, dest_dir: str, dest_file_name: str) -> Union[str, bytes, None]`**:
    *   **Аргументы**:
        *   `source_file_path` (str): Путь, по которому нужно сохранить локальную копию файла, загруженного с FTP-сервера.
        *   `dest_dir` (str): Директория на FTP-сервере, где находится файл.
        *   `dest_file_name` (str): Имя файла на FTP-сервере.
    *   **Возвращает**:
        *   Содержимое файла в виде байтовой строки (`bytes`), если файл успешно загружен.
        *   `None`, если во время загрузки произошла ошибка.
    *   **Назначение**: Получает файл с FTP-сервера.
    *   **Пример**: `read('local_file.txt', '/remote/dir', 'remote_file.txt')`
    *   **Логика**:
        1.  Создается FTP-соединение.
        2.  Переходит в целевую директорию на сервере.
        3.  Создается локальный файл в бинарном режиме для записи.
        4.  Получает содержимое файла с сервера и записывает его в локальный файл.
        5.  Считывает данные из локального файла в байтах.
        6.  Закрывает FTP-соединение в `finally` блоке.
        7.  Возвращает содержимое файла или `None` при ошибке.

3.  **`delete(source_file_path: str, dest_dir: str, dest_file_name: str) -> bool`**:
    *   **Аргументы**:
        *    `source_file_path` (str): Путь к файлу (не используется),
        *   `dest_dir` (str): Директория на FTP-сервере, где находится файл для удаления.
        *   `dest_file_name` (str): Имя файла на FTP-сервере.
    *   **Возвращает**:
        *   `True`, если файл был успешно удален с сервера.
        *   `False`, если во время удаления произошла ошибка.
    *   **Назначение**: Удаляет файл на FTP-сервере.
    *   **Пример**: `delete('local_file.txt', '/remote/dir', 'remote_file.txt')`
    *   **Логика**:
        1.  Создается FTP-соединение.
        2.  Переходит в целевую директорию на сервере.
        3.  Удаляет файл с сервера.
        4.  Закрывает FTP-соединение в `finally` блоке.
        5.  Возвращает `True` при успехе, `False` при ошибке.

### Потенциальные ошибки и области для улучшения:
*   **Обработка исключений:**
    *   Используется общая обработка исключений `except Exception as ex:`, что может затруднить отладку. Лучше обрабатывать конкретные типы исключений, например `ftplib.error_perm`, `ftplib.error_temp`.
    *   В блоках `finally` логируются ошибки закрытия соединения, но не обрабатываются.
*   **Безопасность:**
    *   Пароль от FTP сервера хранится в открытом виде в словаре `_connection`. Нужно использовать более безопасный способ хранения учетных данных, например переменные среды или vault.
    *   Нет проверки SSL/TLS соединения, что может привести к MITM (man-in-the-middle) атакам. Необходимо использовать `ftplib.FTP_TLS` для безопасных соединений.
*   **Абстракция:**
    *   Код может быть улучшен за счет создания класса, который инкапсулирует FTP-соединение и упрощает повторное использование.
    *   Конфигурация FTP-соединения (`_connection`) должна загружаться из внешнего файла или переменных окружения.
*   **Не используется аргумент `source_file_path` в функции `delete`**.

### Цепочка взаимосвязей:
1.  `ftp.py` (текущий модуль) импортирует `logger` из `src.logger.logger`. Это означает, что `ftp.py` использует функциональность логирования, предоставляемую `src.logger.logger`.
2.  Предполагается, что параметры FTP соединения `_connection` берутся из глобальной конфигурации или переменных среды, что является дополнительной связью с глобальными параметрами проекта.

В целом, `ftp.py` предоставляет основные функции для работы с FTP-сервером, но его можно улучшить, сделав код более безопасным, надежным и поддерживаемым.
```
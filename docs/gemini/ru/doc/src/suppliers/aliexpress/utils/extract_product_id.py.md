# Модуль `extract_product_id.py`

## Обзор

Модуль предназначен для извлечения идентификаторов продуктов (product IDs) из URL-адресов, связанных с AliExpress. Он также может возвращать идентификаторы, если они уже предоставлены в явном виде. Модуль содержит функции для обработки как отдельных URL, так и списков URL, и использует регулярные выражения для поиска и извлечения идентификаторов продуктов.

## Подробней

Этот модуль играет важную роль в проекте `hypotez`, поскольку он позволяет извлекать product ID из URL-адресов, полученных от AliExpress. Это особенно полезно для автоматизации процессов, таких как сбор данных о продуктах, мониторинг цен и сравнение товаров. Модуль предоставляет гибкий способ обработки различных форматов URL и гарантирует, что извлеченные идентификаторы являются допустимыми.

## Функции

### `extract_prod_ids`

```python
def extract_prod_ids(urls: str | list[str]) -> str | list[str] | None:
    """ Extracts item IDs from a list of URLs or directly returns IDs if given.

    Args:
        urls (str | list[str]): A URL, a list of URLs, or product IDs.

    Returns:
        str | list[str] | None: A list of extracted item IDs, a single ID, or `None` if no valid ID is found.

    Examples:
        >>> extract_prod_ids("https://www.aliexpress.com/item/123456.html")
        '123456'

        >>> extract_prod_ids(["https://www.aliexpress.com/item/123456.html", "7891011.html"])
        ['123456', '7891011']

        >>> extract_prod_ids(["https://www.example.com/item/123456.html", "https://www.example.com/item/abcdef.html"])
        ['123456']

        >>> extract_prod_ids("7891011")
        '7891011'

        >>> extract_prod_ids("https://www.example.com/item/abcdef.html")
        None
    """
    ...
```

**Назначение**: Извлекает идентификаторы товаров из списка URL-адресов или возвращает идентификаторы, если они предоставлены напрямую.

**Параметры**:

- `urls` (str | list[str]): URL-адрес, список URL-адресов или идентификаторы продуктов.

**Возвращает**:

- `str | list[str] | None`: Список извлеченных идентификаторов товаров, отдельный идентификатор или `None`, если не найдено ни одного допустимого идентификатора.

**Как работает функция**:

1. **Определение регулярного выражения**: Определяется регулярное выражение для поиска идентификаторов продуктов в URL-адресах.

2. **Внутренняя функция `extract_id`**: Определяется внутренняя функция `extract_id`, которая извлекает идентификатор продукта из заданного URL-адреса или проверяет его допустимость.

3. **Обработка входных данных**: Если `urls` является списком, функция применяет `extract_id` к каждому URL-адресу в списке, фильтрует `None` значения и возвращает список извлеченных идентификаторов. Если `urls` является строкой, функция напрямую вызывает `extract_id` и возвращает результат.

4. **Возврат результата**: Функция возвращает список извлеченных идентификаторов, если они были найдены, отдельный идентификатор, если был предоставлен один URL, или `None`, если не найдено допустимых идентификаторов.

**Внутренние функции**:

### `extract_id`

```python
 def extract_id(url: str) -> str | None:
        """ Extracts a product ID from a given URL or validates a product ID.

        Args:
            url (str): The URL or product ID.

        Returns:
            str | None: The extracted product ID or the input itself if it's a valid ID, or `None` if no valid ID is found.

        Examples:
            >>> extract_id("https://www.aliexpress.com/item/123456.html")
            '123456'

            >>> extract_id("7891011")
            '7891011'

            >>> extract_id("https://www.example.com/item/abcdef.html")
            None
        """
        ...
```

**Назначение**: Извлекает идентификатор продукта из заданного URL-адреса или проверяет идентификатор продукта.

**Параметры**:

- `url` (str): URL-адрес или идентификатор продукта.

**Возвращает**:

- `str | None`: Извлеченный идентификатор продукта или сам ввод, если это допустимый идентификатор, или `None`, если не найдено допустимого идентификатора.

**Как работает функция**:

1. **Проверка на число**: Проверяет, является ли входная строка числом. Если да, возвращает её.

2. **Поиск по шаблону**: Если входная строка не является числом, пытается извлечь идентификатор продукта из URL-адреса с использованием регулярного выражения.

3. **Возврат результата**: Если идентификатор найден, возвращает его. В противном случае возвращает `None`.

**ASCII flowchart функции `extract_prod_ids`**:

```
A (Входные данные: URL или список URL)
│
├─── B (Проверка типа входных данных)
│    │
│    ├─── Если список:
│    │    │
│    │    └─── C (Применение extract_id к каждому URL)
│    │         │
│    │         └─── D (Фильтрация None значений)
│    │              │
│    │              └─── E (Возврат списка ID или None)
│    │
│    └─── Если строка:
│         │
│         └─── F (Вызов extract_id для URL)
│              │
│              └─── G (Возврат ID или None)
│
└─── H (Выходные данные: список ID, ID или None)
```

Где:
- `A`: Получение входных данных (URL или список URL).
- `B`: Проверка типа входных данных (список или строка).
- `C`: Применение функции `extract_id` к каждому URL в списке.
- `D`: Фильтрация значений `None` из списка извлеченных ID.
- `E`: Возврат списка извлеченных ID или `None`, если список пуст.
- `F`: Вызов функции `extract_id` для извлечения ID из URL.
- `G`: Возврат извлеченного ID или `None`, если ID не найден.
- `H`: Выходные данные функции.

**Примеры**:

```python
>>> extract_prod_ids("https://www.aliexpress.com/item/123456.html")
'123456'

>>> extract_prod_ids(["https://www.aliexpress.com/item/123456.html", "7891011.html"])
['123456', '7891011']

>>> extract_prod_ids(["https://www.example.com/item/123456.html", "https://www.example.com/item/abcdef.html"])
['123456']

>>> extract_prod_ids("7891011")
'7891011'

>>> extract_prod_ids("https://www.example.com/item/abcdef.html")
None
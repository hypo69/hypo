# Модуль для запуска WebView интерфейса g4f

## Обзор

Модуль `webview.py` отвечает за запуск графического интерфейса пользователя (GUI) для проекта `g4f` с использованием библиотеки `webview`. Он определяет функцию `run_webview`, которая создает окно с веб-интерфейсом, а также обрабатывает аргументы командной строки для настройки поведения GUI.

## Подробней

Этот модуль предназначен для интеграции веб-интерфейса в приложение `g4f`. Он использует библиотеку `webview` для создания нативного окна, в котором отображается веб-страница. Это позволяет пользователям взаимодействовать с приложением через привычный веб-интерфейс, используя HTML, CSS и JavaScript.

## Функции

### `run_webview`

```python
def run_webview(
    debug: bool = False,
    http_port: int = None,
    ssl: bool = True,
    storage_path: str = None,
    gui: str = None
):
    """ Запускает WebView интерфейс для g4f.

    Args:
        debug (bool, optional): Включает режим отладки. По умолчанию `False`.
        http_port (int, optional): HTTP порт для WebView. По умолчанию `None`.
        ssl (bool, optional): Использовать SSL. По умолчанию `True`.
        storage_path (str, optional): Путь для хранения данных WebView. По умолчанию `None`.
        gui (str, optional): Не используется.

    Raises:
        ImportError: Если не удалось импортировать `platformdirs`.

    """
```

**Назначение**: Функция `run_webview` настраивает и запускает окно WebView, в котором отображается пользовательский интерфейс g4f.

**Параметры**:
- `debug` (bool, optional): Если `True`, включает режим отладки для WebView. По умолчанию `False`.
- `http_port` (int, optional): Определяет HTTP-порт для WebView. Если не указан, используется порт по умолчанию. По умолчанию `None`.
- `ssl` (bool, optional): Если `True`, включает использование SSL для безопасного соединения. По умолчанию `True`.
- `storage_path` (str, optional): Указывает путь для хранения данных WebView, таких как кэш и файлы cookie. Если не указан, используется путь по умолчанию, определяемый библиотекой `platformdirs`. По умолчанию `None`.
- `gui` (str, optional): Этот параметр в данном коде не используется. По умолчанию `None`.

**Как работает функция**:

1. **Определение каталога**: Определяет каталог, в котором находится приложение. Если приложение запущено в "замороженном" состоянии (например, как исполняемый файл, созданный с помощью PyInstaller), то используется каталог, в котором находится исполняемый файл. В противном случае используется каталог, в котором находится текущий скрипт.

2. **Настройка WebView**: Устанавливает настройки для WebView, разрешая открытие внешних ссылок в браузере и загрузку файлов.
   - `webview.settings['OPEN_EXTERNAL_LINKS_IN_BROWSER'] = True`
   - `webview.settings['ALLOW_DOWNLOADS'] = True`

3. **Создание окна WebView**: Создает окно WebView с указанным заголовком и содержимым. Заголовок окна включает текущую версию g4f. В качестве содержимого используется файл `index.html`, расположенный в подкаталоге `client`. Также включается поддержка выделения текста и регистрируется JavaScript API (`JsApi`).
   - `webview.create_window(...)`

4. **Определение пути для хранения данных**: Если библиотека `platformdirs` доступна и путь для хранения данных не указан, то используется путь, определяемый `platformdirs.user_config_dir("g4f-webview")`.

5. **Запуск WebView**: Запускает WebView с указанными параметрами, такими как отключенный приватный режим, путь для хранения данных, режим отладки, HTTP-порт и использование SSL.
   - `webview.start(...)`

```ascii
Определение каталога -> Настройка WebView -> Создание окна WebView -> Определение пути для хранения данных -> Запуск WebView
```

**Примеры**:

1. Запуск WebView с параметрами по умолчанию:

```python
run_webview()
```

2. Запуск WebView в режиме отладки:

```python
run_webview(debug=True)
```

3. Запуск WebView с указанием HTTP-порта:

```python
run_webview(http_port=8080)
```

## Запуск из командной строки

В блоке `if __name__ == "__main__":` происходит следующее:

1. **Создание парсера аргументов**: Создается парсер аргументов командной строки с использованием функции `gui_parser()`.
   - `parser = gui_parser()`

2. **Разбор аргументов**: Выполняется разбор аргументов командной строки с использованием метода `parse_args()`.
   - `args = parser.parse_args()`

3. **Включение отладочного логирования**: Если указан аргумент `--debug`, то включается отладочное логирование.
   - `if args.debug: g4f.debug.logging = True`

4. **Запуск WebView**: Вызывается функция `run_webview` с параметрами, полученными из аргументов командной строки.
   - `run_webview(args.debug, args.port, not args.debug)`
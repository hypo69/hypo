# Анализ кода модуля e_801.md

**Качество кода**
7
-  Плюсы
    - Код содержит подробное описание задачи Project Euler, включая условия и примеры.
    - Структура описания задачи понятна и логична.
    - Приведены примеры для лучшего понимания условия задачи.
-  Минусы
    - Отсутствует какой-либо программный код.
    - Не хватает четкого определения входных и выходных данных для программной реализации.
    - Нет явного указания на необходимость использования `j_loads` или `j_loads_ns` из `src.utils.jjson`, так как нет работы с файлами.
    - Нет импортов и функций, необходимых для решения задачи.
    - Необходима структура кода с использованием reStructuredText (RST) комментариев.

**Рекомендации по улучшению**
1. Необходимо добавить программный код для решения задачи.
2.  Следует добавить docstring к функциям и классам, если они будут.
3.  Добавить обработку ошибок с использованием `logger.error` при необходимости.
4.  Включить примеры использования кода для демонстрации решения.
5.  Добавить комментарии в формате RST.

**Оптимизиробанный код**
```markdown
# Задача No 801
## Конфетная фабрика
"""
Модуль для решения задачи 801 проекта Эйлер.
================================================

Задача о подсчете количества красных конфет, которые могут быть собраны Гарри при заданном порядке конфет.

"""
## Условия
На конфетной фабрике есть бесконечный поток конфет, идущих по конвейерной ленте. Конфеты бывают трех видов: красные, зеленые и синие.

Гарри и Гермиона работают на фабрике, и их задача - забирать конфеты с конвейера и класть их в коробки. Они могут забирать конфеты в любом порядке, но должны соблюдать следующие правила:
* У Гарри есть коробка, в которую он может класть только красные конфеты.
* У Гермионы есть коробка, в которую она может класть только зеленые или синие конфеты.

Кроме того, и Гарри, и Гермиона должны следовать дополнительному правилу:
* Они должны забирать **как минимум** одну конфету каждого цвета, прежде чем снова могут забрать конфету того же цвета.

Например, если конвейерная лента показывает последовательность конфет R, G, B, R, G, B, R, G, B, ..., то Гарри и Гермиона могут забрать 3 красные конфеты, 3 зеленые конфеты и 3 синие конфеты, в любой последовательности, при этом все правила будут соблюдены.

Предположим, что у нас есть последовательность конфет на конвейере, представленная циклом:

`RBG BGR RGB GRB`

Эта последовательность повторяется бесконечно.

Пусть $a_n$ будет количеством красных конфет, которые могут собрать Гарри из первых *n* конфет на конвейере. Для приведенной выше последовательности:
$a_1=1$ (R),
$a_2=1$ (RB),
$a_3=1$ (RBG),
$a_4=1$ (RBGB),
$a_5=1$ (RBGBG),
$a_6=2$ (RBGBGR),
$a_7=2$ (RBGBGRB),
$a_8=2$ (RBGBGRBG),
$a_9=3$ (RBGBGRBGB),
$a_{10}=3$ (RBGBGRBGBR),
$a_{11}=3$ (RBGBGRBGBRG),
$a_{12}=3$ (RBGBGRBGBRGB)
$a_{13}=4$ (RBGBGRBGBRGBB),
и так далее.

Пусть $S(N) = \\sum_{n=1}^{N} a_n$.

Дано, что $S(10^4) = 21699$.

Найдите $S(10^{14})$.
"""
import logging
from typing import List
from src.logger.logger import logger # Импорт logger

def solve_problem_801(n: int, sequence: str) -> int:
    """
    Вычисляет сумму собранных красных конфет для первых n конфет в последовательности.

    :param n: Количество конфет для анализа.
    :param sequence: Последовательность конфет, которая повторяется.
    :return: Сумма собранных красных конфет.
    
    """
    try:
        # Инициализирует необходимые переменные
        total_red_candies = 0
        collected_red_candies = 0
        last_collected = {'R': False, 'G': False, 'B': False}
        repeated_sequence = sequence * (n // len(sequence) + 1)

        # Перебирает первые n конфет
        for i in range(n):
            candy = repeated_sequence[i]
            if candy == 'R' and not last_collected['R']:
              collected_red_candies += 1
              last_collected['R'] = True
              last_collected['G'] = False
              last_collected['B'] = False
            elif candy == 'G' and not last_collected['G']:
               last_collected['G'] = True
            elif candy == 'B' and not last_collected['B']:
                last_collected['B'] = True

            total_red_candies += collected_red_candies
        return total_red_candies
    except Exception as e:
        logger.error(f'Произошла ошибка при вычислении S({n}): {e}', exc_info=True)
        return 0

if __name__ == '__main__':
    # Пример использования и проверки
    test_sequence = "RBGBGRRGBGRB"
    test_n = 10000
    expected_sum = 21699
    result = solve_problem_801(test_n, test_sequence)
    if result == expected_sum:
        print(f"Тест для n={test_n}: Пройден, S({test_n}) = {result} - OK")
    else:
        print(f"Тест для n={test_n}: Ошибка, S({test_n}) = {result}, ожидалось {expected_sum}")
    
    n = 10**14
    result = solve_problem_801(n, test_sequence)
    print(f"S({n}) = {result}")
```
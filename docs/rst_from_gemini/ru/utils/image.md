```markdown
# hypotez/src/utils/image.py

**Расположение:** `C:\Users\user\Documents\repos\hypotez\src\utils\image.py`

**Роль:** Модуль для асинхронной загрузки, сохранения и получения данных изображений.

**Описание:**

Этот модуль предоставляет асинхронные функции для работы с изображениями: загрузку из URL, сохранение в локальные файлы (в формате PNG) и чтение данных из файлов.

**Функции:**

* **`save_png_from_url(image_url: str, filename: str | Path) -> str | None`:**
    * Асинхронно загружает изображение из URL и сохраняет его локально в формате PNG.
    * Возвращает путь к сохранённому файлу или `None`, если произошла ошибка.
    * Обрабатывает возможные исключения при загрузке.

* **`save_png(image_data: bytes, file_name: str | Path) -> str | None`:**
    * Асинхронно сохраняет изображение из байтовых данных в формате PNG.
    * Создаёт необходимые директории, если они отсутствуют.
    * Проверяет, что файл успешно создан и не пустой.
    * Возвращает путь к сохранённому файлу или `None` при ошибке.
    * Использует `aiofiles` для асинхронного сохранения.
    * Проверяет размер файла после сохранения, чтобы убедиться, что сохранение прошло успешно.
    * Важно: Использует `image.save(file_path, "PNG")` для правильного сохранения в формате PNG.

* **`get_image_data(file_name: str | Path) -> bytes | None`:**
    * Возвращает бинарные данные файла, если он существует.
    * Возвращает `None`, если файл не найден или произошла ошибка при чтении.

**Примеры использования:**

```python
import asyncio
from src.utils.image import save_png_from_url, save_png, get_image_data

# Загрузка изображения из URL
asyncio.run(save_png_from_url("https://example.com/image.png", "local_image.png"))

# Сохранение изображения из байтовых данных
with open("example_image.png", "rb") as f:
    image_data = f.read()
asyncio.run(save_png(image_data, "saved_image.png"))

# Чтение данных из файла
image_bytes = get_image_data("saved_image.png")
if image_bytes:
    print(image_bytes[:10]) # Выводит первые 10 байт данных
```

**Дополнительные замечания:**

* **Обработка ошибок:** Функции содержат `try...except` блоки для обработки потенциальных ошибок (например, проблемы с сетью, ошибку ввода-вывода).  Критические ошибки логируются с использованием `logger`.
* **Асинхронность:**  Использование `asyncio` позволяет выполнять операции в фоновом режиме.
* **Валидация:** Проверка существования файла и размера файла после сохранения обеспечивает надёжность.
* **Использование `Path`:** Использование `pathlib.Path` для работы с путями делает код более читаемым и переносимым.
* **`aiofiles`:**  Использование `aiofiles` для асинхронного ввода-вывода файлов.
* **Логирование:**  Использование `logger` для записи сообщений об ошибках.

**Рекомендации:**

* Подключите необходимые модули в начале файла, например: `import asyncio`, `import aiohttp`, `from PIL import Image`, etc.
* Разместите код обработки ошибок (try...except блоки) в отдельных местах для лучшей читаемости и понимания логики.
* Убедитесь, что все использованные модули (в частности, aiohttp и aiofiles) установлены.


Этот улучшенный документ предоставляет более полное описание и рекомендации по использованию модуля `image.py`.
```
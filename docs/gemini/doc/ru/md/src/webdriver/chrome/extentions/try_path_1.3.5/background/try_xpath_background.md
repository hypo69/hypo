# Модуль `try_xpath_background.js`

## Обзор

Этот модуль отвечает за обработку сообщений, полученных от вкладок, и взаимодействие с ними для отображения результатов поиска XPath. Он управляет состоянием всплывающего окна, загружает стили и обновляет CSS в вкладках.  Модуль использует API браузера для коммуникации с другими вкладками и для управления локальным хранилищем.

## Переменные

### `tx`

Алиас для объекта `tryxpath`.

### `fu`

Алиас для объекта `tryxpath.functions`.

### `popupState`

Текущее состояние всплывающего окна.

### `popupCss`

CSS-стили для всплывающего окна.

### `results`

Словарь с результатами поиска XPath.

### `css`

CSS-стили, используемые в текущей сессии.

### `attributes`

Объект, содержащий атрибуты для поиска и выделения элементов.

## Функции

### `loadDefaultCss()`

**Описание**: Загружает значения по умолчанию для CSS из файла `/css/try_xpath_insert.css`.

**Возвращает**:
- Promise, содержащий загруженный CSS-код.

**Возможные исключения**:
-  Исключения при запросе к браузерному API.


### `genericListener(message, sender, sendResponse)`

**Описание**: Общая функция-обработчик сообщений от вкладок.

**Параметры**:
- `message` (object): Сообщение от вкладки.
- `sender` (object): Объект, содержащий информацию о отправителе.
- `sendResponse` (function): Функция для отправки ответа.

**Возвращает**:
- Значение, возвращенное обработчиком, если он определен.

**Возможные исключения**:
- Любые исключения, которые могут быть вызваны обработчиком `listener`.


### `genericListener.listeners.storePopupState(message)`

**Описание**: Сохраняет состояние всплывающего окна.

**Параметры**:
- `message` (object): Сообщение, содержащее состояние.


### `genericListener.listeners.requestRestorePopupState(message)`

**Описание**: Отправляет сообщение о восстановлении состояния всплывающего окна.

**Параметры**:
- `message` (object): Сообщение, содержащее запрос.

**Возможные исключения**:
- Любые исключения при работе с браузерным API.

### `genericListener.listeners.requestInsertStyleToPopup()`

**Описание**: Отправляет сообщение о вставке CSS в всплывающее окно.

**Параметры**:
- Нет

**Возможные исключения**:
- Любые исключения при работе с браузерным API.


### `genericListener.listeners.showAllResults(message, sender)`

**Описание**:  Создает новую вкладку для отображения результатов.

**Параметры**:
- `message`: Объект с результатами поиска.
- `sender`: Объект с информацией о отправителе.

**Возможные исключения**:
- Любые исключения при работе с API браузера.



### `genericListener.listeners.loadResults(message, sender, sendResponse)`

**Описание**: Отправляет результаты поиска в ответ.

**Параметры**:
- `message`: Сообщение.
- `sender`: Объект с информацией о отправителе.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `true`.

**Возможные исключения**:
- Любые исключения при работе с API браузера.


### `genericListener.listeners.updateCss(message, sender)`

**Описание**: Обновляет CSS в текущей вкладке.

**Параметры**:
- `message`: Объект с обновляемым CSS.
- `sender`: Объект с информацией о отправителе.

**Возможные исключения**:
- `fu.onError`: Обработка ошибок при работе с API браузера.


### `genericListener.listeners.loadOptions(message, sender, sendResponse)`

**Описание**: Возвращает необходимые настройки (атрибуты, стили).

**Параметры**:
- `message`: Сообщение.
- `sender`: Объект с информацией о отправителе.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- Объект настроек.

**Возможные исключения**:
- Любые исключения при работе с API браузера.


### `genericListener.listeners.requestSetContentInfo(message, sender)`

**Описание**: Отправляет сообщение о установке информации.

**Параметры**:
- `message`: Сообщение.
- `sender`: Объект с информацией о отправителе.

**Возможные исключения**:
- Любые исключения при работе с API браузера.



## Обработчики событий браузера

### `browser.storage.onChanged.addListener`

Обработчик изменений в хранилище браузера. Обновляет значения переменных `attributes`, `css`, `popupCss` при изменении.

### `browser.storage.sync.get`

Загружает значения из браузерного хранилища. Загружает настройки, если они есть, или вызывает `loadDefaultCss()` для загрузки значений по умолчанию.


```
# Модуль для работы с веб-драйверами Selenium

## Обзор

Модуль предоставляет класс `Driver`, который обеспечивает унифицированный интерфейс для работы с веб-драйверами Selenium.
Он предоставляет интерфейс для взаимодействия с веб-браузерами, такими как Chrome, Firefox и Edge. Код вебдрайверов находится в подмодулях `chrome`, `firefox`, `edge`, `playwright`. Файлы настроек для веб-браузеров находятся в: `chrome\chrome.json`, `firefox\firefox.json`, `edge\edge.json`, `playwright\playwright.json`. Класс `Driver` упрощает задачи инициализации драйвера, навигации по URL, управления куками и обработки исключений.

## Подробнее

Класс `Driver` предназначен для упрощения взаимодействия с веб-браузерами через Selenium WebDriver. Он инкапсулирует логику инициализации драйвера, управления сессиями и выполнения основных операций, таких как навигация по URL, прокрутка страниц и сохранение куки. Это позволяет абстрагироваться от деталей реализации конкретных драйверов (Chrome, Firefox, Edge) и предоставляет единый интерфейс для работы с ними.

## Классы

### `Driver`

**Описание**: Класс обеспечивает удобный интерфейс для работы с различными драйверами, такими как Chrome, Firefox и Edge.

**Как работает класс**:
Класс `Driver` предоставляет унифицированный интерфейс для управления веб-драйверами Selenium. При инициализации класса создается экземпляр указанного веб-драйвера (например, Chrome или Firefox). Класс также обеспечивает методы для прокрутки страниц, получения текущего языка страницы, перехода по URL и сохранения куки. Он обрабатывает исключения, которые могут возникнуть при взаимодействии с веб-драйвером, и логирует ошибки.

**Методы**:

*   `__init__`: Инициализирует экземпляр класса `Driver`.
*   `__init_subclass__`: Автоматически вызывается при создании подкласса `Driver`.
*   `__getattr__`: Прокси для доступа к атрибутам драйвера.
*   `scroll`: Прокручивает страницу в указанном направлении.
*   `locale`: Определяет язык страницы на основе мета-тегов или JavaScript.
*   `get_url`: Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.
*   `window_open`: Открывает новую вкладку в текущем окне браузера и переключается на нее.
*   `wait`: Ожидает указанное количество времени.
*   `_save_cookies_localy`: Сохраняет текущие куки веб-драйвера в локальный файл.
*   `fetch_html`: Извлекает HTML-контент из файла или веб-страницы.

#### `__init__`

```python
def __init__(self, webdriver_cls, *args, **kwargs):
    """
    Инициализирует экземпляр класса Driver.

    Args:
        webdriver_cls: Класс WebDriver, например Chrome или Firefox.
        args: Позиционные аргументы для драйвера.
        kwargs: Ключевые аргументы для драйвера.

    Raises:
        TypeError: Если `webdriver_cls` не является допустимым классом WebDriver.

    Example:
        >>> from selenium.webdriver import Chrome
        >>> driver = Driver(Chrome, executable_path='/path/to/chromedriver')
    """
    ...
```

**Как работает функция**:
Функция инициализирует экземпляр класса `Driver`. Она принимает класс WebDriver (например, Chrome или Firefox) и аргументы для его инициализации. Функция проверяет, является ли переданный класс допустимым классом WebDriver, и создает экземпляр этого класса.

**Параметры**:

*   `webdriver_cls`: Класс WebDriver, например Chrome или Firefox.
*   `*args`: Позиционные аргументы для драйвера.
*   `**kwargs`: Ключевые аргументы для драйвера.

**Вызывает исключения**:

*   `TypeError`: Если `webdriver_cls` не является допустимым классом WebDriver.

**Примеры**:

```python
from selenium.webdriver import Chrome
driver = Driver(Chrome, executable_path='/path/to/chromedriver')
```

#### `__init_subclass__`

```python
def __init_subclass__(cls, *, browser_name: Optional[str] = None, **kwargs):
    """
    Автоматически вызывается при создании подкласса `Driver`.

    Args:
        browser_name: Имя браузера.
        kwargs: Дополнительные аргументы.

    Raises:
        ValueError: Если browser_name не указан.
    """
    ...
```

**Как работает функция**:
Функция автоматически вызывается при создании подкласса `Driver`. Она принимает имя браузера и дополнительные аргументы. Функция проверяет, указано ли имя браузера, и сохраняет его в атрибуте класса.

**Параметры**:

*   `browser_name`: Имя браузера.
*   `kwargs`: Дополнительные аргументы.

**Вызывает исключения**:

*   `ValueError`: Если `browser_name` не указан.

#### `__getattr__`

```python
def __getattr__(self, item: str):
    """
    Прокси для доступа к атрибутам драйвера.

    Args:
        item: Имя атрибута.

    Example:
        >>> driver.current_url
    """
    ...
```

**Как работает функция**:
Функция является прокси для доступа к атрибутам драйвера. При попытке обратиться к несуществующему атрибуту класса `Driver`, функция перенаправляет запрос к атрибуту экземпляра веб-драйвера.

**Параметры**:

*   `item`: Имя атрибута.

**Примеры**:

```python
driver.current_url
```

#### `scroll`

```python
def scroll(self, scrolls: int = 1, frame_size: int = 600, direction: str = 'both', delay: float = .3) -> bool:
    """
    Прокручивает страницу в указанном направлении.

    Args:
        scrolls: Количество прокруток, по умолчанию 1.
        frame_size: Размер прокрутки в пикселях, по умолчанию 600.
        direction: Направление ('both', 'down', 'up'), по умолчанию 'both'.
        delay: Задержка между прокрутками, по умолчанию 0.3.

    Returns:
        True, если успешно, иначе False.

    Example:
        >>> driver.scroll(scrolls=3, direction='down')
    """
    ...
```

**Как работает функция**:
Функция прокручивает страницу в указанном направлении. Она принимает количество прокруток, размер прокрутки в пикселях, направление прокрутки и задержку между прокрутками. Функция использует JavaScript для прокрутки страницы.

**Параметры**:

*   `scrolls`: Количество прокруток, по умолчанию 1.
*   `frame_size`: Размер прокрутки в пикселях, по умолчанию 600.
*   `direction`: Направление ('both', 'down', 'up'), по умолчанию 'both'.
*   `delay`: Задержка между прокрутками, по умолчанию 0.3.

**Возвращает**:

*   `True`, если успешно, иначе `False`.

**Примеры**:

```python
driver.scroll(scrolls=3, direction='down')
```

#### `locale`

```python
@property
def locale(self) -> Optional[str]:
    """
    Определяет язык страницы на основе мета-тегов или JavaScript.

    Returns:
        Код языка, если найден, иначе None.

    Example:
        >>> lang = driver.locale
        >>> print(lang)  # 'en' или None
    """
    ...
```

**Как работает функция**:
Функция определяет язык страницы на основе мета-тегов или JavaScript. Она пытается найти мета-тег с атрибутом `http-equiv="Content-Language"` и возвращает значение атрибута `content`. Если мета-тег не найден, функция пытается получить язык страницы с помощью JavaScript.

**Возвращает**:

*   Код языка, если найден, иначе `None`.

**Примеры**:

```python
lang = driver.locale
print(lang)  # 'en' или None
```

#### `get_url`

```python
def get_url(self, url: str) -> bool:
    """
    Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.

    Args:
        url: URL для перехода.

    Returns:
        `True`, если переход успешен и текущий URL совпадает с ожидаемым, `False` в противном случае.

    Raises:
        WebDriverException: Если возникает ошибка с WebDriver.
        InvalidArgumentException: Если URL некорректен.
        Exception: Для любых других ошибок при переходе.
    """
    ...
```

**Как работает функция**:
Функция переходит по указанному URL. Она сохраняет текущий URL в переменную `_previous_url`, переходит по URL с помощью метода `self.driver.get(url)`, ожидает завершения загрузки страницы и сохраняет куки. Если текущий URL отличается от предыдущего, функция сохраняет предыдущий URL в атрибуте `self.previous_url`.

**Параметры**:

*   `url`: URL для перехода.

**Возвращает**:

*   `True`, если переход успешен и текущий URL совпадает с ожидаемым, `False` в противном случае.

**Вызывает исключения**:

*   `WebDriverException`: Если возникает ошибка с WebDriver.
*   `InvalidArgumentException`: Если URL некорректен.
*   `Exception`: Для любых других ошибок при переходе.

#### `window_open`

```python
def window_open(self, url: Optional[str] = None) -> None:
    """Open a new tab in the current browser window and switch to it.

    Args:
        url: URL to open in the new tab. Defaults to `None`.
    """
    ...
```

**Как работает функция**:
Функция открывает новую вкладку в текущем окне браузера и переключается на нее. Если указан URL, функция переходит по этому URL в новой вкладке.

**Параметры**:

*   `url`: URL для открытия в новой вкладке. По умолчанию `None`.

#### `wait`

```python
def wait(self, delay: float = .3) -> None:
    """
    Ожидает указанное количество времени.

    Args:
        delay: Время задержки в секундах. По умолчанию 0.3.

    Returns:
        None
    """
    ...
```

**Как работает функция**:
Функция ожидает указанное количество времени, используя функцию `time.sleep(delay)`.

**Параметры**:

*   `delay`: Время задержки в секундах. По умолчанию 0.3.

#### `_save_cookies_localy`

```python
def _save_cookies_localy(self) -> None:
    """
    Сохраняет текущие куки веб-драйвера в локальный файл.

    Returns:
        None

    Raises:
        Exception: Если возникает ошибка при сохранении куки.
    """
    ...
```

**Как работает функция**:
Функция сохраняет текущие куки веб-драйвера в локальный файл, используя модуль `pickle`.

**Вызывает исключения**:

*   `Exception`: Если возникает ошибка при сохранении куки.

#### `fetch_html`

```python
def fetch_html(self, url: str) -> Optional[bool]:
    """
    Извлекает HTML-контент из файла или веб-страницы.

    Args:
        url: Путь к файлу или URL для извлечения HTML-контента.

    Returns:
        Возвращает `True`, если контент успешно получен, иначе `None`.

    Raises:
        Exception: Если возникает ошибка при извлечении контента.
    """
    ...
```

**Как работает функция**:
Функция извлекает HTML-контент из файла или веб-страницы. Если URL начинается с `file://`, функция пытается прочитать контент из локального файла. Если URL начинается с `http://` или `https://`, функция пытается получить контент с веб-страницы, используя метод `self.get_url(url)`.

**Параметры**:

*   `url`: Путь к файлу или URL для извлечения HTML-контента.

**Возвращает**:

*   Возвращает `True`, если контент успешно получен, иначе `None`.

**Вызывает исключения**:

*   `Exception`: Если возникает ошибка при извлечении контента.
# Анализ кода модуля e_11.md

**Качество кода**
8
-  Плюсы
    - Код хорошо структурирован и разбит на логические блоки.
    - Присутствует подробное описание решения задачи, алгоритма и его реализации.
    - Использованы информативные имена переменных и функций.
    - Присутствует блок-схема в формате mermaid, что облегчает понимание алгоритма.
    - Код прокомментирован, что упрощает его понимание.
-  Минусы
    - Отсутствуют docstring для функций, что затрудняет понимание их назначения и параметров.
    - Нет обработки возможных ошибок, что может привести к непредсказуемому поведению программы.
    - Не используются константы для магических чисел, таких как 4 (количество смежных чисел).
    - Код не использует `j_loads` или `j_loads_ns` для чтения данных, а данные заданы напрямую в коде.
    - Не используется логирование ошибок и отладочная печать.

**Рекомендации по улучшению**
1.  Добавить docstring к функциям `calculate_product` и `find_max_product` в формате RST.
2.  Использовать константу для значения 4 (количество смежных чисел).
3.  Импортировать и использовать `logger` для логирования ошибок.
4.  Изменить блок кода так, чтобы он соответствовал требованиям по оформлению.
5.  Переписать комментарии к коду в формате reStructuredText.
6.  Удалить лишние комментарии.

**Оптимизированный код**
```python
"""
Модуль для решения задачи Project Euler #11.
=========================================================================================

Нахождение наибольшего произведения четырех смежных чисел в сетке.
Этот модуль содержит функции для вычисления произведения смежных чисел и поиска
максимального произведения в заданной сетке.

Пример использования
--------------------

.. code-block:: python

    grid = [
        [8, 2, 22, 97, 38, 15, 0, 40, 0, 75, 4, 5, 7, 78, 52, 12, 50, 17, 12, 94],
        [13, 49, 49, 58, 40, 7, 8, 16, 96, 30, 36, 68, 42, 57, 6, 39, 70, 83, 51, 54],
        [24, 75, 37, 29, 33, 90, 69, 94, 4, 71, 23, 67, 10, 4, 39, 21, 50, 31, 95, 96],
        [49, 18, 77, 20, 91, 60, 8, 60, 68, 97, 26, 67, 56, 40, 49, 61, 78, 14, 98, 92],
        [31, 49, 31, 73, 56, 71, 44, 65, 25, 43, 91, 52, 97, 51, 14, 70, 11, 33, 28, 77],
        [94, 45, 95, 26, 12, 39, 49, 16, 8, 88, 96, 10, 71, 61, 28, 89, 92, 71, 16, 85],
        [16, 98, 59, 53, 40, 28, 25, 51, 96, 12, 53, 95, 14, 39, 69, 61, 92, 14, 71, 87],
        [43, 67, 15, 43, 82, 59, 48, 57, 24, 6, 37, 99, 71, 62, 76, 95, 83, 30, 25, 78],
        [14, 39, 67, 53, 53, 49, 55, 96, 57, 17, 28, 39, 72, 83, 17, 88, 79, 98, 76, 56],
        [4, 98, 90, 80, 90, 49, 91, 72, 85, 16, 70, 47, 12, 19, 19, 68, 3, 60, 40, 54],
        [30, 14, 64, 31, 27, 49, 11, 98, 20, 87, 29, 99, 95, 8, 52, 32, 43, 69, 72, 26],
        [16, 98, 53, 42, 67, 14, 92, 19, 46, 91, 16, 92, 51, 31, 9, 53, 10, 61, 16, 59],
        [54, 70, 34, 96, 56, 16, 45, 64, 81, 92, 39, 97, 86, 29, 17, 71, 58, 51, 71, 77],
        [60, 20, 78, 46, 97, 69, 40, 65, 31, 48, 95, 40, 56, 79, 45, 41, 81, 77, 35, 99],
        [70, 81, 85, 54, 27, 98, 88, 36, 77, 87, 15, 77, 78, 48, 98, 25, 39, 65, 3, 18],
        [67, 16, 36, 51, 0, 88, 80, 95, 18, 35, 59, 78, 41, 47, 85, 36, 10, 92, 98, 72],
        [93, 37, 15, 0, 60, 94, 17, 20, 78, 93, 67, 8, 87, 57, 48, 26, 2, 98, 86, 27],
        [69, 75, 34, 96, 67, 87, 63, 64, 87, 17, 6, 98, 99, 76, 31, 27, 97, 92, 29, 51],
        [85, 88, 60, 64, 52, 81, 97, 96, 44, 85, 60, 98, 88, 15, 77, 40, 99, 84, 59, 75],
        [12, 49, 77, 29, 60, 78, 87, 76, 65, 84, 76, 83, 81, 89, 98, 83, 79, 99, 76, 7],
    ]
    result = find_max_product(grid)
    print(result)
"""
from src.logger.logger import logger # Импортируем логер для отслеживания ошибок

ADJACENT_NUMBERS = 4 # Константа для количества смежных чисел

def calculate_product(grid: list[list[int]], row: int, col: int, direction: tuple[int, int]) -> int:
    """
    Вычисляет произведение `ADJACENT_NUMBERS` смежных чисел в заданном направлении.

    :param grid: Двумерный список (сетка) чисел.
    :param row: Индекс строки начальной позиции.
    :param col: Индекс столбца начальной позиции.
    :param direction: Кортеж, представляющий направление (смещение по строке, смещение по столбцу).
    :return: Произведение `ADJACENT_NUMBERS` смежных чисел или 0, если выходит за границы сетки.
    """
    row_delta, col_delta = direction # Код получает смещение по строке и столбцу из направления
    product = 1 # Инициализируется произведение единицей
    for i in range(ADJACENT_NUMBERS): # Код выполняет цикл по количеству смежных чисел
        current_row = row + i * row_delta # Код вычисляет текущую строку
        current_col = col + i * col_delta # Код вычисляет текущий столбец
        if 0 <= current_row < len(grid) and 0 <= current_col < len(grid[0]): # Проверка, что текущие координаты находятся в пределах сетки
           product *= grid[current_row][current_col] # Код умножает произведение на значение текущей ячейки
        else:
           return 0 # Код возвращает 0 если координаты вышли за пределы сетки
    return product # Код возвращает вычисленное произведение


def find_max_product(grid: list[list[int]]) -> int:
    """
    Находит наибольшее произведение `ADJACENT_NUMBERS` смежных чисел в сетке.

    :param grid: Двумерный список (сетка) чисел.
    :return: Максимальное произведение `ADJACENT_NUMBERS` смежных чисел.
    """
    max_product = 0 # Инициализация максимального произведения
    directions = [ # Список всех возможных направлений
        (0, 1),  # вправо
        (1, 0),  # вниз
        (1, 1),  # диагональ вниз-вправо
        (1, -1), # диагональ вниз-влево
        (0, -1),  # влево
        (-1, 0),  # вверх
        (-1, -1),  # диагональ вверх-влево
        (-1, 1),  # диагональ вверх-вправо
    ]

    for row in range(len(grid)): # Цикл по всем строкам
        for col in range(len(grid[0])): # Цикл по всем столбцам
            for direction in directions: # Цикл по всем направлениям
                try:
                    current_product = calculate_product(grid, row, col, direction) # Код вычисляет произведение для текущего направления
                    max_product = max(max_product, current_product) # Код обновляет максимальное произведение если текущее больше
                except Exception as ex:
                    logger.error(f'Произошла ошибка при вычислении произведения в позиции {row=}, {col=}, {direction=}: {ex}') # Логирование ошибки
                    ...
    return max_product # Код возвращает максимальное произведение


grid = [
    [8, 2, 22, 97, 38, 15, 0, 40, 0, 75, 4, 5, 7, 78, 52, 12, 50, 17, 12, 94],
    [13, 49, 49, 58, 40, 7, 8, 16, 96, 30, 36, 68, 42, 57, 6, 39, 70, 83, 51, 54],
    [24, 75, 37, 29, 33, 90, 69, 94, 4, 71, 23, 67, 10, 4, 39, 21, 50, 31, 95, 96],
    [49, 18, 77, 20, 91, 60, 8, 60, 68, 97, 26, 67, 56, 40, 49, 61, 78, 14, 98, 92],
    [31, 49, 31, 73, 56, 71, 44, 65, 25, 43, 91, 52, 97, 51, 14, 70, 11, 33, 28, 77],
    [94, 45, 95, 26, 12, 39, 49, 16, 8, 88, 96, 10, 71, 61, 28, 89, 92, 71, 16, 85],
    [16, 98, 59, 53, 40, 28, 25, 51, 96, 12, 53, 95, 14, 39, 69, 61, 92, 14, 71, 87],
    [43, 67, 15, 43, 82, 59, 48, 57, 24, 6, 37, 99, 71, 62, 76, 95, 83, 30, 25, 78],
    [14, 39, 67, 53, 53, 49, 55, 96, 57, 17, 28, 39, 72, 83, 17, 88, 79, 98, 76, 56],
    [4, 98, 90, 80, 90, 49, 91, 72, 85, 16, 70, 47, 12, 19, 19, 68, 3, 60, 40, 54],
    [30, 14, 64, 31, 27, 49, 11, 98, 20, 87, 29, 99, 95, 8, 52, 32, 43, 69, 72, 26],
    [16, 98, 53, 42, 67, 14, 92, 19, 46, 91, 16, 92, 51, 31, 9, 53, 10, 61, 16, 59],
    [54, 70, 34, 96, 56, 16, 45, 64, 81, 92, 39, 97, 86, 29, 17, 71, 58, 51, 71, 77],
    [60, 20, 78, 46, 97, 69, 40, 65, 31, 48, 95, 40, 56, 79, 45, 41, 81, 77, 35, 99],
    [70, 81, 85, 54, 27, 98, 88, 36, 77, 87, 15, 77, 78, 48, 98, 25, 39, 65, 3, 18],
    [67, 16, 36, 51, 0, 88, 80, 95, 18, 35, 59, 78, 41, 47, 85, 36, 10, 92, 98, 72],
    [93, 37, 15, 0, 60, 94, 17, 20, 78, 93, 67, 8, 87, 57, 48, 26, 2, 98, 86, 27],
    [69, 75, 34, 96, 67, 87, 63, 64, 87, 17, 6, 98, 99, 76, 31, 27, 97, 92, 29, 51],
    [85, 88, 60, 64, 52, 81, 97, 96, 44, 85, 60, 98, 88, 15, 77, 40, 99, 84, 59, 75],
    [12, 49, 77, 29, 60, 78, 87, 76, 65, 84, 76, 83, 81, 89, 98, 83, 79, 99, 76, 7],
]
result = find_max_product(grid) # Код вызывает функцию поиска максимального произведения
print(result) # Код выводит максимальное произведение
```
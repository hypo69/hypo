# Документация для Telegram-бота Digital Market Hook

## Обзор

Этот документ предоставляет подробное описание проекта `Digital Market Hook` — учебного Telegram-бота для цифрового интернет-магазина, разработанного с использованием современных Python-технологий. Бот интегрирован с тремя платежными системами: ЮКасса, Telegram-Stars и Robocassa. В проекте реализованы админ-панель, профиль пользователя и каталог товаров с разделением на категории.

## Подробнее

`Digital Market Hook` демонстрирует технологию веб-хуков для обеспечения высокой производительности. Веб-хуки реализованы через `aiohttp` и используются для запуска бота и обработки платежей через Robocassa.

**Ключевые особенности**:

-   Использование веб-хуков для повышения производительности.
-   Поддержка трех платежных систем: ЮКасса, Telegram-Stars и Robocassa.
-   Интеграция Robocassa напрямую через веб-хуки, минуя BotFather.
-   Наличие админ-панели, профиля пользователя и каталога товаров.

## Технологии

В проекте используются следующие основные технологии:

-   **aiogram** 3.15.0: Асинхронный фреймворк для разработки Telegram-ботов.
-   **aiosqlite** 0.20.0: Асинхронный драйвер для работы с SQLite.
-   **loguru** 0.7.2: Библиотека для продвинутого логирования.
-   **pydantic-settings** 2.7.0: Управление настройками с использованием Pydantic.
-   **SQLAlchemy** 2.0.35: SQL-библиотека и ORM для Python.
-   **pydantic** >=2.4.1,<2.10: Библиотека для валидации данных и управления настройками.
-   **alembic** 1.14.0: Инструмент для управления миграциями базы данных.
-   **aiohttp** 3.10.11: Веб-сервер для обслуживания веб-хуков в боте.

## Установка

### Подготовка к установке

1.  **Клонирование репозитория**:
    ```bash
    git clone https://github.com/Yakvenalex/DigitalMarketHookBot.git
    ```

2.  **Переход в директорию проекта**:
    ```bash
    cd DigitalMarketHookBot
    ```

3.  **Создание и активация виртуального окружения**:
    ```bash
    python -m venv venv
    source venv/bin/activate  # Для Windows: venv\\Scripts\\activate
    ```

4.  **Получение токенов**:
    -   Получите токен бота через [@BotFather](https://t.me/BotFather).
    -   Получите платежный токен ЮКассы через [@BotFather](https://t.me/BotFather) (подходит тестовый).
    -   Зарегистрируйтесь в ЮКассе и Робокассе, создайте магазины для обработки платежей.

### Установка зависимостей

1.  **Установка необходимых пакетов**:
    ```bash
    pip install -r requirements.txt
    ```

### Настройка переменных окружения

1.  **Создание файла `.env`**:
    Создайте файл `.env` в корне проекта и заполните его следующими переменными:
    ```
    BOT_TOKEN=ВАШ_ТОКЕН
    ADMIN_IDS=[ADMIN_TG1, ADMIN_TG2, ADMIN_TG3]
    PROVIDER_TOKEN=ТОКЕН_Ю_КАССЫ
    SITE_URL=ВЕБ_САЙТ_ДЛЯ_ХУКОВ
    SITE_HOST=0.0.0.0
    SITE_PORT=8000
    MRH_LOGIN=ЛОГИН_С_РОБОКАССЫ
    MRH_PASS_1=ПАРОЛЬ_1_С_РОБОКАССЫ
    MRH_PASS_2=ПАРОЛЬ_2_С_РОБОКАССЫ
    IN_TEST=1/0
    ```
    -   `BOT_TOKEN`: Токен вашего Telegram-бота, полученный от BotFather.
    -   `ADMIN_IDS`: Список ID администраторов Telegram, разделённых запятыми.
    -   `PROVIDER_TOKEN`: Токен, предоставленный ЮKassa для проведения платежей.
    -   `SITE_URL`: URL вашего веб-сайта, используемый для веб-хуков.
    -   `SITE_HOST`: Хост для запуска веб-сервера (обычно `0.0.0.0`).
    -   `SITE_PORT`: Порт для запуска веб-сервера (например, `8000`).
    -   `MRH_LOGIN`: Логин от Robocassa.
    -   `MRH_PASS_1`: Первый пароль от Robocassa.
    -   `MRH_PASS_2`: Второй пароль от Robocassa.
    -   `IN_TEST`: Укажите `1` для работы с тестовым режимом Robocassa, `0` — для боевого режима.

### Настройка веб-хуков

1.  **Использование Ngrok**:
    -   Скачайте Ngrok с [официального сайта](https://ngrok.com/download).
    -   Запустите Ngrok, указав локальный порт вашего сервера (например, 8000):
        ```bash
        ngrok http 8000
        ```
    -   Ngrok предоставит временный публичный URL, который необходимо указать в качестве значения для `SITE_URL` в файле `.env`.

### Запуск бота

1.  **Запуск бота**:
    ```bash
    python -m bot.main
    ```

## Использование

После запуска бота, взаимодействие происходит через Telegram. Предоставляется функциональность цифрового интернет-магазина с возможностью тестовой оплаты через ЮKassa, Робокасса и Telegram Stars. При оплате Telegram Stars реализован автоматический возврат звезд сразу после оплаты.

### Тестовые данные для оплаты

-   **Карта**: 1111 1111 1111 1026
-   **Годен до**: 12/26
-   **CVC-код**: 000

## Дополнительные ресурсы

-   **Автор**: Алексей Яковенко [Telegram](https://t.me/yakvenalexx)
-   **Лицензия**: MIT

## Демонстрация функционала

### Видео-демонстрации

1.  **Полная демонстрация проекта**:
    [Видео-демонстрация проекта](https://rutube.ru/video/f57c1617bd03368611ee8aeb44ccb2e5/)
2.  **Дополнительные оплаты**:
    [Видео](https://rutube.ru/video/bbf601d7f0dab962ba24cb57df706640/) демонстрирует процесс работы с дополнительными платежами.

### Попробуйте сами

[Работающий бот](https://t.me/DigitalMarketAiogramHookBot) для оценки функционала и тестирования различных функций.

## Дополнительная информация

Для более подробного изучения кода и архитектуры проекта рекомендуется ознакомиться с исходным кодом и комментариями в репозитории.

> **Примечание**: Проект создан в образовательных целях и не предназначен для использования в реальных коммерческих проектах без соответствующей доработки и тестирования.
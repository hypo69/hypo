# Модуль CablyAI для работы с API CablyAI

## Обзор

Модуль `CablyAI.py` предназначен для взаимодействия с API CablyAI. Он наследует функциональность от класса `OpenaiTemplate` и предоставляет методы для аутентификации и создания асинхронных генераторов для обмена сообщениями с моделью CablyAI.

## Подробнее

Этот модуль предоставляет класс `CablyAI`, который определяет URL, API base, требования к аутентификации и поддержку потоковой передачи данных для работы с сервисом CablyAI. Он использует класс `OpenaiTemplate` в качестве базового, что позволяет упростить процесс интеграции и использования API CablyAI.

## Классы

### `CablyAI`

**Описание**: Класс для взаимодействия с API CablyAI.

**Наследует**:
- `OpenaiTemplate`: Предоставляет базовые методы для работы с API, совместимыми с OpenAI.

**Атрибуты**:
- `url` (str): URL для доступа к чату CablyAI.
- `login_url` (str): URL для входа в систему CablyAI.
- `api_base` (str): Базовый URL для API CablyAI.
- `working` (bool): Указывает, работает ли провайдер. Всегда `True`.
- `needs_auth` (bool): Указывает, требуется ли аутенентификация. Всегда `True`.
- `supports_stream` (bool): Указывает, поддерживается ли потоковая передача данных. Всегда `True`.
- `supports_system_message` (bool): Указывает, поддерживаются ли системные сообщения. Всегда `True`.
- `supports_message_history` (bool): Указывает, поддерживается ли история сообщений. Всегда `True`.

**Методы**:
- `create_async_generator()`: Создает асинхронный генератор для обмена сообщениями с моделью CablyAI.

## Функции

### `create_async_generator`

```python
    @classmethod
    def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        api_key: str = None,
        stream: bool = False,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для обмена сообщениями с моделью CablyAI.

        Args:
            model (str): Имя модели для использования.
            messages (Messages): Список сообщений для отправки.
            api_key (str, optional): API-ключ для аутентификации. По умолчанию `None`.
            stream (bool, optional): Указывает, использовать ли потоковую передачу данных. По умолчанию `False`.
            **kwargs: Дополнительные параметры для передачи в базовый класс.

        Returns:
            AsyncResult: Объект асинхронного результата, представляющий генератор.

        Raises:
            ModelNotSupportedError: Если указанная модель не поддерживается.

        Example:
            # Пример создания асинхронного генератора
            >>> CablyAI.create_async_generator(model='gpt-3.5-turbo', messages=[{'role': 'user', 'content': 'Hello'}], api_key='test')
            <generator object ...>
        """
```

**Назначение**: Создает асинхронный генератор для обмена сообщениями с моделью CablyAI.

**Параметры**:
- `cls`: Ссылка на класс.
- `model` (str): Имя модели для использования.
- `messages` (Messages): Список сообщений для отправки.
- `api_key` (str, optional): API-ключ для аутентификации. По умолчанию `None`.
- `stream` (bool, optional): Указывает, использовать ли потоковую передачу данных. По умолчанию `False`.
- `**kwargs`: Дополнительные параметры для передачи в базовый класс.

**Возвращает**:
- `AsyncResult`: Объект асинхронного результата, представляющий генератор.

**Вызывает исключения**:
- `ModelNotSupportedError`: Если указанная модель не поддерживается.

**Как работает функция**:

1. Функция `create_async_generator` создает заголовки HTTP-запроса, необходимые для аутентификации и указания типа контента.
2. Формируются заголовки, включающие `Authorization` с использованием предоставленного `api_key`, `Content-Type`, `Origin`, `Referer` и `User-Agent`.
3. Вызывается метод `create_async_generator` родительского класса `OpenaiTemplate` с передачей всех необходимых параметров, включая модель, сообщения, API-ключ, флаг потоковой передачи и заголовки.
4. Возвращается результат вызова метода родительского класса.

```
Создание HTTP-заголовков
│
├───→  Вызов create_async_generator из OpenaiTemplate с параметрами
│
└───→  Возврат результата
```

**Примеры**:

```python
# Пример создания асинхронного генератора
CablyAI.create_async_generator(model='gpt-3.5-turbo', messages=[{'role': 'user', 'content': 'Hello'}], api_key='ключ_api')
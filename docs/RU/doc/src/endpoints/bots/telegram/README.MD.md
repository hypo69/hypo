# Модуль `src.endpoints.bots.telegram`

## Обзор

Этот модуль содержит реализацию Telegram-бота, который выполняет ряд функций, связанных с обработкой команд, голосовых сообщений и взаимодействием с пользователями в Telegram.

## Содержание

1. [Обзор](#обзор)
2. [Основные функции и команды](#основные-функции-и-команды-бота)
3. [Основные модули и библиотеки](#основные-модули-и-библиотеки)
4. [Классы и методы](#классы-и-методы)
    - [Класс `TelegramBot`](#класс-telegrambot)
        - [`__init__`](#__init__)
        - [`register_handlers`](#register_handlers)
        - [`start`](#start)
        - [`help_command`](#help_command)
        - [`send_pdf`](#send_pdf)
        - [`handle_voice`](#handle_voice)
        - [`transcribe_voice`](#transcribe_voice)
        - [`handle_document`](#handle_document)
        - [`handle_message`](#handle_message)
5. [Главная функция](#главная-функция)

## Основные функции и команды бота

1.  **Инициализация бота:**
    - Бот инициализируется с токеном, который используется для аутентификации бота в Telegram API.

2.  **Команды:**
    -   `/start`: Отправляет приветственное сообщение пользователю.
    -   `/help`: Предоставляет список доступных команд.
    -   `/sendpdf`: Отправляет PDF-файл пользователю.

3.  **Обработка сообщений:**
    -   Бот обрабатывает входящие текстовые сообщения, голосовые сообщения и файлы документов.
    -   Для голосовых сообщений бот транскрибирует аудио (в настоящее время это функция-заглушка).
    -   Для файлов документов бот считывает содержимое текстового документа.

4.  **Обработка голосовых сообщений:**
    -   Бот загружает файл голосового сообщения, сохраняет его локально и пытается транскрибировать его, используя сервис распознавания речи (в настоящее время это функция-заглушка).

5.  **Обработка документов:**
    -   Бот загружает файл документа, сохраняет его локально и считывает содержимое текстового документа.

6.  **Обработка текстовых сообщений:**
    -   Бот просто возвращает текст, полученный от пользователя.

## Основные модули и библиотеки

-   `python-telegram-bot`: Основная библиотека для создания Telegram-ботов.
-   `pathlib`: Для работы с путями к файлам.
-   `tempfile`: Для создания временных файлов.
-   `asyncio`: Для асинхронного выполнения задач.
-   `requests`: Для загрузки файлов.
-   `src.utils.convertors.tts`: Для распознавания речи и преобразования текста в речь.
-   `src.utils.file`: Для чтения текстовых файлов.

## Классы и методы

### Класс `TelegramBot`

**Описание**: Класс, представляющий Telegram-бота.

#### `__init__`

```python
def __init__(self, token: str):
    """
    Args:
        token (str): Токен для аутентификации бота в Telegram API.
    """
```

**Описание**: Инициализирует бота с токеном и регистрирует обработчики.

**Параметры**:

-   `token` (str): Токен для аутентификации бота в Telegram API.

#### `register_handlers`

```python
def register_handlers(self):
    """
    Args:
       None

    Returns:
       None
    """
```

**Описание**: Регистрирует обработчики команд и сообщений.

**Параметры**:

-   Нет

**Возвращает**:

-   Нет

#### `start`

```python
def start(self, update: Update, context: CallbackContext):
    """
    Args:
        update (Update): Объект, представляющий входящее обновление от Telegram.
        context (CallbackContext): Контекст обратного вызова.

    Returns:
        None
    """
```

**Описание**: Обрабатывает команду `/start`, отправляет приветственное сообщение пользователю.

**Параметры**:

-   `update` (`Update`): Объект, представляющий входящее обновление от Telegram.
-   `context` (`CallbackContext`): Контекст обратного вызова.

**Возвращает**:

-   Нет

#### `help_command`

```python
def help_command(self, update: Update, context: CallbackContext):
    """
    Args:
        update (Update): Объект, представляющий входящее обновление от Telegram.
        context (CallbackContext): Контекст обратного вызова.

    Returns:
        None
    """
```

**Описание**: Обрабатывает команду `/help`, предоставляет список доступных команд.

**Параметры**:

-   `update` (`Update`): Объект, представляющий входящее обновление от Telegram.
-   `context` (`CallbackContext`): Контекст обратного вызова.

**Возвращает**:

-   Нет

#### `send_pdf`

```python
def send_pdf(self, pdf_file: str | Path):
    """
    Args:
        pdf_file (str | Path): Путь к PDF-файлу, который нужно отправить.

    Returns:
        None

    Raises:
         FileNotFoundError: Если файл не найден по указанному пути.
         TelegramError: Если произошла ошибка при отправке файла через Telegram API.
    """
```

**Описание**: Обрабатывает команду `/sendpdf`, отправляет PDF-файл пользователю.

**Параметры**:

-   `pdf_file` (`str` | `Path`): Путь к PDF-файлу, который нужно отправить.

**Возвращает**:

-   Нет

**Вызывает исключения**:

-   `FileNotFoundError`: Если файл не найден по указанному пути.
-   `TelegramError`: Если произошла ошибка при отправке файла через Telegram API.

#### `handle_voice`

```python
def handle_voice(self, update: Update, context: CallbackContext):
    """
    Args:
        update (Update): Объект, представляющий входящее обновление от Telegram.
        context (CallbackContext): Контекст обратного вызова.

    Returns:
       None
    """
```

**Описание**: Обрабатывает голосовые сообщения, загружает их и пытается транскрибировать.

**Параметры**:

-   `update` (`Update`): Объект, представляющий входящее обновление от Telegram.
-   `context` (`CallbackContext`): Контекст обратного вызова.

**Возвращает**:

-   Нет

#### `transcribe_voice`

```python
def transcribe_voice(self, file_path: Path) -> str:
    """
    Args:
        file_path (Path): Путь к файлу с голосовым сообщением.

    Returns:
        str: Расшифрованный текст из голосового сообщения. В настоящее время это заглушка.
    """
```

**Описание**: Транскрибирует голосовое сообщение (в настоящее время это заглушка).

**Параметры**:

-   `file_path` (`Path`): Путь к файлу с голосовым сообщением.

**Возвращает**:

-   `str`: Расшифрованный текст из голосового сообщения. В настоящее время это заглушка.

#### `handle_document`

```python
def handle_document(self, update: Update, context: CallbackContext) -> str:
    """
    Args:
        update (Update): Объект, представляющий входящее обновление от Telegram.
        context (CallbackContext): Контекст обратного вызова.

    Returns:
        str: Содержимое текстового документа.

    Raises:
        Exception: Если произошла ошибка при чтении файла.
    """
```

**Описание**: Обрабатывает файлы документов, загружает их и считывает содержимое текстового документа.

**Параметры**:

-   `update` (`Update`): Объект, представляющий входящее обновление от Telegram.
-   `context` (`CallbackContext`): Контекст обратного вызова.

**Возвращает**:

-  `str`: Содержимое текстового документа.

**Вызывает исключения**:

-  `Exception`: Если произошла ошибка при чтении файла.

#### `handle_message`

```python
def handle_message(self, update: Update, context: CallbackContext) -> str:
    """
     Args:
         update (Update): Объект, представляющий входящее обновление от Telegram.
         context (CallbackContext): Контекст обратного вызова.

     Returns:
        str: Текст полученного сообщения от пользователя.
    """
```

**Описание**: Обрабатывает текстовые сообщения и возвращает полученный текст.

**Параметры**:

-   `update` (`Update`): Объект, представляющий входящее обновление от Telegram.
-   `context` (`CallbackContext`): Контекст обратного вызова.

**Возвращает**:

-   `str`: Текст полученного сообщения от пользователя.

## Главная функция

**Описание**: Инициализирует бота, регистрирует обработчики команд и сообщений, и запускает бота, используя `run_polling()`.
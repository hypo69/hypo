# Модуль `background.js`

## Обзор

Файл `background.js` служит фоновой частью расширения для браузера Chrome. Он обрабатывает события клика на значок расширения и отвечает на сообщения от других частей расширения, таких как скрипты контента.  Основная функция - сбор данных с текущей страницы и отправка их на сервер.

## Функции

### `chrome.browserAction.onClicked.addListener`

**Описание**: Функция устанавливает обработчик для событий клика на значок расширения. При клике на значок запускается функция `chrome.tabs.sendMessage`, которая отправляет сообщение в текущую вкладку с запросом на сбор данных.

**Параметры**:
- `tab` (object): Объект, содержащий информацию о вкладке, на которой был нажат значок.

**Возвращает**:
- Ничего не возвращает.

### `sendDataToServer`

**Описание**: Функция отправляет собранные данные на сервер.

**Параметры**:
- `url` (string): URL текущей страницы, с которой необходимо собрать данные.

**Возвращает**:
- Ничего не возвращает.

**Вызывает исключения**:
- `Error`: Если произошла ошибка при отправке данных на сервер (например, сервер недоступен или неправильный запрос).  Выводит сообщение об ошибке в консоль.

### `chrome.runtime.onMessage.addListener`

**Описание**: Функция устанавливает обработчик для сообщений, отправленных другими частями расширения. При получении сообщения с действием `collectData` вызывает функцию `sendDataToServer`, передавая URL.

**Параметры**:
- `message` (object): Объект, содержащий полученное сообщение.
- `sender` (object): Информация об отправителе сообщения.
- `sendResponse` (function): Функция для отправки ответа отправителю (в данном случае не используется).

**Возвращает**:
- `true`:  Обязательное возвращаемое значение для `chrome.runtime.onMessage.addListener`. Удерживает открытый канал связи до ответа.

##  Хранилище (chrome.storage.local)

Функция `sendDataToServer` использует `chrome.storage.local.get()` для получения данных из локального хранилища расширения. Это предполагает, что данные собраны и сохранены ранее.  Отсутствие данных (`collectedData`) вызывает соответствующее сообщение об ошибке в консоли.

##  `fetch`

Функция `sendDataToServer` использует `fetch` для отправки данных на сервер.  В случае успешной отправки (`response.ok`) записывается сообщение в консоль.  В случае ошибки, выводится сообщение об ошибке в консоль.


##  Замечания


- Адрес сервера (`serverUrl`) следует заменить на действительный адрес вашего сервера.
-  Код предполагает, что данные уже собраны и сохранены в хранилище (`chrome.storage.local`) под ключом `collectedData`. Необходимо дополнить код сбором данных с конкретной страницы.
-  Обработка ошибок  `fetch`  очень важна для надежности расширения.


## Оглавление

- [Обзор](#обзор)
- [Функции](#функции)
  - [`chrome.browserAction.onClicked.addListener`](#chrome-browseraction-onclicked-addlistener)
  - [`sendDataToServer`](#senddatatoserver)
  - [`chrome.runtime.onMessage.addListener`](#chrome-runtime-onmessage-addlistener)
- [Хранилище (chrome.storage.local)](#хранилище-chromestorage-local)
- [fetch](#fetch)
- [Замечания](#замечания)
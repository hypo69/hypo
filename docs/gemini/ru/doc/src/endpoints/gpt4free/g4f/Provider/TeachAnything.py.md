# Модуль TeachAnything

## Обзор

Модуль `TeachAnything` предоставляет асинхронный генератор для взаимодействия с API `teach-anything.com`. Он позволяет отправлять запросы к API и получать ответы в виде потока чанков, что полезно для обработки больших объемов данных. Модуль поддерживает выбор модели и передачу прокси для выполнения запросов.

## Подробней

Этот модуль является провайдером для проекта `hypotez`, обеспечивающим взаимодействие с API `teach-anything.com`. Он использует асинхронные запросы через библиотеку `aiohttp` для получения данных. Основное назначение модуля - предоставить удобный интерфейс для отправки запросов к API и обработки потоковых ответов.

## Классы

### `TeachAnything`

**Описание**: Класс `TeachAnything` является асинхронным генератором провайдера и миксином для моделей. Он отвечает за отправку запросов к API `teach-anything.com` и обработку ответов.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями.

**Атрибуты**:
- `url` (str): URL сайта `teach-anything.com`.
- `api_endpoint` (str): Конечная точка API для генерации запросов.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `default_model` (str): Модель, используемая по умолчанию (`'gemini-1.5-pro'`).
- `models` (List[str]): Список поддерживаемых моделей (`[default_model, 'gemini-1.5-flash']`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API.
- `_get_headers`: Возвращает словарь с заголовками HTTP-запроса.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str | None = None,
    **kwargs: Any
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения ответов от API.

    Args:
        model (str): Модель для использования в запросе.
        messages (Messages): Сообщения для отправки в запросе.
        proxy (str | None, optional): Прокси-сервер для использования. По умолчанию `None`.
        **kwargs (Any): Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий чанки данных.

    Как работает функция:
    1. Функция получает заголовки запроса, используя `cls._get_headers()`.
    2. Выбирает модель, используя `cls.get_model(model)`.
    3. Форматирует сообщения, используя `format_prompt(messages)`.
    4. Отправляет асинхронный POST-запрос к API `teach-anything.com` с использованием `aiohttp.ClientSession`.
    5. Получает ответ в виде потока чанков.
    6. Декодирует каждый чанк и возвращает его через генератор.
    7. Обрабатывает ошибки декодирования, накапливая данные в буфере до тех пор, пока не получится корректно декодировать.

    Внутренние функции:
    - Отсутствуют

    """
    ...
```

**Назначение**: Создает асинхронный генератор для взаимодействия с API `teach-anything.com` и получения потоковых ответов.

**Параметры**:
- `model` (str): Модель для использования в запросе.
- `messages` (Messages): Сообщения для отправки в запросе.
- `proxy` (str | None, optional): Прокси-сервер для использования. По умолчанию `None`.
- `**kwargs` (Any): Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий чанки данных.

**Вызывает исключения**:
- `aiohttp.ClientError`: При ошибках во время выполнения HTTP-запроса.

**Как работает функция**:

```
    Начало
    │
    headers = cls._get_headers()
    │
    model = cls.get_model(model)
    │
    prompt = format_prompt(messages)
    │
    Отправка POST-запроса к API
    │
    Получение ответа в виде потока чанков
    │
    Декодирование и выдача чанков через генератор
    │
    Обработка ошибок декодирования
    │
    Конец
```

**Примеры**:

```python
# Пример использования create_async_generator
async def example():
    messages = [{"role": "user", "content": "Hello, world!"}]
    async for chunk in TeachAnything.create_async_generator(model='gemini-1.5-pro', messages=messages):
        print(chunk, end="")

import asyncio
asyncio.run(example())
```

### `_get_headers`

```python
@staticmethod
def _get_headers() -> Dict[str, str]:
    """
    Возвращает словарь с заголовками HTTP-запроса.

    Returns:
        Dict[str, str]: Словарь с заголовками.

    Как работает функция:
    1. Функция определяет статический словарь с необходимыми HTTP-заголовками.
    2. Возвращает этот словарь.

    Внутренние функции:
    - Отсутствуют

    """
    ...
```

**Назначение**: Возвращает словарь с HTTP-заголовками, необходимыми для запросов к API `teach-anything.com`.

**Параметры**:
- Отсутствуют

**Возвращает**:
- `Dict[str, str]`: Словарь с заголовками.

**Вызывает исключения**:
- Отсутствуют

**Как работает функция**:

```
    Начало
    │
    Определение словаря с HTTP-заголовками
    │
    Возврат словаря
    │
    Конец
```

**Примеры**:

```python
# Пример использования _get_headers
headers = TeachAnything._get_headers()
print(headers)
```
# Анализ кода модуля `CIVILW`

**Качество кода**

-   **Соответствие требованиям к формату кода (1-10):**
    -   **Преимущества:**
        -   Описание игры, правил, алгоритма и блок-схемы представлены в формате markdown.
        -   Алгоритм игры четко и понятно описан.
        -   Блок-схема в mermaid-формате наглядно демонстрирует логику игры.
        -   Присутствует легенда для блок-схемы, что облегчает ее понимание.
        -   Описание каждого блока в легенде подробное и информативное.
    -   **Недостатки:**
        -   Отсутствует реализация кода игры на языке программирования.
        -   Использование markdown для описания алгоритма и блок-схемы, а не reStructuredText.
        -   Нет примеров использования или кода.

**Рекомендации по улучшению**

1.  **Реализация игры:** Необходимо реализовать код игры на Python, используя описанный алгоритм.
2.  **Формат документации:** Перевести описание и блок-схему в формат reStructuredText (RST) для соответствия требованиям.
3.  **Документация:** Добавить docstring для всех функций, методов и классов при их реализации.
4.  **Обработка ошибок:** Реализовать обработку ошибок с использованием `logger.error` в случае возникновения проблем.
5.  **Импорты:** Добавить необходимые импорты для работы с `j_loads` и `j_loads_ns` (если это необходимо), а также для `logger`.
6.  **Примеры:** Добавить примеры использования и возможные улучшения в формате `TODO`.

**Улучшенный код**

```python
"""
Модуль для симуляции игры "Гражданская война".
=========================================================================================

Модуль содержит функции для симуляции сражения между армиями Конфедерации и Союза.

Пример использования
--------------------

Пример запуска игры:

.. code-block:: python

   play_civil_war()

"""
import random
from src.logger.logger import logger #  Импортируем logger для обработки ошибок.

def calculate_losses(attack_force: int, attack_type: int) -> tuple[int, int]:
    """
    Вычисляет потери для обеих сторон в результате атаки.

    :param attack_force: Количество солдат, участвующих в атаке.
    :param attack_type: Тип атаки (1 - прямая, 2 - обходная).
    :return: Кортеж из потерь Конфедерации и Союза.
    """
    confederate_losses = int(attack_force * random.uniform(0, 0.4 if attack_type == 1 else 0.2)) #  Рассчитываем потери Конфедерации в зависимости от типа атаки.
    if confederate_losses > attack_force: #  Проверяем, не превышают ли потери количество атакующих.
        confederate_losses = attack_force #  Если превышают, устанавливаем потери равными количеству атакующих.

    union_losses = int(attack_force * random.uniform(0, 0.3)) #  Рассчитываем потери Союза.
    if attack_type == 2: #  Увеличиваем потери Союза в случае обходной атаки.
        union_losses += random.randint(0, 100)
    return confederate_losses, union_losses #  Возвращаем потери обеих сторон.

def play_civil_war():
    """
    Симулирует игру "Гражданская война".
    """
    union_force = 1000 #  Начальная численность армии Союза.
    confederate_force = 800 #  Начальная численность армии Конфедерации.

    while union_force > 0 and confederate_force > 0: #  Начинаем цикл игры пока обе армии имеют солдат.
        try:
            attack_force = int(input("Введите количество солдат для атаки: ")) #  Запрашиваем у игрока количество солдат для атаки.
            if attack_force > confederate_force: #  Проверяем, достаточно ли у Конфедерации сил для атаки.
                print("Недостаточно сил!") #  Если сил недостаточно, выводим сообщение.
                continue #  И переходим к следующей итерации цикла.

            attack_type = int(input("Выберите тип атаки (1 - прямая, 2 - обходная): ")) #  Запрашиваем тип атаки.
            if attack_type not in [1, 2]: #  Проверяем корректность ввода типа атаки.
                print("Некорректный тип атаки. Выберите 1 или 2.") #  Выводим сообщение об ошибке.
                continue #  И переходим к следующей итерации цикла.

            confederate_losses, union_losses = calculate_losses(attack_force, attack_type) #  Вычисляем потери обеих сторон.

            confederate_force -= confederate_losses #  Обновляем численность армии Конфедерации.
            union_force -= union_losses #  Обновляем численность армии Союза.

            print(f"Численность армии Конфедерации: {confederate_force}") #  Выводим текущую численность армии Конфедерации.
            print(f"Численность армии Союза: {union_force}") #  Выводим текущую численность армии Союза.

            if union_force <= 0: #  Проверяем, не победила ли Конфедерация.
                print("Конфедерация победила!") #  Выводим сообщение о победе Конфедерации.
            elif confederate_force <= 0: #  Проверяем, не победил ли Союз.
                print("Союз победил!") #  Выводим сообщение о победе Союза.

        except ValueError as e:
            logger.error(f"Ошибка ввода данных: {e}") #  Логируем ошибку ввода данных.
            print("Некорректный ввод. Пожалуйста, введите число.") #  Выводим сообщение об ошибке.
            continue #  И переходим к следующей итерации цикла.
        except Exception as e: #  Обрабатываем другие возможные ошибки.
            logger.error(f"Непредвиденная ошибка: {e}") #  Логируем ошибку.
            print("Произошла непредвиденная ошибка. Пожалуйста, повторите попытку.") #  Выводим сообщение об ошибке.
            break #  И завершаем игру.
if __name__ == "__main__":
    play_civil_war() #  Запускаем игру.
```
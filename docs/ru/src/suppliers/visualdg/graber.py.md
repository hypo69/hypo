# Модуль `src.suppliers.visualdg.graber`

## Обзор

Модуль `src.suppliers.visualdg.graber` предназначен для сбора информации о товарах с веб-сайта `visualdg.co.il`. Он расширяет функциональность базового класса `Graber`, предоставляя возможность переопределять методы обработки отдельных полей товара для нестандартных случаев. Модуль также поддерживает предварительные действия перед отправкой запросов к веб-драйверу через декораторы, что позволяет, например, закрывать всплывающие окна.

## Подробней

Этот модуль является частью системы сбора данных о товарах с различных поставщиков. Он специализируется на сайте `visualdg.co.il`, используя веб-драйвер для навигации по страницам товаров и извлечения необходимой информации. Основное назначение модуля заключается в автоматизации процесса сбора данных, который в противном случае потребовал бы ручного вмешательства. Использование декораторов позволяет выполнять предварительные действия, такие как закрытие всплывающих окон, что повышает стабильность и надежность процесса сбора данных.

## Классы

### `Graber`

**Описание**: Класс `Graber` наследуется от базового класса `Graber` (`Grbr`) и предназначен для реализации логики сбора данных с сайта `visualdg.co.il`. Он переопределяет некоторые методы родительского класса для адаптации к специфической структуре и особенностям данного сайта.

**Как работает класс**:
1.  **Инициализация**: При создании экземпляра класса `Graber` происходит инициализация префикса поставщика (`supplier_prefix`) и вызов конструктора родительского класса `Graber` (`Grbr`).
2.  **Настройка контекста**: Устанавливается значение `Context.locator_for_decorator` в `None`. Если установить значение, то оно будет выполнено в декораторе `@close_pop_up`.

**Методы**:

*   `__init__`: Инициализирует класс `Graber`, устанавливает префикс поставщика и вызывает конструктор родительского класса.

    ```python
    def __init__(self, driver: Driver, lang_index):
        """Инициализация класса сбора полей товара."""
    ```

    **Параметры**:

    *   `driver` (`Driver`): Экземпляр веб-драйвера для управления браузером.
    *   `lang_index` (int): Индекс языка, используемый для локализации контента.

    **Как работает метод**:

    1.  Устанавливает атрибут `supplier_prefix` равным `'visualdg'`.
    2.  Вызывает конструктор родительского класса `Grbr` с указанием префикса поставщика, драйвера и индекса языка.
    3.  Устанавливает `Context.locator_for_decorator` в `None`, чтобы отключить выполнение декоратора `@close_pop_up` по умолчанию.

## Функции

### `close_pop_up`

```python
def close_pop_up(value: Any = None):
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```

**Назначение**: Функция `close_pop_up` создает декоратор, который позволяет закрывать всплывающие окна на веб-странице перед выполнением основной логики декорируемой функции.

**Параметры**:

*   `value` (`Any`, optional): Дополнительное значение, которое может быть использовано декоратором. По умолчанию `None`.

**Возвращает**:

*   `Callable`: Декоратор, который оборачивает функцию.

**Как работает функция**:

1.  Функция `close_pop_up` определяет внутреннюю функцию `decorator`, которая принимает функцию `func` в качестве аргумента.
2.  Внутри `decorator` определяется асинхронная функция `wrapper`, которая выполняет следующие действия:
    *   Пытается выполнить локатор для закрытия всплывающего окна с использованием `Context.driver.execute_locator(Context.locator.close_pop_up)`.
    *   Обрабатывает исключение `ExecuteLocatorException`, если выполнение локатора не удалось, и логирует ошибку.
    *   Вызывает декорируемую функцию `func` с переданными аргументами и возвращает результат.
3.  Функция `close_pop_up` возвращает декоратор `decorator`.

**Примеры**:

```python
@close_pop_up()
async def my_function():
    """Основная логика функции."""
    ...
```
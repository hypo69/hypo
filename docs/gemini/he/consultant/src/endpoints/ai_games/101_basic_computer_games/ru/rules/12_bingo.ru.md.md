# Анализ кода модуля `12_bingo.ru.md`

**Качество кода**
-  Соответствие требованиям к формату кода: 1-10
 -  Преимущества
     -  Документ структурирован и содержит четкие инструкции для реализации игры "Бинго".
     -  Присутствует подробное описание каждого этапа игры, от инициализации до завершения.
     -  Представлен пример работы программы, который помогает понять игровой процесс.
 -  Недостатки
    -  В документе отсутствует сам программный код на Python.
    -  Нет инструкций по использованию `j_loads` или `j_loads_ns` из `src.utils.jjson`.
    -  Отсутствуют комментарии в стиле RST и использование логгера.
    -  Не определены функции, переменные, классы, которые необходимо будет реализовать.
    -  Не указаны импорты необходимых библиотек.
    -  Нет документации для функций, методов и переменных в формате RST.
    -  Не представлены примеры кода с пояснениями.

**Рекомендации по улучшению**
1. Добавить программный код на Python, реализующий правила игры "Бинго".
2. Использовать `j_loads` или `j_loads_ns` для загрузки данных, если это необходимо.
3. Внедрить обработку ошибок с использованием `logger.error` вместо стандартных `try-except`.
4. Добавить комментарии в стиле RST для всех функций, методов и классов.
5. Убедиться, что импорты всех необходимых библиотек присутствуют.
6. Создать документацию в стиле RST для функций, методов и переменных.
7. Включить примеры кода с подробными пояснениями.
8. Реализовать генерацию случайных карточек Бинго, как описано в инструкции.
9. Продумать логику проверки на выигрышные комбинации (линии, диагонали).
10. Обеспечить корректную обработку ввода пользователя.

**Улучшенный код**
```markdown
### Название игры: **Bingo** (Бинго)

#### Описание
В этой игре игрок и компьютер по очереди играют в Бинго. Компьютер генерирует карточку Бинго для обоих игроков. Затем он вращает барабан и случайным образом выбирает числа, которые выводятся на экране. Игрок должен отметить эти числа на своей карточке, чтобы собрать выигрышные комбинации. Когда кто-то заполнил все числа в одной строке, столбце или диагонали, он выигрывает.

---

### Пошаговая инструкция для реализации

#### 1. **Инициализация игры**
   - **Создание карточек:** Компьютер генерирует для игрока и себя случайные карточки Бинго с размерами 5x5. Каждая карточка содержит случайные числа, распределенные по пяти колонкам (B, I, N, G, O).
     - Столбец **B**: числа от 1 до 15.
     - Столбец **I**: числа от 16 до 30.
     - Столбец **N**: числа от 31 до 45 (с центральной ячейкой, которая считается "свободной").
     - Столбец **G**: числа от 46 до 60.
     - Столбец **O**: числа от 61 до 75.

#### 2. **Основной цикл игры**
   - **Генерация чисел:** Компьютер случайным образом генерирует числа от 1 до 75 и объявляет их поочередно.
   - **Проверка на бинго:** После каждого номера, который выпадает, игрок и компьютер проверяют, есть ли этот номер на их карточке.
     - Если номер есть, игрок или компьютер отмечает его на своей карточке.
   - **Победа:** Игра завершается, когда один из игроков закроет одну из линий на карточке (горизонтальную, вертикальную или диагональ).
   - **Проверка на выигрыш:** Компьютер проверяет, есть ли у игрока или у него самого заполненная линия и объявляет победителя.

#### 3. **Подсчёт победителя**
   - После каждого хода проверяется, есть ли на карточке комбинация чисел, которые соответствуют выигрышной линии. Если игрок или компьютер выигрывает, программа выводит:
     ```
     Поздравляем! Вы выиграли!
     ```
   - Если оба игрока не собрали линию, игра продолжается до тех пор, пока кто-то не выиграет.

#### 4. **Завершение игры**
   - Когда кто-то выигрывает, программа предлагает сыграть ещё раз:
     ```
     Хотите сыграть снова? (да/нет)
     ```

---

### Пример работы программы

1. **Начало игры**:
   ```
   Добро пожаловать в игру Бинго!
   Вот ваша карточка:
   B  I  N  G  O
   10 22 35 50 69
   8  16  FREE 47 60
   5  29  41 55 68
   12 18 33 53 72
   14 23 44 52 74

   Я тоже создал свою карточку. Начинаем!
   ```

2. **Ход игры**:
   ```
   Компьютер вытянул номер: 22
   Выставляем его на своей карточке.
   ```

3. **Проверка на бинго**:
   ```
   Внимание! У вас есть линия на карточке! Вы выиграли!
   ```

4. **Вывод результата**:
   ```
   Поздравляем! Вы выиграли!
   Хотите сыграть снова? (да/нет)
   ```

---

### Возможные ограничения
- Программа должна гарантировать, что карточки генерируются случайным образом.
- Требуется обработка ошибок ввода для случая, если игрок попытается ввести несуществующий номер.

---

```python
"""
Модуль для реализации игры Бинго
=========================================================================================

Модуль содержит функции и классы для генерации карточек Бинго, проверки выигрышей и
управления игровым процессом.

Пример использования
--------------------

Пример использования функций для создания и управления игрой:

.. code-block:: python

    bingo_game = BingoGame()
    bingo_game.start_game()
"""
import random
from src.logger.logger import logger # Добавляем импорт логгера
from typing import List, Dict, Tuple, Any
from src.utils.jjson import j_loads  # Добавляем импорт j_loads


class BingoCard:
    """
    Класс для представления карточки Бинго.

    :param card_data: Список списков (матрица) чисел на карточке.
    :param marked: Список списков (матрица) булевых значений, показывающих, какие ячейки помечены.
    """
    def __init__(self, card_data: List[List[int]]):
         """
        Инициализирует экземпляр карточки Бинго.
        :param card_data: Список списков (матрица) чисел на карточке.
         """
         self.card_data = card_data
         self.marked = [[False for _ in row] for row in card_data]

    def mark_number(self, number: int) -> None:
         """
        Отмечает число на карточке, если оно присутствует.

        :param number: Число, которое нужно отметить.
         """
         for row_index, row in enumerate(self.card_data):
            for col_index, cell in enumerate(row):
                if cell == number:
                   self.marked[row_index][col_index] = True
                   return

    def is_bingo(self) -> bool:
         """
        Проверяет, есть ли на карточке Бинго (заполнена ли строка, столбец или диагональ).

        :return: True, если есть Бинго, иначе False.
         """
         # Проверка строк
         for row in self.marked:
            if all(row):
               return True
            # Проверка столбцов
         for col_index in range(len(self.marked[0])):
            if all(row[col_index] for row in self.marked):
                 return True

         # Проверка главной диагонали
         if all(self.marked[i][i] for i in range(len(self.marked))):
             return True
         # Проверка обратной диагонали
         if all(self.marked[i][len(self.marked) - 1 - i] for i in range(len(self.marked))):
             return True
         return False

    def __str__(self) -> str:
        """
        Возвращает строковое представление карточки Бинго.

        :return: Строковое представление карточки.
        """
        card_str = "  B   I   N   G   O\n"
        for row_index, row in enumerate(self.card_data):
            row_str = ""
            for col_index, cell in enumerate(row):
                if self.marked[row_index][col_index]:
                   row_str += f"[{cell:2d}] "
                else:
                   row_str += f" {cell:2d}  "

            card_str += row_str + "\n"
        return card_str


def generate_bingo_card() -> List[List[int]]:
    """
    Генерирует случайную карточку Бинго 5x5.

    :return: Список списков (матрица) случайных чисел для карточки Бинго.
    """
    card = []
    cols = {
         'B': range(1, 16),
        'I': range(16, 31),
         'N': range(31, 46),
        'G': range(46, 61),
        'O': range(61, 76)
    }
    for col_name, col_range in cols.items():
         col = random.sample(list(col_range), 5) # Создаем 5 случайных чисел из списка
         card.append(col)

    # Транспонируем матрицу и заменяем центральный элемент на "FREE"
    card = [list(row) for row in zip(*card)]
    card[2][2] = 'FREE'
    return card


class BingoGame:
    """
    Класс для управления игровым процессом Бинго.
    """
    def __init__(self):
         """
        Инициализирует игру Бинго, создавая карточки игрока и компьютера.
         """
         self.player_card = BingoCard(generate_bingo_card())
         self.computer_card = BingoCard(generate_bingo_card())
         self.called_numbers = set() # Множество для хранения уже вызванных чисел

    def start_game(self) -> None:
        """
        Запускает игру Бинго, вызывая числа и проверяя на выигрыш.
         """
        print("Добро пожаловать в игру Бинго!")
        print("Вот ваша карточка:")
        print(self.player_card)
        print("Я тоже создал свою карточку. Начинаем!")

        while True:
           number = self.draw_number()
           if number is None:
               print("Все числа были вызваны, игра завершена!")
               break
           print(f"Компьютер вытянул номер: {number}")

           self.player_card.mark_number(number)
           self.computer_card.mark_number(number)
           print("Выставляем его на своей карточке.")
           print(self.player_card)

           if self.player_card.is_bingo():
               print("Внимание! У вас есть линия на карточке! Вы выиграли!")
               print("Поздравляем! Вы выиграли!")
               break

           if self.computer_card.is_bingo():
               print("У компьютера есть линия на карточке! Вы проиграли!")
               break
        if self.play_again():
             self.__init__()
             self.start_game()
        else:
            print('Спасибо за игру!')
            return

    def draw_number(self) -> int | None:
         """
        Вытягивает случайное число из диапазона 1-75, которое еще не было вызвано.

        :return: Случайное число или None, если все числа были вызваны.
         """
         available_numbers = set(range(1, 76)) - self.called_numbers
         if not available_numbers:
            return None # Возвращаем None, если нет доступных чисел
         number = random.choice(list(available_numbers)) # Выбираем случайное число из доступных
         self.called_numbers.add(number) # Добавляем в список использованных
         return number

    def play_again(self) -> bool:
         """
        Спрашивает пользователя, хочет ли он сыграть снова.

        :return: True, если пользователь хочет сыграть снова, иначе False.
        """
         while True:
             choice = input("Хотите сыграть снова? (да/нет): ").lower()
             if choice in ['да', 'yes']:
                 return True
             elif choice in ['нет', 'no']:
                 return False
             else:
                 print("Пожалуйста, введите 'да' или 'нет'.")

if __name__ == '__main__':
     try:
        bingo_game = BingoGame() # Создаем экземпляр игры
        bingo_game.start_game() # Запускаем игру
     except Exception as e:
        logger.error(f'Ошибка при запуске игры: {e}')  # Обрабатываем ошибки через логгер
```
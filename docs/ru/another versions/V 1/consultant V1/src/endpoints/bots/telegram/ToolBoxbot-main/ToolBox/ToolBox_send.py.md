# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –º–æ–¥—É–ª—è `ToolBox_send`

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**:
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º**: 5
- **–ü–ª—é—Å—ã**:
    - –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `python-telegram-bot` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram API.
    - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `.env` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞.
- **–ú–∏–Ω—É—Å—ã**:
    -  –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫, —á—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É.
    -  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `try-except` –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–ª–æ—Ö–æ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π.
    -  –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, —á—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–¥–∞.
    -  –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `j_loads` –∏–ª–∏ `j_loads_ns` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ json –¥–∞–Ω–Ω—ã—Ö.
    -  –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–º —Å—Ç–∏–ª–µ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å—é.
    -  –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤ –≤ –∫–æ–¥–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é**:

1.  **–ò–º–ø–æ—Ä—Ç—ã**:
    -   –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç `logger` –∏–∑ `src.logger`.
    -   –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `sqlite3` –Ω–µ –Ω–∞–ø—Ä—è–º—É—é, –∞ —á–µ—Ä–µ–∑ `src.database`.

2.  **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
    -   –ü—Ä–∏–≤–µ—Å—Ç–∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã –≤ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏.
    -   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `f-strings` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫.
    -   –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–¥ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏ PEP8.

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   -  –ó–∞–º–µ–Ω–∏—Ç—å `print` –Ω–∞ `logger.error` –∏ `logger.info` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
   -  –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ.

4.  **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏**:
   -   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `with` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ `sqlite3.connect()`.

5.  **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   -   –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ RST –¥–ª—è –≤—Å–µ–≥–æ –∫–æ–¥–∞.

6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   -  –ó–∞–º–µ–Ω–∏—Ç—å –æ–±–æ–±—â—ë–Ω–Ω—ã–π `except` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `telebot.apihelper.ApiException` –∏–ª–∏ `sqlite3.Error`).
   -  –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ `print("no")` –∏ `print("yes")` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `logger.error` –∏ `logger.info`.

7.  **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞**:
    -   –†–∞–∑–±–∏—Ç—å –∫–æ–¥ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥**:

```python
"""
–ú–æ–¥—É–ª—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram
========================================================

–ú–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram,
–∏—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite.

"""
import os
import sqlite3
from pathlib import Path

import telebot
from dotenv import load_dotenv

from src.logger import logger  # –ò–∑–º–µ–Ω–µ–Ω–æ: –ò–º–ø–æ—Ä—Ç logger
from src.utils.jjson import j_loads, j_loads_ns # –î–æ–±–∞–≤–ª–µ–Ω–æ: –∏–º–ø–æ—Ä—Ç j_loads, j_loads_ns


load_dotenv()  # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è


def get_telegram_bot() -> telebot.TeleBot:
    """
    –°–æ–∑–¥–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ Telegram.

    :return: –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ Telegram.
    :rtype: telebot.TeleBot
    """
    bot = telebot.TeleBot(token=os.environ['TOKEN'])  # –ò–∑–º–µ–Ω–µ–Ω–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–∞—Ä–Ω—ã—Ö –∫–∞–≤—ã—á–µ–∫
    return bot


def get_users_with_promocode(db_path: str | Path = 'UsersData.db') -> list: # –î–æ–±–∞–≤–ª–µ–Ω–æ: –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –∏ –∏–º—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    """
    –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —É –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–µ —Ä–∞–≤–µ–Ω 1.

    :param db_path: –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite.
    :type db_path: str | Path, optional
    :return: –°–ø–∏—Å–æ–∫ id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    :rtype: list
    :raises sqlite3.Error: –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

    –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è::
        >>> users = get_users_with_promocode('test.db')
        >>> print(users)
        [(123,), (456,)]
    """
    try:
        with sqlite3.connect(db_path) as conn: # –ò–∑–º–µ–Ω–µ–Ω–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ with
            cursor = conn.cursor()
            cursor.execute('SELECT id FROM users_data_table WHERE promocode != 1') # –ò–∑–º–µ–Ω–µ–Ω–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–∞—Ä–Ω—ã—Ö –∫–∞–≤—ã—á–µ–∫
            users = cursor.fetchall()
            return users
    except sqlite3.Error as e:
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö: {e}')
        return []


def send_message_to_user(bot: telebot.TeleBot, user_id: int, message_text: str) -> bool:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é Telegram.

    :param bot: –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ Telegram.
    :type bot: telebot.TeleBot
    :param user_id: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.
    :type user_id: int
    :param message_text: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.
    :type message_text: str
    :return: True, –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ, –∏–Ω–∞—á–µ False.
    :rtype: bool
    :raises telebot.apihelper.ApiException: –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

    –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è::
        >>> bot = telebot.TeleBot(token='test_token')
        >>> result = send_message_to_user(bot, 123, '–ü—Ä–∏–≤–µ—Ç!')
        >>> print(result)
        True
    """
    try:
        bot.send_message(chat_id=user_id, text=message_text, parse_mode='html') # –ò–∑–º–µ–Ω–µ–Ω–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–∞—Ä–Ω—ã—Ö –∫–∞–≤—ã—á–µ–∫
        logger.info(f'–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}') # –ò–∑–º–µ–Ω–µ–Ω–æ: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        return True
    except telebot.apihelper.ApiException as e:
        logger.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}') # –ò–∑–º–µ–Ω–µ–Ω–æ: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        return False


def main():
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
    """
    bot = get_telegram_bot()
    users = get_users_with_promocode() # –ò–∑–º–µ–Ω–µ–Ω–æ: –ø–µ—Ä–µ–¥–∞—á–∞ –∏–º–µ–Ω–∏ –ë–î –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    message_text = (
        '–£—Å–ø–µ–π—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–º FREE24 –¥–æ 21 –¥–µ–∫–∞–±—Ä—è!\n\n'
        '–ü–æ –Ω–µ–º—É –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –º–µ—Å—è—Ü —Ç–∞—Ä–∏—Ñ–∞ PRO ‚Äî —ç—Ç–æ –±–µ–∑–ª–∏–º–∏—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π üí• \n\n'
        '–ß—Ç–æ–±—ã –≤–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –¢–∞—Ä–∏—Ñ—ã –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ü—Ä–æ–º–æ–∫–æ–¥¬ª.'
    ) # –ò–∑–º–µ–Ω–µ–Ω–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–∞—Ä–Ω—ã—Ö –∫–∞–≤—ã—á–µ–∫
    for user_id, in users:
        send_message_to_user(bot, user_id, message_text)


if __name__ == '__main__':
    main()
```
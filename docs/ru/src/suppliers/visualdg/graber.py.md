# Модуль `src.suppliers.visualdg.graber`

## Обзор

Модуль `src.suppliers.visualdg.graber` предназначен для сбора данных о товарах с веб-сайта `visualdg.co.il`. Он наследует функциональность от родительского класса `Graber` и переопределяет методы для нестандартной обработки полей, специфичных для данного поставщика. Также, в модуле предусмотрена возможность предварительных действий перед отправкой запросов к веб-драйверу через декораторы.

## Подробней

Этот модуль является частью системы для сбора данных о товарах от различных поставщиков. Он специализируется на извлечении информации с сайта `visualdg.co.il`. Основная задача модуля - предоставить унифицированный интерфейс для получения данных о товарах, абстрагируясь от особенностей структуры конкретного сайта. Модуль использует веб-драйвер для взаимодействия с сайтом и сбора необходимых данных.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для сбора данных о товарах с сайта `visualdg.co.il`. Он наследует большую часть функциональности от класса `Graber` (родительского класса) и переопределяет методы, если требуется нестандартная обработка полей, специфичная для данного поставщика.

**Принцип работы**:

1.  **Инициализация**: При создании экземпляра класса `Graber` происходит инициализация с указанием префикса поставщика (`visualdg`), драйвера веб-браузера и индекса языка.
2.  **Наследование**: Класс наследует методы от родительского класса `Graber`, которые обеспечивают базовый функционал для сбора данных с веб-страниц.
3.  **Переопределение методов**: При необходимости, методы родительского класса переопределяются для обеспечения специфичной логики сбора данных для `visualdg.co.il`.
4.  **Декораторы**: Поддерживается использование декораторов для выполнения предварительных действий перед запросами к веб-драйверу, таких как закрытие всплывающих окон.

**Атрибуты**:

*   `supplier_prefix` (str): Префикс поставщика, устанавливается как `'visualdg'`.

**Методы**:

*   `__init__(driver: Driver, lang_index)`: Инициализирует класс `Graber` с указанием драйвера веб-браузера и индекса языка.

## Функции

### `close_pop_up`

```python
def close_pop_up(value: Any = None) -> Callable:
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
    ...
```

**Назначение**: Функция `close_pop_up` создает декоратор, который предназначен для закрытия всплывающих окон на веб-странице перед выполнением основной логики декорируемой функции. Это может быть полезно для предотвращения блокировки элементов страницы всплывающими окнами.

**Параметры**:

*   `value` (Any, optional): Дополнительное значение, которое может быть передано декоратору. По умолчанию `None`.

**Возвращает**:

*   `Callable`: Декоратор, который можно применить к функции.

**Как работает функция**:

1.  **Определение декоратора**: Функция `close_pop_up` определяет внутреннюю функцию `decorator`, которая принимает функцию `func` в качестве аргумента и возвращает обертку `wrapper`.
2.  **Обертка `wrapper`**: Внутри `wrapper` выполняется попытка закрытия всплывающего окна с использованием `Context.driver.execute_locator(Context.locator.close_pop_up)`. Если возникает исключение `ExecuteLocatorException`, оно логируется.
3.  **Вызов декорируемой функции**: После попытки закрытия всплывающего окна вызывается основная функция `func` с использованием `await func(*args, **kwargs)`.
4.  **Возврат обертки**: Функция `decorator` возвращает обертку `wrapper`.

**Внутренние функции**:

### `decorator`

```python
def decorator(func: Callable) -> Callable:
    """Декоратор, оборачивающий функцию.

    Args:
        func (Callable): Декорируемая функция.

    Returns:
        Callable: Обертка для декорируемой функции.
    """
    ...
```

**Назначение**: Функция `decorator` создает обертку для декорируемой функции, выполняя предварительные действия (закрытие всплывающего окна) перед вызовом основной функции.

**Параметры**:

*   `func` (Callable): Декорируемая функция.

**Возвращает**:

*   `Callable`: Обертка для декорируемой функции.

### `wrapper`

```python
async def wrapper(*args, **kwargs):
    """Обертка для декорируемой функции, выполняющая предварительные действия.

    Args:
        *args: Позиционные аргументы для декорируемой функции.
        **kwargs: Именованные аргументы для декорируемой функции.

    Returns:
        Any: Результат вызова декорируемой функции.
    """
    ...
```

**Назначение**: Функция `wrapper` является оберткой для основной функции. Она выполняет попытку закрытия всплывающего окна перед вызовом основной функции и обрабатывает исключения, которые могут возникнуть при этом.

**Параметры**:

*   `*args`: Позиционные аргументы для декорируемой функции.
*   `**kwargs`: Именованные аргументы для декорируемой функции.

**Возвращает**:

*   `Any`: Результат вызова декорируемой функции.

**Вызывает исключения**:

*   `ExecuteLocatorException`: Если не удается выполнить локатор для закрытия всплывающего окна.

**Примеры**:

Пример использования декоратора для закрытия всплывающих окон перед выполнением функции сбора данных:

```python
from src.suppliers.visualdg.graber import close_pop_up

@close_pop_up()
async def grab_data(self, item: dict) -> None:
    """Функция для сбора данных, декорированная для закрытия всплывающих окон."""
    ...
```

### `__init__`

```python
def __init__(self, driver: Driver, lang_index):
    """Инициализация класса сбора полей товара."""
    self.supplier_prefix = 'visualdg'
    super().__init__(supplier_prefix=self.supplier_prefix, driver=driver, lang_index=lang_index)
    # Устанавливаем глобальные настройки через Context
    
    Context.locator_for_decorator = None # <- если будет уастановлено значение - то оно выполнится в декораторе `@close_pop_up`
```

**Назначение**: Инициализирует экземпляр класса `Graber`.

**Параметры**:

*   `driver` (Driver): Экземпляр веб-драйвера, используемый для взаимодействия с веб-страницами.
*   `lang_index` (int): Индекс языка, используемый для локализации.

**Как работает функция**:

1.  **Установка префикса поставщика**: Устанавливает атрибут `supplier_prefix` в значение `'visualdg'`, который идентифицирует поставщика данных.
2.  **Вызов конструктора родительского класса**: Вызывает конструктор родительского класса `Graber` с передачей префикса поставщика, экземпляра веб-драйвера и индекса языка. Это позволяет инициализировать общие параметры и настройки, необходимые для работы класса.
3.  **Установка глобальных настроек**: Устанавливает атрибут `Context.locator_for_decorator` в значение `None`. Этот атрибут используется декоратором `@close_pop_up` для выполнения предварительных действий, таких как закрытие всплывающих окон. Если значение установлено, декоратор выполнится; в противном случае декоратор не будет выполнять никаких действий.

**Примеры**:

Пример создания экземпляра класса `Graber`:

```python
from src.webdriver.driver import Driver
from src.webdriver.chrome import Chrome
from src.suppliers.visualdg.graber import Graber

driver = Driver(Chrome)
graber = Graber(driver, lang_index=0)
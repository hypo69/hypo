# Модуль `background.js`

## Обзор

Файл `background.js` отвечает за обработку сообщений от других частей расширения, таких как скрипты содержимого страницы, и за отправку собранных данных на сервер. Он слушает события `chrome.browserAction.onClicked` для отправки запроса сбора данных на активную вкладку и `chrome.runtime.onMessage` для обработки ответов. Собираемые данные отправляются на сервер с помощью запроса `fetch`.

## Обработка событий

### `chrome.browserAction.onClicked`

**Описание**: Этот слушатель реагирует на клик по значку расширения.  При клике отправляется сообщение в активную вкладку с запросом о сборе данных по заданному URL.

**Параметры**:

* `tab` (object): Объект, содержащий информацию о текущей вкладке.

**Возвращает**:
-  Не применимо.


### `chrome.runtime.onMessage.addListener`

**Описание**: Этот слушатель реагирует на сообщения, отправленные другими частями расширения. При получении сообщения с действием `'collectData'` вызывает функцию `sendDataToServer` для отправки данных.

**Параметры**:

* `message` (object): Объект, содержащий данные, отправленные отправителем.
* `sender` (object): Информация об отправителе сообщения.
* `sendResponse` (function): Функция для отправки ответа обратно отправителю.

**Возвращает**:
- `true`: Необходимый параметр для асинхронной обработки сообщений в Chrome.

## Функции

### `sendDataToServer(url: str)`

**Описание**: Отправляет собранные данные на сервер.

**Параметры**:

* `url` (str): URL страницы, для которой необходимо собрать данные.

**Возвращает**:
-  Не применимо.

**Вызывает исключения**:

* `Error`: Возникает, если запрос на сервер не удался.


**Детали реализации**:

1. Получает сохраненные в локальном хранилище данные.
2. Если данные найдены, отправляет POST-запрос на сервер (`serverUrl`) с данными.
3. Обрабатывает успешное и неуспешное выполнение запроса, выводит соответствующие сообщения в консоль.
4. Если данные не найдены, выводит сообщение об этом в консоль.


**Обработка HTTP-ответа**:

Функция использует `response.ok` для проверки успешности запроса. Если ответ не успешный, генерируется исключение `Error` с сообщением 'Failed to send data to server'.

**Замечания**:

* Адрес сервера (`serverUrl`) должен быть заменён на действительный адрес сервера, на который необходимо отправить данные.

```python
# Пример использования функции sendDataToServer
def sendDataToServer(url: str) -> None:
    """
    Отправляет данные на сервер.

    Args:
        url (str): URL страницы.

    Returns:
        None

    Raises:
        Error: Если запрос на сервер не удался.
    """
    # ... (Тело функции)
```
# Анализ кода модуля `src.webdriver.playwright`

**Качество кода**
7
-  Плюсы
    -   Хорошее общее описание модуля и его назначения.
    -   Подробное описание конфигурационного файла `playwrid.json`.
    -   Примеры использования и настройки Playwright Crawler.
    -   Описание логирования и отладки.
-  Минусы
    -   Неполное соответствие требованиям к документации (отсутствуют reStructuredText элементы).
    -   Присутствуют лишние заголовки в формате Markdown.
    -   Некоторый код требует рефакторинга и уточнения.
    -   Отсутствует блок с примерами документации RST.

**Рекомендации по улучшению**

1.  **Форматирование документации:**
    -   Использовать reStructuredText (RST) для описания модуля и его элементов, включая класс, функции, и параметры.
    -   Использовать `.. code-block::` для примеров кода.
    -   Использовать `:param:` для описания параметров функций и методов.
    -   Использовать `:return:` для описания возвращаемого значения.
    -   Использовать `:raises:` для описания возможных исключений.
2.  **Код:**
    -   Добавить описание модуля в начало файла в формате reStructuredText.
    -   Уточнить инструкции по установке, например, добавить команду для установки playwright.
    -   Упростить описание конфигурационного файла, используя RST.
    -   Примеры использования должны быть в блоках `.. code-block:: python`.
    -   Добавить примеры документации RST в разделе "Примеры логов".

**Оптимизированный код**

```rst
.. module:: src.webdriver.playwright

=========================================================================================
Модуль Playwright Crawler для автоматизации браузера
=========================================================================================

Этот модуль предоставляет кастомную реализацию :class:`Playwrid` с использованием библиотеки Playwright.
Он позволяет настраивать параметры запуска браузера, такие как user-agent, прокси, размер окна и другие
настройки, определённые в файле ``playwrid.json``.

Ключевые особенности
--------------------

- **Централизованная конфигурация**: Конфигурация управляется через файл ``playwrid.json``.
- **Поддержка пользовательских опций**: Возможность передавать пользовательские опции при инициализации.
- **Улучшенное логирование и обработка ошибок**: Предоставляет подробные логи для инициализации, проблем
  с конфигурацией и ошибок WebDriver.
- **Поддержка прокси**: Настройка прокси-сервера для обхода ограничений.
- **Гибкие настройки браузера**: Возможность настройки размера окна, user-agent и других параметров.

Требования
----------

Перед использованием этого модуля убедитесь, что установлены следующие зависимости:

- Python 3.x
- Playwright
- Crawlee

Установите необходимые зависимости Python:

.. code-block:: bash

    pip install playwright crawlee

Кроме того, убедитесь, что Playwright установлен и настроен для работы с браузером.
Установите браузеры, используя команду:

.. code-block:: bash

    playwright install

Конфигурация
-------------

Конфигурация для Playwright Crawler хранится в файле ``playwrid.json``. Ниже приведён пример
структуры конфигурационного файла и его описание:

Пример конфигурации (``playwrid.json``)
--------------------------------------

.. code-block:: json

    {
      "browser_type": "chromium",
      "headless": true,
      "options": [
        "--disable-dev-shm-usage",
        "--no-sandbox",
        "--disable-gpu"
      ],
      "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36",
      "proxy": {
        "enabled": false,
        "server": "http://proxy.example.com:8080",
        "username": "user",
        "password": "password"
      },
      "viewport": {
        "width": 1280,
        "height": 720
      },
      "timeout": 30000,
      "ignore_https_errors": false
    }

Описание полей конфигурации
-----------------------------

#### 1. ``browser_type``

Тип браузера, который будет использоваться. Возможные значения:

- ``chromium`` (по умолчанию)
- ``firefox``
- ``webkit``

#### 2. ``headless``

Булевое значение, указывающее, должен ли браузер запускаться в безголовом режиме. По умолчанию ``true``.

#### 3. ``options``

Список аргументов командной строки, передаваемых в браузер. Примеры:

- ``--disable-dev-shm-usage``: Отключает использование ``/dev/shm`` в Docker-контейнерах.
- ``--no-sandbox``: Отключает режим песочницы.
- ``--disable-gpu``: Отключает аппаратное ускорение GPU.

#### 4. ``user_agent``

Строка user-agent, которая будет использоваться для запросов браузера.

#### 5. ``proxy``

Настройки прокси-сервера:

- **enabled**: Булевое значение, указывающее, следует ли использовать прокси.
- **server**: Адрес прокси-сервера.
- **username**: Имя пользователя для аутентификации на прокси-сервере.
- **password**: Пароль для аутентификации на прокси-сервере.

#### 6. ``viewport``

Размеры окна браузера:

- **width**: Ширина окна.
- **height**: Высота окна.

#### 7. ``timeout``

Максимальное время ожидания для выполнения операций (в миллисекундах). По умолчанию ``30000`` (30 секунд).

#### 8. ``ignore_https_errors``

Булевое значение, указывающее, следует ли игнорировать ошибки HTTPS. По умолчанию ``false``.

Использование
-------------

Чтобы использовать :class:`Playwrid` в своём проекте, просто импортируйте его и инициализируйте:

.. code-block:: python

    from src.webdriver.playwright import Playwrid

    # Инициализация Playwright Crawler с пользовательскими опциями
    browser = Playwrid(options=["--headless"])

    # Запуск браузера и переход на сайт
    browser.start("https://www.example.com")

Класс :class:`Playwrid` автоматически загружает настройки из файла ``playwrid.json`` и использует их для
конфигурации WebDriver. Также можно указать пользовательский user-agent и передать дополнительные опции
при инициализации WebDriver.

Логирование и отладка
---------------------

Класс WebDriver использует ``logger`` из ``src.logger`` для логирования ошибок, предупреждений и общей
информации. Все проблемы, возникающие при инициализации, конфигурации или выполнении, будут
записываться в логи для удобства отладки.

Примеры логов
-------------

- **Ошибка при инициализации WebDriver**: ``Ошибка при инициализации Playwright Crawler: <детали ошибки>``
- **Проблемы с конфигурацией**: ``Ошибка в файле playwrid.json: <детали проблемы>``

Лицензия
--------

Этот проект лицензирован на условиях MIT License. Подробности см. в файле [LICENSE](../../LICENSE).

Примеры документации RST
------------------------
    
    Пример 1.
    
    .. code-block:: python

        def example_function(param1: str, param2: int) -> bool:
            """
            Пример функции с документацией reStructuredText.

            :param param1: Строковый параметр.
            :type param1: str
            :param param2: Целочисленный параметр.
            :type param2: int
            :return: True если функция выполнилась успешно, False в противном случае.
            :rtype: bool
            :raises ValueError: Если входные параметры не валидны.
            """
            if not isinstance(param1, str) or not isinstance(param2, int):
              raise ValueError("Invalid parameter types")
            return True
    
    Пример 2.
    
    .. code-block:: python

        class ExampleClass:
           """
           Пример класса с документацией reStructuredText.
           """
           def __init__(self, value:str):
            """
             Инициализация класса ExampleClass
             :param value:  Значение
             :type value: str
            """
            self.value = value

           def get_value(self)->str:
            """
            Возвращает значение
            :return: значение
            :rtype: str
            """
            return self.value
```
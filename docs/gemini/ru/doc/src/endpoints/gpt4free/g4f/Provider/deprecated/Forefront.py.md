# Модуль для работы с Forefront API (не рекомендуется к использованию)

## Обзор

Модуль предоставляет класс `Forefront` для взаимодействия с API Forefront, который позволяет генерировать текст на основе предоставленных сообщений. Поддерживает потоковую передачу данных и модель `gpt-35-turbo`.

## Подробней

Этот модуль является устаревшим и не рекомендуется к использованию. Он содержит класс `Forefront`, который реализует интерфейс `AbstractProvider` и предоставляет функциональность для создания текста на основе предоставленных сообщений, используя API Forefront. Модуль поддерживает потоковую передачу данных и модель `gpt-35-turbo`.

## Классы

### `Forefront(AbstractProvider)`

**Описание**: Класс для взаимодействия с API Forefront.

**Наследует**:
- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для провайдеров.

**Атрибуты**:
- `url` (str): URL API Forefront (`"https://forefront.com"`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу (`True`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-35-turbo` (`True`).

**Методы**:
- `create_completion()`: Создает завершение текста на основе предоставленных сообщений.

## Функции

### `create_completion(model: str, messages: list[dict[str, str]], stream: bool, **kwargs: Any) -> CreateResult`

```python
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool, **kwargs: Any) -> CreateResult:
    """
    Создает завершение текста на основе предоставленных сообщений.

    Args:
        model (str): Название модели.
        messages (list[dict[str, str]]): Список сообщений, где каждое сообщение - это словарь с ключами "role" и "content".
        stream (bool): Флаг, указывающий, нужно ли использовать потоковую передачу.
        **kwargs (Any): Дополнительные параметры.

    Returns:
        CreateResult: Результат создания завершения текста.

    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с ошибкой.

    """
```

**Назначение**: Создает запрос к API Forefront для генерации текста на основе предоставленных сообщений и возвращает результат.

**Параметры**:
- `model` (str): Название модели, которую нужно использовать для генерации текста.
- `messages` (list[dict[str, str]]): Список сообщений, где каждое сообщение представляет собой словарь с ключами `"role"` и `"content"`. Ключ `"role"` указывает на роль автора сообщения (например, `"user"` или `"assistant"`), а ключ `"content"` содержит текст сообщения.
- `stream` (bool): Флаг, указывающий, нужно ли использовать потоковую передачу для получения результата.
- `**kwargs` (Any): Дополнительные параметры, которые могут быть переданы в API Forefront.

**Возвращает**:
- `CreateResult`: Результат создания завершения текста. В случае потоковой передачи возвращает генератор, который выдает части текста по мере их поступления. В противном случае возвращает полный сгенерированный текст.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Если HTTP-запрос завершается с ошибкой (например, если сервер возвращает код состояния HTTP, указывающий на ошибку).

**Как работает функция**:

1. **Подготовка данных**: Формирует словарь `json_data`, который будет отправлен в теле запроса к API Forefront. В этот словарь входят:
   - `text`: Содержимое последнего сообщения в списке `messages`.
   - `action`: `"noauth"`.
   - `id`, `parentId`, `workspaceId`: Пустые строки.
   - `messagePersona`: `"607e41fe-95be-497e-8e97-010a59b2e2c0"`.
   - `model`: `"gpt-4"`.
   - `messages`: Все сообщения из списка `messages`, кроме последнего, если их больше одного.
   - `internetMode`: `"auto"`.
2. **Отправка запроса**: Отправляет POST-запрос к API Forefront (`"https://streaming.tenant-forefront-default.knative.chi.coreweave.com/free-chat"`) с сформированными данными в формате JSON и параметром `stream=True`, чтобы получать данные потоком.
3. **Обработка ответа**:
   - Вызывает `response.raise_for_status()`, чтобы проверить, не вернул ли сервер код состояния HTTP, указывающий на ошибку. Если ошибка есть, выбрасывается исключение `HTTPError`.
   - Итерируется по строкам в ответе, используя `response.iter_lines()`.
   - Для каждой строки проверяет, содержит ли она подстроку `b"delta"`. Если да, то строка содержит часть сгенерированного текста.
   - Извлекает JSON из строки, декодирует его и извлекает значение по ключу `"delta"`.
   - С помощью `yield` возвращает полученную часть текста.

```
Подготовка данных для запроса
    │
    └── Создание json_data (текст, action, id, и т.д.)
        │
        └── Отправка POST-запроса к API Forefront (stream=True)
            │
            └── Проверка статуса ответа (raise_for_status)
                │
                └── Итерация по строкам ответа
                    │
                    └── Проверка наличия "delta" в строке
                        │
                        └── Извлечение JSON и получение значения "delta"
                            │
                            └── Возврат (yield) части текста
```

**Примеры**:

Пример 1:
```python
messages = [{"role": "user", "content": "Напиши короткое стихотворение о весне."}]
result = Forefront.create_completion(model="gpt-4", messages=messages, stream=True)
for chunk in result:
    print(chunk, end="")
```

Пример 2:
```python
messages = [
    {"role": "user", "content": "Что такое машинное обучение?"},
    {"role": "assistant", "content": "Машинное обучение - это ..."},
    {"role": "user", "content": "Объясни подробнее про нейронные сети."}
]
result = Forefront.create_completion(model="gpt-4", messages=messages, stream=True)
for chunk in result:
    print(chunk, end="")
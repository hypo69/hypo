# Модуль для работы с провайдером Forefront
## Обзор

Модуль предоставляет класс `Forefront`, который является провайдером для работы с API Forefront. Forefront позволяет использовать модель `gpt-4` и поддерживает стриминг ответов. Модуль предназначен для интеграции с другими частями проекта `hypotez`, обеспечивая взаимодействие с Forefront API для генерации текста на основе предоставленных сообщений.

## Подробней

Этот модуль позволяет взаимодействовать с сервисом Forefront для генерации текста. Он использует `requests` для отправки POST-запросов к API и обрабатывает стриминговые ответы. Класс `Forefront` наследуется от `AbstractProvider`, что позволяет единообразно использовать его с другими провайдерами в проекте `hypotez`.

## Классы

### `Forefront(AbstractProvider)`

**Описание**: Класс `Forefront` предоставляет интерфейс для взаимодействия с API Forefront.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для всех провайдеров.

**Атрибуты**:
- `url` (str): URL для доступа к Forefront.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер стриминг ответов (True).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-35-turbo` (True).

**Методы**:
- `create_completion`: Создает запрос к API Forefront и возвращает сгенерированный текст.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool, **kwargs: Any) -> CreateResult:
    """ Функция отправляет запрос к API Forefront и возвращает сгенерированный текст.

    Args:
        model (str): Модель для использования (например, "gpt-4").
        messages (list[dict[str, str]]): Список сообщений для отправки в API.
        stream (bool): Указывает, следует ли использовать стриминг ответов.
        **kwargs (Any): Дополнительные аргументы.

    Returns:
        CreateResult: Результат генерации текста.

    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с ошибкой.
    """
```

**Назначение**: Функция `create_completion` отправляет запрос к API Forefront для генерации текста на основе предоставленных сообщений. Она поддерживает как стриминговый, так и не стриминговый режимы работы.

**Параметры**:
- `model` (str): Модель для использования (например, "gpt-4").
- `messages` (list[dict[str, str]]): Список сообщений для отправки в API. Каждое сообщение представляет собой словарь с ключами "role" и "content".
- `stream` (bool): Указывает, следует ли использовать стриминг ответов. Если `True`, функция возвращает генератор токенов.
- `**kwargs` (Any): Дополнительные аргументы, которые могут быть переданы в API.

**Возвращает**:
- `CreateResult`: Генератор токенов, если `stream` равен `True`. В противном случае возвращает строку с сгенерированным текстом.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Если HTTP-запрос завершается с ошибкой.

**Как работает функция**:

1. **Подготовка данных**: Функция принимает модель, список сообщений и флаг стриминга. Она формирует JSON-данные для отправки в API Forefront, включая текст последнего сообщения, предыдущие сообщения (если они есть) и другие параметры, такие как `messagePersona` и `internetMode`.
2. **Отправка запроса**: Функция отправляет POST-запрос к API Forefront (`https://streaming.tenant-forefront-default.knative.chi.coreweave.com/free-chat`) с использованием библиотеки `requests`. Если `stream` равен `True`, устанавливается параметр `stream=True` для получения стримингового ответа.
3. **Обработка ответа**:
   - Если `stream` равен `True`, функция итерируется по строкам ответа и извлекает дельты (новые токены) из JSON-объектов, содержащих ключ `delta`. Эти дельты возвращаются через генератор.
4. **Обработка ошибок**: Функция вызывает `response.raise_for_status()`, чтобы проверить, не завершился ли HTTP-запрос с ошибкой. Если ошибка произошла, будет вызвано исключение `requests.exceptions.HTTPError`.

```
Подготовка JSON-данных
│
└───> Отправка POST-запроса к API Forefront
│
└───> Обработка ответа (стриминг или полный)
│
└───> Извлечение и возврат токенов (если стриминг)
```

**Примеры**:

Пример использования функции `create_completion` для получения стримингового ответа:

```python
model = "gpt-4"
messages = [{"role": "user", "content": "Напиши короткий рассказ о космосе."}]
stream = True

result = Forefront.create_completion(model=model, messages=messages, stream=stream)
if stream:
    for token in result:
        print(token, end="")
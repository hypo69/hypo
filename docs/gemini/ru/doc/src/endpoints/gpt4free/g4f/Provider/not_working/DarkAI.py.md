# Модуль `DarkAI`

## Обзор

Модуль `DarkAI` предоставляет асинхронный интерфейс для взаимодействия с сервисом `darkai.foundation`. Он позволяет генерировать текст на основе предоставленных сообщений, используя различные модели, такие как `gpt-4o`, `gpt-3.5-turbo` и `llama-3-70b`. Модуль поддерживает потоковую передачу данных и использует `aiohttp` для асинхронных HTTP-запросов.

## Подробнее

Модуль предназначен для интеграции с другими частями проекта `hypotez`, требующими взаимодействия с AI-моделями через API `darkai.foundation`. Он обеспечивает абстракцию от низкоуровневых деталей HTTP-запросов и обработки ответов, предоставляя удобный интерфейс для генерации текста.

## Классы

### `DarkAI`

**Описание**: Класс `DarkAI` является асинхронным провайдером и миксином моделей, который взаимодействует с API `darkai.foundation` для генерации текста.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями.

**Аттрибуты**:
- `url` (str): URL сервиса `darkai.foundation`.
- `api_endpoint` (str): URL API для отправки запросов.
- `working` (bool): Указывает, работает ли провайдер (в данном случае `False`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (`True`).
- `default_model` (str): Модель, используемая по умолчанию (`llama-3-70b`).
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Словарь псевдонимов моделей.

### `create_async_generator`

**Описание**: Асинхронный класс-метод для создания генератора, который отправляет запросы к API `darkai.foundation` и возвращает сгенерированный текст.

**Параметры**:
- `model` (str): Название модели для использования.
- `messages` (Messages): Список сообщений, используемых для формирования запроса.
- `proxy` (str, optional): Прокси-сервер для использования при отправке запроса. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий сгенерированный текст.

**Как работает функция**:

1.  **Подготовка**:
    *   Извлекает модель из `model_aliases`, если она есть.
    *   Определяет заголовки запроса, включая `accept`, `content-type` и `user-agent`.
    *   Устанавливает таймаут для `ClientSession`.

2.  **Отправка запроса**:
    *   Форматирует сообщения в запрос.
    *   Отправляет `POST` запрос к `cls.api_endpoint` с данными `query` и `model`.
    *   Обрабатывает ответ, проверяя статус код.

3.  **Обработка потока данных**:
    *   Читает данные из потока ответа чанками (размером 1024 байта).
    *   Разделяет буфер на строки по символу `\n`.
    *   Обрабатывает каждую строку, декодирует её из JSON.
    *   Если строка начинается с `data: `, извлекает данные и проверяет событие (`event`).
    *   Если событие `text-chunk`, извлекает текст и передает его в генератор.
    *   Если событие `stream-end`, завершает генератор.

4.  **Обработка ошибок**:
    *   Обрабатывает ошибки декодирования JSON.
    *   Обрабатывает общие исключения.

```
    Начало
    ↓
    → Выбор модели (с учетом алиасов)
    ↓
    → Настройка заголовков и таймаута
    ↓
    → Отправка POST запроса к API
    ↓
    → Чтение данных из потока ответа
    ↓
    → Разделение на строки и обработка каждой строки
    ↓
    → Извлечение данных и проверка события
    ↓
    → Если text-chunk: передача текста в генератор
    ↓
    → Если stream-end: завершение генератора
    ↓
    Конец
```

**Примеры**:

Пример использования функции:

```python
    async def main():
        model = "gpt-3.5-turbo"
        messages = [{"role": "user", "content": "Hello, how are you?"}]
        async for chunk in DarkAI.create_async_generator(model=model, messages=messages):
            print(chunk, end="")
```
## Функции

В данном модуле функции отсутствуют.

```
`
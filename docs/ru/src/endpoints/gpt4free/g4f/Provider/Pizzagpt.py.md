# Модуль Pizzagpt
## Обзор

Модуль `Pizzagpt` предоставляет асинхронный генератор для взаимодействия с API Pizzagpt. Он позволяет отправлять запросы к API и получать ответы в виде асинхронного генератора, что удобно для обработки больших объемов данных. Модуль поддерживает указание модели, прокси и другие параметры запроса.

## Подробней

Модуль предназначен для интеграции с API Pizzagpt, который предоставляет доступ к языковой модели `gpt-4o-mini`.  Он использует `aiohttp` для выполнения асинхронных HTTP-запросов. Модуль обеспечивает форматирование запроса, отправку его к API и обработку ответа, возвращая контент в виде асинхронного генератора. Важной особенностью является обработка возможных ошибок, включая исключение `ValueError`, если обнаружено злоупотребление.

## Классы

### `Pizzagpt`

**Описание**: Класс `Pizzagpt` является асинхронным генератором провайдера и миксином модели провайдера. Он наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`.

**Принцип работы**:
Класс определяет URL, endpoint API, флаг работоспособности, модель по умолчанию и список поддерживаемых моделей. Основная функциональность заключается в асинхронном создании генератора, который отправляет запросы к API Pizzagpt и возвращает ответы.

**Методы**:

- `create_async_generator`: Асинхронный класс-метод, создающий генератор для взаимодействия с API.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для взаимодействия с API Pizzagpt.

    Args:
        model (str): Модель для использования в запросе.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        **kwargs: Дополнительные параметры.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий ответы от API.

    Raises:
        ValueError: Если обнаружено злоупотребление в контенте ответа.
        Exception: Если возникает ошибка при выполнении запроса.

    """
```

**Как работает функция**:

1. **Подготовка заголовков**: Создаются заголовки HTTP-запроса, включая `accept`, `content-type`, `user-agent` и `x-secret`.
2. **Создание сессии**: Используется `aiohttp.ClientSession` для управления асинхронными HTTP-запросами.
3. **Форматирование запроса**: Список сообщений `messages` форматируется в строку `prompt` с использованием функции `format_prompt`.
4. **Подготовка данных**: Данные для отправки в запросе формируются в виде словаря, где `question` содержит отформатированный `prompt`.
5. **Отправка запроса**: Асинхронно отправляется POST-запрос к API endpoint с использованием `session.post`.
6. **Обработка ответа**:
   - Проверяется статус ответа с помощью `response.raise_for_status()`.
   - Извлекается JSON из ответа с использованием `response.json()`.
   - Извлекается контент из JSON, сначала по ключу `"answer"`, затем по ключу `"content"`.
7. **Генерация контента**:
   - Если контент существует:
     - Проверяется наличие сообщения о злоупотреблении (`"Misuse detected. please get in touch"`). Если оно обнаружено, вызывается исключение `ValueError`.
     - Контент возвращается через `yield`.
     - После контента возвращается сигнал остановки (`FinishReason("stop")`) через `yield`.

**Примеры**:

```python
import asyncio
from typing import List, Dict

from src.endpoints.gpt4free.g4f.Provider.Pizzagpt import Pizzagpt
from src.endpoints.gpt4free.g4f.typing import Messages, AsyncResult

async def example():
    # Пример сообщений для отправки
    messages: Messages = [{"role": "user", "content": "Hello, how are you?"}]
    
    # Создание асинхронного генератора
    generator: AsyncResult = await Pizzagpt.create_async_generator(model=Pizzagpt.default_model, messages=messages)
    
    # Асинхронное получение и вывод контента из генератора
    async for content in generator:
        print(content, end="")

# Запуск примера
if __name__ == "__main__":
    asyncio.run(example())
# Модуль `hypotez/src/category/category.py`

## Обзор

Модуль `category.py` предоставляет классы для работы с категориями продуктов, в основном для PrestaShop. Он содержит средства для взаимодействия с данными о категориях продуктов, извлечения родительских категорий и рекурсивного обхода категорий.

## Классы

### `Category`

**Описание**: Обработчик категорий для продуктов. Наследуется от `PrestaCategory`.  Хранит данные аутентификации для API.

**Атрибуты**:

* `credentials`: Словарь с данными аутентификации (API ключи и т.п.).

**Методы**:

#### `__init__(self, api_credentials, *args, **kwargs)`

**Описание**: Инициализирует объект `Category`.

**Параметры**:

* `api_credentials`: Словарь с данными аутентификации для доступа к данным категорий.
* `args`: Список аргументов переменной длины (не используется).
* `kwargs`: Словарь ключевых аргументов (не используется).


#### `get_parents(self, id_category, dept)`

**Описание**: Возвращает список родительских категорий для заданной категории.

**Параметры**:

* `id_category`: ID категории, для которой нужно найти родительские категории.
* `dept`: Уровень вложенности категории.

**Возвращает**: Список родительских категорий.


#### `crawl_categories_async(self, url, depth, driver, locator, dump_file, default_category_id, category=None)`

**Описание**: Асинхронно обходит категории, строя иерархический словарь.

**Параметры**:

* `url`: URL страницы категории.
* `depth`: Глубина рекурсивного обхода.
* `driver`: Экземпляр Selenium WebDriver.
* `locator`: XPath локатор для ссылок на категории.
* `dump_file`: Путь к файлу JSON для сохранения результатов.
* `default_category_id`: ID стандартной категории.
* `category`: (Необязательно) Существующий словарь категории (по умолчанию `None`).

**Возвращает**: Обновлённый или новый словарь категории.

**Обрабатывает исключения**:

* `Exception`: Логирует ошибку и возвращает исходный словарь.


#### `crawl_categories(self, url, depth, driver, locator, dump_file, id_category_default, category={})`

**Описание**: Рекурсивно обходит категории и строит иерархический словарь.

**Параметры**:

* `url`: URL страницы для обхода.
* `depth`: Глубина рекурсии.
* `driver`: Экземпляр Selenium WebDriver.
* `locator`: XPath локатор для ссылок на категории.
* `dump_file`: Путь к файлу для сохранения иерархического словаря.
* `id_category_default`: ID стандартной категории.
* `category`: Словарь категории (по умолчанию пустой).

**Возвращает**: Иерархический словарь категорий и их URL.

**Обрабатывает исключения**:

* `Exception`: Логирует ошибку и возвращает исходный словарь.


#### `_is_duplicate_url(self, category, url)`

**Описание**: Проверяет, существует ли URL в словаре категории.

**Параметры**:

* `category`: Словарь категории.
* `url`: URL для проверки.

**Возвращает**: `True`, если URL дублируется, `False` иначе.



## Функции

### `compare_and_print_missing_keys(current_dict, file_path)`

**Описание**: Сравнивает текущий словарь с данными в файле и выводит отсутствующие ключи.

**Параметры**:

* `current_dict`: Текущий словарь.
* `file_path`: Путь к файлу.

**Обрабатывает исключения**:

* `Exception`: Логирует ошибку и не возвращает ничего.


## Дополнительные замечания

* Модуль использует асинхронный метод `crawl_categories_async` для обработки обхода категорий, а также синхронный метод `crawl_categories` для аналогичной задачи.
*  Используются функции `j_loads` и `j_dumps` из модуля `jjson` для безопасной работы с JSON-данными.
*  Используется модуль `logger` для ведения журналов ошибок.
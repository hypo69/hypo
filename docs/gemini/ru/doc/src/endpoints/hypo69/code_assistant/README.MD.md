# Code Assistant Module

## Обзор

Модуль `Code Assistant` представляет собой набор инструментов, предназначенных для взаимодействия с моделями **Gemini** и **OpenAI** для обработки исходного кода проекта. Он выполняет такие задачи, как создание документации, проверка кода и генерация тестов на основе указанных файлов. Кроме того, в него входят скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бот для обработки задач, связанных с кодом.

## Подорбней

Модуль `Code Assistant` предназначен для автоматизации задач, связанных с анализом и улучшением кода. Он использует AI-модели для генерации документации, проверки качества кода и создания тестов. Основная цель модуля - облегчить работу разработчиков и повысить качество разрабатываемого программного обеспечения.
В проекте `hypotez` данный модуль играет важную роль в автоматизации процессов документирования и проверки кода, что позволяет сократить время разработки и повысить качество продукта.

## Ключевые особенности

### `code_assistant.py`

- **Чтение файлов**: Считывает код из файлов `.py` и `README.MD` в указанных каталогах.
- **Взаимодействие с моделями**: Отправляет код моделям для таких задач, как создание документации или проверка ошибок.
- **Генерация результатов**: Сохраняет ответы модели в указанных каталогах для каждой роли.

### `make_summary.py`

- **Генерация SUMMARY.md**: Рекурсивно обходит каталог для создания файла `SUMMARY.md` для компиляции документации.
- **Фильтрация по языку**: Поддерживает фильтрацию файлов по языку (`ru` или `en`).

### `onela_bot.py` и `bot_handlers.py`

- **Telegram Bot**: Бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода для проверки или создание документации.
- **Bot Handlers**: Содержит обработчики для обработки команд и сообщений бота.

## Структура проекта

- **Models**: Использует модели **Gemini** и **OpenAI** для обработки запросов.
- **Prompts**: Считывает запросы из файлов в `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Files**: Обрабатывает файлы `.py` и `README.MD` в указанных каталогах.

## Примеры использования

### Запуск с настройками JSON:

```bash
python code_assistant.py --settings settings.json
```

### Запуск с явными параметрами:

```bash
python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

### Пример для роли `code_checker`:

```bash
python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
```

### Пример для модели `openai`:

```bash
python code_assistant.py --role doc_writer --lang en --models openai
```

## Параметры командной строки

- `--settings`: Путь к файлу JSON с настройками. Загружает параметры из файла.
- `--role`: Роль модели для задачи (например, `doc_writer`, `code_checker`).
- `--lang`: Язык для задачи (например, `ru` или `en`).
- `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
- `--start_dirs`: Список каталогов для обработки (например, `/path/to/dir1`).

## Рабочий процесс

1. **Чтение файлов**: Поиск файлов `.py` и `README.MD` в указанных каталогах.
2. **Загрузка подсказок**: Загрузка подсказок, специфичных для роли, из `src/ai/prompts/developer/`.
3. **Обработка запроса**: Формирование запросов на основе загруженных файлов и отправка их моделям.
4. **Сохранение ответа**: Сохранение ответов модели в каталогах, соответствующих роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Исключения

Настройте исключения для файлов и каталогов, используя параметры:
- `exclude_file_patterns`: Список шаблонов регулярных выражений для исключения файлов.
- `exclude_dirs`: Список каталогов для исключения.
- `exclude_files`: Список файлов для исключения.

## Логирование

Журналы сохраняются с использованием библиотеки `logger` и содержат информацию об обработке файлов и ответах модели.

## Зависимости

- **Gemini API**: Требуется ключ API для модели Gemini.
- **OpenAI API**: Требуется ключ API для модели OpenAI.

## Создание новой роли для моделей ИИ

1. **Обновите `code_assistant.json`**:
   - Добавьте новую роль в список ролей:
     ```json
     "roles": [
       "code_checker",
       ...
     ]
     ```
   - Кроме того, исключите его в `"exclude-roles"`.

2. **Добавьте роль в переводы**:
   - Обновите файл `translations/translations.json` с новой ролью.

3. **Создайте системный запрос**:
   - Добавьте новый системный запрос в `ai/prompts/developer/`.

4. **Создайте инструкцию по команде**:
   - Добавьте новую инструкцию по команде в `instructions/`.
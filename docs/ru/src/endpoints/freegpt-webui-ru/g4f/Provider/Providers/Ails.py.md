# Модуль `Ails.py`

## Обзор

Модуль предоставляет класс и функции для взаимодействия с провайдером Ails, использующим модель `gpt-3.5-turbo`. Он включает в себя функции для форматирования запросов, создания подписей и выполнения запросов к API `ai.ls`.

## Подробнее

Модуль содержит функции для генерации запросов к API `ai.ls`, использующие криптографические подписи для обеспечения безопасности. Он включает в себя утилиты для форматирования временных меток и вычисления SHA256-хешей.

## Классы

### `Utils`

**Описание**: Класс содержит статические методы для криптографической обработки данных, используемые для подписи запросов к API.

**Методы**:

- `hash(json_data: Dict[str, str]) -> sha256`: Вычисляет SHA256-хеш на основе предоставленных данных JSON и секретного ключа.

- `format_timestamp(timestamp: int) -> str`: Форматирует временную метку, добавляя корректировку на основе последней цифры временной метки.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, temperature: float = 0.6, stream: bool = False, **kwargs):
    """Функция отправляет запрос к API для получения ответа модели.

    Args:
        model (str): Имя используемой модели.
        messages (list): Список сообщений для отправки в запросе.
        temperature (float, optional): Температура для управления случайностью ответов. По умолчанию 0.6.
        stream (bool, optional): Включить потоковую передачу ответов. По умолчанию `False`.
        **kwargs: Дополнительные параметры.

    Returns:
        Generator[str, None, None]: Генератор токенов завершения, если `stream=True`.

    Как работает функция:
     1. Устанавливает заголовки запроса, включая авторизацию, идентификатор клиента и тип контента.
     2. Форматирует временную метку с использованием `Utils.format_timestamp`.
     3. Генерирует сигнатуру запроса, используя `Utils.hash`.
     4. Формирует JSON-данные запроса, включая модель, температуру, сообщения и сигнатуру.
     5. Отправляет POST-запрос к API `api.caipacity.com/v1/chat/completions` с потоковой передачей.
     6. Итерируется по строкам ответа и извлекает токены содержимого.
     7. Возвращает токен, если он не равен `None`.

    Внутренние функции: Отсутствуют.

    Примеры:
        >>> messages = [{"role": "user", "content": "Hello, how are you?"}]
        >>> for token in _create_completion(model="gpt-3.5-turbo", messages=messages, stream=True):
        ...     print(token, end="")  # doctest: +SKIP

    """
    ...
```

**Назначение**: Отправляет запрос к API для получения ответа модели.

**Параметры**:

- `model` (str): Имя используемой модели.
- `messages` (list): Список сообщений для отправки в запросе.
- `temperature` (float, optional): Температура для управления случайностью ответов. По умолчанию 0.6.
- `stream` (bool, optional): Включить потоковую передачу ответов. По умолчанию `False`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:

- `Generator[str, None, None]`: Генератор токенов завершения, если `stream=True`.

**Вызывает исключения**:

- `requests.exceptions.RequestException`: При возникновении ошибок во время выполнения HTTP-запроса.

**Как работает функция**:

 1. **Инициализация**:
    - Установка заголовков запроса, включая авторизацию, идентификатор клиента и тип контента.

 2. **Формирование данных для запроса**:
    - Форматирование временной метки с использованием `Utils.format_timestamp`.
    - Генерация сигнатуры запроса, используя `Utils.hash`.
    - Формирование JSON-данных запроса, включая модель, температуру, сообщения и сигнатуру.

 3. **Отправка запроса**:
    - Отправка POST-запроса к API `api.caipacity.com/v1/chat/completions` с потоковой передачей.

 4. **Обработка ответа**:
    - Итерирование по строкам ответа и извлечение токенов содержимого.
    - Возврат токена, если он не равен `None`.

**ASCII схема работы функции**:

```
Начало
  │
  ├─► Установка заголовков (headers)
  │
  ├─► Форматирование временной метки (timestamp)
  │
  ├─► Генерация сигнатуры (sig)
  │
  ├─► Формирование JSON-данных (json_data)
  │
  ├─► Отправка POST-запроса
  │
  ├─► Обработка ответа (response)
  │   │
  │   ├─► Извлечение токенов (token)
  │   │
  │   └─► Возврат токена
  │
  Конец
```

**Примеры**:

```python
messages = [{"role": "user", "content": "Hello, how are you?"}]
for token in _create_completion(model="gpt-3.5-turbo", messages=messages, stream=True):
    print(token, end="")
```

### `params`

```python
params = f'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: ' + \
    '(%s)' % ', '.join([f"{name}: {get_type_hints(_create_completion)[name].__name__}" for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]])
```

**Описание**: Строка, содержащая информацию о поддержке параметров функцией `_create_completion`. Получает имена параметров и их типы из аннотаций типов функции и форматирует их в строку.
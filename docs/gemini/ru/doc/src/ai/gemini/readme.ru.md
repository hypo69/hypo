# Модуль интеграции Google Generative AI

## Обзор

Класс `GoogleGenerativeAI` предназначен для взаимодействия с моделями Google Generative AI. Этот класс предоставляет методы для отправки запросов, обработки ответов, управления диалогами и интеграции с различными функциональностями ИИ. Он включает в себя надежную обработку ошибок, ведение журнала и настройки конфигурации для обеспечения беспрепятственной работы.

## Подорбней

Модуль `GoogleGenerativeAI` обеспечивает интеграцию с моделями Google Generative AI, позволяя отправлять запросы, обрабатывать ответы и управлять диалогами. Он обрабатывает ошибки, ведет журнал и использует настройки конфигурации для обеспечения надежной работы.

## Классы

### `GoogleGenerativeAI`

**Описание**: Класс для взаимодействия с моделями Google Generative AI.

**Принцип работы**:
Класс `GoogleGenerativeAI` инициализируется с ключом API, именем модели, конфигурацией генерации и системной инструкцией. Он обеспечивает методы для отправки запросов, обработки ответов, управления диалогами и интеграции с различными функциями ИИ.

**Аттрибуты**:
- `api_key` (str): Ключ API для доступа к Google Generative AI.
- `model_name` (Optional[str]): Имя используемой модели (по умолчанию `None`).
- `generation_config` (Optional[Dict]): Конфигурация генерации (по умолчанию `None`).
- `system_instruction` (Optional[str]): Системная инструкция для модели (по умолчанию `None`).

**Методы**:
- `__init__`: Инициализирует класс `GoogleGenerativeAI`.
- `config`: Получает конфигурацию из файла настроек.
- `_start_chat`: Запускает сессию чата с моделью ИИ.
- `_save_dialogue`: Сохраняет диалог в текстовые и JSON файлы.
- `ask`: Отправляет текстовый запрос модели ИИ и получает ответ.
- `chat`: Отправляет сообщение чата модели ИИ и получает ответ.
- `describe_image`: Генерирует текстовое описание изображения.
- `upload_file`: Загружает файл в модель ИИ.

## Функции

### `__init__(self, api_key: str, model_name: Optional[str] = None, generation_config: Optional[Dict] = None, system_instruction: Optional[str] = None, **kwargs)`

**Назначение**: Инициализирует класс `GoogleGenerativeAI` с необходимыми конфигурациями.

**Параметры**:
- `api_key` (str): Ключ API для доступа к Google Generative AI.
- `model_name` (Optional[str], optional): Имя используемой модели. По умолчанию `None`.
- `generation_config` (Optional[Dict], optional): Конфигурация генерации. По умолчанию `None`.
- `system_instruction` (Optional[str], optional): Системная инструкция для модели. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `None`

**Как работает функция**:
1. Инициализирует атрибуты класса, такие как ключ API, имя модели, конфигурацию генерации и системную инструкцию.
2. Определяет пути для ведения журнала диалогов и хранения истории.
3. Инициализирует модель Google Generative AI.

```
Инициализация атрибутов класса
↓
Определение путей для ведения журнала и истории
↓
Инициализация модели Google Generative AI
```

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
```

### `config(self)`

**Назначение**: Получает конфигурацию из файла настроек.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**:
- `None`

**Как работает функция**:
1. Читает и разбирает файл конфигурации, расположенный по пути `gs.path.src / 'ai' / 'gemini' / 'gemini.json'`.

```
Чтение файла конфигурации
↓
Разбор файла конфигурации
```

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
ai.config()
```

### `_start_chat(self)`

**Назначение**: Запускает сессию чата с моделью ИИ.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**:
- `None`

**Как работает функция**:
1. Инициализирует сессию чата с пустой историей.

```
Инициализация сессии чата с пустой историей
```

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
ai._start_chat()
```

### `_save_dialogue(self, dialogue: list)`

**Назначение**: Сохраняет диалог в текстовые и JSON файлы.

**Параметры**:
- `self`: Ссылка на экземпляр класса.
- `dialogue` (list): Список сообщений в диалоге.

**Возвращает**:
- `None`

**Как работает функция**:
1. Добавляет каждое сообщение в диалоге в текстовый файл.
2. Добавляет каждое сообщение в формате JSON в JSON файл.

```
Добавление сообщений в текстовый файл
↓
Добавление сообщений в JSON файл
```

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
dialogue = ["Привет", "Как дела?"]
ai._save_dialogue(dialogue)
```

### `ask(self, q: str, attempts: int = 15) -> Optional[str]`

**Назначение**: Отправляет текстовый запрос модели ИИ и получает ответ.

**Параметры**:
- `self`: Ссылка на экземпляр класса.
- `q` (str): Текстовый запрос.
- `attempts` (int, optional): Количество попыток в случае ошибки. По умолчанию 15.

**Возвращает**:
- `Optional[str]`: Ответ модели ИИ или `None` в случае ошибки.

**Как работает функция**:
1. Обрабатывает несколько попыток в случае ошибок сети или недоступности сервиса.
2. Ведет журнал ошибок и повторяет попытки с экспоненциальной задержкой.
3. Сохраняет диалог в файлы истории.

```
Обработка ошибок сети и недоступности сервиса
↓
Ведение журнала ошибок и повторные попытки с экспоненциальной задержкой
↓
Сохранение диалога в файлы истории
```

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
response = ai.ask("Как дела?")
print(response)
```

### `chat(self, q: str) -> str`

**Назначение**: Отправляет сообщение чата модели ИИ и получает ответ.

**Параметры**:
- `self`: Ссылка на экземпляр класса.
- `q` (str): Сообщение чата.

**Возвращает**:
- `str`: Ответ модели ИИ.

**Как работает функция**:
1. Использует сессию чата, инициализированную методом `_start_chat`.
2. Ведет журнал ошибок и возвращает текст ответа.

```
Использование сессии чата
↓
Ведение журнала ошибок
↓
Возврат текста ответа
```

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
ai._start_chat()
response = ai.chat("Как дела?")
print(response)
```

### `describe_image(self, image_path: Path) -> Optional[str]`

**Назначение**: Генерирует текстовое описание изображения.

**Параметры**:
- `self`: Ссылка на экземпляр класса.
- `image_path` (Path): Путь к изображению.

**Возвращает**:
- `Optional[str]`: Сгенерированное описание или `None` в случае ошибки.

**Как работает функция**:
1. Кодирует изображение в base64 и отправляет его модели ИИ.
2. Возвращает сгенерированное описание или ведет журнал ошибки, если операция не удалась.

```
Кодирование изображения в base64
↓
Отправка изображения модели ИИ
↓
Возврат сгенерированного описания или ведение журнала ошибки
```

**Примеры**:

```python
from pathlib import Path
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
image_path = Path("example.jpg")
response = ai.describe_image(image_path)
if response:
    print(response)
```

### `upload_file(self, file: str | Path | IOBase, file_name: Optional[str] = None) -> bool`

**Назначение**: Загружает файл в модель ИИ.

**Параметры**:
- `self`: Ссылка на экземпляр класса.
- `file` (str | Path | IOBase): Путь к файлу, объект Path или файловый объект.
- `file_name` (Optional[str], optional): Имя файла. По умолчанию `None`.

**Возвращает**:
- `bool`: `True`, если загрузка прошла успешно, `False` в противном случае.

**Как работает функция**:
1. Обрабатывает загрузку файла и ведет журнал успеха или неудачи.
2. Предоставляет логику повторных попыток в случае ошибок.

```
Обработка загрузки файла
↓
Ведение журнала успеха или неудачи
↓
Логика повторных попыток в случае ошибок
```

**Примеры**:

```python
from pathlib import Path
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
file_path = Path("example.txt")
result = ai.upload_file(file_path)
print(result)
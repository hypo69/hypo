# Документация для модуля `src.endpoints.bots.telegram`

## Обзор

Этот модуль содержит реализацию Telegram-бота. Бот выполняет различные функции, связанные с обработкой команд, голосовых сообщений и взаимодействием с пользователями в Telegram. Он предоставляет возможность отправки приветственных сообщений, помощи по командам, отправки PDF-файлов, транскрибирования голосовых сообщений и обработки текстовых документов.

## Подробнее

Этот модуль является частью проекта `hypotez` и отвечает за интеграцию Telegram-бота. Он использует библиотеку `python-telegram-bot` для создания и управления ботом. Модуль обрабатывает различные типы входящих сообщений, включая команды, текстовые сообщения, голосовые сообщения и документы. Основная цель бота - предоставить пользователю удобный способ взаимодействия с системой через Telegram.

## Содержание

1.  [Основные функции и команды бота](#основные-функции-и-команды-бота)
2.  [Основные модули и библиотеки](#основные-модули-и-библиотеки)
3.  [Классы и методы](#классы-и-методы)
    *   [Класс `TelegramBot`](#класс-telegrambot)
4.  [Главная функция](#главная-функция)

## Основные функции и команды бота:

1.  **Инициализация бота:**
    *   Бот инициализируется с токеном, который используется для аутентификации бота в Telegram API.

2.  **Команды:**
    *   `/start`: Отправляет приветственное сообщение пользователю.
    *   `/help`: Предоставляет список доступных команд.
    *   `/sendpdf`: Отправляет PDF-файл пользователю.

3.  **Обработка сообщений:**
    *   Бот обрабатывает входящие текстовые сообщения, голосовые сообщения и файлы документов.
    *   Для голосовых сообщений бот транскрибирует аудио (в настоящее время это функция-заполнитель).
    *   Для файлов документов бот считывает содержимое текстового документа.

4.  **Обработка голосовых сообщений:**
    *   Бот загружает файл голосового сообщения, сохраняет его локально и пытается транскрибировать его с помощью службы распознавания речи (в настоящее время это функция-заполнитель).

5.  **Обработка документов:**
    *   Бот загружает файл документа, сохраняет его локально и считывает содержимое текстового документа.

6.  **Обработка текстовых сообщений:**
    *   Бот просто возвращает текст, полученный от пользователя.

## Основные модули и библиотеки:

*   `python-telegram-bot`: Основная библиотека для создания Telegram-ботов.
*   `pathlib`: Для работы с путями к файлам.
*   `tempfile`: Для создания временных файлов.
*   `asyncio`: Для асинхронного выполнения задач.
*   `requests`: Для загрузки файлов.
*   `src.utils.convertors.tts`: Для распознавания речи и преобразования текста в речь.
*   `src.utils.file`: Для чтения текстовых файлов.

## Классы и методы

### Класс `TelegramBot`

**Описание**: Класс `TelegramBot` реализует логику Telegram-бота, обрабатывающего команды и сообщения от пользователей.

**Как работает класс**:

1.  **Инициализация**: При инициализации класса `TelegramBot` требуется передать токен, который используется для аутентификации бота в Telegram API.
2.  **Регистрация обработчиков**: В конструкторе вызывается метод `register_handlers`, который регистрирует обработчики для команд и сообщений. Это связывает определенные команды (например, `/start`, `/help`) и типы сообщений (текст, голос, документы) с соответствующими функциями-обработчиками.
3.  **Обработка команд**: Когда пользователь отправляет команду боту (например, `/start`), соответствующий обработчик вызывается автоматически. Обработчики команд подготавливают и отправляют ответы пользователю.
4.  **Обработка сообщений**: Когда пользователь отправляет сообщение боту (текст, голос, документ), соответствующий обработчик вызывается автоматически. Обработчики сообщений выполняют необходимые действия в зависимости от типа сообщения (например, транскрибируют голосовое сообщение, читают содержимое документа) и отправляют результат пользователю.

**Методы:**

*   `__init__(self, token: str)`: Инициализирует бота с токеном и регистрирует обработчики.
*   `register_handlers(self)`: Регистрирует обработчики команд и сообщений.
*   `start(self, update: Update, context: CallbackContext)`: Обрабатывает команду `/start`.
*   `help_command(self, update: Update, context: CallbackContext)`: Обрабатывает команду `/help`.
*   `send_pdf(self, pdf_file: str | Path)`: Обрабатывает команду `/sendpdf` для отправки PDF-файла.
*   `handle_voice(self, update: Update, context: CallbackContext)`: Обрабатывает голосовые сообщения и транскрибирует аудио.
*   `transcribe_voice(self, file_path: Path) -> str`: Транскрибирует голосовые сообщения (функция-заполнитель).
*   `handle_document(self, update: Update, context: CallbackContext) -> str`: Обрабатывает файлы документов и считывает их содержимое.
*   `handle_message(self, update: Update, context: CallbackContext) -> str`: Обрабатывает текстовые сообщения и возвращает полученный текст.

## Главная функция

*   **main()**: Инициализирует бота, регистрирует обработчики команд и сообщений и запускает бота с использованием `run_polling()`.
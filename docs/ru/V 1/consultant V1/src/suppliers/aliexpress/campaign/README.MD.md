# Анализ кода модуля `src.suppliers.aliexpress.campaign`

## Качество кода:
- **Соответствие стандартам**: 6
- **Плюсы**:
    - Документация содержит описание основных функций и процессов модуля.
    - Присутствуют mermaid-диаграммы для визуализации процессов.
    - Описаны шаги выполнения основных процессов.
- **Минусы**:
    - Документация написана в стиле RST, но не соответствует Pythonic-стилю (отсутствуют кавычки, комментарии, импорты)
    - Отсутствует подробное описание каждого метода и класса, а также примеры использования.
    - Нет явного описания ошибок и исключений, возникающих при работе модуля.
    - Нет четкой структуры документации, что затрудняет понимание.
    - Описание процесса подготовки кампании (prepare) не до конца ясно, не хватает деталей по каждому шагу.
    - Не хватает описания формата данных (JSON), с которым работает модуль.

## Рекомендации по улучшению:
- Переписать документацию в соответствии с требованиями, используя `j_loads` и `j_dumps` из `src.utils.jjson`, одинарные кавычки для строк в Python-коде и двойные кавычки только для операций вывода (`print`, `input`, `logger.error`).
- Добавить подробные комментарии в формате RST для всех функций, методов и классов, включая описания параметров, возвращаемых значений, исключений и примеры использования.
- Описать структуру JSON-файлов с данными.
- Уточнить описание процесса подготовки кампании, добавить деталей по каждому шагу.
- Переработать описание процессов и добавить больше подробностей.
- Привести mermaid-диаграммы в порядок, добавив описание шагов (например, через подписи узлов).
- Добавить примеры использования для основных функций и методов, используя `>>>` для интерактивных примеров.
- Добавить проверку типов для входных параметров.
- Использовать `logger` для обработки ошибок.
- Добавить описание параметров в markdown-списках, как в примере ниже:
```
- **file_path** (str | Path): Путь к файлу для сохранения.
- **data** (str | list[str] | dict): Данные для записи.
- **mode** (str, optional): Режим записи ('w' для записи, 'a' для добавления).
```

## Оптимизированный код:
```rst
.. module:: src.suppliers.aliexpress.campaign

==================================================
Модуль для управления рекламными кампаниями AliExpress
==================================================

Модуль предназначен для управления процессом создания и публикации рекламных кампаний на Facebook.
Он включает функциональность для инициализации параметров кампании (имя, язык, валюта), создания структуры каталогов,
сохранения конфигураций для новой кампании, сбора и сохранения данных о продуктах через `ali` или `html`,
генерации рекламных материалов, проверки кампании и ее публикации на Facebook.

Пример использования
----------------------
.. code-block:: python

   from src.suppliers.aliexpress.campaign import AliCampaignManager
   from pathlib import Path

   campaign_manager = AliCampaignManager()
   campaign_manager.create_campaign(
        campaign_name='summer_sale_2024',
        language='en',
        currency='usd',
        category_list=['shoes', 'bags']
    )
   # campaign_manager.prepare_campaign(campaign_name='summer_sale_2024')
   # ...

Инициализация и создание кампании
-----------------------------------

.. mermaid::

    flowchart TD
        A[Start: Создание рекламной кампании для размещения на Facebook] --> B[Инициализация: Имя, язык и валюта кампании]
        B --> C[Создание: Каталоги кампании и категорий]
        C --> D[Сохранение: Конфигурация кампании]
        D --> E[Сбор: Данные о продуктах]
        E --> F[Сохранение: Данные о продуктах]
        F --> G[Создание: Рекламные материалы]
        G --> H[Проверка: Кампания]
        H --> I{Кампания готова?}
        I -- Yes --> J[Публикация: Кампания на Facebook]
        I -- No --> H
        J --> K[End: Завершение создания рекламной кампании]

- **Шаг 1**: **Start** - Начало процесса создания рекламной кампании.
- **Шаг 2**: **Инициализация деталей кампании** - Определение имени, языка и валюты кампании.
  - **Пример**: Имя кампании: "Летняя распродажа", Язык: "Английский", Валюта: "USD".
- **Шаг 3**: **Создание каталогов кампании и категорий** - Создание необходимых каталогов или файлов для кампании.
  - **Пример**: Создание структуры папок в файловой системе для хранения ресурсов кампании.
- **Шаг 4**: **Сохранение конфигурации кампании** - Сохранение инициализированных данных кампании.
  - **Пример**: Запись данных в базу данных или файл конфигурации.
- **Шаг 5**: **Сбор данных о продуктах** - Сбор данных о продуктах, которые будут продвигаться в рамках кампании.
  - **Пример**: Получение идентификаторов продуктов, описаний, изображений и цен из системы инвентаризации.
- **Шаг 6**: **Сохранение данных о продуктах** - Сохранение собранных данных о продуктах.
  - **Пример**: Запись данных в таблицу базы данных, посвященную продуктам кампании.
- **Шаг 7**: **Создание рекламных материалов** - Генерация или выбор графики, баннеров и других рекламных ресурсов.
  - **Пример**: Адаптация изображений и описаний для привлечения клиентов.
- **Шаг 8**: **Проверка кампании** - Проверка готовности компонентов кампании.
  - **Пример**: Проверка человеком или системой качества и полноты всех компонентов кампании.
- **Шаг 9**: **Кампания готова?** - Проверка, завершена ли кампания и готова ли к публикации.
  - **Пример**: Логическое значение "Да", если все готово, иначе "Нет", что запускает возврат к предыдущему шагу для внесения исправлений.
- **Шаг 10**: **Публикация кампании** - Публикация кампании на платформе.
  - **Пример**: Выполнение вызовов API для публикации кампании на соответствующей платформе.
- **Шаг 11**: **End** - Завершение процесса создания кампании.


Редактирование кампании
-----------------------

.. mermaid::
    graph LR
        A[Ввод пользователя: campaign_name, language, currency] --> B{AliCampaignEditor.__init__};
        B --> C[AliPromoCampaign.__init__];
        C --> D[Инициализация: конструктор AliCampaignEditor];
        D --> E[AliCampaignEditor];

        E --> F[delete_product: Проверка наличия партнерской ссылки];
        F --> G[read_text_file sources.txt: Чтение списка продуктов];
        G --> H[Итерация и проверка product_id: Проход по списку продуктов];
        H -- Match --> I[remove & save: Удаление продукта, если найдено соответствие];
        H -- No Match --> J[rename product file: Переименование файла продукта, если нет соответствия];

        E --> K[update_product: Обновление деталей продукта];
        K --> L[Вызов dump_category_products_files: Обновление категории новым продуктом];

        E --> M[update_campaign: Обновление свойств кампании, например, описания];
        M --> N[Обновление параметров кампании];

        E --> O[update_category: Обновление категории в JSON файле];
        O --> P[j_loads JSON file: Чтение данных категории];
        P --> Q[Обновление категории: Обновление данных категории];
        Q --> R[j_dumps JSON file: Запись обновленной категории в файл];

        E --> S[get_category: Получение категории по имени];
        S --> T[Проверка наличия категории];
        T -- Found --> U[Возврат SimpleNamespace: Возврат деталей категории];
        T -- Not Found --> V[Лог предупреждения: Категория не найдена в кампании];

        E --> W[list_categories: Список всех категорий в кампании];
        W --> X[Проверка атрибута категории: Убедиться, что категории существуют в кампании];
        X -- Found --> Y[Возврат списка категорий: Список имен категорий];
        X -- Not Found --> Z[Лог предупреждения: Категории не найдены в кампании];

        E --> AA[get_category_products: Получение продуктов для категории];
        AA --> AB[Получение пути категории: Построение пути для продуктов категории];
        AB --> AC[Получение имен JSON файлов: Получение всех JSON файлов продуктов];
        AC --> AD[Чтение JSON файлов: Загрузка данных о продуктах];
        AD --> AE[Создание SimpleNamespace: Преобразование данных продуктов в объекты];
        AE --> AF[Возврат продуктов: Возврат списка продуктов];
        AC -- Нет JSON файлов --> AG[Лог ошибки: Файлы не найдены];
        AG --> AH[Обработка категории: Запуск подготовки продуктов категории];

        E --> AI[Другие методы];

- **Инициализация:**
    - **Входные параметры:** `campaign_name` (str), `language` (str), `currency` (str).
    - Создает экземпляр класса `AliCampaignEditor`, который управляет редактированием кампании.
    - Инициализирует данные для работы с кампаниями.
- **`delete_product`**:
    - **Входные параметры:** `product_id` (str).
    - Проверяет наличие партнерской ссылки.
    - Считывает список продуктов из файла `sources.txt`.
    - Итерируется по списку продуктов и, если `product_id` совпадает, удаляет продукт из списка и сохраняет изменения.
    - Если соответствия не найдено, переименовывает файл продукта.
- **`update_product`**:
    - **Входные параметры:** `product_data` (dict).
    - Обновляет данные о продукте.
    - Вызывает метод `dump_category_products_files` для обновления категории с новым продуктом.
- **`update_campaign`**:
    - **Входные параметры:** `campaign_data` (dict).
    - Обновляет свойства кампании, например, описание.
    - Обновляет параметры кампании.
- **`update_category`**:
    - **Входные параметры:** `category_name` (str), `category_data` (dict).
    - Обновляет категорию в JSON файле.
    - Читает данные категории из JSON файла с помощью `j_loads`.
    - Обновляет данные категории.
    - Записывает обновленные данные категории в файл с помощью `j_dumps`.
- **`get_category`**:
    - **Входные параметры:** `category_name` (str).
    - Получает категорию по имени.
    - Проверяет наличие категории.
    - Возвращает детали категории в виде объекта `SimpleNamespace`, если категория найдена.
    - Логирует предупреждение, если категория не найдена.
- **`list_categories`**:
    - **Входные параметры:** нет.
    - Получает список всех категорий в кампании.
    - Проверяет наличие категорий в кампании.
    - Возвращает список имен категорий, если категории найдены.
    - Логирует предупреждение, если категории не найдены.
- **`get_category_products`**:
    - **Входные параметры:** `category_name` (str).
    - Получает продукты для заданной категории.
    - Строит путь к файлам продуктов.
    - Получает список JSON файлов продуктов.
    - Загружает данные из JSON файлов с помощью `j_loads`.
    - Преобразует данные продуктов в объекты `SimpleNamespace`.
    - Возвращает список продуктов.
    - Логирует ошибку, если JSON файлы не найдены.
    - Запускает процесс подготовки продуктов для категории.

Подготовка кампании
--------------------

.. mermaid::
    flowchart TD
        A[Start] --> B{Обработка всех кампаний?}
        B -->|Yes| C[Обработка всех кампаний]
        B -->|No| D[Обработка конкретной кампании]

        C --> E{Предоставлены язык и валюта?}
        E -->|Yes| F[Обработка каждой кампании с указанным языком и валютой]
        E -->|No| G[Обработка всех локалей для каждой кампании]

        D --> H{Указаны категории?}
        H -->|Yes| I[Обработка конкретных категорий для кампании]
        H -->|No| J[Обработка всей кампании]

        F --> K[Обработка категории кампании]
        G --> L[Обработка кампании для всех локалей]
        I --> K
        J --> L

        K --> M[Return]
        L --> M

- **Начало**: Процесс запускается.
- **Обработка всех кампаний?**:
    - Если **Да**, то происходит обработка всех существующих кампаний.
    - Если **Нет**, то происходит обработка только конкретной кампании.
- **Предоставлены язык и валюта?**:
    - Если **Да**, то происходит обработка каждой кампании с указанным языком и валютой.
    - Если **Нет**, то происходит обработка всех локалей для каждой кампании.
- **Указаны категории?**:
    - Если **Да**, то происходит обработка только указанных категорий для конкретной кампании.
    - Если **Нет**, то происходит обработка всей кампании.
- **Обработка категории кампании**: Выполняется обработка конкретной категории для кампании.
- **Обработка кампании для всех локалей**: Выполняется обработка всей кампании для всех доступных локалей.
- **Завершение**: Процесс обработки кампании завершается.

```
# Документация модуля обработки продуктов

## Обзор

Модуль обрабатывает запросы на перевод списка продуктов с использованием модели. Он включает в себя логику обработки ответов от модели, проверки данных и извлечения необходимых результатов. Основные этапы включают проверку на отсутствие ответа, валидность данных, форматирование полученных данных в список и извлечение перевода на русском и иврите.

## Оглавление

- [Обзор](#обзор)
- [Логика работы](#логика-работы)
- [Диаграмма состояний](#диаграмма-состояний)

## Логика работы

Модуль работает следующим образом:

1.  **Принимает запрос:** Получает список продуктов для перевода.
2.  **Отправляет запрос модели:** Отправляет запрос на перевод списка продуктов с использованием выбранной модели.
3.  **Получает ответ от модели:** Получает ответ от модели в виде данных.
4.  **Обрабатывает ответ:**
    *   Проверяет, был ли получен ответ от модели. Если нет, то логирует ошибку и повторяет запрос.
    *   Проверяет валидность данных ответа. Если данные невалидны, то логирует ошибку и повторяет запрос.
    *   Проверяет структуру данных и извлекает перевод на русский и иврит.
    *   Возвращает результат.
5.  **Возвращает результат:** Возвращает перевод на русский и иврит для каждого продукта.

## Диаграмма состояний

```mermaid
flowchart TD
    A[Запрос на обработку продуктов products_list] --> B[Обработка запроса с командой модели]
    B --> C[Ответ от модели]
    
    %% Проверка на отсутствие ответа
    C -->|Нет ответа| D[Логирование ошибки no response from gemini]
    D --> E[Повторный запрос /attempts - 1/]

    %% Проверка на валидность данных
    C -->|Невалидные данные| F[Логирование ошибки /Error in data from gemini/]
    F --> E

    %% Проверка на полученные данные
    C -->|Получены данные| G{Данные в виде списка?}
    G -->|Да| H{Содержит два элемента /ru, he/?}
    H -->|Да| I[Извлечение ru и he]
    H -->|Нет| J[Извлечение ru и he из первого элемента]
    H -->|Невалидная структура| K[Логирование ошибки /Проблема парсинга ответа/]
    K --> E

    G -->|Нет| L{Данные в виде объекта?}
    L -->|Да| M[Извлечение ru и he из объекта]
    L -->|Нет| N[Логирование ошибки /Invalid ru or he data/]
    N --> E

    %% Возврат результата
    M --> O[Возврат результата ru и he]
    I --> O
    J --> O
```
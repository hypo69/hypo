# Модуль логгера

## Обзор

Модуль `src.logger.logger` предназначен для реализации гибкой системы логирования в проекте `hypotez`. Он предоставляет класс `Logger`, который реализует паттерн Singleton, обеспечивая единую точку доступа к экземпляру логгера. Модуль поддерживает логирование в консоль, в файлы различных уровней (info, debug, errors) и в JSON-формате. Также реализована возможность цветового выделения сообщений в консоли.

## Подробнее

Модуль `src.logger.logger` предоставляет централизованный механизм логирования, который позволяет записывать сообщения разного уровня важности в различные источники (консоль, файлы). Это упрощает отладку и мониторинг работы приложения. Класс `Logger` использует паттерн Singleton, что гарантирует наличие только одного экземпляра логгера в системе. В модуле реализована поддержка цветового выделения сообщений в консоли для улучшения читаемости.

## Классы

### `SingletonMeta`

**Описание**: Метакласс для реализации паттерна Singleton.
    
**Принцип работы**:
Метакласс `SingletonMeta` используется для создания классов, которые должны иметь только один экземпляр. Он переопределяет метод `__call__`, чтобы при каждом вызове класса возвращать существующий экземпляр, если он уже создан, или создавать новый, если экземпляр еще не существует. Для обеспечения потокобезопасности используется блокировка `threading.Lock()`.

**Аттрибуты**:

- `_instances (dict)`: Словарь для хранения экземпляров классов, использующих данный метакласс.
- `_lock (threading.Lock)`: Объект блокировки для обеспечения потокобезопасности при создании экземпляров.

**Методы**:

- `__call__(cls, *args, **kwargs)`: Обеспечивает создание только одного экземпляра класса. Если экземпляр уже существует, он возвращается; в противном случае создается новый экземпляр.

### `JsonFormatter`

**Описание**: Класс, предназначенный для форматирования записей лога в формат JSON.
    
**Наследует**:
- `logging.Formatter`: Наследует от стандартного класса `logging.Formatter` для форматирования записей лога.

**Методы**:

- `format(self, record)`: Форматирует запись лога в JSON-формат.
    - **Параметры**:
        - `record (logging.LogRecord)`: Запись лога, которую необходимо отформатировать.
    - **Возвращает**:
        - `str`: JSON-представление записи лога.
    - **Как работает функция**:
        1. Извлекает из `record` необходимые атрибуты, такие как время создания, уровень логирования и сообщение.
        2. Форматирует сообщение, заменяя двойные кавычки на одинарные для корректного отображения в JSON.
        3. Преобразует информацию об исключении, если она присутствует.
        4. Формирует словарь с данными лога и преобразует его в JSON-строку с помощью `json.dumps`.

     **Примеры**:
     ```python
     formatter = JsonFormatter()
     record = logging.LogRecord(name='test', level=logging.INFO, pathname='test.py', lineno=1, msg='Test message', args=(), exc_info=None)
     json_string = formatter.format(record)
     print(json_string)
     ```

### `Logger`

**Описание**: Класс логгера, реализующий паттерн Singleton с поддержкой логирования в консоль, файлы и JSON.

**Принцип работы**:
Класс `Logger` реализует паттерн Singleton, обеспечивая единую точку доступа к экземпляру логгера. Он настраивает несколько логгеров для записи сообщений в консоль, файлы различных уровней (info, debug, errors) и в JSON-формате. Поддерживается цветовое выделение сообщений в консоли.

**Атрибуты**:

- `log_files_path (Path)`: Путь к директории, где хранятся файлы логов.
- `info_log_path (Path)`: Путь к файлу лога с информацией.
- `debug_log_path (Path)`: Путь к файлу лога с отладочной информацией.
- `errors_log_path (Path)`: Путь к файлу лога с ошибками.
- `json_log_path (Path)`: Путь к файлу лога в формате JSON.
- `logger_console (logging.Logger)`: Логгер для вывода сообщений в консоль.
- `logger_file_info (logging.Logger)`: Логгер для записи информационных сообщений в файл.
- `logger_file_debug (logging.Logger)`: Логгер для записи отладочных сообщений в файл.
- `logger_file_errors (logging.Logger)`: Логгер для записи сообщений об ошибках в файл.
- `logger_file_json (logging.Logger)`: Логгер для записи сообщений в JSON-файл.

**Методы**:

- `__init__(self, info_log_path: Optional[str] = None, debug_log_path: Optional[str] = None, errors_log_path: Optional[str] = None, json_log_path: Optional[str] = None)`: Инициализирует экземпляр логгера.
    - **Параметры**:
        - `info_log_path (Optional[str], optional)`: Путь к файлу лога с информацией. По умолчанию `None`.
        - `debug_log_path (Optional[str], optional)`: Путь к файлу лога с отладочной информацией. По умолчанию `None`.
        - `errors_log_path (Optional[str], optional)`: Путь к файлу лога с ошибками. По умолчанию `None`.
        - `json_log_path (Optional[str], optional)`: Путь к файлу лога в формате JSON. По умолчанию `None`.

    - **Как работает функция**:
        1.  **Определение путей к файлам логов**:
            - Загружает конфигурацию из файла `config.json`, расположенного в каталоге `src`.
            - Формирует метку времени на основе текущей даты и времени.
            - Определяет базовый путь для хранения логов, используя путь, указанный в конфигурационном файле.
            - Создает пути к файлам логов различных уровней (info, debug, errors) и JSON-файлу.
        2.  **Создание директорий и файлов логов**:
            - Создает директорию для хранения логов, если она не существует.
            - Создает файлы логов, если они не существуют.
        3.  **Настройка логгеров**:
            - Создает логгеры для консоли и файлов.
            - Устанавливает уровень логирования для каждого логгера.
            - Настраивает обработчики (handlers) для записи сообщений в файлы.
            - Устанавливает форматтеры для форматирования сообщений.
        4.  **Удаление обработчиков консоли для JSON-логгера**:
            - Удаляет все обработчики, которые выводят сообщения в консоль, чтобы избежать дублирования записей.

- `_format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None)`: Форматирует сообщение лога с учетом уровня логирования, цвета и информации об исключении.
    - **Параметры**:
        - `message (str)`: Сообщение лога.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `color (Optional[Tuple[str, str]], optional)`: Кортеж, содержащий цвет текста и фона. По умолчанию `None`.
        - `level (int, optional)`: Уровень логирования. По умолчанию `None`.

    - **Возвращает**:
        - `str`: Отформатированное сообщение лога.
    - **Как работает функция**:
        1.  **Определение символа лога**:
            - Получает символ лога на основе уровня логирования из словаря `LOG_SYMBOLS`.
        2.  **Форматирование сообщения с цветом**:
            - Если указаны цвета текста и фона, извлекает их из словарей `TEXT_COLORS` и `BG_COLORS`.
            - Форматирует сообщение, добавляя символ лога, цвета текста и фона, сообщение и информацию об исключении.
        3.  **Форматирование сообщения без цвета**:
            - Если цвета не указаны, форматирует сообщение, добавляя символ лога, сообщение и информацию об исключении.

- `_ex_full_info(self, ex)`: Возвращает полную информацию об исключении, включая имя файла, имя функции и номер строки, где произошло исключение.
    - **Параметры**:
        - `ex (Exception)`: Объект исключения.
    - **Возвращает**:
        - `str`: Полная информация об исключении.
    - **Как работает функция**:
        1.  **Получение информации о кадре стека**:
            - Извлекает информацию о кадре стека, вызвавшего исключение, с помощью `inspect.stack()`.
        2.  **Извлечение имени файла, имени функции и номера строки**:
            - Извлекает имя файла, имя функции и номер строки из информации о кадре стека.
        3.  **Форматирование информации об исключении**:
            - Форматирует информацию об исключении, включая имя файла, имя функции, номер строки и сообщение об исключении.

- `log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None)`: Общий метод для логирования сообщений на указанном уровне с возможностью указания цвета.
    - **Параметры**:
        - `level (int)`: Уровень логирования (например, `logging.INFO`, `logging.ERROR`).
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
        - `color (Optional[Tuple[str, str]], optional)`: Кортеж, содержащий цвет текста и фона. По умолчанию `None`.
    - **Как работает функция**:
        1.  **Форматирование сообщения**:
            - Форматирует сообщение с использованием метода `_format_message`, добавляя информацию об уровне логирования, исключении и цвете.
        2.  **Логирование сообщения**:
            - Если включена информация об исключении и объект исключения существует, логирует сообщение с использованием метода `exception` логгера консоли.
            - В противном случае логирует сообщение с использованием метода `log` логгера консоли.

- `info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = "")`: Логирует информационное сообщение с возможностью указания цвета текста и фона.
    - **Параметры**:
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
        - `text_color (str, optional)`: Цвет текста. По умолчанию `"green"`.
        - `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

- `success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = "")`: Логирует сообщение об успехе с возможностью указания цвета текста и фона.
    - **Параметры**:
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
        - `text_color (str, optional)`: Цвет текста. По умолчанию `"yellow"`.
        - `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

- `warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = "")`: Логирует предупреждающее сообщение с возможностью указания цвета текста и фона.
    - **Параметры**:
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
        - `text_color (str, optional)`: Цвет текста. По умолчанию `"light_red"`.
        - `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

- `debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "")`: Логирует отладочное сообщение с возможностью указания цвета текста и фона.
    - **Параметры**:
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
        - `text_color (str, optional)`: Цвет текста. По умолчанию `"cyan"`.
        - `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

- `exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray")`: Логирует сообщение об исключении с возможностью указания цвета текста и фона.
    - **Параметры**:
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
        - `text_color (str, optional)`: Цвет текста. По умолчанию `"cyan"`.
        - `bg_color (str, optional)`: Цвет фона. По умолчанию `"light_gray"`.

- `error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "")`: Логирует сообщение об ошибке с возможностью указания цвета текста и фона.
    - **Параметры**:
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
        - `text_color (str, optional)`: Цвет текста. По умолчанию `"red"`.
        - `bg_color (str, optional)`: Цвет фона. По умолчанию `""`.

- `critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white")`: Логирует критическое сообщение с возможностью указания цвета текста и фона.
    - **Параметры**:
        - `message (str)`: Сообщение для логирования.
        - `ex (Exception, optional)`: Объект исключения. По умолчанию `None`.
        - `exc_info (bool, optional)`: Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
        - `text_color (str, optional)`: Цвет текста. По умолчанию `"red"`.
        - `bg_color (str, optional)`: Цвет фона. По умолчанию `"white"`.
      
   **Примеры**:
   ```python
   from src.logger.logger import logger
   try:
       x = 1 / 0
   except Exception as ex:
       logger.error('Division by zero', ex, exc_info=True)
   ```
     
## Функции

### `_format_message`

```python
def _format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None):
    """
    Возвращает отформатированное сообщение с дополнительной информацией об исключении и цветом.
    Args:
        message: str
        ex: None
        color: Optional[Tuple[str, str]]
        level: None
    """
    ...
```

**Назначение**: Форматирует сообщение лога с учетом уровня логирования, цвета и информации об исключении.

**Параметры**:
- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `color` (Optional[Tuple[str, str]], optional): Кортеж, содержащий цвет текста и фона. По умолчанию `None`.
- `level` (int, optional): Уровень логирования. По умолчанию `None`.

**Возвращает**:
- `str`: Отформатированное сообщение лога.

**Как работает функция**:
1. **Определение символа лога**:
   - Получает символ лога на основе уровня логирования из словаря `LOG_SYMBOLS`.
2. **Форматирование сообщения с цветом**:
   - Если указаны цвета текста и фона, извлекает их из словарей `TEXT_COLORS` и `BG_COLORS`.
   - Форматирует сообщение, добавляя символ лога, цвета текста и фона, сообщение и информацию об исключении.
3. **Форматирование сообщения без цвета**:
   - Если цвета не указаны, форматирует сообщение, добавляя символ лога, сообщение и информацию об исключении.

### `_ex_full_info`

```python
def _ex_full_info(self, ex):
    """
    Returns full exception information along with the previous function, file, and line details.
    Args:
        ex: Exception
    """
    ...
```

**Назначение**: Возвращает полную информацию об исключении, включая имя файла, имя функции и номер строки, где произошло исключение.

**Параметры**:
- `ex` (Exception): Объект исключения.

**Возвращает**:
- `str`: Полная информация об исключении.

**Как работает функция**:
1. **Получение информации о кадре стека**:
   - Извлекает информацию о кадре стека, вызвавшего исключение, с помощью `inspect.stack()`.
2. **Извлечение имени файла, имени функции и номера строки**:
   - Извлекает имя файла, имя функции и номер строки из информации о кадре стека.
3. **Форматирование информации об исключении**:
   - Форматирует информацию об исключении, включая имя файла, имя функции, номер строки и сообщение об исключении.

### `log`

```python
def log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None):
    """
    General method to log messages at specified level with optional color.
    Args:
        level: 
        message: 
        ex: 
        exc_info: 
        color: Optional[Tuple[str, str]]
    """
    ...
```

**Назначение**: Общий метод для логирования сообщений на указанном уровне с возможностью указания цвета.

**Параметры**:
- `level` (int): Уровень логирования (например, `logging.INFO`, `logging.ERROR`).
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `color` (Optional[Tuple[str, str]], optional): Кортеж, содержащий цвет текста и фона. По умолчанию `None`.

**Как работает функция**:
1. **Форматирование сообщения**:
   - Форматирует сообщение с использованием метода `_format_message`, добавляя информацию об уровне логирования, исключении и цвете.
2. **Логирование сообщения**:
   - Если включена информация об исключении и объект исключения существует, логирует сообщение с использованием метода `exception` логгера консоли.
   - В противном случае логирует сообщение с использованием метода `log` логгера консоли.

### `info`

```python
def info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = ""):
    """
    Logs an info message with optional text and background colors.
    Args:
        message: 
        ex: 
        exc_info: 
        text_color: str
        bg_color: str
    """
    ...
```

**Назначение**: Логирует информационное сообщение с возможностью указания цвета текста и фона.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"green"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

### `success`

```python
def success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = ""):
    """
    Logs a success message with optional text and background colors.
    Args:
        message: 
        ex: 
        exc_info: 
        text_color: str
        bg_color: str
    """
    ...
```

**Назначение**: Логирует сообщение об успехе с возможностью указания цвета текста и фона.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"yellow"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

### `warning`

```python
def warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = ""):
    """
    Logs a warning message with optional text and background colors.
    Args:
        message: 
        ex: 
        exc_info: 
        text_color: str
        bg_color: str
    """
    ...
```

**Назначение**: Логирует предупреждающее сообщение с возможностью указания цвета текста и фона.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"light_red"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

### `debug`

```python
def debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = ""):
    """
    Logs a debug message with optional text and background colors.
    Args:
        message: 
        ex: 
        exc_info: 
        text_color: str
        bg_color: str
    """
    ...
```

**Назначение**: Логирует отладочное сообщение с возможностью указания цвета текста и фона.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"cyan"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

### `exception`

```python
def exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray"):
    """
    Logs an exception message with optional text and background colors.
    Args:
        message: 
        ex: 
        exc_info: 
        text_color: str
        bg_color: str
    """
    ...
```

**Назначение**: Логирует сообщение об исключении с возможностью указания цвета текста и фона.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"cyan"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `"light_gray"`.

### `error`

```python
def error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = ""):
    """
    Logs an error message with optional text and background colors.
    Args:
        message: 
        ex: 
        exc_info: 
        text_color: str
        bg_color: str
    """
    ...
```

**Назначение**: Логирует сообщение об ошибке с возможностью указания цвета текста и фона.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"red"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

### `critical`

```python
def critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white"):
    """
    Logs a critical message with optional text and background colors.
    Args:
        message: 
        ex: 
        exc_info: 
        text_color: str
        bg_color: str
    """
    ...
```

**Назначение**: Логирует критическое сообщение с возможностью указания цвета текста и фона.

**Параметры**:
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли включать информацию об исключении в лог. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"red"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `"white"`.
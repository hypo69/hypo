# Модуль `graber.py`

## Обзор

Модуль предназначен для сбора информации о товарах с сайта `ivory.co.il`. Он расширяет функциональность базового класса `Graber` и адаптирует ее для специфических требований `ivory.co.il`. В модуле реализована возможность переопределения функций обработки полей товара для нестандартных случаев. Также, предусмотрена возможность выполнения предварительных действий перед отправкой запросов к веб-драйверу с использованием декораторов.

## Подробней

Модуль `graber.py` является частью проекта `hypotez` и отвечает за сбор данных о товарах с сайта `ivory.co.il`. Он наследует класс `Graber` из модуля `src.suppliers.graber`, расширяя его функциональность для конкретного поставщика. Основная задача модуля - извлечение информации о товарах и их характеристиках со страниц `ivory.co.il` с использованием веб-драйвера.

В модуле предусмотрена возможность переопределения функций обработки полей товара, если стандартные методы не подходят. Это позволяет адаптировать процесс сбора данных под особенности структуры страниц `ivory.co.il`.

Для выполнения предварительных действий перед отправкой запросов к веб-драйверу можно использовать декораторы. Декоратор по умолчанию находится в родительском классе. Чтобы декоратор сработал, необходимо передать значение в `Context.locator`. Также, можно переопределить поведение декоратора, раскомментировав соответствующие строки кода.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для операций захвата данных о товарах с сайта `ivory.co.il`.

**Наследует**:
- `Graber` из модуля `src.suppliers.graber`.

**Атрибуты**:
- `supplier_prefix` (str): Префикс поставщика, используется для идентификации поставщика в системе.

**Методы**:
- `__init__(driver: Driver, lang_index)`: Инициализирует экземпляр класса `Graber`.

#### `__init__`

```python
def __init__(driver: Driver, lang_index):
    """Инициализация класса сбора полей товара."""
    ...
```

**Назначение**: Инициализирует класс `Graber`, устанавливает префикс поставщика и вызывает конструктор родительского класса.

**Параметры**:
- `driver` (Driver): Экземпляр веб-драйвера для взаимодействия с сайтом.
- `lang_index` (int): Индекс языка, используемого на сайте.

**Как работает функция**:
1. Устанавливает атрибут `supplier_prefix` равным `'ivory'`.
2. Вызывает конструктор родительского класса `Graber` с установленным префиксом поставщика, драйвером и индексом языка.
3. Устанавливает `Context.locator_for_decorator` в `None`.

```ascii
Инициализация
|
Установка supplier_prefix = 'ivory'
|
Вызов конструктора Graber (родительского класса)
|
Установка Context.locator_for_decorator = None
```

**Примеры**:
```python
from src.webdriver.driver import Driver
from src.webdriver import Firefox

driver = Driver(Firefox)
lang_index = 0
graber = Graber(driver, lang_index)
```
## Функции

### `close_pop_up`

```python
def close_pop_up(value: Any = None):
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции."""
    ...
```

**Назначение**: Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

**Параметры**:
- `value` (Any, optional): Дополнительное значение для декоратора. По умолчанию `None`.

**Возвращает**:
- Callable: Декоратор, который оборачивает функцию.

**Как работает функция**:
1. Определяет внутреннюю функцию `decorator`, которая принимает функцию `func` в качестве аргумента.
2. Внутри `decorator` определяется асинхронная функция `wrapper`, которая выполняет следующие действия:
   - Пытается выполнить локатор для закрытия всплывающего окна, используя `Context.driver.execute_locator(Context.locator.close_pop_up)`.
   - Ловит исключение `ExecuteLocatorException` и логирует его с уровнем `DEBUG`.
   - Вызывает основную функцию `func` с переданными аргументами и возвращает результат.
3. Возвращает функцию `decorator`.

```ascii
Создание декоратора close_pop_up
|
Определение decorator(func)
|
   Определение wrapper(*args, **kwargs)
   |
   Попытка закрытия всплывающего окна: driver.execute_locator(Context.locator.close_pop_up)
   |
   Обработка исключения ExecuteLocatorException (логирование)
   |
   Вызов основной функции func(*args, **kwargs)
|
Возврат decorator
```

**Примеры**:

Пример использования декоратора:
```python
# from src.suppliers.graber import Graber as Grbr, Context, close_pop_up
# from src.webdriver.driver import Driver
# from src.webdriver import Firefox
#
# class MyGraber(Grbr):
#     supplier_prefix: str
#
#     def __init__(self, driver: Driver, lang_index):
#         self.supplier_prefix = 'my_supplier'
#         super().__init__(supplier_prefix=self.supplier_prefix, driver=driver, lang_index=lang_index)
#         Context.locator_for_decorator = None
#
#     @close_pop_up()
#     async def my_function(self, arg1, arg2):
#         #  какая-то логика
#         return f"Result: {arg1}, {arg2}"
#
# driver = Driver(Firefox)
# graber = MyGraber(driver, 0)
#
# #  вызов функции
# result = graber.my_function("value1", "value2")
# print(result)
# Модуль EasyChat

## Обзор

Модуль `EasyChat` предоставляет класс `EasyChat`, который является провайдером для работы с сервисом `free.easychat.work`. Он позволяет создавать запросы к API этого сервиса для получения ответов от языковой модели. Поддерживается потоковая передача данных и модель `gpt-35-turbo`.

## Подробнее

Модуль предназначен для интеграции с сервисом `free.easychat.work` и предоставляет удобный интерфейс для отправки запросов и получения ответов. Он использует библиотеку `requests` для выполнения HTTP-запросов и `json` для обработки данных в формате JSON.

## Классы

### `EasyChat(AbstractProvider)`

**Описание**: Класс `EasyChat` является провайдером для работы с сервисом `free.easychat.work`.

**Наследует**:
- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для провайдеров.

**Атрибуты**:
- `url` (str): URL сервиса `free.easychat.work`.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (значение `True`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-35-turbo` (значение `True`).
- `working` (bool): Указывает, работает ли в данный момент провайдер (значение `False`).

### Методы:

- `create_completion(model: str, messages: list[dict[str, str]], stream: bool, **kwargs: Any) -> CreateResult`

## Функции

### `create_completion`

```python
    @staticmethod
    def create_completion(
        model: str,
        messages: list[dict[str, str]],
        stream: bool, **kwargs: Any) -> CreateResult:
        """
        Создает запрос к API сервиса EasyChat и возвращает результат.

        Args:
            model (str): Идентификатор модели, используемой для генерации ответа.
            messages (list[dict[str, str]]): Список сообщений, отправляемых в запросе.
            stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
            **kwargs (Any): Дополнительные параметры запроса.

        Returns:
            CreateResult: Результат выполнения запроса.

        Raises:
            Exception: Если возникает ошибка при выполнении запроса.

        Example:
            >>> EasyChat.create_completion(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}], stream=False)
            <generator object AbstractProvider.create_completion at 0x...>
        """
```

**Назначение**: Создает запрос к API сервиса `EasyChat` и возвращает результат.

**Параметры**:
- `model` (str): Идентификатор модели, используемой для генерации ответа.
- `messages` (list[dict[str, str]]): Список сообщений, отправляемых в запросе.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
- `**kwargs` (Any): Дополнительные параметры запроса.

**Возвращает**:
- `CreateResult`: Результат выполнения запроса.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при выполнении запроса.

**Как работает функция**:
1. Определяется список активных серверов для отправки запросов.
2. Выбирается случайный сервер из списка активных серверов или используется переданный в `kwargs` параметр `active_server`.
3. Формируются заголовки запроса, включающие информацию о сервере, типе контента, User-Agent и другие параметры.
4. Формируется тело запроса в формате JSON, включающее сообщения, модель, параметры температуры, штрафы и другие параметры.
5. Создается сессия `requests.Session()` и выполняется GET-запрос для инициализации cookies.
6. Выполняется POST-запрос к API сервиса с использованием сформированных заголовков и тела запроса.
7. Если `response.status_code` не равен 200, вызывается исключение с информацией об ошибке.
8. Если `stream` равен `False`, то есть не используется потоковая передача данных:
   - Результат запроса преобразуется из JSON.
   - Если в результате есть ключ `choices`, то возвращается содержимое первого сообщения.
   - Иначе вызывается исключение "No response from server".
9. Если `stream` равен `True`, то есть используется потоковая передача данных:
   - Итерируется по каждой строке в ответе.
   - Если в строке есть `b"content"`, то строка декодируется, разделяется по `data:`, и если длина результата больше 1, то возвращается содержимое `content` из JSON.

**Примеры**:

```python
# Пример вызова функции create_completion с минимальным набором параметров
EasyChat.create_completion(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}], stream=False)

# Пример вызова функции create_completion с потоковой передачей данных
EasyChat.create_completion(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}], stream=True)

# Пример вызова функции create_completion с дополнительными параметрами
EasyChat.create_completion(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}], stream=False, temperature=0.7, top_p=0.9)
```
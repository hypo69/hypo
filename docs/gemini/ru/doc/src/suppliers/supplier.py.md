# Модуль `supplier.py`

## Обзор

Модуль `supplier.py` описывает базовый класс `Supplier`, предназначенный для унификации взаимодействия с различными поставщиками в проекте `hypotez`. Он обеспечивает абстракцию доступа к данным от различных поставщиков, упрощая процесс сбора и обработки информации. Модуль включает функциональность для загрузки связанных модулей поставщика и управления сценариями.

## Подробнее

Этот модуль является ключевым компонентом системы, обеспечивающим абстракцию и унификацию взаимодействия с различными поставщиками.
Класс `Supplier` предназначен для:
 - Запуска сценариев сбора данных.
 - Управления локаторами элементов страницы.
 - Взаимодействия с веб-драйвером.
Модуль расположен в директории `src/suppliers/` и играет важную роль в организации работы с поставщиками данных. Он использует другие модули, такие как `src.utils.jjson`, `src.webdriver.driver`, `src.scenario` и `src.logger`, для выполнения своих задач.

## Классы

### `Supplier`

**Описание**: Класс `Supplier` предназначен для представления и управления поставщиками данных. Он отвечает за запуск сценариев сбора данных, управление локаторами элементов страницы и взаимодействие с веб-драйвером.

**Принцип работы**:
Класс инициализируется с данными о поставщике, такими как идентификатор, префикс, локаль и список файлов сценариев. В процессе инициализации загружаются связанные модули поставщика и настраивается веб-драйвер. Основная задача класса - выполнение сценариев сбора данных с использованием веб-драйвера и предоставление унифицированного интерфейса для работы с различными поставщиками.

**Аттрибуты**:
- `supplier_id` (Optional[int]): Идентификатор поставщика.
- `supplier_prefix` (str): Префикс поставщика.
- `locale` (str): Код локали в формате ISO 639-1.
- `price_rule` (Optional[str]): Правило расчета цен.
- `related_modules` (Optional[ModuleType]): Функции, относящиеся к каждому поставщику.
- `scenario_files` (List[str]): Список файлов сценариев для выполнения.
- `current_scenario` (Dict[str, Any]): Текущий исполняемый сценарий.
- `locators` (Dict[str, Any]): Локаторы для элементов страницы.
- `driver` (Optional[Driver]): Веб-драйвер.

**Методы**:
- `__init__(self, **data)`: Инициализация поставщика и загрузка конфигурации.
- `_payload(self) -> bool`: Загрузка параметров поставщика.
- `login(self) -> bool`: Выполняет вход на сайт поставщика.
- `run_scenario_files(self, scenario_files: Optional[str  |  List[str]] = None) -> bool`: Выполнение одного или нескольких файлов сценариев.
- `run_scenarios(self, scenarios: dict  |  List[dict]) -> bool`: Выполнение списка или одного сценария.

### `Config`

**Описание**: Внутренний класс `Config` используется для настройки модели `Supplier` с помощью Pydantic.

**Аттрибуты**:
- `arbitrary_types_allowed` (bool): Разрешает использование произвольных типов.

### `check_supplier_prefix`

**Описание**: Валидатор `check_supplier_prefix`, проверяющий, что префикс поставщика не является пустым.

**Параметры**:
- `cls` (cls): Ссылка на класс.
- `value` (str): Префикс поставщика.

## Функции

### `__init__`

```python
    def __init__(self, **data):
        """Инициализация поставщика, загрузка конфигурации."""
```

**Назначение**: Инициализирует экземпляр класса `Supplier`.

**Параметры**:
- `**data`: Произвольные аргументы, передаваемые в конструктор класса.

**Как работает функция**:

1.  Вызывает конструктор базового класса `BaseModel` для инициализации атрибутов модели.
2.  Вызывает метод `_payload()` для загрузки параметров поставщика.
3.  Если загрузка параметров не удалась, вызывает исключение `DefaultSettingsException`.

```
Инициализация -> Вызов _payload() -> Проверка результата -> Вызов исключения (если ошибка)
```

**Примеры**:
```python
supplier = Supplier(supplier_prefix='example', locale='ru')
```

### `_payload`

```python
    def _payload(self) -> bool:
        """Загрузка параметров поставщика с использованием `j_loads_ns`."""
```

**Назначение**: Загружает параметры поставщика, такие как идентификатор, префикс и локаль.

**Возвращает**:
- `bool`: Возвращает `True`, если загрузка выполнена успешно, и `False` в случае ошибки.

**Как работает функция**:

1.  Логирует начало загрузки настроек для поставщика.
2.  Импортирует модуль, связанный с конкретным поставщиком, используя `importlib.import_module`.
3.  Если модуль не найден, логирует ошибку и возвращает `False`.
    
```
Начало -> Логирование загрузки -> Импорт модуля -> Обработка исключения (если ошибка) -> Конец
```

**Примеры**:
```python
result = supplier._payload()
```

### `login`

```python
    def login(self) -> bool:
        """Выполняет вход на сайт поставщика."""
```

**Назначение**: Выполняет вход на сайт поставщика, используя логику, определенную в связанном модуле поставщика.

**Возвращает**:
- `bool`: Возвращает `True`, если вход выполнен успешно, и `False` в случае ошибки.

**Как работает функция**:

1.  Вызывает функцию `login` из связанного модуля поставщика (`self.related_modules.login`).
2.  Возвращает результат выполнения функции `login`.

```
Вызов login из related_modules -> Возврат результата
```

**Примеры**:
```python
is_logged_in = supplier.login()
```

### `run_scenario_files`

```python
    def run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool:
        """Выполнение одного или нескольких файлов сценариев."""
```

**Назначение**: Выполняет один или несколько файлов сценариев.

**Параметры**:
- `scenario_files` (Optional[str | List[str]]): Список файлов сценариев. Если не указан, берется из `self.scenario_files`.

**Возвращает**:
- `bool`: Возвращает `True`, если все сценарии успешно выполнены, и `False` в случае ошибки.

**Как работает функция**:

1.  Определяет, какие файлы сценариев следует использовать. Если `scenario_files` передан как аргумент, использует его. В противном случае использует `self.scenario_files`.
2.  Вызывает функцию `run_scenario_files` из модуля `src.scenario` для выполнения сценариев.
3.  Возвращает результат выполнения функции `run_scenario_files`.

```
Определение файлов сценариев -> Вызов run_scenario_files -> Возврат результата
```

**Примеры**:
```python
success = supplier.run_scenario_files(['scenario1.json', 'scenario2.json'])
```

### `run_scenarios`

```python
    def run_scenarios(self, scenarios: dict | List[dict]) -> bool:
        """Выполнение списка или одного сценария."""
```

**Назначение**: Выполняет один или несколько сценариев, переданных в виде словаря или списка словарей.

**Параметры**:
- `scenarios` (dict | List[dict]): Сценарий или список сценариев для выполнения.

**Возвращает**:
- `bool`: Возвращает `True`, если сценарий успешно выполнен, и `False` в случае ошибки.

**Как работает функция**:

1.  Вызывает функцию `run_scenarios` из модуля `src.scenario` для выполнения сценариев.
2.  Возвращает результат выполнения функции `run_scenarios`.

```
Вызов run_scenarios -> Возврат результата
```

**Примеры**:
```python
success = supplier.run_scenarios([{'name': 'scenario1'}, {'name': 'scenario2'}])
# Модуль интеграции Google Generative AI

## Обзор

Класс `GoogleGenerativeAI` предназначен для взаимодействия с моделями Google Generative AI. Этот класс предоставляет методы для отправки запросов, обработки ответов, управления диалогами и интеграции с различными функциональностями ИИ. Он включает в себя надежную обработку ошибок, ведение журнала и настройки конфигурации для обеспечения беспрепятственной работы.

## Подробнее

Модуль `GoogleGenerativeAI` предоставляет интерфейс для работы с моделями Google Generative AI. Он позволяет отправлять текстовые запросы, вести диалоги, описывать изображения и загружать файлы. Класс `GoogleGenerativeAI` обрабатывает ошибки, ведет журнал всех взаимодействий и сохраняет историю диалогов для последующего анализа.

## Классы

### `GoogleGenerativeAI`

**Описание**: Класс для взаимодействия с моделями Google Generative AI.

**Как работает класс**:
Класс `GoogleGenerativeAI` инициализируется с ключом API, именем модели, конфигурацией генерации и системной инструкцией. Он предоставляет методы для отправки запросов к модели, ведения диалогов, описания изображений и загрузки файлов. Класс также включает в себя обработку ошибок, ведение журнала и сохранение истории диалогов.

**Методы**:
- `__init__`: Инициализирует класс `GoogleGenerativeAI` с необходимыми конфигурациями.
- `config`: Получает конфигурацию из файла настроек.
- `_start_chat`: Запускает сессию чата с моделью ИИ.
- `_save_dialogue`: Сохраняет диалог в текстовые и JSON файлы.
- `ask`: Отправляет текстовый запрос модели ИИ и получает ответ.
- `chat`: Отправляет сообщение чата модели ИИ и получает ответ.
- `describe_image`: Генерирует текстовое описание изображения.
- `upload_file`: Загружает файл в модель ИИ.

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
response = ai.ask("Как дела?")
print(response)
```

## Функции

### `__init__`

```python
def __init__(self, api_key: str, model_name: Optional[str] = None, generation_config: Optional[Dict] = None, system_instruction: Optional[str] = None, **kwargs) -> None:
    """
    Инициализирует класс `GoogleGenerativeAI` с необходимыми конфигурациями.
    """
```

**Как работает функция**:
Функция `__init__` инициализирует класс `GoogleGenerativeAI` с необходимыми параметрами, такими как ключ API, имя модели, конфигурация генерации и системная инструкция. Она также определяет пути для ведения журнала диалогов и хранения истории, и инициализирует модель Google Generative AI.

**Параметры**:
- `api_key` (str): Ключ API для доступа к Google Generative AI.
- `model_name` (Optional[str], optional): Имя модели для использования. По умолчанию `None`.
- `generation_config` (Optional[Dict], optional): Конфигурация генерации. По умолчанию `None`.
- `system_instruction` (Optional[str], optional): Системная инструкция. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Примеры**:

```python
ai = GoogleGenerativeAI(api_key="your_api_key", system_instruction="Instruction")
```

### `config`

```python
def config() -> Dict:
    """
    Получает конфигурацию из файла настроек.
    """
```

**Как работает функция**:
Функция `config` читает и разбирает файл конфигурации, расположенный по пути `gs.path.src / 'ai' / 'gemini' / 'gemini.json'`.

**Возвращает**:
- `Dict`: Словарь с конфигурационными параметрами.

### `_start_chat`

```python
def _start_chat(self) -> google.generativeai.generative_models.ChatSession:
    """
    Запускает сессию чата с моделью ИИ.
    """
```

**Как работает функция**:
Функция `_start_chat` инициализирует сессию чата с пустой историей, используя API `google.generativeai`.

**Возвращает**:
- `google.generativeai.generative_models.ChatSession`: Объект сессии чата.

### `_save_dialogue`

```python
def _save_dialogue(self, dialogue: list) -> None:
    """
    Сохраняет диалог в текстовые и JSON файлы.
    """
```

**Как работает функция**:
Функция `_save_dialogue` добавляет каждое сообщение в диалоге в текстовый файл и в JSON файл. Она использует методы `file.add_text_to_file` и `jjson.add_json_to_file` для сохранения диалога.

**Параметры**:
- `dialogue` (list): Список сообщений в диалоге.

### `ask`

```python
def ask(self, q: str, attempts: int = 15) -> Optional[str]:
    """
    Отправляет текстовый запрос модели ИИ и получает ответ.
    """
```

**Как работает функция**:
Функция `ask` отправляет текстовый запрос модели ИИ и получает ответ. Она обрабатывает несколько попыток в случае ошибок сети или недоступности сервиса, ведет журнал ошибок и повторяет попытки с экспоненциальной задержкой. Также, она сохраняет диалог в файлы истории.

**Параметры**:
- `q` (str): Текстовый запрос.
- `attempts` (int, optional): Количество попыток. По умолчанию 15.

**Возвращает**:
- `Optional[str]`: Ответ от модели ИИ или `None` в случае ошибки.

**Вызывает исключения**:
- `Exception`: В случае ошибки при отправке запроса.

### `chat`

```python
def chat(self, q: str) -> str:
    """
    Отправляет сообщение чата модели ИИ и получает ответ.
    """
```

**Как работает функция**:
Функция `chat` отправляет сообщение чата модели ИИ и получает ответ, используя сессию чата, инициализированную методом `_start_chat`. Она ведет журнал ошибок и возвращает текст ответа.

**Параметры**:
- `q` (str): Сообщение для чата.

**Возвращает**:
- `str`: Ответ от модели ИИ.

### `describe_image`

```python
def describe_image(self, image_path: Path) -> Optional[str]:
    """
    Генерирует текстовое описание изображения.
    """
```

**Как работает функция**:
Функция `describe_image` кодирует изображение в base64 и отправляет его модели ИИ. Она возвращает сгенерированное описание или ведет журнал ошибки, если операция не удалась.

**Параметры**:
- `image_path` (Path): Путь к изображению.

**Возвращает**:
- `Optional[str]`: Текстовое описание изображения или `None` в случае ошибки.

### `upload_file`

```python
def upload_file(self, file: str | Path | IOBase, file_name: Optional[str] = None) -> bool:
    """
    Загружает файл в модель ИИ.
    """
```

**Как работает функция**:
Функция `upload_file` обрабатывает загрузку файла и ведет журнал успеха или неудачи. Она предоставляет логику повторных попыток в случае ошибок.

**Параметры**:
- `file` (str | Path | IOBase): Файл для загрузки.
- `file_name` (Optional[str], optional): Имя файла. По умолчанию `None`.

**Возвращает**:
- `bool`: `True`, если загрузка прошла успешно, `False` в противном случае.
# Модуль `category.py`

## Обзор

Модуль предназначен для сбора данных о категориях и товарах с сайта поставщика hb.co.il. Он использует веб-драйвер для навигации по сайту, сбора ссылок на категории и товары, а затем передает эти данные для дальнейшей обработки. Модуль отвечает за извлечение актуальной информации о категориях и товарах, учитывая возможные изменения на сайте поставщика.

## Подробней

Модуль `category.py` является частью процесса сбора и обработки данных о товарах от поставщика hb.co.il. Он выполняет следующие основные задачи:

1.  **Сбор списка категорий:** Функция `get_list_categories_from_site()` собирает список категорий, представленных на сайте поставщика. Это позволяет получить актуальную структуру категорий товаров.
2.  **Сбор списка товаров в категории:** Функция `get_list_products_in_category()` извлекает ссылки на товары, представленные на странице категории. Если на странице есть пагинация, модуль также обрабатывает ее, чтобы собрать ссылки со всех страниц категории.
3.  **Обработка пагинации:** Функция `paginator()` отвечает за навигацию по страницам категорий, если они разделены на несколько страниц. Она находит элемент пагинации и переходит на следующую страницу, собирая ссылки на товары.
4.  **Использование веб-драйвера:** Для взаимодействия с сайтом используется веб-драйвер, который позволяет автоматизировать навигацию и сбор данных.

## Функции

### `get_list_products_in_category`

```python
def get_list_products_in_category (s: Supplier) -> list[str, str, None]:
    """ Returns list of products urls from category page
    Если надо пролистстать - страницы категорий - листаю ??????

    Attrs:
        s - Supplier
    @returns
        list or one of products urls or None
    """
    ...
```

**Назначение**: Извлекает список URL-адресов товаров со страницы категории.

**Параметры**:

*   `s` (Supplier): Объект поставщика, содержащий информацию о конфигурации, драйвере и локаторах элементов.

**Возвращает**:

*   `list[str, str, None]`: Список URL-адресов товаров или `None`, если товары не найдены.

**Как работает функция**:

1.  **Инициализация**: Функция принимает объект поставщика (`Supplier`) в качестве аргумента. Из объекта поставщика извлекаются необходимые компоненты, такие как драйвер (`d`) и локаторы элементов (`l`).
2.  **Ожидание и закрытие баннера**: Функция ожидает 1 секунду, чтобы страница полностью загрузилась, и пытается закрыть баннер, используя локатор `close_banner`.
3.  **Прокрутка страницы**: Выполняется прокрутка страницы для загрузки динамически подгружаемого контента.
4.  **Извлечение ссылок на товары**: Функция пытается извлечь ссылки на товары, используя локатор `product_links`.
5.  **Обработка пагинации**: Если ссылки на товары не найдены, функция завершает работу и возвращает `None`. Если товары найдены, запускается цикл, в котором проверяется наличие пагинации. Функция `paginator()` вызывается для перехода на следующую страницу. Полученные ссылки добавляются к общему списку `list_products_in_category`.
6.  **Логирование и возврат результата**: После завершения цикла пагинации функция логирует количество найденных товаров и возвращает список URL-адресов товаров.

```ascii
    Начало
     ↓
    Получение драйвера и локаторов (d, l)
     ↓
    Ожидание загрузки страницы и закрытие баннера
     ↓
    Прокрутка страницы
     ↓
    Извлечение ссылок на товары (list_products_in_category)
     ↓
    Если нет ссылок на товары:
     → Логирование предупреждения и возврат None
     ↓
    Если есть ссылки на товары:
     → Цикл пагинации:
        │  ↓
        │  Вызов paginator() для перехода на следующую страницу
        │  ↓
        │  Если paginator() возвращает True:
        │  → Добавление новых ссылок на товары к list_products_in_category
        │  ↓
        │  Иначе:
        │  → Выход из цикла
        ↓
    Логирование количества найденных товаров
     ↓
    Возврат list_products_in_category
     ↓
    Конец
```

**Примеры**:

```python
# Пример вызова функции с объектом поставщика
supplier = Supplier(...)  # Инициализация объекта поставщика
product_list = get_list_products_in_category(supplier)
if product_list:
    print(f"Найдено {len(product_list)} товаров")
else:
    print("Товары не найдены")
```

### `paginator`

```python
def paginator(d:Driver, locator: dict, list_products_in_category: list):
    """ Листалка """
    response = d.execute_locator(locator['pagination']['<-'])
    if not response or (isinstance(response, list) and len(response) == 0):
        ...
        return
    return True
```

**Назначение**: Переходит на следующую страницу категории, если доступна пагинация.

**Параметры**:

*   `d` (Driver): Объект драйвера, используемый для взаимодействия с веб-страницей.
*   `locator` (dict): Словарь с локаторами элементов страницы.
*   `list_products_in_category` (list): Список URL-адресов товаров в текущей категории.

**Возвращает**:

*   `True`: Если удалось перейти на следующую страницу.
*   `None`: Если не удалось перейти на следующую страницу.

**Как работает функция**:

1.  **Извлечение элемента пагинации**: Функция пытается найти элемент пагинации на странице, используя локатор `locator['pagination']['<-']`.
2.  **Проверка наличия пагинации**: Если элемент пагинации не найден или является пустым списком, функция возвращает `None`.
3.  **Переход на следующую страницу**: Если элемент пагинации найден, функция переходит на следующую страницу и возвращает `True`.

```ascii
Начало
 ↓
Поиск элемента пагинации на странице (response)
 ↓
Если элемент пагинации не найден или пустой:
 → Возврат None
 ↓
Иначе:
 → Переход на следующую страницу
 ↓
Возврат True
 ↓
Конец
```

**Примеры**:

```python
# Пример вызова функции paginator
driver = Driver(...)  # Инициализация объекта драйвера
locator = {...}  # Определение локаторов элементов
product_list = []  # Создание пустого списка товаров
if paginator(driver, locator, product_list):
    print("Переход на следующую страницу выполнен")
else:
    print("Следующая страница не найдена")
```

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s):
    """ сборщик актуальных категорий с сайта """
    ...
```

**Назначение**: Собирает актуальные категории с сайта.

**Параметры**:

*   `s`: Объект, содержащий необходимые данные для работы с сайтом.

**Возвращает**:

*   `list`: Список категорий, найденных на сайте.

**Как работает функция**:

1.  **Инициализация**: Функция принимает объект, содержащий необходимые данные для работы с сайтом.
2.  **Сбор категорий**: Функция выполняет сбор категорий с сайта, используя веб-драйвер или другие методы.
3.  **Возврат результата**: Функция возвращает список собранных категорий.

```ascii
Начало
 ↓
Сбор категорий с сайта
 ↓
Возврат списка категорий
 ↓
Конец
```

**Примеры**:

```python
# Пример вызова функции get_list_categories_from_site
categories = get_list_categories_from_site(supplier_object)
if categories:
    print(f"Найдено {len(categories)} категорий")
else:
    print("Категории не найдены")
# Модуль для тестирования сценариев рекламы
## Обзор

Этот модуль содержит тесты для оценки и создания рекламных объявлений в контексте Tiny Troupe. Он включает сценарии, в которых агенты (виртуальные личности) оценивают рекламные объявления и участвуют в создании рекламных объявлений для сдачи квартиры в аренду. Также модуль содержит тест для профилирования потребителей.

## Подробней

Модуль использует фреймворк pytest для организации тестов. В тестах создаются виртуальные агенты, которые взаимодействуют с рекламными объявлениями или участвуют в обсуждении лучших способов рекламы квартиры. Результаты этих взаимодействий извлекаются и анализируются для проверки гипотез о поведении агентов.

## Функции

### `test_ad_evaluation_scenario`

```python
def test_ad_evaluation_scenario(setup):
    """
    Проводит сценарий оценки рекламных объявлений.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.

    Raises:
        AssertionError: Если результаты не соответствуют ожидаемым.
    """
```

**Назначение**:
Эта функция тестирует сценарий, в котором виртуальные агенты оценивают несколько рекламных объявлений, связанных с туристическими пакетами в Европу. Цель состоит в том, чтобы выяснить, какое объявление наиболее убедительно для каждого агента, исходя из их личных предпочтений и опыта.

**Параметры**:

-   `setup`: Фикстура pytest, предоставляющая необходимые ресурсы и настройки для теста.

**Возвращает**:
Функция ничего не возвращает явно, но вызывает исключение `AssertionError`, если результаты не соответствуют ожидаемым.

**Как работает функция**:

1.  **Определение рекламных объявлений**: Определяются четыре рекламных объявления, связанных с туристическими пакетами в Европу (`travel_ad_1`, `travel_ad_2`, `travel_ad_3`, `travel_ad_4`).

2.  **Формирование запроса на оценку**: Создается сообщение (`eval_request_msg`), которое содержит запрос к агентам оценить рекламные объявления и выбрать наиболее убедительное.

3.  **Определение контекста**: Устанавливается контекст (`situation`) для агентов, описывающий их интерес к планированию отпуска в Европе и поиску выгодных предложений.

4.  **Определение цели извлечения**: Определяется цель извлечения (`extraction_objective`), указывающая, какую информацию необходимо извлечь из ответов агентов: номер выбранного рекламного объявления, заголовок и обоснование выбора.

5.  **Создание агентов**: Создаются два агента (`create_oscar_the_architect()`, `create_lisa_the_data_scientist()`).

6.  **Взаимодействие агентов с рекламными объявлениями**: Каждый агент получает контекст, сообщение с запросом на оценку и действует в соответствии со своими предпочтениями.

7.  **Извлечение результатов**: Из ответов агентов извлекаются результаты, содержащие номер выбранного рекламного объявления, заголовок и обоснование выбора.

8.  **Проверка результатов**: Проверяется, что результаты не являются `None`, содержат необходимые поля (`ad_id`, `ad_title`, `justification`) и что номер выбранного рекламного объявления соответствует одному из предложенных вариантов.

9.  **Проверка количества выборов**: Убеждаемся, что сделано два выбора (по одному на каждого агента).

```
Определение рекламных объявлений и формирование запроса на оценку
│
↓
Определение контекста и цели извлечения
│
↓
Создание агентов
│
↓
Взаимодействие агентов с рекламными объявлениями
│
↓
Извлечение результатов
│
↓
Проверка результатов
```

**Примеры**:

```python
# Пример вызова функции test_ad_evaluation_scenario с фикстурой setup
test_ad_evaluation_scenario(setup)
```

### `test_ad_creation_scenario`

```python
def test_ad_creation_scenario(setup, focus_group_world):
    """
    Проводит сценарий создания рекламного объявления.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
        focus_group_world: Фикстура pytest, представляющая собой виртуальный мир для фокус-группы.

    Raises:
        AssertionError: Если результаты не соответствуют ожидаемым.
    """
```

**Назначение**:
Эта функция тестирует сценарий, в котором фокус-группа, состоящая из виртуальных агентов, обсуждает лучший способ рекламы квартиры для сдачи в аренду. Цель состоит в том, чтобы сгенерировать идеи для рекламного объявления, которые будут убедительными для потенциальных арендаторов.

**Параметры**:

-   `setup`: Фикстура pytest, предоставляющая необходимые ресурсы и настройки для теста.
-   `focus_group_world`: Фикстура pytest, представляющая собой виртуальный мир для фокус-группы.

**Возвращает**:
Функция ничего не возвращает явно, но вызывает исключение `AssertionError`, если результаты не соответствуют ожидаемым.

**Как работает функция**:

1.  **Определение контекста**: Устанавливается контекст (`situation`) для фокус-группы, описывающий их роль как друзей человека, сдающего квартиру, и задачу по поиску лучшего способа рекламы.

2.  **Описание квартиры**: Предоставляется описание квартиры (`apartment_description`), содержащее характеристики и особенности объекта.

3.  **Определение задачи**: Определяется задача (`task`) для фокус-группы: обсудить лучший способ рекламы квартиры.

4.  **Создание фокус-группы**: Используется фикстура `focus_group_world`, представляющая собой виртуальный мир для фокус-группы.

5.  **Трансляция информации**: Контекст, описание квартиры и задача транслируются всем участникам фокус-группы.

6.  **Запуск симуляции**: Запускается симуляция на 2 шага, в течение которых участники фокус-группы взаимодействуют и обсуждают задачу.

7.  **Извлечение результатов**: Извлекаются результаты обсуждения из виртуального мира фокус-группы.

8.  **Проверка результатов**: Проверяется, что результаты содержат идеи для рекламного объявления квартиры.

```
Определение контекста, описания квартиры и задачи
│
↓
Создание фокус-группы
│
↓
Трансляция информации
│
↓
Запуск симуляции
│
↓
Извлечение результатов
│
↓
Проверка результатов
```

**Примеры**:

```python
# Пример вызова функции test_ad_creation_scenario с фикстурами setup и focus_group_world
test_ad_creation_scenario(setup, focus_group_world)
```

### `test_consumer_profiling_scenario`

```python
def test_consumer_profiling_scenario(setup):
    """
    Проводит сценарий профилирования потребителей.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.

    Raises:
        AssertionError: Если результаты не соответствуют ожидаемым.
    """
```

**Назначение**:
Эта функция тестирует сценарий профилирования потребителей, в котором создаются виртуальные потребители с различными предпочтениями и проводится опрос об их отношении к определенному продукту (бутылочный гаспачо). Цель состоит в том, чтобы собрать данные о потребителях для анализа рынка.

**Параметры**:

-   `setup`: Фикстура pytest, предоставляющая необходимые ресурсы и настройки для теста.

**Возвращает**:
Функция ничего не возвращает явно, но вызывает исключение `AssertionError`, если результаты не соответствуют ожидаемым.

**Как работает функция**:

1.  **Удаление файла кэша**: Если существует файл кэша (`test_consumer_profiling_scenario.cache.json`), он удаляется.

2.  **Начало контроля**: Начинается контроль (`control.begin`) для сохранения состояния симуляции в файл кэша.

3.  **Определение общего контекста**: Устанавливается общий контекст (`general_context`) для опроса потребителей, описывающий цель исследования рынка и интерес к мнению различных слоев населения.

4.  **Создание фабрики потребителей**: Создается фабрика потребителей (`TinyPersonFactory`) с общим контекстом.

5.  **Опрос потребителей**: Выполняется цикл, в котором создаются и опрашиваются потребители.

    *   **Создание потребителя**: Создается случайный потребитель с подробными предпочтениями.

    *   **Опрос потребителя**: Потребителю задаются вопросы о его личности, интересах и отношении к бутылочному гаспачо.

    *   **Сохранение потребителя**: Созданный потребитель добавляется в список `consumers`.

    *   **Создание контрольной точки**: Создается контрольная точка (`control.checkpoint`) для сохранения состояния симуляции.

6.  **Проверка создания файла**: Проверяется, что файл кэша был создан.

7.  **Завершение контроля**: Завершается контроль (`control.end`).

```
Удаление файла кэша
│
↓
Начало контроля
│
↓
Определение общего контекста
│
↓
Создание фабрики потребителей
│
↓
Опрос потребителей (в цикле)
│
├──> Создание потребителя
│
├──> Опрос потребителя
│
├──> Сохранение потребителя
│
└──> Создание контрольной точки
│
↓
Проверка создания файла
│
↓
Завершение контроля
```

**Примеры**:

```python
# Пример вызова функции test_consumer_profiling_scenario с фикстурой setup
test_consumer_profiling_scenario(setup)
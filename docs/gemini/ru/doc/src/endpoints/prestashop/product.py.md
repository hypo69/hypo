# Модуль: `src.endpoints.prestashop.product`

## Обзор

Модуль `src.endpoints.prestashop.product` предназначен для взаимодействия с товарами в PrestaShop. Он предоставляет классы и функции для получения информации о товарах, добавления новых товаров и управления категориями товаров.

## Подробнее

Модуль содержит класс `PrestaProduct`, который наследуется от класса `PrestaShop` и реализует методы для работы с API PrestaShop, специфичные для товаров. Также модуль включает класс `Config`, который содержит настройки конфигурации для подключения к API PrestaShop, такие как ключ API и домен. Дополнительно, модуль содержит примеры использования основных функций для облегчения интеграции и тестирования.

## Классы

### `Config`

**Описание**: Класс конфигурации для настроек продукта PrestaShop.

**Принцип работы**:
Класс `Config` содержит статические атрибуты, определяющие параметры подключения к API PrestaShop, такие как `API_DOMAIN` и `API_KEY`. Значения этих атрибутов могут быть заданы как через переменные окружения, так и через значения по умолчанию, определенные в модуле `gs.credentials.presta.client`. Класс также определяет формат POST запросов (`POST_FORMAT`) и флаг `USE_ENV`, указывающий, следует ли использовать переменные окружения для получения параметров API.

**Атрибуты**:
- `USE_ENV` (bool): Указывает, использовать ли переменные окружения для конфигурации. По умолчанию `False`.
- `MODE` (str): Режим работы (например, `dev`, `dev8`). По умолчанию `'dev'`.
- `POST_FORMAT` (str): Формат данных для POST запросов (`XML`). По умолчанию `'XML'`.
- `API_DOMAIN` (str): Домен API PrestaShop. По умолчанию `''`.
- `API_KEY` (str): Ключ API PrestaShop. По умолчанию `''`.

### `PrestaProduct`

**Описание**: Класс для управления товарами в PrestaShop.

**Принцип работы**:
Класс `PrestaProduct` наследуется от класса `PrestaShop` и предоставляет методы для получения схемы продукта, добавления новых продуктов, получения информации о родительских категориях и выполнения других операций, связанных с товарами в PrestaShop. Класс использует API PrestaShop для взаимодействия с магазином.

**Методы**:
- `__init__(api_key: Optional[str] = '', api_domain: Optional[str] = '', *args, **kwargs) -> None`: Инициализирует объект `PrestaProduct`.
- `get_product_schema(resource_id: Optional[str | int] = None, schema: Optional[str] = 'blank') -> dict`: Получает схему ресурса продукта из PrestaShop.
- `get_parent_category(id_category: int) -> Optional[int]`: Получает родительскую категорию из PrestaShop для заданной категории рекурсивно.
- `_add_parent_categories(self, f: ProductFields) -> None`: Вычисляет и добавляет все родительские категории для списка ID категорий к объекту `ProductFields`.
- `get_product(self, id_product: int, **kwards) -> dict`: Возвращает словарь полей товара из магазина PrestaShop.
- `add_new_product(self, f: ProductFields) -> dict`: Добавляет новый продукт в PrestaShop.

## Функции

### `example_add_new_product() -> None`

```python
def example_add_new_product() -> None:
    """Пример для добавления товара в Prestashop"""
```

**Назначение**:
Пример использования класса `PrestaProduct` для добавления нового товара в PrestaShop.

**Как работает функция**:

1.  **Создание экземпляра класса `PrestaProduct`**:
    - Создается объект `p` класса `PrestaProduct` с использованием ключа API и домена, взятых из класса `Config`.
2.  **Загрузка примера данных о продукте**:
    - Загружаются примерные данные о продукте из JSON-файла (`product_schema.2191_250319224027026.json`).
    - Если файл не существует или имеет неправильный формат, в лог записывается сообщение об ошибке.
3.  **Преобразование данных в XML**:
    - Данные о продукте преобразуются в XML-формат с использованием функции `presta_fields_to_xml`.
    - Полученный XML сохраняется в файл для отладки.
4.  **Выполнение запроса к API**:
    - Определяются параметры запроса, включая формат ввода-вывода (`io_format`).
    - Выполняется POST-запрос к API PrestaShop для добавления товара. Данные передаются либо в формате JSON, либо в формате XML, в зависимости от значения `io_format`.
5.  **Обработка ответа от API**:
    - Ответ от API выводится в консоль.
    - В случае ошибки выводится сообщение об ошибке и завершается выполнение функции.

**ASCII flowchart**:

```
A[Создание экземпляра PrestaProduct]
    ↓
B[Загрузка примера данных о продукте из JSON]
    ↓
C[Преобразование данных в XML]
    ↓
D[Выполнение POST-запроса к API PrestaShop]
    ↓
E[Вывод ответа API в консоль]
```

**Примеры**:

```python
example_add_new_product()
```

### `example_get_product(id_product: int, **kwards) -> None`

```python
def example_get_product(id_product: int, **kwards) -> None:
    """"""
```

**Назначение**:
Пример использования класса `PrestaProduct` для получения информации о товаре из PrestaShop по его ID.

**Как работает функция**:

1.  **Создание экземпляра класса `PrestaProduct`**:
    - Создается объект `p` класса `PrestaProduct` с использованием ключа API и домена, взятых из класса `Config`.
2.  **Определение параметров запроса**:
    - Определяются параметры запроса, такие как формат данных (`data_format`), уровень детализации (`display`) и схема (`schema`).
3.  **Получение информации о продукте**:
    - Вызывается метод `get_product` объекта `p` для получения информации о товаре с заданным ID.
4.  **Обработка ответа**:
    - Если ответ является списком, извлекается первый элемент.
5.  **Сохранение ответа в файл**:
    - Полученная информация о товаре сохраняется в JSON-файл для отладки.

**ASCII flowchart**:

```
A[Создание экземпляра PrestaProduct]
    ↓
B[Определение параметров запроса]
    ↓
C[Получение информации о продукте по ID]
    ↓
D[Обработка ответа (извлечение первого элемента, если это список)]
    ↓
E[Сохранение информации о продукте в JSON-файл]
```

**Примеры**:

```python
example_get_product(2191)
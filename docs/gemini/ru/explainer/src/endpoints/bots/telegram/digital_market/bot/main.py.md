## <–∞–ª–≥–æ—Ä–∏—Ç–º>

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `main()`.
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`register_middlewares()`) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (—Å —Ñ–∏–∫—Å–∞—Ü–∏–µ–π –∏ –±–µ–∑).
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç—ã (`register_routers()`) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ (–∫–∞—Ç–∞–ª–æ–≥, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∞–¥–º–∏–Ω).
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (`create_app()`) –Ω–∞ –æ—Å–Ω–æ–≤–µ `aiohttp`.

2. **–°–æ–∑–¥–∞–Ω–∏–µ –í–µ–±-–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è `create_app()`:**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä `web.Application()`.
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç—ã:
     - `POST /{settings.BOT_TOKEN}`: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–∞ –æ—Ç Telegram (`handle_webhook`).
     - `POST /robokassa/result/`: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ Robokassa (`robokassa_result`).
     - `GET /robokassa/fail/`: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ Robokassa (`robokassa_fail`).
     - `GET /`: –í—ã–≤–æ–¥ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`home_page`).
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `setup_application`, –ø–æ–¥–∫–ª—é—á–∞—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä (`dp`) –∏ –±–æ—Ç–∞ (`bot`).
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ `on_startup` –∏ `on_shutdown` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

3. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `main()`:**
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `create_app()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä `web.run_app()`, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ö–æ—Å—Ç–µ –∏ –ø–æ—Ä—Ç–µ (`settings.SITE_HOST`, `settings.SITE_PORT`).

4. **`on_startup`:**
    - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –±–æ—Ç–∞ (`set_default_commands`).
    - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–µ–±—Ö—É–∫ –¥–ª—è –±–æ—Ç–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π URL (`settings.get_webhook_url`).
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –±–æ—Ç–∞.
    - –õ–æ–≥–≥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.

5. **`on_shutdown`:**
    - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –±–æ—Ç–∞.
    - –£–¥–∞–ª—è–µ—Ç –≤–µ–±—Ö—É–∫ –±–æ—Ç–∞.
    - –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –±–æ—Ç–∞.
    - –õ–æ–≥–≥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ.

6. **`set_default_commands`:**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É `/start` –¥–ª—è –±–æ—Ç–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º "–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞".

7. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:**
   - –ö–æ–≥–¥–∞ Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤–µ–±—Ö—É–∫, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `handle_webhook` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
   - –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Robokassa –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ–ø–ª–∞—Ç—ã –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `robokassa_result`.
   - –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ–ø–ª–∞—Ç–µ Robokassa –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `robokassa_fail`.
   - –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–∞–π—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `home_page`.

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, `main()` -> `create_app()` -> `web.run_app()`
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç,  `web.run_app()` -> `on_startup()` -> `set_default_commands()` -> `bot.set_webhook()` -> `bot.send_message()`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞ –æ—Ç Telegram `handle_webhook`
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã –æ—Ç Robokassa `robokassa_result`
- –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ –æ–ø–ª–∞—Ç—ã –æ—Ç Robokassa `robokassa_fail`
- –ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É `home_page`
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `web.run_app()` -> `on_shutdown()` -> `bot.send_message()` -> `bot.delete_webhook()` -> `bot.session.close()`

## <mermaid>

```mermaid
flowchart TD
    subgraph Web Application
        Start(Start Application) --> CreateApp[create_app(): Create Web Application]
        CreateApp --> SetupRoutes[Setup Routes]
        SetupRoutes --> SetupApp[setup_application(app, dp, bot)]
        SetupApp --> StartupHandler[Register on_startup handler]
        SetupApp --> ShutdownHandler[Register on_shutdown handler]
        StartupHandler --> onStartup[on_startup(app)]
        ShutdownHandler --> onShutdown[on_shutdown(app)]
        CreateApp --> WebRunApp[web.run_app(app)]
    end

    subgraph Startup Handler
      onStartup --> SetCommands[set_default_commands()]
      SetCommands --> BotSetCommands[bot.set_my_commands()]
      onStartup --> BotSetWebhook[bot.set_webhook()]
      BotSetWebhook --> SendAdminMessage[send_message(admin_id, '–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω ü•≥')]
      SendAdminMessage --> LogStartup[logger.info("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω.")]
    end
  
    subgraph Shutdown Handler
        onShutdown --> SendShutdownMessage[send_message(admin_id, '–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü–æ—á–µ–º—É? üòî')]
        SendShutdownMessage --> BotDeleteWebhook[bot.delete_webhook(drop_pending_updates=True)]
        BotDeleteWebhook --> BotCloseSession[bot.session.close()]
        BotCloseSession --> LogShutdown[logger.error("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")]
    end

    subgraph Middleware Registration
      Start --> RegisterMiddlewares[register_middlewares()]
      RegisterMiddlewares --> RegisterDBMiddlewareWithoutCommit[dp.update.middleware.register(DatabaseMiddlewareWithoutCommit())]
      RegisterMiddlewares --> RegisterDBMiddlewareWithCommit[dp.update.middleware.register(DatabaseMiddlewareWithCommit())]
    end

   subgraph Router Registration
        Start --> RegisterRouters[register_routers()]
        RegisterRouters --> IncludeCatalogRouter[dp.include_router(catalog_router)]
        RegisterRouters --> IncludeUserRouter[dp.include_router(user_router)]
        RegisterRouters --> IncludeAdminRouter[dp.include_router(admin_router)]
    end

   subgraph Route Handling
        SetupRoutes --> HandleWebhook[POST /{settings.BOT_TOKEN}: handle_webhook]
        SetupRoutes --> RobokassaResult[POST /robokassa/result/: robokassa_result]
        SetupRoutes --> RobokassaFail[GET /robokassa/fail/: robokassa_fail]
        SetupRoutes --> HomePage[GET /: home_page]
   end
   
   style Start fill:#f9f,stroke:#333,stroke-width:2px
```

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ `mermaid`
1.  **Web Application:**
    -   `Start`: –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã.
    -   `CreateApp`: –§—É–Ω–∫—Ü–∏—è `create_app()`, —Å–æ–∑–¥–∞—é—â–∞—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `aiohttp`.
    -   `SetupRoutes`: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤.
    -   `SetupApp`: –§—É–Ω–∫—Ü–∏—è `setup_application()`, —Å–≤—è–∑—ã–≤–∞—é—â–∞—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –±–æ—Ç–æ–º –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º.
    -   `StartupHandler`:  –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    -   `ShutdownHandler`: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    -   `WebRunApp`: –ó–∞–ø—É—Å–∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `web.run_app()`.
2.  **Startup Handler:**
    -   `onStartup`: –§—É–Ω–∫—Ü–∏—è `on_startup()`, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    -   `SetCommands`: –§—É–Ω–∫—Ü–∏—è `set_default_commands()` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞.
    -   `BotSetCommands`: –ú–µ—Ç–æ–¥ `bot.set_my_commands()` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥.
    -   `BotSetWebhook`: –ú–µ—Ç–æ–¥ `bot.set_webhook()` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±—Ö—É–∫–∞.
    -   `SendAdminMessage`: –ú–µ—Ç–æ–¥ `bot.send_message()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.
    -   `LogStartup`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.
3.  **Shutdown Handler:**
    -   `onShutdown`: –§—É–Ω–∫—Ü–∏—è `on_shutdown()`, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    -   `SendShutdownMessage`: –ú–µ—Ç–æ–¥ `bot.send_message()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.
    -   `BotDeleteWebhook`: –ú–µ—Ç–æ–¥ `bot.delete_webhook()` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–∞.
    -   `BotCloseSession`: –ú–µ—Ç–æ–¥ `bot.session.close()` –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ –±–æ—Ç–∞.
    -   `LogShutdown`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞.
4. **Middleware Registration:**
    -   `RegisterMiddlewares`: –§—É–Ω–∫—Ü–∏—è `register_middlewares()` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ middleware.
    -   `RegisterDBMiddlewareWithoutCommit`: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è middleware `DatabaseMiddlewareWithoutCommit()`.
    -   `RegisterDBMiddlewareWithCommit`: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è middleware `DatabaseMiddlewareWithCommit()`.
5. **Router Registration:**
    -   `RegisterRouters`: –§—É–Ω–∫—Ü–∏—è `register_routers()` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–µ—Ä–æ–≤.
    -  `IncludeCatalogRouter`: –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ `catalog_router`.
    -   `IncludeUserRouter`: –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `user_router`.
    -   `IncludeAdminRouter`: –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ `admin_router`.
6. **Route Handling:**
    -   `HandleWebhook`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–∞ –æ—Ç Telegram (`handle_webhook`).
    -   `RobokassaResult`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Ç Robokassa (`robokassa_result`).
    -   `RobokassaFail`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–∏ –æ—Ç Robokassa (`robokassa_fail`).
    -  `HomePage`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (`home_page`).
   
### mermaid `header.py`

```mermaid
flowchart TD
    Start --> Header[<code>header.py</code><br> Determine Project Root]

    Header --> import[Import Global Settings: <br><code>from src import gs</code>]
```

## <–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ>

### –ò–º–ø–æ—Ä—Ç—ã:
- `aiogram.webhook.aiohttp_server`:  –ú–æ–¥—É–ª—å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–∞ aiogram –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ aiohttp.
- `aiohttp.web`: –ú–æ–¥—É–ª—å aiohttp –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
- `aiogram.types`:  –ú–æ–¥—É–ª—å aiogram –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–º–∞–Ω–¥—ã, —Å–∫–æ—É–ø—ã).
- `loguru`: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
- `bot.app.app`: –ú–æ–¥—É–ª—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–µ–±—Ö—É–∫–∞, Robokassa, –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞).
- `bot.config`: –ú–æ–¥—É–ª—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–æ—Ç–∞, –≤–∫–ª—é—á–∞—è —Ç–æ–∫–µ–Ω, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä.
- `bot.dao.database_middleware`: –ú–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (middleware).
- `bot.admin.admin`: –†–æ—É—Ç–µ—Ä –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.
- `bot.user.user_router`: –†–æ—É—Ç–µ—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥.
- `bot.user.catalog_router`: –†–æ—É—Ç–µ—Ä –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞.
   
–í–∑–∞–∏–º–æ—Å–≤—è–∑—å —Å `src`:
-   –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã `bot.*` —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –º–æ–¥—É–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/bot`.

### –§—É–Ω–∫—Ü–∏–∏:
-   `set_default_commands()`:
    -   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/start`).
    -   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: –ù–µ—Ç.
    -   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–µ—Ç.
    -   **–ü—Ä–∏–º–µ—Ä**:
        ```python
            await set_default_commands()
            # –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ —É –±–æ—Ç–∞ –±—É–¥–µ—Ç –∫–æ–º–∞–Ω–¥–∞ /start
        ```
- `on_startup(app)`:
    -   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    -   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: `app` - —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è aiohttp.
    -   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–µ—Ç.
    -  **–ü—Ä–∏–º–µ—Ä**:
        ```python
            async def on_startup(app):
                await set_default_commands()
                await bot.set_webhook("https://example.com/webhook")
                await bot.send_message(12345, "–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")

           # –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —ç—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è
        ```
-   `on_shutdown(app)`:
    -   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    -   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: `app` - —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è aiohttp.
    -   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–µ—Ç.
    -   **–ü—Ä–∏–º–µ—Ä**:
          ```python
                async def on_shutdown(app):
                      await bot.send_message(12345, "–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
                      await bot.delete_webhook()
                      await bot.session.close()

                # –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —ç—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è
            ```
-   `register_middlewares()`:
    -   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    -   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: –ù–µ—Ç.
    -   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–µ—Ç.
    -  **–ü—Ä–∏–º–µ—Ä**:
        ```python
          register_middlewares()
            # –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –±—É–¥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã middleware –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
        ```
-   `register_routers()`:
    -   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤.
    -   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: –ù–µ—Ç.
    -   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–µ—Ç.
     -  **–ü—Ä–∏–º–µ—Ä**:
        ```python
          register_routers()
            # –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –±—É–¥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ä–æ—É—Ç–µ—Ä—ã –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞–¥–º–∏–Ω–∞
        ```
-   `create_app()`:
    -   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ aiohttp.
    -   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: –ù–µ—Ç.
    -   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –≠–∫–∑–µ–º–ø–ª—è—Ä `web.Application`.
    -  **–ü—Ä–∏–º–µ—Ä**:
        ```python
          app = create_app()
            # app - —ç—Ç–æ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        ```
-   `main()`:
    -   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∑–∞–ø—É—Å–∫–∞—é—â–∞—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
    -   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: –ù–µ—Ç.
    -   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–µ—Ç.
    -  **–ü—Ä–∏–º–µ—Ä**:
        ```python
          main()
            # –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        ```
   
### –ö–ª–∞—Å—Å—ã:
- `DatabaseMiddlewareWithoutCommit`, `DatabaseMiddlewareWithCommit`:
    -   **–†–æ–ª—å**: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å —Ñ–∏–∫—Å–∞—Ü–∏–µ–π –∏ –±–µ–∑).
    -   **–ê—Ç—Ä–∏–±—É—Ç—ã**: –ó–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `bot.dao.database_middleware`.
    -   **–ú–µ—Ç–æ–¥—ã**: –ó–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –æ–±—ã—á–Ω–æ –≤–∫–ª—é—á–∞—é—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ –ë–î, –∞ —Ç–∞–∫–∂–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.
    -   **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `dp.update.middleware.register`, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –ë–î –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `bot`: –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –∏–∑ `bot.config`.
-   `admins`: –°–ø–∏—Å–æ–∫ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ `bot.config`.
-   `dp`: –î–∏—Å–ø–µ—Ç—á–µ—Ä aiogram –∏–∑ `bot.config`.
- `settings`: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `bot.config`.
-   `commands`: –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ —Ç–∏–ø–∞ `BotCommand`.
-   `app`: –≠–∫–∑–µ–º–ø–ª—è—Ä –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `web.Application`.

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è:
1.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í –∫–æ–¥–µ –µ—Å—Ç—å `try-except` –±–ª–æ–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º, –Ω–æ –æ–±—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–µ –ø–æ–ª–Ω–∞—è, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.
2.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω, URL –≤–µ–±—Ö—É–∫–∞ –∏ —Ç.–¥.) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
3.  **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –µ–≥–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å (—Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è).
4.  **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á).

### –¶–µ–ø–æ—á–∫–∞ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π
-   `main.py` ‚Üí `bot.config.py` (–ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫, —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞, –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞).
-   `main.py` ‚Üí `bot.app.app.py` (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤).
-   `main.py` ‚Üí `bot.dao.database_middleware.py` (middleware –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î).
-   `main.py` ‚Üí `bot.admin.admin.py`, `bot.user.user_router.py`, `bot.user.catalog_router.py` (—Ä–æ—É—Ç–µ—Ä—ã).
-   `main.py` ‚Üí `aiogram`, `aiohttp`, `loguru` (–≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏).

–≠—Ç–æ—Ç –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–¥–∞, –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π —Å –¥—Ä—É–≥–∏–º–∏ —á–∞—Å—Ç—è–º–∏ –ø—Ä–æ–µ–∫—Ç–∞.
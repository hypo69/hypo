# Модуль `code_assistant`

## Обзор

Модуль `code_assistant` предоставляет класс `CodeAssistant` для работы с моделями машинного обучения, предназначенный для обработки кодовой базы, создания документации, примеров кода и тестов. Класс читает файлы кода, отправляет их в модель, получает обработанный код и сохраняет результат в директории `docs/gemini`. Файлы сохраняются в зависимости от роли.

## Оглавление

1. [Классы](#классы)
   - [`CodeAssistant`](#codeassistant)
2. [Функции](#функции)
   - [`parse_args`](#parse_args)
   - [`system_instruction`](#system_instruction)
   - [`code_instruction`](#code_instruction)
   - [`translations`](#translations)
   - [`process_files`](#process_files)
   - [`_create_request`](#_create_request)
   - [`_yield_files_content`](#_yield_files_content)
   - [`_save_response`](#_save_response)
   - [`_remove_outer_quotes`](#_remove_outer_quotes)
   - [`run`](#run)
   - [`_signal_handler`](#_signal_handler)
   - [`main`](#main)

## Классы

### `CodeAssistant`

**Описание**: Класс для работы ассистента программиста с моделями ИИ.

**Методы**:
- `__init__`: Инициализация ассистента с заданными параметрами.
- `_initialize_models`: Инициализация моделей на основе заданных параметров.
- `parse_args`: Разбор аргументов командной строки.
- `system_instruction`: Чтение инструкции из файла.
- `code_instruction`: Чтение инструкции для кода.
- `translations`: Загрузка переводов для ролей и языков.
- `process_files`: Компиляция, отправка запроса и сохранение результата.
- `_create_request`: Создание запроса с учетом роли и языка.
- `_yield_files_content`: Генерирует пути файлов и их содержимое по указанным шаблонам.
- `_save_response`: Сохранение ответа модели в файл с добавлением суффикса.
- `_remove_outer_quotes`: Удаляет внешние кавычки в начале и в конце строки.
- `run`: Запуск процесса обработки файлов.
- `_signal_handler`: Обработка прерывания выполнения.

**Параметры**:
- `role` (str): Роль ассистента (по умолчанию: `doc_writer_rst`).
- `lang` (str): Язык (по умолчанию: `ne`).
- `models_list` (list): Список моделей для использования (по умолчанию: `["gemini"]`).
- `start_dirs` (list): Список директорий для обработки (по умолчанию: `[".."]`).
- `base_path` (Path): Базовый путь к модулю.
- `config` (SimpleNamespace): Конфигурация из JSON.
- `gemini_model` (GoogleGenerativeAI): Модель Google Gemini.
- `openai_model` (OpenAIModel): Модель OpenAI.
- `start_file_number` (int): Номер начального файла для обработки.

## Функции

### `parse_args`

**Описание**: Разбор аргументов командной строки.

**Возвращает**:
- `dict`: Словарь с аргументами командной строки.

### `system_instruction`

**Описание**: Чтение инструкции из файла.

**Возвращает**:
- `str | bool`: Инструкция из файла или `False` в случае ошибки.

### `code_instruction`

**Описание**: Чтение инструкции для кода.

**Возвращает**:
- `str | bool`: Инструкция для кода или `''` в случае ошибки.

### `translations`

**Описание**: Загрузка переводов для ролей и языков.

**Возвращает**:
- `SimpleNamespace`: Переводы для ролей и языков.

### `process_files`

**Описание**: Компиляция, отправка запроса и сохранение результата.

**Параметры**:
- `start_file_number` (Optional[int], optional): Номер файла, с которого начинается обработка. По умолчанию `1`.

### `_create_request`

**Описание**: Создание запроса с учетом роли и языка.

**Параметры**:
- `file_path` (str): Путь к файлу.
- `content` (str): Содержимое файла.

**Возвращает**:
- `str`: Сформированный запрос.

### `_yield_files_content`

**Описание**: Генерирует пути файлов и их содержимое по указанным шаблонам.

**Параметры**:
- `start_dirs` (List[Path], optional): Список директорий для обхода. По умолчанию `[gs.path.src]`.

**Возвращает**:
- `Iterator[tuple[Path, str]]`: Итератор кортежей из пути файла и его содержимого.

### `_save_response`

**Описание**: Сохранение ответа модели в файл с добавлением суффикса.

**Параметры**:
- `file_path` (Path): Исходный путь к файлу, в который будет записан ответ.
- `response` (str): Ответ модели, который необходимо сохранить.
- `model_name` (str): Имя модели, использованной для генерации ответа.

**Возвращает**:
    - `bool`: `True`, если файл сохранен успешно, иначе `False`.
**Raises**:
- `OSError`: Если не удаётся создать директорию или записать в файл.

### `_remove_outer_quotes`

**Описание**: Удаляет внешние кавычки в начале и в конце строки, если они присутствуют.

**Параметры**:
- `response` (str): Ответ модели, который необходимо обработать.

**Возвращает**:
- `str`: Очищенный контент как строка.

### `run`

**Описание**: Запуск процесса обработки файлов.

**Параметры**:
- `start_file_number` (int): Номер начального файла для обработки.

### `_signal_handler`

**Описание**: Обработка прерывания выполнения.

### `main`

**Описание**: Основная функция для запуска.
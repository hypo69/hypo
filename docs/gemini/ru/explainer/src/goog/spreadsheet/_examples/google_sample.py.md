## ИНСТРУКЦИЯ:

Анализируй предоставленный код подробно и объясни его функциональность. Ответ должен включать три раздела:  

1. **<алгоритм>**: Опиши рабочий процесс в виде пошаговой блок-схемы, включая примеры для каждого логического блока, и проиллюстрируй поток данных между функциями, классами или методами.  
2. **<mermaid>**: Напиши код для диаграммы в формате `mermaid`, проанализируй и объясни все зависимости, 
    которые импортируются при создании диаграммы. 
    **ВАЖНО!** Убедитесь, что все имена переменных, используемые в диаграмме `mermaid`, 
    имеют осмысленные и описательные имена. Имена переменных вроде `A`, `B`, `C`, и т.д., не допускаются!  
    
    **Дополнительно**: Если в коде есть импорт `import header`, добавьте блок `mermaid` flowchart, объясняющий `header.py`:\
    ```mermaid
    flowchart TD
        Start --> Header[<code>header.py</code><br> Determine Project Root]
    
        Header --> import[Import Global Settings: <br><code>from src import gs</code>] 
    ```

3. **<объяснение>**: Предоставьте подробные объяснения:  
   - **Импорты**: Их назначение и взаимосвязь с другими пакетами `src.`.  
   - **Классы**: Их роль, атрибуты, методы и взаимодействие с другими компонентами проекта.  
   - **Функции**: Их аргументы, возвращаемые значения, назначение и примеры.  
   - **Переменные**: Их типы и использование.  
   - Выделите потенциальные ошибки или области для улучшения.  

Дополнительно, постройте цепочку взаимосвязей с другими частями проекта (если применимо).  

Это обеспечивает всесторонний и структурированный анализ кода.
## Формат ответа: `.md` (markdown)
**КОНЕЦ ИНСТРУКЦИИ**

## <алгоритм>

1. **Инициализация:**
   - Определяются необходимые константы: `SCOPES` (область доступа к Google Sheets), `SAMPLE_SPREADSHEET_ID` (идентификатор таблицы), `SAMPLE_RANGE_NAME` (диапазон ячеек для чтения), `ROOT_DIRECTORY` (корневая директория проекта).
   - Вычисляется путь к файлу с учетными данными клиента Google API: `path` (используется для авторизации).
2. **Функция `main()`:**
   - **Загрузка учетных данных:**
     - Проверяется, существует ли файл `token.json` (сохраненные учетные данные).
       - **Пример:** Если `token.json` есть, из него загружаются данные для `creds`.
     - Если нет сохраненных или они не валидны:
       - Проверяется, есть ли просроченные учетные данные, и если есть, то производится обновление.
         - **Пример:** Если `creds` есть, но они `expired` и есть `refresh_token`, то производится обновление с помощью `creds.refresh(Request())`.
       - Если обновление невозможно, производится получение новых учетных данных через `InstalledAppFlow`.
        - **Пример:** Открывается окно браузера для авторизации пользователя, и после авторизации `creds` инициализируется.
       - Сохраненные учетные данные записываются в файл `token.json`.
   - **Инициализация сервиса Google Sheets API:**
     - Создается объект `service` для взаимодействия с API, используя полученные учетные данные.
       - **Пример:** `service = build('sheets', 'v4', credentials=creds)` создает объект, с помощью которого можно делать запросы к Google Sheets.
   - **Чтение данных из таблицы:**
     - Выполняется запрос к API на получение значений из указанного диапазона (`SAMPLE_RANGE_NAME`) в таблице с заданным ID (`SAMPLE_SPREADSHEET_ID`).
       - **Пример:** `result = sheet.values().get(spreadsheetId=SAMPLE_SPREADSHEET_ID, range=SAMPLE_RANGE_NAME).execute()` запрашивает данные из таблицы и сохраняет результат в `result`.
     - Извлекаются значения ячеек из ответа API.
       - **Пример:** `values = result.get('values', [])` достает список списков с данными из `result`, если он есть.
   - **Вывод данных:**
     - Если данные не найдены, выводится сообщение "No data found".
     - Если данные есть, выводится заголовок "Name, Major:" и построчно данные из первой (индекс 0) и пятой (индекс 4) колонок.
       - **Пример:** Для `row = ["Alice", "12", "CS", "A", "Math"]` будет выведено `Alice, Math`.
   - **Обработка ошибок:**
     - Если в процессе работы возникла `HttpError`, она обрабатывается и выводится сообщение об ошибке.
3. **Запуск функции `main()`:**
   - Проверяется, является ли скрипт основным запускаемым файлом, и в этом случае запускается функция `main()`.

## <mermaid>

```mermaid
flowchart TD
    Start(Start) --> LoadCredentials[Load Credentials: <br><code>token.json</code> or authenticate]
    LoadCredentials -- Credentials exist --> LoadExistingCredentials[Load from <br><code>token.json</code>]
    LoadCredentials -- Credentials don't exist --> AuthenticateUser[Authenticate User <br> via <code>InstalledAppFlow</code>]
    LoadExistingCredentials --> CheckCredentialsValidity[Check Credentials <br> Validity]
    AuthenticateUser --> CheckCredentialsValidity
    CheckCredentialsValidity -- Credentials valid --> InitializeSheetsService[Initialize Google Sheets API Service]
    CheckCredentialsValidity -- Credentials invalid --> RefreshCredentials[Refresh Credentials <br> if possible]
    RefreshCredentials -- Refresh successful --> InitializeSheetsService
    RefreshCredentials -- Refresh failed --> AuthenticateUser
    InitializeSheetsService --> ReadSpreadsheetData[Read Spreadsheet Data <br> <code>sheet.values().get()</code>]
    ReadSpreadsheetData --> CheckDataAvailability[Check if data <br>is available]
    CheckDataAvailability -- Data found --> PrintData[Print Selected <br>Columns: Name, Major]
    CheckDataAvailability -- No data --> NoDataMessage[Print 'No data found.']
    PrintData --> End(End)
    NoDataMessage --> End
    InitializeSheetsService -- HttpError --> HandleHttpError[Handle HttpError <br>Print error]
    HandleHttpError --> End
    LoadCredentials --> |FileNotFound|AuthenticateUser
```

**Объяснение:**

- `Start`: Начало программы.
- `LoadCredentials`: Этап загрузки учетных данных. Проверяет наличие файла `token.json` для использования существующих учетных данных, если файл отсутствует или учетные данные не валидны, то происходит авторизация пользователя.
- `LoadExistingCredentials`: Загрузка учетных данных из файла `token.json`.
- `AuthenticateUser`: Авторизация пользователя с использованием `InstalledAppFlow`. Открывает окно браузера для авторизации пользователя, после успешной авторизации возвращает валидные учетные данные.
- `CheckCredentialsValidity`: Проверка валидности учетных данных. Если учетные данные существуют и валидны, то переходим к инициализации сервиса.
- `RefreshCredentials`: Обновление просроченных учетных данных, если это возможно. Если обновление не удалось, то необходима полная авторизация пользователя.
- `InitializeSheetsService`: Инициализация сервиса Google Sheets API с использованием полученных учетных данных. Создается объект для взаимодействия с API.
- `ReadSpreadsheetData`: Чтение данных из Google Sheets. Выполняется запрос на получение данных из указанного диапазона.
- `CheckDataAvailability`: Проверка наличия полученных данных. Если данные есть, то они выводятся на экран. Если данных нет, то выводится соответствующее сообщение.
- `PrintData`: Вывод данных из указанных колонок. Печатаются имя и специальность.
- `NoDataMessage`: Вывод сообщения, если нет данных.
- `HandleHttpError`: Обработка ошибок HTTP, которые могут возникнуть при взаимодействии с API.
- `End`: Конец программы.

## <объяснение>

**Импорты:**

- `from __future__ import print_function`: Обеспечивает совместимость с Python 3.x для функции `print()`.
- `import os.path`: Используется для работы с путями к файлам и проверки их существования.
- `from pathlib import Path`: Используется для более удобной работы с путями к файлам и директориям. Позволяет создавать кроссплатформенные пути.
- `from google.auth.transport.requests import Request`: Используется для обновления токенов доступа Google API.
- `from google.oauth2.credentials import Credentials`: Используется для управления учетными данными доступа к Google API.
- `from google_auth_oauthlib.flow import InstalledAppFlow`: Используется для выполнения OAuth 2.0 авторизации с помощью установленного приложения.
- `from googleapiclient.discovery import build`: Используется для создания сервисных объектов для взаимодействия с Google API (в данном случае с Google Sheets API).
- `from googleapiclient.errors import HttpError`: Используется для обработки HTTP ошибок при работе с Google API.

**Переменные:**

- `SCOPES`: Список строк, представляющих области доступа к Google API. В данном случае - только чтение из Google Sheets.
- `SAMPLE_SPREADSHEET_ID`: Строка, представляющая идентификатор Google Sheets таблицы.
- `SAMPLE_RANGE_NAME`: Строка, представляющая диапазон ячеек, из которых необходимо прочитать данные.
- `ROOT_DIRECTORY`: Объект `Path`, представляющий абсолютный путь к корневой директории проекта.
- `path`: Объект `Path`, представляющий путь к файлу с учетными данными (json).
- `creds`: Объект `Credentials` для хранения учетных данных пользователя.
- `service`: Объект, созданный с помощью `googleapiclient.discovery.build`, представляет собой сервис Google Sheets API.
- `sheet`: Объект, представляющий таблицу Google Sheets.
- `result`: Объект, представляющий ответ от Google Sheets API после запроса данных.
- `values`: Список списков, представляющий данные, полученные из таблицы.
- `row`: Переменная-итератор в цикле, представляет собой строку данных из таблицы.

**Функция `main()`:**

- **Аргументы:** Нет.
- **Возвращаемое значение:** Нет.
- **Назначение:** Основная функция программы, выполняющая следующие действия:
    - Загружает учетные данные пользователя из `token.json` или выполняет авторизацию, если файл не существует или учетные данные не валидны.
    - Инициализирует сервис Google Sheets API.
    - Запрашивает данные из указанной таблицы и диапазона.
    - Выводит данные в консоль или сообщение об ошибке, если данные отсутствуют.
    - Обрабатывает возможные ошибки при выполнении запросов к API.
- **Примеры:**
   ```python
    # Пример загрузки учетных данных из token.json
    if os.path.exists(path):
        creds = Credentials.from_authorized_user_file(path, SCOPES)
    
    # Пример запроса данных из таблицы
    result = sheet.values().get(spreadsheetId=SAMPLE_SPREADSHEET_ID, range=SAMPLE_RANGE_NAME).execute()
    values = result.get('values', [])

    # Пример вывода данных в консоль
    for row in values:
        print('%s, %s' % (row[0], row[4]))
   ```

**Классы:**
   
    В этом коде используется класс `Credentials` из пакета `google.oauth2.credentials`, но он не создается напрямую. Вместо этого, создается его экземпляр, когда учетные данные пользователя загружаются из файла или получаются через авторизацию. 
   
    -   **`Credentials`**: Хранит учетные данные для доступа к Google API. Содержит токены доступа, токен обновления и другие параметры аутентификации.

**Потенциальные ошибки и области для улучшения:**

-   **Обработка ошибок:** В коде есть общая обработка `HttpError`, но можно добавить более детальную обработку для конкретных ошибок (например, ошибки авторизации или доступа).
-   **Жестко закодированные значения:** Значения `SAMPLE_SPREADSHEET_ID` и `SAMPLE_RANGE_NAME` лучше вынести в конфигурационный файл или переменные окружения.
-   **Путь к файлу:** Путь к файлу учетных данных также можно сделать более гибким, например, использовать переменные окружения.
-   **Безопасность:** Сохранение токена в `token.json` может представлять угрозу безопасности. Для production следует использовать более защищенные способы хранения учетных данных.
-   **Код для авторизации**: В данном коде в явном виде передается путь `credentials.json`  для авторизации, что может привести к утечке информации, если файл случайно будет добавлен в репозиторий.

**Взаимосвязи с другими частями проекта:**

-   Данный скрипт является примером использования Google Sheets API, и его можно интегрировать с другими частями проекта, где необходима работа с Google Sheets.
-   Может быть добавлен в качестве функционала к сервису, который собирает данные из различных источников, включая Google Sheets.

Данный код является достаточно простым примером, но он может быть расширен и адаптирован для более сложных задач, связанных с чтением и записью данных в Google Sheets.
# Сценарии обработки запросов к модели Gemini

## Обзор

Данный файл описывает различные сценарии обработки запросов к модели Gemini, направленных на извлечение данных.  Документация охватывает этапы обработки, включая валидацию ответа, проверку структуры данных и логирование ошибок.

## Диаграмма состояний

```mermaid
flowchart TD
    A[Запрос на обработку продуктов products_list] --> B[Обработка запроса с командой модели]
    B --> C[Ответ от модели]
    
    %% Проверка на отсутствие ответа
    C -->|Нет ответа| D[Логирование ошибки no response from gemini]
    D --> E[Повторный запрос /attempts - 1/]

    %% Проверка на валидность данных
    C -->|Невалидные данные| F[Логирование ошибки /Error in data from gemini/]
    F --> E

    %% Проверка на полученные данные
    C -->|Получены данные| G{Данные в виде списка?}
    G -->|Да| H{Содержит два элемента /ru, he/?}
    H -->|Да| I[Извлечение ru и he]
    H -->|Нет| J[Извлечение ru и he из первого элемента]
    H -->|Невалидная структура| K[Логирование ошибки /Проблема парсинга ответа/]
    K --> E

    G -->|Нет| L{Данные в виде объекта?}
    L -->|Да| M[Извлечение ru и he из объекта]
    L -->|Нет| N[Логирование ошибки /Invalid ru or he data/]
    N --> E

    %% Возврат результата
    M --> O[Возврат результата ru и he]
    I --> O
    J --> O
```

## Логирование ошибок

- **`no response from gemini`**: Ошибка, возникающая при отсутствии ответа от модели Gemini.
- **`Error in data from gemini`**: Ошибка, возникающая при получении невалидных данных от Gemini.
- **`Проблема парсинга ответа`**: Ошибка, возникающая при некорректной структуре данных ответа.
- **`Invalid ru or he data`**: Ошибка, возникающая при отсутствии или некорректном формате данных `ru` и `he` в ответе.


## Этапы обработки запросов

1. **Запрос на обработку продуктов (`products_list`)**:  Инициализация запроса к модели Gemini.

2. **Обработка запроса с командой модели**: Обработка запроса с заданными параметрами.

3. **Получение ответа от модели**: Получение ответа от модели Gemini.

4. **Проверка на отсутствие ответа**: Проверка ответа на наличие. При отсутствии запускается повторный запрос.

5. **Проверка валидности данных**: Проверка ответа на валидность полученных данных.

6. **Проверка структуры данных**: Проверка на полученный тип данных (список или объект). Проверка списка на наличие нужных элементов (`ru`, `he`). Если они есть, извлекаются, иначе извлекаются из первого элемента списка.

7. **Извлечение данных**: Извлечение данных `ru` и `he` из полученного ответа.

8. **Возврат результата**: Возвращение извлеченных значений `ru` и `he`.

## Примечания

-  Данная документация описывает общую логику обработки запросов. Конкретные реализации могут отличаться в зависимости от контекста.
-  В каждом из этапов обработки (особенно в блоках логирования ошибок) необходима дополнительная детализация для корректной отладки.


```
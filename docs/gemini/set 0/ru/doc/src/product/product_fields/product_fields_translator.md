# Модуль `hypotez/src/product/product_fields/product_fields_translator.py`

## Обзор

Модуль `product_fields_translator.py` отвечает за перевод полей товара на языки клиентской базы данных. Он обрабатывает данные, полученные с сайта поставщика (предполагается PrestaShop), и преобразует их в формат, совместимый с клиентской системой. Модуль использует данные из схемы языков клиента для корректного отображения переведенных полей.


## Функции

### `rearrange_language_keys`

**Описание**: Обновляет идентификатор языка в словаре `presta_fields_dict` на соответствующий идентификатор из схемы клиентских языков, если совпадает язык страницы.

**Параметры**:

- `presta_fields_dict` (dict): Словарь полей товара.
- `page_lang` (str): Язык страницы.
- `client_langs_schema` (list | dict): Схема языков клиента.

**Возвращает**:

- dict: Обновленный словарь `presta_fields_dict`.


### `translate_presta_fields_dict`

**Описание**: Переводит мультиязычные поля товара в соответствии со схемой значений `id` языка в базе данных клиента.

**Параметры**:

- `presta_fields_dict` (dict): Словарь полей товара, полученный со страницы поставщика.  Ожидается структура, где мультиязычные поля представлены в виде словаря, содержащего список словарей с `attrs` (включая `id`) и `value`.
- `client_langs_schema` (list | dict): Схема языков клиента.
- `page_lang` (str, optional): Язык страницы поставщика (en-US, ru-RU, he-HE). Если не задан, функция пытается определить его по тексту.

**Возвращает**:

- dict: Переведенный словарь `presta_fields_dict`.

**Обрабатывает исключения**:

- `Exception`: В случае возникновения ошибки при обработке перевода (например, проблемы с чтением данных из таблицы или некорректные данные).  Информационное сообщение об ошибке и подробности выводятся в лог.


**Примечания**:

- Функция `translate_presta_fields_dict` использует данные из внешней таблицы переводов (`get_translations_from_presta_translations_table`).
- Функция `rearrange_language_keys` используется для предварительной обработки, чтобы установить id нужного языка.
- Обратите внимание на то, что код содержит вызовы функций, которые не определены в представленном фрагменте кода (`get_translations_from_presta_translations_table`, `insert_new_translation_to_presta_translations_table`). Для полной работы модуля необходимо предоставить определения этих функций.
- Оптимизация поиска нужного языка в схеме `client_langs_schema` может быть улучшена (например, при использовании словаря вместо списка).
- Проверьте соответствие типов данных и валидность входных параметров.
- Добавьте обработку случаев, когда `page_lang` не может быть определен.
- Добавьте контроль типов данных, особенно для атрибута `id`.  Все значения `id` должны быть строками.
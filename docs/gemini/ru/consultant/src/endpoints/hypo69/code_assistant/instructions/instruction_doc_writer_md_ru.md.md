# Анализ кода модуля instruction_doc_writer_md_ru.md

**Качество кода**
10
-  Плюсы
    - Код содержит четкие инструкции по созданию документации в формате Markdown.
    - Инструкции структурированы и легко читаемы.
    - Приведены примеры, облегчающие понимание.
    - Описаны необходимые форматы, разделы и заголовки.
-  Минусы
    - Отсутствует обработка исключений и логирование.
    - Инструкция не предусматривает использование `j_loads` или `j_loads_ns` для чтения файлов.
    - Не указано требование по добавлению импортов.
    - Нет требований по сохранению комментариев.
    - Не предусмотрен рефакторинг кода и его улучшение.
    - Нет явных требований к использованию reStructuredText (RST) в комментариях.

**Рекомендации по улучшению**

1.  **Добавить требование по использованию `j_loads` или `j_loads_ns`** для чтения JSON файлов, как указано в основной инструкции.
2.  **Добавить требование по сохранению существующих комментариев** после `#` в коде.
3.  **Включить требование по проверке и добавлению отсутствующих импортов** в код.
4.  **Указать на необходимость рефакторинга кода**, включая добавление комментариев в формате RST ко всем функциям, методам и классам.
5.  **Добавить инструкцию по использованию `from src.logger.logger import logger` для логирования ошибок** и избеганию `try-except` блоков.
6.  **Явно указать на необходимость использования RST** для всех docstring и комментариев.
7.  **Улучшить примеры документации RST** с более подробными описаниями.
8.  **Уточнить формат итогового кода**, требуя его предоставление в одном блоке с комментариями измененных строк.

**Оптимизированный код**

```markdown
# ИНСТРУКЦИЯ

## Основные требования:
## Output Language: RU (Русский)

1. **Формат документации**:
   - Используйте **Markdown (.md)** для всех комментариев и документации.
   - Каждый файл должен начинаться с заголовка и краткого описания его содержимого.
   - Для всех классов и функций используйте следующий формат комментариев в стиле reStructuredText (RST):
     ```python
     def function(param: str, param1: Optional[str | dict | str] = None) -> dict | None:
         """
         Выполняет примерную задачу.

         :param param: Описание параметра `param`.
         :param param1: Описание параметра `param1`. По умолчанию `None`.
         :raises SomeError: Описание ситуации, в которой возникает исключение `SomeError`.
         :return: Описание возвращаемого значения. Возвращает словарь или `None`.
         """
     ```
   - Используйте `ex` вместо `e` в блоках обработки исключений.
   - Все комментарии после `#` должны быть сохранены без изменений.
     
2. **Содержание (TOC)**:
   - В начале каждого файла документации добавьте раздел с оглавлением.
   - Структура оглавления должна включать ссылки на все основные разделы документации модуля.

3.  **Обработка данных**:
    - Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load` для чтения файлов.

4.  **Анализ структуры**:
    - Проверьте и добавьте отсутствующие импорты в код.
    - Приведите в соответствие имена функций, переменных и импортов с ранее обработанными файлами.
    
5.  **Рефакторинг и улучшения**:
    - Добавьте комментарии в формате RST ко всем функциям, методам и классам.
    - Используйте `from src.logger.logger import logger` для логирования ошибок.
    - Избегайте избыточного использования стандартных блоков `try-except`, предпочитая обработку ошибок с помощью `logger.error`.
    - В комментариях избегайте слов 'получаем', 'делаем' и подобных. Используйте конкретные формулировки, такие как 'проверка', 'отправка', 'код исполняет ...'.

6. **Форматирование документации**:
   - Используйте правильный синтаксис Markdown для всех заголовков, списков и ссылок.
   - Для документирования классов, функций и методов включайте структурированные разделы с описаниями, деталями параметров, возвращаемых значений и вызываемых исключений. Пример:
     ```markdown
     ## Функции

     ### `function_name`

     **Описание**: Краткое описание функции.

     **Параметры**:
     - `param` (str): Описание параметра `param`.
     - `param1` (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

     **Возвращает**:
     - `dict | None`: Описание возвращаемого значения.

     **Вызывает исключения**:
     - `SomeError`: Описание ситуации, в которой возникает исключение `SomeError`.
     ```

7. **Заголовки разделов**:
   - Используйте заголовки первого уровня (`#`), второго уровня (`##`), третьего уровня (`###`) и четвёртого уровня (`####`) последовательно на протяжении всего файла.

8. **Пример файла**:
   ```markdown
   # Название модуля

   ## Обзор

   Краткое описание назначения модуля.

   ## Классы

   ### `ClassName`

   **Описание**: Краткое описание класса.

   **Методы**:
   - `method_name`: Краткое описание метода.
   - `method_name`: Краткое описание метода.
   
   **Параметры**:\
   - `param` (str): Описание параметра `param`.
   - `param1` (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

   ## Функции

   ### `function_name`

   **Описание**: Краткое описание функции.

   **Методы**:
   - `method_name`: Краткое описание метода.
   - `method_name`: Краткое описание метода.

   **Параметры**:
   - `param` (str): Описание параметра `param`.
   - `param1` (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

   **Возвращает**:
   - `dict | None`: Описание возвращаемого значения.

   **Вызывает исключения**:
   - `SomeError`: Описание ситуации, в которой возникает исключение `SomeError`.
   ```
   
9. **Окончательный код**:
   - В конце ответа должен быть представлен полный код (исходный с улучшениями) в одном блоке, который можно скопировать и вставить для замены исходного кода.
   - Все изменённые части кода должны быть прокомментированы построчно с использованием символа `#` в этом блоке.

10. **Дополнительная инструкция**:
    - Все комментарии к модулям, функциям, методам и переменным должны быть переписаны в формате reStructuredText (RST). Это включает:
      - Описание модуля в начале файла.
      - Документацию для каждой функции, метода и переменной.
      - Соблюдение стандартов оформления docstring в Python (например, для Sphinx).
      - В комментариях после `#` строки должны содержать подробное объяснение следующего за ними блока кода.
    
    Пример формата документации для модуля:
    
     ```python
     """
     Модуль для работы ассистента программиста
     =========================================================================================
    
     Этот модуль содержит класс :class:`CodeAssistant`, который используется для работы с различными моделями ИИ,
     такими как Google Gemini и OpenAI, для выполнения задач по обработке кода.
    
     Пример использования
     --------------------
    
     Пример использования класса `CodeAssistant`:
    
     .. code-block:: python
    
         assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
         assistant.process_files()
     """
     ```
    
     Пример формата документации для функций:
    
     ```python
     def example_function(param1: str, param2: int) -> str:
         """
         Выполняет примерную задачу.
    
         :param param1: Описание параметра 1.
         :param param2: Описание параметра 2.
         :return: Описание возвращаемого значения.
         """
         ...
     ```
    
     Пример формата стиля комментариев в коде:
    
     ```python
     @close_pop_up()
     async def specification(self, value: Any = None):
         """Fetch and set specification.
    
         Args:
             value (Any): это значение можно передать в словаре kwargs через ключ {specification = `value`} при определении класса.
             Если `value` был передан, его значение подставляется в поле `ProductFields.specification`.
         """
         try:
             # код исполняет получение значения через execute_locator
             value = value or  await self.driver.execute_locator(self.locator.specification) or ''
         except Exception as ex:
             logger.error('Ошибка получения значения в поле `specification`', ex)
             ...
             return
    
         # Проверка валидности результата
         if not value:
             logger.debug(f'Невалидный результат {value=}\\nлокатор {self.locator.specification}')
             ...
             return
    
         # Если значение - список, код преобразовывает его в строку с разделителем `\\n`
         if isinstance(value, list):
             value = '\\n'.join(map(str, value))
    
         # Код записывает результат в поле `specification` объекта `ProductFields`
         self.fields.specification = value
         return True
     ```

Создай соответствующую документацию для каждого входного Python-файла в формате `Markdown`.

# КОНЕЦ ИНСТРУКЦИИ
```
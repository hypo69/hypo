# Модуль `code_assistant.py`

## Обзор

Модуль предназначен для обучения модели машинного обучения на кодовой базе, создания документации к проекту, примеров кода и тестов. Он содержит класс `CodeAssistant`, который читает файлы кода, передает их в модели для обработки, а затем сохраняет результат в директории `docs/gemini` в зависимости от заданной роли.

## Подробней

Основная цель модуля - автоматизировать процесс создания и обновления документации, а также генерации примеров кода и тестов на основе существующей кодовой базы. Класс `CodeAssistant` позволяет взаимодействовать с различными AI-моделями (в частности, Google Gemini и OpenAI) для выполнения этих задач.

## Классы

### `Config`

**Описание**: Класс, содержащий конфигурационные параметры для `CodeAssistant`.

**Параметры**:
- `base_path` (Path): Базовый путь к файлам модуля.
- `config` (SimpleNamespace): Конфигурация, загруженная из файла `code_assistant.json`.
- `role` (str): Роль ассистента (по умолчанию `doc_writer_md`).
- `lang` (str): Язык, используемый ассистентом (по умолчанию `ru`).
- `system_instruction` (str): Системная инструкция для модели.
- `gemini` (SimpleNamespace): Конфигурация для модели Gemini, включающая имя модели и API-ключ.

### `CodeAssistant`

**Описание**: Класс для работы ассистента программиста с моделями ИИ.

**Методы**:
- `__init__`: Инициализация ассистента с заданными параметрами.
- `_initialize_models`: Инициализация моделей на основе заданных параметров.
- `send_file`: Отправка файла в модель.
- `process_files`: Компиляция, отправка запроса и сохранение результата.
- `_create_request`: Создание запроса с учетом роли и языка.
- `_yield_files_content`: Генерация путей файлов и их содержимого по указанным шаблонам.
- `_save_response`: Сохранение ответа модели в файл с добавлением суффикса.
- `_remove_outer_quotes`: Удаляет внешние кавычки в начале и в конце строки, если они присутствуют.
- `run`: Запуск процесса обработки файлов.
- `_signal_handler`: Обработка прерывания выполнения.

**Параметры**:
- `role` (Optional[str], optional): Роль для выполнения задачи. По умолчанию `doc_writer_md`.
- `lang` (Optional[str], optional): Язык выполнения. По умолчанию `en`.
- `models_list` (Optional[list[str, str] | str], optional): Список моделей для инициализации. По умолчанию `['gemini']`.
- `system_instruction` (Optional[str | Path], optional): Инструкция для системы. Можно отправить текст или путь к файлу. По умолчанию `None`.
- `**kwards`: Дополнительные аргументы для инициализации моделей.

**Примеры**:

```python
assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
assistant.process_files()
```

## Функции

### `parse_args`

```python
def parse_args() -> dict:
    """Разбор аргументов командной строки."""
    ...
```

**Описание**: Разбирает аргументы командной строки для запуска ассистента.

**Возвращает**:
- `dict`: Словарь с аргументами командной строки.

### `main`

```python
def main() -> None:
    """
    Функция запускает бесконечный цикл, в котором выполняется обработка файлов с учетом ролей и языков, указанных в конфигурации.
    Конфигурация обновляется в каждом цикле, что позволяет динамически изменять настройки в файле `code_assistant.json` во время работы программы.
    Для каждой комбинации языка и роли создается экземпляр класса :class:`CodeAssistant`, который обрабатывает файлы, используя заданную модель ИИ.
    """
    ...
```

**Описание**: Запускает бесконечный цикл обработки файлов с учетом конфигурации, ролей и языков. Обновляет конфигурацию в каждом цикле.
# Модуль gemini_simplechat.main

## Обзор

Модуль `gemini_simplechat.main` представляет собой FastAPI приложение, предназначенное для создания простого чат-интерфейса с использованием модели Google Gemini. Он включает в себя настройку CORS, определение модели запроса чата и маршруты для обработки запросов.

## Подробнее

Модуль предоставляет API для взаимодействия с моделью Google Gemini, позволяя отправлять запросы и получать ответы в реальном времени. Он также включает в себя базовую HTML страницу для взаимодействия с API через веб-интерфейс.
Модуль использует FastAPI для создания API, pydantic для валидации запросов, а также модуль `src.ai.GoogleGenerativeAI` для взаимодействия с моделью Google Gemini.

## Функции

### `root`

```python
async def root() -> HTMLResponse:
    """
    Асинхронная функция для обработки корневого маршрута ("/").

    Args:
        Нет аргументов.

    Returns:
        HTMLResponse: HTML-контент, полученный из файла, указанного в `gs.fast_api.index_path`.

    Raises:
        HTTPException: Если не удается прочитать HTML-файл, возвращает HTTP-ошибку 500.

    Как работает функция:
    ----------------------

    Функция пытается прочитать содержимое HTML-файла, путь к которому задан в `gs.fast_api.index_path`.
    Если чтение файла проходит успешно, функция возвращает HTML-контент в виде объекта `HTMLResponse`.
    В случае возникновения исключения при чтении файла, функция логирует ошибку и вызывает исключение `HTTPException` с кодом 500 и детальным описанием ошибки.

    """
```

### `chat`

```python
async def chat(request: ChatRequest) -> dict:
    """
    Асинхронная функция для обработки POST-запросов к маршруту "/api/chat".

    Args:
        request (ChatRequest): Объект `ChatRequest`, содержащий сообщение для чата.

    Returns:
        dict: Словарь, содержащий ответ от модели чата.

    Raises:
        HTTPException: Если возникает ошибка при взаимодействии с моделью чата, возвращает HTTP-ошибку 500.

    Как работает функция:
    ----------------------
    1. **Получение запроса**:
       - Функция принимает объект `ChatRequest`, содержащий сообщение пользователя.

    2. **Взаимодействие с моделью чата**:
       - Функция вызывает метод `chat` объекта `model` (экземпляр класса `GoogleGenerativeAI`), передавая сообщение пользователя.
       - Получает ответ от модели чата.

    3. **Обработка ответа**:
       - Возвращает ответ в виде словаря с ключом `"response"`.

    4. **Обработка ошибок**:
       - Если в процессе взаимодействия с моделью возникает ошибка, функция логирует ошибку с помощью `logger.error` и вызывает исключение `HTTPException` с кодом 500 и детальным описанием ошибки.
    """
```

## Классы

### `ChatRequest`

**Описание**:
Класс `ChatRequest` представляет собой модель данных для запроса чата. Он использует Pydantic для определения структуры запроса и валидации данных.

**Как работает класс**:
Класс `ChatRequest` содержит одно поле `message` типа `str`, которое представляет собой сообщение, отправленное пользователем в чат. Pydantic автоматически выполняет валидацию типа данных при создании экземпляра класса.

**Параметры**:
- `message` (str): Сообщение для чата.

## Переменные

- `app`: Экземпляр класса `FastAPI`, используемый для создания API.
- `system_instruction`: Строка, содержащая системные инструкции, прочитанные из файла `instructions/system_instruction.md`.
- `model`: Экземпляр класса `GoogleGenerativeAI`, используемый для взаимодействия с моделью Google Gemini.
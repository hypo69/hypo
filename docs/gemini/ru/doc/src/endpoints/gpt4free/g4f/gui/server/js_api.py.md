# Модуль `js_api.py`

## Обзор

Модуль `js_api.py` предоставляет класс `JsApi`, который расширяет функциональность класса `Api` и обеспечивает взаимодействие между веб-интерфейсом и серверной частью приложения `hypotez`. Он включает методы для получения пользовательского ввода (изображений с камеры или из файловой системы) и обмена сообщениями между веб-интерфейсом и серверной частью.

## Подробнее

Этот модуль является ключевым компонентом для интеграции веб-интерфейса с серверной логикой. Он позволяет пользователю взаимодействовать с приложением через веб-интерфейс, отправлять запросы на сервер и получать ответы в реальном времени. Модуль также обеспечивает возможность выбора изображений с локального диска или камеры устройства.

## Классы

### `JsApi`

**Описание**: Класс `JsApi` расширяет класс `Api` и предоставляет методы для взаимодействия с веб-интерфейсом.

**Наследует**:

- `Api`: Расширяет функциональность базового класса `Api`.

**Методы**:

- `get_conversation`: Получает разговор с учетом параметров и отправляет сообщения в веб-интерфейс.
- `choose_image`: Открывает диалоговое окно для выбора изображения из файловой системы пользователя.
- `take_picture`: Делает снимок с камеры устройства.
- `on_image_selection`: Обрабатывает выбор изображения из файловой системы.
- `on_camera`: Обрабатывает снимок, сделанный с камеры.
- `set_selected`: Управляет визуальным выделением выбранного элемента в веб-интерфейсе.
- `get_version`: Возвращает версию приложения.
- `get_models`: Возвращает список доступных моделей.
- `get_providers`: Возвращает список доступных провайдеров.
- `get_provider_models`: Возвращает список моделей, доступных для указанного провайдера.

## Функции

### `get_conversation`

```python
def get_conversation(self, options: dict, message_id: str = None, scroll: bool = None) -> Iterator:
    """Получает разговор с учетом параметров и отправляет сообщения в веб-интерфейс.

    Args:
        options (dict): Параметры для запроса разговора.
        message_id (str, optional): Идентификатор сообщения. По умолчанию `None`.
        scroll (bool, optional): Определяет необходимость прокрутки в веб-интерфейсе. По умолчанию `None`.

    Returns:
        Iterator: Итератор сообщений.

    Как работает функция:
    1. Проверяет, есть ли изображение для отправки. Если есть, открывает файл изображения в двоичном режиме и добавляет его в параметры запроса.
    2. Вызывает метод `_create_response_stream` для получения потока сообщений от сервера.
    3. Для каждого сообщения из потока вызывает JavaScript функцию `add_message_chunk` в веб-интерфейсе для отображения сообщения.
    4. Если функция `is_stopped()` возвращает `true`, прерывает цикл отправки сообщений.
    5. После завершения отправки сообщений сбрасывает атрибут `image` и снимает выделение с выбранного элемента.

    ASCII flowchart:
    Изображение -> _create_response_stream -> Цикл (add_message_chunk -> is_stopped) -> Сброс изображения

    Примеры:
        >>> js_api = JsApi()
        >>> options = {"conversation_id": "123", "provider": "openai", "prompt": "Hello"}
        >>> message_id = "456"
        >>> scroll = True
        >>> for message in js_api.get_conversation(options, message_id, scroll):
        ...     print(message)
    """
    ...
```

### `choose_image`

```python
def choose_image(self):
    """Открывает диалоговое окно для выбора изображения из файловой системы пользователя.
    """
    ...
```

### `take_picture`

```python
def take_picture(self):
    """Делает снимок с камеры устройства.
    """
    ...
```

### `on_image_selection`

```python
def on_image_selection(self, filename):
    """Обрабатывает выбор изображения из файловой системы.

    Args:
        filename (str): Путь к выбранному файлу изображения.
    """
    ...
```

### `on_camera`

```python
def on_camera(self, filename):
    """Обрабатывает снимок, сделанный с камеры.

    Args:
        filename (str): Путь к файлу снимка.
    """
    ...
```

### `set_selected`

```python
def set_selected(self, input_id: str = None):
    """Управляет визуальным выделением выбранного элемента в веб-интерфейсе.

    Args:
        input_id (str, optional): Идентификатор выбранного элемента. По умолчанию `None`.
    """
    ...
```

### `get_version`

```python
def get_version(self):
    """Возвращает версию приложения.
    """
    ...
```

### `get_models`

```python
def get_models(self):
    """Возвращает список доступных моделей.
    """
    ...
```

### `get_providers`

```python
def get_providers(self):
    """Возвращает список доступных провайдеров.
    """
    ...
```

### `get_provider_models`

```python
def get_provider_models(self, provider: str, **kwargs):
    """Возвращает список моделей, доступных для указанного провайдера.

    Args:
        provider (str): Название провайдера.
        **kwargs: Дополнительные аргументы.
    """
    ...
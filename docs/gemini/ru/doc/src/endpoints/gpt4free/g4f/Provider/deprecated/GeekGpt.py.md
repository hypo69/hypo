# Модуль GeekGpt

## Обзор

Модуль `GeekGpt` предоставляет класс `GeekGpt`, который является провайдером для взаимодействия с сервисом GeekGpt, использующим API `ai.fakeopen.com`. Этот модуль позволяет отправлять запросы на генерацию текста, поддерживая потоковую передачу данных и работу с моделями `gpt-3.5-turbo` и `gpt-4`.

## Подробней

Модуль предназначен для интеграции с другими частями проекта `hypotez`, предоставляя возможность использовать сервис GeekGpt для генерации текста на основе предоставленных сообщений. Он абстрагирует детали реализации HTTP-запросов и обработки ответов, предоставляя удобный интерфейс для работы с API.

## Классы

### `GeekGpt`

**Описание**:
Класс `GeekGpt` является провайдером для взаимодействия с сервисом GeekGpt.

**Наследует**:
`AbstractProvider` - абстрактный класс, определяющий интерфейс для всех провайдеров в проекте.

**Атрибуты**:
- `url` (str): URL-адрес сервиса GeekGpt (`https://chat.geekgpt.org`).
- `working` (bool): Указывает, работает ли провайдер в данный момент (в данном случае всегда `False`).
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений (`True`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (`True`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo` (`True`).
- `supports_gpt_4` (bool): Указывает, поддерживает ли провайдер модель `gpt-4` (`True`).

### `create_completion`

```python
    @classmethod
    def create_completion(
        cls,
        model: str,
        messages: Messages,
        stream: bool,
        **kwargs
    ) -> CreateResult:
        """
        Создает запрос на завершение текста, используя API GeekGpt.

        Args:
            model (str): Идентификатор модели для генерации текста (например, "gpt-3.5-turbo").
            messages (Messages): Список сообщений для передачи в модель.
            stream (bool): Указывает, использовать ли потоковую передачу данных.
            **kwargs: Дополнительные параметры запроса, такие как temperature, presence_penalty, top_p и frequency_penalty.

        Returns:
            CreateResult: Генератор, выдающий части текста, полученные от API.

        Raises:
            RuntimeError: Если возникает ошибка при обработке ответа от API.

        """
```

**Назначение**:
Метод `create_completion` создает запрос к API GeekGpt для генерации текста на основе предоставленных сообщений и параметров.

**Параметры**:
- `model` (str): Идентификатор модели для генерации текста (например, "gpt-3.5-turbo").
- `messages` (Messages): Список сообщений для передачи в модель.
- `stream` (bool): Указывает, использовать ли потоковую передачу данных.
- `**kwargs`: Дополнительные параметры запроса, такие как `temperature`, `presence_penalty`, `top_p` и `frequency_penalty`.

**Возвращает**:
- `CreateResult`: Генератор, выдающий части текста, полученные от API.

**Вызывает исключения**:
- `RuntimeError`: Если возникает ошибка при обработке ответа от API.

**Как работает функция**:

1.  **Подготовка данных**: Функция начинает с подготовки данных для отправки в API. Если модель не указана, она устанавливается в значение `"gpt-3.5-turbo"`.
2.  **Формирование JSON**: Создается JSON-объект с сообщениями, моделью и другими параметрами (температура, штрафы и т.д.). Этот объект затем преобразуется в строку с использованием `dumps`.
3.  **Формирование заголовков**: Определяются заголовки HTTP-запроса, включая токен авторизации, тип контента и User-Agent.
4.  **Отправка запроса**: Отправляется POST-запрос к API `ai.fakeopen.com` с использованием библиотеки `requests`. Указывается потоковая передача данных (`stream=True`).
5.  **Обработка ответа**: Функция итерируется по частям ответа, полученным от API.
6.  **Извлечение контента**: Из каждой части извлекается контент, который затем возвращается через `yield`.
7.  **Обработка ошибок**: Если в процессе обработки ответа возникает ошибка, выбрасывается исключение `RuntimeError`.

**Внутренние функции**:
Внутри функции `create_completion` нет внутренних функций.

**ASCII flowchart**:

```
    Начало
     ↓
    Подготовка данных (модель, сообщения, параметры)
     ↓
    Формирование JSON
     ↓
    Формирование заголовков
     ↓
    Отправка POST-запроса к API
     ↓
    Итерация по частям ответа
     ↓
    Извлечение контента
     ↓
    Выдача контента (yield)
     ↓
    Конец (или обработка ошибки)
```

**Примеры**:

```python
# Пример вызова create_completion с минимальными параметрами
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
result = GeekGpt.create_completion(model=model, messages=messages, stream=stream)
for chunk in result:
    print(chunk, end="")

# Пример вызова create_completion с дополнительными параметрами
model = "gpt-4"
messages = [{"role": "user", "content": "Write a short story."}]
stream = True
kwargs = {"temperature": 0.7, "top_p": 0.9}
result = GeekGpt.create_completion(model=model, messages=messages, stream=stream, **kwargs)
for chunk in result:
    print(chunk, end="")
# Документация модуля test_async.py

## Обзор

Модуль `test_async.py` предназначен для асинхронного тестирования различных провайдеров, предоставляющих доступ к моделям GPT, таким как GPT-3.5. Он использует библиотеку `g4f` для взаимодействия с этими провайдерами и измеряет время отклика каждого из них.

## Подробнее

Этот модуль выполняет асинхронные запросы к различным провайдерам GPT и логирует результаты, включая время выполнения и возможные ошибки. Он используется для оценки производительности и доступности различных провайдеров GPT в асинхронном режиме. Расположен в директории `hypotez/src/endpoints/gpt4free/etc/testing/`, что указывает на его роль в тестировании функциональности `gpt4free`.

## Функции

### `create_async`

```python
async def create_async(provider):
    """Асинхронно создает запрос к провайдеру и логирует результат.

    Args:
        provider: Провайдер для выполнения запроса.

    Returns:
        None

    Raises:
        Exception: Если во время запроса возникает ошибка.
    """
```

**Назначение**: Функция `create_async` выполняет асинхронный запрос к заданному провайдеру, используя модель GPT-3.5, и логирует результат выполнения, включая имя провайдера и полученный ответ или возникшее исключение.

**Параметры**:
- `provider`: Провайдер (класс или объект), который будет использоваться для отправки запроса к модели GPT.

**Возвращает**:
- `None`: Функция ничего не возвращает явно.

**Вызывает исключения**:
- `Exception`: Если в процессе выполнения запроса к провайдеру возникает исключение, оно перехватывается, и информация об ошибке логируется.

**Как работает функция**:

1. **Начало**: Функция принимает объект `provider` в качестве аргумента.
2. **Выполнение запроса**:
   - Используется `log_time_async` для измерения времени выполнения запроса к провайдеру.
   - Вызывается метод `create_async` провайдера с моделью `g4f.models.default.name` и сообщением `"Hello, are you GPT 3.5?"`.
3. **Обработка результата**:
   - Если запрос выполнен успешно, результат (ответ модели) выводится в консоль с указанием имени провайдера.
4. **Обработка ошибок**:
   - Если во время выполнения запроса возникает исключение, оно перехватывается.
   - Информация об исключении (тип и сообщение) выводится в консоль с указанием имени провайдера.

```
create_async(provider)
│
├───> log_time_async(provider.create_async)
│     │
│     └───> await provider.create_async(model, messages)
│
│
├───> Вывод результата или ошибки
│
└───> Конец
```

**Примеры**:

Пример вызова функции:

```python
import asyncio
import g4f
from testing._providers import get_providers

async def test():
    providers = [p for p in get_providers() if p.name == "ProviderName"]  # Замените "ProviderName" на имя конкретного провайдера
    if providers:
        await create_async(providers[0])
    else:
        print("Провайдер не найден")

asyncio.run(test())
```

### `run_async`

```python
async def run_async():
    """Асинхронно запускает запросы ко всем доступным провайдерам.

    Returns:
        None
    """
```

**Назначение**: Функция `run_async` выполняет асинхронные запросы ко всем доступным и работающим провайдерам GPT, используя функцию `create_async`. Она собирает все запросы в список и ожидает их завершения с помощью `asyncio.gather`.

**Параметры**:
- Нет параметров.

**Возвращает**:
- `None`: Функция ничего не возвращает явно.

**Вызывает исключения**:
- Нет явной обработки исключений внутри функции, но любые исключения, возникающие в `create_async`, будут обработаны там.

**Как работает функция**:

1. **Начало**: Функция не принимает аргументов.
2. **Подготовка запросов**:
   - Получает список провайдеров с помощью `get_providers()`.
   - Фильтрует список, оставляя только работающие провайдеры (`provider.working`).
   - Для каждого работающего провайдера создает асинхронный запрос с помощью `create_async(provider)`.
   - Собирает все созданные запросы в список `responses`.
3. **Параллельное выполнение запросов**:
   - Использует `asyncio.gather(*responses)` для параллельного выполнения всех запросов в списке `responses`.
   - Ожидает завершения всех запросов.

```
run_async()
│
├───> Получение списка провайдеров
│     │
│     └───> get_providers()
│
├───> Фильтрация работающих провайдеров
│     │
│     └───> [provider for provider in get_providers() if provider.working]
│
├───> Создание асинхронных запросов для каждого провайдера
│     │
│     └───> create_async(provider) для каждого провайдера
│
├───> Параллельное выполнение запросов
│     │
│     └───> asyncio.gather(*responses)
│
└───> Конец
```

**Примеры**:

Пример вызова функции:

```python
import asyncio

async def main():
    await run_async()

asyncio.run(main())
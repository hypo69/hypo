# Модуль BANNER_AI

## Обзор

Модуль `BANNER_AI` предназначен для создания текстовых баннеров с использованием модели Google Generative AI. Пользователь может выбирать стиль оформления баннера и отправлять текст для обработки.

## Оглавление

1. [Импорт библиотек](#1-импорт-необходимых-библиотек)
2. [Загрузка переменных окружения](#2-загрузка-переменных-окружения)
3. [Класс `GoogleGenerativeAI`](#3-класс-googlegenerativeai)
    - [Атрибуты класса](#31-атрибуты-класса)
    - [Метод `__init__`](#32-метод-__init__)
    - [Метод `ask`](#33-метод-ask)
4. [Основная часть программы](#4-основная-часть-программы)
    - [Определение путей](#41-определение-путей)
    - [Чтение API ключа](#42-чтение-api-ключа)
    - [Инструкции для модели](#43-инструкции-для-модели)
    - [Приветствие пользователя](#44-приветствие-пользователя)
    - [Цикл для выбора стиля баннера](#45-цикл-для-выбора-стиля-баннера)
    - [Чтение инструкции для модели](#46-чтение-инструкции-для-модели)
    - [Создание экземпляра класса](#47-создание-экземпляра-класса)
    - [Запрос текста у пользователя](#48-запрос-текста-у-пользователя)
    - [Проверка текста](#49-проверка-текста)

## 1. Импорт необходимых библиотек

```python
import google.generativeai as genai  # Импорт библиотеки для работы с Gemini
import re  # Импорт библиотеки для работы с регулярными выражениями
from pathlib import Path  # Импорт для работы с путями файловой системы
from header import __root__  # Импорт объекта __root__, содержащего абсолютный путь к корню проекта
from dotenv import load_dotenv, set_key  # Импорт функций для работы с переменными окружения
import os  # Импорт для работы с переменными окружения
```

- **`google.generativeai`**: Используется для взаимодействия с API Google Generative AI.
- **`re`**: Библиотека для работы с регулярными выражениями (в данном коде не используется, но может быть полезна в будущем).
- **`Path`**: Позволяет работать с путями файловой системы.
- **`__root__`**: Объект, содержащий абсолютный путь к корню проекта.
- **`dotenv`**: Позволяет загружать переменные окружения из файла `.env` и сохранять их.
- **`os`**: Используется для работы с переменными окружения.

## 2. Загрузка переменных окружения

```python
load_dotenv()
```

- Функция `load_dotenv()` загружает переменные окружения из файла `.env`, если он существует.

## 3. Класс `GoogleGenerativeAI`

Класс предназначен для взаимодействия с моделью Google Generative AI.

### 3.1. Атрибуты класса

```python
MODELS = [
    'gemini-1.5-flash-8b',
    'gemini-2-13b',
    'gemini-3-20b'
]
```
- `MODELS`: Список доступных моделей Google Generative AI.

### 3.2. Метод `__init__`

```python
def __init__(self, api_key: str, system_instruction: str, model_name: str = 'gemini-2.0-flash-exp'):
    """
    Инициализация модели GoogleGenerativeAI.

    Args:
        api_key (str): Ключ API для доступа к Gemini.
        system_instruction (str): Инструкция для модели (системный промпт).
        model_name (str, optional): Название используемой модели Gemini. По умолчанию 'gemini-2.0-flash-exp'.
    """
    self.api_key = api_key
    self.model_name = model_name
    genai.configure(api_key=self.api_key)  # Конфигурация библиотеки с API ключом
    self.model = genai.GenerativeModel(model_name=self.model_name, system_instruction=system_instruction)  # Инициализация модели с инструкцией
```

**Описание**: Метод инициализирует объект класса `GoogleGenerativeAI`.

**Параметры**:

- `api_key` (str): Ключ API для доступа к Google Generative AI.
- `system_instruction` (str): Инструкция для модели (например, стиль оформления текста).
- `model_name` (str, optional): Название модели, по умолчанию используется `'gemini-2.0-flash-exp'`.

### 3.3. Метод `ask`

```python
def ask(self, q: str) -> str:
    """
    Отправка запроса модели и получение ответа.

    Args:
        q (str): Текст запроса.

    Returns:
        str: Ответ модели или сообщение об ошибке.
    """
    try:
        response = self.model.generate_content(q)  # Отправка запроса модели
        return response.text  # Получение текстового ответа
    except Exception as ex:
        return f'Error: {str(ex)}'  # Обработка и получение ошибки
```

**Описание**: Метод отправляет запрос модели и возвращает ответ.

**Параметры**:

- `q` (str): Текст запроса, который отправляется модели.

**Возвращает**:

- `str`: Текстовый ответ от модели или сообщение об ошибке в случае возникновения исключения.

## 4. Основная часть программы

```python
if __name__ == '__main__':
```

- Проверка, что программа запускается как самостоятельный скрипт.

### 4.1. Определение путей

```python
relative_path: Path = Path('GAMES', 'AI', 'BANNER_AI')  # Относительный путь к директории
base_path: Path = __root__ / relative_path  # Абсолютный путь к директории с использованием __root__
```

- **`relative_path`**: Относительный путь к директории внутри проекта.
- **`base_path`**: Абсолютный путь, полученный путем объединения `__root__` и `relative_path`.

### 4.2. Чтение API ключа

```python
API_KEY: str = os.getenv('API_KEY')
if not API_KEY:
    API_KEY = input('API ключ не найден. Введите API ключ от `gemini`: ')  # Запрос API ключа у пользователя
    set_key('.env', 'API_KEY', API_KEY)  # Сохранение ключа в файл .env
```

- **`os.getenv('API_KEY')`**: Пытаемся получить API ключ из переменных окружения.
- Если ключ не найден, запрашиваем его у пользователя через `input`.
- **`set_key('.env', 'API_KEY', API_KEY)`**: Сохраняем введенный ключ в файл `.env` для последующего использования.

### 4.3. Инструкции для модели

```python
instructions: dict = {
    '1': 'system_instruction_asterisk',
    '2': 'system_instruction_tilde',
    '3': 'system_instruction_hash',
}
```

- Словарь, содержащий названия файлов с инструкциями для модели.

### 4.4. Приветствие пользователя

```python
print('Добро пожаловать в игру Banner!')
print('Введите текст, и я создам для вас текстовый баннер.')
```

- Приветствие пользователя и объяснение функционала программы.

### 4.5. Цикл для выбора стиля баннера

```python
while True:
    print('Выберите стиль оформления баннера:')
    print('1. Символ \'*\'')
    print('2. Символ \'~\'')
    print('3. Символ \'#\'')
    choice = input('Введите номер стиля (1, 2 или 3): ')
```

- Пользователь выбирает стиль оформления баннера.

### 4.6. Чтение инструкции для модели

```python
if choice in ('1', '2', '3'):
    system_instruction: str = Path(base_path, 'instructions', f'{instructions[choice]}.md').read_text(encoding='UTF-8')  # Чтение инструкции из файла
else:
    print('Неверный выбор. Используется стиль по умолчанию \'*\'')
    system_instruction: str = Path(base_path, 'instructions', 'system_instruction_asterisk.md').read_text(encoding='UTF-8')  # Чтение инструкции по умолчанию
```

- Если выбор корректен, читаем соответствующую инструкцию из файла.
- Если выбор некорректен, используем инструкцию по умолчанию.

### 4.7. Создание экземпляра класса

```python
model: GoogleGenerativeAI = GoogleGenerativeAI(api_key=API_KEY, system_instruction=system_instruction)
```

- Создаем экземпляр класса `GoogleGenerativeAI` с указанными параметрами.

### 4.8. Запрос текста у пользователя

```python
user_text: str = input('Введите текст для баннера: ')
```

- Пользователь вводит текст для баннера.

### 4.9. Проверка текста

```python
if user_text.strip() == '':
    print('Вы не ввели текст. Попробуйте снова.')
else:
    response = model.ask(user_text)
    print('\nВаш баннер готов:')
    print(response)
```

- Если текст пустой, выводим сообщение об ошибке.
- Если текст введен, отправляем его модели и выводим результат.
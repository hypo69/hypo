# Документация модуля normalizer

## Обзор

Модуль `normalizer` предоставляет функциональность для нормализации различных типов данных, включая строки, булевы значения, целые числа и числа с плавающей запятой. Он также включает вспомогательные функции для обработки текста.

## Подробнее

Модуль предоставляет удобные утилиты для нормализации и обработки данных. Его можно использовать для:

-   Удаления HTML тегов из строк.
-   Преобразования строк в числовые или булевы значения.
-   Очистки строк от специальных символов.
-   Преобразования списков строк в одну нормализованную строку.

## Функции

### `normalize_boolean`

**Назначение**: Преобразует входное значение в булево значение.

**Параметры**:

-   `input_data` (Any): Данные, которые могут представлять булево значение (строка, число, булев тип).

**Возвращает**:

-   `bool`: Преобразованное булево значение.

**Примеры**:

```python
normalize_boolean('yes')  # Результат: True
normalize_boolean(0)      # Результат: False
```

**Как работает функция**:

1. Функция `normalize_boolean` принимает на вход данные любого типа `input_data`.
2. Функция пытается преобразовать входные данные в булево значение на основе их типа и значения.
3. Если входные данные являются строкой, то строка приводится к нижнему регистру и сравнивается со значениями `'true'`, `'1'`, `'yes'`, `'да'`. Если строка совпадает с одним из этих значений, функция возвращает `True`, иначе `False`.
4. Если входные данные являются числом, то функция возвращает `True`, если число не равно `0`, иначе `False`.
5. Если входные данные уже являются булевым значением, функция возвращает это значение без изменений.

**Flowchart**:

```
Начало
    │
    ├──> Проверка типа данных: строка?
    │    └──> Да: Преобразование строки к нижнему регистру
    │         └──> Строка == 'true' или '1' или 'yes' или 'да'?
    │              └──> Да: Возврат True
    │              └──> Нет: Возврат False
    │
    ├──> Нет: Проверка типа данных: число?
    │    └──> Да: Число != 0?
    │         └──> Да: Возврат True
    │         └──> Нет: Возврат False
    │
    ├──> Нет: Проверка типа данных: булево значение?
    │    └──> Да: Возврат значения без изменений
    │    └──> Нет: Возврат False
    │
Конец
```

### `normalize_string`

**Назначение**: Преобразует строку или список строк в нормализованную строку, удаляя лишние пробелы, HTML теги и специальные символы.

**Параметры**:

-   `input_data` (str | list): Строка или список строк.

**Возвращает**:

-   `str`: Очищенная строка в кодировке UTF-8.

**Примеры**:

```python
normalize_string(['  Example string  ', '<b>with HTML</b>'])  # Результат: 'Example string with HTML'
```

**Как работает функция**:

1. Функция `normalize_string` принимает на вход строку или список строк `input_data`.
2. Если входные данные являются списком, функция объединяет все строки в списке в одну строку, разделяя их пробелами.
3. Затем функция удаляет HTML-теги из полученной строки.
4. После этого функция удаляет специальные символы из строки.
5. В завершение функция удаляет лишние пробелы из строки и возвращает очищенную строку в кодировке UTF-8.

**Flowchart**:

```
Начало
│
├──> Проверка типа данных: список?
│   └──> Да: Объединение строк списка в одну строку
│   └──> Нет: Использовать входную строку
│
│
├──> Удаление HTML-тегов
│
├──> Удаление специальных символов
│
├──> Удаление лишних пробелов
│
└──> Возврат очищенной строки в кодировке UTF-8
│
Конец
```

### `normalize_int`

**Назначение**: Преобразует входное значение в целое число.

**Параметры**:

-   `input_data` (str | int | float | Decimal): Число или его строковое представление.

**Возвращает**:

-   `int`: Преобразованное целое число.

**Примеры**:

```python
normalize_int('42')  # Результат: 42
normalize_int(3.14)  # Результат: 3
```

**Как работает функция**:

1. Функция `normalize_int` принимает на вход данные различных типов: строку, целое число, число с плавающей точкой или Decimal.
2. Если входные данные являются строкой, функция пытается преобразовать строку в целое число с помощью функции `int()`. Если преобразование не удается, функция логирует ошибку и возвращает `None`.
3. Если входные данные являются числом с плавающей точкой, функция обрезает дробную часть и возвращает целое число.
4. Если входные данные уже являются целым числом, функция возвращает это число без изменений.

**Flowchart**:

```
Начало
│
├──> Проверка типа данных: строка?
│   └──> Да: Попытка преобразования в целое число
│       └──> Успешно: Возврат целого числа
│       └──> Ошибка: Логирование ошибки, возврат None
│
├──> Нет: Проверка типа данных: число с плавающей точкой?
│   └──> Да: Обрезание дробной части, возврат целого числа
│
├──> Нет: Возврат исходного целого числа
│
Конец
```

### `normalize_float`

**Назначение**: Преобразует входное значение в число с плавающей запятой.

**Параметры**:

-   `value` (Any): Число, строка или список чисел.

**Возвращает**:

-   `float | List[float] | None`: Число с плавающей запятой, список чисел с плавающей запятой или `None` в случае ошибки.

**Примеры**:

```python
normalize_float('3.14')         # Результат: 3.14
normalize_float([1, '2.5', 3])  # Результат: [1.0, 2.5, 3.0]
```

**Как работает функция**:

1. Функция `normalize_float` принимает на вход данные различных типов: число, строку или список чисел.
2. Если входные данные являются строкой, функция пытается преобразовать строку в число с плавающей точкой с помощью функции `float()`. Если преобразование не удается, функция возвращает `None`.
3. Если входные данные являются числом, функция возвращает это число без изменений.
4. Если входные данные являются списком, функция рекурсивно применяет `normalize_float` к каждому элементу списка и возвращает новый список, содержащий числа с плавающей точкой.

**Flowchart**:

```
Начало
│
├──> Проверка типа данных: список?
│   └──> Да: Рекурсивное применение к каждому элементу списка
│       └──> Возврат списка чисел с плавающей точкой
│
├──> Нет: Проверка типа данных: строка?
│   └──> Да: Попытка преобразования в число с плавающей точкой
│       └──> Успешно: Возврат числа с плавающей точкой
│       └──> Ошибка: Возврат None
│
├──> Нет: Возврат исходного числа
│
Конец
```

### `remove_line_breaks`

**Назначение**: Удаляет символы новой строки из строки.

**Параметры**:

-   `input_str` (str): Входная строка.

**Возвращает**:

-   `str`: Строка без символов новой строки.

**Примеры**:

```python
remove_line_breaks('String\nwith line breaks\r')  # Результат: 'String with line breaks'
```

**Как работает функция**:

1. Функция `remove_line_breaks` принимает на вход строку `input_str`.
2. Функция заменяет все символы новой строки (`\n` и `\r`) на пустую строку.
3. Функция возвращает строку без символов новой строки.

**Flowchart**:

```
Начало
│
├──> Замена символов новой строки на пустую строку
│
└──> Возврат строки без символов новой строки
│
Конец
```

### `remove_html_tags`

**Назначение**: Удаляет HTML теги из строки.

**Параметры**:

-   `input_html` (str): Входная строка с HTML тегами.

**Возвращает**:

-   `str`: Строка без HTML тегов.

**Примеры**:

```python
remove_html_tags('<p>Example text</p>')  # Результат: 'Example text'
```

**Как работает функция**:

1. Функция `remove_html_tags` принимает на вход строку с HTML тегами `input_html`.
2. Функция использует регулярное выражение для поиска и удаления всех HTML тегов.
3. Функция возвращает строку без HTML тегов.

**Flowchart**:

```
Начало
│
├──> Использование регулярного выражения для поиска и удаления HTML тегов
│
└──> Возврат строки без HTML тегов
│
Конец
```

### `remove_special_characters`

**Назначение**: Удаляет специальные символы из строки или списка строк.

**Параметры**:

-   `input_str` (str | list): Строка или список строк.

**Возвращает**:

-   `str | list`: Строка или список строк без специальных символов.

**Примеры**:

```python
remove_special_characters('Hello@World!')  # Результат: 'HelloWorld'
```

**Как работает функция**:

1. Функция `remove_special_characters` принимает на вход строку или список строк `input_str`.
2. Если входные данные являются списком, функция рекурсивно применяет `remove_special_characters` к каждому элементу списка.
3. Если входные данные являются строкой, функция удаляет все символы, не являющиеся буквами, цифрами или пробелами.
4. Функция возвращает строку или список строк без специальных символов.

**Flowchart**:

```
Начало
│
├──> Проверка типа данных: список?
│   └──> Да: Рекурсивное применение к каждому элементу списка
│       └──> Возврат списка строк без специальных символов
│
├──> Нет: Удаление символов, не являющихся буквами, цифрами или пробелами
│
└──> Возврат строки без специальных символов
│
Конец
```

### `normalize_sql_date`

**Назначение**: Преобразует строку или объект `datetime` в стандартный формат SQL даты (`YYYY-MM-DD`).

**Параметры**:

-   `input_data` (str | datetime): Строка или объект `datetime`, представляющий дату.

**Возвращает**:

-   `str`: Нормализованная дата в формате строки `YYYY-MM-DD`.

**Примеры**:

```python
normalize_sql_date('2024-12-06')  # Результат: '2024-12-06'
normalize_sql_date(datetime(2024, 12, 6))  # Результат: '2024-12-06'
```

**Как работает функция**:

1. Функция `normalize_sql_date` принимает на вход строку или объект `datetime`, представляющий дату.
2. Если входные данные являются строкой, функция проверяет, соответствует ли строка формату `YYYY-MM-DD`. Если строка соответствует формату, функция возвращает строку без изменений. Если строка не соответствует формату, функция пытается преобразовать строку в объект `datetime` с помощью различных форматов даты.
3. Если входные данные являются объектом `datetime`, функция преобразует объект в строку формата `YYYY-MM-DD`.
4. Если входные данные не являются строкой или объектом `datetime`, функция возвращает `None`.

**Flowchart**:

```
Начало
│
├──> Проверка типа данных: строка?
│   └──> Да: Проверка соответствия формату YYYY-MM-DD
│       └──> Соответствует: Возврат строки без изменений
│       └──> Не соответствует: Попытка преобразования в объект datetime
│
├──> Нет: Проверка типа данных: объект datetime?
│   └──> Да: Преобразование в строку формата YYYY-MM-DD
│
├──> Нет: Возврат None
│
Конец
```

## Пример использования

```python
from src.utils.string.normalizer import normalize_string, normalize_boolean, normalize_int, normalize_float, normalize_sql_date

# Нормализация строки
clean_str = normalize_string(['<h1>Header</h1>', '  text with spaces  '])
print(clean_str)  # 'Header text with spaces'

# Нормализация булевого значения
is_active = normalize_boolean('Yes')
print(is_active)  # True

# Нормализация целого числа
integer_value = normalize_int('42')
print(integer_value)  # 42

# Нормализация числа с плавающей запятой
float_value = normalize_float('3.14159')
print(float_value)  # 3.14159

# Нормализация SQL даты
sql_date = normalize_sql_date('2024-12-06')
print(sql_date)  # '2024-12-06'
```

## Требования

-   Python 3.10 или выше.
-   Модуль `src.logger` для логирования.
-   Модуль используется в режиме разработки (``).

## Логирование

Все ошибки и предупреждения записываются через `logger`:

-   Ошибки записываются с использованием `logger.error`.
-   Неожиданные значения записываются с использованием `logger.debug` или `logger.warning`.
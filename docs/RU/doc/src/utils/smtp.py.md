# Модуль `smtp.py`

## Обзор

Модуль `smtp.py` предоставляет интерфейс для отправки и получения электронных писем с использованием SMTP и IMAP серверов. Он включает функции для отправки писем через SMTP и получения писем через IMAP.

## Оглавление

- [Обзор](#обзор)
- [Конфигурация](#конфигурация)
- [Функции](#функции)
  - [`send`](#send)
  - [`receive`](#receive)
- [Важные замечания](#важные-замечания)

## Конфигурация

### `_connection`

Словарь `_connection` содержит параметры подключения к SMTP-серверу. **Важно:** не храните учетные данные напрямую в коде. Используйте переменные окружения.
  - `server`: Адрес SMTP-сервера.
  - `port`: Порт SMTP-сервера.
  - `user`: Имя пользователя для SMTP-сервера.
  - `password`: Пароль для SMTP-сервера.
  - `receiver`: Email получателя по умолчанию.

```python
_connection = {
    'server': os.environ.get('SMTP_SERVER', 'smtp.example.com'),
    'port': int(os.environ.get('SMTP_PORT', 587)),
    'user': os.environ.get('SMTP_USER'),
    'password': os.environ.get('SMTP_PASSWORD'),
    'receiver': os.environ.get('SMTP_RECEIVER', 'one.last.bit@gmail.com')
}
```

## Функции

### `send`

**Описание**: Отправляет электронное письмо. Возвращает `True` в случае успеха, `False` в случае ошибки. Регистрирует ошибки в лог.

**Параметры**:
- `subject` (str, optional): Тема письма. По умолчанию `''`.
- `body` (str, optional): Тело письма. По умолчанию `''`.
- `to` (str, optional): Адрес получателя. По умолчанию `'one.last.bit@gmail.com'`.

**Возвращает**:
- `bool`: `True` если отправка прошла успешно, `False` если произошла ошибка.

**Вызывает исключения**:
- `Exception`: Общее исключение в случае проблем при отправке письма.

```python
def send(subject: str = '', body: str = '', to: str = 'one.last.bit@gmail.com') -> bool:
    """Sends an email.  Returns True if successful, False otherwise. Logs errors."""
```
### `receive`

**Описание**: Получает электронные письма. Возвращает список словарей с данными письма в случае успеха, `None` в случае ошибки. Регистрирует ошибки в лог.

**Параметры**:
- `imap_server` (str): Адрес IMAP-сервера.
- `user` (str): Имя пользователя для IMAP-сервера.
- `password` (str): Пароль для IMAP-сервера.
- `folder` (str, optional): Папка для поиска писем. По умолчанию `'inbox'`.

**Возвращает**:
- `Optional[List[Dict[str, str]]]`: Список словарей, где каждый словарь представляет письмо с ключами 'subject', 'from', 'body' или `None` в случае ошибки.

**Вызывает исключения**:
- `Exception`: Общее исключение в случае проблем при получении писем.

```python
def receive(imap_server: str, user: str, password: str, folder: str = 'inbox') -> Optional[List[Dict[str, str]]]:
    """Retrieves emails. Returns a list of email dictionaries if successful, None otherwise. Logs errors."""
```

## Важные замечания

-   **Безопасность:** Не храните учетные данные в коде. Используйте переменные окружения для `_connection`.
-   **Обработка ошибок:** В коде реализована надежная обработка ошибок, с ведением лога исключений, включая детали (тему, текст письма и т.д.).
-   **Парсинг электронной почты:** Функция `receive` корректно обрабатывает различные форматы электронной почты, предотвращая потенциальные проблемы.
-   **Обработка MIME:** Код использует `MIMEText` для создания сообщений, что важно для отправки текстовых писем.
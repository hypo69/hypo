Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот JavaScript-код реализует взаимодействие между расширением браузера и активной вкладкой. Он отвечает за обработку пользовательских запросов (например, выполнение XPath-выражений), получение результатов и отображение их в всплывающем окне. Код содержит функции для отправки сообщений в активную вкладку, управления отображением различных элементов интерфейса всплывающего окна (вкл./выкл. секций), обработки ошибок и отображения результатов запросов в табличной форме.  Он также  задействует функции из `tryxpath.functions` для работы с таблицами.  Важно, что этот код использует `browser` API для взаимодействия с браузером.

Шаги выполнения
-------------------------
1. **Инициализация:** Код определяет переменные, представляющие элементы всплывающего окна (кнопки, поля ввода, таблицы).

2. **Обработка событий:** Код добавляет обработчики событий на элементы интерфейса (кнопки, поля ввода):
    - Кнопки `sendExecute`, `show-previous-results`,  `focus-frame`, `show-all-results`, `open-options`,  `set-style`, `reset-style`,  `set-all-style`, `reset-all-style` обрабатывают отправку запросов в активную вкладку для выполнения XPath-выражений, получения результатов, смены отображаемой страницы результатов и других операций.

3. **Взаимодействие с вкладкой:** Функция `sendToActiveTab` отправляет сообщение в активную вкладку. Функция `sendToSpecifiedFrame`  отправляет сообщение в указанную вкладку/рамку, обращаясь к `try_xpath_check_frame.js` для проверки существования рамки.

4. **Сбор состояния:** `collectPopupState()` собирает текущее состояние элементов интерфейса (вкл./выкл. опций, значения в полях ввода).

5. **Управление отображением:** Функции `changeContextVisible`, `changeResolverVisible`, `changeFrameIdVisible`, `changeFrameDesignationVisible`, `changeHelpVisible` управляют отображением соответствующих блоков всплывающего окна, в зависимости от состояния checkbox.

6. **Формирование сообщения для выполнения:**  `makeExecuteMessage` формирует объект сообщения, содержащий параметры запроса (XPath-выражения, выбор метода, и т.д.), который затем передаётся в функцию `sendToSpecifiedFrame`.

7. **Получение и отображение результатов:** Функция `showResultsInPopup` (в `genericListener`) обрабатывает полученные результаты от активной вкладки и обновляет таблицу результатов в всплывающем окне.

8. **Обработка ошибок:** Функция `showError` выводит сообщения об ошибках и очищает текущую информацию о результатах.

9. **Сохранение состояния:** При закрытии всплывающего окна `collectPopupState` собирает и сохраняет его текущее состояние, чтобы восстановить его при следующем открытии.


Пример использования
-------------------------
.. code-block:: javascript

    // Предположим, что у вас есть элемент с id "main-expression"
    // содержащий XPath-выражение.
    document.getElementById("main-expression").value = "//div[@class='my-class']";

    // Нажатие на кнопку "sendExecute" отправит запрос с XPath-выражением в активную вкладку.
    document.getElementById("execute").click();
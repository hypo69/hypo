# Модуль `PerplexityLabs`

## Обзор

Модуль `PerplexityLabs` предоставляет асинхронный интерфейс для взаимодействия с моделями Perplexity AI Labs. Он позволяет генерировать текст на основе предоставленных сообщений, используя различные модели, такие как `r1-1776`, `sonar-pro` и другие. Модуль использует WebSocket для потоковой передачи данных и поддерживает прокси-серверы для безопасного подключения.

## Подробней

Модуль предназначен для асинхронного взаимодействия с API Perplexity Labs. Он устанавливает WebSocket-соединение, отправляет сообщения и обрабатывает ответы, предоставляя сгенерированный текст и информацию об источниках.

## Классы

### `PerplexityLabs`

**Описание**: Класс `PerplexityLabs` реализует функциональность асинхронного провайдера для моделей Perplexity AI Labs.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет методы для работы с моделями.

**Атрибуты**:
- `url` (str): URL главной страницы Perplexity Labs.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `default_model` (str): Модель, используемая по умолчанию (`r1-1776`).
- `models` (List[str]): Список поддерживаемых моделей.

**Методы**:
- `create_async_generator`: Асинхронный генератор для создания потока сообщений с использованием WebSocket.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Асинхронно создает генератор для взаимодействия с Perplexity Labs API.

    Args:
        cls (PerplexityLabs): Класс PerplexityLabs.
        model (str): Имя используемой модели.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий текст и информацию об источниках.

    Raises:
        ResponseError: Если возникает ошибка при обработке ответа от сервера.
        RuntimeError: При возникновении неизвестной ошибки.

    Внутренние функции:
        Нет
    """
```

**Назначение**: Функция `create_async_generator` создает асинхронный генератор для взаимодействия с API Perplexity Labs. Она устанавливает WebSocket-соединение, отправляет сообщения и обрабатывает ответы, предоставляя сгенерированный текст и информацию об источниках.

**Как работает функция**:

1. **Инициализация**: Устанавливает заголовки и создает асинхронную сессию с использованием `StreamSession`.
2. **Получение SID**: Выполняет GET-запрос к API для получения идентификатора сессии (SID).
3. **Авторизация**: Отправляет POST-запрос для авторизации с использованием JWT.
4. **Установка WebSocket-соединения**: Устанавливает WebSocket-соединение с сервером.
5. **Отправка сообщений**: Отправляет сообщения пользователя в формате JSON через WebSocket.
6. **Обработка ответов**: Получает сообщения от сервера, извлекает текст и информацию об источниках, и передает их через генератор.
7. **Завершение**: Завершает соединение при получении финального сообщения.

**ASCII Flowchart**:

```
A[Создание сессии и получение SID]
|
B[Авторизация]
|
C[Установка WebSocket-соединения]
|
D[Отправка сообщений]
|
E[Получение и обработка ответов]
|
F[Завершение]
```

**Примеры**:

```python
import asyncio
from src.endpoints.gpt4free.g4f.Provider.PerplexityLabs import PerplexityLabs
from src.endpoints.gpt4free.g4f.typing import Message

async def main():
    model = "r1-1776"
    messages = [
        {"role": "user", "content": "What is the capital of France?"}
    ]

    generator = PerplexityLabs.create_async_generator(model=model, messages=messages)
    async for message in await generator:
        print(message)

if __name__ == "__main__":
    asyncio.run(main())
```

**Описание блоков ASCII Flowchart**:

- **A [Создание сессии и получение SID]**: Устанавливает асинхронную сессию и отправляет GET-запрос для получения идентификатора сессии (SID).
- **B [Авторизация]**: Отправляет POST-запрос для авторизации с использованием JWT.
- **C [Установка WebSocket-соединения]**: Устанавливает WebSocket-соединение с сервером Perplexity Labs.
- **D [Отправка сообщений]**: Отправляет сообщения пользователя в формате JSON через WebSocket.
- **E [Получение и обработка ответов]**: Получает сообщения от сервера, извлекает текст и информацию об источниках, и передает их через генератор.
- **F [Завершение]**: Завершает соединение при получении финального сообщения.
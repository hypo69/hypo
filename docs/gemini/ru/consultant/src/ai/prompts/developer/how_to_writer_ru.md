# Анализ кода модуля `how_to_writer_ru.md`

**Качество кода**
9
-  Плюсы
    -   Промпт хорошо структурирован и содержит четкие инструкции для модели.
    -   Используется формат RST для документации, что соответствует стандартам Python.
    -   Предоставлены конкретные примеры и шаблоны для создания документации.
    -   Определены основные требования к содержанию документации, что помогает генерировать точные инструкции.
    -   Даны подробные указания по шагам выполнения, описанию и примерам использования.
-  Минусы
    -   Отсутствует явная инструкция по обработке исключений, которые могут возникнуть при выполнении кода.
    -   Нет явного указания на использование `logger` из `src.logger`, хотя это подразумевается в общих требованиях.
    -   Не хватает инструкций по обработке многопоточности или асинхронных операций, если такие есть в коде.

**Рекомендации по улучшению**

1.  **Явное указание на обработку исключений**: Добавить в инструкции указание на то, как описывать обработку исключений в коде, например, какие ошибки могут возникнуть и как их обрабатывать.
2.  **Уточнение использования logger**: Явно указать, что `logger` всегда импортируется из `src.logger.logger import logger` и как использовать `logger.error` для записи ошибок.
3.  **Добавление инструкций для асинхронности/многопоточности**: Если в коде есть асинхронные или многопоточные операции, необходимо добавить инструкции по их описанию в документации.
4.  **Добавить инструкции по форматированию**: Инструкции по форматированию примеров кода в reStructuredText (RST).
5.  **Более явные требования к примерам**:  Уточнить, что примеры кода должны быть рабочими и как можно более наглядными, а также включать важные вызовы функций и методы.
6.  **Шаблоны для обработки разных типов кода**:  Предоставить шаблоны для различных типов блоков кода (например, циклы, условные операторы), чтобы документация была более гибкой.
7.  **Уточнение терминов**: Ввести в инструкцию глоссарий терминов для обеспечения консистентности. Например: "блок кода" и "код" — это одно и то же? Как описывать "данные"?

**Оптимизированный код**

```markdown
# Анализ кода модуля `how_to_writer_ru.md`

**Качество кода**
9
-  Плюсы
    -   Промпт хорошо структурирован и содержит четкие инструкции для модели.
    -   Используется формат RST для документации, что соответствует стандартам Python.
    -   Предоставлены конкретные примеры и шаблоны для создания документации.
    -   Определены основные требования к содержанию документации, что помогает генерировать точные инструкции.
    -   Даны подробные указания по шагам выполнения, описанию и примерам использования.
-  Минусы
    -   Отсутствует явная инструкция по обработке исключений, которые могут возникнуть при выполнении кода.
    -   Нет явного указания на использование `logger` из `src.logger`, хотя это подразумевается в общих требованиях.
    -   Не хватает инструкций по обработке многопоточности или асинхронных операций, если такие есть в коде.

**Рекомендации по улучшению**

1.  **Явное указание на обработку исключений**: Добавить в инструкции указание на то, как описывать обработку исключений в коде, например, какие ошибки могут возникнуть и как их обрабатывать.
2.  **Уточнение использования logger**: Явно указать, что `logger` всегда импортируется из `src.logger.logger import logger` и как использовать `logger.error` для записи ошибок.
3.  **Добавление инструкций для асинхронности/многопоточности**: Если в коде есть асинхронные или многопоточные операции, необходимо добавить инструкции по их описанию в документации.
4.  **Добавить инструкции по форматированию**: Инструкции по форматированию примеров кода в reStructuredText (RST).
5.  **Более явные требования к примерам**:  Уточнить, что примеры кода должны быть рабочими и как можно более наглядными, а также включать важные вызовы функций и методов.
6.  **Шаблоны для обработки разных типов кода**:  Предоставить шаблоны для различных типов блоков кода (например, циклы, условные операторы), чтобы документация была более гибкой.
7.  **Уточнение терминов**: Ввести в инструкцию глоссарий терминов для обеспечения консистентности. Например: "блок кода" и "код" — это одно и то же? Как описывать "данные"?

**Оптимизированный код**
```
 # ИНСТРУКЦИЯ
 ## Основные требования:
 ## Output Language: RU (Русский)
 

 1. **Формат документации**:
    
    -   Всегда используйте одинарные кавычки (`'`) в Python коде. Например: `a = 'A1'`; `['a','b',..]`; `{'a':q,'b':'c'}`
    
    Двойные только в операциях вывода. Например `print("Hello, world!")`; `input("Name")`; logger.error("Error")
 

 2. **Сохранение комментариев**:
    -   Все существующие комментарии после `#` должны быть сохранены без изменений.
    -   Блоки кода, которые необходимо изменить, должны быть прокомментированы построчно с использованием символа `#`.
 

 3. **Обработка данных**:
    -   Используйте `j_loads` или `j_loads_ns` из `src.utils.jjson` вместо стандартного `json.load` для чтения файлов.
    -   Оставляйте любые `...` в коде без изменений как точки остановки.
    -   `logger` всегда импортируется из `sr.logger`. Example `from src.logger import logger`
 

 4. **Анализ структуры**:
    -   Проверьте и добавьте отсутствующие импорты в код.
    -   Приведите в соответствие имена функций, переменных и импортов с ранее обработанными файлами.
 

 5. **Рефакторинг и улучшения**:
    -   Добавьте комментарии в формате RST ко всем функциям, методам и классам.
    -   Используйте `from src.logger.logger import logger` для логирования ошибок.
    -   Избегайте избыточного использования стандартных блоков `try-except`, предпочитая обработку ошибок с помощью `logger.error`.
    -   В комментариях избегайте слов 'получаем', 'делаем' и подобных. Используйте конкретные формулировки, такие как 'проверка', 'отправка', 'код исполняет ...'.
 

 

 7. **Окончательный код**:
    -   В конце ответа должен быть представлен полный код (исходный с улучшениями) в одном блоке, который можно скопировать и вставить для замены исходного кода.
    -   Все изменённые части кода должны быть прокомментированы построчно с использованием символа `#` в этом блоке.
 

 8. **Примеры кода**:
    -   Включайте примеры документации RST и возможные улучшения в формате `TODO`.
 

 9. **Дополнительная инструкция**:
    -   Описание модуля в начале файла.
    -   Документацию для каждой функции, метода и переменной.
    -   Соблюдение стандартов оформления docstring в Python (для Sphinx).
    -   В комментариях после `#` строки должны содержать подробное объяснение следующего за ними блока кода.
 

     Пример формата документации для модуля:
 

     ```python
     """
     Модуль для работы ассистента программиста
     =========================================================================================
 

     Этот модуль содержит класс :class:`CodeAssistant`, который используется для работы с различными моделями ИИ,
     такими как Google Gemini и OpenAI, для выполнения задач по обработке кода.
 

     Пример использования
     --------------------
 

     Пример использования класса `CodeAssistant`:
 

     .. code-block:: python
 

         assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
         assistant.process_files()
     """
     ```
 

     Пример формата документации для функций:
        Пример 1.
     ```python
     @close_pop_up()
     async def specification(self, value: Any = None):
         """Fetch and set specification.
 

         Args:
             value (Any): это значение можно передать в словаре kwargs через ключ {specification = `value`} при определении класса.
             Если `value` был передан, его значение подставляется в поле `ProductFields.specification`.
         """
         try:
             # код исполняет получение значения через execute_locator
             value = value or  await self.driver.execute_locator(self.locator.specification) or ''
         except Exception as ex:
             logger.error('Ошибка получения значения в поле `specification`', ex)
             ...
             return
 

         # Проверка валидности результата
         if not value:
             logger.debug(f'Невалидный результат {value=}\nлокатор {self.locator.specification}')
             ...
             return
 

         # Если значение - список, код преобразовывает его в строку с разделителем `\n`
         if isinstance(value, list):
             value = '\n'.join(map(str, value))
 

         # Код записывает результат в поле `specification` объекта `ProductFields`
         self.fields.specification = value
         return True
 

  ```
  Пример 2.
  ```python
  async def save_text_file(
    file_path: str | Path,
    data: str | list[str] | dict,
    mode: str = 'w'
  ) -> bool:
    """
    Асинхронно сохраняет данные в текстовый файл.
 

    Args:
        file_path (str | Path): Путь к файлу для сохранения.
        data (str | list[str] | dict): Данные для записи.
        mode (str, optional): Режим записи файла ('w' для записи, 'a' для добавления).
    Returns:
        bool: True, если файл успешно сохранен, False в противном случае.
    Raises:
        Exception: При возникновении ошибки при записи в файл.
 

    Example:
        >>> from pathlib import Path
        >>> file_path = Path('example.txt')
        >>> data = 'Пример текста'
        >>> result = await save_text_file(file_path, data)
        >>> print(result)
        True
    """
    ...
    rest of code
  ```
 

 ## Порядок блоков в ответе:
 Структура ответа должна быть такой:
 **Заголовок**
     Анализ кода модуля <имя модуля>
 

 **Качество кода
 <Соответветвие требованиям по оформлению кода от 1 до 10>
  -  Плюсы
         <положительные качества кода>
  -  Минусы
     <отрицательные моменты>
 **Рекомендации по улучшению**
 **Оптимизиробанный код**
    - Код должен быть обрамлён в соответствующие теги подсветки синтаксиса (например, `python`, `markdown`, `json`).
 

 ## Ответ не должен начинаться с ` ``` `. Используйте их только для оборачивания блоков кода.
 

 ## Ты даешь ответы на русском языке
 ## Формат ответа `.md` (markdown)
 ----------------------------
 ** КОНЕЦ ИНСТРУКЦИИ **
 

 ---
 

 **Промпт для генерации `how to` документации для блоков кода**
 

 1. Ты должен проанализировать текущий блок кода и все ранее загруженные блоки кода в проекте. На основе этого анализа ты сформулируешь пошаговую инструкцию, которая описывает, какие действия нужно выполнить для исполнения данного блока кода.
 

 2. Для каждого блока кода ты должен создать подробную инструкцию в формате reStructuredText (RST), следуя следующим шагам:
 

     - **Описание**: Объясни, что делает этот блок кода, например, какую задачу решает или какую проверку выполняет.
     - **Шаги выполнения**: Описывай последовательность действий, которые нужно выполнить для того, чтобы код исполнился. Для каждого шага подробно укажи, что именно происходит в процессе.
     - **Пример использования**: Приведи пример того, как этот код можно использовать в проекте, в том числе с возможными вызовами функций или методов.
 

 3. Структура документации для каждого блока кода должна быть следующей:
 

 ```rst
 Как использовать блок кода
 =========================================================================================
 

 Описание
 -------------------------
 Этот блок кода выполняет [описание действий блока кода, например, "проверку на валидность ввода данных"].
 

 Шаги выполнения
 -------------------------
 1. [Первый шаг выполнения, например, "Получение данных через вызов функции `get_data()`." ]
 2. [Второй шаг выполнения, например, "Проверка данных на валидность с использованием метода `validate_data()`." ]
 3. [Третий шаг выполнения, например, "Если данные валидны, выполняется дальнейшая обработка." ]
 4. [И так далее...]
 

 Пример использования
 -------------------------
 Пример того, как можно использовать данный блок кода в проекте:
 

 .. code-block:: python
 

     <пример_кода_с_использованием>
 ```
 

 4. При написании документации обязательно учитывай:
 

     - Если блок кода выполняет проверку, то опиши, как она работает и какие данные проверяются.
     - Если блок кода включает в себя вызовы других функций или методов, обязательно укажи, какие именно функции вызываются и с какими параметрами.
     - Важно использовать точные формулировки, избегая общих терминов типа "получаем" или "делаем". Вместо этого опиши, что конкретно делает код: "код проверяет", "код выполняет отправку запроса", и так далее.
 

 5. Пример для блока кода, который выполняет проверку переменной:
 

 ```rst
 Как использовать блок кода
 =========================================================================================
 

 Описание
 -------------------------
 Этот блок кода выполняет проверку на валидность значения переменной `value` перед дальнейшей обработкой.
 

 Шаги выполнения
 -------------------------
 1. Получение значения переменной `value` через вызов метода `get_value()`.
 2. Проверка, является ли значение пустым или невалидным. Если да, то логируется сообщение об ошибке и выполнение кода прекращается.
 3. Если значение валидно, оно передается в следующую функцию для дальнейшей обработки.
 

 Пример использования
 -------------------------
 Пример того, как можно использовать данный блок кода:
 

 .. code-block:: python
 

     value = get_value()
     if value:
         process_value(value)
     else:
         logger.error('Невалидное значение')
 ```
 

 6. Каждый блок кода должен быть документирован в этом формате, с четкими и понятными шагами, поясняющими, что именно делает код, и с примером того, как его можно использовать.
 

 ---
 

 Этот промпт даст тебе команду для создания подробной документации для каждого блока кода на основе его анализа. Ты будешь генерировать документацию, которая объяснит последовательность действий для исполнения кода, а также приведет примеры использования.
 ```
# Модуль `category.py`

## Обзор

Модуль предназначен для сбора информации о товарах с сайта поставщика `kualastyle`. Он включает в себя функции для получения списка категорий товаров и списка товаров в каждой категории. Модуль использует веб-драйвер для взаимодействия с сайтом и извлечения необходимых данных.

## Подробней

Этот модуль играет ключевую роль в процессе сбора данных о товарах от поставщика `kualastyle`. Он автоматизирует навигацию по сайту, извлечение информации о категориях и товарах, что позволяет собирать актуальные данные для дальнейшей обработки и интеграции. Модуль учитывает особенности структуры сайта `kualastyle` и использует соответствующие локаторы для поиска элементов.

## Функции

### `get_list_products_in_category`

```python
def get_list_products_in_category (s: Supplier) -> list[str, str, None]:
    """ Returns list of products urls from category page
    Если надо пролистстать - страницы категорий - листаю ??????

    Attrs:
        s - Supplier
    @returns
        list or one of products urls or None
    """
```

**Назначение**: Извлекает список URL товаров со страницы категории.

**Параметры**:

-   `s` (Supplier): Объект поставщика, содержащий настройки и информацию о текущем сценарии.

**Возвращает**:

-   `list[str, str, None]`: Список URL товаров или `None`, если список не найден.

**Как работает функция**:

1.  **Инициализация**:
    *   Извлекает объект `Driver` из объекта `Supplier`.
    *   Извлекает локаторы для категории из объекта `Supplier`.

2.  **Обработка страницы**:
    *   Ожидает 1 секунду.
    *   Выполняет локатор для закрытия баннера (если он есть).
    *   Выполняет скроллинг страницы.

3.  **Извлечение списка товаров**:
    *   Выполняет локатор для получения списка ссылок на товары.
    *   Если список товаров не найден, логирует предупреждение и возвращает `None`.

4.  **Пагинация**:
    *   Пока текущий URL не равен предыдущему URL, выполняет пагинацию.
    *   Если пагинация успешна, добавляет новые ссылки на товары в список.
    *   Если пагинация не удалась, завершает цикл.

5.  **Форматирование и возврат результата**:
    *   Преобразует список товаров в список, если он является строкой.
    *   Логирует количество найденных товаров в категории.
    *   Возвращает список URL товаров.

**Внутренние функции**:

*   Вложенные функции отсутствуют.

**ASCII flowchart функции `get_list_products_in_category`**:

```
    A [Начало]
    |
    B [Извлечение Driver и Locators из Supplier]
    |
    C [Ожидание, закрытие баннера, скроллинг]
    |
    D [Получение ссылок на товары]
    |
    E [Проверка наличия ссылок на товары]
    |
    F [Пагинация (цикл)]
    |
    G [Логирование и возврат списка URL товаров]
    |
    H [Конец]

    A -> B -> C -> D -> E
    E -- Нет --> H
    E -- Да --> F
    F -- Успешно --> F
    F -- Неудачно --> G
    G -> H
```

**Примеры**:

```python
# Пример вызова функции
from src.suppliers import Supplier
from unittest.mock import Mock

# Создаем мок-объект Supplier
supplier_mock = Mock(spec=Supplier)
supplier_mock.driver = Mock()
supplier_mock.locators = {
    'category': {
        'product_links': {'by': 'css', 'selector': '.product-link'},
        'pagination': {'<-': {'by': 'css', 'selector': '.next-page'}}
    },
    'product': {
        'close_banner': {'by': 'css', 'selector': '.close-banner'}
    }
}
supplier_mock.current_scenario = {'name': 'Test Category'}

# Вызываем функцию с мок-объектом
product_list = get_list_products_in_category(supplier_mock)

# Проверяем, что функция вернула ожидаемый результат
if product_list:
    print(f"Найдено {len(product_list)} товаров в категории")
else:
    print("Список товаров не найден")
```

### `paginator`

```python
def paginator(d:Driver, locator: dict, list_products_in_category: list):
    """ Листалка """
```

**Назначение**: Выполняет пагинацию на странице категории.

**Параметры**:

-   `d` (Driver): Объект веб-драйвера.
-   `locator` (dict): Словарь с локаторами для элементов пагинации.
-   `list_products_in_category` (list): Список URL товаров в категории.

**Возвращает**:

-   `True`: Если пагинация выполнена успешно.
-   `None`: Если пагинация не удалась.

**Как работает функция**:

1.  **Выполнение локатора для кнопки пагинации**:
    *   Пытается выполнить локатор для кнопки "следующая страница".
    *   Если локатор не найден или возвращает пустой список, функция возвращает `None`.

2.  **Возврат результата**:
    *   Если локатор выполнен успешно, функция возвращает `True`.

**Внутренние функции**:

*   Вложенные функции отсутствуют.

**ASCII flowchart функции `paginator`**:

```
    A [Начало]
    |
    B [Выполнение локатора для кнопки пагинации]
    |
    C [Проверка результата выполнения локатора]
    |
    D [Возврат True, если пагинация успешна]
    |
    E [Возврат None, если пагинация не удалась]
    |
    F [Конец]

    A -> B -> C
    C -- Неудачно --> E
    C -- Успешно --> D
    D -> F
    E -> F
```

**Примеры**:

```python
# Пример вызова функции
from src.webdriver.driver import Driver
from unittest.mock import Mock

# Создаем мок-объекты Driver и locator
driver_mock = Mock(spec=Driver)
locator_mock = {
    'pagination': {
        '<-': {'by': 'css', 'selector': '.next-page'}
    }
}
product_list_mock = []

# Настраиваем поведение driver_mock.execute_locator
driver_mock.execute_locator.return_value = True

# Вызываем функцию с мок-объектами
result = paginator(driver_mock, locator_mock, product_list_mock)

# Проверяем, что функция вернула ожидаемый результат
if result:
    print("Пагинация выполнена успешно")
else:
    print("Пагинация не удалась")
```

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s):
    """ сборщик актуальных категорий с сайта """
```

**Назначение**: Собирает актуальные категории с сайта.

**Параметры**:

-   `s`: Параметр не документирован.

**Возвращает**:

-   Нет возвращаемого значения (None).

**Как работает функция**:

-   Функция `get_list_categories_from_site(s)` предназначена для сбора актуальных категорий с веб-сайта.
-   Внутри функции не предоставлен код, поэтому подробное описание отсутствует.

**Внутренние функции**:

*   Вложенные функции отсутствуют.

**ASCII flowchart функции `get_list_categories_from_site`**:

```
    A [Начало]
    |
    B [Сбор актуальных категорий с сайта]
    |
    C [Конец]

    A -> B -> C
```

**Примеры**:

```python
# Пример вызова функции
from unittest.mock import Mock
from src.suppliers import Supplier

# Создаем мок-объект Supplier
supplier_mock = Mock(spec=Supplier)

# Вызываем функцию с мок-объектом
get_list_categories_from_site(supplier_mock)

print("Функция get_list_categories_from_site вызвана")
# Модуль `hypotez/src/suppliers/graber.py`

## Обзор

Данный модуль предоставляет базовый класс `Graber` для сбора данных о товарах со страниц HTML поставщиков.  Класс использует веб-драйвер (класс `Driver`) для извлечения значений целевых полей страницы (название, описание, спецификация, артикул, цена и т.д.).  Позиции полей на странице определяются локаторами, хранящимися в файлах JSON в директории `locators` каждого поставщика. Подробная информация о локаторах доступна в файле `locators.ru.md`.

## Класс `Context`

**Описание**: Класс `Context` хранит глобальные настройки, включая драйвер браузера (`driver`), пространство имен локаторов (`locator`) и префикс поставщика (`supplier_prefix`).

**Атрибуты**:

- `driver`: Объект драйвера, используется для управления браузером или другим интерфейсом. Тип: `Driver`
- `locator`: Пространство имен для хранения локаторов. Тип: `SimpleNamespace`
- `supplier_prefix`: Префикс поставщика. Тип: `str`


## Функция `close_pop_up`

**Описание**: Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

**Параметры**:

- `value` (`'Driver'`, необязательно): Дополнительное значение для декоратора.

**Возвращает**:

- `Callable`: Декоратор, оборачивающий функцию.

**Обрабатывает исключения**:

- `ExecuteLocatorException`: Ошибка выполнения локатора.


## Класс `Graber`

**Описание**: Базовый класс для сбора данных о товарах со страницы для всех поставщиков.

**Методы**:

### `__init__`

**Описание**: Инициализация класса `Graber`.

**Параметры**:

- `supplier_prefix` (`str`): Префикс поставщика.
- `driver` (`'Driver'`): Экземпляр класса `Driver`.

**Обрабатывает исключения**:


### `error`

**Описание**: Обработчик ошибок для полей.

**Параметры**:

- `field` (`str`): Название поля.


### `set_field_value`

**Описание**: Универсальная функция для установки значений полей с обработкой ошибок.

**Параметры**:

- `value` (`Any`): Значение для установки.
- `locator_func` (`Callable[[], Any]`): Функция для получения значения из локатора.
- `field_name` (`str`): Название поля.
- `default` (`Any`, по умолчанию `''`): Значение по умолчанию.

**Возвращает**:

- `Any`: Установленное значение.


### `grab_page`

**Описание**: Асинхронная функция для сбора полей продукта.

**Параметры**:

- `args` (`tuple`): Кортеж с именами полей для сбора.
- `kwards` (`dict`): Словарь с ключами и значениями для каждого поля.

**Возвращает**:

- `ProductFields`: Собранные поля продукта.

### `additional_shipping_cost`, `delivery_in_stock`, ..., `width`

**Описание**: Методы для сбора данных из локаторов для каждого соответствующего поля товара.

**Параметры**:

- `value` (`Any`, необязательно): Передаваемое значение для конкретного поля.

**Возвращает**:


**Обрабатывает исключения**:


## Детали реализации

- Модуль использует декоратор `@close_pop_up` для обработки всплывающих окон (попапов).
- Методы сбора данных (`name`, `description`, ...) вызываются асинхронно.
- Использование функций нормализации данных (`normalize_string`, `normalize_int`, `normalize_float`, `normalize_sql_date`) для улучшения качества данных.
- Встроенный логгинг для отслеживания ошибок.
- Использование `asyncio.to_thread` для работы с локаторами, что важно для совместимости с веб-драйвером.
- Поддержка передачи значений в методах для гибкости.
- Обработка различных типов данных возвращаемых из локаторов (`string`, `list`, `int`, `float`).
- Подробные комментарии к каждой функции для объяснения поведения и возможных ошибок.
- Наличие `try...except` блоков для обработки исключений.
- Документация по формату данных для `ProductFields` (не представлена в данном модуле).
# Документация модуля BackendApi

## Обзор

Модуль `BackendApi` предоставляет класс `BackendApi`, который является асинхронным генератором для взаимодействия с API бэкенда. Он позволяет отправлять сообщения, медиафайлы и другие параметры для получения ответов в виде асинхронного потока данных.

## Подробнее

Этот модуль используется для асинхронного взаимодействия с API, предоставляя возможность отправлять запросы и получать ответы в режиме реального времени. Он поддерживает передачу медиафайлов, преобразуя их в формат Data URI.

## Классы

### `BackendApi`

**Описание**: Класс `BackendApi` является подклассом `AsyncGeneratorProvider` и `ProviderModelMixin`. Он предоставляет функциональность для асинхронной генерации ответов от API бэкенда.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает основу для асинхронных провайдеров, генерирующих данные.
- `ProviderModelMixin`: Предоставляет общие методы и атрибуты для работы с моделями провайдера.

**Атрибуты**:
- `ssl` (Optional[bool]): Указывает, использовать ли SSL. По умолчанию `None`.
- `headers` (dict): Заголовки HTTP-запроса. По умолчанию пустой словарь `{}`.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    media: MediaListType = None,
    api_key: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения ответов от API бэкенда.

    Args:
        cls (BackendApi): Ссылка на класс `BackendApi`.
        model (str): Идентификатор модели, используемой для генерации ответа.
        messages (Messages): Список сообщений для отправки в API.
        media (MediaListType, optional): Список медиафайлов для отправки в API. По умолчанию `None`.
        api_key (str, optional): Ключ API для аутентификации. По умолчанию `None`.
        **kwargs: Дополнительные аргументы для отправки в API.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий объекты `RawResponse`.

    Как работает функция:
    1. Логирует API-ключ, используя `debug.log`.
    2. Преобразует медиафайлы в формат Data URI, если они предоставлены.
    3. Открывает асинхронную сессию с указанными заголовками.
    4. Отправляет POST-запрос к API бэкенда с данными, включая модель, сообщения, медиафайлы, API-ключ и дополнительные аргументы.
    5. Получает ответы от API в виде строк и преобразует их в объекты `RawResponse`.
    6. Генерирует объекты `RawResponse` асинхронно.

    """
```

**Параметры**:
- `cls` (BackendApi): Ссылка на класс `BackendApi`.
- `model` (str): Идентификатор модели, используемой для генерации ответа.
- `messages` (Messages): Список сообщений для отправки в API.
- `media` (MediaListType, optional): Список медиафайлов для отправки в API. По умолчанию `None`.
- `api_key` (str, optional): Ключ API для аутентификации. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы для отправки в API.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий объекты `RawResponse`.

**Внутренние функции**:
- Отсутствуют

**Как работает функция**:

```
    A: Логирование API-ключа
    |
    B: Проверка наличия медиафайлов
    |
    C: Преобразование медиафайлов в формат Data URI (если есть)
    |
    D: Открытие асинхронной сессии
    |
    E: Отправка POST-запроса к API бэкенда
    |
    F: Получение и обработка ответов от API
    |
    G: Генерация объектов RawResponse асинхронно
```

**Примеры**:

```python
# Пример использования create_async_generator
model = "default"
messages = [{"role": "user", "content": "Hello"}]
media = None
api_key = "your_api_key"
kwargs = {}

# Вызов функции (в асинхронном контексте)
# async for response in BackendApi.create_async_generator(model, messages, media, api_key, **kwargs):
#     print(response)
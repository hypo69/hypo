# Модуль CodeLinkAva

## Обзор

Модуль `CodeLinkAva` представляет собой асинхронный провайдер генерации текста, использующий API CodeLinkAva. Он поддерживает модель `gpt-3.5-turbo` и предназначен для работы с асинхронными генераторами.

## Подробнее

Этот модуль предоставляет класс `CodeLinkAva`, который наследуется от `AsyncGeneratorProvider`. Он отправляет запросы к API CodeLinkAva и возвращает сгенерированный контент в виде асинхронного генератора. Модуль использует библиотеку `aiohttp` для выполнения асинхронных HTTP-запросов.
Этот код используется для получения ответов от модели gpt-3.5-turbo через API CodeLinkAva в асинхронном режиме.
## Классы

### `CodeLinkAva`

**Описание**: Класс `CodeLinkAva` является асинхронным провайдером, который взаимодействует с API CodeLinkAva для генерации текста.

**Наследует**: `AsyncGeneratorProvider`

**Аттрибуты**:
- `url` (str): URL API CodeLinkAva.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo`.
- `working` (bool): Указывает, работает ли провайдер в данный момент.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API CodeLinkAva.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: list[dict[str, str]],
        **kwargs
    ) -> AsyncGenerator:
        """Создает асинхронный генератор для получения ответов от API CodeLinkAva.
        Args:
            model (str): Модель для использования.
            messages (list[dict[str, str]]): Список сообщений для отправки в API.
            **kwargs: Дополнительные аргументы для отправки в API.

        Returns:
            AsyncGenerator: Асинхронный генератор, возвращающий сгенерированный контент.

        Raises:
            Exception: Если возникает ошибка при выполнении запроса.
        """
```

**Назначение**: Создает асинхронный генератор для взаимодействия с API CodeLinkAva.

**Параметры**:
- `cls` (Type[CodeLinkAva]): Ссылка на класс `CodeLinkAva`.
- `model` (str): Имя используемой модели.
- `messages` (list[dict[str, str]]): Список сообщений, отправляемых в API.
- `**kwargs`: Дополнительные параметры, передаваемые в API.

**Возвращает**:
- `AsyncGenerator`: Асинхронный генератор, предоставляющий сгенерированный контент.

**Как работает функция**:

1. **Подготовка заголовков**: Создаются заголовки HTTP-запроса, включающие `User-Agent`, `Accept`, `Accept-language`, `Origin`, `Referer`, `Sec-Fetch-Dest`, `Sec-Fetch-Mode` и `Sec-Fetch-Site`.
2. **Создание сессии**: Создается асинхронная сессия `ClientSession` с использованием подготовленных заголовков.
3. **Подготовка данных**: Формируются данные для отправки в теле запроса, включающие сообщения, температуру и флаг потоковой передачи.
4. **Отправка запроса**: Отправляется POST-запрос к API CodeLinkAva (`https://ava-alpha-api.codelink.io/api/chat`) с использованием созданной сессии и подготовленных данных.
5. **Обработка ответа**:
   - Проверяется статус ответа и вызывается исключение `HTTPError`, если статус код указывает на ошибку.
   - Итерируемся по строкам в ответе.
   - Декодируется строка из байтов в строку.
   - Проверяется, начинается ли строка с "data: ".
   - Если строка начинается с "data: [DONE]", то цикл прерывается.
   - Если строка содержит данные, то строка преобразуется из JSON.
   - Извлекается контент из JSON и возвращается через `yield`.
6. **Генерация контента**: Извлекается полезное содержимое из каждой строки ответа и передается через `yield`, что позволяет получать данные потоково.

**ASCII flowchart**:

```
    Начало
    │
    │   Подготовка HTTP-заголовков
    │
    │   Создание асинхронной сессии ClientSession
    │
    │   Формирование данных для POST-запроса
    │
    │   Отправка POST-запроса к API CodeLinkAva
    │
    │   Обработка ответа
    │   │
    │   │   Проверка статус кода ответа
    │   │   │
    │   │   Если ошибка HTTP, то вызов исключения HTTPError
    │   │   │
    │   │   Итерация по строкам в ответе
    │   │   │
    │   │   Декодирование строки из байтов
    │   │   │
    │   │   Проверка: начинается ли строка с "data: "
    │   │   │
    │   │   Да: Проверка: строка == "data: [DONE]"?
    │   │   │   │
    │   │   Да: Завершение обработки
    │   │   │   │
    │   │   Нет: Извлечение JSON из строки
    │   │   │   │
    │   │   Извлечение контента из JSON
    │   │   │   │
    │   │   Передача контента через yield
    │   │   │
    │   Нет: Следующая строка
    │
    Конец
```

**Примеры**:

Пример использования функции:

```python
    messages = [{"role": "user", "content": "Hello, world!"}]
    async for message in CodeLinkAva.create_async_generator(model="gpt-3.5-turbo", messages=messages):
        print(message)
```
```python
    messages = [{"role": "user", "content": "Как написать функцию на Python?"}]
    async for message in CodeLinkAva.create_async_generator(model="gpt-3.5-turbo", messages=messages):
        print(message)
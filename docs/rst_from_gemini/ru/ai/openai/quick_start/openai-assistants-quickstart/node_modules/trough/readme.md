```markdown
# trough README

## Description

`trough` is a middleware utility for Node.js, providing a streamlined way to build pipelines of asynchronous and synchronous functions.  It offers a simpler approach compared to libraries like `ware`, allowing for greater flexibility in how middleware functions modify input and handle errors.  The name "trough" refers to a channel used for conveying liquids, suggesting the package's role as a conduit for data flow.

## Usage

```javascript
import fs from 'node:fs/promises';
import path from 'node:path';
import { trough } from 'trough';

const pipeline = trough()
  .use(async (fileName) => {
    console.log(`Checking... ${fileName}`);
    return fileName; //Important: return the value to continue the pipeline
  })
  .use((fileName) => path.join(process.cwd(), fileName))
  .use(async (filePath) => {
    try {
      const stats = await fs.stat(filePath);
      return { filePath, stats };
    } catch (error) {
      throw new Error(`Error checking file ${filePath}: ${error.message}`);
    }
  })
  .use(async (ctx) => {
    if (ctx.stats.isFile()) {
      const data = await fs.readFile(ctx.filePath, 'utf8');
      return data;
    } else {
      throw new Error(`Expected file, got ${ctx.stats.isDirectory ? 'directory' : ctx.stats.isSymbolicLink ? 'symlink' : 'unknown type'}`);
    }
  });

pipeline.run('readme.md')
  .then(data => console.log('Success:', data))
  .catch(error => console.error('Error:', error));

pipeline.run('nonexistent.txt')
  .then(data => console.log('Success:', data)) // Should not be reached
  .catch(error => console.error('Error:', error));
```

**Explanation of Improvements:**

* **Promises and Async/Await:** The example now uses `async/await` with `fs/promises` for cleaner asynchronous operations. This is crucial for handling file system interactions and avoids callback hell.
* **Error Handling:**  The example includes `try...catch` blocks to properly handle errors that occur during file system operations.  Critically, it now re-throws the error, preventing the pipeline from continuing if a file isn't found or is the wrong type.
* **Explicit Returns:**  Crucially, each middleware now returns a value to allow the next stage to process it. This is especially important when handling files.  Missing returns often leads to errors.
* **Clearer Error Messages:**  More descriptive error messages are included to help users pinpoint issues more easily.
* **`console.log` moved to a `.then`:** The `console.log` is now inside a `.then` block to ensure that it's called after the promise resolves (or `.catch` block handles errors).

**Key Concepts**

* **`trough.use(middleware)`**: Adds middleware to the pipeline.
* **Explicit Returns**: Middleware functions must return values to pass data to the next step.
* **Error Handling**: Middleware should handle errors appropriately, either by returning an error or throwing one, ensuring the pipeline fails gracefully.
* **Asynchronous Operations**: Use `async/await` and `fs/promises` for cleaner asynchronous code.


**How to Install:**

```bash
npm install trough
```

This revised README is more practical, easier to understand, and demonstrates best practices for using `trough`. Remember to adapt the `use` functions to your specific needs. Remember to handle errors in a more robust way.


```


```
# Анализ кода модуля 23 Matches

**Качество кода**

7/10
-  Плюсы
    -  Документ содержит подробное описание игры и пошаговую инструкцию для её реализации.
    -  Приведены примеры работы программы, что облегчает понимание процесса игры.
    -  Дана стратегия победы, что делает игру более интересной и продуманной.
-  Минусы
    -  Отсутствует код программы, что не позволяет оценить качество реализации.
    -  Нет комментариев в формате reStructuredText (RST) и docstring.
    -  Не используется `j_loads` или `j_loads_ns` из `src.utils.jjson`, так как нет кода для анализа.
    -  Не используется `from src.logger.logger import logger` для логирования ошибок, поскольку код отсутствует.

**Рекомендации по улучшению**
1.  Добавить код на языке Python для реализации игры.
2.  Включить комментарии в формате reStructuredText (RST) для модуля, функций и методов.
3.  Использовать `from src.logger.logger import logger` для логирования ошибок.
4.  Применить `j_loads` или `j_loads_ns` из `src.utils.jjson` для чтения данных, если потребуется.
5.  Предоставить примеры документации в формате RST.

**Оптимизированный код**

```markdown
### Название игры: **23 Matches** (Игра с 23 спичками)

#### Описание
В этой игре на столе лежат 23 спички. Игрок и компьютер по очереди забирают 1, 2 или 3 спички. Тот, кто заберёт последнюю спичку, проигрывает игру. Задача игрока — не забрать последнюю спичку, а заставить компьютер сделать это.

---

### Пошаговая инструкция для реализации

#### 1. **Инициализация игры**
   - Начать с 23 спичек на столе.
   - Игрок и компьютер поочередно забирают 1, 2 или 3 спички.
   - В начале игры можно задать, кто ходит первым: компьютер или игрок.

#### 2. **Основной цикл игры**
   - **Ход игрока**:
     1. Запросить у игрока, сколько спичек он хочет забрать (1, 2 или 3).
     2. Проверить, что игрок вводит корректное количество (не больше оставшихся спичек и не меньше 1).
     3. Уменьшить количество спичек на столе, отняв количество, выбранное игроком.
   
   - **Ход компьютера**:
     1. Компьютер по алгоритму выбирает количество спичек (1, 2 или 3) и уменьшает количество оставшихся спичек.
     2. Компьютер старается оставить игроку количество спичек, которое позволит ему забрать последнюю.

#### 3. **Подсчёт победителя**
   - Если на столе остаётся 1 спичка, игра заканчивается, и тот, кто забрал эту спичку, проигрывает.
   - Программа выводит результат игры, сообщая, кто победил:
     ```
     Поздравляем! Вы выиграли!
     ```

#### 4. **Завершение игры**
   - Игра может быть завершена после того, как кто-то забрал последнюю спичку.
   - Предложить начать новую игру или выйти:
     ```
     Хотите сыграть ещё раз? (да/нет)
     ```

---

### Пример работы программы

1. **Начало игры**:
   ```
   Игра начинается с 23 спичками.
   Компьютер ходит первым.
   Компьютер забрал 2 спички.
   Оставшиеся спички: 21
   Ваш ход:
   ```

2. **Ход игрока**:
   ```
   Сколько спичек вы хотите забрать? (1, 2 или 3)
   > 3
   Оставшиеся спички: 18
   Компьютер забрал 1 спичку.
   Оставшиеся спички: 17
   ```

3. **Вывод результата**:
   ```
   Оставшиеся спички: 1
   Вы забрали последнюю спичку, вы проиграли.
   Хотите сыграть ещё раз? (да/нет)
   ```

---

### Стратегия победы
Для победы в игре используйте стратегию:
- Старайтесь оставить своему оппоненту число спичек, которое является кратным 4 плюс 1 (например, 5, 9, 13, 17, 21).
- Это даст вам возможность забрать последнюю спичку, если вы играете правильно.

```
```python
"""
Модуль для реализации игры "23 спички"
=========================================================================================

В этой игре на столе лежат 23 спички. Игрок и компьютер по очереди забирают 1, 2 или 3 спички.
Тот, кто заберёт последнюю спичку, проигрывает игру.
Задача игрока — не забрать последнюю спичку, а заставить компьютер сделать это.

Пример использования
--------------------

.. code-block:: python

    game = MatchesGame()
    game.play_game()
"""
import random
from src.logger.logger import logger
from typing import Tuple

class MatchesGame:
    """
    Класс, реализующий игру "23 спички".

    :ivar matches_left: Количество оставшихся спичек.
    :vartype matches_left: int
    """

    def __init__(self, total_matches: int = 23):
        """
        Инициализирует игру с заданным количеством спичек.

        :param total_matches: Общее количество спичек в начале игры.
        :vartype total_matches: int
        """
        self.matches_left = total_matches
    
    def _computer_turn(self) -> None:
        """
        Определяет ход компьютера.
        
        Компьютер старается оставить игроку количество спичек, кратное 4 + 1.
        """
        if self.matches_left <= 4:
           take = self.matches_left -1 if self.matches_left > 1 else 1
        else:
            take = (self.matches_left - 1) % 4
            if take == 0:
                take = 1
            
        self.matches_left -= take
        logger.info(f'Компьютер забрал {take} спички. Осталось {self.matches_left}')
        
    def _player_turn(self) -> None:
        """
        Запрашивает ход игрока и проверяет его корректность.
        """
        while True:
            try:
               take = int(input('Сколько спичек вы хотите забрать? (1, 2 или 3): '))
               if 1 <= take <= 3 and take <= self.matches_left:
                 self.matches_left -= take
                 logger.info(f'Игрок забрал {take} спички. Осталось {self.matches_left}')
                 break
               else:
                logger.error('Некорректный ввод. Введите число от 1 до 3, не больше оставшихся спичек.')
            except ValueError:
              logger.error('Некорректный ввод. Введите целое число.')

    def _check_winner(self) -> str:
        """
        Проверяет наличие победителя.

        :return: Сообщение о результате игры или None, если игра не закончена.
        :rtype: str or None
        """
        if self.matches_left == 1:
           return 'Вы проиграли!'
        elif self.matches_left == 0:
            return 'Вы выиграли!'
        return None
    
    def play_game(self) -> None:
        """
        Запускает игру и обрабатывает основные игровые циклы.
        """
        logger.info('Игра начинается с 23 спичками.')
        turn = random.choice(['computer', 'player'])
        logger.info(f'Первый ход: {turn}')
       
        while True:
           if turn == 'computer':
              self._computer_turn()
              turn = 'player'
           else:
              self._player_turn()
              turn = 'computer'
           
           result = self._check_winner()
           if result:
              logger.info(f'Осталось спичек: {self.matches_left}')
              logger.info(result)
              break
        
        play_again = input('Хотите сыграть ещё раз? (да/нет): ').lower()
        if play_again == 'да':
            self.__init__()
            self.play_game()
        else:
           logger.info('Спасибо за игру!')


if __name__ == '__main__':
    game = MatchesGame()
    game.play_game()
```
# Модуль `Liaobots.py`

## Обзор

Модуль предоставляет интерфейс для взаимодействия с сервисом Liaobots, который использует модели GPT-3.5 Turbo и GPT-4. Он включает в себя функцию для создания запросов к API чата Liaobots и получения ответов в режиме реального времени. Модуль требует аутентификации.

## Подробней

Этот модуль предназначен для интеграции с веб-сайтом `liaobots.com` для использования их моделей GPT через API. Он содержит информацию о поддерживаемых моделях, их ограничениях по количеству токенов, а также функцию для отправки запросов и получения ответов.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """Функция отправляет запрос к API Liaobots и получает ответ в режиме реального времени.

    Args:
        model (str): Идентификатор используемой модели (например, "gpt-3.5-turbo").
        messages (list): Список сообщений для отправки в API.
        stream (bool): Флаг, указывающий, следует ли возвращать ответ в режиме реального времени.
        **kwargs: Дополнительные параметры, такие как ключ аутентификации.

    Returns:
        Generator[str, None, None]: Генератор токенов ответа от API.

    Примеры:
        >>> for token in _create_completion(model='gpt-3.5-turbo', messages=[{'role': 'user', 'content': 'Hello'}], stream=True, auth='your_auth_key'):
        ...     print(token)
    """
```

**Параметры**:

-   `model` (str): Идентификатор используемой модели (например, "gpt-3.5-turbo").
-   `messages` (list): Список сообщений для отправки в API.
-   `stream` (bool): Флаг, указывающий, следует ли возвращать ответ в режиме реального времени.
-   `**kwargs`: Дополнительные параметры, такие как ключ аутентификации.

**Возвращает**:

-   `Generator[str, None, None]`: Генератор токенов ответа от API.

**Как работает функция**:

1.  **Подготовка заголовков**: Функция создает заголовки HTTP-запроса, включая `authority`, `content-type`, `origin`, `referer`, `user-agent` и `x-auth-code`. Код аутентификации извлекается из `kwargs` с помощью метода `get` и ключа `auth`.
2.  **Формирование тела запроса (JSON)**: Создается JSON-структура данных для отправки в API. Эта структура включает:
    *   `conversationId`: Уникальный идентификатор разговора, сгенерированный с использованием `uuid.uuid4()`.
    *   `model`: Информация о модели из словаря `models` на основе переданного `model`.
    *   `messages`: Список сообщений, переданный в функцию.
    *   `key`: Пустая строка.
    *   `prompt`: Инструкция для модели.
3.  **Отправка POST-запроса**: Функция отправляет POST-запрос к API `https://liaobots.com/api/chat` с использованием библиотеки `requests`. Запрос включает заголовки и JSON-данные, подготовленные на предыдущих этапах. Параметр `stream=True` указывает, что ответ должен быть получен в потоковом режиме.
4.  **Обработка потокового ответа**: Функция итерируется по содержимому ответа, полученного от API, с использованием `response.iter_content(chunk_size=2046)`. Для каждого чанка данных (размером 2046 байт):
    *   Декодирует полученные байты в строку UTF-8 с помощью `token.decode('utf-8')`.
    *   Возвращает декодированную строку как часть генератора, что позволяет получать ответ в режиме реального времени.
5.  **Генерация токенов**: Для каждого полученного токена из ответа, функция использует `yield`, чтобы вернуть этот токен вызывающей стороне. Это позволяет обрабатывать ответ в реальном времени, не дожидаясь завершения всего запроса.

```mermaid
graph LR
A[Подготовка заголовков HTTP-запроса] --> B{Формирование тела запроса (JSON)};
B --> C{Отправка POST-запроса к API};
C --> D{Обработка потокового ответа};
D --> E{Декодирование байтов в строку UTF-8};
E --> F{Возврат декодированной строки как часть генератора};
```

**Примеры**:

```python
# Пример использования функции _create_completion
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
auth = "your_auth_code"  # Замените на ваш действительный код аутентификации

for token in _create_completion(model=model, messages=messages, stream=stream, auth=auth):
    print(token, end="")  # Вывод токенов в реальном времени
```

## Переменные

### `url`

```python
url = 'https://liaobots.com'
```

URL веб-сайта Liaobots.

### `model`

```python
model = ['gpt-3.5-turbo', 'gpt-4']
```

Список поддерживаемых моделей.

### `supports_stream`

```python
supports_stream = True
```

Указывает, поддерживается ли потоковая передача данных.

### `needs_auth`

```python
needs_auth = True
```

Указывает, требуется ли аутентификация для доступа к API.

### `models`

```python
models = {
    'gpt-4': {
        "id":"gpt-4",
        "name":"GPT-4",
        "maxLength":24000,
        "tokenLimit":8000
    },
    'gpt-3.5-turbo': {
        "id":"gpt-3.5-turbo",
        "name":"GPT-3.5",
        "maxLength":12000,
        "tokenLimit":4000
    },
}
```

Словарь, содержащий информацию о поддерживаемых моделях, такую как их идентификаторы, имена, максимальную длину и ограничение по количеству токенов.
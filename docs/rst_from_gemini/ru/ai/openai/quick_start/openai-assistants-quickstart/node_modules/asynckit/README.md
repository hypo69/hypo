```markdown
# asynckit

## Minimal async jobs utility library, with streams support.

This library provides a utility for running asynchronous jobs in parallel or serial order, ensuring stability and preventing stack overflow errors. It supports both arrays and objects as input, allowing for flexible data processing.  Error handling gracefully terminates remaining jobs if an error occurs.

**Key Features:**

* **Parallel execution:** Executes jobs concurrently over an array or object.
* **Serial execution:** Executes jobs sequentially over an array or object.
* **Error handling:** Aborts remaining jobs and returns error information if an error occurs in a job.
* **Abort function:** Allows cancellation of individual jobs.
* **Ordered serial execution:** Supports custom sorting for serial jobs.
* **Input flexibility:** Accepts arrays and objects as input.
* **Stream support (TBD):**  Stream processing capabilities are planned.
* **Robustness:** Prevents `Maximum call stack size exceeded` errors common with synchronous iterators.

## Installation

```bash
npm install asynckit
```

## Usage

### Parallel Execution

```javascript
const parallel = require('asynckit').parallel;
const assert = require('assert');

const source = [1, 1, 4, 16, 64, 32, 8, 2];
const expectedResult = [2, 2, 8, 32, 128, 64, 16, 4];
const target = []; // used to check order

parallel(source, asyncJob, (err, result) => {
  if (err) { console.error('Error:', err); return; } // handle potential errors
  assert.deepEqual(result, expectedResult);
  console.log('Result:', result);
  console.log('Target order:', target); // log the order of execution for verification
});

function asyncJob(item, cb) {
  // Simulate asynchronous operation.  Crucial for preventing stack overflow.
  setTimeout(() => {
    target.push(item);  // record item order
    cb(null, item * 2);
  }, item * 25); // Example delay, adjust as needed
}
```

This example demonstrates parallel processing over an array.  Notice the use of `setTimeout` to ensure asynchronous operations. The `target` array helps to verify the execution order in practice.


### Serial Execution (with array input)

```javascript
const serial = require('asynckit').serial;
const assert = require('assert');

const source = [1, 1, 4, 16, 64, 32, 8, 2];
const expectedResult = [2, 2, 8, 32, 128, 64, 16, 4];
const target = [];

serial(source, asyncJob, (err, result) => {
  if (err) { console.error('Error:', err); return; }
  assert.deepEqual(result, expectedResult);
  console.log('Result:', result);
  console.log('Target order:', target);
});

function asyncJob(item, cb) {
  setTimeout(() => {
    target.push(item); // record item order for serial execution
    cb(null, item * 2);
  }, 0); // Immediate execution to show that setTimeout is crucial
}
```


### Object Input (Parallel)

Parallel execution with objects works similarly to arrays, but keys are used.

**Complete Example (updated for clarity):**

```javascript
// ... (require statements and asyncJob function, same as previous example)

const sourceObject = { first: 1, one: 1, four: 4, sixteen: 16 };
const expectedResultObject = { first: 2, one: 2, four: 8, sixteen: 32 };

parallel(sourceObject, asyncJob, (err, result) => {
  if (err) { console.error('Error:', err); return; }
  assert.deepEqual(result, expectedResultObject);
  console.log('Result:', result);
});
```


**Important Considerations:**

* **Error Handling:**  Always check for errors (`err`) in the callback function to handle potential issues during asynchronous operations.
* **Asynchronicity:**  Crucially, use asynchronous functions like `setTimeout` or Promises within your `asyncJob` to ensure non-blocking operations and prevent stack overflow errors.
* **Order:** Serial execution guarantees order, while parallel execution might have variable order.
* **Object Input:** Object input might not respect the order of keys during serial execution, unless specific ordering is enforced.


For more detailed examples and advanced usage (including ordered serial operations), refer to the project's test files.


```
```
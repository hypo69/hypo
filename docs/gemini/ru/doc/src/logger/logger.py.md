# Модуль `src.logger.logger`

## Обзор

Модуль `src.logger.logger` предназначен для реализации гибкой системы логирования в проекте `hypotez`. Он предоставляет класс `Logger`, использующий паттерн Singleton для обеспечения единственного экземпляра логгера в приложении. Логгер поддерживает запись сообщений в консоль, файлы и в формате JSON. Модуль также включает настройки цветового оформления для сообщений в консоли и использует модуль `header` для определения корневого каталога проекта.

## Подробней

Модуль позволяет настраивать пути к файлам логирования, уровни логирования и форматы сообщений. Он использует библиотеку `colorama` для добавления цветов в сообщения консоли и предоставляет удобные методы для логирования сообщений различных уровней (информация, отладка, предупреждение, ошибка, критическая ошибка) с возможностью добавления информации об исключениях.

## Содержание

- [Классы](#классы)
  - [`SingletonMeta`](#singletonmeta)
  - [`JsonFormatter`](#jsonformatter)
  - [`Logger`](#logger)
- [Функции](#функции)
  - [`_format_message`](#_format_message)
  - [`_ex_full_info`](#_ex_full_info)
  - [`log`](#log)
  - [`info`](#info)
  - [`success`](#success)
  - [`warning`](#warning)
  - [`debug`](#debug)
  - [`exception`](#exception)
  - [`error`](#error)
  - [`critical`](#critical)

## Классы

### `SingletonMeta`

**Описание**: Метакласс для реализации паттерна Singleton.

**Принцип работы**:
Метакласс `SingletonMeta` гарантирует, что у класса будет только один экземпляр. Это достигается за счет хранения экземпляров в словаре `_instances` и использования блокировки `_lock` для предотвращения создания нескольких экземпляров в многопоточной среде.

**Методы**:

- `__call__(cls, *args, **kwargs)`: Метод вызывается при создании экземпляра класса. Если экземпляр класса уже существует, он возвращает существующий экземпляр. В противном случае он создает новый экземпляр и сохраняет его в словаре `_instances`.

### `JsonFormatter`

**Описание**: Пользовательский форматтер для логирования в формате JSON.

**Принцип работы**:
Класс `JsonFormatter` наследует класс `logging.Formatter` и переопределяет метод `format` для форматирования записей журнала в виде JSON.

**Методы**:

- `format(self, record)`: Форматирует запись журнала в виде JSON. Извлекает время, уровень, сообщение и информацию об исключении (если есть) из записи журнала и преобразует их в JSON.

### `Logger`

**Описание**: Класс Logger, реализующий паттерн Singleton с логированием в консоль, файл и JSON.

**Принцип работы**:
Класс `Logger` использует метакласс `SingletonMeta`, чтобы гарантировать, что существует только один экземпляр класса. Он настраивает несколько логгеров для записи сообщений в консоль, файлы и в формате JSON. Пути к файлам журнала настраиваются на основе параметров инициализации и конфигурационного файла.

**Атрибуты**:

- `log_files_path` (Path): Путь к каталогу, в котором хранятся файлы журналов.
- `info_log_path` (Path): Путь к файлу журнала для информационных сообщений.
- `debug_log_path` (Path): Путь к файлу журнала для отладочных сообщений.
- `errors_log_path` (Path): Путь к файлу журнала для сообщений об ошибках.
- `json_log_path` (Path): Путь к файлу журнала в формате JSON.
- `logger_console` (logging.Logger): Логгер для вывода сообщений в консоль.
- `logger_file_info` (logging.Logger): Логгер для записи информационных сообщений в файл.
- `logger_file_debug` (logging.Logger): Логгер для записи отладочных сообщений в файл.
- `logger_file_errors` (logging.Logger): Логгер для записи сообщений об ошибках в файл.
- `logger_file_json` (logging.Logger): Логгер для записи сообщений в формате JSON в файл.

**Методы**:

- `__init__(self, info_log_path: Optional[str] = None, debug_log_path: Optional[str] = None, errors_log_path: Optional[str] = None, json_log_path: Optional[str] = None)`: Инициализирует экземпляр Logger. Определяет пути к файлам, создает каталоги и файлы журналов, настраивает логгеры и обработчики.
- `_format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None)`: Возвращает отформатированное сообщение с дополнительной информацией об исключении и цвете.
- `_ex_full_info(self, ex)`: Возвращает полную информацию об исключении вместе с деталями предыдущей функции, файла и строки.
- `log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None)`: Общий метод для логирования сообщений на указанном уровне с дополнительным цветом.
- `info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = "")`: Логирует информационное сообщение с дополнительными цветами текста и фона.
- `success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = "")`: Логирует сообщение об успехе с дополнительными цветами текста и фона.
- `warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = "")`: Логирует предупреждающее сообщение с дополнительными цветами текста и фона.
- `debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "")`: Логирует отладочное сообщение с дополнительными цветами текста и фона.
- `exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray")`: Логирует сообщение об исключении с дополнительными цветами текста и фона.
- `error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "")`: Логирует сообщение об ошибке с дополнительными цветами текста и фона.
- `critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white")`: Логирует критическое сообщение с дополнительными цветами текста и фона.

## Функции

### `_format_message`

```python
def _format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None) -> str:
    """Возвращает отформатированное сообщение с дополнительной информацией об исключении и цвете."""
```

**Назначение**: Форматирует сообщение лога, добавляя к нему информацию об исключении (если есть) и цвета (если указаны).

**Параметры**:

- `message` (str): Основное сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `color` (Optional[Tuple[str, str]], optional): Кортеж, содержащий названия цветов текста и фона. По умолчанию `None`.
- `level` (int, optional): Уровень логирования (например, logging.INFO, logging.ERROR). По умолчанию `None`.

**Возвращает**:

- `str`: Отформатированное сообщение лога.

**Как работает функция**:

1. **Определение символа лога**:
   - Определяет символ лога на основе уровня логирования из словаря `LOG_SYMBOLS`.

2. **Применение цветового оформления**:
   - Если указаны цвета текста и фона, применяет их к сообщению с использованием кодов `colorama`.

3. **Формирование итогового сообщения**:
   - Объединяет символ лога, сообщение и информацию об исключении (если есть) в одну строку.

4. **Возврат отформатированного сообщения**:
   - Возвращает отформатированное сообщение.

**Примеры**:

```python
message = "Операция выполнена успешно"
formatted_message = self._format_message(message, level=logging.INFO, color=("green", ""))
print(formatted_message)
```

```
ℹ️ <зеленый цвет>Операция выполнена успешно</зеленый цвет> 
```

```python
message = "Произошла ошибка"
ex = ValueError("Неверное значение")
formatted_message = self._format_message(message, ex=ex, level=logging.ERROR, color=("red", ""))
print(formatted_message)
```

```
❌ <красный цвет>Произошла ошибка Неверное значение</красный цвет>
```

### `_ex_full_info`

```python
def _ex_full_info(self, ex) -> str:
    """Возвращает полную информацию об исключении вместе с деталями предыдущей функции, файла и строки."""
```

**Назначение**: Предоставляет расширенную информацию об исключении, включая имя файла, имя функции и номер строки, где произошло исключение.

**Параметры**:

- `ex` (Exception): Объект исключения, информацию о котором необходимо получить.

**Возвращает**:

- `str`: Строка, содержащая полную информацию об исключении, включая имя файла, имя функции и номер строки.

**Как работает функция**:

1. **Получение информации о фрейме стека**:
   - Получает информацию о фрейме стека, вызвавшего исключение, с использованием `inspect.stack()`.

2. **Извлечение деталей**:
   - Извлекает имя файла, имя функции и номер строки из информации о фрейме.

3. **Формирование итогового сообщения**:
   - Форматирует информацию об исключении в строку, включающую имя файла, имя функции и номер строки.

4. **Возврат отформатированной информации**:
   - Возвращает отформатированную строку с информацией об исключении.

**Примеры**:

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    full_info = self._ex_full_info(ex)
    print(full_info)
```

```
File: <имя_файла>, 
 |
  -Function: <имя_функции>, 
   |
    --Line: <номер_строки>
Неверное значение
```

### `log`

```python
def log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None):
    """Общий метод для логирования сообщений на указанном уровне с дополнительным цветом."""
```

**Назначение**: Общий метод для логирования сообщений на указанном уровне с возможностью добавления цвета и информации об исключении.

**Параметры**:

- `level` (int): Уровень логирования (например, logging.INFO, logging.ERROR).
- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `False`.
- `color` (Optional[Tuple[str, str]], optional): Кортеж, содержащий цвета текста и фона. По умолчанию `None`.

**Как работает функция**:

1. **Форматирование сообщения**:
   - Вызывает метод `_format_message` для форматирования сообщения с учетом уровня логирования, исключения и цветов.

2. **Логирование сообщения**:
   - Если включена информация об исключении и есть исключение, использует `self.logger_console.exception` для логирования сообщения.
   - В противном случае использует `self.logger_console.log` для логирования сообщения на указанном уровне.

3. **Вывод сообщения в консоль**:
   - Выводит отформатированное сообщение в консоль с использованием соответствующего логгера.

**Примеры**:

```python
self.log(logging.INFO, "Операция выполнена успешно", color=("green", ""))
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.log(logging.ERROR, "Произошла ошибка", ex=ex, exc_info=True, color=("red", ""))
```

### `info`

```python
def info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = ""):
    """Логирует информационное сообщение с дополнительными цветами текста и фона."""
```

**Назначение**: Логирует информационное сообщение.

**Параметры**:

- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"green"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

**Как работает функция**:

1. **Определение цветов**:
   - Определяет кортеж `color` с цветами текста и фона.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.INFO` и указанными параметрами.

**Примеры**:

```python
self.info("Операция выполнена успешно")
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.info("Произошла ошибка", ex=ex, exc_info=True)
```

### `success`

```python
def success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = ""):
    """Логирует сообщение об успехе с дополнительными цветами текста и фона."""
```

**Назначение**: Логирует сообщение об успехе.

**Параметры**:

- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"yellow"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

**Как работает функция**:

1. **Определение цветов**:
   - Определяет кортеж `color` с цветами текста и фона.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.INFO` и указанными параметрами.

**Примеры**:

```python
self.success("Операция выполнена успешно")
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.success("Произошла ошибка", ex=ex, exc_info=True)
```

### `warning`

```python
def warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = ""):
    """Логирует предупреждающее сообщение с дополнительными цветами текста и фона."""
```

**Назначение**: Логирует предупреждающее сообщение.

**Параметры**:

- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"light_red"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

**Как работает функция**:

1. **Определение цветов**:
   - Определяет кортеж `color` с цветами текста и фона.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.WARNING` и указанными параметрами.

**Примеры**:

```python
self.warning("Предупреждение: возможно неверное значение")
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.warning("Произошла ошибка", ex=ex, exc_info=True)
```

### `debug`

```python
def debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = ""):
    """Логирует отладочное сообщение с дополнительными цветами текста и фона."""
```

**Назначение**: Логирует отладочное сообщение.

**Параметры**:

- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"cyan"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

**Как работает функция**:

1. **Определение цветов**:
   - Определяет кортеж `color` с цветами текста и фона.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.DEBUG` и указанными параметрами.

**Примеры**:

```python
self.debug("Отладочное сообщение")
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.debug("Произошла ошибка", ex=ex, exc_info=True)
```

### `exception`

```python
def exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray"):
    """Логирует сообщение об исключении с дополнительными цветами текста и фона."""
```

**Назначение**: Логирует сообщение об исключении.

**Параметры**:

- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"cyan"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `"light_gray"`.

**Как работает функция**:

1. **Определение цветов**:
   - Определяет кортеж `color` с цветами текста и фона.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.ERROR` и указанными параметрами.

**Примеры**:

```python
self.exception("Произошло исключение")
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.exception("Произошла ошибка", ex=ex, exc_info=True)
```

### `error`

```python
def error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = ""):
    """Логирует сообщение об ошибке с дополнительными цветами текста и фона."""
```

**Назначение**: Логирует сообщение об ошибке.

**Параметры**:

- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"red"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `""`.

**Как работает функция**:

1. **Определение цветов**:
   - Определяет кортеж `color` с цветами текста и фона.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.ERROR` и указанными параметрами.

**Примеры**:

```python
self.error("Произошла ошибка")
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.error("Произошла ошибка", ex=ex, exc_info=True)
```

### `critical`

```python
def critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white"):
    """Логирует критическое сообщение с дополнительными цветами текста и фона."""
```

**Назначение**: Логирует критическое сообщение.

**Параметры**:

- `message` (str): Сообщение для логирования.
- `ex` (Exception, optional): Объект исключения, который нужно добавить к сообщению. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли добавлять информацию об исключении в журнал. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию `"red"`.
- `bg_color` (str, optional): Цвет фона. По умолчанию `"white"`.

**Как работает функция**:

1. **Определение цветов**:
   - Определяет кортеж `color` с цветами текста и фона.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.CRITICAL` и указанными параметрами.

**Примеры**:

```python
self.critical("Критическая ошибка")
```

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    self.critical("Произошла ошибка", ex=ex, exc_info=True)
# Модуль `types.py`

## Обзор

Модуль определяет абстрактные базовые классы для провайдеров, используемых для взаимодействия с различными сервисами, такими как GPT-4. Он содержит абстрактный класс `BaseProvider`, определяющий общие атрибуты и методы, а также класс `BaseRetryProvider`, предназначенный для провайдеров с логикой повторных попыток. Также определен класс `Streaming` для работы с потоковыми данными.

## Подробней

Этот модуль является ключевым компонентом системы провайдеров, используемой для абстрагирования взаимодействия с различными API и сервисами. Он предоставляет базовые классы, которые должны быть реализованы конкретными провайдерами, и определяет общие интерфейсы для работы с ними. Расположение этого модуля в проекте указывает на то, что он является частью подсистемы, отвечающей за интеграцию с внешними источниками данных и сервисами, в частности, с GPT-4 через g4f (GPT4Free).

## Классы

### `BaseProvider`

**Описание**: Абстрактный базовый класс для провайдеров. Определяет общие атрибуты и абстрактные методы, которые должны быть реализованы конкретными провайдерами.

**Принцип работы**:
Класс `BaseProvider` служит основой для всех провайдеров в системе. Он определяет атрибуты, такие как URL провайдера, его работоспособность, необходимость аутентификации, поддержка потоковой передачи и истории сообщений, а также параметры. Кроме того, он содержит абстрактные методы для получения функций создания (синхронной и асинхронной), которые должны быть реализованы в подклассах.

**Аттрибуты**:
- `url` (str): URL провайдера.
- `working` (bool): Указывает, работает ли провайдер в данный момент.
- `needs_auth` (bool): Указывает, требуется ли аутентификация для использования провайдера.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения.
- `params` (str): Параметры провайдера.

**Методы**:
- `get_create_function`
- `get_async_create_function`
- `get_dict`

#### `get_create_function`

```python
@abstractmethod
def get_create_function() -> callable:
    """
    Get the create function for the provider.

    Returns:
        callable: The create function.
    """
    ...
```

**Назначение**: Получение функции создания для провайдера.

**Параметры**:
- Нет.

**Возвращает**:
- `callable`: Функция создания.

**Вызывает исключения**:
- `NotImplementedError`: Если метод не реализован в подклассе.

**Как работает функция**:
1.  Функция `get_create_function` является абстрактным методом, который должен быть реализован в каждом подклассе `BaseProvider`.
2.  Она предназначена для возвращения функции, которая отвечает за создание запросов к API соответствующего провайдера.
3.  Поскольку это абстрактный метод, вызов его в базовом классе приведет к исключению `NotImplementedError`.

ASCII flowchart:

```
Начало
↓
Вызов абстрактного метода get_create_function
↓
Выброс исключения NotImplementedError (если не переопределен)
↓
Конец
```

**Примеры**:
Поскольку это абстрактный метод, примеры его вызова не имеют смысла в контексте `BaseProvider`.

#### `get_async_create_function`

```python
@abstractmethod
def get_async_create_function() -> callable:
    """
    Get the async create function for the provider.

    Returns:
        callable: The create function.
    """
    ...
```

**Назначение**: Получение асинхронной функции создания для провайдера.

**Параметры**:
- Нет.

**Возвращает**:
- `callable`: Асинхронная функция создания.

**Вызывает исключения**:
- `NotImplementedError`: Если метод не реализован в подклассе.

**Как работает функция**:
1.  Функция `get_async_create_function` является абстрактным методом, который должен быть реализован в каждом подклассе `BaseProvider`.
2.  Она предназначена для возвращения асинхронной функции, которая отвечает за создание запросов к API соответствующего провайдера.
3.  Как и `get_create_function`, вызов этого метода в базовом классе приведет к исключению `NotImplementedError`, если он не переопределен.

ASCII flowchart:

```
Начало
↓
Вызов абстрактного метода get_async_create_function
↓
Выброс исключения NotImplementedError (если не переопределен)
↓
Конец
```

**Примеры**:
Поскольку это абстрактный метод, примеры его вызова не имеют смысла в контексте `BaseProvider`.

#### `get_dict`

```python
@classmethod
def get_dict(cls) -> Dict[str, str]:
    """
    Get a dictionary representation of the provider.

    Returns:
        Dict[str, str]: A dictionary with provider's details.
    """
    ...
```

**Назначение**: Получение словарного представления провайдера.

**Параметры**:
- Нет.

**Возвращает**:
- `Dict[str, str]`: Словарь с деталями провайдера (имя, URL, метка).

**Как работает функция**:
1.  Функция `get_dict` является методом класса, который возвращает словарь с информацией о провайдере.
2.  Словарь содержит имя класса (`__name__`), URL провайдера (`url`) и метку (`label`, если она определена).
3.  Этот метод используется для получения метаданных о провайдере в удобном формате.

ASCII flowchart:

```
Начало
↓
Получение имени класса (__name__)
↓
Получение URL провайдера (url)
↓
Получение метки провайдера (label, если существует)
↓
Формирование словаря {'name': имя, 'url': URL, 'label': метка}
↓
Возврат словаря
↓
Конец
```

**Примеры**:

```python
class MyProvider(BaseProvider):
    url = "https://example.com"
    label = "Example Provider"

    def get_create_function(self):
        pass

    def get_async_create_function(self):
        pass

provider_dict = MyProvider.get_dict()
print(provider_dict)
# Expected output: {'name': 'MyProvider', 'url': 'https://example.com', 'label': 'Example Provider'}
```

### `BaseRetryProvider`

**Описание**: Базовый класс для провайдеров, реализующих логику повторных попыток.

**Принцип работы**:
Класс `BaseRetryProvider` расширяет `BaseProvider` и добавляет функциональность для повторных попыток при сбое запросов. Он содержит список провайдеров, которые будут использоваться для повторных попыток, флаг для перемешивания списка провайдеров, словарь исключений и ссылку на последнего использованного провайдера.

**Аттрибуты**:
- `__name__` (str): Имя провайдера (по умолчанию "RetryProvider").
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (по умолчанию `True`).
- `last_provider` (Type[BaseProvider]): Последний использованный провайдер (по умолчанию `None`).
- `providers` (List[Type[BaseProvider]]): Список провайдеров для повторных попыток.
- `shuffle` (bool): Флаг, указывающий, нужно ли перемешивать список провайдеров.
- `exceptions` (Dict[str, Exception]): Словарь возникших исключений.

### `Streaming`

**Описание**: Класс для представления потоковых данных.

**Принцип работы**:
Класс `Streaming` используется для обертки потоковых данных в виде строки. Он принимает строку в качестве аргумента и предоставляет метод `__str__` для получения этой строки.

**Аттрибуты**:
- `data` (str): Строка с потоковыми данными.

**Методы**:
- `__init__`
- `__str__`

#### `__init__`

```python
def __init__(self, data: str) -> None:
    """
    Инициализирует объект Streaming.

    Args:
        data (str): Строка с потоковыми данными.
    """
    ...
```

**Назначение**: Инициализация объекта `Streaming`.

**Параметры**:
- `data` (str): Строка с потоковыми данными.

**Как работает функция**:
1.  Функция `__init__` является конструктором класса `Streaming`.
2.  Она принимает строку `data` и сохраняет ее в атрибуте `self.data`.

ASCII flowchart:

```
Начало
↓
Присвоение значения data атрибуту self.data
↓
Конец
```

**Примеры**:

```python
streaming_data = Streaming("Пример потоковых данных")
print(streaming_data.data)
# Expected output: "Пример потоковых данных"
```

#### `__str__`

```python
def __str__(self) -> str:
    """
    Возвращает строковое представление объекта Streaming.

    Returns:
        str: Строка с потоковыми данными.
    """
    ...
```

**Назначение**: Возвращает строковое представление объекта `Streaming`.

**Параметры**:
- Нет.

**Возвращает**:
- `str`: Строка с потоковыми данными.

**Как работает функция**:
1.  Функция `__str__` возвращает строковое представление объекта `Streaming`, которым является значение атрибута `self.data`.
2.  Этот метод позволяет использовать объект `Streaming` в строковых операциях.

ASCII flowchart:

```
Начало
↓
Возврат значения атрибута self.data
↓
Конец
```

**Примеры**:

```python
streaming_data = Streaming("Пример потоковых данных")
print(str(streaming_data))
# Expected output: "Пример потоковых данных"
```

## Типы

### `ProviderType`

**Описание**: Псевдоним типа, представляющий либо `BaseProvider`, либо `BaseRetryProvider`.

**Принцип работы**:
`ProviderType` используется для указания типа провайдера, который может быть либо базовым провайдером (`BaseProvider`), либо провайдером с логикой повторных попыток (`BaseRetryProvider`). Это позволяет использовать один тип для представления различных видов провайдеров.
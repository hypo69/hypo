# Модуль `md2dict`

## Обзор

Модуль `md2dict` предназначен для конвертации текста в формате Markdown в структурированный словарь Python. Он использует библиотеку `markdown2` для преобразования Markdown в HTML, а затем анализирует HTML для извлечения информации о структуре документа, такой как заголовки и текст. Модуль предоставляет функции для преобразования Markdown в HTML и в структурированный словарь, что упрощает дальнейшую обработку и анализ Markdown-контента.

## Подробней

Модуль предоставляет функции для преобразования Markdown-текста в HTML и структурированный словарь. Он особенно полезен для обработки и анализа Markdown-контента, например, для извлечения структуры документа, заголовков и текста. Модуль использует библиотеку `markdown2` для преобразования Markdown в HTML, а затем анализирует HTML-код для извлечения необходимой информации.

## Функции

### `md2html`

```python
def md2html(md_string: str, extras: List[str] = None) -> str:
    """
    Конвертирует строку Markdown в HTML.

    Args:
        md_string (str): Строка Markdown для конвертации.
        extras (list, optional): Список расширений markdown2. Defaults to None.

    Returns:
        str: HTML-представление Markdown.
    """
    ...
```

**Назначение**: Преобразует строку в формате Markdown в HTML.

**Параметры**:

- `md_string` (str): Строка Markdown, которую необходимо преобразовать.
- `extras` (List[str], optional): Список расширений `markdown2`, используемых при преобразовании. По умолчанию `None`.

**Возвращает**:

- `str`: HTML-представление входной Markdown-строки.

**Вызывает исключения**:

- `Exception`: В случае возникновения ошибки при преобразовании Markdown в HTML. Ошибка логируется с использованием `logger.error`.

**Как работает функция**:

1. Функция `md2html` принимает строку `md_string` в формате Markdown и необязательный список расширений `extras` для `markdown2`.
2. Она пытается преобразовать `md_string` в HTML с помощью функции `markdown` из библиотеки `markdown2`. Если `extras` не указан, используется стандартное преобразование. Если `extras` указан, он передается в функцию `markdown` для использования указанных расширений.
3. В случае успеха функция возвращает HTML-представление Markdown-строки.
4. Если во время преобразования возникает исключение, оно перехватывается, логируется с использованием `logger.error`, и функция возвращает пустую строку.

**Примеры**:

```python
from src.utils.convertors.md import md2html

markdown_text = "# Заголовок 1\nЭто обычный текст."
html_text = md2html(markdown_text)
print(html_text)
```

ASCII flowchart:

```
Начало
  |
  ---> Преобразование Markdown в HTML (с/без extras)
  |
  ---> Возврат HTML или пустой строки (в случае ошибки)
  |
Конец
```

### `md2dict`

```python
def md2dict(md_string: str, extras: List[str] = None) -> Dict[str, list[str]]:
    """
    Конвертирует строку Markdown в структурированный словарь.

    Args:
        md_string (str): Строка Markdown для конвертации.
        extras (list, optional): Список расширений markdown2 для md2html. Defaults to None.

    Returns:
         Dict[str, list[str]]: Структурированное представление Markdown содержимого.
    """
    ...
```

**Назначение**: Преобразует строку в формате Markdown в структурированный словарь, где ключами являются заголовки, а значениями - списки строк содержимого под этими заголовками.

**Параметры**:

- `md_string` (str): Строка Markdown для конвертации.
- `extras` (List[str], optional): Список расширений `markdown2` для использования в функции `md2html`. По умолчанию `None`.

**Возвращает**:

- `Dict[str, list[str]]`: Структурированное представление Markdown-содержимого в виде словаря. Ключи словаря - заголовки разделов, значения - списки строк содержимого в этих разделах.

**Вызывает исключения**:

- `Exception`: В случае возникновения ошибки при парсинге Markdown в структурированный словарь. Ошибка логируется с использованием `logger.error`.

**Как работает функция**:

1. Функция `md2dict` принимает строку `md_string` в формате Markdown и необязательный список расширений `extras` для `markdown2`.
2. Сначала она преобразует Markdown в HTML с помощью функции `md2html`, используя переданные `extras`.
3. Затем она инициализирует пустой словарь `sections` для хранения структуры документа и переменную `current_section` для отслеживания текущего раздела.
4. Функция проходит по каждой строке HTML-кода, полученного из `md2html`.
   - Если строка начинается с тега заголовка (`<h`), извлекается уровень заголовка и текст заголовка. Если уровень заголовка равен 1, заголовок становится новым текущим разделом, и в словарь `sections` добавляется новая запись с ключом в виде этого заголовка и пустым списком в качестве значения. Если уровень заголовка больше 1, он добавляется в список текущего раздела.
   - Если строка не является заголовком, но содержит текст и текущий раздел определен, строка очищается от HTML-тегов и добавляется в список строк текущего раздела.
5. В случае успеха функция возвращает словарь `sections`, представляющий структурированное содержимое Markdown.
6. Если во время парсинга возникает исключение, оно перехватывается, логируется с использованием `logger.error`, и функция возвращает пустой словарь.

**Примеры**:

```python
from src.utils.convertors.md import md2dict

markdown_text = """
# Заголовок 1
Это текст под заголовком 1.
## Заголовок 2
Это текст под заголовком 2.
"""
result_dict = md2dict(markdown_text)
print(result_dict)
```

ASCII flowchart:

```
Начало
  |
  ---> Преобразование Markdown в HTML (md2html)
  |
  ---> Инициализация словаря sections и current_section
  |
  ---> Перебор строк HTML
  |
  ---> Обнаружен заголовок?
  |    |
  |    ---> Да: Определение уровня и текста заголовка
  |    |
  |    ---> Обновление current_section и добавление в sections
  |
  ---> Обнаружен текст в текущем разделе?
  |    |
  |    ---> Да: Очистка текста и добавление в sections[current_section]
  |
  ---> Возврат словаря sections или пустого словаря (в случае ошибки)
  |
Конец
# Модуль: `src.suppliers.aliexpress.gui.product`

## Обзор

Модуль `src.suppliers.aliexpress.gui.product` предоставляет графический интерфейс (GUI) для редактирования информации о товарах, полученных с AliExpress. Он включает в себя функциональность для открытия JSON-файлов с данными о товарах, отображения этих данных в пользовательском интерфейсе и подготовки товаров к дальнейшей обработке, например, для создания рекламных кампаний.

## Подробнее

Этот модуль является частью системы для работы с данными AliExpress и предоставляет удобный способ просмотра и редактирования информации о товарах. Он использует библиотеку PyQt6 для создания графического интерфейса и взаимодействует с другими модулями, такими как `AliCampaignEditor`, для подготовки товаров к рекламным кампаниям.

## Классы

### `ProductEditor`

**Описание**: Класс `ProductEditor` представляет собой виджет (QWidget) для редактирования информации о товарах. Он позволяет открывать JSON-файлы с данными о товарах, отображать эти данные в пользовательском интерфейсе и подготавливать товары к дальнейшей обработке.

**Принцип работы**:
1.  При инициализации виджета устанавливается связь с главным приложением (`main_app`), настраивается пользовательский интерфейс и устанавливаются связи между сигналами и слотами.
2.  Метод `setup_ui` создает основные элементы интерфейса, такие как кнопки "Open JSON File" и "Prepare Product", а также текстовое поле для отображения имени выбранного файла.
3.  Метод `open_file` открывает диалоговое окно выбора файла, позволяя пользователю выбрать JSON-файл с данными о товаре.
4.  Метод `load_file` загружает выбранный JSON-файл, используя функцию `j_loads_ns` из модуля `src.utils.jjson`, и отображает основные сведения о товаре, такие как заголовок и детали.
5.  Метод `create_widgets` создает виджеты для отображения информации о товаре на основе загруженных данных.
6.  Асинхронный метод `prepare_product_async` подготавливает товар к дальнейшей обработке, используя экземпляр класса `AliCampaignEditor`.

**Методы**:

*   `__init__(self, parent=None, main_app=None)`
    *   **Описание**: Инициализирует виджет `ProductEditor`.
    *   **Параметры**:
        *   `parent` (QWidget, optional): Родительский виджет. По умолчанию `None`.
        *   `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

*   `setup_ui(self)`
    *   **Описание**: Настраивает пользовательский интерфейс виджета.

*   `setup_connections(self)`
    *   **Описание**: Устанавливает связи между сигналами и слотами. В текущей версии метода отсутствует реализация.

*   `open_file(self)`
    *   **Описание**: Открывает диалоговое окно выбора файла для загрузки JSON-файла с данными о товаре.
        После выбора файла вызывается метод `load_file` для загрузки содержимого файла.

*   `load_file(self, file_path)`
    *   **Описание**: Загружает JSON-файл с данными о товаре.
    *   **Параметры**:
        *   `file_path` (str): Путь к JSON-файлу.
    *   **Как работает функция**:
        1.  Функция `load_file` загружает JSON-файл, используя функцию `j_loads_ns` из модуля `src.utils.jjson`.
        2.  Сохраняет путь к файлу в атрибуте `file_path` и устанавливает текст метки `file_name_label`.
        3.  Создает экземпляр класса `AliCampaignEditor` для подготовки товара к рекламной кампании.
        4.  Вызывает метод `create_widgets` для создания виджетов на основе загруженных данных.
    *   **Пример**:
        ```python
        editor = ProductEditor(main_app=self)
        editor.load_file('path/to/your/file.json')
        ```

*   `create_widgets(self, data)`
    *   **Описание**: Создает виджеты для отображения информации о товаре на основе загруженных данных.
    *   **Параметры**:
        *   `data` (SimpleNamespace): Объект, содержащий данные о товаре.
    *   **Как работает функция**:
        1.  Функция `create_widgets` удаляет все предыдущие виджеты, кроме кнопок "Open JSON File", "Prepare Product" и метки имени файла.
        2.  Создает метки для отображения заголовка и деталей товара.
        3.  Добавляет созданные виджеты в макет.
    *   **Пример**:
        ```python
        data = j_loads_ns('path/to/your/file.json')
        editor = ProductEditor(main_app=self)
        editor.create_widgets(data)
        ```

*   `prepare_product_async(self)`
    *   **Описание**: Асинхронно подготавливает товар к дальнейшей обработке.
    *   **Как работает функция**:
        1.  Функция `prepare_product_async` асинхронно вызывает метод `prepare_product` класса `AliCampaignEditor` для подготовки товара.
        2.  Выводит сообщение об успехе или ошибке в зависимости от результата выполнения.
    *   **Пример**:
        ```python
        import asyncio
        editor = ProductEditor(main_app=self)
        asyncio.run(editor.prepare_product_async())
        ```

## Функции

### `__init__`

```python
    def __init__(self, parent=None, main_app=None):
        """ Initialize the ProductEditor widget """
```

**Назначение**: Инициализация класса `ProductEditor`.

**Параметры**:

*   `parent` (QWidget, optional): Родительский виджет. По умолчанию `None`.
*   `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

**Как работает функция**:

1.  Вызывается конструктор родительского класса `QtWidgets.QWidget`.
2.  Сохраняется ссылка на экземпляр главного приложения `main_app`.
3.  Вызывается метод `setup_ui` для настройки пользовательского интерфейса.
4.  Вызывается метод `setup_connections` для установки связей между сигналами и слотами.

**Примеры**:

```python
editor = ProductEditor(main_app=self)
```

### `setup_ui`

```python
    def setup_ui(self):
        """ Setup the user interface """
```

**Назначение**: Настройка пользовательского интерфейса.

**Как работает функция**:

1.  Устанавливается заголовок окна `Product Editor`.
2.  Устанавливается размер окна 1800x800 пикселей.
3.  Создаются кнопки "Open JSON File" и "Prepare Product", а также текстовое поле для отображения имени выбранного файла.
4.  Устанавливаются обработчики событий для кнопок.
5.  Компоновка элементов интерфейса с использованием `QVBoxLayout`.

**Примеры**:

```python
editor = ProductEditor(main_app=self)
editor.setup_ui()
```

### `setup_connections`

```python
    def setup_connections(self):
        """ Setup signal-slot connections """
```

**Назначение**: Установка связей между сигналами и слотами.

**Как работает функция**:

*   В текущей версии метода отсутствует реализация.

**Примеры**:

```python
editor = ProductEditor(main_app=self)
editor.setup_connections()
```

### `open_file`

```python
    def open_file(self):
        """ Open a file dialog to select and load a JSON file """
```

**Назначение**: Открытие диалогового окна выбора файла для загрузки JSON-файла.

**Как работает функция**:

1.  Открывается диалоговое окно выбора файла с использованием `QtWidgets.QFileDialog.getOpenFileName`.
2.  Устанавливаются фильтры для отображения только JSON-файлов.
3.  Если файл выбран, вызывается метод `load_file` для загрузки содержимого файла.

**Примеры**:

```python
editor = ProductEditor(main_app=self)
editor.open_file()
```

### `load_file`

```python
    def load_file(self, file_path):
        """ Load a JSON file """
```

**Назначение**: Загрузка JSON-файла с данными о товаре.

**Параметры**:

*   `file_path` (str): Путь к JSON-файлу.

**Как работает функция**:

1.  Загружается JSON-файл, используя функцию `j_loads_ns` из модуля `src.utils.jjson`.
2.  Сохраняется путь к файлу в атрибуте `file_path` и устанавливается текст метки `file_name_label`.
3.  Создается экземпляр класса `AliCampaignEditor` для подготовки товара к рекламной кампании.
4.  Вызывается метод `create_widgets` для создания виджетов на основе загруженных данных.

**Вызывает исключения**:

*   `Exception`: Если возникает ошибка при загрузке JSON-файла.

**Примеры**:

```python
editor = ProductEditor(main_app=self)
editor.load_file('path/to/your/file.json')
```

### `create_widgets`

```python
    def create_widgets(self, data):
        """ Create widgets based on the data loaded from the JSON file """
```

**Назначение**: Создание виджетов для отображения информации о товаре на основе загруженных данных.

**Параметры**:

*   `data` (SimpleNamespace): Объект, содержащий данные о товаре.

**Как работает функция**:

1.  Удаляются все предыдущие виджеты, кроме кнопок "Open JSON File", "Prepare Product" и метки имени файла.
2.  Создаются метки для отображения заголовка и деталей товара.
3.  Добавляются созданные виджеты в макет.

**Примеры**:

```python
data = j_loads_ns('path/to/your/file.json')
editor = ProductEditor(main_app=self)
editor.create_widgets(data)
```

### `prepare_product_async`

```python
    @asyncSlot()
    async def prepare_product_async(self):
        """ Asynchronously prepare the product """
```

**Назначение**: Асинхронная подготовка товара к дальнейшей обработке.

**Как работает функция**:

1.  Асинхронно вызывается метод `prepare_product` класса `AliCampaignEditor` для подготовки товара.
2.  Выводится сообщение об успехе или ошибке в зависимости от результата выполнения.

**Вызывает исключения**:

*   `Exception`: Если возникает ошибка при подготовке товара.

**Примеры**:

```python
import asyncio
editor = ProductEditor(main_app=self)
asyncio.run(editor.prepare_product_async())
# Модуль `try_xpath_background.js`

## Обзор

Этот модуль содержит код для расширения Firefox, отвечающий за взаимодействие с фоновым процессом. Он обрабатывает различные сообщения, получаемые от вкладок, выполняет запросы к хранилищу настроек, загружает CSS и обновляет его.


## Функции

### `loadDefaultCss`

**Описание**: Функция загружает CSS из файла `try_xpath_insert.css`.

**Возвращает**:
- `Promise<string>`: Promise, разрешающийся с текстом загруженного CSS.

**Вызывает исключения**:
- `Error`: Общие ошибки при выполнении запроса.



### `genericListener`

**Описание**: Функция-обработчик сообщений.

**Параметры**:
- `message`: Объект сообщения.
- `sender`: Объект отправителя.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `boolean | undefined`:  `true`, если обработка успешна и ожидается ответ. `false` или `undefined`, если обработка не требует ответа.

**Вызывает исключения**:
- `Error`: Общие ошибки при обработке сообщения.


### `genericListener.listeners.storePopupState`

**Описание**: Обработчик события `storePopupState`. Сохраняет состояние всплывающего окна.

**Параметры**:
- `message`: Объект сообщения, содержащий состояние.

**Возвращает**:
- `undefined`


### `genericListener.listeners.requestRestorePopupState`

**Описание**: Обработчик события `requestRestorePopupState`. Восстанавливает состояние всплывающего окна.

**Параметры**:
- `message`: Объект сообщения.


**Возвращает**:
- `undefined`


### `genericListener.listeners.requestInsertStyleToPopup`

**Описание**: Обработчик события `requestInsertStyleToPopup`. Вставляет CSS стили в всплывающее окно.

**Параметры**:
- `message`: Объект сообщения.

**Возвращает**:
- `undefined`


### `genericListener.listeners.showAllResults`

**Описание**: Обработчик события `showAllResults`.  Создаёт новую вкладку для отображения результатов.

**Параметры**:
- `message`: Объект сообщения, содержащий данные результатов.
- `sender`: Объект отправителя.

**Возвращает**:
- `undefined`


### `genericListener.listeners.loadResults`

**Описание**: Обработчик события `loadResults`. Возвращает данные результатов.

**Параметры**:
- `message`: Объект сообщения.
- `sender`: Объект отправителя.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `true`: Указывает, что функция завершена успешно.

**Вызывает исключения**:
- `Error`: Общие ошибки при обработке сообщения.


### `genericListener.listeners.updateCss`

**Описание**:  Обновляет CSS стили в указанной вкладке.

**Параметры**:
- `message`: Объект сообщения, содержащий новый CSS и набор CSS для удаления.
- `sender`: Объект отправителя.

**Возвращает**:
- `undefined`

**Вызывает исключения**:
- `Error`: Общие ошибки при обработке запроса.


### `genericListener.listeners.loadOptions`

**Описание**: Загружает настройки и отправляет их.

**Параметры**:
- `message`: Объект сообщения.
- `sender`: Объект отправителя.
- `sendResponse`: Функция для отправки ответа.

**Возвращает**:
- `true`: Указывает, что функция завершена успешно.

**Вызывает исключения**:
- `Error`: Общие ошибки при обработке запроса.


### `genericListener.listeners.requestSetContentInfo`

**Описание**: Устанавливает информацию содержимого в вкладке.

**Параметры**:
- `message`: Объект сообщения.
- `sender`: Объект отправителя.

**Возвращает**:
- `undefined`

**Вызывает исключения**:
- `Error`: Общие ошибки при обработке запроса.


## Обработчики изменений настроек

**Описание**: Обработчики `browser.storage.onChanged` для автоматического обновления настроек (`attributes`, `css`, `popupCss`).



## Загрузка настроек

**Описание**: Функции загрузки настроек `browser.storage.sync` и загрузки CSS.

**Вызывает исключения**:
- `Error`: Общие ошибки при обработке запроса.
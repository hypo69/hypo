# Модуль `user_router`

## Обзор

Модуль `user_router` предназначен для обработки пользовательских взаимодействий в Telegram-боте цифрового магазина. Он включает в себя обработку команды `/start`, отображение главной страницы, информации о магазине, профиля пользователя и истории покупок.

## Подробней

Этот модуль является частью Telegram-бота, который предоставляет пользователю интерфейс для взаимодействия с цифровым магазином. Он использует библиотеку `aiogram` для обработки входящих сообщений и колбэков, а также SQLAlchemy для взаимодействия с базой данных. Модуль отвечает за обработку основных команд и навигацию пользователя в боте.

## Функции

### `cmd_start`

```python
async def cmd_start(message: Message, session_with_commit: AsyncSession):
    """Обрабатывает команду `/start`.

    Args:
        message (Message): Объект сообщения от пользователя.
        session_with_commit (AsyncSession): Асинхровая сессия SQLAlchemy с поддержкой коммитов.

    Returns:
        Awaitable[Message]: Отправляет приветственное сообщение и главную клавиатуру пользователю.

    Raises:
        - Отсутствуют явные исключения.

    Как работает функция:
    1. Извлекает `user_id` из объекта `message`.
    2. Пытается найти пользователя в базе данных по `telegram_id`.
    3. Если пользователь найден, отправляет приветственное сообщение с главной клавиатурой.
    4. Если пользователь не найден, создает новую запись пользователя в базе данных и отправляет приветственное сообщение с главной клавиатурой.

    2. Внутри функции происхоят следующие действия и преобразования:
     Проверка существования пользователя в базе данных
     |
     -- Отправка приветственного сообщения пользователю, если он существует
     |
     Создание нового пользователя в базе данных, если его не существует
     |
     Отправка приветственного сообщения новому пользователю

    Примеры:
        Пример вызова команды `/start`:

        Пользователь отправляет команду `/start` боту.
    """
    ...
```

### `page_home`

```python
async def page_home(call: CallbackQuery):
    """Обрабатывает колбэк "home" для возврата на главную страницу.

    Args:
        call (CallbackQuery): Объект колбэка от пользователя.

    Returns:
        Awaitable[Message]: Отправляет приветственное сообщение и главную клавиатуру пользователю.

    Raises:
        - Отсутствуют явные исключения.

    Как работает функция:
    1. Отвечает на колбэк сообщением "Главная страница".
    2. Отправляет приветственное сообщение с главной клавиатурой.

    2. Внутри функции происхоят следующие действия и преобразования:
     Отправка сообщения "Главная страница"
     |
     -- Отправка приветственного сообщения с главной клавиатурой

    Примеры:
        Пример вызова колбэка "home":

        Пользователь нажимает на кнопку "Домой".
    """
    ...
```

### `page_about`

```python
async def page_about(call: CallbackQuery):
    """Обрабатывает колбэк "about" для отображения информации о магазине.

    Args:
        call (CallbackQuery): Объект колбэка от пользователя.

    Returns:
        Awaitable[Message]: Отправляет информационное сообщение о магазине.

    Raises:
        - Отсутствуют явные исключения.

    Как работает функция:
    1. Отвечает на колбэк сообщением "О магазине".
    2. Отправляет текстовое сообщение с информацией о магазине, включая данные для тестовой оплаты.

    2. Внутри функции происхоят следующие действия и преобразования:
     Отправка сообщения "О магазине"
     |
     -- Отправка текстового сообщения с информацией о магазине

    Примеры:
        Пример вызова колбэка "about":

        Пользователь нажимает на кнопку "О магазине".
    """
    ...
```

### `page_about` (дубликат имени, следует исправить)

```python
async def page_about(call: CallbackQuery, session_without_commit: AsyncSession):
    """Обрабатывает колбэк "my_profile" для отображения профиля пользователя.

    Args:
        call (CallbackQuery): Объект колбэка от пользователя.
        session_without_commit (AsyncSession): Асинхровая сессия SQLAlchemy без поддержки коммитов.

    Returns:
        Awaitable[Message]: Отправляет информацию о профиле пользователя (количество покупок и общая сумма).

    Raises:
        - Отсутствуют явные исключения.

    Как работает функция:
    1. Отвечает на колбэк сообщением "Профиль".
    2. Получает статистику покупок пользователя из базы данных.
    3. Если покупок нет, отправляет сообщение об отсутствии покупок.
    4. Если покупки есть, формирует сообщение с информацией о количестве покупок и общей сумме и отправляет его.

    2. Внутри функции происхоят следующие действия и преобразования:
     Отправка сообщения "Профиль"
     |
     -- Получение статистики покупок пользователя из базы данных
     |
     Проверка наличия покупок
     |
     -- Отправка сообщения об отсутствии покупок, если их нет
     |
     Формирование и отправка сообщения с информацией о профиле, если покупки есть

    Примеры:
        Пример вызова колбэка "my_profile":

        Пользователь нажимает на кнопку "Мой профиль".
    """
    ...
```

### `page_user_purchases`

```python
async def page_user_purchases(call: CallbackQuery, session_without_commit: AsyncSession):
    """Обрабатывает колбэк "purchases" для отображения списка покупок пользователя.

    Args:
        call (CallbackQuery): Объект колбэка от пользователя.
        session_without_commit (AsyncSession): Асинхровая сессия SQLAlchemy без поддержки коммитов.

    Returns:
        Awaitable[Message]: Отправляет список покупок пользователя или сообщение об их отсутствии.

    Raises:
        - Отсутствуют явные исключения.

    Как работает функция:
    1. Отвечает на колбэк сообщением "Мои покупки".
    2. Удаляет предыдущее сообщение пользователя (если возможно).
    3. Получает список покупок пользователя из базы данных.
    4. Если покупок нет, отправляет сообщение об отсутствии покупок.
    5. Если покупки есть, для каждой покупки формирует и отправляет информацию о товаре.
    6. Отправляет сообщение "Спасибо за доверие!".

    2. Внутри функции происхоят следующие действия и преобразования:
     Отправка сообщения "Мои покупки"
     |
     -- Удаление предыдущего сообщения пользователя (если возможно)
     |
     Получение списка покупок пользователя из базы данных
     |
     Проверка наличия покупок
     |
     -- Отправка сообщения об отсутствии покупок, если их нет
     |
     Для каждой покупки:
     |
     -- Формирование информации о товаре
     |
     -- Отправка информации о товаре (текст и/или файл)
     |
     Отправка сообщения "Спасибо за доверие!"

    Примеры:
        Пример вызова колбэка "purchases":

        Пользователь нажимает на кнопку "Мои покупки".
    """
    ...
# Модуль `hypotez/src/utils/smtp.py`

Этот модуль предоставляет функциональность отправки и получения электронных писем через SMTP и IMAP серверы. Он включает функции `send` для отправки писем по SMTP и `receive` для получения писем по IMAP.

**Важные соображения по безопасности и надежности:**

* **Словарь `_connection`:**  Ключевое значение – хранение учетных данных не в коде, а в переменных среды (например, с использованием `os.environ`). Это критически важно для безопасности.  Избегайте прямого внедрения паролей в исходный код.

* **Обработка ошибок:** Код включает надежную обработку ошибок, регистрируя исключения с подробными данными (тема, тело и т.д.). Это очень полезно для отладки.

* **Парсинг писем:** Функция `receive` корректно обрабатывает различные форматы писем, предотвращая потенциальные проблемы.

* **Обработка MIME:** Код использует `MIMEText` для создания сообщения электронной почты, что крайне важно для отправки текстовых писем.


**Функция `send`:**

Отправляет электронное письмо. Возвращает `True`, если отправка успешна, и `False` в противном случае. Логирует ошибки.

```python
def send(subject: str = '', body: str = '', to: str = 'one.last.bit@gmail.com') -> bool:
    """Sends an email.  Returns True if successful, False otherwise. Logs errors."""
    # ... (код функции) ...
```

Параметры:

* `subject`: Тема письма.
* `body`: Тело письма.
* `to`: Адрес получателя.

**Функция `receive`:**

Получает электронные письма. Возвращает список словарей с информацией о письмах, если успешна, и `None` в противном случае. Логирует ошибки.

```python
def receive(imap_server: str, user: str, password: str, folder: str = 'inbox') -> Optional[List[Dict[str, str]]]:
    """Retrieves emails. Returns a list of email dictionaries if successful, None otherwise. Logs errors."""
    # ... (код функции) ...
```

Параметры:

* `imap_server`: Адрес IMAP сервера.
* `user`: Имя пользователя IMAP.
* `password`: Пароль пользователя IMAP.
* `folder`: Папка для получения писем (по умолчанию - "inbox").

**Важно:**

* Убедитесь, что в переменных среды заданы значения `SMTP_SERVER`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASSWORD` и `SMTP_RECEIVER`.  **Не храните эти данные напрямую в коде!**

* Этот код предполагает, что библиотека `src.logger` уже импортирована и определяет функцию `logger.error()`.

Этот модуль предоставляет безопасный и надежный способ отправки и получения электронных писем в Python.  Он использует важные принципы обработки ошибок, безопасного обращения с данными и обрабатывает различные форматы сообщений.
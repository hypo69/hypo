# Документация для `show_all_results.js`

## Оглавление
1. [Обзор](#обзор)
2. [Переменные](#переменные)
3. [Функции](#функции)
    - [`showAllResults`](#showallresults)
    - [`makeTextDownloadUrl`](#maketextdownloadurl)
    - [`makeInfoText`](#makeinfotext)
    - [`makeConvertedInfoText`](#makeconvertedinfotext)
4. [События](#события)

## Обзор

Файл `show_all_results.js` отвечает за отображение результатов выполнения XPath-запроса на странице расширения. Он получает данные от фонового скрипта через `browser.runtime.sendMessage`, обрабатывает их и динамически обновляет HTML-контент страницы, отображая результаты в таблицах и предоставляя возможность экспорта данных. Также обрабатывает клики для взаимодействия с элементами на основной странице.

## Переменные

- `tx`: Псевдоним для объекта `tryxpath`.
- `fu`: Псевдоним для объекта `tryxpath.functions`.
- `document`: Объект `document` текущего окна.
- `detailKeys`: Массив ключей для отображения деталей элементов (`type`, `name`, `value`, `textContent`).
- `headerValues`: Массив заголовков для таблицы деталей элементов (`Type`, `Name`, `Value`, `textContent`).
- `relatedTabId`: ID вкладки, с которой связаны результаты.
- `relatedFrameId`: ID фрейма, с которым связаны результаты.
- `executionId`: ID текущего выполнения XPath-запроса.

## Функции

### `showAllResults`

**Описание**: Обновляет HTML-контент страницы результатами выполнения XPath-запроса.

**Параметры**:
- `results` (Object): Объект, содержащий результаты выполнения XPath-запроса. Включает `message`, `title`, `href`, `frameId`, `context`, и `main` данные.

**Возвращает**:
- `undefined`: Функция ничего не возвращает явно. Обновляет HTML-контент.

**Вызывает исключения**:
- `fu.onError`: Вызывается в случае ошибки при обновлении таблицы деталей.

### `makeTextDownloadUrl`

**Описание**: Создаёт URL для скачивания текстового файла из переданной строки.

**Параметры**:
- `text` (String): Строка текста, которую нужно скачать.

**Возвращает**:
- `String`: URL для скачивания текстового файла.

**Вызывает исключения**:
- Нет явных исключений.

### `makeInfoText`

**Описание**: Формирует текстовое представление информации о результатах запроса, включая контекст и основные результаты.

**Параметры**:
- `results` (Object): Объект, содержащий результаты выполнения XPath-запроса.

**Возвращает**:
- `String`: Текстовое представление информации о результатах запроса.

**Вызывает исключения**:
- Нет явных исключений.

### `makeConvertedInfoText`

**Описание**: Формирует текстовое представление информации о результатах запроса, включая контекст и основные результаты, с преобразованием значений `value` и `textContent` в JSON.

**Параметры**:
- `results` (Object): Объект, содержащий результаты выполнения XPath-запроса.

**Возвращает**:
- `String`: Текстовое представление информации о результатах запроса с преобразованными значениями.

**Вызывает исключения**:
- Нет явных исключений.

## События

- **`window.addEventListener("load", function() { ... });`**:
  - **Описание**: Выполняется после полной загрузки страницы. Отправляет сообщение фоновому скрипту для получения результатов, обновляет контент страницы и настраивает обработчики событий для элементов таблицы.
  - **События**:
    - `browser.runtime.sendMessage({"event":"loadResults"})`: Получает результаты выполнения XPath запроса из фонового скрипта.
    - **Клик по таблице `context-detail`**: Отправляет сообщение фоновому скрипту для фокусировки на элементе контекста.
    - **Клик по таблице `main-details`**: Отправляет сообщение фоновому скрипту для фокусировки на основном элементе.
  - **Обработка ошибок**:
    - `fu.onError`:  Обрабатывает ошибки, возникшие в процессе асинхронных операций.
```markdown
# which

A Node.js module that finds the first instance of an executable in the PATH.

This module is a Node.js port of the `which` utility, commonly found in Unix-like systems.  It searches the user's `PATH` environment variable to locate an executable file.  Crucially, it does *not* cache the results, ensuring accurate results even if the `PATH` changes.

## Installation

```bash
npm install which
```

## Usage

This module provides both asynchronous and synchronous methods:

### Asynchronous Usage

```javascript
const which = require('which');

which('node', (error, resolvedPath) => {
  if (error) {
    console.error('Error:', error);
    return; // Handle the error appropriately
  }
  console.log('Node executable found at:', resolvedPath);
});
```

This example uses a callback function to handle the result, including potential errors if the executable is not found.

### Promise Usage

```javascript
const which = require('which');

which('node')
  .then(resolvedPath => {
    console.log('Node executable found at:', resolvedPath);
  })
  .catch(error => {
    console.error('Error:', error);
    // Handle the error, for example, by prompting the user to install node
  });
```

This provides a cleaner and more modern way to handle asynchronous operations, utilizing Promises.


### Synchronous Usage

```javascript
const which = require('which');

try {
  const resolvedPath = which.sync('node');
  console.log('Node executable found at:', resolvedPath);
} catch (error) {
  console.error('Error:', error);
  // Handle the error
}
```

This is useful for cases where you need the result immediately.  It throws an error if the executable isn't found.

### Handling Errors

In all cases, it's critical to handle potential errors (e.g., the executable not being found). The `error` object contains details about the failure.


### Advanced Options

You can override the `PATH` and `PATHEXT` environment variables using options:

```javascript
const which = require('which');

which('my-executable', { path: '/some/custom/path' }, (error, resolvedPath) => {
  // ... handle the result ...
});
```

This example searches for `my-executable` only within `/some/custom/path`.  Similarly, you can use the `pathExt` option to override the expected extensions.


### Finding All Matches (`all` option)

```javascript
const which = require('which');

which('node', { all: true }, (error, resolvedPaths) => {
  if (error) {
    // ... handle error
  } else {
    if (resolvedPaths.length === 0) {
      console.log('No matching executables found.');
    } else {
      console.log('Executable found at these locations:', resolvedPaths);
    }
  }
});
```

The `all` option returns an array containing all the matches found in the `PATH`.  If no matches are found, the array will be empty.


## CLI Usage

This module can also be used from the command line (if you install it globally or in a CLI tool):


```
usage: which [-as] program ...
```

Refer to the original documentation for complete CLI options.


## API

The `which` function exports the following:

*   `which(program, [options], callback)`
*   `which.sync(program, [options])`

## Compatibility

This module aims for compatibility across Node.js versions.  However, it is best practice to test the compatibility with your target Node.js environment.
```
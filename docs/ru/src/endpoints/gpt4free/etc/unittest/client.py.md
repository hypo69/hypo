# Модуль unittest для тестирования клиентской части gpt4free

## Обзор

Этот модуль содержит юнит-тесты для проверки функциональности асинхронного и синхронного клиентов gpt4free, включая обработку ответов, передачу моделей, ограничение количества токенов и работу с потоками данных.

## Подробней

Модуль предоставляет набор тестов для проверки корректности работы клиентов `gpt4free` в различных сценариях, включая асинхронные и синхронные вызовы, передачу моделей, ограничение количества токенов и обработку потоковых данных. Он использует mocks для имитации поведения различных провайдеров и моделей, что позволяет изолированно тестировать клиентскую часть библиотеки.

## Классы

### `AsyncTestPassModel`

**Описание**: Класс содержит асинхронные тесты для проверки функциональности клиента.

**Наследует**: `unittest.IsolatedAsyncioTestCase`

**Методы**:

- `test_response`: Тест проверяет корректность обработки ответа от асинхронного клиента.
- `test_pass_model`: Тест проверяет корректность передачи модели асинхронному клиенту.
- `test_max_tokens`: Тест проверяет ограничение количества токенов в ответе от асинхронного клиента.
- `test_max_stream`: Тест проверяет работу с потоковыми данными от асинхронного клиента.
- `test_stop`: Тест проверяет остановку генерации текста на определенных словах от асинхронного клиента.

### `TestPassModel`

**Описание**: Класс содержит синхронные тесты для проверки функциональности клиента.

**Наследует**: `unittest.TestCase`

**Методы**:

- `test_response`: Тест проверяет корректность обработки ответа от синхронного клиента.
- `test_pass_model`: Тест проверяет корректность передачи модели синхронному клиенту.
- `test_max_tokens`: Тест проверяет ограничение количества токенов в ответе от синхронного клиента.
- `test_max_stream`: Тест проверяет работу с потоковыми данными от синхронного клиента.
- `test_stop`: Тест проверяет остановку генерации текста на определенных словах от синхронного клиента.
- `test_model_not_found`: Тест проверяет обработку ошибки, когда модель не найдена.
- `test_best_provider`: Тест проверяет выбор лучшего провайдера для заданной модели.
- `test_default_model`: Тест проверяет использование модели по умолчанию.
- `test_provider_as_model`: Тест проверяет использование провайдера в качестве модели.
- `test_get_model`: Тест проверяет получение модели по имени.

## Функции

### `run_exception`

```python
def run_exception():
    """
    Функция создает экземпляр клиента и пытается получить ответ,
    чтобы вызвать исключение ModelNotFoundError.

    Raises:
        ModelNotFoundError: Если модель не найдена.
    """
    ...
```

**Назначение**: Функция предназначена для вызова исключения `ModelNotFoundError` при попытке использовать несуществующую модель.

**Как работает функция**:

1.  Создается экземпляр класса `Client`.
2.  Вызывается метод `client.chat.completions.create` с параметрами `DEFAULT_MESSAGES` и `"Hello"`.

**Примеры**:

```python
try:
    run_exception()
except ModelNotFoundError as ex:
    print(f"ModelNotFoundError caught: {ex}")
```

**ASII flowchart**:

```
A: Создание экземпляра клиента
↓
B: Попытка получить ответ от несуществующей модели
↓
C: Вызов исключения ModelNotFoundError
```

Где:

*   `A`: Создание экземпляра класса `Client`.
*   `B`: Вызов метода `client.chat.completions.create` с параметрами `DEFAULT_MESSAGES` и `"Hello"`.
*   `C`: Возникновение исключения `ModelNotFoundError`, если модель не найдена.

### `get_model_and_provider`

```python
def get_model_and_provider(
    model: str, provider: None, is_stream: bool
) -> tuple[str, Any]:
    """
    Получает модель и провайдера на основе предоставленных параметров.
    Возвращает кортеж, содержащий модель и провайдера.
    """
    ...
```

**Назначение**: Функция определяет модель и провайдера для использования в `gpt4free` на основе входных параметров.

**Параметры**:

*   `model` (str): Имя модели.
*   `provider` (None): Провайдер (не используется в коде).
*   `is_stream` (bool): Флаг, указывающий на потоковую передачу данных.

**Возвращает**:

*   `tuple[str, Any]`: Кортеж, содержащий имя модели и объект провайдера.

**Как работает функция**:

1.  Если `model` не указана, используется модель по умолчанию.
2.  Если `model` совпадает с именем класса провайдера, используется модель по умолчанию для этого провайдера.
3.  Ищется подходящий провайдер для данной модели.
4.  Возвращается кортеж, содержащий имя модели и объект провайдера.

**Примеры**:

```python
model, provider = get_model_and_provider("gpt-4o", None, False)
print(f"Model: {model}, Provider: {provider}")

model, provider = get_model_and_provider("", None, False)
print(f"Model: {model}, Provider: {provider}")

model, provider = get_model_and_provider("Copilot", None, False)
print(f"Model: {model}, Provider: {provider}")
```

**ASII flowchart**:

```
A: Получение модели и провайдера
│
├───> B: Если model не указана, используется модель по умолчанию
│
├───> C: Если model совпадает с именем класса провайдера, используется модель по умолчанию для этого провайдера
│
└───> D: Ищется подходящий провайдер для данной модели
│
E: Возвращается кортеж, содержащий имя модели и объект провайдера
```

Где:

*   `A`: Входные параметры функции.
*   `B`: Проверка на отсутствие указанной модели.
*   `C`: Проверка совпадения имени модели с именем класса провайдера.
*   `D`: Поиск подходящего провайдера для данной модели.
*   `E`: Возвращение кортежа с моделью и провайдером.

```python
if __name__ == '__main__':
    unittest.main()
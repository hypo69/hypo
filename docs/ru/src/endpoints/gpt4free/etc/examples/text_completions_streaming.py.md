# Модуль для демонстрации потоковой передачи текстовых завершений с использованием g4f

## Обзор

Этот модуль демонстрирует, как использовать библиотеку `g4f` для получения текстовых завершений в потоковом режиме как синхронно, так и асинхронно. Он включает примеры использования как `Client`, так и `AsyncClient` для взаимодействия с моделью `gpt-4`.

## Подробнее

Этот код предоставляет два способа взаимодействия с моделью `gpt-4` для получения ответа на вопрос: синхронный и асинхронный. В обоих случаях используется потоковый режим, позволяющий получать ответ частями, что улучшает восприятие скорости работы.

## Функции

### `sync_stream`

```python
def sync_stream():
    """
    Функция выполняет синхронный запрос к модели gpt-4 и выводит полученные чанки текста.

    Args:
        None

    Returns:
        None

    Raises:
        Exception: Если происходит ошибка во время запроса к API.
    """
```

**Как работает функция**:

1.  **Инициализация клиента**: Создается экземпляр класса `Client` из библиотеки `g4f`.
2.  **Создание потока**: Выполняется запрос к `client.chat.completions.create` с указанием модели `gpt-4` и передачей вопроса в параметре `messages`. Устанавливается `stream=True` для получения данных в потоковом режиме.
3.  **Итерация по чанкам**: Цикл `for chunk in stream` итерируется по каждому полученному чанку данных.
4.  **Вывод контента**: Из каждого чанка извлекается текстовое содержимое (`chunk.choices[0].delta.content`) и выводится в консоль без добавления новой строки в конце (`end=""`).
5.  **Обработка пустых чанков**: Если `chunk.choices[0].delta.content` возвращает `None`, используется пустая строка для предотвращения ошибок.

**ASCII Flowchart**:

```
Инициализация клиента (client = Client())
↓
Создание потока (stream = client.chat.completions.create(...))
↓
Итерация по чанкам (for chunk in stream)
│
└──> Извлечение контента (chunk.choices[0].delta.content)
│
└──> Вывод контента (print(..., end=""))
```

**Примеры**:

```python
sync_stream()
```

### `async_stream`

```python
async def async_stream():
    """
    Функция выполняет асинхронный запрос к модели gpt-4 и выводит полученные чанки текста.

    Args:
        None

    Returns:
        None

    Raises:
        Exception: Если происходит ошибка во время запроса к API.
    """
```

**Как работает функция**:

1.  **Инициализация асинхронного клиента**: Создается экземпляр класса `AsyncClient` из библиотеки `g4f`.
2.  **Создание потока**: Выполняется асинхронный запрос к `client.chat.completions.create` с указанием модели `gpt-4` и передачей вопроса в параметре `messages`. Устанавливается `stream=True` для получения данных в потоковом режиме.
3.  **Асинхронная итерация по чанкам**: Цикл `async for chunk in stream` асинхронно итерируется по каждому полученному чанку данных.
4.  **Вывод контента**: Из каждого чанка извлекается текстовое содержимое (`chunk.choices[0].delta.content`) и выводится в консоль без добавления новой строки в конце (`end=""`).
5.  **Проверка существования контента**: Перед выводом контента проверяется, что `chunk.choices` не пуст и `chunk.choices[0].delta.content` существует.

**ASCII Flowchart**:

```
Инициализация асинхронного клиента (client = AsyncClient())
↓
Создание потока (stream = client.chat.completions.create(...))
↓
Асинхронная итерация по чанкам (async for chunk in stream)
│
└──> Проверка наличия контента (chunk.choices and chunk.choices[0].delta.content)
│
└──> Вывод контента (print(..., end=""))
```

**Примеры**:

```python
asyncio.run(async_stream())
```

### `main`

```python
def main():
    """
    Главная функция, запускающая синхронный и асинхронный потоки.

    Args:
        None

    Returns:
        None
    """
```

**Как работает функция**:

1.  **Вывод заголовка для синхронного потока**: Выводит в консоль строку `"Synchronous Stream:"`.
2.  **Запуск синхронного потока**: Вызывает функцию `sync_stream()`.
3.  **Вывод разделителя**: Выводит в консоль две новые строки (`"\\n\\n"`) для разделения вывода синхронного и асинхронного потоков.
4.  **Вывод заголовка для асинхронного потока**: Выводит в консоль строку `"Asynchronous Stream:"`.
5.  **Запуск асинхронного потока**: Запускает асинхронную функцию `async_stream()` с использованием `asyncio.run()`.

**ASCII Flowchart**:

```
Вывод заголовка для синхронного потока (print("Synchronous Stream:"))
↓
Запуск синхронного потока (sync_stream())
↓
Вывод разделителя (print("\\n\\n"))
↓
Вывод заголовка для асинхронного потока (print("Asynchronous Stream:"))
↓
Запуск асинхронного потока (asyncio.run(async_stream()))
```

**Примеры**:

```python
main()
```

## Запуск модуля

```python
if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"An error occurred: {str(e)}")
```

**Как работает**:

1.  **Проверка на запуск как основного модуля**: Код выполняется только если файл запущен напрямую (а не импортирован как модуль).
2.  **Вызов функции `main`**: Вызывается функция `main()`, которая запускает синхронный и асинхронный потоки.
3.  **Обработка исключений**: Если во время выполнения возникает исключение, оно перехватывается, и в консоль выводится сообщение об ошибке.
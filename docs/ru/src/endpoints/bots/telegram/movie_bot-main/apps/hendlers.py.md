# Модуль обработки событий Telegram бота для поиска фильмов
## Обзор

Модуль `hendlers.py` предназначен для обработки различных команд и запросов от пользователей Telegram-бота, связанных с поиском фильмов и сериалов. Он включает в себя обработку команды `/start`, запросов на поиск новых фильмов, а также ввод названия фильма или сериала.

## Подробней

Этот модуль является ключевым компонентом Telegram-бота, отвечающим за взаимодействие с пользователем. Он использует библиотеку `aiogram` для обработки входящих сообщений и callback-запросов, а также модуль `apps.search` для выполнения поисковых запросов. Модуль определяет несколько состояний (`StatesGroup`) для управления процессом поиска фильмов.
В данном коде не используется `logger`, поэтому логирование не требуется.

## Классы

### `Params`

**Описание**: Класс `Params` представляет собой группу состояний (`StatesGroup`), используемых для управления процессом поиска фильмов. Он содержит два состояния: `type_movie` (тип фильма) и `name` (название фильма).

**Принцип работы**:
Класс `Params` наследуется от `StatesGroup` из библиотеки `aiogram.fsm`. Он определяет два состояния:
   - `type_movie`: Состояние, в котором пользователь должен указать тип фильма (фильм или сериал).
   - `name`: Состояние, в котором пользователь должен ввести название фильма или сериала.
Эти состояния используются для управления контекстом диалога с пользователем и сбора необходимых данных для выполнения поискового запроса.

**Атрибуты**:
- `type_movie` (State): Состояние для хранения типа фильма (фильм или сериал).
- `name` (State): Состояние для хранения названия фильма.

## Функции

### `command_start_handler`

```python
async def command_start_handler(message: Message) -> None:
    """
    Приветствует пользователя и предлагает начать поиск фильма.

    Args:
        message (Message): Объект сообщения от пользователя.

    Returns:
        None

    """
```

**Назначение**: Обрабатывает команду `/start`, отправляет приветственное сообщение пользователю и предлагает начать поиск фильма.

**Параметры**:
- `message` (Message): Объект сообщения от пользователя, содержащий информацию о пользователе и текст сообщения.

**Возвращает**:
- `None`

**Как работает функция**:
1. Отправляет приветственное сообщение пользователю с использованием его имени.
2. Предлагает пользователю начать поиск фильма, отправляя сообщение с клавиатурой `kb.find_movie`.

**Примеры**:
```python
# Пример вызова функции (обычно вызывается автоматически aiogram при получении команды /start)
# await command_start_handler(message)
```

### `movie_handler`

```python
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Переводит пользователя в состояние выбора типа фильма (фильм или сериал).

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект, представляющий контекст конечного автомата (FSM).

    Returns:
        None

    """
```

**Назначение**: Обрабатывает callback-запрос `new_movies`, переводит пользователя в состояние выбора типа фильма (фильм или сериал).

**Параметры**:
- `callback` (CallbackQuery): Объект callback-запроса от пользователя, содержащий информацию о нажатой кнопке.
- `state` (FSMContext): Объект, представляющий контекст конечного автомата (FSM), используемый для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
1. Устанавливает состояние `Params.type_movie` с использованием `state.set_state()`.
2. Редактирует сообщение, отправляя пользователю клавиатуру `kb.choice` с вариантами выбора типа фильма (фильм или сериал).

**Примеры**:
```python
# Пример вызова функции (обычно вызывается автоматически aiogram при получении callback-запроса с data == 'new_movies')
# await movie_handler(callback, state)
```

### `series_handler`

```python
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает выбор типа "сериал", удаляет предыдущее сообщение и запрашивает название сериала.

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект, представляющий контекст конечного автомата (FSM).

    Returns:
        None

    """
```

**Назначение**: Обрабатывает callback-запрос `series`, удаляет предыдущее сообщение и запрашивает название сериала.

**Параметры**:
- `callback` (CallbackQuery): Объект callback-запроса от пользователя, содержащий информацию о нажатой кнопке.
- `state` (FSMContext): Объект, представляющий контекст конечного автомата (FSM), используемый для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
1. Удаляет предыдущее сообщение с использованием `callback.message.delete()`.
2. Обновляет данные состояния, сохраняя тип фильма как `series` с использованием `state.update_data()`.
3. Устанавливает состояние `Params.name` с использованием `state.set_state()`.
4. Отправляет пользователю сообщение с запросом названия сериала.

**Примеры**:
```python
# Пример вызова функции (обычно вызывается автоматически aiogram при получении callback-запроса с data == 'series')
# await series_handler(callback, state)
```

### `film_handler`

```python
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает выбор типа "фильм", удаляет предыдущее сообщение и запрашивает название фильма.

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект, представляющий контекст конечного автомата (FSM).

    Returns:
        None

    """
```

**Назначение**: Обрабатывает callback-запрос `film`, удаляет предыдущее сообщение и запрашивает название фильма.

**Параметры**:
- `callback` (CallbackQuery): Объект callback-запроса от пользователя, содержащий информацию о нажатой кнопке.
- `state` (FSMContext): Объект, представляющий контекст конечного автомата (FSM), используемый для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
1. Удаляет предыдущее сообщение с использованием `callback.message.delete()`.
2. Обновляет данные состояния, сохраняя тип фильма как `film` с использованием `state.update_data()`.
3. Устанавливает состояние `Params.name` с использованием `state.set_state()`.
4. Отправляет пользователю сообщение с запросом названия фильма.

**Примеры**:
```python
# Пример вызова функции (обычно вызывается автоматически aiogram при получении callback-запроса с data == 'film')
# await film_handler(callback, state)
```

### `name_handler`

```python
async def name_handler(message: Message, state: FSMContext) -> None:
    """
    Обрабатывает введенное пользователем название фильма, выполняет поиск и отправляет результат.

    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект, представляющий контекст конечного автомата (FSM).

    Returns:
        None

    """
```

**Назначение**: Обрабатывает введенное пользователем название фильма, выполняет поиск и отправляет результат.

**Параметры**:
- `message` (Message): Объект сообщения от пользователя, содержащий введенное название фильма.
- `state` (FSMContext): Объект, представляющий контекст конечного автомата (FSM), используемый для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
1. Обновляет данные состояния, сохраняя введенное название фильма с использованием `state.update_data()`.
2. Извлекает данные из состояния с использованием `state.get_data()`.
3. Выполняет поисковый запрос с использованием функции `search_query()` из модуля `apps.search`.
4. Отправляет пользователю информацию о запросе (название и тип фильма).
5. Если фильм найден, отправляет информацию о фильме (название, описание и ссылку).
6. Если фильм не найден, отправляет сообщение об отсутствии результатов.
7. Предлагает пользователю начать новый поиск фильма, отправляя сообщение с клавиатурой `kb.find_movie`.
8. Очищает состояние с использованием `state.clear()`.

**Примеры**:
```python
# Пример вызова функции (обычно вызывается автоматически aiogram при получении сообщения в состоянии Params.name)
# await name_handler(message, state)
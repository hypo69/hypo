# Модуль миграции базы данных: `2fda6446e69f_initial_revision.py`

## Обзор

Этот модуль содержит скрипт миграции базы данных, созданный Alembic. Он определяет структуру базы данных для бота цифрового рынка Telegram, включая таблицы для категорий, пользователей, продуктов и покупок. Модуль содержит функции `upgrade` для применения изменений и `downgrade` для отката изменений.

## Подробней

Этот скрипт миграции предназначен для первоначальной настройки базы данных. Он создает таблицы, необходимые для функционирования бота, включая информацию о пользователях, категориях продуктов, самих продуктах и истории покупок. Alembic используется для управления версиями базы данных, что позволяет легко применять и откатывать изменения схемы.

## Переменные

- `revision` (str): Идентификатор текущей ревизии миграции.
- `down_revision` (Union[str, None]): Идентификатор предыдущей ревизии миграции (если есть).
- `branch_labels` (Union[str, Sequence[str], None]): Метки веток для миграции.
- `depends_on` (Union[str, Sequence[str], None]): Список зависимостей от других миграций.

## Функции

### `upgrade`

```python
def upgrade() -> None:
    """Применяет изменения, необходимые для данной миграции."""
```

**Как работает функция**:

Функция `upgrade` выполняет следующие действия:

1.  Создает таблицу `categories` с полями:
    *   `category_name` (Text): Название категории (обязательное поле).
    *   `id` (Integer): Уникальный идентификатор категории (автоинкрементное, обязательное поле, первичный ключ).
    *   `created_at` (TIMESTAMP): Временная метка создания записи (по умолчанию текущее время, обязательное поле).
    *   `updated_at` (TIMESTAMP): Временная метка обновления записи (по умолчанию текущее время, обязательное поле).

2.  Создает таблицу `users` с полями:
    *   `telegram_id` (BigInteger): Уникальный идентификатор пользователя в Telegram (обязательное поле, уникальный индекс).
    *   `username` (String): Имя пользователя в Telegram (необязательное поле).
    *   `first_name` (String): Имя пользователя (необязательное поле).
    *   `last_name` (String): Фамилия пользователя (необязательное поле).
    *   `id` (Integer): Уникальный идентификатор пользователя (автоинкрементное, обязательное поле, первичный ключ).
    *   `created_at` (TIMESTAMP): Временная метка создания записи (по умолчанию текущее время, обязательное поле).
    *   `updated_at` (TIMESTAMP): Временная метка обновления записи (по умолчанию текущее время, обязательное поле).

3.  Создает таблицу `products` с полями:
    *   `name` (Text): Название продукта (обязательное поле).
    *   `description` (Text): Описание продукта (обязательное поле).
    *   `price` (Integer): Цена продукта (обязательное поле).
    *   `file_id` (Text): Идентификатор файла продукта (необязательное поле).
    *   `category_id` (Integer): Идентификатор категории продукта (обязательное поле, внешний ключ к таблице `categories`).
    *   `id` (Integer): Уникальный идентификатор продукта (автоинкрементное, обязательное поле, первичный ключ).
    *   `created_at` (TIMESTAMP): Временная метка создания записи (по умолчанию текущее время, обязательное поле).
    *   `updated_at` (TIMESTAMP): Временная метка обновления записи (по умолчанию текущее время, обязательное поле).

4.  Создает таблицу `purchases` с полями:
    *   `user_id` (Integer): Идентификатор пользователя, совершившего покупку (обязательное поле, внешний ключ к таблице `users`).
    *   `product_id` (Integer): Идентификатор купленного продукта (обязательное поле, внешний ключ к таблице `products`).
    *   `price` (Integer): Цена покупки (обязательное поле).
    *   `id` (Integer): Уникальный идентификатор покупки (автоинкрементное, обязательное поле, первичный ключ).
    *   `created_at` (TIMESTAMP): Временная метка создания записи (по умолчанию текущее время, обязательное поле).
    *   `updated_at` (TIMESTAMP): Временная метка обновления записи (по умолчанию текущее время, обязательное поле).

### `downgrade`

```python
def downgrade() -> None:
    """Откатывает изменения, внесенные данной миграцией."""
```

**Как работает функция**:

Функция `downgrade` выполняет следующие действия:

1.  Удаляет таблицу `purchases`.
2.  Удаляет таблицу `products`.
3.  Удаляет таблицу `users`.
4.  Удаляет таблицу `categories`.
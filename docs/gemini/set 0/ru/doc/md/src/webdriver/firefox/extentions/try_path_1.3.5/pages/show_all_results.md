# Модуль show_all_results.js

## Обзор

Этот модуль отвечает за отображение результатов поиска, полученных из расширения `tryxpath`. Он отображает информацию о контексте и основных результатах поиска на странице, включая заголовки, URL, информацию о методе и выражении, а также детали элементов. Модуль также предоставляет возможность скачивания текстовых представлений результатов, как в обычном формате, так и в формате с конвертированными значениями в JSON.

## Функции

### `showAllResults`

**Описание**: Функция отображает результаты поиска на странице.

**Параметры**:
- `results` (объект): Объект, содержащий результаты поиска, включая информацию о контексте, основных результатах и других данных.

**Обрабатывает исключения**:
- `fu.onError`: Обрабатывает исключения, возникшие при обновлении таблицы деталей.

**Внутренние операции**:
- Обновляет элементы HTML на странице с результатами поиска, включая сообщения, заголовки, URL и информацию о контексте.
- Использует функцию `fu.updateDetailsTable` для динамического заполнения таблиц деталей контекста и основных результатов.
- При отсутствии контекста удаляет соответствующую область на странице.

### `makeTextDownloadUrl`

**Описание**: Создаёт URL для скачивания текстового файла.

**Параметры**:
- `text` (строка): Текст, который будет сохранён в файле.

**Возвращает**:
- `string`: URL для скачивания текстового файла.


### `makeInfoText`

**Описание**: Создаёт строку текста, содержащую информацию о результатах в формате для скачивания.

**Параметры**:
- `results` (объект): Объект с результатами.

**Возвращает**:
- `string`: Строка текста, содержащая информацию о результатах поиска.

**Подробности**:
- Форматирует информацию о результатах в удобном для чтения формате, включая контекст и главные результаты поиска.
- Содержит данные в формате `[Information]`, `[Context information]`, `[Context detail]`, `[Main information]`, `[Main details]`

### `makeConvertedInfoText`

**Описание**: Создаёт строку текста, содержащую информацию о результатах в формате для скачивания с преобразованием значений в JSON.

**Параметры**:
- `results` (объект): Объект с результатами.

**Возвращает**:
- `string`: Строка текста, содержащая информацию о результатах поиска в формате с JSON конвертированными значениями.

**Подробности**:
- Аналогична функции `makeInfoText`, но преобразует значения в JSON для отображения.


## Обработчик событий

### Обработчик `load`

**Описание**: Обработчик события `load`, запускается после загрузки страницы.

**Операции**:
- Отправляет запрос на получение результатов (`browser.runtime.sendMessage`).
- При успешном получении результатов:
    - Сохраняет ID вкладки и фрейма для дальнейших операций.
    - Устанавливает атрибуты `download` и `href` для элементов скачивания, формируя URL на основе `makeInfoText` и `makeConvertedInfoText`.
    - Вызывает функцию `showAllResults` для отображения результатов на странице.
- Обрабатывает исключения с помощью `fu.onError`.
- Привязывает обработчики событий нажатия к таблицам контекста и основных результатов для перехода к выбранному элементу.


## Дополнительные замечания

Модуль использует функции из `tryxpath` для обновления таблиц и обработки исключений.  В коде использовано внутреннее API для коммуникации между расширением и страницей, а также для отображения информации на странице.  Используются современные методы работы с DOM и событиями.
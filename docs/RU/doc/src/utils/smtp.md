# Модуль `hypotez/src/utils/smtp.py`

## Обзор

Модуль `smtp.py` предоставляет функции для отправки и получения электронных писем через SMTP и IMAP сервера соответственно.  Он предназначен для безопасного взаимодействия с почтовыми службами, избегая прямого хранения паролей в коде.

## Функции

### `send`

**Описание**: Отправляет электронное письмо с заданным темой и текстом.

**Параметры**:
- `subject` (str, необязательно): Тема письма. По умолчанию пустая строка.
- `body` (str, необязательно): Текст письма. По умолчанию пустая строка.
- `to` (str, необязательно): Адрес получателя. По умолчанию `one.last.bit@gmail.com`.

**Возвращает**:
- `bool`: `True`, если письмо отправлено успешно, `False` в случае ошибки.

**Вызывает исключения**:
- Различные исключения (`Exception`):  При возникновении проблем при подключении к SMTP серверу, аутентификации или отправке письма. Ошибки логгируются.


### `receive`

**Описание**: Получает электронные письма с IMAP сервера.

**Параметры**:
- `imap_server` (str): Адрес IMAP сервера.
- `user` (str): Пользовательское имя (логин) для IMAP.
- `password` (str): Пароль для IMAP.
- `folder` (str, необязательно): Название папки для поиска писем (по умолчанию `inbox`).

**Возвращает**:
- `Optional[List[Dict[str, str]]]`: Список словарей, каждый из которых представляет электронное письмо. Словарь содержит поля `subject`, `from`, `body`. Возвращает `None` в случае ошибки.

**Вызывает исключения**:
- Различные исключения (`Exception`):  При возникновении проблем при подключении к IMAP серверу, аутентификации или получении писем. Ошибки логгируются.

## Важные замечания

* **Безопасность:**  Не храните учетные данные (логин и пароль) напрямую в этом файле. Используйте переменные окружения для хранения данных доступа.
* **Обработка ошибок:** Код содержит надежную обработку ошибок. Все исключения логгируются с подробными данными, что упрощает отладку.
* **Обработка MIME:** Функция `receive` правильно обрабатывает различные форматы электронных писем, избегая потенциальных ошибок.
* **Обработка кодировки:**  В функции `receive` используется декодирование тела письма с учетом возможных проблем кодировки (`decode("utf-8", "ignore")`). Это важно для устойчивости к различным форматам писем.

## Конфигурация

Данные подключения к почтовым серверам хранятся в словаре `_connection`.  Критически важно, что эти данные не должны храниться в самом коде, а читаться из переменных среды (e.g., `os.environ`).
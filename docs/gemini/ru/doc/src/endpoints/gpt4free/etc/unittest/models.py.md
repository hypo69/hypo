# Документация модуля `models.py`

## Обзор

Модуль содержит набор тестов для проверки наличия моделей у различных провайдеров в библиотеке `g4f`. Он также проверяет, что все провайдеры находятся в рабочем состоянии.

## Подробней

Модуль `models.py` предназначен для автоматизированного тестирования интеграции моделей с провайдерами в библиотеке `g4f`. Он выполняет следующие основные задачи:

1.  **Проверка наличия моделей у провайдеров**: Убеждается, что каждый провайдер, заявленный как поддерживающий определенную модель, действительно имеет ее в списке доступных моделей.
2.  **Проверка работоспособности провайдеров**: Проверяет, что все провайдеры, связанные с определенной моделью, находятся в рабочем состоянии.

Модуль использует юнит-тесты для автоматической проверки этих условий, что позволяет быстро выявлять проблемы совместимости или доступности моделей и провайдеров.

## Классы

### `TestProviderHasModel`

**Описание**: Класс, содержащий юнит-тесты для проверки наличия моделей у провайдеров и работоспособности провайдеров.

**Наследует**

*   `unittest.TestCase`: Базовый класс для создания юнит-тестов в Python.

**Атрибуты**:

*   `cache` (dict): Словарь для хранения кэшированных списков моделей для каждого провайдера, чтобы избежать повторных вызовов `provider.get_models()`.

**Методы**:

*   `test_provider_has_model()`: Проверяет наличие каждой модели у соответствующих провайдеров.
*   `provider_has_model(provider: Type[BaseProvider], model: str)`: Проверяет, что конкретный провайдер имеет указанную модель в списке доступных моделей.
*   `test_all_providers_working()`: Проверяет, что все провайдеры, связанные с моделями, находятся в рабочем состоянии.

## Функции

### `test_provider_has_model`

```python
def test_provider_has_model(self):
    """
    Проверяет наличие каждой модели у соответствующих провайдеров.

    Args:
        self (TestProviderHasModel): Экземпляр класса TestProviderHasModel.

    Returns:
        None

    Raises:
        AssertionError: Если провайдер не имеет заявленной модели.
    """
    ...
```

**Назначение**: Проходит по всем моделям и провайдерам, указанным в `__models__`, и проверяет, что каждый провайдер действительно имеет заявленную модель. Если провайдер является подклассом `ProviderModelMixin`, то используется `model_aliases` для определения имени модели.

**Как работает функция**:

1.  **Инициализация**: Функция итерируется по всем моделям и связанным с ними провайдерам, полученным из `__models__.values()`.
2.  **Проверка подкласса**: Проверяет, является ли провайдер подклассом `ProviderModelMixin`. Если да, то проверяет, есть ли у модели псевдоним в `provider.model_aliases`.
3.  **Получение имени модели**: Если псевдоним есть, используется псевдоним, иначе используется имя модели.
4.  **Вызов `provider_has_model`**: Вызывает метод `self.provider_has_model` для проверки наличия модели у провайдера.

```mermaid
graph LR
    A[Инициализация: Перебор моделей и провайдеров из __models__.values()] --> B{Провайдер - подкласс ProviderModelMixin?};
    B -- Да --> C{Есть псевдоним модели в provider.model_aliases?};
    B -- Нет --> D[Использовать имя модели];
    C -- Да --> E[Использовать псевдоним модели];
    C -- Нет --> D;
    E --> F[Вызов self.provider_has_model(provider, имя_модели)];
    D --> F;
    F --> G[Проверка наличия модели у провайдера];
```

**Примеры**:

Пример вызова функции:

```python
test_instance = TestProviderHasModel()
test_instance.test_provider_has_model()
```

### `provider_has_model`

```python
def provider_has_model(self, provider: Type[BaseProvider], model: str):
    """
    Проверяет, что конкретный провайдер имеет указанную модель в списке доступных моделей.

    Args:
        provider (Type[BaseProvider]): Класс провайдера для проверки.
        model (str): Имя модели для проверки.

    Returns:
        None

    Raises:
        AssertionError: Если провайдер не имеет указанной модели.
    """
    ...
```

**Назначение**: Проверяет, что указанный провайдер имеет указанную модель в списке доступных моделей. Использует кэш для хранения списков моделей провайдеров, чтобы избежать повторных вызовов `provider.get_models()`.

**Как работает функция**:

1.  **Проверка кэша**: Проверяет, есть ли в кэше список моделей для данного провайдера.
2.  **Получение моделей**: Если в кэше нет списка моделей, пытается получить список моделей с помощью `provider.get_models()`. Если происходит ошибка `MissingRequirementsError` или `MissingAuthError`, функция завершается.
3.  **Сохранение в кэше**: Сохраняет полученный список моделей в кэше.
4.  **Проверка наличия модели**: Проверяет, что указанная модель есть в списке моделей провайдера.

```mermaid
graph LR
    A[Проверка: Есть ли список моделей провайдера в кэше?] --> B{Список моделей в кэше?};
    B -- Да --> D[Проверка наличия модели в списке моделей провайдера];
    B -- Нет --> C[Получение списка моделей с помощью provider.get_models()];
    C -- Успех --> E[Сохранение списка моделей в кэше];
    C -- MissingRequirementsError/MissingAuthError --> F[Завершение функции];
    E --> D;
    D --> G{Модель есть в списке моделей провайдера?};
    G -- Да --> H[Функция завершена];
    G -- Нет --> I[Выброс AssertionError];
```

**Примеры**:

Пример вызова функции:

```python
test_instance = TestProviderHasModel()
# Предположим, что BaseProvider и ProviderModel определены
test_instance.provider_has_model(BaseProvider, "gpt-3.5-turbo")
```

### `test_all_providers_working`

```python
def test_all_providers_working(self):
    """
    Проверяет, что все провайдеры, связанные с моделями, находятся в рабочем состоянии.

    Args:
        self (TestProviderHasModel): Экземпляр класса TestProviderHasModel.

    Returns:
        None

    Raises:
        AssertionError: Если провайдер не находится в рабочем состоянии.
    """
    ...
```

**Назначение**: Проверяет, что все провайдеры, связанные с моделями, находятся в рабочем состоянии.

**Как работает функция**:

1.  **Инициализация**: Функция итерируется по всем моделям и связанным с ними провайдерам, полученным из `__models__.values()`.
2.  **Проверка `provider.working`**: Для каждого провайдера проверяется атрибут `provider.working`.
3.  **Assertion**: Если `provider.working` равен `False`, выбрасывается `AssertionError` с указанием имени провайдера и модели.

```mermaid
graph LR
    A[Инициализация: Перебор моделей и провайдеров из __models__.values()] --> B[Проверка значения provider.working];
    B -- provider.working == True --> C[Продолжить перебор];
    B -- provider.working == False --> D[Выброс AssertionError];
```

**Примеры**:

Пример вызова функции:

```python
test_instance = TestProviderHasModel()
test_instance.test_all_providers_working()
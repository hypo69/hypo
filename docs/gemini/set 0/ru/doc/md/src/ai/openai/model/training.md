# Модуль `hypotez/src/ai/openai/model/training.py`

## Обзор

Этот модуль содержит класс `OpenAIModel` для взаимодействия с API OpenAI, управления моделями и их обучения.  Класс предоставляет методы для запросов к модели, анализа тональности ответов, динамического обучения и обучения на заданных данных.  Также включены методы для получения списка доступных моделей и помощников, задания помощника и сохранения истории диалогов.

## Оглавление

* [OpenAIModel](#openai-model-class)
* [Функции](#функции)

## Класс `OpenAIModel`

**Описание**: Класс `OpenAIModel` предназначен для взаимодействия с API OpenAI. Он позволяет отправлять запросы, получать ответы, анализировать тональность и осуществлять обучение моделей.

**Атрибуты**:

* `model`: Идентификатор модели OpenAI (по умолчанию `gpt-4o-mini`).
* `client`: Объект `OpenAI` для взаимодействия с API.
* `current_job_id`: Идентификатор текущей работы обучения.
* `assistant_id`: Идентификатор помощника OpenAI.
* `assistant`: Объект помощника OpenAI.
* `thread`: Объект диалогового потока OpenAI.
* `system_instruction`: Системная инструкция для модели.
* `dialogue_log_path`: Путь к файлу для сохранения диалога (на Google Диск).
* `dialogue`: Список словарей, содержащих сообщения в диалоге.
* `assistants`: Список помощников.
* `models_list`: Список доступных моделей.

**Методы**:

### `__init__`

**Описание**: Инициализирует объект `OpenAIModel`.

**Параметры**:

* `system_instruction` (str, необязательно): Системная инструкция для модели.
* `model_name` (str, необязательно): Имя модели (по умолчанию `gpt-4o-mini`).
* `assistant_id` (str, необязательно): Идентификатор помощника.

**Возвращает**:

*  Не имеет возвращаемого значения.

### `list_models`

**Описание**: Возвращает список доступных моделей OpenAI.

**Параметры**:

* Не имеет параметров.

**Возвращает**:

* `List[str]`: Список идентификаторов моделей.

### `list_assistants`

**Описание**: Возвращает список доступных помощников.

**Параметры**:

* Не имеет параметров.

**Возвращает**:

* `List[str]`: Список имён помощников.


### `set_assistant`

**Описание**: Устанавливает помощника по заданному `assistant_id`.

**Параметры**:

* `assistant_id` (str): Идентификатор помощника.

**Возвращает**:

*  Не имеет возвращаемого значения.


### `_save_dialogue`

**Описание**: Сохраняет диалог в файл.

**Параметры**:

* Не имеет параметров.

**Возвращает**:

* Не имеет возвращаемого значения.


### `determine_sentiment`

**Описание**: Определяет тональность сообщения (положительная, отрицательная или нейтральная).

**Параметры**:

* `message` (str): Сообщение для анализа.

**Возвращает**:

* str: Тональность сообщения (positive, negative, или neutral).


### `ask`

**Описание**: Отправляет сообщение модели и возвращает ответ.

**Параметры**:

* `message` (str): Сообщение для модели.
* `system_instruction` (str, необязательно): Системная инструкция для модели.
* `attempts` (int, необязательно): Количество попыток. По умолчанию 3.


**Возвращает**:

* str: Ответ модели.

**Вызывает исключения**:
* `Exception`:  В случае ошибки при взаимодействии с API.


### `describe_image`

**Описание**: Описывает изображение, используя API OpenAI.

**Параметры**:
* `image_path` (str | Path): Путь к изображению.
* `prompt` (str, необязательно): Запрос для модели.
* `system_instruction` (str, необязательно): Системная инструкция.

**Возвращает**:
* str: Описание изображения.

**Вызывает исключения**:
* `Exception`: В случае ошибки при обработке изображения или взаимодействии с API.

### `describe_image_by_requests`

**Описание**: Описывает изображение, используя API OpenAI (альтернативный метод).

**Параметры**:
* `image_path` (str | Path): Путь к изображению.
* `prompt` (str, необязательно): Запрос для модели.


**Возвращает**:
* str: Описание изображения.

**Вызывает исключения**:
* `Exception`: В случае ошибки при обработке изображения или взаимодействии с API.

### `dynamic_train`

**Описание**: Динамическое обучение модели на основе предыдущих диалогов.

**Параметры**:
* Не имеет параметров.

**Возвращает**:
* Не имеет возвращаемого значения.

**Вызывает исключения**:
* `Exception`: В случае ошибки при динамическом обучении.

### `train`

**Описание**: Обучает модель на заданных данных.

**Параметры**:
* `data` (str, необязательно): Путь к CSV файлу или CSV-строка с данными.
* `data_dir` (Path | str, необязательно): Каталог с CSV файлами для обучения.
* `data_file` (Path | str, необязательно): Путь к одиночному CSV файлу с данными.
* `positive` (bool, необязательно): Признак того, что данные являются положительными. По умолчанию True.


**Возвращает**:
* str | None: Идентификатор задания обучения или None в случае ошибки.

**Вызывает исключения**:
* `Exception`: В случае ошибки при обучении.

### `save_job_id`

**Описание**: Сохраняет идентификатор задания обучения с описанием.

**Параметры**:
* `job_id` (str): Идентификатор задания.
* `description` (str): Описание задания.
* `filename` (str, необязательно): Имя файла для сохранения. По умолчанию "job_ids.json".

**Возвращает**:
* Не имеет возвращаемого значения.


## Функции

### `main`

**Описание**: Главная функция для демонстрации использования `OpenAIModel`.

**Параметры**:

* Не имеет параметров.

**Возвращает**:

* Не имеет возвращаемого значения.

**Описание использования**:  Функция демонстрирует инициализацию `OpenAIModel`, получение списков моделей/помощников, отправку запросов, динамическое обучение, обучение и сохранение результатов.
```
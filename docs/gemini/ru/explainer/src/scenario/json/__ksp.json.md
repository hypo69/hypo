## Анализ JSON-конфигурации для парсинга KSP

### 1. <алгоритм>

JSON-файл представляет собой конфигурацию для процесса парсинга веб-сайта KSP.  Вот пошаговое описание алгоритма, который может использовать эта конфигурация:

1.  **Инициализация**:
    *   Загрузка конфигурации из JSON-файла.
    *   Установка основных параметров парсинга:
        *   `supplier_id`: Уникальный идентификатор поставщика (KSP).
        *   `supplier`: Название поставщика.
        *   `supplier_prefix`: Префикс, используемый для идентификации файлов поставщика.
        *   `start_url`: Стартовый URL для парсинга (главная страница KSP).
        *   `price_rule`: Правило для расчета цены товара.
        *   `if_list`: Условие для обработки списков (первый элемент).
        *   `use_mouse`: Использование мыши при парсинге.
        *  `mandatory`: обязательность парсинга.
        *   `num_items_4_flush`: Количество элементов для сохранения в файл.
        *  `if_login`: Условие авторизации на сайте.
        *   `parcing method [webdriver|api]`: Метод парсинга (web).
        *    `about method web scrapping [webdriver|api]`: комментарии о методах.
        *   `collect_products_from_categorypage`: Нужно ли собирать товары со страниц категорий.

2.  **Обработка сценариев**:
    *   Извлечение списка файлов сценариев из `scenario_files`.
    *   Для каждого файла сценария:
        *   Загрузка файла сценария (например, `ksp_categories_aio_lenovo.json`).
        *   Выполнение парсинга в соответствии с инструкциями из файла сценария.
        *   Пример: `ksp_categories_aio_lenovo.json` - сценарий для парсинга моноблоков Lenovo.
        
3.  **Исключение сценариев**:
    *   Извлечение списка исключенных файлов из `excluded`.
    *   Проверка, является ли текущий файл сценария исключенным:
        *   Если файл есть в списке исключенных, пропустить его.
        *   Пример: `ksp_categories_phones_xiaomi.json` - сценарий для парсинга телефонов Xiaomi, который нужно исключить.
        
4.  **Финальная стадия**:
      * `last_runned_scenario` - имя последнего запущенного сценария.
    *   Выгрузка результатов в базу данных или файлы.

### 2. <mermaid>

```mermaid
flowchart TD
    Start[Start] --> LoadConfig[Загрузка JSON конфигурации]
    LoadConfig --> SetParams[Установка параметров парсинга]
    SetParams --> ScenarioLoop[Цикл по файлам сценариев из scenario_files]
    ScenarioLoop --> CheckExcluded{Проверка на исключение?}
    CheckExcluded -- Да --> NextScenario[Следующий сценарий]
    CheckExcluded -- Нет --> LoadScenario[Загрузка файла сценария]
    LoadScenario --> ExecuteParsing[Выполнение парсинга]
    ExecuteParsing --> NextScenario
    NextScenario --> End{Конец цикла}
    End --> Finish[Завершение]

    style Start fill:#f9f,stroke:#333,stroke-width:2px
    style End fill:#ccf,stroke:#333,stroke-width:2px

    classDef params fill:#ccf,stroke:#333,stroke-width:2px
    class LoadConfig,SetParams,LoadScenario,ExecuteParsing params

     classDef loop fill:#afa,stroke:#333,stroke-width:2px
    class ScenarioLoop, NextScenario loop
    classDef check fill:#faa,stroke:#333,stroke-width:2px
    class CheckExcluded check
     classDef finish fill:#aaf,stroke:#333,stroke-width:2px
    class Finish finish
```

**Объяснение диаграммы `mermaid`:**

*   **Start**: Начало процесса.
*   **LoadConfig**: Загрузка JSON-конфигурации из файла.
*   **SetParams**: Установка параметров парсинга на основе загруженной конфигурации (`supplier_id`, `start_url`, `price_rule`, и т.д.).
*   **ScenarioLoop**: Цикл, который перебирает файлы сценариев, указанные в `scenario_files`.
*   **CheckExcluded**: Проверка, входит ли текущий файл сценария в список `excluded`.
*   **NextScenario**: Переход к следующему файлу сценария.
*   **LoadScenario**: Загрузка конкретного файла сценария (например, `ksp_categories_aio_lenovo.json`).
*   **ExecuteParsing**: Выполнение парсинга на основе инструкций загруженного файла сценария.
*   **End**: Конец цикла по всем сценариям.
*  **Finish**: Завершение процесса парсинга.

Диаграмма отражает последовательность действий, где данные переходят от загрузки конфигурации к выполнению сценариев и проверке исключений.

### 3. <объяснение>

**Импорты**:

В данном коде импорты не используются. Он представляет собой JSON-файл конфигурации, а не Python-код.

**Классы**:

В данном коде классы не используются. Это JSON-файл, который служит для настройки параметров парсера.

**Функции**:

В данном JSON-файле функции не используются. Это структура данных, определяющая настройки.

**Переменные**:

*   `supplier_id` (string): Идентификатор поставщика - "2787".
*   `supplier` (string): Название поставщика - "KSP".
*   `supplier_prefix` (string): Префикс для файлов поставщика - "ksp".
*   `start_url` (string): Начальный URL для парсинга - "https://www.ksp.co.il/".
*   `price_rule` (string): Правило наценки - "+100".
*    `if_list` (string): Условие для обработки списков. - "first".
*    `use_mouse` (boolean): Использование мыши при парсинге. - `false`.
*    `mandatory` (boolean): обязательность парсинга. - `true`.
*    `num_items_4_flush` (integer): Количество элементов для сохранения в файл. - `300`.
*   `if_login` (boolean): Указывает, нужна ли авторизация. - `false`.
*   `parcing method [webdriver|api]` (string): Метод парсинга - "web".
*  `about method web scrapping [webdriver|api]` (string): комментарии о методах парсинга - "Если я работаю через API мне не нужен webdriver".
*   `collect_products_from_categorypage` (boolean): Указывает, нужно ли собирать товары со страниц категорий - `false`.
*   `scenario_files` (array): Список файлов сценариев, которые нужно выполнить.
*   `excluded` (array): Список файлов сценариев, которые нужно исключить.
*  `last_runned_scenario` (string) : имя последнего запущенного сценария - "ksp_categories_phones_apple.json".

**Объяснение**:

Этот JSON-файл задает конфигурацию для процесса парсинга сайта KSP. Он определяет:

*   **Основные параметры:** Идентификатор поставщика, название, стартовый URL и правило для расчета цены.
*   **Метод парсинга:** Метод для парсинга (web scraping).
*   **Сценарии парсинга:** Список JSON-файлов с конкретными сценариями для парсинга различных категорий товаров.
*   **Исключения:** Список файлов сценариев, которые не нужно выполнять.
*   **Флаги:** Флаги для определения поведения парсера (например, использовать мышь, нужно ли авторизоваться).
*   **Дополнительные параметры:** Количество элементов для сброса, метод парсинга.

**Потенциальные ошибки или области для улучшения**:

*   **Дублирование в `excluded`**: Список `excluded` содержит много дубликатов. Это может привести к ошибкам при ручном редактировании конфигурации и излишнему потреблению ресурсов при проверке исключений.
*   **Жесткая привязка к файлам**: Жесткая привязка к именам файлов может усложнить поддержку и рефакторинг.
*  **Неудобное редактирование**: Большое количество исключений может быть сложно редактировать вручную.

**Взаимосвязь с другими частями проекта**:

Этот файл является частью системы парсинга, где:

1.  **Парсер:** Читает этот файл и использует его настройки для парсинга сайта KSP.
2.  **Сценарии парсинга:** Обрабатывает сценарии, указанные в `scenario_files`.
3.  **Система управления:** Управляет процессом парсинга, запуская или исключая сценарии.

В целом, этот JSON-файл является ключевым элементом конфигурации парсера, определяя, какие данные и как будут собираться с сайта KSP.
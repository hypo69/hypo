# Модуль `google_search`

## Обзор

Модуль `google_search` предоставляет класс `GoogleHtmlParser` для парсинга HTML-страниц поисковой выдачи Google. Класс позволяет извлекать различные данные, такие как органические результаты поиска, featured snippet, карточка знаний и скроллируемые виджеты. Модуль поддерживает как мобильную, так и десктопную версии HTML.

## Содержание

1. [Классы](#классы)
    - [`GoogleHtmlParser`](#googlehtmlparser)
2. [Функции](#функции)
    - [`_clean`](#_clean)
    - [`_normalize_dict_key`](#_normalize_dict_key)
    - [`_get_estimated_results`](#_get_estimated_results)
    - [`_get_organic`](#_get_organic)
    - [`_get_featured_snippet`](#_get_featured_snippet)
    - [`_get_knowledge_card`](#_get_knowledge_card)
    - [`_get_scrolling_sections`](#_get_scrolling_sections)
    - [`get_data`](#get_data)

## Классы

### `GoogleHtmlParser`

**Описание**:
Класс для парсинга HTML с Google Search. Парсит HTML страницы поисковой выдачи Google и преобразует её в словарь. Работает как с мобильной, так и с десктопной версией HTML.

**Атрибуты**:
- `tree` (`html.Element`): Дерево документа, полученное через `html.fromstring()`.
- `user_agent` (`str`): User agent, использованный для получения HTML Google Search.

**Методы**:
- `__init__`: Инициализирует объект парсера.
- `_clean`: Очищает строку от лишних символов.
- `_normalize_dict_key`: Нормализует строку для использования в качестве ключа словаря.
- `_get_estimated_results`: Получает количество результатов поиска.
- `_get_organic`: Получает органические результаты поиска.
- `_get_featured_snippet`: Получает featured snippet.
- `_get_knowledge_card`: Получает карточку знаний.
- `_get_scrolling_sections`: Получает данные из скроллируемых виджетов.
- `get_data`: Получает итоговые данные с поисковой страницы.

#### `__init__`
```python
    def __init__(self, html_str: str, user_agent: str = 'desktop') -> None:
        """Инициализация парсера.

        Создает дерево документа из строки HTML.

        Args:
            html_str (str): HTML Google Search в виде строки.
            user_agent (str): User agent для получения HTML. Может быть 'mobile' или 'desktop'.

        Returns:
            None
        """
```

**Описание**:
Инициализирует объект парсера, создавая дерево документа из HTML-строки.

**Параметры**:
- `html_str` (`str`): HTML Google Search в виде строки.
- `user_agent` (`str`, optional): User agent для получения HTML. Может быть `'mobile'` или `'desktop'`. По умолчанию `'desktop'`.

**Возвращает**:
- `None`

## Функции

### `_clean`
```python
    def _clean(self, content: str) -> str:
        """Очистка строки от лишних символов.

        Очищает строку от пробелов и лишних символов.

        Args:
            content (str): Строка для очистки.

        Returns:
            str: Очищенная строка.
        """
```

**Описание**:
Очищает строку от лишних пробелов и символов.

**Параметры**:
- `content` (`str`): Строка для очистки.

**Возвращает**:
- `str`: Очищенная строка.

### `_normalize_dict_key`
```python
    def _normalize_dict_key(self, content: str) -> str:
        """Нормализация строки для использования в качестве ключа словаря.

        Заменяет пробелы на подчеркивания, убирает двоеточия, приводит к нижнему регистру.

        Args:
            content (str): Строка для нормализации.

        Returns:
            str: Нормализованная строка.
        """
```
**Описание**:
Нормализует строку для использования в качестве ключа словаря, заменяя пробелы на подчеркивания, убирая двоеточия и приводя к нижнему регистру.

**Параметры**:
- `content` (`str`): Строка для нормализации.

**Возвращает**:
- `str`: Нормализованная строка.

### `_get_estimated_results`
```python
    def _get_estimated_results(self) -> int:
        """Получение количества результатов поиска.

        Возвращает количество найденных результатов для десктопной версии Google Search.

        Returns:
            int: Число результатов поиска.
        """
```
**Описание**:
Получает количество найденных результатов поиска для десктопной версии Google Search.

**Возвращает**:
- `int`: Число результатов поиска.

### `_get_organic`
```python
    def _get_organic(self) -> list:
        """Получение органических результатов поиска.

        Возвращает список органических результатов без дополнительных фич (snippet, featured snippet и т.д.).

        Returns:
            list: Список словарей с органическими результатами.
        """
```
**Описание**:
Получает органические результаты поиска в виде списка словарей.

**Возвращает**:
- `list`: Список словарей с органическими результатами, включая URL, заголовок, сниппет и rich_snippet.

### `_get_featured_snippet`
```python
    def _get_featured_snippet(self) -> dict | None:
        """Получение featured snippet.

        Если существует, возвращает featured snippet с заголовком и URL.

        Returns:
            dict | None: Словарь с заголовком и URL или None.
        """
```
**Описание**:
Получает featured snippet с заголовком и URL, если он существует.

**Возвращает**:
- `dict | None`: Словарь с заголовком и URL или `None`, если featured snippet отсутствует.

### `_get_knowledge_card`
```python
    def _get_knowledge_card(self) -> dict | None:
        """Получение карточки знаний.

        Возвращает карточку знаний с заголовком, подзаголовком и описанием, если существует.

        Returns:
            dict | None: Словарь с данными карточки знаний или None.
        """
```
**Описание**:
Получает карточку знаний с заголовком, подзаголовком и описанием, если она существует.

**Возвращает**:
- `dict | None`: Словарь с данными карточки знаний или `None`, если карточка знаний отсутствует.

### `_get_scrolling_sections`
```python
    def _get_scrolling_sections(self) -> list:
        """Получение данных из скроллируемых виджетов.

        Возвращает список данных из виджетов, например, топовые истории или твиты.

        Returns:
            list: Список словарей с данными из виджетов.
        """
```
**Описание**:
Получает данные из скроллируемых виджетов, таких как топовые истории или твиты.

**Возвращает**:
- `list`: Список словарей с данными из виджетов, включая заголовок секции и данные.

### `get_data`
```python
    def get_data(self) -> dict:
        """Получение итоговых данных с поисковой страницы.

        Собирает данные с результатов поиска: органические результаты, карточка знаний и др.

        Returns:
            dict: Словарь с данными поисковой страницы.
        """
```
**Описание**:
Собирает все данные с поисковой страницы, включая органические результаты, featured snippet, карточку знаний и скроллируемые виджеты.

**Возвращает**:
- `dict`: Словарь с данными поисковой страницы, включающий общее количество результатов, featured snippet, карточку знаний, органические результаты и данные из скроллируемых виджетов.
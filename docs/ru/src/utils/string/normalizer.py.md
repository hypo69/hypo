# Модуль для нормализации строк и числовых данных

## Обзор

Модуль `normalizer.py` предназначен для нормализации различных типов данных, таких как строки, булевы значения, целые числа и числа с плавающей точкой. Он предоставляет функции для очистки и стандартизации данных, что облегчает их дальнейшую обработку и анализ.
## Подробнее

Модуль содержит набор функций, каждая из которых выполняет определенную задачу по нормализации данных. Например, `normalize_string` удаляет HTML-теги, разрывы строк и специальные символы из строк, а `normalize_boolean` преобразует различные представления булевых значений в стандартный формат (`True` или `False`). Модуль также включает функции для нормализации чисел (`normalize_int`, `normalize_float`) и дат (`normalize_sql_date`). Дополнительно, есть функция `normalize_sku`, которая специализируется на нормализации артикулов товаров (SKU) путем удаления специфических ключевых слов и символов.

Этот модуль важен для предобработки данных, поступающих из различных источников, таких как веб-сайты, базы данных или файлы. Нормализация данных позволяет обеспечить их консистентность и пригодность для дальнейшего использования в различных приложениях.

## Функции

### `normalize_boolean`

```python
def normalize_boolean(input_data: Any) -> bool:
    """ Функция нормализует входные данные в булево значение.

    Args:
        input_data (Any): Данные, которые могут быть представлены как булево значение (например, bool, string, integer).

    Returns:
        bool: Булево представление входных данных.

    Example:
        >>> normalize_boolean('yes')
        True

    Как работает функция:
    1.  Сохраняет исходное значение входных данных.
    2.  Проверяет, является ли входное значение уже булевым, и если да, возвращает его.
    3.  Преобразует входные данные в строку, удаляет пробелы и приводит к нижнему регистру.
    4.  Проверяет, соответствует ли строка одному из значений, представляющих `True` (например, 'true', '1', 'yes').
    5.  Если соответствует, возвращает `True`.
    6.  Проверяет, соответствует ли строка одному из значений, представляющих `False` (например, 'false', '0', 'no').
    7.  Если соответствует, возвращает `False`.
    8.  В случае ошибки логирует ошибку.
    9.  Логирует отладочное сообщение, если входные данные не соответствуют ожидаемым значениям.
    10. Возвращает исходное значение, если не удалось преобразовать входные данные в булево значение.

    ```
    Сохранение исходного значения данных
    │
    Проверка на тип bool -> Возврат значения, если bool
    │
    Преобразование в str, удаление пробелов, приведение к нижнему регистру
    │
    Проверка на соответствие True-значениям
    │
    Возврат True, если соответствует
    │
    Проверка на соответствие False-значениям
    │
    Возврат False, если соответствует
    │
    Логирование ошибки, если не удалось преобразовать
    │
    Логирование отладочного сообщения о неожиданном значении
    │
    Возврат исходного значения
    ```

    **Примеры:**

    ```python
    >>> normalize_boolean('yes')
    True
    >>> normalize_boolean(1)
    True
    >>> normalize_boolean('no')
    False
    >>> normalize_boolean(0)
    False
    >>> normalize_boolean(True)
    True
    >>> normalize_boolean(False)
    False
    >>> normalize_boolean('invalid')
    'invalid'
    ```
### `normalize_string`

```python
def normalize_string(input_data: str | list) -> str:
    """ Функция нормализует строку или список строк.

    Args:
        input_data (str | list): Входные данные, которые могут быть строкой или списком строк.

    Returns:
        str: Очищенная и нормализованная строка в кодировке UTF-8.

    Raises:
        TypeError: Если `input_data` не является строкой или списком.

    Example:
        >>> normalize_string(['Hello', '  World!  '])
        'Hello World!'
    """
```
**Как работает функция:**
1.  Проверяет, является ли входное значение пустым, и если да, возвращает пустую строку.
2.  Сохраняет исходное значение входных данных.
3.  Проверяет, является ли входное значение строкой или списком, и если нет, вызывает исключение `TypeError`.
4.  Если входное значение является списком, объединяет элементы списка в строку через пробел.
5.  Удаляет HTML-теги из строки.
6.  Удаляет разрывы строк из строки.
7.  Удаляет специальные символы из строки.
8.  Нормализует строку, удаляя лишние пробелы.
9.  Кодирует строку в UTF-8 и декодирует обратно.
10. В случае ошибки логирует ошибку и возвращает исходное значение, преобразованное в строку и закодированное в UTF-8.

```
    Проверка на пустое значение -> Возврат пустой строки, если пусто
    │
    Сохранение исходного значения данных
    │
    Проверка типа данных (str или list) -> Вызов TypeError, если не str и не list
    │
    Объединение списка строк в одну строку через пробел, если list
    │
    Удаление HTML-тегов
    │
    Удаление разрывов строк
    │
    Удаление специальных символов
    │
    Нормализация пробелов (удаление лишних)
    │
    Кодирование и декодирование в UTF-8
    │
    Логирование ошибки, если возникла
    │
    Возврат исходного значения в UTF-8
```
**Примеры:**

```python
>>> normalize_string(['Hello', '  World!  '])
'Hello World!'
>>> normalize_string(' Пример строки <b>с HTML</b> ')
'Пример строки с HTML'
>>> normalize_string('Строка\nс переносами\rи символами #@')
'Строка с переносами и символами'
```

### `normalize_int`

```python
def normalize_int(input_data: Union[str, int, float, Decimal]) -> int:
    """ Функция нормализует входные данные в целое число.

    Args:
        input_data (str | int | float | Decimal): Входные данные, которые могут быть числом или его строковым представлением.

    Returns:
        int: Целое представление входных данных.

    Example:
        >>> normalize_int('42')
        42
    """
```

**Как работает функция:**
1.  Сохраняет исходное значение входных данных.
2.  Пытается преобразовать входные данные в целое число.
    *   Если входные данные являются `Decimal`, преобразует их в `int`.
    *   Иначе преобразует входные данные во `float`, а затем в `int`.
3.  В случае ошибки (например, `ValueError`, `TypeError`, `InvalidOperation`) логирует ошибку.
4.  Возвращает исходное значение, если не удалось преобразовать входные данные в целое число.

```
    Сохранение исходного значения данных
    │
    Проверка на тип Decimal -> Преобразование в int, если Decimal
    │
    Преобразование во float -> Преобразование в int
    │
    Логирование ошибки, если возникла
    │
    Возврат исходного значения
```

**Примеры:**

```python
>>> normalize_int('42')
42
>>> normalize_int(42.5)
42
>>> normalize_int(Decimal('42.7'))
42
>>> normalize_int('invalid')
'invalid'
```

### `normalize_float`

```python
def normalize_float(value: Any) -> float | None:
    """ Функция безопасно преобразует входные значения в float или список float.

    Args:
        value (Any): Входное значение для преобразования.
                     Может быть отдельным значением (число или строка) или итерируемым объектом (list/tuple).

    Returns:
        float | List[float] | None: Значение float, список float или None, если преобразование не удалось.

    Example:
        >>> normalize_float("3.14")
        3.14
        >>> normalize_float([1, '2.5', 3])
        [1.0, 2.5, 3.0]
    """
```
**Как работает функция:**
1.  Сохраняет исходное значение входных данных.
2.  Если входное значение пустое, возвращает 0.
3.  Если входное значение является списком или кортежем, рекурсивно вызывает `normalize_float` для каждого элемента и возвращает список float значений.
4.  Пытается преобразовать входное значение во float.
5.  В случае ошибки (например, `ValueError`, `TypeError`) логирует предупреждение.
6.  Возвращает исходное значение, если не удалось преобразовать входные данные в float.

```
    Сохранение исходного значения данных
    │
    Проверка на пустое значение -> Возврат 0, если пусто
    │
    Проверка типа данных (list или tuple) -> Рекурсивный вызов для каждого элемента, если list или tuple
    │
    Преобразование во float
    │
    Логирование предупреждения, если возникла ошибка
    │
    Возврат исходного значения
```

**Примеры:**

```python
>>> normalize_float("3.14")
3.14
>>> normalize_float([1, '2.5', 3])
[1.0, 2.5, 3.0]
>>> normalize_float('invalid')
'invalid'
```

### `normalize_sql_date`

```python
def normalize_sql_date(input_data: str) -> str:
    """ Функция нормализует данные в формат SQL date (YYYY-MM-DD).

    Args:
        input_data (str): Данные, которые могут быть представлены как дата (например, строка, объект datetime).

    Returns:
        str: Нормализованная дата в формате SQL (YYYY-MM-DD) или исходное значение, если преобразование не удалось.

    Example:
        >>> normalize_sql_date('2024-12-06')
        '2024-12-06'
        >>> normalize_sql_date('12/06/2024')
        '2024-12-06'
    """
```

**Как работает функция:**

1.  Сохраняет исходное значение входных данных.
2.  Пытается преобразовать входные данные в дату в формате SQL (YYYY-MM-DD).
    *   Если входные данные являются строкой, пытается распарсить дату из строки, используя различные форматы (`%Y-%m-%d`, `%m/%d/%Y`, `%d/%m/%Y`).
    *   Если входные данные уже являются объектом `datetime`, преобразует их в формат `YYYY-MM-DD`.
3.  В случае ошибки логирует ошибку.
4.  Логирует отладочное сообщение, если не удалось преобразовать входные данные в дату.
5.  Возвращает исходное значение, если не удалось преобразовать входные данные в дату.

```
    Сохранение исходного значения данных
    │
    Проверка на тип str -> Попытка распарсить дату из строки с использованием разных форматов
    │
    Преобразование в объект datetime -> Преобразование в формат YYYY-MM-DD
    │
    Логирование ошибки, если возникла
    │
    Логирование отладочного сообщения о неудачном преобразовании
    │
    Возврат исходного значения
```

**Примеры:**

```python
>>> normalize_sql_date('2024-12-06')
'2024-12-06'
>>> normalize_sql_date('12/06/2024')
'2024-12-06'
>>> normalize_sql_date('invalid')
'invalid'
```

### `simplify_string`

```python
def simplify_string(input_str: str) -> str:
    """  Упрощает входную строку, оставляя только буквы и цифры, заменяя пробелы на подчеркивания.

    @param input_str: Строка для упрощения.
    @return: Упрощенная строка.
    @code
        example_str = "It's a test string with 'single quotes', numbers 123 and symbols!"
        simplified_str = StringNormalizer.simplify_string(example_str)
        print(simplified_str)  # Output: Its_a_test_string_with_single_quotes_numbers_123_and_symbols
    @endcode
    """
```

**Как работает функция:**

1.  Удаляет все символы, кроме букв, цифр и пробелов.
2.  Заменяет пробелы на подчеркивания.
3.  Удаляет повторяющиеся подчеркивания.
4.  В случае ошибки логирует ошибку.
5.  Возвращает исходную строку, если произошла ошибка.

```
    Удаление всех символов, кроме букв, цифр и пробелов
    │
    Замена пробелов на подчеркивания
    │
    Удаление повторяющихся подчеркиваний
    │
    Логирование ошибки, если возникла
    │
    Возврат исходной строки
```

**Примеры:**

```python
example_str = "It's a test string with 'single quotes', numbers 123 and symbols!"
simplified_str = simplify_string(example_str)
print(simplified_str)  # Output: Its_a_test_string_with_single_quotes_numbers_123_and_symbols
```

### `remove_line_breaks`

```python
def remove_line_breaks(input_str: str) -> str:
    """ Функция удаляет разрывы строк из входной строки.

    Args:
        input_str (str): Входная строка.

    Returns:
        str: Строка без разрывов строк.
    """
```

**Как работает функция:**

1.  Заменяет символы новой строки (`\n`) и возврата каретки (`\r`) на пробелы.
2.  Удаляет начальные и конечные пробелы.

```
    Замена \n и \r на пробелы
    │
    Удаление начальных и конечных пробелов
    │
    Возврат результата
```

**Примеры:**

```python
>>> remove_line_breaks('Строка\nс переносами\rи символами')
'Строка с переносами и символами'
```

### `remove_html_tags`

```python
def remove_html_tags(input_html: str) -> str:
    """ Функция удаляет HTML-теги из входной строки.

    Args:
        input_html (str): Входная HTML-строка.

    Returns:
        str: Строка без HTML-тегов.
    """
```

**Как работает функция:**

1.  Использует регулярное выражение для удаления всех HTML-тегов из строки.
2.  Удаляет начальные и конечные пробелы.

```
    Удаление HTML-тегов с помощью регулярного выражения
    │
    Удаление начальных и конечных пробелов
    │
    Возврат результата
```

**Примеры:**

```python
>>> remove_html_tags(' Пример строки <b>с HTML</b> ')
'Пример строки с HTML'
```

### `remove_special_characters`

```python
def remove_special_characters(input_str: str | list, chars: list[str] = None) -> str | list:
    """ Функция удаляет указанные специальные символы из строки или списка строк.

    Args:
        input_str (str | list): Входная строка или список строк.
        chars (list[str], optional): Список символов для удаления. По умолчанию None.

    Returns:
        str | list: Обработанная строка или список с удаленными указанными символами.
    """
```

**Как работает функция:**

1.  Если список символов для удаления не указан, использует список по умолчанию (`['#']`).
2.  Формирует регулярное выражение для удаления указанных символов.
3.  Если входные данные являются списком, применяет регулярное выражение к каждому элементу списка.
4.  Если входные данные являются строкой, применяет регулярное выражение к строке.
5.  Возвращает обработанную строку или список.

```
    Проверка на наличие списка символов для удаления -> Использование списка по умолчанию, если не указан
    │
    Формирование регулярного выражения для удаления символов
    │
    Проверка типа данных (list или str)
    │
    Применение регулярного выражения к каждому элементу списка, если list
    │
    Применение регулярного выражения к строке, если str
    │
    Возврат обработанной строки или списка
```

**Примеры:**

```python
>>> remove_special_characters('Строка с символами #@', chars=['#', '@'])
'Строка с символами '
>>> remove_special_characters(['Строка #1', 'Строка @2'], chars=['#', '@'])
['Строка 1', 'Строка 2']
```

### `normalize_sku`

```python
def normalize_sku(input_str: str) -> str:
    """
    Нормализует артикул товара (SKU), удаляя специфические ивритские ключевые слова и все не-буквенно-цифровые символы,
    кроме дефисов.

    Args:
        input_str (str): Входная строка, содержащая SKU.

    Returns:
        str: Нормализованная строка SKU.

    Example:
        >>> normalize_sku("מקט: 303235-A")
        '303235-A'
        >>> normalize_sku("מק''ט: 12345-B")
        '12345-B'
        >>> normalize_sku("Some text מקט: 123-456-789 other text")
        'Some text 123-456-789 other text' # Important: It now keeps the hyphens and spaces between texts
    """
```

**Как работает функция:**

1.  Удаляет ивритские ключевые слова ("מקט" и "מק''ט") из строки, игнорируя регистр.
2.  Удаляет все не-буквенно-цифровые символы, кроме дефисов.
3.  В случае ошибки логирует ошибку с детальной информацией об исключении.
4.  Возвращает исходную строку, если произошла ошибка.

```
    Удаление ивритских ключевых слов
    │
    Удаление не-буквенно-цифровых символов, кроме дефисов
    │
    Логирование ошибки, если возникла
    │
    Возврат исходной строки
```

**Примеры:**

```python
>>> normalize_sku("מקט: 303235-A")
'303235-A'
>>> normalize_sku("מק''ט: 12345-B")
'12345-B'
>>> normalize_sku("Some text מקט: 123-456-789 other text")
'Some text 123-456-789 other text'
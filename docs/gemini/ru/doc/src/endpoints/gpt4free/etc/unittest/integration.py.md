# Модуль интеграционных тестов для gpt4free

## Обзор

Модуль содержит интеграционные тесты для проверки взаимодействия с различными провайдерами API, такими как Copilot и DDG, используемыми в библиотеке `gpt4free`. Он включает тесты для синхронного и асинхронного взаимодействия, проверяя корректность ответов от этих провайдеров.

## Подробней

Этот модуль выполняет интеграционные тесты, чтобы убедиться, что `gpt4free` правильно взаимодействует с различными провайдерами API. Это важно для обеспечения стабильной и надежной работы библиотеки, поскольку провайдеры могут изменять свои API, что может повлиять на функциональность `gpt4free`. Модуль проверяет, что ответы от провайдеров соответствуют ожидаемому формату и содержат необходимую информацию.

## Классы

### `TestProviderIntegration`

**Описание**: Класс, содержащий интеграционные тесты для синхронного взаимодействия с провайдерами.

**Принцип работы**:
Класс `TestProviderIntegration` наследуется от `unittest.TestCase` и содержит методы для тестирования интеграции с различными провайдерами API в синхронном режиме. Он создает клиентов с использованием разных провайдеров и отправляет им запросы, проверяя, что ответы соответствуют ожидаемому формату.

**Методы**:
- `test_bing`: Тестирует интеграцию с провайдером Copilot.
- `test_openai`: Тестирует интеграцию с провайдером DDG.

#### `test_bing`
```python
    def test_bing(self):
        """
        Тестирует интеграцию с провайдером Copilot.

        Создает клиента с провайдером Copilot, отправляет запрос и проверяет, что ответ содержит ожидаемые данные.

        Args:
            self (TestProviderIntegration): Экземпляр класса TestProviderIntegration.

        Returns:
            None

        Raises:
            AssertionError: Если ответ не является экземпляром ChatCompletion или не содержит "success" в JSON.
        """
```

**Как работает функция**:

1.  **Создание клиента**: Создается экземпляр класса `Client` с указанием провайдера `Copilot`.
2.  **Отправка запроса**: Используется метод `client.chat.completions.create` для отправки запроса с предопределенными сообщениями (`DEFAULT_MESSAGES`) и указанием формата ответа как JSON.
3.  **Проверка ответа**:
    *   Проверяется, что полученный ответ является экземпляром класса `ChatCompletion`.
    *   Загружается содержимое ответа из `response.choices[0].message.content` как JSON и проверяется наличие ключа `"success"` в загруженном JSON.
4.  Если любая из проверок не проходит, вызывается `AssertionError`, указывающий на ошибку в интеграции с провайдером `Copilot`.

**Примеры**:
```python
test_case = TestProviderIntegration()
test_case.test_bing()
```

#### `test_openai`
```python
    def test_openai(self):
        """
        Тестирует интеграцию с провайдером DDG.

        Создает клиента с провайдером DDG, отправляет запрос и проверяет, что ответ содержит ожидаемые данные.

        Args:
            self (TestProviderIntegration): Экземпляр класса TestProviderIntegration.

        Returns:
            None

        Raises:
            AssertionError: Если ответ не является экземпляром ChatCompletion или не содержит "success" в JSON.
        """
```

**Как работает функция**:

1.  **Создание клиента**: Создается экземпляр класса `Client` с указанием провайдера `DDG`.
2.  **Отправка запроса**: Используется метод `client.chat.completions.create` для отправки запроса с предопределенными сообщениями (`DEFAULT_MESSAGES`) и указанием формата ответа как JSON.
3.  **Проверка ответа**:
    *   Проверяется, что полученный ответ является экземпляром класса `ChatCompletion`.
    *   Загружается содержимое ответа из `response.choices[0].message.content` как JSON и проверяется наличие ключа `"success"` в загруженном JSON.
4.  Если любая из проверок не проходит, вызывается `AssertionError`, указывающий на ошибку в интеграции с провайдером `DDG`.

**Примеры**:
```python
test_case = TestProviderIntegration()
test_case.test_openai()
```

### `TestChatCompletionAsync`

**Описание**: Класс, содержащий интеграционные тесты для асинхронного взаимодействия с провайдерами.

**Принцип работы**:
Класс `TestChatCompletionAsync` наследуется от `unittest.IsolatedAsyncioTestCase` и содержит асинхронные методы для тестирования интеграции с различными провайдерами API в асинхронном режиме. Он создает асинхронных клиентов с использованием разных провайдеров и отправляет им запросы, проверяя, что ответы соответствуют ожидаемому формату.

**Методы**:
- `test_bing`: Асинхронно тестирует интеграцию с провайдером Copilot.
- `test_openai`: Асинхронно тестирует интеграцию с провайдером DDG.

#### `test_bing`
```python
    async def test_bing(self):
        """
        Асинхронно тестирует интеграцию с провайдером Copilot.

        Создает асинхронного клиента с провайдером Copilot, отправляет запрос и проверяет, что ответ содержит ожидаемые данные.

        Args:
            self (TestChatCompletionAsync): Экземпляр класса TestChatCompletionAsync.

        Returns:
            None

        Raises:
            AssertionError: Если ответ не является экземпляром ChatCompletion или не содержит "success" в JSON.
        """
```

**Как работает функция**:

1.  **Создание клиента**: Создается экземпляр класса `AsyncClient` с указанием провайдера `Copilot`.
2.  **Отправка запроса**: Используется метод `client.chat.completions.create` для отправки запроса с предопределенными сообщениями (`DEFAULT_MESSAGES`) и указанием формата ответа как JSON.
3.  **Проверка ответа**:
    *   Проверяется, что полученный ответ является экземпляром класса `ChatCompletion`.
    *   Загружается содержимое ответа из `response.choices[0].message.content` как JSON и проверяется наличие ключа `"success"` в загруженном JSON.
4.  Если любая из проверок не проходит, вызывается `AssertionError`, указывающий на ошибку в интеграции с провайдером `Copilot`.

**Примеры**:
```python
test_case = TestChatCompletionAsync()
await test_case.test_bing()
```

#### `test_openai`
```python
    async def test_openai(self):
        """
        Асинхронно тестирует интеграцию с провайдером DDG.

        Создает асинхронного клиента с провайдером DDG, отправляет запрос и проверяет, что ответ содержит ожидаемые данные.

        Args:
            self (TestChatCompletionAsync): Экземпляр класса TestChatCompletionAsync.

        Returns:
            None

        Raises:
            AssertionError: Если ответ не является экземпляром ChatCompletion или не содержит "success" в JSON.
        """
```

**Как работает функция**:

1.  **Создание клиента**: Создается экземпляр класса `AsyncClient` с указанием провайдера `DDG`.
2.  **Отправка запроса**: Используется метод `client.chat.completions.create` для отправки запроса с предопределенными сообщениями (`DEFAULT_MESSAGES`) и указанием формата ответа как JSON.
3.  **Проверка ответа**:
    *   Проверяется, что полученный ответ является экземпляром класса `ChatCompletion`.
    *   Загружается содержимое ответа из `response.choices[0].message.content` как JSON и проверяется наличие ключа `"success"` в загруженном JSON.
4.  Если любая из проверок не проходит, вызывается `AssertionError`, указывающий на ошибку в интеграции с провайдером `DDG`.

**Примеры**:
```python
test_case = TestChatCompletionAsync()
await test_case.test_openai()
```

## Переменные

### `DEFAULT_MESSAGES`
```python
DEFAULT_MESSAGES = [{"role": "system", "content": 'Response in json, Example: {"success": false}'},
                    {"role": "user", "content": "Say success true in json"}]
```

**Описание**: Список сообщений, используемых по умолчанию для отправки запросов к провайдерам.

**Назначение**: Этот список содержит системное сообщение, которое указывает провайдеру вернуть ответ в формате JSON, и пользовательское сообщение, которое просит вернуть `"success": true` в JSON.

## Запуск тестов

Если скрипт запускается напрямую (`if __name__ == '__main__':`), то запускаются все тесты, определенные в модуле, с использованием `unittest.main()`.
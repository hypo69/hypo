# Модуль `experimentation.py`

## Обзор

Этот модуль содержит классы для проведения экспериментов, включая рандомизацию вариантов и применение интервенций. `ABRandomizer` используется для рандомизации и дерандомизации вариантов A/B тестирования, а `Intervention` представляет собой базовый класс для определения и применения различных видов интервенций в эксперименте.

## Содержание

- [Классы](#классы)
    - [`ABRandomizer`](#abrandomizer)
        - [`__init__`](#__init__)
        - [`randomize`](#randomize)
        - [`derandomize`](#derandomize)
        - [`derandomize_name`](#derandomize_name)
    - [`Intervention`](#intervention)
        - [`__init__`](#__init__-1)
        - [`check_precondition`](#check_precondition)
        - [`apply`](#apply)
        - [`set_textual_precondition`](#set_textual_precondition)
        - [`set_functional_precondition`](#set_functional_precondition)
        - [`set_effect`](#set_effect)

## Классы

### `ABRandomizer`

**Описание**: Утилитарный класс для рандомизации между двумя вариантами и последующей дерандомизации.

#### `__init__`

```python
def __init__(self, real_name_1="control", real_name_2="treatment",
                       blind_name_a="A", blind_name_b="B",
                       passtrough_name=[],
                       random_seed=42):
```

**Описание**: Инициализирует объект `ABRandomizer`.

**Параметры**:

- `real_name_1` (str): Название первого варианта (по умолчанию "control").
- `real_name_2` (str): Название второго варианта (по умолчанию "treatment").
- `blind_name_a` (str): Название первого варианта, как его видит пользователь (по умолчанию "A").
- `blind_name_b` (str): Название второго варианта, как его видит пользователь (по умолчанию "B").
- `passtrough_name` (list): Список названий, которые не должны быть рандомизированы и возвращаются как есть (по умолчанию `[]`).
- `random_seed` (int): Зерно для генератора случайных чисел (по умолчанию `42`).

#### `randomize`

```python
def randomize(self, i, a, b):
```

**Описание**: Рандомизирует порядок вариантов `a` и `b` и сохраняет выбор для последующей дерандомизации.

**Параметры**:

- `i` (int): Индекс элемента.
- `a` (str): Первый вариант.
- `b` (str): Второй вариант.

**Возвращает**:

- `tuple`: Кортеж из двух строк, представляющий рандомизированный порядок вариантов.

#### `derandomize`

```python
def derandomize(self, i, a, b):
```

**Описание**: Дерандомизирует порядок вариантов `a` и `b` на основе ранее сохранённого выбора.

**Параметры**:

- `i` (int): Индекс элемента.
- `a` (str): Первый вариант.
- `b` (str): Второй вариант.

**Возвращает**:

- `tuple`: Кортеж из двух строк, представляющий дерандомизированный порядок вариантов.

**Вызывает исключения**:

- `Exception`: Если для элемента `i` не найдена информация о рандомизации.

#### `derandomize_name`

```python
def derandomize_name(self, i, blind_name):
```

**Описание**: Декодирует выбор пользователя на основе ранее сохранённой рандомизации.

**Параметры**:

- `i` (int): Индекс элемента.
- `blind_name` (str): Выбор, сделанный пользователем.

**Возвращает**:

- `str`: Название реального варианта, соответствующее выбору пользователя.

**Вызывает исключения**:

- `Exception`: Если для элемента `i` не найдена информация о рандомизации или если выбор пользователя не распознан.

### `Intervention`

**Описание**: Базовый класс для определения и применения интервенций в эксперименте.

#### `__init__`

```python
def __init__(self, agent=None, agents:list=None, environment=None, environments:list=None):
```

**Описание**: Инициализирует объект `Intervention`.

**Параметры**:

- `agent` (TinyPerson, optional): Агент, к которому применяется интервенция (по умолчанию `None`).
- `agents` (list, optional): Список агентов, к которым применяется интервенция (по умолчанию `None`).
- `environment` (TinyWorld, optional): Окружение, к которому применяется интервенция (по умолчанию `None`).
- `environments` (list, optional): Список окружений, к которым применяется интервенция (по умолчанию `None`).

**Вызывает исключения**:

- `Exception`: Если предоставлены и `agent`, и `agents` или и `environment`, и `environments`, или не предоставлен ни один из этих параметров.

#### `check_precondition`

```python
def check_precondition(self):
```

**Описание**: Проверяет, выполняются ли предусловия для интервенции.

**Вызывает исключения**:

- `NotImplementedError`: Этот метод должен быть реализован в подклассах.

#### `apply`

```python
def apply(self):
```

**Описание**: Применяет интервенцию.

#### `set_textual_precondition`

```python
def set_textual_precondition(self, text):
```

**Описание**: Устанавливает предусловие в виде текста, который должен интерпретироваться языковой моделью.

**Параметры**:

- `text` (str): Текст предусловия.

#### `set_functional_precondition`

```python
def set_functional_precondition(self, func):
```

**Описание**: Устанавливает предусловие в виде функции, которая должна быть выполнена кодом.

**Параметры**:

- `func` (function): Функция предусловия, которая должна принимать аргументы: `agent`, `agents`, `environment`, `environments`.

#### `set_effect`

```python
def set_effect(self, effect_func):
```

**Описание**: Устанавливает функцию, определяющую эффект интервенции.

**Параметры**:

- `effect_func` (function): Функция эффекта интервенции, которая принимает аргументы: `agent`, `agents`, `environment`, `environments`.
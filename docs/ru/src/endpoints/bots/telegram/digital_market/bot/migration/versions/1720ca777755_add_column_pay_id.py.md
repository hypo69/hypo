# Модуль для миграции базы данных: добавление колонки `pay_id`

## Обзор

Этот модуль содержит скрипт миграции базы данных, используемый Alembic для добавления колонки `payment_id` в таблицу `purchases`. Он также включает логику для создания уникального ограничения на эту колонку. Если колонка уже существует, скрипт пропустит добавление, чтобы избежать ошибок.

## Подробней

Этот код предназначен для управления изменениями схемы базы данных. Он добавляет столбец `payment_id` в таблицу `purchases`, если он еще не существует. Он также создает уникальное ограничение для этого столбца. Если столбец уже существует, он пропускает добавление столбца, чтобы избежать ошибок. Точно так же при понижении версии он удаляет столбец и ограничение, только если они существуют. Этот скрипт важен для обеспечения согласованности и правильности схемы базы данных.

## Переменные модуля

- `revision` (str): Идентификатор текущей ревизии миграции.
- `down_revision` (Union[str, None]): Идентификатор предыдущей ревизии миграции.
- `branch_labels` (Union[str, Sequence[str], None]): Метки ветвей, связанные с этой миграцией.
- `depends_on` (Union[str, Sequence[str], None]): Список ревизий, от которых зависит эта миграция.

## Функции

### `upgrade`

```python
def upgrade() -> None:
    """
    Обновляет схему базы данных, добавляя колонку 'payment_id' в таблицу 'purchases', если она еще не существует.
    Также создает уникальное ограничение 'uq_purchases_payment_id' для этой колонки.

    Как работает функция:
    1. Получает соединение с базой данных через `op.get_bind()`.
    2. Использует `PRAGMA table_info('purchases')` для получения информации о колонках в таблице 'purchases'.
    3. Проверяет, существует ли колонка 'payment_id' в таблице.
    4. Если колонки 'payment_id' не существует, добавляет колонку типа String с помощью `op.add_column()`.
    5. Создает уникальное ограничение для колонки 'payment_id' с помощью `op.create_unique_constraint()`.
    6. Если колонка 'payment_id' уже существует, выводит сообщение в консоль о пропуске добавления.
    """
```

### `downgrade`

```python
def downgrade() -> None:
    """
    Откатывает изменения, внесенные функцией upgrade, удаляя колонку 'payment_id' и ограничение 'uq_purchases_payment_id' из таблицы 'purchases', если они существуют.

    Как работает функция:
    1. Получает соединение с базой данных через `op.get_bind()`.
    2. Использует `PRAGMA table_info('purchases')` для получения информации о колонках в таблице 'purchases'.
    3. Проверяет, существует ли колонка 'payment_id' в таблице.
    4. Если колонка 'payment_id' существует, удаляет уникальное ограничение 'uq_purchases_payment_id' с помощью `op.drop_constraint()`.
    5. Удаляет колонку 'payment_id' с помощью `op.drop_column()`.
    6. Если колонка 'payment_id' не существует, выводит сообщение в консоль о пропуске удаления.
    """
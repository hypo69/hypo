# Модуль для работы с CSV и JSON файлами
========================================

Модуль содержит утилиты для работы с CSV и JSON файлами, включая функции для сохранения, чтения и конвертации данных.

## Обзор

Этот модуль предоставляет набор функций для работы с CSV и JSON файлами. Он позволяет сохранять данные в формате CSV, читать данные из CSV файлов, конвертировать CSV в JSON и представлять CSV данные в виде словаря. Модуль использует стандартные библиотеки `csv` и `json`, а также библиотеку `pandas` для более удобной работы с данными.

## Подробней

Этот модуль предназначен для упрощения операций чтения и записи данных в формате CSV и JSON. Он предоставляет функции, которые облегчают преобразование данных между этими форматами и обеспечивают удобный доступ к данным в виде словарей. Модуль также включает обработку исключений и логирование ошибок для обеспечения надежной работы.

## Функции

### `save_csv_file`

```python
def save_csv_file(
    data: List[Dict[str, str]],
    file_path: Union[str, Path],
    mode: str = 'a',
    exc_info: bool = True,
) -> bool:
    """ Saves a list of dictionaries to a CSV file.

    Args:
        data (List[Dict[str, str]]): List of dictionaries to save.
        file_path (Union[str, Path]): Path to the CSV file.
        mode (str): File mode ('a' to append, 'w' to overwrite). Default is 'a'.
        exc_info (bool): Include traceback information in logs.

    Returns:
        bool: True if successful, otherwise False.

    Raises:
        TypeError: If input data is not a list of dictionaries.
        ValueError: If input data is empty.
    """
```

**Назначение**: Сохраняет список словарей в CSV файл.

**Параметры**:
- `data` (List[Dict[str, str]]): Список словарей для сохранения. Каждый словарь представляет строку в CSV файле, где ключи словаря соответствуют заголовкам столбцов.
- `file_path` (Union[str, Path]): Путь к CSV файлу, в который будут сохранены данные. Может быть строкой или объектом `Path`.
- `mode` (str): Режим открытия файла. `'a'` - для добавления данных в конец файла, `'w'` - для перезаписи файла. По умолчанию `'a'`.
- `exc_info` (bool): Флаг, определяющий, нужно ли включать информацию об исключении в логи. По умолчанию `True`.

**Возвращает**:
- `bool`: `True`, если сохранение прошло успешно, `False` в противном случае.

**Вызывает исключения**:
- `TypeError`: Если входные данные не являются списком словарей.
- `ValueError`: Если входные данные пусты.

**Как работает функция**:
1. **Проверка входных данных**: Функция проверяет, является ли входной параметр `data` списком и не является ли он пустым. Если данные не соответствуют этим требованиям, вызываются исключения `TypeError` или `ValueError` соответственно.
2. **Создание пути к файлу**: Создается объект `Path` из параметра `file_path`.
3. **Создание директории**: Функция пытается создать директорию для файла, если она не существует. Параметр `parents=True` позволяет создавать все необходимые родительские директории, а `exist_ok=True` предотвращает возникновение ошибки, если директория уже существует.
4. **Открытие файла**: Открывается файл по указанному пути в заданном режиме (`mode`) с указанием кодировки `utf-8`.
5. **Запись данных в файл**: Создается объект `csv.DictWriter`, который используется для записи словарей в CSV файл. В качестве заголовков столбцов используются ключи первого словаря в списке `data`.
6. **Запись заголовка**: Если файл открыт для записи (`mode == 'w'`) или файл не существует, записывается строка заголовков.
7. **Запись строк данных**: Записываются строки данных из списка словарей `data` в CSV файл.
8. **Обработка исключений**: Если в процессе записи возникает исключение, оно логируется с использованием `logger.error`, и функция возвращает `False`.
9. **Возврат значения**: Если запись прошла успешно, функция возвращает `True`.

```
A: Проверка типа и наличия данных
|
B: Создание директории
|
C: Открытие файла
|
D: Запись заголовка (если необходимо)
|
E: Запись данных
|
F: Обработка исключений
```

**Примеры**:

```python
data = [{'name': 'John', 'age': '30'}, {'name': 'Jane', 'age': '25'}]
file_path = 'output.csv'
result = save_csv_file(data, file_path, mode='w')
print(f"Save successful: {result}")  # Вывод: Save successful: True

data = [{'name': 'Alice', 'age': '22'}]
file_path = 'output.csv'
result = save_csv_file(data, file_path, mode='a')
print(f"Append successful: {result}")  # Вывод: Append successful: True
```

### `read_csv_file`

```python
def read_csv_file(file_path: Union[str, Path], exc_info: bool = True) -> List[Dict[str, str]] | None:
    """ Reads CSV content as a list of dictionaries.

    Args:
        file_path (Union[str, Path]): Path to the CSV file.
        exc_info (bool): Include traceback information in logs.

    Returns:
        List[Dict[str, str]] | None: List of dictionaries or None if failed.

    Raises:
        FileNotFoundError: If file not found.
    """
```

**Назначение**: Читает содержимое CSV файла и возвращает его в виде списка словарей.

**Параметры**:
- `file_path` (Union[str, Path]): Путь к CSV файлу, который нужно прочитать.
- `exc_info` (bool): Флаг, определяющий, нужно ли включать информацию об исключении в логи. По умолчанию `True`.

**Возвращает**:
- `List[Dict[str, str]] | None`: Список словарей, где каждый словарь представляет строку из CSV файла. Ключи словаря соответствуют заголовкам столбцов. Возвращает `None`, если произошла ошибка при чтении файла.

**Вызывает исключения**:
- `FileNotFoundError`: Если файл не найден.

**Как работает функция**:
1. **Открытие файла**: Функция пытается открыть файл по указанному пути в режиме чтения (`'r'`) с указанием кодировки `utf-8`.
2. **Чтение данных из файла**: Создается объект `csv.DictReader`, который используется для чтения CSV файла в виде словарей.
3. **Преобразование в список**: Считываются все строки из файла и преобразуются в список словарей с использованием `list(reader)`.
4. **Обработка исключений**: Если файл не найден, логируется ошибка `FileNotFoundError` с использованием `logger.error`, и функция возвращает `None`. Если в процессе чтения возникает другое исключение, оно также логируется, и функция возвращает `None`.
5. **Возврат значения**: Если чтение прошло успешно, функция возвращает список словарей.

```
A: Открытие файла
|
B: Чтение данных
|
C: Преобразование в список словарей
|
D: Обработка исключений
```

**Примеры**:

```python
file_path = 'input.csv'
data = read_csv_file(file_path)
if data:
    print(f"Read data: {data}")  # Вывод: Read data: [{'name': 'John', 'age': '30'}, {'name': 'Jane', 'age': '25'}]
else:
    print("Failed to read CSV file")
```

### `read_csv_as_json`

```python
def read_csv_as_json(csv_file_path: Union[str, Path], json_file_path: Union[str, Path], exc_info: bool = True) -> bool:
    """ Convert a CSV file to JSON format and save it.

    Args:
        csv_file_path (Union[str, Path]): Path to the CSV file.
        json_file_path (Union[str, Path]): Path to save the JSON file.
        exc_info (bool): Include traceback information in logs.

    Returns:
        bool: True if conversion is successful, else False.
    """
```

**Назначение**: Преобразует CSV файл в JSON формат и сохраняет его в указанный файл.

**Параметры**:
- `csv_file_path` (Union[str, Path]): Путь к CSV файлу, который нужно преобразовать.
- `json_file_path` (Union[str, Path]): Путь к файлу, в который будет сохранен JSON.
- `exc_info` (bool): Флаг, определяющий, нужно ли включать информацию об исключении в логи. По умолчанию `True`.

**Возвращает**:
- `bool`: `True`, если преобразование и сохранение прошли успешно, `False` в противном случае.

**Как работает функция**:
1. **Чтение CSV файла**: Функция вызывает функцию `read_csv_file` для чтения содержимого CSV файла в виде списка словарей.
2. **Проверка данных**: Если `read_csv_file` возвращает `None` (т.е. произошла ошибка при чтении CSV файла), функция возвращает `False`.
3. **Открытие JSON файла**: Функция открывает файл по указанному пути в режиме записи (`'w'`) с указанием кодировки `utf-8`.
4. **Запись данных в JSON файл**: Функция использует `json.dump` для записи списка словарей в JSON файл с отступом в 4 пробела для улучшения читаемости.
5. **Обработка исключений**: Если в процессе чтения или записи возникает исключение, оно логируется с использованием `logger.error`, и функция возвращает `False`.
6. **Возврат значения**: Если преобразование и сохранение прошли успешно, функция возвращает `True`.

```
A: Чтение CSV файла
|
B: Проверка данных
|
C: Открытие JSON файла
|
D: Запись данных в JSON файл
|
E: Обработка исключений
```

**Примеры**:

```python
csv_file_path = 'input.csv'
json_file_path = 'output.json'
result = read_csv_as_json(csv_file_path, json_file_path)
print(f"Conversion successful: {result}")  # Вывод: Conversion successful: True
```

### `read_csv_as_dict`

```python
def read_csv_as_dict(csv_file: Union[str, Path]) -> dict | None:
    """ Convert CSV content to a dictionary.

    Args:
        csv_file (Union[str, Path]): Path to the CSV file.

    Returns:
        dict | None: Dictionary representation of CSV content, or None if failed.
    """
```

**Назначение**: Читает содержимое CSV файла и преобразует его в словарь, где ключ `"data"` содержит список словарей, представляющих строки CSV файла.

**Параметры**:
- `csv_file` (Union[str, Path]): Путь к CSV файлу, который нужно прочитать.

**Возвращает**:
- `dict | None`: Словарь, содержащий ключ `"data"` и список словарей в качестве значения, или `None`, если произошла ошибка при чтении файла.

**Как работает функция**:
1. **Открытие файла**: Функция пытается открыть файл по указанному пути в режиме чтения (`'r'`) с указанием кодировки `utf-8`.
2. **Чтение данных из файла**: Создается объект `csv.DictReader`, который используется для чтения CSV файла в виде словарей.
3. **Преобразование в словарь**: Считываются все строки из файла и преобразуются в словарь, где ключ `"data"` содержит список словарей с данными.
4. **Обработка исключений**: Если в процессе чтения возникает исключение, оно логируется с использованием `logger.error`, и функция возвращает `None`.
5. **Возврат значения**: Если чтение прошло успешно, функция возвращает словарь.

```
A: Открытие файла
|
B: Чтение данных
|
C: Преобразование в словарь
|
D: Обработка исключений
```

**Примеры**:

```python
csv_file = 'input.csv'
data = read_csv_as_dict(csv_file)
if data:
    print(f"Read data: {data}")  # Вывод: Read data: {'data': [{'name': 'John', 'age': '30'}, {'name': 'Jane', 'age': '25'}]}
else:
    print("Failed to read CSV file")
```

### `read_csv_as_ns`

```python
def read_csv_as_ns(file_path: Union[str, Path]) -> List[dict]:
    """!
    Load CSV data into a list of dictionaries using Pandas.

    Args:
        file_path (Union[str, Path]): Path to the CSV file.

    Returns:
        List[dict]: List of dictionaries representing the CSV content.

    Raises:
        FileNotFoundError: If file not found.
    """
```

**Назначение**: Загружает данные из CSV файла в список словарей с использованием библиотеки `pandas`.

**Параметры**:
- `file_path` (Union[str, Path]): Путь к CSV файлу, который нужно прочитать.

**Возвращает**:
- `List[dict]`: Список словарей, представляющих содержимое CSV файла. Возвращает пустой список, если произошла ошибка при чтении файла.

**Вызывает исключения**:
- `FileNotFoundError`: Если файл не найден.

**Как работает функция**:
1. **Чтение CSV файла с использованием pandas**: Функция использует `pd.read_csv` для чтения CSV файла в объект `DataFrame` библиотеки `pandas`.
2. **Преобразование в список словарей**: Функция преобразует `DataFrame` в список словарей с использованием метода `to_dict(orient='records')`.
3. **Обработка исключений**: Если файл не найден, логируется ошибка `FileNotFoundError` с использованием `logger.error`, и функция возвращает пустой список. Если в процессе чтения или преобразования возникает другое исключение, оно также логируется, и функция возвращает пустой список.
4. **Возврат значения**: Если чтение и преобразование прошли успешно, функция возвращает список словарей.

```
A: Чтение CSV файла с использованием pandas
|
B: Преобразование в список словарей
|
C: Обработка исключений
```

**Примеры**:

```python
file_path = 'input.csv'
data = read_csv_as_ns(file_path)
print(f"Read data: {data}")  # Вывод: Read data: [{'name': 'John', 'age': 30}, {'name': 'Jane', 'age': 25}]
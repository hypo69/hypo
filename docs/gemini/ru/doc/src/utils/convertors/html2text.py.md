# Модуль `html2text`

## Обзор

Модуль `html2text` предназначен для преобразования HTML-документов в текст с Markdown-разметкой. Он поддерживает различные HTML-теги, стили и форматирование, преобразуя их в удобочитаемый текстовый формат. Модуль также включает настройки для обработки списков Google Docs, ширины текста и других параметров.

## Содержание

- [Константы](#константы)
- [Функции](#функции)
- [Классы](#классы)
    - [`_html2text`](#_html2text)
- [Пример использования](#пример-использования)

## Константы

- `UNICODE_SNOB`: Флаг, определяющий, использовать ли Unicode-символы вместо их ASCII-заменителей.
- `LINKS_EACH_PARAGRAPH`: Флаг, определяющий, размещать ли ссылки после каждого абзаца или в конце документа.
- `BODY_WIDTH`: Ширина текста для переноса строк. Значение 0 отключает перенос.
- `SKIP_INTERNAL_LINKS`: Флаг, определяющий, пропускать ли внутренние ссылки (например, `href="#local-anchor"`).
- `INLINE_LINKS`: Флаг, определяющий, использовать ли встроенные, а не ссылочные, форматы для изображений и ссылок.
- `GOOGLE_LIST_INDENT`: Количество пикселей, на которое Google отступает вложенные списки.
- `IGNORE_ANCHORS`: Флаг для игнорирования ссылок.
- `IGNORE_IMAGES`: Флаг для игнорирования изображений.

## Функции

### `has_key`

**Описание**: Проверяет, есть ли ключ `y` в словаре или объекте `x`.

**Параметры**:
- `x` (объект): Объект, в котором производится поиск ключа.
- `y` (объект): Искомый ключ.

**Возвращает**:
- `bool`: `True`, если ключ найден, иначе `False`.

### `name2cp`

**Описание**: Преобразует имя HTML-сущности в её кодовую точку.

**Параметры**:
- `k` (str): Имя HTML-сущности.

**Возвращает**:
- `int`: Кодовая точка сущности.

**Вызывает исключения**:
- `KeyError`: Если сущность не найдена.

### `charref`

**Описание**: Преобразует числовую ссылку на символ в символ.

**Параметры**:
- `name` (str): Числовая ссылка на символ (например, `123`, `x4A`).

**Возвращает**:
- `str`: Символ, соответствующий числовой ссылке.

### `entityref`

**Описание**: Преобразует ссылку на HTML-сущность в символ.

**Параметры**:
- `c` (str): Ссылка на HTML-сущность (например, `&nbsp`).

**Возвращает**:
- `str`: Символ, соответствующий сущности, или исходная строка, если сущность не найдена.

### `replaceEntities`

**Описание**: Функция-замена для регулярного выражения, заменяющая HTML-сущности на их символьные эквиваленты.

**Параметры**:
- `s` (re.Match): Объект, соответствующий HTML-сущности.

**Возвращает**:
- `str`: Символьный эквивалент HTML-сущности.

### `unescape`

**Описание**: Преобразует HTML-сущности в их символьные эквиваленты в строке.

**Параметры**:
- `s` (str): Строка с HTML-сущностями.

**Возвращает**:
- `str`: Строка, в которой HTML-сущности заменены на символы.

### `onlywhite`

**Описание**: Проверяет, состоит ли строка только из пробельных символов.

**Параметры**:
- `line` (str): Проверяемая строка.

**Возвращает**:
- `bool`: `True`, если строка состоит только из пробельных символов, иначе `False`.

### `optwrap`

**Описание**: Переносит все абзацы в тексте на новую строку, если они превышают `BODY_WIDTH`.

**Параметры**:
- `text` (str): Текст для переноса.

**Возвращает**:
- `str`: Текст с перенесенными строками.

**Вызывает исключения**:
- `AssertionError`: Если не установлен пакет `textwrap`

### `hn`

**Описание**: Проверяет, является ли тег заголовком (h1-h9) и возвращает его уровень.

**Параметры**:
- `tag` (str): Имя тега.

**Возвращает**:
- `int`: Уровень заголовка (1-9) или 0, если тег не является заголовком.

### `dumb_property_dict`

**Описание**: Преобразует строку CSS-стилей в словарь.

**Параметры**:
- `style` (str): Строка CSS-стилей (например, `"color: red; font-size: 12px;"`).

**Возвращает**:
- `dict`: Словарь, где ключи — имена свойств CSS, а значения — их значения.

### `dumb_css_parser`

**Описание**: Разбирает CSS-текст в словарь селекторов и их стилей.

**Параметры**:
- `data` (str): CSS-текст.

**Возвращает**:
- `dict`: Словарь, где ключи — CSS-селекторы, а значения — словари стилей.

### `element_style`

**Описание**: Возвращает итоговые стили элемента с учетом родительских стилей, классов и внутренних стилей.

**Параметры**:
- `attrs` (dict): Атрибуты элемента.
- `style_def` (dict): Определения стилей CSS.
- `parent_style` (dict): Стили родительского элемента.

**Возвращает**:
- `dict`: Итоговые стили элемента.

### `google_list_style`

**Описание**: Определяет, является ли список упорядоченным или неупорядоченным, исходя из стилей Google Docs.

**Параметры**:
- `style` (dict): Стили элемента.

**Возвращает**:
- `str`: Тип списка (`'ul'` для неупорядоченного, `'ol'` для упорядоченного).

### `google_nest_count`

**Описание**: Вычисляет уровень вложенности списка Google Docs на основе отступов.

**Параметры**:
- `style` (dict): Стили элемента.

**Возвращает**:
- `int`: Уровень вложенности списка.

### `google_has_height`

**Описание**: Проверяет, определено ли явно свойство высоты в CSS-стилях элемента.

**Параметры**:
- `style` (dict): Стили элемента.

**Возвращает**:
- `bool`: `True`, если высота определена, иначе `False`.

### `google_text_emphasis`

**Описание**: Возвращает список модификаторов выделения текста для элемента.

**Параметры**:
- `style` (dict): Стили элемента.

**Возвращает**:
- `list`: Список модификаторов выделения текста (например, `['line-through', 'italic', 'bold']`).

### `google_fixed_width_font`

**Описание**: Проверяет, является ли шрифт элемента фиксированной ширины.

**Параметры**:
- `style` (dict): Стили элемента.

**Возвращает**:
- `bool`: `True`, если шрифт фиксированной ширины, иначе `False`.

### `list_numbering_start`

**Описание**: Извлекает начальный номер из атрибутов списка.

**Параметры**:
- `attrs` (dict): Атрибуты элемента списка.

**Возвращает**:
- `int`: Начальный номер списка.

### `wrapwrite`

**Описание**: Выводит текст в стандартный поток вывода с учетом кодировки UTF-8.

**Параметры**:
- `text` (str): Текст для вывода.

### `html2text_file`

**Описание**: Преобразует HTML-содержимое в текст с Markdown-разметкой и выводит результат в указанный поток.

**Параметры**:
- `html` (str): HTML-текст.
- `out` (function, optional): Функция для вывода текста. По умолчанию `wrapwrite`.
- `baseurl` (str, optional): Базовый URL для разрешения относительных ссылок.

**Возвращает**:
- `str`: Преобразованный текст.

### `html2text`

**Описание**: Преобразует HTML-содержимое в текст с Markdown-разметкой.

**Параметры**:
- `html` (str): HTML-текст.
- `baseurl` (str, optional): Базовый URL для разрешения относительных ссылок.

**Возвращает**:
- `str`: Преобразованный текст.

## Классы

### `_html2text`

**Описание**: Класс для разбора HTML и преобразования его в Markdown. Наследуется от `HTMLParser.HTMLParser`.

**Методы**:
- `__init__(self, out=None, baseurl='')`: Инициализирует парсер.
- `feed(self, data)`: Подает HTML-данные для обработки.
- `outtextf(self, s)`: Сохраняет вывод в списке `outtextlist`.
- `close(self)`: Завершает разбор и возвращает преобразованный текст.
- `handle_charref(self, c)`: Обрабатывает числовые ссылки на символы.
- `handle_entityref(self, c)`: Обрабатывает ссылки на HTML-сущности.
- `handle_starttag(self, tag, attrs)`: Обрабатывает начало HTML-тега.
- `handle_endtag(self, tag)`: Обрабатывает конец HTML-тега.
- `previousIndex(self, attrs)`: Находит индекс ссылки в списке.
- `drop_last(self, nLetters)`: Удаляет последние символы из вывода.
- `handle_emphasis(self, start, tag_style, parent_style)`: Обрабатывает выделение текста (жирный, курсив).
- `handle_tag(self, tag, attrs, start)`: Обрабатывает начало и конец HTML-тега с учётом стилей Google Docs.
- `pbr(self)`: Управляет добавлением разрывов строк.
- `p(self)`: Добавляет два разрыва строки.
- `soft_br(self)`: Добавляет мягкий перенос строки.
- `o(self, data, puredata=0, force=0)`: Выводит обработанные данные.
- `handle_data(self, data)`: Обрабатывает текстовые данные.
- `unknown_decl(self, data)`: Обрабатывает неизвестные объявления.

## Пример использования

```python
import sys
from src.utils.convertors.html2text import html2text

html_content = """
<!DOCTYPE html>
<html>
<head>
    <title>Example</title>
</head>
<body>
    <h1>Заголовок 1</h1>
    <p>Это <b>жирный</b> и <i>курсивный</i> текст.</p>
    <ul>
        <li>Элемент списка 1</li>
        <li>Элемент списка 2</li>
    </ul>
    <a href="https://example.com">Ссылка на example.com</a>
    <img src="image.png" alt="Изображение"/>
</body>
</html>
"""

markdown_text = html2text(html_content)
print(markdown_text)
```
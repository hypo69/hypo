# Анализ кода модуля STOCK

**Качество кода**
9
- Плюсы
    - Документ хорошо структурирован и легко читается.
    - Присутствует четкое описание игры, пошаговая инструкция, пример работы программы, возможные ограничения и рекомендуемые улучшения.
    - Имеется подробное объяснение реализации игры на Python, что упрощает процесс разработки.
- Минусы
    - Документ не содержит кода, только описание и инструкции, что не позволяет оценить качество кода.
    - Отсутствует информация о формате ожидаемого ввода от пользователя, что может привести к ошибкам при реализации.
    - Нет примеров кода с комментариями в формате reStructuredText (RST).

**Рекомендации по улучшению**
1.  **Добавить примеры кода:** Включить примеры кода на Python, которые демонстрируют основные механики игры (инициализация, ход игрока, обновление цен, завершение игры).
2.  **Улучшить документацию кода:** Добавить комментарии в формате reStructuredText (RST) к функциям, методам и классам в примерах кода.
3.  **Формат ввода:** Явно указать формат ожидаемого ввода от пользователя (например, целое число для количества акций).
4.  **Обработка ошибок:** В примерах кода предусмотреть обработку ошибок (например, неверный ввод пользователя) с использованием `logger.error`.
5.  **Использование `j_loads` или `j_loads_ns`**: Описать где и как можно применить эти функции при разработке
6.  **Оптимизировать структуру:** Улучшить структуру документа, добавив разделы "Примеры кода" и "Структура программы".
7. **Документация:** Привести примеры документации в стиле RST
8.  **Логирование:** Добавить в примеры кода пример логирования через `from src.logger.logger import logger`.

**Оптимизированный код**
```markdown
### Название игры: **STOCK** (Акции)

---

#### Описание
**STOCK** — это игра, в которой игрок управляет портфелем акций, покупая и продавая акции на основе прогнозов рынка. Цель игры — максимизировать прибыль, покупая акции по низкой цене и продавая их по высокой. Игра продолжается в течение определённого количества дней, и игрок должен делать выборы, основываясь на прогнозах цен на акции.

---

### Пошаговая инструкция для реализации

#### 1. **Инициализация игры**
   - Программа выводит приветственное сообщение и объясняет правила:
     ```
     Добро пожаловать в STOCK!
     Ваша задача — управлять портфелем акций, покупая и продавая акции на основе прогнозов рынка.
     Цель игры — максимизировать прибыль, покупая акции по низкой цене и продавая их по высокой.
     Игра продолжается в течение 10 дней.
     Удачи!
     ```

   - Программа создаёт список акций с их начальными ценами.
   - Игрок начинает с определённым количеством денег (например, $1000).
   - Игрок поочерёдно делает выборы: покупать, продавать или ничего не делать.

---

#### 2. **Основной процесс игры**

##### **2.1. Ход игрока:**
   - Программа отображает текущие цены на акции и предлагает игроку выбрать действие:
     ```
     День 1:
     Акции компании A: $50
     Акции компании B: $30
     Акции компании C: $70
     Ваш баланс: $1000
     Ваши акции:
     Компания A: 0
     Компания B: 0
     Компания C: 0

     Выберите действие:
     1. Купить акции
     2. Продать акции
     3. Ничего не делать
     ```

   - Игрок выбирает действие и указывает количество акций для покупки или продажи.
   - Программа проверяет, достаточно ли у игрока денег или акций для совершения операции:
     - Если операция возможна, программа обновляет баланс и количество акций.
     - Если операция невозможна, программа сообщает об ошибке и предлагает игроку повторить выбор:
       ```
       Недостаточно денег для покупки. Попробуйте снова.
       ```

##### **2.2. Обновление цен на акции:**
   - После каждого хода программа случайным образом обновляет цены на акции.
   - Программа сообщает новые цены на акции:
     ```
     День 2:
     Акции компании A: $55
     Акции компании B: $28
     Акции компании C: $72
     ```

##### **2.3. Проверка условий завершения игры:**
   - Игра заканчивается после 10 дней.
   - Программа подсчитывает итоговый баланс игрока, включая стоимость всех акций:
     ```
     Игра окончена!
     Ваш итоговый баланс: $1200
     ```

---

#### 3. **Завершение игры**
   - После завершения игры программа предлагает сыграть снова:
     ```
     Хотите сыграть снова? (да/нет)
     ```

   - Если игрок выбирает "да", игра начинается заново с новыми начальными ценами на акции.

---

### Пример работы программы

1. **Начало игры:**
   ```
   Добро пожаловать в STOCK!
   День 1:
   Акции компании A: $50
   Акции компании B: $30
   Акции компании C: $70
   Ваш баланс: $1000
   Ваши акции:
   Компания A: 0
   Компания B: 0
   Компания C: 0

   Выберите действие:
   1. Купить акции
   2. Продать акции
   3. Ничего не делать
   > 1
   Введите количество акций компании A для покупки:
   > 10
   ```

2. **Игровой процесс:**
   ```
   День 2:
   Акции компании A: $55
   Акции компании B: $28
   Акции компании C: $72
   Ваш баланс: $450
   Ваши акции:
   Компания A: 10
   Компания B: 0
   Компания C: 0

   Выберите действие:
   1. Купить акции
   2. Продать акции
   3. Ничего не делать
   > 2
   Введите количество акций компании A для продажи:
   > 5
   ```

3. **Завершение игры:**
   ```
   Игра окончена!
   Ваш итоговый баланс: $1200
   Хотите сыграть снова? (да/нет):
   > нет
   Спасибо за игру!
   ```

---

### Возможные ограничения
- Игрок должен вводить количество акций в правильном формате (целое число).
- Программа должна обрабатывать неверный ввод и предлагать повторить попытку.
- Игрок не может покупать или продавать акции, если у него недостаточно денег или акций.

---

### Реализация
Игра может быть реализована на Python с использованием следующих возможностей:
- **Модуль `random`** для генерации случайных цен на акции.
- **Циклы и условия** для проверки ввода игрока и обработки его ходов.
- **Функции** для обновления баланса и количества акций.

---

### Примеры кода

#### 1. Инициализация игры
```python
"""
Модуль инициализации игры STOCK
=========================================================================================

Этот модуль содержит функции для инициализации игры STOCK, включая установку начальных цен на акции,
начального баланса игрока и других параметров игры.

Пример использования
--------------------

Пример использования функции init_game:

.. code-block:: python

    init_data = init_game()
    print(init_data)
"""
import random

from src.logger.logger import logger


def init_game() -> dict:
    """
    Инициализирует данные для начала игры в STOCK.

    :return: Словарь с начальными данными игры, включая цены на акции, баланс игрока и количество акций.
    :rtype: dict
    """
    try:
        # Код инициализирует начальные цены на акции
        stocks = {
            'A': random.randint(30, 80),
            'B': random.randint(20, 60),
            'C': random.randint(50, 100),
        }
         # Код устанавливает начальный баланс игрока
        balance = 1000
         # Код устанавливает начальное количество акций у игрока
        owned_stocks = {'A': 0, 'B': 0, 'C': 0}
         # Код формирует словарь с начальными данными
        init_data = {'stocks': stocks, 'balance': balance, 'owned_stocks': owned_stocks, 'day': 1}
        return init_data
    except Exception as ex:
        logger.error('Ошибка инициализации игры', exc_info=ex)
        return {}
```

#### 2. Ход игрока
```python
"""
Модуль хода игрока в игре STOCK
=========================================================================================

Этот модуль содержит функции для обработки хода игрока в игре STOCK, включая покупку, продажу
и пропуск хода.

Пример использования
--------------------

Пример использования функции process_player_action:

.. code-block:: python

    game_data = {'stocks': {'A': 50, 'B': 30, 'C': 70}, 'balance': 1000, 'owned_stocks': {'A': 0, 'B': 0, 'C': 0}}
    action = 'buy'
    stock = 'A'
    amount = 10
    updated_data = process_player_action(game_data, action, stock, amount)
    print(updated_data)
"""

from src.logger.logger import logger

def process_player_action(game_data: dict, action: str, stock: str, amount: int) -> dict:
    """
    Обрабатывает действие игрока в игре STOCK.

    :param game_data: Словарь с текущими данными игры.
    :type game_data: dict
    :param action: Действие игрока ('buy', 'sell' или 'skip').
    :type action: str
    :param stock: Название акции, с которой производится действие ('A', 'B', 'C').
    :type stock: str
    :param amount: Количество акций для покупки или продажи.
    :type amount: int
    :return: Обновленный словарь с данными игры.
    :rtype: dict
    """
    try:
        if action == 'buy':
             # Проверка доступности средств
            if game_data['balance'] >= game_data['stocks'][stock] * amount:
                game_data['balance'] -= game_data['stocks'][stock] * amount
                game_data['owned_stocks'][stock] += amount
            else:
                logger.error('Недостаточно денег для покупки.')
                return game_data
        elif action == 'sell':
             # Проверка наличия акций для продажи
            if game_data['owned_stocks'][stock] >= amount:
                game_data['balance'] += game_data['stocks'][stock] * amount
                game_data['owned_stocks'][stock] -= amount
            else:
                logger.error('Недостаточно акций для продажи.')
                return game_data
         # Проверка на пропуск хода
        elif action == 'skip':
            pass
        return game_data
    except Exception as ex:
        logger.error('Ошибка обработки действия игрока', exc_info=ex)
        return game_data
```
#### 3. Обновление цен на акции
```python
"""
Модуль обновления цен на акции в игре STOCK
=========================================================================================

Этот модуль содержит функции для обновления цен на акции в игре STOCK, генерируя
случайные изменения цен.

Пример использования
--------------------

Пример использования функции update_stock_prices:

.. code-block:: python

    game_data = {'stocks': {'A': 50, 'B': 30, 'C': 70}}
    updated_data = update_stock_prices(game_data)
    print(updated_data)
"""
import random

from src.logger.logger import logger

def update_stock_prices(game_data: dict) -> dict:
    """
    Обновляет цены на акции случайным образом.

    :param game_data: Словарь с текущими данными игры.
    :type game_data: dict
    :return: Обновленный словарь с ценами на акции.
    :rtype: dict
    """
    try:
        # Код обновляет цену на каждую акцию
        for stock in game_data['stocks']:
            change = random.randint(-10, 10)
            game_data['stocks'][stock] += change
             # Код гарантирует, что цена не опустится ниже 0
            game_data['stocks'][stock] = max(1, game_data['stocks'][stock])
        return game_data
    except Exception as ex:
        logger.error('Ошибка обновления цен на акции', exc_info=ex)
        return game_data
```

#### 4. Завершение игры
```python
"""
Модуль завершения игры STOCK
=========================================================================================

Этот модуль содержит функции для завершения игры STOCK, включая подсчет итогового баланса
и вывод сообщения о завершении игры.

Пример использования
--------------------

Пример использования функции end_game:

.. code-block:: python

    game_data = {'stocks': {'A': 55, 'B': 28, 'C': 72}, 'balance': 450, 'owned_stocks': {'A': 5, 'B': 0, 'C': 0}}
    end_game(game_data)
"""
from src.logger.logger import logger

def end_game(game_data: dict) -> None:
    """
    Завершает игру STOCK, подсчитывает итоговый баланс и выводит сообщение о завершении игры.

    :param game_data: Словарь с текущими данными игры.
    :type game_data: dict
    """
    try:
        # Код подсчитывает стоимость всех имеющихся акций
        total_value = game_data['balance']
        for stock, amount in game_data['owned_stocks'].items():
            total_value += game_data['stocks'][stock] * amount
        # Код выводит итоговый баланс и сообщение о завершении игры
        print(f'Игра окончена!\nВаш итоговый баланс: ${total_value}')
    except Exception as ex:
         logger.error('Ошибка при завершении игры', exc_info=ex)
```

---

### Структура программы
- **Инициализация:**
  - `init_game()`:  Функция для инициализации игры, устанавливает начальные цены акций, баланс игрока и другие параметры.
- **Ход игрока:**
  - `process_player_action(game_data, action, stock, amount)`: Функция для обработки хода игрока, которая обновляет баланс и количество акций в зависимости от действий игрока (покупка, продажа или пропуск хода).
- **Обновление цен:**
  - `update_stock_prices(game_data)`: Функция для случайного обновления цен на акции.
- **Завершение игры:**
  - `end_game(game_data)`: Функция для подсчета итогового баланса и вывода сообщения о завершении игры.

---

### Рекомендуемые улучшения
- Добавить возможность выбора количества дней (например, 5 или 15).
- Реализовать графический интерфейс для визуализации цен на акции и баланса.
- Добавить возможность игры с несколькими игроками.
- Сохранение и загрузка состояния игры.
- Разные уровни сложности
```
# Модуль для обработки диалогов с использованием g4f

## Обзор

Этот модуль предоставляет класс `ConversationHandler`, который упрощает взаимодействие с моделями, такими как GPT-4, через библиотеку `g4f`. Он позволяет вести историю диалогов и получать ответы от модели.

## Подробней

Модуль предназначен для управления историей сообщений в диалоге с AI-моделью и получения ответов от этой модели. Он использует библиотеку `g4f` для взаимодействия с AI-моделью.  Класс `ConversationHandler` инициализируется с указанием модели (по умолчанию "gpt-4") и предоставляет методы для добавления сообщений пользователя и получения ответов от ассистента. История диалога сохраняется в атрибуте `conversation_history`.

## Классы

### `ConversationHandler`

**Описание**: Класс для управления диалогом с использованием моделей, предоставляемых библиотекой `g4f`.

**Принцип работы**:
Класс `ConversationHandler` инициализируется с указанием модели (по умолчанию "gpt-4"). Он предоставляет методы для добавления сообщений пользователя (`add_user_message`) и получения ответов от ассистента (`get_response`). История диалога сохраняется в атрибуте `conversation_history`. При получении ответа от модели, сообщение ассистента добавляется в историю диалога.

**Аттрибуты**:

- `client`: Клиент для взаимодействия с API `g4f`.
- `model` (str): Название используемой модели (по умолчанию "gpt-4").
- `conversation_history` (list): Список словарей, представляющих историю диалога. Каждый словарь содержит ключи "role" (роль участника: "user" или "assistant") и "content" (содержание сообщения).

**Методы**:

- `__init__(model="gpt-4")`: Инициализирует объект `ConversationHandler` с указанной моделью.
- `add_user_message(content)`: Добавляет сообщение пользователя в историю диалога.
- `get_response()`: Получает ответ от модели на основе истории диалога и добавляет его в историю.

## Функции

### `__init__`

```python
def __init__(self, model="gpt-4"):
    """
    Инициализирует объект `ConversationHandler`.

    Args:
        model (str): Название используемой модели (по умолчанию "gpt-4").
    """
    ...
```

**Назначение**: Инициализация объекта `ConversationHandler` с указанной моделью и создание экземпляра клиента g4f.

**Параметры**:

- `model` (str): Название используемой модели (по умолчанию "gpt-4").

**Как работает функция**:

1.  Создается экземпляр класса `Client` из библиотеки `g4f`, который используется для взаимодействия с API.
2.  Устанавливается модель, которая будет использоваться для генерации ответов (по умолчанию "gpt-4").
3.  Инициализируется пустой список `conversation_history`, который будет хранить историю диалога.

**Примеры**:

```python
conversation = ConversationHandler()  # Использование модели gpt-4 по умолчанию
conversation = ConversationHandler(model="gpt-3.5-turbo")  # Использование другой модели
```

### `add_user_message`

```python
def add_user_message(self, content):
    """
    Добавляет сообщение пользователя в историю диалога.

    Args:
        content (str): Содержание сообщения пользователя.
    """
    ...
```

**Назначение**: Добавление сообщения пользователя в историю диалога.

**Параметры**:

-   `content` (str): Содержание сообщения пользователя.

**Как работает функция**:

1.  Создается словарь, представляющий сообщение пользователя, с ключами "role" (установленным в "user") и "content" (содержанием сообщения).
2.  Этот словарь добавляется в список `conversation_history`, сохраняя таким образом сообщение пользователя в истории диалога.

```
A: Создание словаря с сообщением пользователя
|
B: Добавление словаря в историю диалога
```

**Примеры**:

```python
conversation = ConversationHandler()
conversation.add_user_message("Привет!")
conversation.add_user_message("Как дела?")
```

### `get_response`

```python
def get_response(self):
    """
    Получает ответ от модели на основе истории диалога и добавляет его в историю.

    Returns:
        str: Содержание ответа от модели.
    """
    ...
```

**Назначение**: Получение ответа от модели на основе истории диалога и добавление этого ответа в историю диалога.

**Возвращает**:

-   `str`: Содержание ответа от модели.

**Как работает функция**:

1.  Вызывается метод `create` объекта `client.chat.completions` для получения ответа от модели. В качестве параметров передаются:
    *   `model`: Используемая модель (например, "gpt-4").
    *   `messages`: История диалога (`conversation_history`).
2.  Из полученного ответа извлекается роль и содержание сообщения ассистента.
3.  Создается словарь, представляющий сообщение ассистента, и добавляется в историю диалога.
4.  Возвращается содержание ответа ассистента.

```
A: Отправка истории диалога в модель и получение ответа
|
B: Извлечение роли и содержания сообщения ассистента из ответа
|
C: Добавление сообщения ассистента в историю диалога
|
D: Возврат содержания ответа ассистента
```

**Примеры**:

```python
conversation = ConversationHandler()
conversation.add_user_message("Привет!")
response = conversation.get_response()
print("Assistant:", response)
conversation.add_user_message("Как дела?")
response = conversation.get_response()
print("Assistant:", response)
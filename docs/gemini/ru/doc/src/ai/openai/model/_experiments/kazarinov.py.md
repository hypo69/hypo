# Модуль для экспериментов с OpenAI (kazarinov.py)

## Обзор

Модуль предназначен для экспериментов с использованием OpenAI API. Включает в себя класс `OpenAIChat` для взаимодействия с моделью чата OpenAI и функцию `chat` для организации интерактивного чата с пользователем через консоль.

## Подробней

Этот модуль предоставляет простой интерфейс для работы с OpenAI API, позволяя пользователям задавать вопросы и получать ответы от модели. Он загружает системную инструкцию из файла и использует её для инициализации модели чата.
Расположение файла в проекте указывает на то, что он используется для экспериментов с AI, в частности с моделью OpenAI.

## Классы

### `OpenAIChat`

**Описание**: Класс для взаимодействия с моделью чата OpenAI.

**Принцип работы**:
1.  Инициализируется с API ключом и системной инструкцией.
2.  Хранит историю сообщений в атрибуте `messages`.
3.  Метод `ask` отправляет запросы в модель OpenAI и возвращает ответы.

**Атрибуты**:

*   `api_key` (str): Ключ API для доступа к OpenAI.
*   `system_instruction` (str): Системная инструкция для модели.
*   `messages` (list): Список сообщений для хранения контекста диалога.

**Методы**:

*   `__init__(api_key: str, system_instruction: str = None)`: Инициализирует экземпляр класса `OpenAIChat`.
*   `ask(prompt: str) -> str`: Отправляет запрос в модель OpenAI и возвращает ответ.

#### `__init__(api_key: str, system_instruction: str = None)`

```python
def __init__(self, api_key: str, system_instruction: str = None):
    """
    Инициализирует экземпляр класса OpenAIChat.

    Args:
        api_key (str): Ключ API для доступа к OpenAI.
        system_instruction (str, optional): Системная инструкция для модели. По умолчанию None.
    """
```

**Назначение**: Инициализация объекта `OpenAIChat` с заданным API-ключом и системной инструкцией.

**Параметры**:

*   `api_key` (str): Ключ API для доступа к OpenAI.
*   `system_instruction` (str, optional): Системная инструкция для модели. По умолчанию `None`.

**Как работает функция**:

1.  Устанавливает ключ API OpenAI, используя значение из `gs.credentials`.
2.  Сохраняет системную инструкцию в атрибуте `self.system_instruction`.
3.  Инициализирует пустой список `self.messages` для хранения истории сообщений.
4.  Если предоставлена системная инструкция, добавляет её в список сообщений как сообщение от "system".

**Примеры**:

```python
ai = OpenAIChat(api_key='your_api_key', system_instruction='You are a helpful assistant.')
```

#### `ask(self, prompt: str) -> str`

```python
def ask(self, prompt: str) -> str:
    """Отправка вопроса в модель OpenAI и получение ответа"""
```

**Назначение**: Отправляет запрос в модель OpenAI и возвращает ответ.

**Параметры**:

*   `prompt` (str): Текст запроса.

**Возвращает**:

*   `str`: Ответ от модели OpenAI или сообщение об ошибке.

**Вызывает исключения**:

*   `Exception`: Если возникает ошибка при обращении к OpenAI API.

**Как работает функция**:

1.  Добавляет сообщение пользователя в список сообщений.
2.  Пытается отправить запрос в OpenAI API с использованием `openai.ChatCompletion.create`.
3.  Извлекает ответ из полученного ответа и добавляет его в список сообщений как сообщение от "assistant".
4.  В случае ошибки логирует ошибку с помощью `logger.error` и возвращает сообщение об ошибке.

```
Prompt -> Добавление в messages -> OpenAI API -> Извлечение ответа -> Добавление в messages -> Ответ
```

**Примеры**:

```python
ai = OpenAIChat(api_key='your_api_key', system_instruction='You are a helpful assistant.')
response = ai.ask(prompt='What is the capital of France?')
print(response)
```

## Функции

### `chat()`

```python
def chat():
    """ """
```

**Назначение**: Организует интерактивный чат с пользователем через консоль.

**Как работает функция**:

1.  Выводит приветственное сообщение.
2.  Запрашивает у пользователя OpenAI API ключ.
3.  Инициализирует объект `OpenAIChat` с введенным ключом и системной инструкцией.
4.  Входит в цикл, в котором запрашивает у пользователя вопросы, отправляет их в модель и выводит ответы.
5.  Завершает чат, если пользователь вводит 'exit'.

```
Начало чата -> Ввод API ключа -> Инициализация OpenAIChat -> Цикл (Ввод вопроса -> Отправка в модель -> Вывод ответа) -> Завершение чата
```

**Примеры**:

```python
chat()
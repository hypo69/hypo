## Ответ на Задачу No 434: Закрашивание торта

### 1. Анализ задачи и решение
**Понимание задачи:**
Задача заключается в нахождении количества способов раскрасить торт размером $m \times n$ кусочков, используя $c$ цветов, так чтобы каждый прямоугольник размером не менее $2 \times 2$ содержал хотя бы два одинаковых цвета. 
  
На основе представленных примеров и условия задачи, можно сделать вывод, что единственные допустимые варианты раскраски торта являются:
1. Все строки одинаковы. 
2. Все столбцы одинаковы. 

Это связано с тем, что если есть хотя бы два разных цвета в первой строке и хотя бы два разных цвета в первой колонке, то прямоугольник $2x2$ в левом верхнем углу обязательно должен иметь все 4 разных цвета, что противоречит условию задачи.

**Решение:**
1. **Случай, когда все строки одинаковы:** Мы можем выбрать цвет для первой строки $c$ способами. Для всех остальных строк цвет должен быть таким же, как и в первой строке. Поэтому у нас есть $c^n$ вариантов раскраски, где все строки одинаковы, т.к. для каждой строки можно выбрать один из c цветов.
2. **Случай, когда все столбцы одинаковы:** Аналогично, мы можем выбрать цвет для первого столбца $c$ способами. Для всех остальных столбцов цвет должен быть таким же, как и в первом столбце. Поэтому у нас есть $c^m$ вариантов раскраски, где все столбцы одинаковы.
3. **Пересечение случаев:** Когда все строки одинаковы и все столбцы одинаковы, это означает, что все ячейки торта одного цвета. Таких вариантов $c$. Эти варианты входят и в первый, и во второй случай. 
4. **Общее количество:** Чтобы найти общее количество допустимых раскрасок, мы складываем количество вариантов, когда все строки одинаковы, и когда все столбцы одинаковы, и вычитаем случаи пересечения, чтобы не учитывать их дважды. Таким образом, искомое число раскрасок равно $N(m, n, c) = c^m + c^n - c$.
5. **Вычисление по модулю:** Поскольку $c$ может быть очень большим, а ответ нужно выдать по модулю, мы будем вычислять степени по модулю, используя метод бинарного возведения в степень.

### 2. Алгоритм решения
1. Начать
2. Ввести значения $m$, $n$ и $c$
3. Вычислить $c^m$ по модулю $982451653$
4. Вычислить $c^n$ по модулю $982451653$
5. Вычислить $c^1$ по модулю $982451653$ (просто c)
6. Сложить $c^m$ и $c^n$ и вычесть $c$ по модулю $982451653$.
7. Вывести результат
8. Конец

### 3. Реализация на Python 3.12
```python
def power(base, exponent, mod):
    """
    Calculates base^exponent % mod using binary exponentiation.

    Args:
        base: The base number.
        exponent: The exponent.
        mod: The modulus.

    Returns:
        The result of (base^exponent) % mod.
    """
    result = 1
    base %= mod
    while exponent > 0:
        if exponent % 2 == 1:
            result = (result * base) % mod
        base = (base * base) % mod
        exponent //= 2
    return result


def count_colorings(m, n, c, mod):
    """
    Calculates the number of valid colorings of a cake.

    Args:
        m: The number of rows.
        n: The number of columns.
        c: The number of colors.
        mod: The modulus.

    Returns:
        The number of valid colorings modulo mod.
    """
    cm = power(c, m, mod)
    cn = power(c, n, mod)
    c1 = c % mod # c^1 = c, вычисляем по модулю для консистентности

    result = (cm + cn - c1) % mod
    return result

# Пример использования:
m = 10
n = 10
c = 10**6
mod = 982451653
result = count_colorings(m, n, c, mod)
print(result)
```

### 4. Блок-схема в формате mermaid
```mermaid
flowchart TD
    Start((Начало)) --> InputValues((Ввести m, n, c))
    InputValues --> Calculate_cm((Вычислить cm = c^m % mod))
    Calculate_cm --> Calculate_cn((Вычислить cn = c^n % mod))
    Calculate_cn --> Calculate_c((Вычислить c1 = c % mod))
    Calculate_c --> CalculateResult((Вычислить результат = (cm + cn - c1) % mod))
    CalculateResult --> OutputResult((Вывести результат))
    OutputResult --> End((Конец))
```

**Legenda:**
* **Начало, Конец:** Начало и конец алгоритма.
* **Ввести m, n, c:**  Ввод размерностей торта (m, n) и количества цветов (c).
* **Вычислить cm = c^m % mod:** Вычисление c в степени m по модулю mod с использованием функции `power`.
* **Вычислить cn = c^n % mod:** Вычисление c в степени n по модулю mod с использованием функции `power`.
*  **Вычислить c1 = c % mod:** Вычисление c по модулю mod.
* **Вычислить результат = (cm + cn - c1) % mod:** Вычисление результата по формуле (cm + cn - c) % mod.
* **Вывести результат:** Вывод итогового результата.

# Модуль `utils.py`

## Обзор

Модуль `utils.py` содержит набор вспомогательных функций, используемых для выполнения криптографических операций, преобразования данных и работы с кодировкой Base64. Этот модуль предоставляет инструменты для шифрования, дешифрования, преобразования типов данных и обработки Base64 URL, что необходимо для взаимодействия с API Mega.

## Подробней

Этот модуль предоставляет набор низкоуровневых функций, необходимых для безопасной передачи данных и выполнения криптографических операций при работе с Mega API. Функции в модуле охватывают преобразование данных между различными форматами (например, из массива 32-битных целых чисел в строку и обратно), шифрование и дешифрование данных с использованием алгоритма AES в режиме CBC, а также кодирование и декодирование данных в формате Base64 URL.

## Функции

### `a32_to_str`

```python
def a32_to_str(a):
    """
    Args:
        a (list[int]): Список 32-битных целых чисел.

    Returns:
        bytes: Строка байтов, полученная из списка целых чисел.

    Example:
        >>> a32_to_str([1, 2, 3])
        b'\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x02\\x00\\x00\\x00\\x03'
    """
```

**Описание**: Преобразует список 32-битных целых чисел в строку байтов.

**Параметры**:

- `a` (list[int]): Список 32-битных целых чисел.

**Возвращает**:

- `bytes`: Строка байтов, полученная из списка целых чисел.

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """
    Args:
        data (bytes): Данные для шифрования.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Зашифрованные данные.

    Raises:
        Exception: Если возникает ошибка при шифровании данных.

    Example:
        >>> key = b'\\x00' * 16
        >>> data = b'example data'
        >>> encrypted_data = aes_cbc_encrypt(data, key)
        >>> print(encrypted_data)
        b'...'
    """
```

**Описание**: Шифрует данные с использованием алгоритма AES в режиме CBC.

**Параметры**:

- `data` (bytes): Данные для шифрования.
- `key` (bytes): Ключ шифрования.

**Возвращает**:

- `bytes`: Зашифрованные данные.

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """
    Args:
        data (list[int]): Данные для шифрования в формате списка 32-битных целых чисел.
        key (list[int]): Ключ шифрования в формате списка 32-битных целых чисел.

    Returns:
        list[int]: Зашифрованные данные в формате списка 32-битных целых чисел.

    Raises:
        Exception: Если возникает ошибка при шифровании данных.

    Example:
        >>> key = [0] * 4
        >>> data = [1, 2, 3, 4]
        >>> encrypted_data = aes_cbc_encrypt_a32(data, key)
        >>> print(encrypted_data)
        (...)
    """
```

**Описание**: Шифрует данные, представленные в виде списка 32-битных целых чисел, с использованием алгоритма AES в режиме CBC.

**Параметры**:

- `data` (list[int]): Данные для шифрования в формате списка 32-битных целых чисел.
- `key` (list[int]): Ключ шифрования в формате списка 32-битных целых чисел.

**Возвращает**:

- `list[int]`: Зашифрованные данные в формате списка 32-битных целых чисел.

### `str_to_a32`

```python
def str_to_a32(b):
    """
    Args:
        b (str | bytes): Строка для преобразования.

    Returns:
        tuple[int]: Кортеж 32-битных целых чисел, полученный из строки.

    Raises:
        Exception: Если возникает ошибка при преобразовании строки.

    Example:
        >>> str_to_a32(b'\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x02\\x00\\x00\\x00\\x03')
        (1, 2, 3)
    """
```

**Описание**: Преобразует строку байтов в кортеж 32-битных целых чисел.

**Параметры**:

- `b` (str | bytes): Строка для преобразования.

**Возвращает**:

- `tuple[int]`: Кортеж 32-битных целых чисел, полученный из строки.

### `mpi2int`

```python
def mpi2int(s):
    """
    Args:
        s (bytes): Строка байтов, представляющая число MPI.

    Returns:
        int: Целое число, полученное из MPI.

    Raises:
        Exception: Если возникает ошибка при преобразовании MPI.

    Example:
        >>> mpi2int(b'\\x00\\x02\\x01\\x00')
        256
    """
```

**Описание**: Преобразует строку, представляющую число MPI (Multi-Precision Integer), в целое число.

**Параметры**:

- `s` (bytes): Строка байтов, представляющая число MPI.

**Возвращает**:

- `int`: Целое число, полученное из MPI.

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """
    Args:
        data (bytes): Данные для дешифрования.
        key (bytes): Ключ дешифрования.

    Returns:
        bytes: Дешифрованные данные.

    Raises:
        Exception: Если возникает ошибка при дешифровании данных.
    
    Example:
        >>> key = b'\\x00' * 16
        >>> data = b'example data'
        >>> encrypted_data = aes_cbc_encrypt(data, key)
        >>> decrypted_data = aes_cbc_decrypt(encrypted_data, key)
        >>> print(decrypted_data)
        b'...'
    """
```

**Описание**: Дешифрует данные с использованием алгоритма AES в режиме CBC.

**Параметры**:

- `data` (bytes): Данные для дешифрования.
- `key` (bytes): Ключ дешифрования.

**Возвращает**:

- `bytes`: Дешифрованные данные.

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """
    Args:
        data (list[int]): Данные для дешифрования в формате списка 32-битных целых чисел.
        key (list[int]): Ключ дешифрования в формате списка 32-битных целых чисел.

    Returns:
        list[int]: Дешифрованные данные в формате списка 32-битных целых чисел.

    Raises:
        Exception: Если возникает ошибка при дешифровании данных.

    Example:
        >>> key = [0] * 4
        >>> data = [1, 2, 3, 4]
        >>> encrypted_data = aes_cbc_encrypt_a32(data, key)
        >>> decrypted_data = aes_cbc_decrypt_a32(encrypted_data, key)
        >>> print(decrypted_data)
        (...)
    """
```

**Описание**: Дешифрует данные, представленные в виде списка 32-битных целых чисел, с использованием алгоритма AES в режиме CBC.

**Параметры**:

- `data` (list[int]): Данные для дешифрования в формате списка 32-битных целых чисел.
- `key` (list[int]): Ключ дешифрования в формате списка 32-битных целых чисел.

**Возвращает**:

- `list[int]`: Дешифрованные данные в формате списка 32-битных целых чисел.

### `base64urldecode`

```python
def base64urldecode(data):
    """
    Args:
        data (str): Строка Base64 URL для декодирования.

    Returns:
        bytes: Декодированные данные.

    Raises:
        Exception: Если возникает ошибка при декодировании Base64 URL.

    Example:
        >>> base64urldecode('YSBzdHJpbmc')
        b'a string'
    """
```

**Описание**: Декодирует строку Base64 URL.

**Параметры**:

- `data` (str): Строка Base64 URL для декодирования.

**Возвращает**:

- `bytes`: Декодированные данные.

### `base64_to_a32`

```python
def base64_to_a32(s):
    """
    Args:
        s (str): Строка Base64 URL для преобразования.

    Returns:
        tuple[int]: Кортеж 32-битных целых чисел, полученный из Base64 URL.

    Raises:
        Exception: Если возникает ошибка при преобразовании Base64 URL.

    Example:
        >>> base64_to_a32('AQIDBAUGBwgJCgsMDQ4PEA')
        (16777216, 50331648, 83886080, 117440512, 150994944)
    """
```

**Описание**: Преобразует строку Base64 URL в кортеж 32-битных целых чисел.

**Параметры**:

- `s` (str): Строка Base64 URL для преобразования.

**Возвращает**:

- `tuple[int]`: Кортеж 32-битных целых чисел, полученный из Base64 URL.

### `base64urlencode`

```python
def base64urlencode(data):
    """
    Args:
        data (bytes): Данные для кодирования в Base64 URL.

    Returns:
        str: Строка Base64 URL, полученная из данных.

    Raises:
        Exception: Если возникает ошибка при кодировании Base64 URL.

    Example:
        >>> base64urlencode(b'a string')
        'YSBzdHJpbmc'
    """
```

**Описание**: Кодирует данные в строку Base64 URL.

**Параметры**:

- `data` (bytes): Данные для кодирования в Base64 URL.

**Возвращает**:

- `str`: Строка Base64 URL, полученная из данных.

### `a32_to_base64`

```python
def a32_to_base64(a):
    """
    Args:
        a (list[int]): Список 32-битных целых чисел для преобразования.

    Returns:
        str: Строка Base64 URL, полученная из списка целых чисел.

    Raises:
        Exception: Если возникает ошибка при преобразовании в Base64 URL.

    Example:
        >>> a32_to_base64([1, 2, 3, 4, 5])
        'AQIDBAU'
    """
```

**Описание**: Преобразует список 32-битных целых чисел в строку Base64 URL.

**Параметры**:

- `a` (list[int]): Список 32-битных целых чисел для преобразования.

**Возвращает**:

- `str`: Строка Base64 URL, полученная из списка целых чисел.

### `get_chunks`

```python
def get_chunks(size):
    """
    Args:
        size (int): Общий размер данных.

    Returns:
        dict[int, int]: Словарь, содержащий смещения и размеры чанков.

    Raises:
        Exception: Если возникает ошибка при определении чанков.

    Example:
        >>> get_chunks(1048576)
        {0: 131072, 131072: 131072, 262144: 131072, 393216: 131072, 524288: 131072, 655360: 131072, 786432: 131072, 917504: 131072}
    """
```

**Описание**: Разбивает данные на чанки определенного размера.

**Параметры**:

- `size` (int): Общий размер данных.

**Возвращает**:

- `dict[int, int]`: Словарь, содержащий смещения и размеры чанков.
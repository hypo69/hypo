# Модуль `src.endpoints.bots.telegram`

## Обзор

Модуль реализует Telegram-бота, который обрабатывает команды, голосовые сообщения и файлы документов. Бот предназначен для интерактивного взаимодействия с пользователями в Telegram.

## Подробней

Модуль содержит основные функции и команды для работы с Telegram ботом, такие как:

- Инициализация бота с использованием токена.
- Обработка команд `/start`, `/help`, `/sendpdf`.
- Обработка входящих текстовых и голосовых сообщений, а также файлов документов.
- Загрузка и сохранение файлов, а также попытки транскрибирования голосовых сообщений.

Бот использует библиотеку `python-telegram-bot` и другие модули, такие как `pathlib`, `tempfile`, `asyncio`, `requests`, `src.utils.convertors.tts`, и `src.utils.file`.

## Оглавление

- [Классы](#Классы)
  - [TelegramBot](#TelegramBot)
    - [__init__](#__init__)
    - [register_handlers](#register_handlers)
    - [start](#start)
    - [help_command](#help_command)
    - [send_pdf](#send_pdf)
    - [handle_voice](#handle_voice)
    - [transcribe_voice](#transcribe_voice)
    - [handle_document](#handle_document)
    - [handle_message](#handle_message)
- [Функции](#Функции)
  - [main](#main)

## Классы

### `TelegramBot`

**Описание**: Класс, представляющий Telegram-бота.

**Как работает класс**:
Класс `TelegramBot` инициализируется с токеном, который используется для аутентификации бота в Telegram API. Он регистрирует обработчики для различных команд и сообщений, позволяя боту взаимодействовать с пользователями. Основные методы класса включают обработку команд `/start`, `/help`, `/sendpdf`, а также обработку голосовых и текстовых сообщений и файлов документов. Класс использует библиотеку `python-telegram-bot` для взаимодействия с Telegram API.

**Методы**:
- [__init__](#__init__)
- [register_handlers](#register_handlers)
- [start](#start)
- [help_command](#help_command)
- [send_pdf](#send_pdf)
- [handle_voice](#handle_voice)
- [transcribe_voice](#transcribe_voice)
- [handle_document](#handle_document)
- [handle_message](#handle_message)

#### `__init__`

```python
def __init__(self, token: str) -> None:
    """Инициализирует бота с токеном и регистрирует обработчики."""
```

**Описание**: Инициализирует экземпляр класса `TelegramBot`.

**Как работает функция**:

Функция принимает токен, который используется для аутентификации бота в Telegram API. Затем вызывается метод `register_handlers`, чтобы зарегистрировать обработчики команд и сообщений.

**Параметры**:

- `token` (str): Токен для аутентификации бота в Telegram API.

#### `register_handlers`

```python
def register_handlers(self) -> None:
    """Регистрирует обработчики команд и сообщений."""
```

**Описание**: Регистрирует обработчики команд и сообщений для бота.

**Как работает функция**:

Функция создает обработчики для команд `/start` и `/help`, а также для текстовых сообщений, документов и голосовых сообщений. Каждый обработчик связывается с соответствующим методом класса `TelegramBot`, который будет вызван при получении соответствующего события от Telegram API.

#### `start`

```python
def start(self, update: Update, context: CallbackContext) -> None:
    """Обрабатывает команду /start."""
```

**Описание**: Обрабатывает команду `/start`, отправляя приветственное сообщение пользователю.

**Как работает функция**:

Функция принимает объекты `Update` и `CallbackContext` от `python-telegram-bot`, извлекает информацию о пользователе и отправляет приветственное сообщение с использованием метода `update.message.reply_text`.

**Параметры**:

- `update` (Update): Объект, представляющий входящее обновление от Telegram.
- `context` (CallbackContext): Объект, содержащий информацию о контексте вызова.

#### `help_command`

```python
def help_command(self, update: Update, context: CallbackContext) -> None:
    """Обрабатывает команду /help."""
```

**Описание**: Обрабатывает команду `/help`, отправляя список доступных команд пользователю.

**Как работает функция**:

Функция принимает объекты `Update` и `CallbackContext` от `python-telegram-bot` и отправляет справочное сообщение с использованием метода `update.message.reply_text`.

**Параметры**:

- `update` (Update): Объект, представляющий входящее обновление от Telegram.
- `context` (CallbackContext): Объект, содержащий информацию о контексте вызова.

#### `send_pdf`

```python
def send_pdf(self, pdf_file: str | Path) -> None:
    """Обрабатывает команду /sendpdf для отправки PDF-файла."""
```

**Описание**: Обрабатывает команду `/sendpdf` для отправки PDF-файла пользователю.

**Как работает функция**:

Функция принимает путь к PDF-файлу, отправляет файл пользователю с использованием метода `context.bot.send_document`.

**Параметры**:

- `pdf_file` (str | Path): Путь к PDF-файлу.

#### `handle_voice`

```python
def handle_voice(self, update: Update, context: CallbackContext) -> None:
    """Обрабатывает голосовые сообщения и транскрибирует аудио."""
```

**Описание**: Обрабатывает голосовые сообщения, загружает файл и пытается транскрибировать аудио.

**Как работает функция**:

Функция загружает голосовое сообщение, сохраняет его локально во временный файл, а затем вызывает метод `transcribe_voice` для попытки транскрибирования аудио. Результат транскрибирования или сообщение об ошибке отправляется пользователю.

**Параметры**:

- `update` (Update): Объект, представляющий входящее обновление от Telegram.
- `context` (CallbackContext): Объект, содержащий информацию о контексте вызова.

#### `transcribe_voice`

```python
def transcribe_voice(self, file_path: Path) -> str:
    """Транскрибирует голосовые сообщения (заглушка)."""
```

**Описание**: Транскрибирует голосовые сообщения (в текущей реализации - заглушка).

**Как работает функция**:

Функция принимает путь к файлу голосового сообщения и возвращает строку "Транскрипция голоса пока не реализована". В будущем здесь будет реализована логика транскрибирования аудио в текст.

**Параметры**:

- `file_path` (Path): Путь к файлу голосового сообщения.

**Возвращает**:

- `str`: Сообщение о том, что транскрипция голоса пока не реализована.

#### `handle_document`

```python
def handle_document(self, update: Update, context: CallbackContext) -> str:
    """Обрабатывает файлы документов и читает их содержимое."""
```

**Описание**: Обрабатывает файлы документов, загружает файл и читает его содержимое.

**Как работает функция**:

Функция загружает файл документа, сохраняет его локально во временный файл, читает содержимое текстового документа. Затем содержимое документа отправляется пользователю.

**Параметры**:

- `update` (Update): Объект, представляющий входящее обновление от Telegram.
- `context` (CallbackContext): Объект, содержащий информацию о контексте вызова.

**Возвращает**:

- `str`: Содержимое текстового документа.

#### `handle_message`

```python
def handle_message(self, update: Update, context: CallbackContext) -> str:
    """Обрабатывает текстовые сообщения и возвращает полученный текст."""
```

**Описание**: Обрабатывает текстовые сообщения и возвращает полученный текст.

**Как работает функция**:

Функция принимает объекты `Update` и `CallbackContext` от `python-telegram-bot` и возвращает текст полученного сообщения.

**Параметры**:

- `update` (Update): Объект, представляющий входящее обновление от Telegram.
- `context` (CallbackContext): Объект, содержащий информацию о контексте вызова.

**Возвращает**:

- `str`: Текст полученного сообщения.

## Функции

### `main`

```python
def main() -> None:
    """Инициализирует бота, регистрирует обработчики команд и сообщений, и запускает бота с помощью run_polling()."""
```

**Описание**: Инициализирует и запускает Telegram-бота.

**Как работает функция**:

Функция считывает токен Telegram бота из перемены окружения `TELEGRAM_TOKEN`, инициализирует класс `TelegramBot` с использованием этого токена. Затем запускает бота с использованием метода `run_polling()`, который ожидает входящие обновления от Telegram API и обрабатывает их с помощью зарегистрированных обработчиков.
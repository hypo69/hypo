# Объяснение кода send_data.js

Этот JavaScript код предназначен для сбора информации о текущей загруженной странице веб-сайта и отправки этой информации на сервер по адресу `http://127.0.0.1/hypotez.online/api/`.

**Функция `onPageLoad`:**

```javascript
function onPageLoad() {
    // Собираем информацию о странице
    var title = document.title;
    var url = window.location.href;
    var body = document.body.innerHTML;

    // Формируем объект с данными для отправки
    var data = {
        title: title,
        url: url,
        body: body
    };
}
```

Эта функция собирает три важных элемента страницы:

* `document.title`: Заголовок страницы.
* `window.location.href`: Полный URL страницы.
* `document.body.innerHTML`:  Внутреннее содержимое тела страницы (HTML).

Затем, собранная информация собирается в объект `data` для последующей отправки.

```javascript
    // Отправляем данные на указанный адрес
    fetch('http://127.0.0.1/hypotez.online/api/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    // ... (обработка ответа)
```

Здесь происходит отправка данных на сервер:

* `fetch()`:  Метод для отправки запроса.
* `'http://127.0.0.1/hypotez.online/api/'`:  Адрес сервера, куда отправляются данные. Обратите внимание, что это локальный адрес, скорее всего, для тестирования расширения.
* `method: 'POST'`:  Тип запроса (POST), используется для отправки данных.
* `headers: {'Content-Type': 'application/json'}`:  Устанавливает тип контента как JSON, что важно для корректного приема данных на сервере.
* `body: JSON.stringify(data)`: Преобразует объект `data` в строку JSON, перед отправкой.

**Обработка ответа:**

```javascript
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(json => {
        console.log('Response:', json);
    })
    .catch(error => {
        console.error('Error:', error);
    });
```

Эта часть кода обрабатывает ответ сервера:

* `.then(response => ...)`: Обрабатывает успешный ответ от сервера.
* `if (!response.ok)`: Проверяет, был ли ответ успешным (статус код 2xx). Если нет, выбрасывает ошибку.
* `.then(json => ...)`: Если ответ успешный, преобразует его в JSON и выводит в консоль.
* `.catch(error => ...)`:  Обрабатывает ошибки при отправке запроса или обработке ответа.

**Функция `window.addEventListener('load', onPageLoad);`:**

Эта строка добавляет обработчик `onPageLoad` для события `load`, которое срабатывает после полной загрузки страницы.  Это значит, что код внутри `onPageLoad` будет выполнен только после того, как вся страница будет загружена и готова.

**Вывод:**

Код отправляет информацию о загруженной странице на сервер, используя метод `fetch`,  и обрабатывает полученный ответ.  Важная часть - корректное использование JSON для обмена данными между клиентом и сервером. Обработка ошибок  делает код более надежным.
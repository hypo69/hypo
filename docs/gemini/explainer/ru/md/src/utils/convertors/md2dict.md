# md2dict.py - Конвертация Markdown в словарь

```markdown
## md2dict.py - Конвертация Markdown в словарь

Этот файл содержит функцию `md2dict`, которая преобразует строку Markdown в структурированный словарь.  Функция поддерживает извлечение вложенного JSON-контента, если он присутствует в строке Markdown.  Если JSON не найден, возвращается словарь, содержащий заголовки и текст секций Markdown.

**Структура функции `md2dict`:**

1. **Извлечение JSON:** Функция пытается извлечь JSON-контент из входной строки Markdown. Если найден, возвращается словарь с ключом `"json"` и содержащим извлечённый JSON.

2. **Обработка Markdown:** Если JSON не найден, функция конвертирует Markdown в HTML с помощью `markdown2`. Далее, код итерирует по строкам HTML.
   - **Разбиение на секции:** На основе тегов заголовков (`<h1 ...>`, `<h2 ...>`, и т.д.) формируются секции. Заголовки уровня 1 создают новые секции в словаре, а заголовки уровней 2 и выше добавляются в текущую секцию.
   - **Извлечение текста:**  Из каждой строки HTML удаляются теги и сохраняется чистый текст. Этот чистый текст добавляется в соответствующую секцию.
3. **Обработка ошибок:** Вся обработка выполняется в блоке `try...except`, чтобы перехватывать возможные ошибки и регистрировать их с помощью логгера `logger`. Если возникает ошибка, возвращается пустой словарь.

**Функция `extract_json_from_string`:**

Эта функция ищет JSON-контент в строке, используя регулярное выражение. Если JSON найден, он преобразуется в словарь с помощью `eval()`.   **Важно:** использование `eval()` может быть небезопасным в реальных приложениях. В этом коде используется для упрощения примера, но в production-коде следует использовать более безопасные методы парсинга JSON, например, `json.loads()`.  Если происходит ошибка при парсинге JSON, возвращается `None`.

**Пример использования (в другом файле):**

```python
import hypotez.src.utils.convertors.md2dict as md2dict

md_string = """# Заголовок 1
Текст в секции 1.

## Подзаголовок 1.1
Текст подзаголовка.

```json
{"key": "value"}
```
"""

result = md2dict.md2dict(md_string)
print(result)
```

**Ключевые моменты и улучшения:**

* **Безопасный парсинг JSON:** Использование `json.loads()` вместо `eval()` для парсинга JSON. Это значительно повысит безопасность.
* **Обработка ошибок:**  Полноценная обработка ошибок с использованием `try...except` и логирование через `logger`.
* **Ясность кода:** Комментарии поясняют каждый этап работы функции.
* **Тип возвращаемого значения:** Определены типы возвращаемых значений, что улучшает читаемость и безопасность кода.

**Примечание:**  Модуль `markdown2` требуется для работы кода.

```
```
```
```
```
```
```
```
```
```
```
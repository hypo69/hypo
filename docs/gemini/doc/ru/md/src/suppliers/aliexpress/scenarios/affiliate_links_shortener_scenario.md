# Модуль `hypotez/src/suppliers/aliexpress/scenarios/affiliate_links_shortener_scenario.py`

## Обзор

Данный модуль содержит функцию `get_short_affiliate_link`, предназначенную для сокращения ссылок через веб-браузер. Функция взаимодействует с веб-сайтом, вводит URL в поле, нажимает кнопку, ожидает обновления страницы, извлекает укороченную ссылку и открывает её в новом окне браузера.


## Функции

### `get_short_affiliate_link`

**Описание**: Функция сокращает предоставленный URL, взаимодействуя с веб-браузером.

**Параметры**:
- `d` (Driver): Объект драйвера веб-браузера.
- `url` (str): Полный URL, который необходимо сократить.

**Возвращает**:
- `str`: Укороченная ссылка или `None`, если произошла ошибка.

**Вызывает исключения**:
-  Возможные исключения не перечислены явно, но могут быть вызваны из внутренних методов объекта `Driver`, например, при проблемах с подключением к браузеру.


## Локаторы

Локаторы для элементов на странице, используемые функцией, загружаются из файла `affiliate_links_shortener.json` в директории `src/suppliers/aliexpress/locators/`.  Формат файла предполагает JSON-объект, содержащий наименования локаторов (например, `textarea_target_url`, `button_get_tracking_link`).


## Постоянные переменные

- `MODE`: Назначение переменной неясно. По умолчанию - 'dev'

## Модули импорта

- `pathlib`, `typing`, `types`, `time`, `gs`, `j_loads`, `j_loads_ns`, `logger`, `Driver`: Импортированные модули, и их предполагаемое назначение. Подробнее о назначении модулей можно найти в документации к соответствующим файлам.


## Сценарий работы функции `get_short_affiliate_link`

1. Функция принимает объект драйвера (`d`) и URL (`url`).
2. Заполняет поле ввода целевым URL.
3. Нажимает кнопку получения сокращенной ссылки.
4. Ожидает обновление страницы (1 секунда).
5. Извлекает сокращенную ссылку из элемента на странице.
6. Сохраняет идентификатор текущего окна.
7. Если сокращенная ссылка пустая, регистрируется ошибка и возвращается None (не генерируется исключение).
8. Открывает новую вкладку с сокращенной ссылкой.
9. Переключается на новую вкладку.
10. Проверяет, начинается ли URL на странице с ожидаемого значения (`https://error.taobao.com`). Если да, то регистрируется ошибка, текущая страница закрывается, и выполнение возвращается к основной вкладке.
11. Закрывается новая вкладка и возвращается к основной.
12. Возвращает полученную сокращенную ссылку.